(self.webpackChunkPuntos_de_CyL=self.webpackChunkPuntos_de_CyL||[]).push([[179],{2340:(or,Gt,De)=>{"use strict";De.d(Gt,{N:()=>W});const W={mapboxToken:"pk.eyJ1IjoianVuY2EyMzUiLCJhIjoiY2xmdjBpa2VnMDJrYzNrbzMwMmEyOXlmZiJ9.GJ8cigJUn2cUWxd_Wx_5VQ",mongoUrl:"http://puntos-recarga-cyl.up.railway.app/api",jcylUrl:"https://analisis.datosabiertos.jcyl.es/api/records/1.0/search/?dataset=puntos-de-recarga-del-vehiculo-electrico&rows=123"}},4066:(or,Gt,De)=>{"use strict";var W=De(1481),ge=De(8256),Ge=De(7340);function Le(Q){return new ge.vHH(3e3,!1)}function er(){return typeof window<"u"&&typeof window.document<"u"}function Vn(){return typeof process<"u"&&"[object process]"==={}.toString.call(process)}function zn(Q){switch(Q.length){case 0:return new Ge.ZN;case 1:return Q[0];default:return new Ge.ZE(Q)}}function cr(Q,I,R,j,te=new Map,me=new Map){const Oe=[],Be=[];let tt=-1,vt=null;if(j.forEach(on=>{const gn=on.get("offset"),pr=gn==tt,ur=pr&&vt||new Map;on.forEach((jn,Kn)=>{let mr=Kn,Tr=jn;if("offset"!==Kn)switch(mr=I.normalizePropertyName(mr,Oe),Tr){case Ge.k1:Tr=te.get(Kn);break;case Ge.l3:Tr=me.get(Kn);break;default:Tr=I.normalizeStyleValue(Kn,mr,Tr,Oe)}ur.set(mr,Tr)}),pr||Be.push(ur),vt=ur,tt=gn}),Oe.length)throw function fn(Q){return new ge.vHH(3502,!1)}();return Be}function Ar(Q,I,R,j){switch(I){case"start":Q.onStart(()=>j(R&&nn(R,"start",Q)));break;case"done":Q.onDone(()=>j(R&&nn(R,"done",Q)));break;case"destroy":Q.onDestroy(()=>j(R&&nn(R,"destroy",Q)))}}function nn(Q,I,R){const me=Kr(Q.element,Q.triggerName,Q.fromState,Q.toState,I||Q.phaseName,R.totalTime??Q.totalTime,!!R.disabled),Oe=Q._data;return null!=Oe&&(me._data=Oe),me}function Kr(Q,I,R,j,te="",me=0,Oe){return{element:Q,triggerName:I,fromState:R,toState:j,phaseName:te,totalTime:me,disabled:!!Oe}}function Pr(Q,I,R){let j=Q.get(I);return j||Q.set(I,j=R),j}function Zo(Q){const I=Q.indexOf(":");return[Q.substring(1,I),Q.slice(I+1)]}let Rr=(Q,I)=>!1,Yr=(Q,I,R)=>[],vi=null;function xn(Q){const I=Q.parentNode||Q.host;return I===vi?null:I}(Vn()||typeof Element<"u")&&(er()?(vi=(()=>document.documentElement)(),Rr=(Q,I)=>{for(;I;){if(I===Q)return!0;I=xn(I)}return!1}):Rr=(Q,I)=>Q.contains(I),Yr=(Q,I,R)=>{if(R)return Array.from(Q.querySelectorAll(I));const j=Q.querySelector(I);return j?[j]:[]});let di=null,zo=!1;const Er=Rr,un=Yr;let Lr=(()=>{class Q{validateStyleProperty(R){return function sr(Q){di||(di=function Ai(){return typeof document<"u"?document.body:null}()||{},zo=!!di.style&&"WebkitAppearance"in di.style);let I=!0;return di.style&&!function Wi(Q){return"ebkit"==Q.substring(1,6)}(Q)&&(I=Q in di.style,!I&&zo&&(I="Webkit"+Q.charAt(0).toUpperCase()+Q.slice(1)in di.style)),I}(R)}matchesElement(R,j){return!1}containsElement(R,j){return Er(R,j)}getParentElement(R){return xn(R)}query(R,j,te){return un(R,j,te)}computeStyle(R,j,te){return te||""}animate(R,j,te,me,Oe,Be=[],tt){return new Ge.ZN(te,me)}}return Q.\u0275fac=function(R){return new(R||Q)},Q.\u0275prov=ge.Yz7({token:Q,factory:Q.\u0275fac}),Q})(),Jr=(()=>{class Q{}return Q.NOOP=new Lr,Q})();const tr=1e3,$r="ng-enter",jr="ng-leave",Bo="ng-trigger",xr=".ng-trigger",Ui="ng-animating",Rn=".ng-animating";function Ri(Q){if("number"==typeof Q)return Q;const I=Q.match(/^(-?[\.\d]+)(m?s)/);return!I||I.length<2?0:Zi(parseFloat(I[1]),I[2])}function Zi(Q,I){return"s"===I?Q*tr:Q}function Je(Q,I,R){return Q.hasOwnProperty("duration")?Q:function Fe(Q,I,R){let te,me=0,Oe="";if("string"==typeof Q){const Be=Q.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===Be)return I.push(Le()),{duration:0,delay:0,easing:""};te=Zi(parseFloat(Be[1]),Be[2]);const tt=Be[3];null!=tt&&(me=Zi(parseFloat(tt),Be[4]));const vt=Be[5];vt&&(Oe=vt)}else te=Q;if(!R){let Be=!1,tt=I.length;te<0&&(I.push(function en(){return new ge.vHH(3100,!1)}()),Be=!0),me<0&&(I.push(function qt(){return new ge.vHH(3101,!1)}()),Be=!0),Be&&I.splice(tt,0,Le())}return{duration:te,delay:me,easing:Oe}}(Q,I,R)}function Ne(Q,I={}){return Object.keys(Q).forEach(R=>{I[R]=Q[R]}),I}function Rt(Q){const I=new Map;return Object.keys(Q).forEach(R=>{I.set(R,Q[R])}),I}function ce(Q,I=new Map,R){if(R)for(let[j,te]of R)I.set(j,te);for(let[j,te]of Q)I.set(j,te);return I}function q(Q,I,R){return R?I+":"+R+";":""}function Y(Q){let I="";for(let R=0;R<Q.style.length;R++){const j=Q.style.item(R);I+=q(0,j,Q.style.getPropertyValue(j))}for(const R in Q.style)Q.style.hasOwnProperty(R)&&!R.startsWith("_")&&(I+=q(0,kt(R),Q.style[R]));Q.setAttribute("style",I)}function de(Q,I,R){Q.style&&(I.forEach((j,te)=>{const me=lt(te);R&&!R.has(te)&&R.set(te,Q.style[me]),Q.style[me]=j}),Vn()&&Y(Q))}function Ee(Q,I){Q.style&&(I.forEach((R,j)=>{const te=lt(j);Q.style[te]=""}),Vn()&&Y(Q))}function ie(Q){return Array.isArray(Q)?1==Q.length?Q[0]:(0,Ge.vP)(Q):Q}const X=new RegExp("{{\\s*(.+?)\\s*}}","g");function oe(Q){let I=[];if("string"==typeof Q){let R;for(;R=X.exec(Q);)I.push(R[1]);X.lastIndex=0}return I}function _e(Q,I,R){const j=Q.toString(),te=j.replace(X,(me,Oe)=>{let Be=I[Oe];return null==Be&&(R.push(function wt(Q){return new ge.vHH(3003,!1)}()),Be=""),Be.toString()});return te==j?Q:te}function Ue(Q){const I=[];let R=Q.next();for(;!R.done;)I.push(R.value),R=Q.next();return I}const ct=/-+([a-z0-9])/g;function lt(Q){return Q.replace(ct,(...I)=>I[1].toUpperCase())}function kt(Q){return Q.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function mn(Q,I,R){switch(I.type){case 7:return Q.visitTrigger(I,R);case 0:return Q.visitState(I,R);case 1:return Q.visitTransition(I,R);case 2:return Q.visitSequence(I,R);case 3:return Q.visitGroup(I,R);case 4:return Q.visitAnimate(I,R);case 5:return Q.visitKeyframes(I,R);case 6:return Q.visitStyle(I,R);case 8:return Q.visitReference(I,R);case 9:return Q.visitAnimateChild(I,R);case 10:return Q.visitAnimateRef(I,R);case 11:return Q.visitQuery(I,R);case 12:return Q.visitStagger(I,R);default:throw function Et(Q){return new ge.vHH(3004,!1)}()}}function Qn(Q,I){return window.getComputedStyle(Q)[I]}const Qr="*";function xi(Q,I){const R=[];return"string"==typeof Q?Q.split(/\s*,\s*/).forEach(j=>function ls(Q,I,R){if(":"==Q[0]){const tt=function Ba(Q,I){switch(Q){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(R,j)=>parseFloat(j)>parseFloat(R);case":decrement":return(R,j)=>parseFloat(j)<parseFloat(R);default:return I.push(function Me(Q){return new ge.vHH(3016,!1)}()),"* => *"}}(Q,R);if("function"==typeof tt)return void I.push(tt);Q=tt}const j=Q.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==j||j.length<4)return R.push(function Hn(Q){return new ge.vHH(3015,!1)}()),I;const te=j[1],me=j[2],Oe=j[3];I.push(oi(te,Oe));"<"==me[0]&&!(te==Qr&&Oe==Qr)&&I.push(oi(Oe,te))}(j,R,I)):R.push(Q),R}const Li=new Set(["true","1"]),ar=new Set(["false","0"]);function oi(Q,I){const R=Li.has(Q)||ar.has(Q),j=Li.has(I)||ar.has(I);return(te,me)=>{let Oe=Q==Qr||Q==te,Be=I==Qr||I==me;return!Oe&&R&&"boolean"==typeof te&&(Oe=te?Li.has(Q):ar.has(Q)),!Be&&j&&"boolean"==typeof me&&(Be=me?Li.has(I):ar.has(I)),Oe&&Be}}const $t=new RegExp("s*:selfs*,?","g");function kn(Q,I,R,j){return new xo(Q).build(I,R,j)}class xo{constructor(I){this._driver=I}build(I,R,j){const te=new pn(R);return this._resetContextStyleTimingState(te),mn(this,ie(I),te)}_resetContextStyleTimingState(I){I.currentQuerySelector="",I.collectedStyles=new Map,I.collectedStyles.set("",new Map),I.currentTime=0}visitTrigger(I,R){let j=R.queryCount=0,te=R.depCount=0;const me=[],Oe=[];return"@"==I.name.charAt(0)&&R.errors.push(function Zt(){return new ge.vHH(3006,!1)}()),I.definitions.forEach(Be=>{if(this._resetContextStyleTimingState(R),0==Be.type){const tt=Be,vt=tt.name;vt.toString().split(/\s*,\s*/).forEach(on=>{tt.name=on,me.push(this.visitState(tt,R))}),tt.name=vt}else if(1==Be.type){const tt=this.visitTransition(Be,R);j+=tt.queryCount,te+=tt.depCount,Oe.push(tt)}else R.errors.push(function Pn(){return new ge.vHH(3007,!1)}())}),{type:7,name:I.name,states:me,transitions:Oe,queryCount:j,depCount:te,options:null}}visitState(I,R){const j=this.visitStyle(I.styles,R),te=I.options&&I.options.params||null;if(j.containsDynamicStyles){const me=new Set,Oe=te||{};j.styles.forEach(Be=>{Be instanceof Map&&Be.forEach(tt=>{oe(tt).forEach(vt=>{Oe.hasOwnProperty(vt)||me.add(vt)})})}),me.size&&(Ue(me.values()),R.errors.push(function Ut(Q,I){return new ge.vHH(3008,!1)}()))}return{type:0,name:I.name,style:j,options:te?{params:te}:null}}visitTransition(I,R){R.queryCount=0,R.depCount=0;const j=mn(this,ie(I.animation),R);return{type:1,matchers:xi(I.expr,R.errors),animation:j,queryCount:R.queryCount,depCount:R.depCount,options:Nr(I.options)}}visitSequence(I,R){return{type:2,steps:I.steps.map(j=>mn(this,j,R)),options:Nr(I.options)}}visitGroup(I,R){const j=R.currentTime;let te=0;const me=I.steps.map(Oe=>{R.currentTime=j;const Be=mn(this,Oe,R);return te=Math.max(te,R.currentTime),Be});return R.currentTime=te,{type:3,steps:me,options:Nr(I.options)}}visitAnimate(I,R){const j=function Br(Q,I){if(Q.hasOwnProperty("duration"))return Q;if("number"==typeof Q)return dr(Je(Q,I).duration,0,"");const R=Q;if(R.split(/\s+/).some(me=>"{"==me.charAt(0)&&"{"==me.charAt(1))){const me=dr(0,0,"");return me.dynamic=!0,me.strValue=R,me}const te=Je(R,I);return dr(te.duration,te.delay,te.easing)}(I.timings,R.errors);R.currentAnimateTimings=j;let te,me=I.styles?I.styles:(0,Ge.oB)({});if(5==me.type)te=this.visitKeyframes(me,R);else{let Oe=I.styles,Be=!1;if(!Oe){Be=!0;const vt={};j.easing&&(vt.easing=j.easing),Oe=(0,Ge.oB)(vt)}R.currentTime+=j.duration+j.delay;const tt=this.visitStyle(Oe,R);tt.isEmptyStep=Be,te=tt}return R.currentAnimateTimings=null,{type:4,timings:j,style:te,options:null}}visitStyle(I,R){const j=this._makeStyleAst(I,R);return this._validateStyleAst(j,R),j}_makeStyleAst(I,R){const j=[],te=Array.isArray(I.styles)?I.styles:[I.styles];for(let Be of te)"string"==typeof Be?Be===Ge.l3?j.push(Be):R.errors.push(new ge.vHH(3002,!1)):j.push(Rt(Be));let me=!1,Oe=null;return j.forEach(Be=>{if(Be instanceof Map&&(Be.has("easing")&&(Oe=Be.get("easing"),Be.delete("easing")),!me))for(let tt of Be.values())if(tt.toString().indexOf("{{")>=0){me=!0;break}}),{type:6,styles:j,easing:Oe,offset:I.offset,containsDynamicStyles:me,options:null}}_validateStyleAst(I,R){const j=R.currentAnimateTimings;let te=R.currentTime,me=R.currentTime;j&&me>0&&(me-=j.duration+j.delay),I.styles.forEach(Oe=>{"string"!=typeof Oe&&Oe.forEach((Be,tt)=>{const vt=R.collectedStyles.get(R.currentQuerySelector),on=vt.get(tt);let gn=!0;on&&(me!=te&&me>=on.startTime&&te<=on.endTime&&(R.errors.push(function Xn(Q,I,R,j,te){return new ge.vHH(3010,!1)}()),gn=!1),me=on.startTime),gn&&vt.set(tt,{startTime:me,endTime:te}),R.options&&function se(Q,I,R){const j=I.params||{},te=oe(Q);te.length&&te.forEach(me=>{j.hasOwnProperty(me)||R.push(function zt(Q){return new ge.vHH(3001,!1)}())})}(Be,R.options,R.errors)})})}visitKeyframes(I,R){const j={type:5,styles:[],options:null};if(!R.currentAnimateTimings)return R.errors.push(function dt(){return new ge.vHH(3011,!1)}()),j;let me=0;const Oe=[];let Be=!1,tt=!1,vt=0;const on=I.steps.map(Tr=>{const gi=this._makeStyleAst(Tr,R);let si=null!=gi.offset?gi.offset:function Jn(Q){if("string"==typeof Q)return null;let I=null;if(Array.isArray(Q))Q.forEach(R=>{if(R instanceof Map&&R.has("offset")){const j=R;I=parseFloat(j.get("offset")),j.delete("offset")}});else if(Q instanceof Map&&Q.has("offset")){const R=Q;I=parseFloat(R.get("offset")),R.delete("offset")}return I}(gi.styles),ai=0;return null!=si&&(me++,ai=gi.offset=si),tt=tt||ai<0||ai>1,Be=Be||ai<vt,vt=ai,Oe.push(ai),gi});tt&&R.errors.push(function yr(){return new ge.vHH(3012,!1)}()),Be&&R.errors.push(function sn(){return new ge.vHH(3200,!1)}());const gn=I.steps.length;let pr=0;me>0&&me<gn?R.errors.push(function Bt(){return new ge.vHH(3202,!1)}()):0==me&&(pr=1/(gn-1));const ur=gn-1,jn=R.currentTime,Kn=R.currentAnimateTimings,mr=Kn.duration;return on.forEach((Tr,gi)=>{const si=pr>0?gi==ur?1:pr*gi:Oe[gi],ai=si*mr;R.currentTime=jn+Kn.delay+ai,Kn.duration=ai,this._validateStyleAst(Tr,R),Tr.offset=si,j.styles.push(Tr)}),j}visitReference(I,R){return{type:8,animation:mn(this,ie(I.animation),R),options:Nr(I.options)}}visitAnimateChild(I,R){return R.depCount++,{type:9,options:Nr(I.options)}}visitAnimateRef(I,R){return{type:10,animation:this.visitReference(I.animation,R),options:Nr(I.options)}}visitQuery(I,R){const j=R.currentQuerySelector,te=I.options||{};R.queryCount++,R.currentQuery=I;const[me,Oe]=function No(Q){const I=!!Q.split(/\s*,\s*/).find(R=>":self"==R);return I&&(Q=Q.replace($t,"")),Q=Q.replace(/@\*/g,xr).replace(/@\w+/g,R=>xr+"-"+R.slice(1)).replace(/:animating/g,Rn),[Q,I]}(I.selector);R.currentQuerySelector=j.length?j+" "+me:me,Pr(R.collectedStyles,R.currentQuerySelector,new Map);const Be=mn(this,ie(I.animation),R);return R.currentQuery=null,R.currentQuerySelector=j,{type:11,selector:me,limit:te.limit||0,optional:!!te.optional,includeSelf:Oe,animation:Be,originalSelector:I.selector,options:Nr(I.options)}}visitStagger(I,R){R.currentQuery||R.errors.push(function je(){return new ge.vHH(3013,!1)}());const j="full"===I.timings?{duration:0,delay:0,easing:"full"}:Je(I.timings,R.errors,!0);return{type:12,animation:mn(this,ie(I.animation),R),timings:j,options:null}}}class pn{constructor(I){this.errors=I,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function Nr(Q){return Q?(Q=Ne(Q)).params&&(Q.params=function $n(Q){return Q?Ne(Q):null}(Q.params)):Q={},Q}function dr(Q,I,R){return{duration:Q,delay:I,easing:R}}function Oi(Q,I,R,j,te,me,Oe=null,Be=!1){return{type:1,element:Q,keyframes:I,preStyleProps:R,postStyleProps:j,duration:te,delay:me,totalTime:te+me,easing:Oe,subTimeline:Be}}class Wr{constructor(){this._map=new Map}get(I){return this._map.get(I)||[]}append(I,R){let j=this._map.get(I);j||this._map.set(I,j=[]),j.push(...R)}has(I){return this._map.has(I)}clear(){this._map.clear()}}const oo=new RegExp(":enter","g"),mo=new RegExp(":leave","g");function lo(Q,I,R,j,te,me=new Map,Oe=new Map,Be,tt,vt=[]){return(new Fi).buildKeyframes(Q,I,R,j,te,me,Oe,Be,tt,vt)}class Fi{buildKeyframes(I,R,j,te,me,Oe,Be,tt,vt,on=[]){vt=vt||new Wr;const gn=new Vr(I,R,vt,te,me,on,[]);gn.options=tt;const pr=tt.delay?Ri(tt.delay):0;gn.currentTimeline.delayNextStep(pr),gn.currentTimeline.setStyles([Oe],null,gn.errors,tt),mn(this,j,gn);const ur=gn.timelines.filter(jn=>jn.containsAnimation());if(ur.length&&Be.size){let jn;for(let Kn=ur.length-1;Kn>=0;Kn--){const mr=ur[Kn];if(mr.element===R){jn=mr;break}}jn&&!jn.allowOnlyTimelineStyles()&&jn.setStyles([Be],null,gn.errors,tt)}return ur.length?ur.map(jn=>jn.buildKeyframes()):[Oi(R,[],[],[],0,pr,"",!1)]}visitTrigger(I,R){}visitState(I,R){}visitTransition(I,R){}visitAnimateChild(I,R){const j=R.subInstructions.get(R.element);if(j){const te=R.createSubContext(I.options),me=R.currentTimeline.currentTime,Oe=this._visitSubInstructions(j,te,te.options);me!=Oe&&R.transformIntoNewTimeline(Oe)}R.previousNode=I}visitAnimateRef(I,R){const j=R.createSubContext(I.options);j.transformIntoNewTimeline(),this._applyAnimationRefDelays([I.options,I.animation.options],R,j),this.visitReference(I.animation,j),R.transformIntoNewTimeline(j.currentTimeline.currentTime),R.previousNode=I}_applyAnimationRefDelays(I,R,j){for(const te of I){const me=te?.delay;if(me){const Oe="number"==typeof me?me:Ri(_e(me,te?.params??{},R.errors));j.delayNextStep(Oe)}}}_visitSubInstructions(I,R,j){let me=R.currentTimeline.currentTime;const Oe=null!=j.duration?Ri(j.duration):null,Be=null!=j.delay?Ri(j.delay):null;return 0!==Oe&&I.forEach(tt=>{const vt=R.appendInstructionToTimeline(tt,Oe,Be);me=Math.max(me,vt.duration+vt.delay)}),me}visitReference(I,R){R.updateOptions(I.options,!0),mn(this,I.animation,R),R.previousNode=I}visitSequence(I,R){const j=R.subContextCount;let te=R;const me=I.options;if(me&&(me.params||me.delay)&&(te=R.createSubContext(me),te.transformIntoNewTimeline(),null!=me.delay)){6==te.previousNode.type&&(te.currentTimeline.snapshotCurrentStyles(),te.previousNode=wo);const Oe=Ri(me.delay);te.delayNextStep(Oe)}I.steps.length&&(I.steps.forEach(Oe=>mn(this,Oe,te)),te.currentTimeline.applyStylesToKeyframe(),te.subContextCount>j&&te.transformIntoNewTimeline()),R.previousNode=I}visitGroup(I,R){const j=[];let te=R.currentTimeline.currentTime;const me=I.options&&I.options.delay?Ri(I.options.delay):0;I.steps.forEach(Oe=>{const Be=R.createSubContext(I.options);me&&Be.delayNextStep(me),mn(this,Oe,Be),te=Math.max(te,Be.currentTimeline.currentTime),j.push(Be.currentTimeline)}),j.forEach(Oe=>R.currentTimeline.mergeTimelineCollectedStyles(Oe)),R.transformIntoNewTimeline(te),R.previousNode=I}_visitTiming(I,R){if(I.dynamic){const j=I.strValue;return Je(R.params?_e(j,R.params,R.errors):j,R.errors)}return{duration:I.duration,delay:I.delay,easing:I.easing}}visitAnimate(I,R){const j=R.currentAnimateTimings=this._visitTiming(I.timings,R),te=R.currentTimeline;j.delay&&(R.incrementTime(j.delay),te.snapshotCurrentStyles());const me=I.style;5==me.type?this.visitKeyframes(me,R):(R.incrementTime(j.duration),this.visitStyle(me,R),te.applyStylesToKeyframe()),R.currentAnimateTimings=null,R.previousNode=I}visitStyle(I,R){const j=R.currentTimeline,te=R.currentAnimateTimings;!te&&j.hasCurrentStyleProperties()&&j.forwardFrame();const me=te&&te.easing||I.easing;I.isEmptyStep?j.applyEmptyStep(me):j.setStyles(I.styles,me,R.errors,R.options),R.previousNode=I}visitKeyframes(I,R){const j=R.currentAnimateTimings,te=R.currentTimeline.duration,me=j.duration,Be=R.createSubContext().currentTimeline;Be.easing=j.easing,I.styles.forEach(tt=>{Be.forwardTime((tt.offset||0)*me),Be.setStyles(tt.styles,tt.easing,R.errors,R.options),Be.applyStylesToKeyframe()}),R.currentTimeline.mergeTimelineCollectedStyles(Be),R.transformIntoNewTimeline(te+me),R.previousNode=I}visitQuery(I,R){const j=R.currentTimeline.currentTime,te=I.options||{},me=te.delay?Ri(te.delay):0;me&&(6===R.previousNode.type||0==j&&R.currentTimeline.hasCurrentStyleProperties())&&(R.currentTimeline.snapshotCurrentStyles(),R.previousNode=wo);let Oe=j;const Be=R.invokeQuery(I.selector,I.originalSelector,I.limit,I.includeSelf,!!te.optional,R.errors);R.currentQueryTotal=Be.length;let tt=null;Be.forEach((vt,on)=>{R.currentQueryIndex=on;const gn=R.createSubContext(I.options,vt);me&&gn.delayNextStep(me),vt===R.element&&(tt=gn.currentTimeline),mn(this,I.animation,gn),gn.currentTimeline.applyStylesToKeyframe(),Oe=Math.max(Oe,gn.currentTimeline.currentTime)}),R.currentQueryIndex=0,R.currentQueryTotal=0,R.transformIntoNewTimeline(Oe),tt&&(R.currentTimeline.mergeTimelineCollectedStyles(tt),R.currentTimeline.snapshotCurrentStyles()),R.previousNode=I}visitStagger(I,R){const j=R.parentContext,te=R.currentTimeline,me=I.timings,Oe=Math.abs(me.duration),Be=Oe*(R.currentQueryTotal-1);let tt=Oe*R.currentQueryIndex;switch(me.duration<0?"reverse":me.easing){case"reverse":tt=Be-tt;break;case"full":tt=j.currentStaggerTime}const on=R.currentTimeline;tt&&on.delayNextStep(tt);const gn=on.currentTime;mn(this,I.animation,R),R.previousNode=I,j.currentStaggerTime=te.currentTime-gn+(te.startTime-j.currentTimeline.startTime)}}const wo={};class Vr{constructor(I,R,j,te,me,Oe,Be,tt){this._driver=I,this.element=R,this.subInstructions=j,this._enterClassName=te,this._leaveClassName=me,this.errors=Oe,this.timelines=Be,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=wo,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=tt||new Hr(this._driver,R,0),Be.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(I,R){if(!I)return;const j=I;let te=this.options;null!=j.duration&&(te.duration=Ri(j.duration)),null!=j.delay&&(te.delay=Ri(j.delay));const me=j.params;if(me){let Oe=te.params;Oe||(Oe=this.options.params={}),Object.keys(me).forEach(Be=>{(!R||!Oe.hasOwnProperty(Be))&&(Oe[Be]=_e(me[Be],Oe,this.errors))})}}_copyOptions(){const I={};if(this.options){const R=this.options.params;if(R){const j=I.params={};Object.keys(R).forEach(te=>{j[te]=R[te]})}}return I}createSubContext(I=null,R,j){const te=R||this.element,me=new Vr(this._driver,te,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(te,j||0));return me.previousNode=this.previousNode,me.currentAnimateTimings=this.currentAnimateTimings,me.options=this._copyOptions(),me.updateOptions(I),me.currentQueryIndex=this.currentQueryIndex,me.currentQueryTotal=this.currentQueryTotal,me.parentContext=this,this.subContextCount++,me}transformIntoNewTimeline(I){return this.previousNode=wo,this.currentTimeline=this.currentTimeline.fork(this.element,I),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(I,R,j){const te={duration:R??I.duration,delay:this.currentTimeline.currentTime+(j??0)+I.delay,easing:""},me=new cs(this._driver,I.element,I.keyframes,I.preStyleProps,I.postStyleProps,te,I.stretchStartingKeyframe);return this.timelines.push(me),te}incrementTime(I){this.currentTimeline.forwardTime(this.currentTimeline.duration+I)}delayNextStep(I){I>0&&this.currentTimeline.delayNextStep(I)}invokeQuery(I,R,j,te,me,Oe){let Be=[];if(te&&Be.push(this.element),I.length>0){I=(I=I.replace(oo,"."+this._enterClassName)).replace(mo,"."+this._leaveClassName);let vt=this._driver.query(this.element,I,1!=j);0!==j&&(vt=j<0?vt.slice(vt.length+j,vt.length):vt.slice(0,j)),Be.push(...vt)}return!me&&0==Be.length&&Oe.push(function Kt(Q){return new ge.vHH(3014,!1)}()),Be}}class Hr{constructor(I,R,j,te){this._driver=I,this.element=R,this.startTime=j,this._elementTimelineStylesLookup=te,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(R),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(R,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(I){const R=1===this._keyframes.size&&this._pendingStyles.size;this.duration||R?(this.forwardTime(this.currentTime+I),R&&this.snapshotCurrentStyles()):this.startTime+=I}fork(I,R){return this.applyStylesToKeyframe(),new Hr(this._driver,I,R||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(I){this.applyStylesToKeyframe(),this.duration=I,this._loadKeyframe()}_updateStyle(I,R){this._localTimelineStyles.set(I,R),this._globalTimelineStyles.set(I,R),this._styleSummary.set(I,{time:this.currentTime,value:R})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(I){I&&this._previousKeyframe.set("easing",I);for(let[R,j]of this._globalTimelineStyles)this._backFill.set(R,j||Ge.l3),this._currentKeyframe.set(R,Ge.l3);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(I,R,j,te){R&&this._previousKeyframe.set("easing",R);const me=te&&te.params||{},Oe=function ji(Q,I){const R=new Map;let j;return Q.forEach(te=>{if("*"===te){j=j||I.keys();for(let me of j)R.set(me,Ge.l3)}else ce(te,R)}),R}(I,this._globalTimelineStyles);for(let[Be,tt]of Oe){const vt=_e(tt,me,j);this._pendingStyles.set(Be,vt),this._localTimelineStyles.has(Be)||this._backFill.set(Be,this._globalTimelineStyles.get(Be)??Ge.l3),this._updateStyle(Be,vt)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((I,R)=>{this._currentKeyframe.set(R,I)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((I,R)=>{this._currentKeyframe.has(R)||this._currentKeyframe.set(R,I)}))}snapshotCurrentStyles(){for(let[I,R]of this._localTimelineStyles)this._pendingStyles.set(I,R),this._updateStyle(I,R)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const I=[];for(let R in this._currentKeyframe)I.push(R);return I}mergeTimelineCollectedStyles(I){I._styleSummary.forEach((R,j)=>{const te=this._styleSummary.get(j);(!te||R.time>te.time)&&this._updateStyle(j,R.value)})}buildKeyframes(){this.applyStylesToKeyframe();const I=new Set,R=new Set,j=1===this._keyframes.size&&0===this.duration;let te=[];this._keyframes.forEach((Be,tt)=>{const vt=ce(Be,new Map,this._backFill);vt.forEach((on,gn)=>{on===Ge.k1?I.add(gn):on===Ge.l3&&R.add(gn)}),j||vt.set("offset",tt/this.duration),te.push(vt)});const me=I.size?Ue(I.values()):[],Oe=R.size?Ue(R.values()):[];if(j){const Be=te[0],tt=new Map(Be);Be.set("offset",0),tt.set("offset",1),te=[Be,tt]}return Oi(this.element,te,me,Oe,this.duration,this.startTime,this.easing,!1)}}class cs extends Hr{constructor(I,R,j,te,me,Oe,Be=!1){super(I,R,Oe.delay),this.keyframes=j,this.preStyleProps=te,this.postStyleProps=me,this._stretchStartingKeyframe=Be,this.timings={duration:Oe.duration,delay:Oe.delay,easing:Oe.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let I=this.keyframes,{delay:R,duration:j,easing:te}=this.timings;if(this._stretchStartingKeyframe&&R){const me=[],Oe=j+R,Be=R/Oe,tt=ce(I[0]);tt.set("offset",0),me.push(tt);const vt=ce(I[0]);vt.set("offset",Ti(Be)),me.push(vt);const on=I.length-1;for(let gn=1;gn<=on;gn++){let pr=ce(I[gn]);const ur=pr.get("offset");pr.set("offset",Ti((R+ur*j)/Oe)),me.push(pr)}j=Oe,R=0,te="",I=me}return Oi(this.element,I,this.preStyleProps,this.postStyleProps,j,R,te,!0)}}function Ti(Q,I=3){const R=Math.pow(10,I-1);return Math.round(Q*R)/R}class Zr{}const wi=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class Ws extends Zr{normalizePropertyName(I,R){return lt(I)}normalizeStyleValue(I,R,j,te){let me="";const Oe=j.toString().trim();if(wi.has(R)&&0!==j&&"0"!==j)if("number"==typeof j)me="px";else{const Be=j.match(/^[+-]?[\d\.]+([a-z]*)$/);Be&&0==Be[1].length&&te.push(function mt(Q,I){return new ge.vHH(3005,!1)}())}return Oe+me}}function As(Q,I,R,j,te,me,Oe,Be,tt,vt,on,gn,pr){return{type:0,element:Q,triggerName:I,isRemovalTransition:te,fromState:R,fromStyles:me,toState:j,toStyles:Oe,timelines:Be,queriedElements:tt,preStyleProps:vt,postStyleProps:on,totalTime:gn,errors:pr}}const Uo={};class pi{constructor(I,R,j){this._triggerName=I,this.ast=R,this._stateStyles=j}match(I,R,j,te){return function la(Q,I,R,j,te){return Q.some(me=>me(I,R,j,te))}(this.ast.matchers,I,R,j,te)}buildStyles(I,R,j){let te=this._stateStyles.get("*");return void 0!==I&&(te=this._stateStyles.get(I?.toString())||te),te?te.buildStyles(R,j):new Map}build(I,R,j,te,me,Oe,Be,tt,vt,on){const gn=[],pr=this.ast.options&&this.ast.options.params||Uo,jn=this.buildStyles(j,Be&&Be.params||Uo,gn),Kn=tt&&tt.params||Uo,mr=this.buildStyles(te,Kn,gn),Tr=new Set,gi=new Map,si=new Map,ai="void"===te,ho={params:Di(Kn,pr),delay:this.ast.options?.delay},eo=on?[]:lo(I,R,this.ast.animation,me,Oe,jn,mr,ho,vt,gn);let Cn=0;if(eo.forEach(Gr=>{Cn=Math.max(Gr.duration+Gr.delay,Cn)}),gn.length)return As(R,this._triggerName,j,te,ai,jn,mr,[],[],gi,si,Cn,gn);eo.forEach(Gr=>{const F=Gr.element,K=Pr(gi,F,new Set);Gr.preStyleProps.forEach(ae=>K.add(ae));const U=Pr(si,F,new Set);Gr.postStyleProps.forEach(ae=>U.add(ae)),F!==R&&Tr.add(F)});const to=Ue(Tr.values());return As(R,this._triggerName,j,te,ai,jn,mr,eo,to,gi,si,Cn)}}function Di(Q,I){const R=Ne(I);for(const j in Q)Q.hasOwnProperty(j)&&null!=Q[j]&&(R[j]=Q[j]);return R}class uo{constructor(I,R,j){this.styles=I,this.defaultParams=R,this.normalizer=j}buildStyles(I,R){const j=new Map,te=Ne(this.defaultParams);return Object.keys(I).forEach(me=>{const Oe=I[me];null!==Oe&&(te[me]=Oe)}),this.styles.styles.forEach(me=>{"string"!=typeof me&&me.forEach((Oe,Be)=>{Oe&&(Oe=_e(Oe,te,R));const tt=this.normalizer.normalizePropertyName(Be,R);Oe=this.normalizer.normalizeStyleValue(Be,tt,Oe,R),j.set(Be,Oe)})}),j}}class us{constructor(I,R,j){this.name=I,this.ast=R,this._normalizer=j,this.transitionFactories=[],this.states=new Map,R.states.forEach(te=>{this.states.set(te.name,new uo(te.style,te.options&&te.options.params||{},j))}),ni(this.states,"true","1"),ni(this.states,"false","0"),R.transitions.forEach(te=>{this.transitionFactories.push(new pi(I,te,this.states))}),this.fallbackTransition=function hs(Q,I,R){return new pi(Q,{type:1,animation:{type:2,steps:[],options:null},matchers:[(Oe,Be)=>!0],options:null,queryCount:0,depCount:0},I)}(I,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(I,R,j,te){return this.transitionFactories.find(Oe=>Oe.match(I,R,j,te))||null}matchStyles(I,R,j){return this.fallbackTransition.buildStyles(I,R,j)}}function ni(Q,I,R){Q.has(I)?Q.has(R)||Q.set(R,Q.get(I)):Q.has(R)&&Q.set(I,Q.get(R))}const Rs=new Wr;class ks{constructor(I,R,j){this.bodyNode=I,this._driver=R,this._normalizer=j,this._animations=new Map,this._playersById=new Map,this.players=[]}register(I,R){const j=[],te=[],me=kn(this._driver,R,j,te);if(j.length)throw function vn(Q){return new ge.vHH(3503,!1)}();this._animations.set(I,me)}_buildPlayer(I,R,j){const te=I.element,me=cr(0,this._normalizer,0,I.keyframes,R,j);return this._driver.animate(te,me,I.duration,I.delay,I.easing,[],!0)}create(I,R,j={}){const te=[],me=this._animations.get(I);let Oe;const Be=new Map;if(me?(Oe=lo(this._driver,R,me,$r,jr,new Map,new Map,j,Rs,te),Oe.forEach(on=>{const gn=Pr(Be,on.element,new Map);on.postStyleProps.forEach(pr=>gn.set(pr,null))})):(te.push(function dn(){return new ge.vHH(3300,!1)}()),Oe=[]),te.length)throw function ot(Q){return new ge.vHH(3504,!1)}();Be.forEach((on,gn)=>{on.forEach((pr,ur)=>{on.set(ur,this._driver.computeStyle(gn,ur,Ge.l3))})});const vt=zn(Oe.map(on=>{const gn=Be.get(on.element);return this._buildPlayer(on,new Map,gn)}));return this._playersById.set(I,vt),vt.onDestroy(()=>this.destroy(I)),this.players.push(vt),vt}destroy(I){const R=this._getPlayer(I);R.destroy(),this._playersById.delete(I);const j=this.players.indexOf(R);j>=0&&this.players.splice(j,1)}_getPlayer(I){const R=this._playersById.get(I);if(!R)throw function $e(Q){return new ge.vHH(3301,!1)}();return R}listen(I,R,j,te){const me=Kr(R,"","","");return Ar(this._getPlayer(I),j,me,te),()=>{}}command(I,R,j,te){if("register"==j)return void this.register(I,te[0]);if("create"==j)return void this.create(I,R,te[0]||{});const me=this._getPlayer(I);switch(j){case"play":me.play();break;case"pause":me.pause();break;case"reset":me.reset();break;case"restart":me.restart();break;case"finish":me.finish();break;case"init":me.init();break;case"setPosition":me.setPosition(parseFloat(te[0]));break;case"destroy":this.destroy(I)}}}const Ko="ng-animate-queued",ds="ng-animate-disabled",Ka=[],Sa={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},Na={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},bo="__ng_removed";class ca{get params(){return this.options.params}constructor(I,R=""){this.namespaceId=R;const j=I&&I.hasOwnProperty("value");if(this.value=function Zs(Q){return Q??null}(j?I.value:I),j){const me=Ne(I);delete me.value,this.options=me}else this.options={};this.options.params||(this.options.params={})}absorbOptions(I){const R=I.params;if(R){const j=this.options.params;Object.keys(R).forEach(te=>{null==j[te]&&(j[te]=R[te])})}}}const Os="void",jo=new ca(Os);class Ya{constructor(I,R,j){this.id=I,this.hostElement=R,this._engine=j,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+I,Vi(R,this._hostClassName)}listen(I,R,j,te){if(!this._triggers.has(R))throw function yt(Q,I){return new ge.vHH(3302,!1)}();if(null==j||0==j.length)throw function At(Q){return new ge.vHH(3303,!1)}();if(!function Vo(Q){return"start"==Q||"done"==Q}(j))throw function Yt(Q,I){return new ge.vHH(3400,!1)}();const me=Pr(this._elementListeners,I,[]),Oe={name:R,phase:j,callback:te};me.push(Oe);const Be=Pr(this._engine.statesByElement,I,new Map);return Be.has(R)||(Vi(I,Bo),Vi(I,Bo+"-"+R),Be.set(R,jo)),()=>{this._engine.afterFlush(()=>{const tt=me.indexOf(Oe);tt>=0&&me.splice(tt,1),this._triggers.has(R)||Be.delete(R)})}}register(I,R){return!this._triggers.has(I)&&(this._triggers.set(I,R),!0)}_getTrigger(I){const R=this._triggers.get(I);if(!R)throw function Dt(Q){return new ge.vHH(3401,!1)}();return R}trigger(I,R,j,te=!0){const me=this._getTrigger(R),Oe=new Yo(this.id,R,I);let Be=this._engine.statesByElement.get(I);Be||(Vi(I,Bo),Vi(I,Bo+"-"+R),this._engine.statesByElement.set(I,Be=new Map));let tt=Be.get(R);const vt=new ca(j,this.id);if(!(j&&j.hasOwnProperty("value"))&&tt&&vt.absorbOptions(tt.options),Be.set(R,vt),tt||(tt=jo),vt.value!==Os&&tt.value===vt.value){if(!function fs(Q,I){const R=Object.keys(Q),j=Object.keys(I);if(R.length!=j.length)return!1;for(let te=0;te<R.length;te++){const me=R[te];if(!I.hasOwnProperty(me)||Q[me]!==I[me])return!1}return!0}(tt.params,vt.params)){const Kn=[],mr=me.matchStyles(tt.value,tt.params,Kn),Tr=me.matchStyles(vt.value,vt.params,Kn);Kn.length?this._engine.reportError(Kn):this._engine.afterFlush(()=>{Ee(I,mr),de(I,Tr)})}return}const pr=Pr(this._engine.playersByElement,I,[]);pr.forEach(Kn=>{Kn.namespaceId==this.id&&Kn.triggerName==R&&Kn.queued&&Kn.destroy()});let ur=me.matchTransition(tt.value,vt.value,I,vt.params),jn=!1;if(!ur){if(!te)return;ur=me.fallbackTransition,jn=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:I,triggerName:R,transition:ur,fromState:tt,toState:vt,player:Oe,isFallbackTransition:jn}),jn||(Vi(I,Ko),Oe.onStart(()=>{Qo(I,Ko)})),Oe.onDone(()=>{let Kn=this.players.indexOf(Oe);Kn>=0&&this.players.splice(Kn,1);const mr=this._engine.playersByElement.get(I);if(mr){let Tr=mr.indexOf(Oe);Tr>=0&&mr.splice(Tr,1)}}),this.players.push(Oe),pr.push(Oe),Oe}deregister(I){this._triggers.delete(I),this._engine.statesByElement.forEach(R=>R.delete(I)),this._elementListeners.forEach((R,j)=>{this._elementListeners.set(j,R.filter(te=>te.name!=I))})}clearElementCache(I){this._engine.statesByElement.delete(I),this._elementListeners.delete(I);const R=this._engine.playersByElement.get(I);R&&(R.forEach(j=>j.destroy()),this._engine.playersByElement.delete(I))}_signalRemovalForInnerTriggers(I,R){const j=this._engine.driver.query(I,xr,!0);j.forEach(te=>{if(te[bo])return;const me=this._engine.fetchNamespacesByElement(te);me.size?me.forEach(Oe=>Oe.triggerLeaveAnimation(te,R,!1,!0)):this.clearElementCache(te)}),this._engine.afterFlushAnimationsDone(()=>j.forEach(te=>this.clearElementCache(te)))}triggerLeaveAnimation(I,R,j,te){const me=this._engine.statesByElement.get(I),Oe=new Map;if(me){const Be=[];if(me.forEach((tt,vt)=>{if(Oe.set(vt,tt.value),this._triggers.has(vt)){const on=this.trigger(I,vt,Os,te);on&&Be.push(on)}}),Be.length)return this._engine.markElementAsRemoved(this.id,I,!0,R,Oe),j&&zn(Be).onDone(()=>this._engine.processLeaveNode(I)),!0}return!1}prepareLeaveAnimationListeners(I){const R=this._elementListeners.get(I),j=this._engine.statesByElement.get(I);if(R&&j){const te=new Set;R.forEach(me=>{const Oe=me.name;if(te.has(Oe))return;te.add(Oe);const tt=this._triggers.get(Oe).fallbackTransition,vt=j.get(Oe)||jo,on=new ca(Os),gn=new Yo(this.id,Oe,I);this._engine.totalQueuedPlayers++,this._queue.push({element:I,triggerName:Oe,transition:tt,fromState:vt,toState:on,player:gn,isFallbackTransition:!0})})}}removeNode(I,R){const j=this._engine;if(I.childElementCount&&this._signalRemovalForInnerTriggers(I,R),this.triggerLeaveAnimation(I,R,!0))return;let te=!1;if(j.totalAnimations){const me=j.players.length?j.playersByQueriedElement.get(I):[];if(me&&me.length)te=!0;else{let Oe=I;for(;Oe=Oe.parentNode;)if(j.statesByElement.get(Oe)){te=!0;break}}}if(this.prepareLeaveAnimationListeners(I),te)j.markElementAsRemoved(this.id,I,!1,R);else{const me=I[bo];(!me||me===Sa)&&(j.afterFlush(()=>this.clearElementCache(I)),j.destroyInnerAnimations(I),j._onRemovalComplete(I,R))}}insertNode(I,R){Vi(I,this._hostClassName)}drainQueuedTransitions(I){const R=[];return this._queue.forEach(j=>{const te=j.player;if(te.destroyed)return;const me=j.element,Oe=this._elementListeners.get(me);Oe&&Oe.forEach(Be=>{if(Be.name==j.triggerName){const tt=Kr(me,j.triggerName,j.fromState.value,j.toState.value);tt._data=I,Ar(j.player,Be.phase,tt,Be.callback)}}),te.markedForDestroy?this._engine.afterFlush(()=>{te.destroy()}):R.push(j)}),this._queue=[],R.sort((j,te)=>{const me=j.transition.ast.depCount,Oe=te.transition.ast.depCount;return 0==me||0==Oe?me-Oe:this._engine.driver.containsElement(j.element,te.element)?1:-1})}destroy(I){this.players.forEach(R=>R.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,I)}elementContainsData(I){let R=!1;return this._elementListeners.has(I)&&(R=!0),R=!!this._queue.find(j=>j.element===I)||R,R}}class ua{_onRemovalComplete(I,R){this.onRemovalComplete(I,R)}constructor(I,R,j){this.bodyNode=I,this.driver=R,this._normalizer=j,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(te,me)=>{}}get queuedPlayers(){const I=[];return this._namespaceList.forEach(R=>{R.players.forEach(j=>{j.queued&&I.push(j)})}),I}createNamespace(I,R){const j=new Ya(I,R,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,R)?this._balanceNamespaceList(j,R):(this.newHostElements.set(R,j),this.collectEnterElement(R)),this._namespaceLookup[I]=j}_balanceNamespaceList(I,R){const j=this._namespaceList,te=this.namespacesByHostElement;if(j.length-1>=0){let Oe=!1,Be=this.driver.getParentElement(R);for(;Be;){const tt=te.get(Be);if(tt){const vt=j.indexOf(tt);j.splice(vt+1,0,I),Oe=!0;break}Be=this.driver.getParentElement(Be)}Oe||j.unshift(I)}else j.push(I);return te.set(R,I),I}register(I,R){let j=this._namespaceLookup[I];return j||(j=this.createNamespace(I,R)),j}registerTrigger(I,R,j){let te=this._namespaceLookup[I];te&&te.register(R,j)&&this.totalAnimations++}destroy(I,R){if(!I)return;const j=this._fetchNamespace(I);this.afterFlush(()=>{this.namespacesByHostElement.delete(j.hostElement),delete this._namespaceLookup[I];const te=this._namespaceList.indexOf(j);te>=0&&this._namespaceList.splice(te,1)}),this.afterFlushAnimationsDone(()=>j.destroy(R))}_fetchNamespace(I){return this._namespaceLookup[I]}fetchNamespacesByElement(I){const R=new Set,j=this.statesByElement.get(I);if(j)for(let te of j.values())if(te.namespaceId){const me=this._fetchNamespace(te.namespaceId);me&&R.add(me)}return R}trigger(I,R,j,te){if(gr(R)){const me=this._fetchNamespace(I);if(me)return me.trigger(R,j,te),!0}return!1}insertNode(I,R,j,te){if(!gr(R))return;const me=R[bo];if(me&&me.setForRemoval){me.setForRemoval=!1,me.setForMove=!0;const Oe=this.collectedLeaveElements.indexOf(R);Oe>=0&&this.collectedLeaveElements.splice(Oe,1)}if(I){const Oe=this._fetchNamespace(I);Oe&&Oe.insertNode(R,j)}te&&this.collectEnterElement(R)}collectEnterElement(I){this.collectedEnterElements.push(I)}markElementAsDisabled(I,R){R?this.disabledNodes.has(I)||(this.disabledNodes.add(I),Vi(I,ds)):this.disabledNodes.has(I)&&(this.disabledNodes.delete(I),Qo(I,ds))}removeNode(I,R,j,te){if(gr(R)){const me=I?this._fetchNamespace(I):null;if(me?me.removeNode(R,te):this.markElementAsRemoved(I,R,!1,te),j){const Oe=this.namespacesByHostElement.get(R);Oe&&Oe.id!==I&&Oe.removeNode(R,te)}}else this._onRemovalComplete(R,te)}markElementAsRemoved(I,R,j,te,me){this.collectedLeaveElements.push(R),R[bo]={namespaceId:I,setForRemoval:te,hasAnimation:j,removedBeforeQueried:!1,previousTriggersValues:me}}listen(I,R,j,te,me){return gr(R)?this._fetchNamespace(I).listen(R,j,te,me):()=>{}}_buildInstruction(I,R,j,te,me){return I.transition.build(this.driver,I.element,I.fromState.value,I.toState.value,j,te,I.fromState.options,I.toState.options,R,me)}destroyInnerAnimations(I){let R=this.driver.query(I,xr,!0);R.forEach(j=>this.destroyActiveAnimationsForElement(j)),0!=this.playersByQueriedElement.size&&(R=this.driver.query(I,Rn,!0),R.forEach(j=>this.finishActiveQueriedAnimationOnElement(j)))}destroyActiveAnimationsForElement(I){const R=this.playersByElement.get(I);R&&R.forEach(j=>{j.queued?j.markedForDestroy=!0:j.destroy()})}finishActiveQueriedAnimationOnElement(I){const R=this.playersByQueriedElement.get(I);R&&R.forEach(j=>j.finish())}whenRenderingDone(){return new Promise(I=>{if(this.players.length)return zn(this.players).onDone(()=>I());I()})}processLeaveNode(I){const R=I[bo];if(R&&R.setForRemoval){if(I[bo]=Sa,R.namespaceId){this.destroyInnerAnimations(I);const j=this._fetchNamespace(R.namespaceId);j&&j.clearElementCache(I)}this._onRemovalComplete(I,R.setForRemoval)}I.classList?.contains(ds)&&this.markElementAsDisabled(I,!1),this.driver.query(I,".ng-animate-disabled",!0).forEach(j=>{this.markElementAsDisabled(j,!1)})}flush(I=-1){let R=[];if(this.newHostElements.size&&(this.newHostElements.forEach((j,te)=>this._balanceNamespaceList(j,te)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let j=0;j<this.collectedEnterElements.length;j++)Vi(this.collectedEnterElements[j],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const j=[];try{R=this._flushAnimations(j,I)}finally{for(let te=0;te<j.length;te++)j[te]()}}else for(let j=0;j<this.collectedLeaveElements.length;j++)this.processLeaveNode(this.collectedLeaveElements[j]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(j=>j()),this._flushFns=[],this._whenQuietFns.length){const j=this._whenQuietFns;this._whenQuietFns=[],R.length?zn(R).onDone(()=>{j.forEach(te=>te())}):j.forEach(te=>te())}}reportError(I){throw function an(Q){return new ge.vHH(3402,!1)}()}_flushAnimations(I,R){const j=new Wr,te=[],me=new Map,Oe=[],Be=new Map,tt=new Map,vt=new Map,on=new Set;this.disabledNodes.forEach(P=>{on.add(P);const $=this.driver.query(P,".ng-animate-queued",!0);for(let pe=0;pe<$.length;pe++)on.add($[pe])});const gn=this.bodyNode,pr=Array.from(this.statesByElement.keys()),ur=Jo(pr,this.collectedEnterElements),jn=new Map;let Kn=0;ur.forEach((P,$)=>{const pe=$r+Kn++;jn.set($,pe),P.forEach(We=>Vi(We,pe))});const mr=[],Tr=new Set,gi=new Set;for(let P=0;P<this.collectedLeaveElements.length;P++){const $=this.collectedLeaveElements[P],pe=$[bo];pe&&pe.setForRemoval&&(mr.push($),Tr.add($),pe.hasAnimation?this.driver.query($,".ng-star-inserted",!0).forEach(We=>Tr.add(We)):gi.add($))}const si=new Map,ai=Jo(pr,Array.from(Tr));ai.forEach((P,$)=>{const pe=jr+Kn++;si.set($,pe),P.forEach(We=>Vi(We,pe))}),I.push(()=>{ur.forEach((P,$)=>{const pe=jn.get($);P.forEach(We=>Qo(We,pe))}),ai.forEach((P,$)=>{const pe=si.get($);P.forEach(We=>Qo(We,pe))}),mr.forEach(P=>{this.processLeaveNode(P)})});const ho=[],eo=[];for(let P=this._namespaceList.length-1;P>=0;P--)this._namespaceList[P].drainQueuedTransitions(R).forEach(pe=>{const We=pe.player,Ot=pe.element;if(ho.push(We),this.collectedEnterElements.length){const Ci=Ot[bo];if(Ci&&Ci.setForMove){if(Ci.previousTriggersValues&&Ci.previousTriggersValues.has(pe.triggerName)){const ao=Ci.previousTriggersValues.get(pe.triggerName),Ki=this.statesByElement.get(pe.element);if(Ki&&Ki.has(pe.triggerName)){const Pa=Ki.get(pe.triggerName);Pa.value=ao,Ki.set(pe.triggerName,Pa)}}return void We.destroy()}}const _n=!gn||!this.driver.containsElement(gn,Ot),qn=si.get(Ot),Bn=jn.get(Ot),_t=this._buildInstruction(pe,j,Bn,qn,_n);if(_t.errors&&_t.errors.length)return void eo.push(_t);if(_n)return We.onStart(()=>Ee(Ot,_t.fromStyles)),We.onDestroy(()=>de(Ot,_t.toStyles)),void te.push(We);if(pe.isFallbackTransition)return We.onStart(()=>Ee(Ot,_t.fromStyles)),We.onDestroy(()=>de(Ot,_t.toStyles)),void te.push(We);const zi=[];_t.timelines.forEach(Ci=>{Ci.stretchStartingKeyframe=!0,this.disabledNodes.has(Ci.element)||zi.push(Ci)}),_t.timelines=zi,j.append(Ot,_t.timelines),Oe.push({instruction:_t,player:We,element:Ot}),_t.queriedElements.forEach(Ci=>Pr(Be,Ci,[]).push(We)),_t.preStyleProps.forEach((Ci,ao)=>{if(Ci.size){let Ki=tt.get(ao);Ki||tt.set(ao,Ki=new Set),Ci.forEach((Pa,_a)=>Ki.add(_a))}}),_t.postStyleProps.forEach((Ci,ao)=>{let Ki=vt.get(ao);Ki||vt.set(ao,Ki=new Set),Ci.forEach((Pa,_a)=>Ki.add(_a))})});if(eo.length){const P=[];eo.forEach($=>{P.push(function vr(Q,I){return new ge.vHH(3505,!1)}())}),ho.forEach($=>$.destroy()),this.reportError(P)}const Cn=new Map,to=new Map;Oe.forEach(P=>{const $=P.element;j.has($)&&(to.set($,$),this._beforeAnimationBuild(P.player.namespaceId,P.instruction,Cn))}),te.forEach(P=>{const $=P.element;this._getPreviousPlayers($,!1,P.namespaceId,P.triggerName,null).forEach(We=>{Pr(Cn,$,[]).push(We),We.destroy()})});const Gr=mr.filter(P=>Ns(P,tt,vt)),F=new Map;Io(F,this.driver,gi,vt,Ge.l3).forEach(P=>{Ns(P,tt,vt)&&Gr.push(P)});const U=new Map;ur.forEach((P,$)=>{Io(U,this.driver,new Set(P),tt,Ge.k1)}),Gr.forEach(P=>{const $=F.get(P),pe=U.get(P);F.set(P,new Map([...Array.from($?.entries()??[]),...Array.from(pe?.entries()??[])]))});const ae=[],Se=[],A={};Oe.forEach(P=>{const{element:$,player:pe,instruction:We}=P;if(j.has($)){if(on.has($))return pe.onDestroy(()=>de($,We.toStyles)),pe.disabled=!0,pe.overrideTotalTime(We.totalTime),void te.push(pe);let Ot=A;if(to.size>1){let qn=$;const Bn=[];for(;qn=qn.parentNode;){const _t=to.get(qn);if(_t){Ot=_t;break}Bn.push(qn)}Bn.forEach(_t=>to.set(_t,Ot))}const _n=this._buildAnimation(pe.namespaceId,We,Cn,me,U,F);if(pe.setRealPlayer(_n),Ot===A)ae.push(pe);else{const qn=this.playersByElement.get(Ot);qn&&qn.length&&(pe.parentPlayer=zn(qn)),te.push(pe)}}else Ee($,We.fromStyles),pe.onDestroy(()=>de($,We.toStyles)),Se.push(pe),on.has($)&&te.push(pe)}),Se.forEach(P=>{const $=me.get(P.element);if($&&$.length){const pe=zn($);P.setRealPlayer(pe)}}),te.forEach(P=>{P.parentPlayer?P.syncPlayerEvents(P.parentPlayer):P.destroy()});for(let P=0;P<mr.length;P++){const $=mr[P],pe=$[bo];if(Qo($,jr),pe&&pe.hasAnimation)continue;let We=[];if(Be.size){let _n=Be.get($);_n&&_n.length&&We.push(..._n);let qn=this.driver.query($,Rn,!0);for(let Bn=0;Bn<qn.length;Bn++){let _t=Be.get(qn[Bn]);_t&&_t.length&&We.push(..._t)}}const Ot=We.filter(_n=>!_n.destroyed);Ot.length?zs(this,$,Ot):this.processLeaveNode($)}return mr.length=0,ae.forEach(P=>{this.players.push(P),P.onDone(()=>{P.destroy();const $=this.players.indexOf(P);this.players.splice($,1)}),P.play()}),ae}elementContainsData(I,R){let j=!1;const te=R[bo];return te&&te.setForRemoval&&(j=!0),this.playersByElement.has(R)&&(j=!0),this.playersByQueriedElement.has(R)&&(j=!0),this.statesByElement.has(R)&&(j=!0),this._fetchNamespace(I).elementContainsData(R)||j}afterFlush(I){this._flushFns.push(I)}afterFlushAnimationsDone(I){this._whenQuietFns.push(I)}_getPreviousPlayers(I,R,j,te,me){let Oe=[];if(R){const Be=this.playersByQueriedElement.get(I);Be&&(Oe=Be)}else{const Be=this.playersByElement.get(I);if(Be){const tt=!me||me==Os;Be.forEach(vt=>{vt.queued||!tt&&vt.triggerName!=te||Oe.push(vt)})}}return(j||te)&&(Oe=Oe.filter(Be=>!(j&&j!=Be.namespaceId||te&&te!=Be.triggerName))),Oe}_beforeAnimationBuild(I,R,j){const me=R.element,Oe=R.isRemovalTransition?void 0:I,Be=R.isRemovalTransition?void 0:R.triggerName;for(const tt of R.timelines){const vt=tt.element,on=vt!==me,gn=Pr(j,vt,[]);this._getPreviousPlayers(vt,on,Oe,Be,R.toState).forEach(ur=>{const jn=ur.getRealPlayer();jn.beforeDestroy&&jn.beforeDestroy(),ur.destroy(),gn.push(ur)})}Ee(me,R.fromStyles)}_buildAnimation(I,R,j,te,me,Oe){const Be=R.triggerName,tt=R.element,vt=[],on=new Set,gn=new Set,pr=R.timelines.map(jn=>{const Kn=jn.element;on.add(Kn);const mr=Kn[bo];if(mr&&mr.removedBeforeQueried)return new Ge.ZN(jn.duration,jn.delay);const Tr=Kn!==tt,gi=function Bs(Q){const I=[];return Ts(Q,I),I}((j.get(Kn)||Ka).map(Cn=>Cn.getRealPlayer())).filter(Cn=>!!Cn.element&&Cn.element===Kn),si=me.get(Kn),ai=Oe.get(Kn),ho=cr(0,this._normalizer,0,jn.keyframes,si,ai),eo=this._buildPlayer(jn,ho,gi);if(jn.subTimeline&&te&&gn.add(Kn),Tr){const Cn=new Yo(I,Be,Kn);Cn.setRealPlayer(eo),vt.push(Cn)}return eo});vt.forEach(jn=>{Pr(this.playersByQueriedElement,jn.element,[]).push(jn),jn.onDone(()=>function Fs(Q,I,R){let j=Q.get(I);if(j){if(j.length){const te=j.indexOf(R);j.splice(te,1)}0==j.length&&Q.delete(I)}return j}(this.playersByQueriedElement,jn.element,jn))}),on.forEach(jn=>Vi(jn,Ui));const ur=zn(pr);return ur.onDestroy(()=>{on.forEach(jn=>Qo(jn,Ui)),de(tt,R.toStyles)}),gn.forEach(jn=>{Pr(te,jn,[]).push(ur)}),ur}_buildPlayer(I,R,j){return R.length>0?this.driver.animate(I.element,R,I.duration,I.delay,I.easing,j):new Ge.ZN(I.duration,I.delay)}}class Yo{constructor(I,R,j){this.namespaceId=I,this.triggerName=R,this.element=j,this._player=new Ge.ZN,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(I){this._containsRealPlayer||(this._player=I,this._queuedCallbacks.forEach((R,j)=>{R.forEach(te=>Ar(I,j,void 0,te))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(I.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(I){this.totalTime=I}syncPlayerEvents(I){const R=this._player;R.triggerCallback&&I.onStart(()=>R.triggerCallback("start")),I.onDone(()=>this.finish()),I.onDestroy(()=>this.destroy())}_queueEvent(I,R){Pr(this._queuedCallbacks,I,[]).push(R)}onDone(I){this.queued&&this._queueEvent("done",I),this._player.onDone(I)}onStart(I){this.queued&&this._queueEvent("start",I),this._player.onStart(I)}onDestroy(I){this.queued&&this._queueEvent("destroy",I),this._player.onDestroy(I)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(I){this.queued||this._player.setPosition(I)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(I){const R=this._player;R.triggerCallback&&R.triggerCallback(I)}}function gr(Q){return Q&&1===Q.nodeType}function Xs(Q,I){const R=Q.style.display;return Q.style.display=I??"none",R}function Io(Q,I,R,j,te){const me=[];R.forEach(tt=>me.push(Xs(tt)));const Oe=[];j.forEach((tt,vt)=>{const on=new Map;tt.forEach(gn=>{const pr=I.computeStyle(vt,gn,te);on.set(gn,pr),(!pr||0==pr.length)&&(vt[bo]=Na,Oe.push(vt))}),Q.set(vt,on)});let Be=0;return R.forEach(tt=>Xs(tt,me[Be++])),Oe}function Jo(Q,I){const R=new Map;if(Q.forEach(Be=>R.set(Be,[])),0==I.length)return R;const j=1,te=new Set(I),me=new Map;function Oe(Be){if(!Be)return j;let tt=me.get(Be);if(tt)return tt;const vt=Be.parentNode;return tt=R.has(vt)?vt:te.has(vt)?j:Oe(vt),me.set(Be,tt),tt}return I.forEach(Be=>{const tt=Oe(Be);tt!==j&&R.get(tt).push(Be)}),R}function Vi(Q,I){Q.classList?.add(I)}function Qo(Q,I){Q.classList?.remove(I)}function zs(Q,I,R){zn(R).onDone(()=>Q.processLeaveNode(I))}function Ts(Q,I){for(let R=0;R<Q.length;R++){const j=Q[R];j instanceof Ge.ZE?Ts(j.players,I):I.push(j)}}function Ns(Q,I,R){const j=R.get(Q);if(!j)return!1;let te=I.get(Q);return te?j.forEach(me=>te.add(me)):I.set(Q,j),R.delete(Q),!0}class so{constructor(I,R,j){this.bodyNode=I,this._driver=R,this._normalizer=j,this._triggerCache={},this.onRemovalComplete=(te,me)=>{},this._transitionEngine=new ua(I,R,j),this._timelineEngine=new ks(I,R,j),this._transitionEngine.onRemovalComplete=(te,me)=>this.onRemovalComplete(te,me)}registerTrigger(I,R,j,te,me){const Oe=I+"-"+te;let Be=this._triggerCache[Oe];if(!Be){const tt=[],vt=[],on=kn(this._driver,me,tt,vt);if(tt.length)throw function ft(Q,I){return new ge.vHH(3404,!1)}();Be=function Ps(Q,I,R){return new us(Q,I,R)}(te,on,this._normalizer),this._triggerCache[Oe]=Be}this._transitionEngine.registerTrigger(R,te,Be)}register(I,R){this._transitionEngine.register(I,R)}destroy(I,R){this._transitionEngine.destroy(I,R)}onInsert(I,R,j,te){this._transitionEngine.insertNode(I,R,j,te)}onRemove(I,R,j,te){this._transitionEngine.removeNode(I,R,te||!1,j)}disableAnimations(I,R){this._transitionEngine.markElementAsDisabled(I,R)}process(I,R,j,te){if("@"==j.charAt(0)){const[me,Oe]=Zo(j);this._timelineEngine.command(me,R,Oe,te)}else this._transitionEngine.trigger(I,R,j,te)}listen(I,R,j,te,me){if("@"==j.charAt(0)){const[Oe,Be]=Zo(j);return this._timelineEngine.listen(Oe,R,Be,me)}return this._transitionEngine.listen(I,R,j,te,me)}flush(I=-1){this._transitionEngine.flush(I)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let fr=(()=>{class Q{constructor(R,j,te){this._element=R,this._startStyles=j,this._endStyles=te,this._state=0;let me=Q.initialStylesByElement.get(R);me||Q.initialStylesByElement.set(R,me=new Map),this._initialStyles=me}start(){this._state<1&&(this._startStyles&&de(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(de(this._element,this._initialStyles),this._endStyles&&(de(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(Q.initialStylesByElement.delete(this._element),this._startStyles&&(Ee(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Ee(this._element,this._endStyles),this._endStyles=null),de(this._element,this._initialStyles),this._state=3)}}return Q.initialStylesByElement=new WeakMap,Q})();function ri(Q){let I=null;return Q.forEach((R,j)=>{(function Ja(Q){return"display"===Q||"position"===Q})(j)&&(I=I||new Map,I.set(j,R))}),I}class ha{constructor(I,R,j,te){this.element=I,this.keyframes=R,this.options=j,this._specialStyles=te,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=j.duration,this._delay=j.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(I=>I()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const I=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,I,this.options),this._finalKeyframe=I.length?I[I.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(I){const R=[];return I.forEach(j=>{R.push(Object.fromEntries(j))}),R}_triggerWebAnimation(I,R,j){return I.animate(this._convertKeyframesToObject(R),j)}onStart(I){this._originalOnStartFns.push(I),this._onStartFns.push(I)}onDone(I){this._originalOnDoneFns.push(I),this._onDoneFns.push(I)}onDestroy(I){this._onDestroyFns.push(I)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(I=>I()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(I=>I()),this._onDestroyFns=[])}setPosition(I){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=I*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const I=new Map;this.hasStarted()&&this._finalKeyframe.forEach((j,te)=>{"offset"!==te&&I.set(te,this._finished?j:Qn(this.element,te))}),this.currentSnapshot=I}triggerCallback(I){const R="start"===I?this._onStartFns:this._onDoneFns;R.forEach(j=>j()),R.length=0}}class Qi{validateStyleProperty(I){return!0}validateAnimatableStyleProperty(I){return!0}matchesElement(I,R){return!1}containsElement(I,R){return Er(I,R)}getParentElement(I){return xn(I)}query(I,R,j){return un(I,R,j)}computeStyle(I,R,j){return window.getComputedStyle(I)[R]}animate(I,R,j,te,me,Oe=[]){const tt={duration:j,delay:te,fill:0==te?"both":"forwards"};me&&(tt.easing=me);const vt=new Map,on=Oe.filter(ur=>ur instanceof ha);(function hn(Q,I){return 0===Q||0===I})(j,te)&&on.forEach(ur=>{ur.currentSnapshot.forEach((jn,Kn)=>vt.set(Kn,jn))});let gn=function It(Q){return Q.length?Q[0]instanceof Map?Q:Q.map(I=>Rt(I)):[]}(R).map(ur=>ce(ur));gn=function Lt(Q,I,R){if(R.size&&I.length){let j=I[0],te=[];if(R.forEach((me,Oe)=>{j.has(Oe)||te.push(Oe),j.set(Oe,me)}),te.length)for(let me=1;me<I.length;me++){let Oe=I[me];te.forEach(Be=>Oe.set(Be,Qn(Q,Be)))}}return I}(I,gn,vt);const pr=function Ma(Q,I){let R=null,j=null;return Array.isArray(I)&&I.length?(R=ri(I[0]),I.length>1&&(j=ri(I[I.length-1]))):I instanceof Map&&(R=ri(I)),R||j?new fr(Q,R,j):null}(I,gn);return new ha(I,gn,tt,pr)}}var $i=De(6895);let da=(()=>{class Q extends Ge._j{constructor(R,j){super(),this._nextAnimationId=0,this._renderer=R.createRenderer(j.body,{id:"0",encapsulation:ge.ifc.None,styles:[],data:{animation:[]}})}build(R){const j=this._nextAnimationId.toString();this._nextAnimationId++;const te=Array.isArray(R)?(0,Ge.vP)(R):R;return Ks(this._renderer,null,j,"register",[te]),new $o(j,this._renderer)}}return Q.\u0275fac=function(R){return new(R||Q)(ge.LFG(ge.FYo),ge.LFG($i.K0))},Q.\u0275prov=ge.Yz7({token:Q,factory:Q.\u0275fac}),Q})();class $o extends Ge.LC{constructor(I,R){super(),this._id=I,this._renderer=R}create(I,R){return new Ao(this._id,I,R||{},this._renderer)}}class Ao{constructor(I,R,j,te){this.id=I,this.element=R,this._renderer=te,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",j)}_listen(I,R){return this._renderer.listen(this.element,`@@${this.id}:${I}`,R)}_command(I,...R){return Ks(this._renderer,this.element,this.id,I,R)}onDone(I){this._listen("done",I)}onStart(I){this._listen("start",I)}onDestroy(I){this._listen("destroy",I)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(I){this._command("setPosition",I)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function Ks(Q,I,R,j,te){return Q.setProperty(I,`@@${R}:${j}`,te)}const ps="@.disabled";let Ho=(()=>{class Q{constructor(R,j,te){this.delegate=R,this.engine=j,this._zone=te,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),j.onRemovalComplete=(me,Oe)=>{const Be=Oe?.parentNode(me);Be&&Oe.removeChild(Be,me)}}createRenderer(R,j){const me=this.delegate.createRenderer(R,j);if(!(R&&j&&j.data&&j.data.animation)){let on=this._rendererCache.get(me);return on||(on=new Ua("",me,this.engine,()=>this._rendererCache.delete(me)),this._rendererCache.set(me,on)),on}const Oe=j.id,Be=j.id+"-"+this._currentId;this._currentId++,this.engine.register(Be,R);const tt=on=>{Array.isArray(on)?on.forEach(tt):this.engine.registerTrigger(Oe,Be,R,on.name,on)};return j.data.animation.forEach(tt),new ms(this,Be,me,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(R,j,te){R>=0&&R<this._microtaskId?this._zone.run(()=>j(te)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(me=>{const[Oe,Be]=me;Oe(Be)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([j,te]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return Q.\u0275fac=function(R){return new(R||Q)(ge.LFG(ge.FYo),ge.LFG(so),ge.LFG(ge.R0b))},Q.\u0275prov=ge.Yz7({token:Q,factory:Q.\u0275fac}),Q})();class Ua{constructor(I,R,j,te){this.namespaceId=I,this.delegate=R,this.engine=j,this._onDestroy=te,this.destroyNode=this.delegate.destroyNode?me=>R.destroyNode(me):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),this._onDestroy?.()}createElement(I,R){return this.delegate.createElement(I,R)}createComment(I){return this.delegate.createComment(I)}createText(I){return this.delegate.createText(I)}appendChild(I,R){this.delegate.appendChild(I,R),this.engine.onInsert(this.namespaceId,R,I,!1)}insertBefore(I,R,j,te=!0){this.delegate.insertBefore(I,R,j),this.engine.onInsert(this.namespaceId,R,I,te)}removeChild(I,R,j){this.engine.onRemove(this.namespaceId,R,this.delegate,j)}selectRootElement(I,R){return this.delegate.selectRootElement(I,R)}parentNode(I){return this.delegate.parentNode(I)}nextSibling(I){return this.delegate.nextSibling(I)}setAttribute(I,R,j,te){this.delegate.setAttribute(I,R,j,te)}removeAttribute(I,R,j){this.delegate.removeAttribute(I,R,j)}addClass(I,R){this.delegate.addClass(I,R)}removeClass(I,R){this.delegate.removeClass(I,R)}setStyle(I,R,j,te){this.delegate.setStyle(I,R,j,te)}removeStyle(I,R,j){this.delegate.removeStyle(I,R,j)}setProperty(I,R,j){"@"==R.charAt(0)&&R==ps?this.disableAnimations(I,!!j):this.delegate.setProperty(I,R,j)}setValue(I,R){this.delegate.setValue(I,R)}listen(I,R,j){return this.delegate.listen(I,R,j)}disableAnimations(I,R){this.engine.disableAnimations(I,R)}}class ms extends Ua{constructor(I,R,j,te,me){super(R,j,te,me),this.factory=I,this.namespaceId=R}setProperty(I,R,j){"@"==R.charAt(0)?"."==R.charAt(1)&&R==ps?this.disableAnimations(I,j=void 0===j||!!j):this.engine.process(this.namespaceId,I,R.slice(1),j):this.delegate.setProperty(I,R,j)}listen(I,R,j){if("@"==R.charAt(0)){const te=function Tn(Q){switch(Q){case"body":return document.body;case"document":return document;case"window":return window;default:return Q}}(I);let me=R.slice(1),Oe="";return"@"!=me.charAt(0)&&([me,Oe]=function fa(Q){const I=Q.indexOf(".");return[Q.substring(0,I),Q.slice(I+1)]}(me)),this.engine.listen(this.namespaceId,te,me,Oe,Be=>{this.factory.scheduleListenerCallback(Be._data||-1,j,Be)})}return this.delegate.listen(I,R,j)}}const Va=[{provide:Ge._j,useClass:da},{provide:Zr,useFactory:function pa(){return new Ws}},{provide:so,useClass:(()=>{class Q extends so{constructor(R,j,te,me){super(R.body,j,te)}ngOnDestroy(){this.flush()}}return Q.\u0275fac=function(R){return new(R||Q)(ge.LFG($i.K0),ge.LFG(Jr),ge.LFG(Zr),ge.LFG(ge.z2F))},Q.\u0275prov=ge.Yz7({token:Q,factory:Q.\u0275fac}),Q})()},{provide:ge.FYo,useFactory:function Ds(Q,I,R){return new Ho(Q,I,R)},deps:[W.se,so,ge.R0b]}],Po=[{provide:Jr,useFactory:()=>new Qi},{provide:ge.QbO,useValue:"BrowserAnimations"},...Va],Ia=[{provide:Jr,useClass:Lr},{provide:ge.QbO,useValue:"NoopAnimations"},...Va];let Qa=(()=>{class Q{static withConfig(R){return{ngModule:Q,providers:R.disableAnimations?Ia:Po}}}return Q.\u0275fac=function(R){return new(R||Q)},Q.\u0275mod=ge.oAB({type:Q}),Q.\u0275inj=ge.cJS({providers:Po,imports:[W.b2]}),Q})();var el=De(529),mi=De(346);const gs=[{path:"mapas",loadChildren:()=>Promise.all([De.e(592),De.e(587)]).then(De.bind(De,8587)).then(Q=>Q.MapasModule)},{path:"auth",loadChildren:()=>Promise.all([De.e(592),De.e(415)]).then(De.bind(De,7429)).then(Q=>Q.AuthModule)},{path:"**",redirectTo:"mapas"}];let Xi=(()=>{class Q{}return Q.\u0275fac=function(R){return new(R||Q)},Q.\u0275mod=ge.oAB({type:Q}),Q.\u0275inj=ge.cJS({imports:[mi.Bz.forRoot(gs,{useHash:!1}),mi.Bz]}),Q})();var Ro=De(9898),ma=De(2340);let ga=(()=>{class Q{constructor(){this.title="Puntos_de_CyL"}ngOnInit(){Ro.accessToken=ma.N.mapboxToken}}return Q.\u0275fac=function(R){return new(R||Q)},Q.\u0275cmp=ge.Xpm({type:Q,selectors:[["app-root"]],decls:1,vars:0,template:function(R,j){1&R&&ge._UZ(0,"router-outlet")},dependencies:[mi.lC]}),Q})(),Ys=(()=>{class Q{}return Q.\u0275fac=function(R){return new(R||Q)},Q.\u0275mod=ge.oAB({type:Q,bootstrap:[ga]}),Q.\u0275inj=ge.cJS({imports:[W.b2,Xi,Qa,el.JF]}),Q})();var oc=De(5226);if(!navigator.geolocation)throw De.n(oc)().fire("Error","El navegador no soporta la Geolocalizaci\xf3n","error"),new Error("El navegador no soporta la Geolocalizaci\xf3n");W.q6().bootstrapModule(Ys).catch(Q=>console.error(Q))},9898:function(or){or.exports=function(){"use strict";var Gt,De,W;function ge(c,Le){if(Gt)if(De){var en="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Gt+")(sharedChunk); ("+De+")(sharedChunk); self.onerror = null;",qt={};Gt(qt),W=Le(qt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(W.workerUrl=window.URL.createObjectURL(new Blob([en],{type:"text/javascript"})))}else De=Le;else Gt=Le}return ge(0,function(c){var Le=typeof self<"u"?self:{},en="2.14.1";let qt;const zt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==qt){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{qt=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch{qt=t}}return qt},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!zt.API_URL)return null;try{const t=new URL(zt.API_URL);return"api.mapbox.cn"===t.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===t.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},wt={supported:!1,testSupport:function(t){!Zt&&mt&&(Pn?Ut(t):Et=t)}};let Et,mt,Zt=!1,Pn=!1;function Ut(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,mt),t.isContextLost())return;wt.supported=!0}catch{}t.deleteTexture(e),Zt=!0}Le.document&&(mt=Le.document.createElement("img"),mt.onload=function(){Et&&Ut(Et),Et=null,Pn=!0},mt.onerror=function(){Zt=!0,Et=null},mt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const cn="01";var In=Xn;function Xn(t,e,n,s){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=s}Xn.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,s=0;s<8;s++){var h=this.sampleCurveX(n)-t;if(Math.abs(h)<e)return n;var g=this.sampleCurveDerivativeX(n);if(Math.abs(g)<1e-6)break;n-=h/g}var y=0,w=1;for(n=t,s=0;s<20&&(h=this.sampleCurveX(n),!(Math.abs(h-t)<e));s++)t>h?y=n:w=n,n=.5*(w-y)+y;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var dt=yr;function yr(t,e){this.x=t,this.y=e}yr.prototype={clone:function(){return new yr(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),s=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=s,this},_rotateAround:function(t,e){var n=Math.cos(t),s=Math.sin(t),h=e.y+s*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-s*(this.y-e.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},yr.convert=function(t){return t instanceof yr?t:Array.isArray(t)?new yr(t[0],t[1]):t};const sn=Math.PI/180,Bt=180/Math.PI;function je(t){return t*sn}function Kt(t){return t*Bt}const Hn=[[0,0],[1,0],[1,1],[0,1]];function Me(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function Wt(t,e,n,s){const h=new In(t,e,n,s);return function(g){return h.solve(g)}}const gt=Wt(.25,.1,.25,1);function ft(t,e,n){return Math.min(n,Math.max(e,t))}function fn(t,e,n){return(n=ft((n-t)/(e-t),0,1))*n*(3-2*n)}function vn(t,e,n){const s=n-e,h=((t-e)%s+s)%s+e;return h===e?n:h}function dn(t,e,n){if(!t.length)return n(null,[]);let s=t.length;const h=new Array(t.length);let g=null;t.forEach((y,w)=>{e(y,(T,D)=>{T&&(g=T),h[w]=D,0==--s&&n(g,h)})})}function ot(t){const e=[];for(const n in t)e.push(t[n]);return e}function $e(t,...e){for(const n of e)for(const s in n)t[s]=n[s];return t}let yt=1;function At(){return yt++}function Yt(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Dt(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function an(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function hr(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function vr(t,e){return-1!==t.indexOf(e,t.length-e.length)}function Mn(t,e,n){const s={};for(const h in t)s[h]=e.call(n||this,t[h],h,t);return s}function er(t,e,n){const s={};for(const h in t)e.call(n||this,t[h],h,t)&&(s[h]=t[h]);return s}function Vn(t){return Array.isArray(t)?t.map(Vn):"object"==typeof t&&t?Mn(t,Vn):t}const zn={};function cr(t){zn[t]||(typeof console<"u"&&console.warn(t),zn[t]=!0)}function Ar(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function nn(t){let e=0;for(let n,s,h=0,g=t.length,y=g-1;h<g;y=h++)n=t[h],s=t[y],e+=(s.x-n.x)*(n.y+s.y);return e}function Kr(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Pr(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,s,h,g)=>{const y=h||g;return e[s]=!y||y.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Zo=null;function Rr(t){if(null==Zo){const e=t.navigator?t.navigator.userAgent:null;Zo=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Zo}function Yr(t){try{const e=Le[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function vi(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const xn="mapbox-tiles";let kr,Wi,di=500,zo=50;function sr(){try{return Le.caches}catch{}}function br(){sr()&&!kr&&(kr=Le.caches.open(xn))}function Ai(t){const e=t.indexOf("?");if(e<0)return t;const s=function(h){const g=h.indexOf("?");return g>0?h.slice(g+1).split("&"):[]}(t).filter(h=>{const g=h.split("=");return"language"===g[0]||"worldview"===g[0]});return s.length?`${t.slice(0,e)}?${s.join("&")}`:t.slice(0,e)}let Er=1/0;const un={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(un);class ht extends Error{constructor(e,n,s){401===n&&Rn(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Lr=Kr()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Le.location.protocol?Le.parent:Le).location.href,Jr=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(Lr())&&!/^\w+:/.test(n))){if(Le.fetch&&Le.Request&&Le.AbortController&&Le.Request.prototype.hasOwnProperty("signal"))return function(s,h){const g=new Le.AbortController,y=new Le.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:Lr(),referrerPolicy:s.referrerPolicy,signal:g.signal});let w=!1,T=!1;const D=(k=y.url).indexOf("sku=")>0&&Rn(k);var k;"json"===s.type&&y.headers.set("Accept","application/json");const O=(V,G,J)=>{if(T)return;if(V&&"SecurityError"!==V.message&&cr(V),G&&J)return B(G);const he=Date.now();Le.fetch(y).then(ve=>{if(ve.ok){const Ie=D?ve.clone():null;return B(ve,Ie,he)}return h(new ht(ve.statusText,ve.status,s.url))}).catch(ve=>{"AbortError"!==ve.name&&h(new Error(`${ve.message} ${s.url}`))})},B=(V,G,J)=>{("arrayBuffer"===s.type?V.arrayBuffer():"json"===s.type?V.json():V.text()).then(he=>{T||(G&&J&&function(ve,Ie,ye){if(br(),!kr)return;const Ce={status:Ie.status,statusText:Ie.statusText,headers:new Le.Headers};Ie.headers.forEach((et,Xe)=>Ce.headers.set(Xe,et));const ke=Pr(Ie.headers.get("Cache-Control")||"");if(ke["no-store"])return;ke["max-age"]&&Ce.headers.set("Expires",new Date(ye+1e3*ke["max-age"]).toUTCString());const Pe=Ce.headers.get("Expires");Pe&&(new Date(Pe).getTime()-ye<42e4||function(et,Xe){if(void 0===Wi)try{new Response(new ReadableStream),Wi=!0}catch{Wi=!1}Wi?Xe(et.body):et.blob().then(Xe)}(Ie,et=>{const Xe=new Le.Response(et,Ce);br(),kr&&kr.then(pt=>pt.put(Ai(ve.url),Xe)).catch(pt=>cr(pt.message))}))}(y,G,J),w=!0,h(null,he,V.headers.get("Cache-Control"),V.headers.get("Expires")))}).catch(he=>{T||h(new Error(he.message))})};return D?function(V,G){if(br(),!kr)return G(null);const J=Ai(V.url);kr.then(he=>{he.match(J).then(ve=>{const Ie=function(ye){if(!ye)return!1;const Ce=new Date(ye.headers.get("Expires")||0),ke=Pr(ye.headers.get("Cache-Control")||"");return Ce>Date.now()&&!ke["no-cache"]}(ve);he.delete(J),Ie&&he.put(J,ve.clone()),G(null,ve,Ie)}).catch(G)}).catch(G)}(y,O):O(null,null),{cancel:()=>{T=!0,w||g.abort()}}}(t,e);if(Kr()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(s,h){const g=new Le.XMLHttpRequest;g.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(g.responseType="arraybuffer");for(const y in s.headers)g.setRequestHeader(y,s.headers[y]);return"json"===s.type&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials="include"===s.credentials,g.onerror=()=>{h(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||0===g.status)&&null!==g.response){let y=g.response;if("json"===s.type)try{y=JSON.parse(g.response)}catch(w){return h(w)}h(null,y,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else h(new ht(g.statusText,g.status,s.url))},g.send(s.body),{cancel:()=>g.abort()}}(t,e)},tr=function(t,e){return Jr($e(t,{type:"arrayBuffer"}),e)};function ro(t){const e=Le.document.createElement("a");return e.href=t,e.protocol===Le.document.location.protocol&&e.host===Le.document.location.host}const Pi="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let $r,jr;$r=[],jr=0;const Bo=function(t,e){if(wt.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),jr>=zt.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return $r.push(g),g}jr++;let n=!1;const s=()=>{if(!n)for(n=!0,jr--;$r.length&&jr<zt.MAX_PARALLEL_IMAGE_REQUESTS;){const g=$r.shift(),{requestParameters:y,callback:w,cancelled:T}=g;T||(g.cancel=Bo(y,w).cancel)}},h=tr(t,(g,y,w,T)=>{s(),g?e(g):y&&(Le.createImageBitmap?function(D,k){const O=new Le.Blob([new Uint8Array(D)],{type:"image/png"});Le.createImageBitmap(O).then(B=>{k(null,B)}).catch(B=>{k(new Error(`Could not load image because of ${B.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(y,(D,k)=>e(D,k,w,T)):function(D,k){const O=new Le.Image,B=Le.URL;O.onload=()=>{k(null,O),B.revokeObjectURL(O.src),O.onload=null,Le.requestAnimationFrame(()=>{O.src=Pi})},O.onerror=()=>k(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const V=new Le.Blob([new Uint8Array(D)],{type:"image/png"});O.src=D.byteLength?B.createObjectURL(V):Pi}(y,(D,k)=>e(D,k,w,T)))});return{cancel:()=>{h.cancel(),s()}}},xr="NO_ACCESS_TOKEN";function Ui(t){return 0===t.indexOf("mapbox:")}function Rn(t){return zt.API_URL_REGEX.test(t)}function Ri(t){return zt.API_CDN_URL_REGEX.test(t)}function Zi(t){return zt.API_STYLE_REGEX.test(t)&&!Je(t)}function Je(t){return zt.API_SPRITE_REGEX.test(t)}const Fe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ne(t){const e=t.match(Fe);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Rt(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function It(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Le.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class On{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=It(zt.ACCESS_TOKEN);let s="";return s=n&&n.u?Le.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(h,g)=>String.fromCharCode(Number("0x"+g)))):zt.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${s}`:`mapbox.eventData:${s}`}fetchEventData(){const e=Yr("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const h=Le.localStorage.getItem(n);h&&(this.eventData=JSON.parse(h));const g=Le.localStorage.getItem(s);g&&(this.anonId=g)}catch{cr("Unable to read from LocalStorage")}}saveEventData(){const e=Yr("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{Le.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&Le.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{cr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,s,h){if(!zt.EVENTS_URL)return;const g=Ne(zt.EVENTS_URL);g.params.push(`access_token=${h||zt.ACCESS_TOKEN||""}`);const y={event:this.type,created:new Date(e).toISOString()},w=n?$e(y,n):y,T={url:Rt(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};var k;this.pendingRequest=(k=D=>{this.pendingRequest=null,s(D),this.saveEventData(),this.processRequests(h)},Jr($e(T,{method:"POST"}),k))}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const ce=new class extends On{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){zt.EVENTS_URL&&zt.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>Ui(n)||Rn(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=It(zt.ACCESS_TOKEN),n=e?e.u:zt.ACCESS_TOKEN;let s=n!==this.eventData.tokenU;an(this.anonId)||(this.anonId=Yt(),s=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),y=new Date(h),w=(h-this.eventData.lastSuccess)/864e5;s=s||w>=1||w<-1||g.getDate()!==y.getDate()}else s=!0;s?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:en,skuId:cn,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=h,this.eventData.tokenU=n)},t):this.processRequests()}},q=ce.postTurnstileEvent.bind(ce),Y=new class extends On{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,s){this.skuToken=e,this.errorCb=s,zt.EVENTS_URL&&(n||zt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(xr)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),an(this.anonId)||(this.anonId=Yt()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:en,skuId:cn,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t))}},de=Y.postMapLoadEvent.bind(Y),Ee=new class extends On{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){zt.EVENTS_URL&&(t||zt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:n}=this.queue.shift(),s=function(h){const g=Le.performance.getEntriesByType("resource"),y=Le.performance.getEntriesByType("mark"),w=function(B){const V={};if(B)for(const G in B)if("other"!==G)for(const J of B[G]){const he=`${G}ResolveRangeMin`,ve=`${G}ResolveRangeMax`,Ie=`${G}RequestCount`,ye=`${G}RequestCachedCount`;V[he]=Math.min(V[he]||1/0,J.startTime),V[ve]=Math.max(V[ve]||-1/0,J.responseEnd);const Ce=ke=>{void 0===V[ke]&&(V[ke]=0),++V[ke]};void 0!==J.transferSize&&0===J.transferSize&&Ce(ye),Ce(Ie)}return V}(function(B,V){const G={};if(B)for(const J of B){const he=V(J);void 0===G[he]&&(G[he]=[]),G[he].push(J)}return G}(g,ct)),T=Le.devicePixelRatio,D=Le.navigator.connection||Le.navigator.mozConnection||Le.navigator.webkitConnection,k={counters:[],metadata:[],attributes:[]},O=(B,V,G)=>{null!=G&&B.push({name:V,value:G.toString()})};for(const B in w)O(k.counters,B,w[B]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(O(k.counters,"interactionRangeMin",h.interactionRange[0]),O(k.counters,"interactionRangeMax",h.interactionRange[1])),y)for(const B of Object.keys(_e)){const V=_e[B],G=y.find(J=>J.name===V);G&&O(k.counters,V,G.startTime)}return O(k.counters,"visibilityHidden",h.visibilityHidden),O(k.attributes,"style",function(B){if(B)for(const V of B){const G=V.name.split("?")[0];if(Zi(G)){const J=G.split("/").slice(-2);if(2===J.length)return`mapbox://styles/${J[0]}/${J[1]}`}}}(g)),O(k.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),O(k.attributes,"fogEnabled",h.fogEnabled?"true":"false"),O(k.attributes,"projection",h.projection),O(k.attributes,"zoom",h.zoom),O(k.metadata,"devicePixelRatio",T),O(k.metadata,"connectionEffectiveType",D?D.effectiveType:void 0),O(k.metadata,"navigatorUserAgent",Le.navigator.userAgent),O(k.metadata,"screenWidth",Le.screen.width),O(k.metadata,"screenHeight",Le.screen.height),O(k.metadata,"windowWidth",Le.innerWidth),O(k.metadata,"windowHeight",Le.innerHeight),O(k.metadata,"mapWidth",h.width/T),O(k.metadata,"mapHeight",h.height/T),O(k.metadata,"webglRenderer",h.renderer),O(k.metadata,"webglVendor",h.vendor),O(k.metadata,"sdkVersion",en),O(k.metadata,"sdkIdentifier","mapbox-gl-js"),k}(n);for(const h of s.metadata);for(const h of s.counters);for(const h of s.attributes);this.postEvent(e,s,()=>{},t)}},ie=Ee.postPerformanceEvent.bind(Ee),se=new class extends On{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,s){if(!zt.API_URL||!zt.SESSION_PATH)return;const h=Ne(zt.API_URL+zt.SESSION_PATH);h.params.push(`sku=${e||""}`),h.params.push(`access_token=${s||zt.ACCESS_TOKEN||""}`);const g={url:Rt(h),headers:{"Content-Type":"text/plain"}};var w;this.pendingRequest=(w=y=>{this.pendingRequest=null,n(y),this.saveEventData(),this.processRequests(s)},Jr($e(g,{method:"GET"}),w))}getSessionAPI(t,e,n,s){this.skuToken=e,this.errorCb=s,zt.SESSION_PATH&&zt.API_URL&&(n||zt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(xr)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t)}},X=se.getSessionAPI.bind(se),oe=new Set,_e={create:"create",load:"load",fullLoad:"fullLoad"},Ue={mark(t){Le.performance.mark(t)},measure(t,e,n){Le.performance.measure(t,e,n)}};function ct(t){const e=t.name.split("?")[0];return Ri(e)&&e.includes("mapbox-gl.js")?"javascript":Ri(e)&&e.includes("mapbox-gl.css")?"css":zt.API_FONTS_REGEX.test(e)?"fontRange":Je(e)?"sprite":Zi(e)?"style":zt.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const lt=Le.performance;function kt(t){const e=t?t.url.toString():void 0;return lt.getEntriesByName(e)}let hn,Lt,mn,Qn;const nr={now:()=>void 0!==mn?mn:Le.performance.now(),setNow(t){mn=t},restoreNow(){mn=void 0},frame(t){const e=Le.requestAnimationFrame(t);return{cancel:()=>Le.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:n,height:s}=t;Qn||(Qn=Le.document.createElement("canvas"));const h=Qn.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(n>Qn.width||s>Qn.height)&&(Qn.width=n,Qn.height=s),h.clearRect(-e,-e,n+2*e,s+2*e),h.drawImage(t,0,0,n,s),h.getImageData(-e,-e,n+2*e,s+2*e)},resolveURL:t=>(hn||(hn=Le.document.createElement("a")),hn.href=t,hn.href),get devicePixelRatio(){return Le.devicePixelRatio},get prefersReducedMotion(){return!!Le.matchMedia&&(null==Lt&&(Lt=Le.matchMedia("(prefers-reduced-motion: reduce)")),Lt.matches)}};function En(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function zr(t,e,n){if(n&&n[t]){const s=n[t].indexOf(e);-1!==s&&n[t].splice(s,1)}}class Cr{constructor(e,n={}){$e(this,n),this.type=e}}class Xo extends Cr{constructor(e,n={}){super("error",$e({error:e},n))}}class ki{on(e,n){return this._listeners=this._listeners||{},En(e,n,this._listeners),this}off(e,n){return zr(e,n,this._listeners),zr(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},En(e,n,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,n){"string"==typeof e&&(e=new Cr(e,n||{}));const s=e.type;if(this.listens(s)){e.target=this;const h=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const w of h)w.call(this,e);const g=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const w of g)zr(s,w,this._oneTimeListeners),w.call(this,e);const y=this._eventedParent;y&&($e(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),y.fire(e))}else e instanceof Xo&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var st=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Qr(t,...e){for(const n of e)for(const s in n)t[s]=n[s];return t}function xi(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function ls(t){if(Array.isArray(t))return t.map(ls);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=ls(t[n]);return e}return xi(t)}class Ba extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var Li=Ba;class ar{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[s,h]of n)this.bindings[s]=h}concat(e){return new ar(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var oi=ar;const Ei={kind:"null"},$t={kind:"number"},kn={kind:"string"},Yn={kind:"boolean"},xo={kind:"color"},No={kind:"object"},$n={kind:"value"},pn={kind:"collator"},Jn={kind:"formatted"},Br={kind:"resolvedImage"};function Nr(t,e){return{kind:"array",itemType:t,N:e}}function dr(t){if("array"===t.kind){const e=dr(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const Oi=[Ei,$t,kn,Yn,xo,Jn,No,Nr($n),Br];function Wr(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Wr(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const n of Oi)if(!Wr(n,e))return null}return`Expected ${dr(t)} but found ${dr(e)} instead.`}function fi(t,e){return e.some(n=>n.kind===t.kind)}function io(t,e){return e.some(n=>"null"===n?null===t:"array"===n?Array.isArray(t):"object"===n?t&&!Array.isArray(t)&&"object"==typeof t:n===typeof t)}var oo,rr={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function mo(t){return(t=Math.round(t))<0?0:t>255?255:t}function lo(t){return mo("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function Fi(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function wo(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{oo={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in rr)return rr[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=n.indexOf("("),h=n.indexOf(")");if(-1!==s&&h+1===n.length){var g=n.substr(0,s),y=n.substr(s+1,h-(s+1)).split(","),w=1;switch(g){case"rgba":if(4!==y.length)return null;w=Fi(y.pop());case"rgb":return 3!==y.length?null:[lo(y[0]),lo(y[1]),lo(y[2]),w];case"hsla":if(4!==y.length)return null;w=Fi(y.pop());case"hsl":if(3!==y.length)return null;var T=(parseFloat(y[0])%360+360)%360/360,D=Fi(y[1]),k=Fi(y[2]),O=k<=.5?k*(D+1):k+D-k*D,B=2*k-O;return[mo(255*wo(B,O,T+1/3)),mo(255*wo(B,O,T)),mo(255*wo(B,O,T-1/3)),w];default:return null}}return null}}catch{}class Vr{constructor(e,n,s,h=1){this.r=e,this.g=n,this.b=s,this.a=h}static parse(e){if(!e)return;if(e instanceof Vr)return e;if("string"!=typeof e)return;const n=oo(e);return n?new Vr(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,s,h]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(s)},${h})`}toArray(){const{r:e,g:n,b:s,a:h}=this;return 0===h?[0,0,0,0]:[255*e/h,255*n/h,255*s/h,h]}toArray01(){const{r:e,g:n,b:s,a:h}=this;return 0===h?[0,0,0,0]:[e/h,n/h,s/h,h]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:s,a:h}=this;return[e,n,s,h]}}Vr.black=new Vr(0,0,0,1),Vr.white=new Vr(1,1,1,1),Vr.transparent=new Vr(0,0,0,0),Vr.red=new Vr(1,0,0,1),Vr.blue=new Vr(0,0,1,1);var Hr=Vr;class cs{constructor(e,n,s){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Ti{constructor(e,n,s,h,g){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=s,this.fontStack=h,this.textColor=g}}class ji{constructor(e){this.sections=e}static fromString(e){return new ji([new Ti(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof ji?e:ji.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);const s={};n.fontStack&&(s["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(s["font-scale"]=n.scale),n.textColor&&(s["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(s)}return e}}class co{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new co({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Zr(t,e,n,s){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[t,e,n,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[t,e,n,s]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Xa(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof Hr||t instanceof cs||t instanceof ji||t instanceof co)return!0;if(Array.isArray(t)){for(const e of t)if(!Xa(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!Xa(t[e]))return!1;return!0}return!1}function wi(t){if(null===t)return Ei;if("string"==typeof t)return kn;if("boolean"==typeof t)return Yn;if("number"==typeof t)return $t;if(t instanceof Hr)return xo;if(t instanceof cs)return pn;if(t instanceof ji)return Jn;if(t instanceof co)return Br;if(Array.isArray(t)){const e=t.length;let n;for(const s of t){const h=wi(s);if(n){if(n===h)continue;n=$n;break}n=h}return Nr(n||$n,e)}return No}function Ws(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Hr||t instanceof ji||t instanceof co?t.toString():JSON.stringify(t)}class As{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(2!==e.length)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Xa(e[1]))return n.error("invalid value");const s=e[1];let h=wi(s);const g=n.expectedType;return"array"!==h.kind||0!==h.N||!g||"array"!==g.kind||"number"==typeof g.N&&0!==g.N||(h=g),new As(h,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Hr?["rgba"].concat(this.value.toArray()):this.value instanceof ji?this.value.serialize():this.value}}var Uo=As,pi=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Ji={string:kn,number:$t,boolean:Yn,object:No};class la{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s,h=1;const g=e[0];if("array"===g){let w,T;if(e.length>2){const D=e[1];if("string"!=typeof D||!(D in Ji)||"object"===D)return n.error('The item type argument of "array" must be one of string, number, boolean',1);w=Ji[D],h++}else w=$n;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);T=e[2],h++}s=Nr(w,T)}else s=Ji[g];const y=[];for(;h<e.length;h++){const w=n.parse(e[h],h,$n);if(!w)return null;y.push(w)}return new la(s,y)}evaluate(e){for(let n=0;n<this.args.length;n++){const s=this.args[n].evaluate(e);if(!Wr(this.type,wi(s)))return s;if(n===this.args.length-1)throw new pi(`Expected value to be of type ${dr(this.type)}, but found ${dr(wi(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if("array"===e.kind){const s=e.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){n.push(s.kind);const h=e.N;("number"==typeof h||this.args.length>1)&&n.push(h)}}return n.concat(this.args.map(s=>s.serialize()))}}var Di=la;class uo{constructor(e){this.type=Jn,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&"object"==typeof s)return n.error("First argument must be an image or text section.");const h=[];let g=!1;for(let y=1;y<=e.length-1;++y){const w=e[y];if(g&&"object"==typeof w&&!Array.isArray(w)){g=!1;let T=null;if(w["font-scale"]&&(T=n.parse(w["font-scale"],1,$t),!T))return null;let D=null;if(w["text-font"]&&(D=n.parse(w["text-font"],1,Nr(kn)),!D))return null;let k=null;if(w["text-color"]&&(k=n.parse(w["text-color"],1,xo),!k))return null;const O=h[h.length-1];O.scale=T,O.font=D,O.textColor=k}else{const T=n.parse(e[y],1,$n);if(!T)return null;const D=T.type.kind;if("string"!==D&&"value"!==D&&"null"!==D&&"resolvedImage"!==D)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:T,scale:null,font:null,textColor:null})}}return new uo(h)}evaluate(e){return new ji(this.sections.map(n=>{const s=n.content.evaluate(e);return wi(s)===Br?new Ti("",s,null,null,null):new Ti(Ws(s),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const s={};n.scale&&(s["font-scale"]=n.scale.serialize()),n.font&&(s["text-font"]=n.font.serialize()),n.textColor&&(s["text-color"]=n.textColor.serialize()),e.push(s)}return e}}class Ps{constructor(e){this.type=Br,this.input=e}static parse(e,n){if(2!==e.length)return n.error("Expected two arguments.");const s=n.parse(e[1],1,kn);return s?new Ps(s):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),s=co.fromString(n);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(n)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const us={"to-boolean":Yn,"to-color":xo,"to-number":$t,"to-string":kn};class hs{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[0];if(("to-boolean"===s||"to-string"===s)&&2!==e.length)return n.error("Expected one argument.");const h=us[s],g=[];for(let y=1;y<e.length;y++){const w=n.parse(e[y],y,$n);if(!w)return null;g.push(w)}return new hs(h,g)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let n,s;for(const h of this.args){if(n=h.evaluate(e),s=null,n instanceof Hr)return n;if("string"==typeof n){const g=e.parseColor(n);if(g)return g}else if(Array.isArray(n)&&(s=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Zr(n[0],n[1],n[2],n[3]),!s))return new Hr(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new pi(s||`Could not parse color from value '${"string"==typeof n?n:String(JSON.stringify(n))}'`)}if("number"===this.type.kind){let n=null;for(const s of this.args){if(n=s.evaluate(e),null===n)return 0;const h=Number(n);if(!isNaN(h))return h}throw new pi(`Could not convert ${JSON.stringify(n)} to number.`)}return"formatted"===this.type.kind?ji.fromString(Ws(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?co.fromString(Ws(this.args[0].evaluate(e))):Ws(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new uo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ps(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var ni=hs;const Rs=["Unknown","Point","LineString","Polygon"];var ks=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Rs[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(s*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Hr.parse(t)),e}};class Ko{constructor(e,n,s,h){this.name=e,this.type=n,this._evaluate=s,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const s=e[0],h=Ko.definitions[s];if(!h)return n.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,y=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,w=y.filter(([D])=>!Array.isArray(D)||D.length===e.length-1);let T=null;for(const[D,k]of w){T=new Ts(n.registry,n.path,null,n.scope);const O=[];let B=!1;for(let V=1;V<e.length;V++){const G=e[V],J=Array.isArray(D)?D[V-1]:D.type,he=T.parse(G,1+O.length,J);if(!he){B=!0;break}O.push(he)}if(!B)if(Array.isArray(D)&&D.length!==O.length)T.error(`Expected ${D.length} arguments, but found ${O.length} instead.`);else{for(let V=0;V<O.length;V++){const G=Array.isArray(D)?D[V]:D.type,J=O[V];T.concat(V+1).checkSubtype(G,J.type)}if(0===T.errors.length)return new Ko(s,g,k,O)}}if(1===w.length)n.errors.push(...T.errors);else{const D=(w.length?w:y).map(([O])=>{return B=O,Array.isArray(B)?`(${B.map(dr).join(", ")})`:`(${dr(B.type)}...)`;var B}).join(" | "),k=[];for(let O=1;O<e.length;O++){const B=n.parse(e[O],1+k.length);if(!B)return null;k.push(dr(B.type))}n.error(`Expected arguments of type ${D}, but found (${k.join(", ")}) instead.`)}return null}static register(e,n){Ko.definitions=n;for(const s in n)e[s]=Ko}}var So=Ko;class ds{constructor(e,n,s){this.type=pn,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(2!==e.length)return n.error("Expected one argument.");const s=e[1];if("object"!=typeof s||Array.isArray(s))return n.error("Collator options argument must be an object.");const h=n.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,Yn);if(!h)return null;const g=n.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,Yn);if(!g)return null;let y=null;return s.locale&&(y=n.parse(s.locale,1,kn),!y)?null:new ds(h,g,y)}evaluate(e){return new cs(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const Es=8192;function Mo(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Ls(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Ka(t,e){const n=(180+t[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(n*h*Es),Math.round(s*h*Es)]}function Sa(t,e,n){const s=t[0]-e[0],h=t[1]-e[1],g=t[0]-n[0],y=t[1]-n[1];return s*y-g*h==0&&s*g<=0&&h*y<=0}function Na(t,e){let n=!1;for(let y=0,w=e.length;y<w;y++){const T=e[y];for(let D=0,k=T.length;D<k-1;D++){if(Sa(t,T[D],T[D+1]))return!1;(h=T[D])[1]>(s=t)[1]!=(g=T[D+1])[1]>s[1]&&s[0]<(g[0]-h[0])*(s[1]-h[1])/(g[1]-h[1])+h[0]&&(n=!n)}}var s,h,g;return n}function bo(t,e){for(let n=0;n<e.length;n++)if(Na(t,e[n]))return!0;return!1}function ca(t,e,n,s){const h=s[0]-n[0],g=s[1]-n[1],y=(t[0]-n[0])*g-h*(t[1]-n[1]),w=(e[0]-n[0])*g-h*(e[1]-n[1]);return y>0&&w<0||y<0&&w>0}function Os(t,e,n){for(const D of n)for(let k=0;k<D.length-1;++k)if((w=[(y=D[k+1])[0]-(g=D[k])[0],y[1]-g[1]])[0]*(T=[(h=e)[0]-(s=t)[0],h[1]-s[1]])[1]-w[1]*T[0]!=0&&ca(s,h,g,y)&&ca(g,y,s,h))return!0;var s,h,g,y,w,T;return!1}function jo(t,e){for(let n=0;n<t.length;++n)if(!Na(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Os(t[n],t[n+1],e))return!1;return!0}function Ya(t,e){for(let n=0;n<e.length;n++)if(jo(t,e[n]))return!0;return!1}function ua(t,e,n){const s=[];for(let h=0;h<t.length;h++){const g=[];for(let y=0;y<t[h].length;y++){const w=Ka(t[h][y],n);Mo(e,w),g.push(w)}s.push(g)}return s}function Yo(t,e,n){const s=[];for(let h=0;h<t.length;h++){const g=ua(t[h],e,n);s.push(g)}return s}function Fs(t,e,n,s){if(t[0]<n[0]||t[0]>n[2]){const h=.5*s;let g=t[0]-n[0]>h?-s:n[0]-t[0]>h?s:0;0===g&&(g=t[0]-n[2]>h?-s:n[2]-t[0]>h?s:0),t[0]+=g}Mo(e,t)}function Zs(t,e,n,s){const h=Math.pow(2,s.z)*Es,g=[s.x*Es,s.y*Es],y=[];if(!t)return y;for(const w of t)for(const T of w){const D=[T.x+g[0],T.y+g[1]];Fs(D,e,n,h),y.push(D)}return y}function gr(t,e,n,s){const h=Math.pow(2,s.z)*Es,g=[s.x*Es,s.y*Es],y=[];if(!t)return y;for(const T of t){const D=[];for(const k of T){const O=[k.x+g[0],k.y+g[1]];Mo(e,O),D.push(O)}y.push(D)}if(e[2]-e[0]<=h/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const T of y)for(const D of T)Fs(D,e,n,h)}var w;return y}class Vo{constructor(e,n){this.type=Yn,this.geojson=e,this.geometries=n}static parse(e,n){if(2!==e.length)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Xa(e[1])){const s=e[1];if("FeatureCollection"===s.type)for(let h=0;h<s.features.length;++h){const g=s.features[h].geometry.type;if("Polygon"===g||"MultiPolygon"===g)return new Vo(s,s.features[h].geometry)}else if("Feature"===s.type){const h=s.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new Vo(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new Vo(s,s)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(n,s){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(!y)return!1;if("Polygon"===s.type){const w=ua(s.coordinates,g,y),T=Zs(n.geometry(),h,g,y);if(!Ls(h,g))return!1;for(const D of T)if(!Na(D,w))return!1}if("MultiPolygon"===s.type){const w=Yo(s.coordinates,g,y),T=Zs(n.geometry(),h,g,y);if(!Ls(h,g))return!1;for(const D of T)if(!bo(D,w))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(n,s){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],y=n.canonicalID();if(!y)return!1;if("Polygon"===s.type){const w=ua(s.coordinates,g,y),T=gr(n.geometry(),h,g,y);if(!Ls(h,g))return!1;for(const D of T)if(!jo(D,w))return!1}if("MultiPolygon"===s.type){const w=Yo(s.coordinates,g,y),T=gr(n.geometry(),h,g,y);if(!Ls(h,g))return!1;for(const D of T)if(!Ya(D,w))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Xs=Vo;function Io(t){if(t instanceof So&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof Xs)return!1;let e=!0;return t.eachChild(n=>{e&&!Io(n)&&(e=!1)}),e}function Jo(t){if(t instanceof So&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(n=>{e&&!Jo(n)&&(e=!1)}),e}function Vi(t,e){if(t instanceof So&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(s=>{n&&!Vi(s,e)&&(n=!1)}),n}class Qo{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(2!==e.length||"string"!=typeof e[1])return n.error("'var' expression requires exactly one string literal argument.");const s=e[1];return n.scope.has(s)?new Qo(s,n.scope.get(s)):n.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var zs=Qo;class Bs{constructor(e,n=[],s,h=new oi,g=[]){this.registry=e,this.path=n,this.key=n.map(y=>`[${y}]`).join(""),this.scope=h,this.errors=g,this.expectedType=s}parse(e,n,s,h,g={}){return n?this.concat(n,s,h)._parse(e,g):this._parse(e,g)}_parse(e,n){function s(h,g,y){return"assert"===y?new Di(g,[h]):"coerce"===y?new ni(g,[h]):h}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[h];if(g){let y=g.parse(e,this);if(!y)return null;if(this.expectedType){const w=this.expectedType,T=y.type;if("string"!==w.kind&&"number"!==w.kind&&"boolean"!==w.kind&&"object"!==w.kind&&"array"!==w.kind||"value"!==T.kind)if("color"!==w.kind&&"formatted"!==w.kind&&"resolvedImage"!==w.kind||"value"!==T.kind&&"string"!==T.kind){if(this.checkSubtype(w,T))return null}else y=s(y,w,n.typeAnnotation||"coerce");else y=s(y,w,n.typeAnnotation||"assert")}if(!(y instanceof Uo)&&"resolvedImage"!==y.type.kind&&fs(y)){const w=new ks;try{y=new Uo(y.type,y.evaluate(w))}catch(T){return this.error(T.message),null}}return y}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,s){const h="number"==typeof e?this.path.concat(e):this.path,g=s?this.scope.concat(s):this.scope;return new Bs(this.registry,h,n||null,g,this.errors)}error(e,...n){const s=`${this.key}${n.map(h=>`[${h}]`).join("")}`;this.errors.push(new Li(s,e))}checkSubtype(e,n){const s=Wr(e,n);return s&&this.error(s),s}}var Ts=Bs;function fs(t){if(t instanceof zs)return fs(t.boundExpression);if(t instanceof So&&"error"===t.name||t instanceof ds||t instanceof Xs)return!1;const e=t instanceof ni||t instanceof Di;let n=!0;return t.eachChild(s=>{n=e?n&&fs(s):n&&s instanceof Uo}),!!n&&Io(t)&&Vi(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ns(t,e){const n=t.length-1;let s,h,g=0,y=n,w=0;for(;g<=y;)if(w=Math.floor((g+y)/2),s=t[w],h=t[w+1],s<=e){if(w===n||e<h)return w;g=w+1}else{if(!(s>e))throw new pi("Input is not a number.");y=w-1}return 0}class so{constructor(e,n,s){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[h,g]of s)this.labels.push(h),this.outputs.push(g)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const s=n.parse(e[1],1,$t);if(!s)return null;const h=[];let g=null;n.expectedType&&"value"!==n.expectedType.kind&&(g=n.expectedType);for(let y=1;y<e.length;y+=2){const w=1===y?-1/0:e[y],T=e[y+1],D=y,k=y+1;if("number"!=typeof w)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(h.length&&h[h.length-1][0]>=w)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const O=n.parse(T,k,g);if(!O)return null;g=g||O.type,h.push([w,O])}return new so(g,s,h)}evaluate(e){const n=this.labels,s=this.outputs;if(1===n.length)return s[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return s[0].evaluate(e);const g=n.length;return h>=n[g-1]?s[g-1].evaluate(e):s[Ns(n,h)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var Ma=so;function fr(t,e,n){return t*(1-n)+e*n}var ri=Object.freeze({__proto__:null,number:fr,color:function(t,e,n){return new Hr(fr(t.r,e.r,n),fr(t.g,e.g,n),fr(t.b,e.b,n),fr(t.a,e.a,n))},array:function(t,e,n){return t.map((s,h)=>fr(s,e[h],n))}});const Ja=.95047,ha=1.08883,Qi=4/29,$i=6/29,da=3*$i*$i,$o=Math.PI/180,Ao=180/Math.PI;function Ks(t){return t>.008856451679035631?Math.pow(t,1/3):t/da+Qi}function Go(t){return t>$i?t*t*t:da*(t-Qi)}function ps(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function Ho(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Ua(t){const e=Ho(t.r),n=Ho(t.g),s=Ho(t.b),h=Ks((.4124564*e+.3575761*n+.1804375*s)/Ja),g=Ks((.2126729*e+.7151522*n+.072175*s)/1);return{l:116*g-16,a:500*(h-g),b:200*(g-Ks((.0193339*e+.119192*n+.9503041*s)/ha)),alpha:t.a}}function ms(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,s=isNaN(t.b)?e:e-t.b/200;return e=1*Go(e),n=Ja*Go(n),s=ha*Go(s),new Hr(ps(3.2404542*n-1.5371385*e-.4985314*s),ps(-.969266*n+1.8760108*e+.041556*s),ps(.0556434*n-.2040259*e+1.0572252*s),t.alpha)}function Tn(t,e,n){const s=e-t;return t+n*(s>180||s<-180?s-360*Math.round(s/360):s)}const fa={forward:Ua,reverse:ms,interpolate:function(t,e,n){return{l:fr(t.l,e.l,n),a:fr(t.a,e.a,n),b:fr(t.b,e.b,n),alpha:fr(t.alpha,e.alpha,n)}}},ja={forward:function(t){const{l:e,a:n,b:s}=Ua(t),h=Math.atan2(s,n)*Ao;return{h:h<0?h+360:h,c:Math.sqrt(n*n+s*s),l:e,alpha:t.a}},reverse:function(t){const e=t.h*$o,n=t.c;return ms({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:Tn(t.h,e.h,n),c:fr(t.c,e.c,n),l:fr(t.l,e.l,n),alpha:fr(t.alpha,e.alpha,n)}}};var pa=Object.freeze({__proto__:null,lab:fa,hcl:ja});class Ds{constructor(e,n,s,h,g){this.type=e,this.operator=n,this.interpolation=s,this.input=h,this.labels=[],this.outputs=[];for(const[y,w]of g)this.labels.push(y),this.outputs.push(w)}static interpolationFactor(e,n,s,h){let g=0;if("exponential"===e.name)g=Va(n,e.base,s,h);else if("linear"===e.name)g=Va(n,1,s,h);else if("cubic-bezier"===e.name){const y=e.controlPoints;g=new In(y[0],y[1],y[2],y[3]).solve(Va(n,1,s,h))}return g}static parse(e,n){let[s,h,g,...y]=e;if(!Array.isArray(h)||0===h.length)return n.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const D=h[1];if("number"!=typeof D)return n.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:D}}else{if("cubic-bezier"!==h[0])return n.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const D=h.slice(1);if(4!==D.length||D.some(k=>"number"!=typeof k||k<0||k>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:D}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(g=n.parse(g,2,$t),!g)return null;const w=[];let T=null;"interpolate-hcl"===s||"interpolate-lab"===s?T=xo:n.expectedType&&"value"!==n.expectedType.kind&&(T=n.expectedType);for(let D=0;D<y.length;D+=2){const k=y[D],O=y[D+1],B=D+3,V=D+4;if("number"!=typeof k)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(w.length&&w[w.length-1][0]>=k)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const G=n.parse(O,V,T);if(!G)return null;T=T||G.type,w.push([k,G])}return"number"===T.kind||"color"===T.kind||"array"===T.kind&&"number"===T.itemType.kind&&"number"==typeof T.N?new Ds(T,s,h,g,w):n.error(`Type ${dr(T)} is not interpolatable.`)}evaluate(e){const n=this.labels,s=this.outputs;if(1===n.length)return s[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return s[0].evaluate(e);const g=n.length;if(h>=n[g-1])return s[g-1].evaluate(e);const y=Ns(n,h),w=Ds.interpolationFactor(this.interpolation,h,n[y],n[y+1]),T=s[y].evaluate(e),D=s[y+1].evaluate(e);return"interpolate"===this.operator?ri[this.type.kind.toLowerCase()](T,D,w):"interpolate-hcl"===this.operator?ja.reverse(ja.interpolate(ja.forward(T),ja.forward(D),w)):fa.reverse(fa.interpolate(fa.forward(T),fa.forward(D),w))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)n.push(this.labels[s],this.outputs[s].serialize());return n}}function Va(t,e,n,s){const h=s-n,g=t-n;return 0===h?0:1===e?g/h:(Math.pow(e,g)-1)/(Math.pow(e,h)-1)}var Po=Ds;class Ia{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let s=null;const h=n.expectedType;h&&"value"!==h.kind&&(s=h);const g=[];for(const w of e.slice(1)){const T=n.parse(w,1+g.length,s,void 0,{typeAnnotation:"omit"});if(!T)return null;s=s||T.type,g.push(T)}const y=h&&g.some(w=>Wr(h,w.type));return new Ia(y?$n:s,g)}evaluate(e){let n,s=null,h=0;for(const g of this.args){if(h++,s=g.evaluate(e),s&&s instanceof co&&!s.available&&(n||(n=s),s=null,h===this.args.length))return n;if(null!==s)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Qa=Ia;class Ft{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let g=1;g<e.length-1;g+=2){const y=e[g];if("string"!=typeof y)return n.error(`Expected string, but found ${typeof y} instead.`,g);if(/[^a-zA-Z0-9_]/.test(y))return n.error("Variable names must contain only alphanumeric characters or '_'.",g);const w=n.parse(e[g+1],g+1);if(!w)return null;s.push([y,w])}const h=n.parse(e[e.length-1],e.length-1,n.expectedType,s);return h?new Ft(s,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,s]of this.bindings)e.push(n,s.serialize());return e.push(this.result.serialize()),e}}var Sr=Ft;class Aa{constructor(e,n,s){this.type=e,this.index=n,this.input=s}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,$t),h=n.parse(e[2],2,Nr(n.expectedType||$n));return s&&h?new Aa(h.type.itemType,s,h):null}evaluate(e){const n=this.index.evaluate(e),s=this.input.evaluate(e);if(n<0)throw new pi(`Array index out of bounds: ${n} < 0.`);if(n>=s.length)throw new pi(`Array index out of bounds: ${n} > ${s.length-1}.`);if(n!==Math.floor(n))throw new pi(`Array index must be an integer, but found ${n} instead.`);return s[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var el=Aa;class mi{constructor(e,n){this.type=Yn,this.needle=e,this.haystack=n}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,$n),h=n.parse(e[2],2,$n);return s&&h?fi(s.type,[Yn,kn,$t,Ei,$n])?new mi(s,h):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${dr(s.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(null==s)return!1;if(!io(n,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${dr(wi(n))} instead.`);if(!io(s,["string","array"]))throw new pi(`Expected second argument to be of type array or string, but found ${dr(wi(s))} instead.`);return s.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var gs=mi;class Xi{constructor(e,n,s){this.type=$t,this.needle=e,this.haystack=n,this.fromIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,$n),h=n.parse(e[2],2,$n);if(!s||!h)return null;if(!fi(s.type,[Yn,kn,$t,Ei,$n]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${dr(s.type)} instead`);if(4===e.length){const g=n.parse(e[3],3,$t);return g?new Xi(s,h,g):null}return new Xi(s,h)}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!io(n,["boolean","string","number","null"]))throw new pi(`Expected first argument to be of type boolean, string, number or null, but found ${dr(wi(n))} instead.`);if(!io(s,["string","array"]))throw new pi(`Expected second argument to be of type array or string, but found ${dr(wi(s))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return s.indexOf(n,h)}return s.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var Ro=Xi;class ma{constructor(e,n,s,h,g,y){this.inputType=e,this.type=n,this.input=s,this.cases=h,this.outputs=g,this.otherwise=y}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let s,h;n.expectedType&&"value"!==n.expectedType.kind&&(h=n.expectedType);const g={},y=[];for(let D=2;D<e.length-1;D+=2){let k=e[D];const O=e[D+1];Array.isArray(k)||(k=[k]);const B=n.concat(D);if(0===k.length)return B.error("Expected at least one branch label.");for(const G of k){if("number"!=typeof G&&"string"!=typeof G)return B.error("Branch labels must be numbers or strings.");if("number"==typeof G&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof G&&Math.floor(G)!==G)return B.error("Numeric branch labels must be integer values.");if(s){if(B.checkSubtype(s,wi(G)))return null}else s=wi(G);if(void 0!==g[String(G)])return B.error("Branch labels must be unique.");g[String(G)]=y.length}const V=n.parse(O,D,h);if(!V)return null;h=h||V.type,y.push(V)}const w=n.parse(e[1],1,$n);if(!w)return null;const T=n.parse(e[e.length-1],e.length-1,h);return T?"value"!==w.type.kind&&n.concat(1).checkSubtype(s,w.type)?null:new ma(s,h,w,g,y,T):null}evaluate(e){const n=this.input.evaluate(e);return(wi(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),s=[],h={};for(const y of n){const w=h[this.cases[y]];void 0===w?(h[this.cases[y]]=s.length,s.push([this.cases[y],[y]])):s[w][1].push(y)}const g=y=>"number"===this.inputType.kind?Number(y):y;for(const[y,w]of s)e.push(1===w.length?g(w[0]):w.map(g)),e.push(this.outputs[y].serialize());return e.push(this.otherwise.serialize()),e}}var ga=ma;class Ys{constructor(e,n,s){this.type=e,this.branches=n,this.otherwise=s}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let s;n.expectedType&&"value"!==n.expectedType.kind&&(s=n.expectedType);const h=[];for(let y=1;y<e.length-1;y+=2){const w=n.parse(e[y],y,Yn);if(!w)return null;const T=n.parse(e[y+1],y+1,s);if(!T)return null;h.push([w,T]),s=s||T.type}const g=n.parse(e[e.length-1],e.length-1,s);return g?new Ys(s,h,g):null}evaluate(e){for(const[n,s]of this.branches)if(n.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,s]of this.branches)e(n),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var oc=Ys;class Us{constructor(e,n,s,h){this.type=e,this.input=n,this.beginIndex=s,this.endIndex=h}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,$n),h=n.parse(e[2],2,$t);if(!s||!h)return null;if(!fi(s.type,[Nr($n),kn,$n]))return n.error(`Expected first argument to be of type array or string, but found ${dr(s.type)} instead`);if(4===e.length){const g=n.parse(e[3],3,$t);return g?new Us(s.type,s,h,g):null}return new Us(s.type,s,h)}evaluate(e){const n=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!io(n,["string","array"]))throw new pi(`Expected first argument to be of type array or string, but found ${dr(wi(n))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return n.slice(s,h)}return n.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Q=Us;function I(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function R(t,e,n,s){return 0===s.compare(e,n)}function j(t,e,n){const s="=="!==t&&"!="!==t;return class Z0{constructor(g,y,w){this.type=Yn,this.lhs=g,this.rhs=y,this.collator=w,this.hasUntypedArgument="value"===g.type.kind||"value"===y.type.kind}static parse(g,y){if(3!==g.length&&4!==g.length)return y.error("Expected two or three arguments.");const w=g[0];let T=y.parse(g[1],1,$n);if(!T)return null;if(!I(w,T.type))return y.concat(1).error(`"${w}" comparisons are not supported for type '${dr(T.type)}'.`);let D=y.parse(g[2],2,$n);if(!D)return null;if(!I(w,D.type))return y.concat(2).error(`"${w}" comparisons are not supported for type '${dr(D.type)}'.`);if(T.type.kind!==D.type.kind&&"value"!==T.type.kind&&"value"!==D.type.kind)return y.error(`Cannot compare types '${dr(T.type)}' and '${dr(D.type)}'.`);s&&("value"===T.type.kind&&"value"!==D.type.kind?T=new Di(D.type,[T]):"value"!==T.type.kind&&"value"===D.type.kind&&(D=new Di(T.type,[D])));let k=null;if(4===g.length){if("string"!==T.type.kind&&"string"!==D.type.kind&&"value"!==T.type.kind&&"value"!==D.type.kind)return y.error("Cannot use collator to compare non-string types.");if(k=y.parse(g[3],3,pn),!k)return null}return new Z0(T,D,k)}evaluate(g){const y=this.lhs.evaluate(g),w=this.rhs.evaluate(g);if(s&&this.hasUntypedArgument){const T=wi(y),D=wi(w);if(T.kind!==D.kind||"string"!==T.kind&&"number"!==T.kind)throw new pi(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${T.kind}, ${D.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const T=wi(y),D=wi(w);if("string"!==T.kind||"string"!==D.kind)return e(g,y,w)}return this.collator?n(g,y,w,this.collator.evaluate(g)):e(g,y,w)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[t];return this.eachChild(y=>{g.push(y.serialize())}),g}}}const te=j("==",function(t,e,n){return e===n},R),me=j("!=",function(t,e,n){return e!==n},function(t,e,n,s){return!R(0,e,n,s)}),Oe=j("<",function(t,e,n){return e<n},function(t,e,n,s){return s.compare(e,n)<0}),Be=j(">",function(t,e,n){return e>n},function(t,e,n,s){return s.compare(e,n)>0}),tt=j("<=",function(t,e,n){return e<=n},function(t,e,n,s){return s.compare(e,n)<=0}),vt=j(">=",function(t,e,n){return e>=n},function(t,e,n,s){return s.compare(e,n)>=0});class on{constructor(e,n,s,h,g,y){this.type=kn,this.number=e,this.locale=n,this.currency=s,this.unit=h,this.minFractionDigits=g,this.maxFractionDigits=y}static parse(e,n){if(3!==e.length)return n.error("Expected two arguments.");const s=n.parse(e[1],1,$t);if(!s)return null;const h=e[2];if("object"!=typeof h||Array.isArray(h))return n.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=n.parse(h.locale,1,kn),!g))return null;let y=null;if(h.currency&&(y=n.parse(h.currency,1,kn),!y))return null;let w=null;if(h.unit&&(w=n.parse(h.unit,1,kn),!w))return null;let T=null;if(h["min-fraction-digits"]&&(T=n.parse(h["min-fraction-digits"],1,$t),!T))return null;let D=null;return h["max-fraction-digits"]&&(D=n.parse(h["max-fraction-digits"],1,$t),!D)?null:new on(s,g,y,w,T,D)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class gn{constructor(e){this.type=$t,this.input=e}static parse(e,n){if(2!==e.length)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=n.parse(e[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?n.error(`Expected argument of type string or array, but found ${dr(s.type)} instead.`):new gn(s):null}evaluate(e){const n=this.input.evaluate(e);if("string"==typeof n||Array.isArray(n))return n.length;throw new pi(`Expected value to be of type string or array, but found ${dr(wi(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}const pr={"==":te,"!=":me,">":Be,"<":Oe,">=":vt,"<=":tt,array:Di,at:el,boolean:Di,case:oc,coalesce:Qa,collator:ds,format:uo,image:Ps,in:gs,"index-of":Ro,interpolate:Po,"interpolate-hcl":Po,"interpolate-lab":Po,length:gn,let:Sr,literal:Uo,match:ga,number:Di,"number-format":on,object:Di,slice:Q,step:Ma,string:Di,"to-boolean":ni,"to-color":ni,"to-number":ni,"to-string":ni,var:zs,within:Xs};function ur(t,[e,n,s,h]){e=e.evaluate(t),n=n.evaluate(t),s=s.evaluate(t);const g=h?h.evaluate(t):1,y=Zr(e,n,s,g);if(y)throw new pi(y);return new Hr(e/255*g,n/255*g,s/255*g,g)}function jn(t,e){return t in e}function Kn(t,e){const n=e[t];return void 0===n?null:n}function mr(t){return{type:t}}So.register(pr,{error:[{kind:"error"},[kn],(t,[e])=>{throw new pi(e.evaluate(t))}],typeof:[kn,[$n],(t,[e])=>dr(wi(e.evaluate(t)))],"to-rgba":[Nr($t,4),[xo],(t,[e])=>e.evaluate(t).toArray()],rgb:[xo,[$t,$t,$t],ur],rgba:[xo,[$t,$t,$t,$t],ur],has:{type:Yn,overloads:[[[kn],(t,[e])=>jn(e.evaluate(t),t.properties())],[[kn,No],(t,[e,n])=>jn(e.evaluate(t),n.evaluate(t))]]},get:{type:$n,overloads:[[[kn],(t,[e])=>Kn(e.evaluate(t),t.properties())],[[kn,No],(t,[e,n])=>Kn(e.evaluate(t),n.evaluate(t))]]},"feature-state":[$n,[kn],(t,[e])=>Kn(e.evaluate(t),t.featureState||{})],properties:[No,[],t=>t.properties()],"geometry-type":[kn,[],t=>t.geometryType()],id:[$n,[],t=>t.id()],zoom:[$t,[],t=>t.globals.zoom],pitch:[$t,[],t=>t.globals.pitch||0],"distance-from-center":[$t,[],t=>t.distanceFromCenter()],"heatmap-density":[$t,[],t=>t.globals.heatmapDensity||0],"line-progress":[$t,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[$t,[],t=>t.globals.skyRadialProgress||0],accumulated:[$n,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[$t,mr($t),(t,e)=>{let n=0;for(const s of e)n+=s.evaluate(t);return n}],"*":[$t,mr($t),(t,e)=>{let n=1;for(const s of e)n*=s.evaluate(t);return n}],"-":{type:$t,overloads:[[[$t,$t],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[$t],(t,[e])=>-e.evaluate(t)]]},"/":[$t,[$t,$t],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[$t,[$t,$t],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[$t,[],()=>Math.LN2],pi:[$t,[],()=>Math.PI],e:[$t,[],()=>Math.E],"^":[$t,[$t,$t],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[$t,[$t],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[$t,[$t],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[$t,[$t],(t,[e])=>Math.log(e.evaluate(t))],log2:[$t,[$t],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[$t,[$t],(t,[e])=>Math.sin(e.evaluate(t))],cos:[$t,[$t],(t,[e])=>Math.cos(e.evaluate(t))],tan:[$t,[$t],(t,[e])=>Math.tan(e.evaluate(t))],asin:[$t,[$t],(t,[e])=>Math.asin(e.evaluate(t))],acos:[$t,[$t],(t,[e])=>Math.acos(e.evaluate(t))],atan:[$t,[$t],(t,[e])=>Math.atan(e.evaluate(t))],min:[$t,mr($t),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[$t,mr($t),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[$t,[$t],(t,[e])=>Math.abs(e.evaluate(t))],round:[$t,[$t],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[$t,[$t],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[$t,[$t],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Yn,[kn,$n],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Yn,[$n],(t,[e])=>t.id()===e.value],"filter-type-==":[Yn,[kn],(t,[e])=>t.geometryType()===e.value],"filter-<":[Yn,[kn,$n],(t,[e,n])=>{const s=t.properties()[e.value],h=n.value;return typeof s==typeof h&&s<h}],"filter-id-<":[Yn,[$n],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n<s}],"filter->":[Yn,[kn,$n],(t,[e,n])=>{const s=t.properties()[e.value],h=n.value;return typeof s==typeof h&&s>h}],"filter-id->":[Yn,[$n],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n>s}],"filter-<=":[Yn,[kn,$n],(t,[e,n])=>{const s=t.properties()[e.value],h=n.value;return typeof s==typeof h&&s<=h}],"filter-id-<=":[Yn,[$n],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n<=s}],"filter->=":[Yn,[kn,$n],(t,[e,n])=>{const s=t.properties()[e.value],h=n.value;return typeof s==typeof h&&s>=h}],"filter-id->=":[Yn,[$n],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n>=s}],"filter-has":[Yn,[$n],(t,[e])=>e.value in t.properties()],"filter-has-id":[Yn,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Yn,[Nr(kn)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Yn,[Nr($n)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Yn,[kn,Nr($n)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Yn,[kn,Nr($n)],(t,[e,n])=>function(s,h,g,y){for(;g<=y;){const w=g+y>>1;if(h[w]===s)return!0;h[w]>s?y=w-1:g=w+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Yn,overloads:[[[Yn,Yn],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[mr(Yn),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Yn,overloads:[[[Yn,Yn],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[mr(Yn),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Yn,[Yn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Yn,[kn],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[kn,[kn],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[kn,[kn],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[kn,mr($n),(t,e)=>e.map(n=>Ws(n.evaluate(t))).join("")],"resolved-locale":[kn,[pn],(t,[e])=>e.evaluate(t).resolvedLocale()]});var Tr=pr;function gi(t){return{result:"success",value:t}}function si(t){return{result:"error",value:t}}function ai(t){return"data-driven"===t["property-type"]}function ho(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function eo(t){return!!t.expression&&t.expression.interpolated}function Cn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function to(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Gr(t){return t}function F(t,e){const n="color"===e.type,s=t.stops&&"object"==typeof t.stops[0][0],h=s||!(s||void 0!==t.property),g=t.type||(eo(e)?"exponential":"interval");if(n&&((t=Qr({},t)).stops&&(t.stops=t.stops.map(D=>[D[0],Hr.parse(D[1])])),t.default=Hr.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!pa[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let y,w,T;if("exponential"===g)y=Se;else if("interval"===g)y=ae;else if("categorical"===g){y=U,w=Object.create(null);for(const D of t.stops)w[D[0]]=D[1];T=typeof t.stops[0][0]}else{if("identity"!==g)throw new Error(`Unknown function type "${g}"`);y=A}if(s){const D={},k=[];for(let V=0;V<t.stops.length;V++){const G=t.stops[V],J=G[0].zoom;void 0===D[J]&&(D[J]={zoom:J,type:t.type,property:t.property,default:t.default,stops:[]},k.push(J)),D[J].stops.push([G[0].value,G[1]])}const O=[];for(const V of k)O.push([D[V].zoom,F(D[V],e)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:Po.interpolationFactor.bind(void 0,B),zoomStops:O.map(V=>V[0]),evaluate:({zoom:V},G)=>Se({stops:O,base:t.base},e,V).evaluate(V,G)}}if(h){const D="exponential"===g?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:Po.interpolationFactor.bind(void 0,D),zoomStops:t.stops.map(k=>k[0]),evaluate:({zoom:k})=>y(t,e,k,w,T)}}return{kind:"source",evaluate(D,k){const O=k&&k.properties?k.properties[t.property]:void 0;return void 0===O?K(t.default,e.default):y(t,e,O,w,T)}}}function K(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function U(t,e,n,s,h){return K(typeof n===h?s[n]:void 0,t.default,e.default)}function ae(t,e,n){if("number"!==Cn(n))return K(t.default,e.default);const s=t.stops.length;if(1===s||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[s-1][0])return t.stops[s-1][1];const h=Ns(t.stops.map(g=>g[0]),n);return t.stops[h][1]}function Se(t,e,n){const s=void 0!==t.base?t.base:1;if("number"!==Cn(n))return K(t.default,e.default);const h=t.stops.length;if(1===h||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[h-1][0])return t.stops[h-1][1];const g=Ns(t.stops.map(k=>k[0]),n),y=function(k,O,B,V){const G=V-B,J=k-B;return 0===G?0:1===O?J/G:(Math.pow(O,J)-1)/(Math.pow(O,G)-1)}(n,s,t.stops[g][0],t.stops[g+1][0]),w=t.stops[g][1],T=t.stops[g+1][1];let D=ri[e.type]||Gr;if(t.colorSpace&&"rgb"!==t.colorSpace){const k=pa[t.colorSpace];D=(O,B)=>k.reverse(k.interpolate(k.forward(O),k.forward(B),y))}return"function"==typeof w.evaluate?{evaluate(...k){const O=w.evaluate.apply(void 0,k),B=T.evaluate.apply(void 0,k);if(void 0!==O&&void 0!==B)return D(O,B,y)}}:D(w,T,y)}function A(t,e,n){return"color"===e.type?n=Hr.parse(n):"formatted"===e.type?n=ji.fromString(n.toString()):"resolvedImage"===e.type?n=co.fromString(n.toString()):Cn(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),K(n,t.default,e.default)}class P{constructor(e,n){var s;this.expression=e,this._warningHistory={},this._evaluator=new ks,this._defaultValue=n?"color"===(s=n).type&&(to(s.default)||Array.isArray(s.default))?new Hr(0,0,0,0):"color"===s.type?Hr.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(e,n,s,h,g,y,w,T){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=s,this._evaluator.canonical=h||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,s,h,g,y,w,T){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=s||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=y||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new pi(`Expected value to be one of ${Object.keys(this._enumValues).map(k=>JSON.stringify(k)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(D.message)),this._defaultValue}}}function $(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Tr}function pe(t,e){const n=new Ts(Tr,[],e?function(h){const g={color:xo,string:kn,number:$t,enum:kn,boolean:Yn,formatted:Jn,resolvedImage:Br};return"array"===h.type?Nr(g[h.value]||$n,h.length):g[h.type]}(e):void 0),s=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return s?gi(new P(s,e)):si(n.errors)}class We{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent="constant"!==e&&!Jo(n.expression)}evaluateWithoutErrorHandling(e,n,s,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,h,g,y)}evaluate(e,n,s,h,g,y){return this._styleExpression.evaluate(e,n,s,h,g,y)}}class Ot{constructor(e,n,s,h){this.kind=e,this.zoomStops=s,this._styleExpression=n,this.isStateDependent="camera"!==e&&!Jo(n.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,n,s,h,g,y){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,h,g,y)}evaluate(e,n,s,h,g,y){return this._styleExpression.evaluate(e,n,s,h,g,y)}interpolationFactor(e,n,s){return this.interpolationType?Po.interpolationFactor(this.interpolationType,e,n,s):0}}function _n(t,e){if("error"===(t=pe(t,e)).result)return t;const n=t.value.expression,s=Io(n);if(!s&&!ai(e))return si([new Li("","data expressions not supported")]);const h=Vi(n,["zoom","pitch","distance-from-center"]);if(!h&&!ho(e))return si([new Li("","zoom expressions not supported")]);const g=Bn(n);return g||h?g instanceof Li?si([g]):g instanceof Po&&!eo(e)?si([new Li("",'"interpolate" expressions cannot be used with this property')]):gi(g?new Ot(s?"camera":"composite",t.value,g.labels,g instanceof Po?g.interpolation:void 0):new We(s?"constant":"source",t.value)):si([new Li("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class qn{constructor(e,n){this._parameters=e,this._specification=n,Qr(this,F(this._parameters,this._specification))}static deserialize(e){return new qn(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Bn(t){let e=null;if(t instanceof Sr)e=Bn(t.result);else if(t instanceof Qa){for(const n of t.args)if(e=Bn(n),e)break}else(t instanceof Ma||t instanceof Po)&&t.input instanceof So&&"zoom"===t.input.name&&(e=t);return e instanceof Li||t.eachChild(n=>{const s=Bn(n);s instanceof Li?e=s:!e&&s?e=new Li("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new Li("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class _t{constructor(e,n,s,h){this.message=(e?`${e}: `:"")+s,h&&(this.identifier=h),null!=n&&n.__line__&&(this.line=n.__line__)}}function zi(t){const e=t.key,n=t.value,s=t.valueSpec||{},h=t.objectElementValidators||{},g=t.style,y=t.styleSpec;let w=[];const T=Cn(n);if("object"!==T)return[new _t(e,n,`object expected, ${T} found`)];for(const D in n){const k=D.split(".")[0];let B;h[k]?B=h[k]:s[k]?B=ns:h["*"]?B=h["*"]:s["*"]&&(B=ns),B?w=w.concat(B({key:(e&&`${e}.`)+D,value:n[D],valueSpec:s[k]||s["*"],style:g,styleSpec:y,object:n,objectKey:D},n)):w.push(new _t(e,n[D],`unknown property "${D}"`))}for(const D in s)h[D]||s[D].required&&void 0===s[D].default&&void 0===n[D]&&w.push(new _t(e,n,`missing required property "${D}"`));return w}function qo(t){const e=t.value,n=t.valueSpec,s=t.style,h=t.styleSpec,g=t.key,y=t.arrayElementValidator||ns;if("array"!==Cn(e))return[new _t(g,e,`array expected, ${Cn(e)} found`)];if(n.length&&e.length!==n.length)return[new _t(g,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new _t(g,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let w={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};h.$version<7&&(w.function=n.function),"object"===Cn(n.value)&&(w=n.value);let T=[];for(let D=0;D<e.length;D++)T=T.concat(y({array:e,arrayIndex:D,value:e[D],valueSpec:w,style:s,styleSpec:h,key:`${g}[${D}]`}));return T}function Ci(t){const e=t.key,n=t.value,s=t.valueSpec;let h=Cn(n);if("number"===h&&n!=n&&(h="NaN"),"number"!==h)return[new _t(e,n,`number expected, ${h} found`)];if("minimum"in s){let g=s.minimum;if("array"===Cn(s.minimum)&&(g=s.minimum[t.arrayIndex]),n<g)return[new _t(e,n,`${n} is less than the minimum value ${g}`)]}if("maximum"in s){let g=s.maximum;if("array"===Cn(s.maximum)&&(g=s.maximum[t.arrayIndex]),n>g)return[new _t(e,n,`${n} is greater than the maximum value ${g}`)]}return[]}function ao(t){const e=t.valueSpec,n=xi(t.value.type);let s,h,g,y={};const w="categorical"!==n&&void 0===t.value.property,T=!w,D="array"===Cn(t.value.stops)&&"array"===Cn(t.value.stops[0])&&"object"===Cn(t.value.stops[0][0]),k=zi({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(V){if("identity"===n)return[new _t(V.key,V.value,'identity function may not have a "stops" property')];let G=[];const J=V.value;return G=G.concat(qo({key:V.key,value:J,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:O})),"array"===Cn(J)&&0===J.length&&G.push(new _t(V.key,J,"array must have at least one stop")),G},default:function(V){return ns({key:V.key,value:V.value,valueSpec:e,style:V.style,styleSpec:V.styleSpec})}}});return"identity"===n&&w&&k.push(new _t(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||k.push(new _t(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!eo(t.valueSpec)&&k.push(new _t(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(T&&!ai(t.valueSpec)?k.push(new _t(t.key,t.value,"property functions not supported")):w&&!ho(t.valueSpec)&&k.push(new _t(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!D||void 0!==t.value.property||k.push(new _t(t.key,t.value,'"property" property is required')),k;function O(V){let G=[];const J=V.value,he=V.key;if("array"!==Cn(J))return[new _t(he,J,`array expected, ${Cn(J)} found`)];if(2!==J.length)return[new _t(he,J,`array length 2 expected, length ${J.length} found`)];if(D){if("object"!==Cn(J[0]))return[new _t(he,J,`object expected, ${Cn(J[0])} found`)];if(void 0===J[0].zoom)return[new _t(he,J,"object stop key must have zoom")];if(void 0===J[0].value)return[new _t(he,J,"object stop key must have value")];const ve=xi(J[0].zoom);if("number"!=typeof ve)return[new _t(he,J[0].zoom,"stop zoom values must be numbers")];if(g&&g>ve)return[new _t(he,J[0].zoom,"stop zoom values must appear in ascending order")];ve!==g&&(g=ve,h=void 0,y={}),G=G.concat(zi({key:`${he}[0]`,value:J[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Ci,value:B}}))}else G=G.concat(B({key:`${he}[0]`,value:J[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},J));return $(ls(J[1]))?G.concat([new _t(`${he}[1]`,J[1],"expressions are not allowed in function stops.")]):G.concat(ns({key:`${he}[1]`,value:J[1],valueSpec:e,style:V.style,styleSpec:V.styleSpec}))}function B(V,G){const J=Cn(V.value),he=xi(V.value),ve=null!==V.value?V.value:G;if(s){if(J!==s)return[new _t(V.key,ve,`${J} stop domain type must match previous stop domain type ${s}`)]}else s=J;if("number"!==J&&"string"!==J&&"boolean"!==J&&"number"!=typeof he&&"string"!=typeof he&&"boolean"!=typeof he)return[new _t(V.key,ve,"stop domain value must be a number, string, or boolean")];if("number"!==J&&"categorical"!==n){let Ie=`number expected, ${J} found`;return ai(e)&&void 0===n&&(Ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new _t(V.key,ve,Ie)]}return"categorical"!==n||"number"!==J||"number"==typeof he&&isFinite(he)&&Math.floor(he)===he?"categorical"!==n&&"number"===J&&"number"==typeof he&&"number"==typeof h&&void 0!==h&&he<h?[new _t(V.key,ve,"stop domain values must appear in ascending order")]:(h=he,"categorical"===n&&he in y?[new _t(V.key,ve,"stop domain values must be unique")]:(y[he]=!0,[])):[new _t(V.key,ve,`integer expected, found ${String(he)}`)]}}function Ki(t){const e=("property"===t.expressionContext?_n:pe)(ls(t.value),t.valueSpec);if("error"===e.result)return e.value.map(s=>new _t(`${t.key}${s.key}`,t.value,s.message));const n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new _t(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Jo(n))return[new _t(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return Pa(n,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Vi(n,["zoom","feature-state"]))return[new _t(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Io(n))return[new _t(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Pa(t,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const h of e.valueSpec.expression.parameters)n.delete(h);if(0===n.size)return[];const s=[];return t instanceof So&&n.has(t.name)?[new _t(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(h=>{s.push(...Pa(h,e))}),s)}function _a(t){const e=t.key,n=t.value,s=t.valueSpec,h=[];return Array.isArray(s.values)?-1===s.values.indexOf(xi(n))&&h.push(new _t(e,n,`expected one of [${s.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(s.values).indexOf(xi(n))&&h.push(new _t(e,n,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(n)} found`)),h}function dl(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!dl(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Pl(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};dl(t)||(t=tl(t));const n=t;let s=!0;try{s=function(D){if(!Eo(D))return D;let k=ls(D);return va(k),k=ya(k),k}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const h=st[`filter_${e}`],g=pe(s,h);let y=null;if("error"===g.result)throw new Error(g.value.map(D=>`${D.key}: ${D.message}`).join(", "));y=(D,k,O)=>g.value.evaluate(D,k,{},O);let w=null,T=null;if(s!==n){const D=pe(n,h);if("error"===D.result)throw new Error(D.value.map(k=>`${k.key}: ${k.message}`).join(", "));w=(k,O,B,V,G)=>D.value.evaluate(k,O,{},B,void 0,void 0,V,G),T=!Io(D.value.expression)}return{filter:y,dynamicFilter:w||void 0,needGeometry:sc(s),needFeature:!!T}}function ya(t){if(!Array.isArray(t))return t;const e=function(n){if(Rl.has(n[0]))for(let s=1;s<n.length;s++)if(Eo(n[s]))return!0;return n}(t);return!0===e?e:e.map(n=>ya(n))}function va(t){let e=!1;const n=[];if("case"===t[0]){for(let s=1;s<t.length-1;s+=2)e=e||Eo(t[s]),n.push(t[s+1]);n.push(t[t.length-1])}else if("match"===t[0]){e=e||Eo(t[1]);for(let s=2;s<t.length-1;s+=2)n.push(t[s+1]);n.push(t[t.length-1])}else if("step"===t[0]){e=e||Eo(t[1]);for(let s=1;s<t.length-1;s+=2)n.push(t[s+1])}e&&(t.length=0,t.push("any",...n));for(let s=1;s<t.length;s++)va(t[s])}function Eo(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let n=1;n<t.length;n++)if(Eo(t[n]))return!0;return!1}const Rl=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function fl(t,e){return t<e?-1:t>e?1:0}function sc(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(sc(t[e]))return!0;return!1}function tl(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?kl(t[1],t[2],"=="):"!="===e?ml(kl(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?kl(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map(tl))):"all"===e?["all"].concat(t.slice(1).map(tl)):"none"===e?["all"].concat(t.slice(1).map(tl).map(ml)):"in"===e?pl(t[1],t.slice(2)):"!in"===e?ml(pl(t[1],t.slice(2))):"has"===e?ih(t[1]):"!has"===e?ml(ih(t[1])):"within"!==e||t;var n}function kl(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function pl(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(fl)]]:["filter-in-small",t,["literal",e]]}}function ih(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function ml(t){return["!",t]}function Tc(t){return dl(ls(t.value))?Ki(Qr({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):Eu(t)}function Eu(t){const e=t.value,n=t.key;if("array"!==Cn(e))return[new _t(n,e,`array expected, ${Cn(e)} found`)];const s=t.styleSpec;let h,g=[];if(e.length<1)return[new _t(n,e,"filter array must have at least 1 element")];switch(g=g.concat(_a({key:`${n}[0]`,value:e[0],valueSpec:s.filter_operator,style:t.style,styleSpec:t.styleSpec})),xi(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===xi(e[1])&&g.push(new _t(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&g.push(new _t(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=Cn(e[1]),"string"!==h&&g.push(new _t(`${n}[1]`,e[1],`string expected, ${h} found`)));for(let y=2;y<e.length;y++)h=Cn(e[y]),"$type"===xi(e[1])?g=g.concat(_a({key:`${n}[${y}]`,value:e[y],valueSpec:s.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&g.push(new _t(`${n}[${y}]`,e[y],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let y=1;y<e.length;y++)g=g.concat(Eu({key:`${n}[${y}]`,value:e[y],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":h=Cn(e[1]),2!==e.length?g.push(new _t(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==h&&g.push(new _t(`${n}[1]`,e[1],`string expected, ${h} found`));break;case"within":h=Cn(e[1]),2!==e.length?g.push(new _t(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==h&&g.push(new _t(`${n}[1]`,e[1],`object expected, ${h} found`))}return g}function es(t,e){const n=t.key,s=t.style,h=t.styleSpec,g=t.value,y=t.objectKey,w=h[`${e}_${t.layerType}`];if(!w)return[];const T=y.match(/^(.*)-transition$/);if("paint"===e&&T&&w[T[1]]&&w[T[1]].transition)return ns({key:n,value:g,valueSpec:h.transition,style:s,styleSpec:h});const D=t.valueSpec||w[y];if(!D)return[new _t(n,g,`unknown property "${y}"`)];let k;if("string"===Cn(g)&&ai(D)&&!D.tokens&&(k=/^{([^}]+)}$/.exec(g))){const B=`\`{ "type": "identity", "property": ${k?JSON.stringify(k[1]):'"_"'} }\``;return[new _t(n,g,`"${y}" does not support interpolation syntax\nUse an identity property function instead: ${B}.`)]}const O=[];return"symbol"===t.layerType&&("text-field"===y&&s&&!s.glyphs&&O.push(new _t(n,g,'use of "text-field" requires a style "glyphs" property')),"text-font"===y&&to(ls(g))&&"identity"===xi(g.type)&&O.push(new _t(n,g,'"text-font" does not support identity functions'))),O.concat(ns({key:t.key,value:g,valueSpec:D,style:s,styleSpec:h,expressionContext:"property",propertyType:e,propertyKey:y}))}function Tu(t){return es(t,"paint")}function Ll(t){return es(t,"layout")}function gl(t){let e=[];const n=t.value,s=t.key,h=t.style,g=t.styleSpec;n.type||n.ref||e.push(new _t(s,n,'either "type" or "ref" is required'));let y=xi(n.type);const w=xi(n.ref);if(n.id){const T=xi(n.id);for(let D=0;D<t.arrayIndex;D++){const k=h.layers[D];xi(k.id)===T&&e.push(new _t(s,n.id,`duplicate layer id "${n.id}", previously used at line ${k.id.__line__}`))}}if("ref"in n){let T;["type","source","source-layer","filter","layout"].forEach(D=>{D in n&&e.push(new _t(s,n[D],`"${D}" is prohibited for ref layers`))}),h.layers.forEach(D=>{xi(D.id)===w&&(T=D)}),T?T.ref?e.push(new _t(s,n.ref,"ref cannot reference another ref layer")):y=xi(T.type):"string"==typeof w&&e.push(new _t(s,n.ref,`ref layer "${w}" not found`))}else if("background"!==y&&"sky"!==y)if(n.source){const T=h.sources&&h.sources[n.source],D=T&&xi(T.type);T?"vector"===D&&"raster"===y?e.push(new _t(s,n.source,`layer "${n.id}" requires a raster source`)):"raster"===D&&"raster"!==y?e.push(new _t(s,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==D||n["source-layer"]?"raster-dem"===D&&"hillshade"!==y?e.push(new _t(s,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==y||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===D&&T.lineMetrics||e.push(new _t(s,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new _t(s,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new _t(s,n.source,`source "${n.source}" not found`))}else e.push(new _t(s,n,'missing required property "source"'));return e=e.concat(zi({key:s,value:n,valueSpec:g.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>ns({key:`${s}.type`,value:n.type,valueSpec:g.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:T=>Tc(Qr({layerType:y},T)),layout:T=>zi({layer:n,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":D=>Ll(Qr({layerType:y},D))}}),paint:T=>zi({layer:n,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":D=>Tu(Qr({layerType:y},D))}})}})),e}function _l(t){const e=t.value,n=t.key,s=Cn(e);return"string"!==s?[new _t(n,e,`string expected, ${s} found`)]:[]}const Ol={promoteId:function({key:t,value:e}){if("string"===Cn(e))return _l({key:t,value:e});{const n=[];for(const s in e)n.push(..._l({key:`${t}.${s}`,value:e[s]}));return n}}};function yl(t){const e=t.value,n=t.key,s=t.styleSpec,h=t.style;if(!e.type)return[new _t(n,e,'"type" is required')];const g=xi(e.type);let y;switch(g){case"vector":case"raster":case"raster-dem":return y=zi({key:n,value:e,valueSpec:s[`source_${g.replace("-","_")}`],style:t.style,styleSpec:s,objectElementValidators:Ol}),y;case"geojson":if(y=zi({key:n,value:e,valueSpec:s.source_geojson,style:h,styleSpec:s,objectElementValidators:Ol}),e.cluster)for(const w in e.clusterProperties){const[T,D]=e.clusterProperties[w],k="string"==typeof T?[T,["accumulated"],["get",w]]:T;y.push(...Ki({key:`${n}.${w}.map`,value:D,expressionContext:"cluster-map"})),y.push(...Ki({key:`${n}.${w}.reduce`,value:k,expressionContext:"cluster-reduce"}))}return y;case"video":return zi({key:n,value:e,valueSpec:s.source_video,style:h,styleSpec:s});case"image":return zi({key:n,value:e,valueSpec:s.source_image,style:h,styleSpec:s});case"canvas":return[new _t(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return _a({key:`${n}.type`,value:e.type,valueSpec:{values:Du(s)},style:h,styleSpec:s})}}function Du(t){return t.source.reduce((e,n)=>{const s=t[n];return"enum"===s.type.type&&(e=e.concat(Object.keys(s.type.values))),e},[])}function ts(t){const e=t.value,n=t.styleSpec,s=n.light,h=t.style;let g=[];const y=Cn(e);if(void 0===e)return g;if("object"!==y)return g=g.concat([new _t("light",e,`object expected, ${y} found`)]),g;for(const w in e){const T=w.match(/^(.*)-transition$/);g=g.concat(T&&s[T[1]]&&s[T[1]].transition?ns({key:w,value:e[w],valueSpec:n.transition,style:h,styleSpec:n}):s[w]?ns({key:w,value:e[w],valueSpec:s[w],style:h,styleSpec:n}):[new _t(w,e[w],`unknown property "${w}"`)])}return g}function Dc(t){const e=t.value,n=t.key,s=t.style,h=t.styleSpec,g=h.terrain;let y=[];const w=Cn(e);if(void 0===e)return y;if("object"!==w)return y=y.concat([new _t("terrain",e,`object expected, ${w} found`)]),y;for(const T in e){const D=T.match(/^(.*)-transition$/);y=y.concat(D&&g[D[1]]&&g[D[1]].transition?ns({key:T,value:e[T],valueSpec:h.transition,style:s,styleSpec:h}):g[T]?ns({key:T,value:e[T],valueSpec:g[T],style:s,styleSpec:h}):[new _t(T,e[T],`unknown property "${T}"`)])}if(e.source){const T=s.sources&&s.sources[e.source],D=T&&xi(T.type);T?"raster-dem"!==D&&y.push(new _t(n,e.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):y.push(new _t(n,e.source,`source "${e.source}" not found`))}else y.push(new _t(n,e,'terrain is missing required property "source"'));return y}function Fl(t){const e=t.value,n=t.style,s=t.styleSpec,h=s.fog;let g=[];const y=Cn(e);if(void 0===e)return g;if("object"!==y)return g=g.concat([new _t("fog",e,`object expected, ${y} found`)]),g;for(const w in e){const T=w.match(/^(.*)-transition$/);g=g.concat(T&&h[T[1]]&&h[T[1]].transition?ns({key:w,value:e[w],valueSpec:s.transition,style:n,styleSpec:s}):h[w]?ns({key:w,value:e[w],valueSpec:h[w],style:n,styleSpec:s}):[new _t(w,e[w],`unknown property "${w}"`)])}return g}const ac={"*":()=>[],array:qo,boolean:function(t){const e=t.value,n=t.key,s=Cn(e);return"boolean"!==s?[new _t(n,e,`boolean expected, ${s} found`)]:[]},number:Ci,color:function(t){const e=t.key,n=t.value,s=Cn(n);return"string"!==s?[new _t(e,n,`color expected, ${s} found`)]:null===oo(n)?[new _t(e,n,`color expected, "${n}" found`)]:[]},enum:_a,filter:Tc,function:ao,layer:gl,object:zi,source:yl,light:ts,terrain:Dc,fog:Fl,string:_l,formatted:function(t){return 0===_l(t).length?[]:Ki(t)},resolvedImage:function(t){return 0===_l(t).length?[]:Ki(t)},projection:function(t){const e=t.value,n=t.styleSpec,s=n.projection,h=t.style;let g=[];const y=Cn(e);if("object"===y)for(const w in e)g=g.concat(ns({key:w,value:e[w],valueSpec:s[w],style:h,styleSpec:n}));else"string"!==y&&(g=g.concat([new _t("projection",e,`object or string expected, ${y} found`)]));return g}};function ns(t){const e=t.value,n=t.valueSpec,s=t.styleSpec;return n.expression&&to(xi(e))?ao(t):n.expression&&$(ls(e))?Ki(t):n.type&&ac[n.type]?ac[n.type](t):zi(Qr({},t,{valueSpec:n.type?s[n.type]:n}))}function lc(t){const e=t.value,n=t.key,s=_l(t);return s.length||(-1===e.indexOf("{fontstack}")&&s.push(new _t(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&s.push(new _t(n,e,'"glyphs" url must include a "{range}" token'))),s}function vl(t,e=st){return Js(ns({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:lc,"*":()=>[]}}))}const Qh=t=>Js(Tu(t)),Gc=t=>Js(Ll(t));function Js(t){return t.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function nl(t,e){let n=!1;if(e&&e.length)for(const s of e)t.fire(new Xo(new Error(s.message))),n=!0;return n}var ko=xa;function xa(t,e,n){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var h=new Int32Array(this.arrayBuffer);t=h[0],this.d=(e=h[1])+2*(n=h[2]);for(var g=0;g<this.d*this.d;g++){var y=h[3+g],w=h[3+g+1];s.push(y===w?null:h.subarray(y,w))}var T=h[3+s.length+1];this.keys=h.subarray(h[3+s.length],T),this.bboxes=h.subarray(T),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var D=0;D<this.d*this.d;D++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var k=n/e*t;this.min=-k,this.max=t+k}xa.prototype.insert=function(t,e,n,s,h){this._forEachCell(e,n,s,h,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(h)},xa.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},xa.prototype._insertCell=function(t,e,n,s,h,g){this.cells[h].push(g)},xa.prototype.query=function(t,e,n,s,h){var g=this.min,y=this.max;if(t<=g&&e<=g&&y<=n&&y<=s&&!h)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(t,e,n,s,this._queryCell,w,{},h),w},xa.prototype._queryCell=function(t,e,n,s,h,g,y,w){var T=this.cells[h];if(null!==T)for(var D=this.keys,k=this.bboxes,O=0;O<T.length;O++){var B=T[O];if(void 0===y[B]){var V=4*B;(w?w(k[V+0],k[V+1],k[V+2],k[V+3]):t<=k[V+2]&&e<=k[V+3]&&n>=k[V+0]&&s>=k[V+1])?(y[B]=!0,g.push(D[B])):y[B]=!1}}},xa.prototype._forEachCell=function(t,e,n,s,h,g,y,w){for(var T=this._convertToCellCoord(t),D=this._convertToCellCoord(e),k=this._convertToCellCoord(n),O=this._convertToCellCoord(s),B=T;B<=k;B++)for(var V=D;V<=O;V++){var G=this.d*V+B;if((!w||w(this._convertFromCellCoord(B),this._convertFromCellCoord(V),this._convertFromCellCoord(B+1),this._convertFromCellCoord(V+1)))&&h.call(this,t,e,n,s,G,g,y,w))return}},xa.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},xa.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},xa.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,s=0;s<this.cells.length;s++)n+=this.cells[s].length;var h=new Int32Array(e+n+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var g=e,y=0;y<t.length;y++){var w=t[y];h[3+y]=g,h.set(w,g),g+=w.length}return h[3+t.length]=g,h.set(this.keys,g),h[3+t.length+1]=g+=this.keys.length,h.set(this.bboxes,g),g+=this.bboxes.length,h.buffer};const wa={};function yn(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),wa[e]={klass:t,omit:n.omit||[]}}yn(Object,"Object"),ko.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},ko.deserialize=function(t){return new ko(t.buffer)},Object.defineProperty(ko,"name",{value:"Grid"}),yn(ko,"Grid"),yn(Hr,"Color"),yn(Error,"Error"),yn(ht,"AJAXError"),yn(co,"ResolvedImage"),yn(qn,"StylePropertyFunction"),yn(P,"StyleExpression",{omit:["_evaluator"]}),yn(Ot,"ZoomDependentExpression"),yn(We,"ZoomConstantExpression"),yn(So,"CompoundExpression",{omit:["_evaluate"]});for(const t in Tr)wa[Tr[t]._classRegistryKey]||yn(Tr[t],`Expression${t}`);function Cc(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Cs(t){return Le.ImageBitmap&&t instanceof Le.ImageBitmap}function Qs(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Cc(t)||Cs(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.push(n.buffer),n}if(t instanceof Le.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const s of t)n.push(Qs(s,e));return n}if("object"==typeof t){const n=t.constructor,s=n._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const h=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const g in t)t.hasOwnProperty(g)&&(wa[s].omit.indexOf(g)>=0||(h[g]=Qs(t[g],e)));t instanceof Error&&(h.message=t.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(h.$name=s),h}throw new Error("can't serialize object of type "+typeof t)}function Ra(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Cc(t)||Cs(t)||ArrayBuffer.isView(t)||t instanceof Le.ImageData)return t;if(Array.isArray(t))return t.map(Ra);if("object"==typeof t){const e=t.$name||"Object",{klass:n}=wa[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const s=Object.create(n.prototype);for(const h of Object.keys(t))"$name"!==h&&(s[h]=Ra(t[h]));return s}throw new Error("can't deserialize object of type "+typeof t)}const $a=t=>t>=1536&&t<=1791,Cu=t=>t>=1872&&t<=1919,zl=t=>t>=2208&&t<=2303,rl=t=>t>=11904&&t<=12031,Sc=t=>t>=12032&&t<=12255,Hc=t=>t>=12272&&t<=12287,li=t=>t>=12288&&t<=12351,qc=t=>t>=12352&&t<=12447,Bl=t=>t>=12448&&t<=12543,Wc=t=>t>=12544&&t<=12591,ed=t=>t>=12704&&t<=12735,td=t=>t>=12736&&t<=12783,oh=t=>t>=12784&&t<=12799,cc=t=>t>=12800&&t<=13055,uc=t=>t>=13056&&t<=13311,Su=t=>t>=13312&&t<=19903,Mu=t=>t>=19968&&t<=40959,go=t=>t>=40960&&t<=42127,Mc=t=>t>=42128&&t<=42191,Nl=t=>t>=44032&&t<=55215,Iu=t=>t>=63744&&t<=64255,_s=t=>t>=64336&&t<=65023,ba=t=>t>=65040&&t<=65055,p=t=>t>=65072&&t<=65103,r=t=>t>=65104&&t<=65135,l=t=>t>=65136&&t<=65279,_=t=>t>=65280&&t<=65519;function u(t){for(const e of t)if(v(e.charCodeAt(0)))return!0;return!1}function d(t){for(const e of t)if(!f(e.charCodeAt(0)))return!1;return!0}function f(t){return!($a(t)||Cu(t)||zl(t)||_s(t)||l(t))}function v(t){return!(746!==t&&747!==t&&(t<4352||!(ed(t)||Wc(t)||p(t)&&!(t>=65097&&t<=65103)||Iu(t)||uc(t)||rl(t)||td(t)||!(!li(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Su(t)||Mu(t)||cc(t)||(e=t,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||Nl(t)||qc(t)||Hc(t)||(e=>e>=12688&&e<=12703)(t)||Sc(t)||oh(t)||Bl(t)&&12540!==t||!(!_(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!r(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||ba(t)||(e=>e>=19904&&e<=19967)(t)||go(t)||Mc(t))));var e}function b(t){return!(v(t)||(e=t,(n=e)>=128&&n<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(n=>n>=8192&&n<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(n=>n>=8448&&n<=8527)(e)||(n=>n>=8528&&n<=8591)(e)||(n=>n>=8960&&n<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(n=>n>=9216&&n<=9279)(e)&&9251!==e||(n=>n>=9280&&n<=9311)(e)||(n=>n>=9312&&n<=9471)(e)||(n=>n>=9632&&n<=9727)(e)||(n=>n>=9728&&n<=9983)(e)&&!(e>=9754&&e<=9759)||(n=>n>=11008&&n<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||li(e)||Bl(e)||(n=>n>=57344&&n<=63743)(e)||p(e)||r(e)||_(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,n}function C(t){return t>=1424&&t<=2303||_s(t)||l(t)}function S(t,e){return!(!e&&C(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(n=t,n>=6016&&n<=6143));var n}function z(t){for(const e of t)if(C(e.charCodeAt(0)))return!0;return!1}const H="deferred",ee="loading",re="loaded";let ue=null,fe="unavailable",ne=null;const we=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(fe="error"),ue&&ue(t)};function xe(){be.fire(new Cr("pluginStateChange",{pluginStatus:fe,pluginURL:ne}))}const be=new ki,Re=function(){return fe},Ae=function(){if(fe!==H||!ne)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");fe=ee,xe(),ne&&tr({url:ne},t=>{t?we(t):(fe=re,xe())})},ze={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>fe===re||null!=ze.applyArabicShaping,isLoading:()=>fe===ee,setState(t){fe=t.pluginStatus,ne=t.pluginURL},isParsed:()=>null!=ze.applyArabicShaping&&null!=ze.processBidirectionalText&&null!=ze.processStyledBidirectionalText,getPluginURL:()=>ne};class qe{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(n,s){for(const h of n)if(!S(h.charCodeAt(0),s))return!1;return!0}(e,ze.isLoaded())}}class Ke{constructor(e,n){this.property=e,this.value=n,this.expression=function(s,h){if(to(s))return new qn(s,h);if($(s)){const g=_n(s,h);if("error"===g.result)throw new Error(g.value.map(y=>`${y.key}: ${y.message}`).join(", "));return g.value}{let g=s;return"string"==typeof s&&"color"===h.type&&(g=Hr.parse(s)),{kind:"constant",evaluate:()=>g}}}(void 0===n?e.specification.default:n,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,n,s){return this.property.possiblyEvaluate(this,e,n,s)}}class Qe{constructor(e){this.property=e,this.value=new Ke(e,void 0)}transitioned(e,n){return new Ze(this.property,this.value,n,$e({},e.transition,this.transition),e.now)}untransitioned(){return new Ze(this.property,this.value,null,{},0)}}class Ht{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return Vn(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Qe(this._values[e].property)),this._values[e].value=new Ke(this._values[e].property,null===n?void 0:Vn(n))}getTransition(e){return Vn(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Qe(this._values[e].property)),this._values[e].transition=Vn(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);void 0!==s&&(e[n]=s);const h=this.getTransition(n);void 0!==h&&(e[`${n}-transition`]=h)}return e}transitioned(e,n){const s=new bt(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].transitioned(e,n._values[h]);return s}untransitioned(){const e=new bt(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class Ze{constructor(e,n,s,h,g){const y=h.delay||0,w=h.duration||0;g=g||0,this.property=e,this.value=n,this.begin=g+y,this.end=this.begin+w,e.specification.transition&&(h.delay||h.duration)&&(this.prior=s)}possiblyEvaluate(e,n,s){const h=e.now||0,g=this.value.possiblyEvaluate(e,n,s),y=this.prior;if(y){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return y.possiblyEvaluate(e,n,s);{const w=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(y.possiblyEvaluate(e,n,s),g,Me(w))}}return g}}class bt{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,s){const h=new Ye(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(e,n,s);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class ut{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return Vn(this._values[e].value)}setValue(e,n){this._values[e]=new Ke(this._values[e].property,null===n?void 0:Vn(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);void 0!==s&&(e[n]=s)}return e}possiblyEvaluate(e,n,s){const h=new Ye(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(e,n,s);return h}}class Ct{constructor(e,n,s){this.property=e,this.value=n,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,n,s,h){return this.property.evaluate(this.value,this.parameters,e,n,s,h)}}class Ye{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class He{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,s){const h=ri[this.specification.type];return h?h(e,n,s):e}}class rt{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,s,h){return new Ct(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(n,null,{},s,h)}:e.expression,n)}interpolate(e,n,s){if("constant"!==e.value.kind||"constant"!==n.value.kind)return e;if(void 0===e.value.value||void 0===n.value.value)return new Ct(this,{kind:"constant",value:void 0},e.parameters);const h=ri[this.specification.type];return h?new Ct(this,{kind:"constant",value:h(e.value.value,n.value.value,s)},e.parameters):e}evaluate(e,n,s,h,g,y){return"constant"===e.kind?e.value:e.evaluate(n,s,h,g,y)}}class St{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,h){return!!e.expression.evaluate(n,null,{},s,h)}interpolate(){return!1}}class Nt{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new qe(0,{});for(const s in e){const h=e[s];h.specification.overridable&&this.overridableProperties.push(s);const g=this.defaultPropertyValues[s]=new Ke(h,void 0),y=this.defaultTransitionablePropertyValues[s]=new Qe(h);this.defaultTransitioningPropertyValues[s]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=g.possiblyEvaluate(n)}}}function An(t,e){return 256*(t=ft(Math.floor(t),0,255))+ft(Math.floor(e),0,255)}yn(rt,"DataDrivenProperty"),yn(He,"DataConstantProperty"),yn(St,"ColorRampProperty");const _r={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class wn{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ln{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Sn(t,e=1){let n=0,s=0;return{members:t.map(h=>{const g=_r[h.type].BYTES_PER_ELEMENT,y=n=Mr(n,Math.max(e,g)),w=h.components||1;return s=Math.max(s,g),n+=g*w,{name:h.name,type:h.type,components:w,offset:y}}),size:Mr(n,Math.max(s,e)),alignment:e}}function Mr(t,e){return Math.ceil(t/e)*e}class Fn extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const h=2*e;return this.int16[h+0]=n,this.int16[h+1]=s,e}}Fn.prototype.bytesPerElement=4,yn(Fn,"StructArrayLayout2i4");class ei extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s)}emplace(e,n,s,h){const g=3*e;return this.int16[g+0]=n,this.int16[g+1]=s,this.int16[g+2]=h,e}}ei.prototype.bytesPerElement=6,yn(ei,"StructArrayLayout3i6");class ci extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,h)}emplace(e,n,s,h,g){const y=4*e;return this.int16[y+0]=n,this.int16[y+1]=s,this.int16[y+2]=h,this.int16[y+3]=g,e}}ci.prototype.bytesPerElement=8,yn(ci,"StructArrayLayout4i8");class bi extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,y,w){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,s,h,g,y,w)}emplace(e,n,s,h,g,y,w,T){const D=6*e,k=12*e,O=3*e;return this.int16[D+0]=n,this.int16[D+1]=s,this.uint8[k+4]=h,this.uint8[k+5]=g,this.uint8[k+6]=y,this.uint8[k+7]=w,this.float32[O+2]=T,e}}bi.prototype.bytesPerElement=12,yn(bi,"StructArrayLayout2i4ub1f12");class Si extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,h)}emplace(e,n,s,h,g){const y=4*e;return this.float32[y+0]=n,this.float32[y+1]=s,this.float32[y+2]=h,this.float32[y+3]=g,e}}Si.prototype.bytesPerElement=16,yn(Si,"StructArrayLayout4f16");class To extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,s,h,g)}emplace(e,n,s,h,g,y){const w=6*e,T=3*e;return this.uint16[w+0]=n,this.uint16[w+1]=s,this.uint16[w+2]=h,this.uint16[w+3]=g,this.float32[T+2]=y,e}}To.prototype.bytesPerElement=12,yn(To,"StructArrayLayout4ui1f12");class ea extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,h)}emplace(e,n,s,h,g){const y=4*e;return this.uint16[y+0]=n,this.uint16[y+1]=s,this.uint16[y+2]=h,this.uint16[y+3]=g,e}}ea.prototype.bytesPerElement=8,yn(ea,"StructArrayLayout4ui8");class Ea extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,s,h,g,y)}emplace(e,n,s,h,g,y,w){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=s,this.int16[T+2]=h,this.int16[T+3]=g,this.int16[T+4]=y,this.int16[T+5]=w,e}}Ea.prototype.bytesPerElement=12,yn(Ea,"StructArrayLayout6i12");class Ul extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,y,w,T,D,k,O,B){const V=this.length;return this.resize(V+1),this.emplace(V,e,n,s,h,g,y,w,T,D,k,O,B)}emplace(e,n,s,h,g,y,w,T,D,k,O,B,V){const G=12*e;return this.int16[G+0]=n,this.int16[G+1]=s,this.int16[G+2]=h,this.int16[G+3]=g,this.uint16[G+4]=y,this.uint16[G+5]=w,this.uint16[G+6]=T,this.uint16[G+7]=D,this.int16[G+8]=k,this.int16[G+9]=O,this.int16[G+10]=B,this.int16[G+11]=V,e}}Ul.prototype.bytesPerElement=24,yn(Ul,"StructArrayLayout4i4ui4i24");class Yi extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,y){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,s,h,g,y)}emplace(e,n,s,h,g,y,w){const T=10*e,D=5*e;return this.int16[T+0]=n,this.int16[T+1]=s,this.int16[T+2]=h,this.float32[D+2]=g,this.float32[D+3]=y,this.float32[D+4]=w,e}}Yi.prototype.bytesPerElement=20,yn(Yi,"StructArrayLayout3i3f20");class ui extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}ui.prototype.bytesPerElement=4,yn(ui,"StructArrayLayout1ul4");class ti extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,y,w,T,D,k,O,B,V){const G=this.length;return this.resize(G+1),this.emplace(G,e,n,s,h,g,y,w,T,D,k,O,B,V)}emplace(e,n,s,h,g,y,w,T,D,k,O,B,V,G){const J=20*e,he=10*e;return this.int16[J+0]=n,this.int16[J+1]=s,this.int16[J+2]=h,this.int16[J+3]=g,this.int16[J+4]=y,this.float32[he+3]=w,this.float32[he+4]=T,this.float32[he+5]=D,this.float32[he+6]=k,this.int16[J+14]=O,this.uint32[he+8]=B,this.uint16[J+18]=V,this.uint16[J+19]=G,e}}ti.prototype.bytesPerElement=40,yn(ti,"StructArrayLayout5i4f1i1ul2ui40");class _o extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,y,w){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,s,h,g,y,w)}emplace(e,n,s,h,g,y,w,T){const D=8*e;return this.int16[D+0]=n,this.int16[D+1]=s,this.int16[D+2]=h,this.int16[D+4]=g,this.int16[D+5]=y,this.int16[D+6]=w,this.int16[D+7]=T,e}}_o.prototype.bytesPerElement=16,yn(_o,"StructArrayLayout3i2i2i16");class js extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,s,h,g)}emplace(e,n,s,h,g,y){const w=4*e,T=8*e;return this.float32[w+0]=n,this.float32[w+1]=s,this.float32[w+2]=h,this.int16[T+6]=g,this.int16[T+7]=y,e}}js.prototype.bytesPerElement=16,yn(js,"StructArrayLayout2f1f2i16");class Gi extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,h)}emplace(e,n,s,h,g){const y=12*e,w=3*e;return this.uint8[y+0]=n,this.uint8[y+1]=s,this.float32[w+1]=h,this.float32[w+2]=g,e}}Gi.prototype.bytesPerElement=12,yn(Gi,"StructArrayLayout2ub2f12");class Vs extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s)}emplace(e,n,s,h){const g=3*e;return this.float32[g+0]=n,this.float32[g+1]=s,this.float32[g+2]=h,e}}Vs.prototype.bytesPerElement=12,yn(Vs,"StructArrayLayout3f12");class Ss extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s)}emplace(e,n,s,h){const g=3*e;return this.uint16[g+0]=n,this.uint16[g+1]=s,this.uint16[g+2]=h,e}}Ss.prototype.bytesPerElement=6,yn(Ss,"StructArrayLayout3ui6");class xl extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,y,w,T,D,k,O,B,V,G,J,he,ve,Ie,ye,Ce,ke){const Pe=this.length;return this.resize(Pe+1),this.emplace(Pe,e,n,s,h,g,y,w,T,D,k,O,B,V,G,J,he,ve,Ie,ye,Ce,ke)}emplace(e,n,s,h,g,y,w,T,D,k,O,B,V,G,J,he,ve,Ie,ye,Ce,ke,Pe){const et=30*e,Xe=15*e,pt=60*e;return this.int16[et+0]=n,this.int16[et+1]=s,this.int16[et+2]=h,this.float32[Xe+2]=g,this.float32[Xe+3]=y,this.uint16[et+8]=w,this.uint16[et+9]=T,this.uint32[Xe+5]=D,this.uint32[Xe+6]=k,this.uint32[Xe+7]=O,this.uint16[et+16]=B,this.uint16[et+17]=V,this.uint16[et+18]=G,this.float32[Xe+10]=J,this.float32[Xe+11]=he,this.uint8[pt+48]=ve,this.uint8[pt+49]=Ie,this.uint8[pt+50]=ye,this.uint32[Xe+13]=Ce,this.int16[et+28]=ke,this.uint8[pt+58]=Pe,e}}xl.prototype.bytesPerElement=60,yn(xl,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class jl extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,y,w,T,D,k,O,B,V,G,J,he,ve,Ie,ye,Ce,ke,Pe,et,Xe,pt,Vt,it,xt,Tt,Pt){const jt=this.length;return this.resize(jt+1),this.emplace(jt,e,n,s,h,g,y,w,T,D,k,O,B,V,G,J,he,ve,Ie,ye,Ce,ke,Pe,et,Xe,pt,Vt,it,xt,Tt,Pt)}emplace(e,n,s,h,g,y,w,T,D,k,O,B,V,G,J,he,ve,Ie,ye,Ce,ke,Pe,et,Xe,pt,Vt,it,xt,Tt,Pt,jt){const at=38*e,Jt=19*e;return this.int16[at+0]=n,this.int16[at+1]=s,this.int16[at+2]=h,this.float32[Jt+2]=g,this.float32[Jt+3]=y,this.int16[at+8]=w,this.int16[at+9]=T,this.int16[at+10]=D,this.int16[at+11]=k,this.int16[at+12]=O,this.int16[at+13]=B,this.uint16[at+14]=V,this.uint16[at+15]=G,this.uint16[at+16]=J,this.uint16[at+17]=he,this.uint16[at+18]=ve,this.uint16[at+19]=Ie,this.uint16[at+20]=ye,this.uint16[at+21]=Ce,this.uint16[at+22]=ke,this.uint16[at+23]=Pe,this.uint16[at+24]=et,this.uint16[at+25]=Xe,this.uint16[at+26]=pt,this.uint16[at+27]=Vt,this.uint16[at+28]=it,this.uint32[Jt+15]=xt,this.float32[Jt+16]=Tt,this.float32[Jt+17]=Pt,this.float32[Jt+18]=jt,e}}jl.prototype.bytesPerElement=76,yn(jl,"StructArrayLayout3i2f6i15ui1ul3f76");class ta extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}ta.prototype.bytesPerElement=4,yn(ta,"StructArrayLayout1f4");class Ta extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g){const y=this.length;return this.resize(y+1),this.emplace(y,e,n,s,h,g)}emplace(e,n,s,h,g,y){const w=5*e;return this.float32[w+0]=n,this.float32[w+1]=s,this.float32[w+2]=h,this.float32[w+3]=g,this.float32[w+4]=y,e}}Ta.prototype.bytesPerElement=20,yn(Ta,"StructArrayLayout5f20");class il extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,h)}emplace(e,n,s,h,g){const y=6*e;return this.uint32[3*e+0]=n,this.uint16[y+2]=s,this.uint16[y+3]=h,this.uint16[y+4]=g,e}}il.prototype.bytesPerElement=12,yn(il,"StructArrayLayout1ul3ui12");class ys extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const h=2*e;return this.uint16[h+0]=n,this.uint16[h+1]=s,e}}ys.prototype.bytesPerElement=4,yn(ys,"StructArrayLayout2ui4");class Vl extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Vl.prototype.bytesPerElement=2,yn(Vl,"StructArrayLayout1ui2");class Ic extends ln{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const h=2*e;return this.float32[h+0]=n,this.float32[h+1]=s,e}}Ic.prototype.bytesPerElement=8,yn(Ic,"StructArrayLayout2f8");class Jp extends wn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Jp.prototype.size=40;class nd extends ti{get(e){return new Jp(this,e)}}yn(nd,"CollisionBoxArray");class rd extends wn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}rd.prototype.size=60;class Qp extends xl{get(e){return new rd(this,e)}}yn(Qp,"PlacedSymbolArray");class em extends wn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}em.prototype.size=76;class tm extends jl{get(e){return new em(this,e)}}yn(tm,"SymbolInstanceArray");class _f extends ta{getoffsetX(e){return this.float32[1*e+0]}}yn(_f,"GlyphOffsetArray");class nm extends Fn{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}yn(nm,"SymbolLineVertexArray");class rm extends wn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}rm.prototype.size=12;class Da extends il{get(e){return new rm(this,e)}}yn(Da,"FeatureIndexArray");class id extends ys{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}yn(id,"FillExtrusionCentroidArray");const im=Sn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),yf=Sn([{name:"a_dash",components:4,type:"Uint16"}]);var Lo={},sh={get exports(){return Lo},set exports(t){Lo=t}},od={};({get exports(){return od},set exports(t){od=t}}).exports=function(t,e){var n,s,h,g,y,w,T,D;for(s=t.length-(n=3&t.length),h=e,y=3432918353,w=461845907,D=0;D<s;)T=255&t.charCodeAt(D)|(255&t.charCodeAt(++D))<<8|(255&t.charCodeAt(++D))<<16|(255&t.charCodeAt(++D))<<24,++D,h=27492+(65535&(g=5*(65535&(h=(h^=T=(65535&(T=(T=(65535&T)*y+(((T>>>16)*y&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(T=0,n){case 3:T^=(255&t.charCodeAt(D+2))<<16;case 2:T^=(255&t.charCodeAt(D+1))<<8;case 1:h^=T=(65535&(T=(T=(65535&(T^=255&t.charCodeAt(D)))*y+(((T>>>16)*y&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295}return h^=t.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var sd={};({get exports(){return sd},set exports(t){sd=t}}).exports=function(t,e){for(var n,s=t.length,h=e^s,g=0;s>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(g)|(255&t.charCodeAt(++g))<<8|(255&t.charCodeAt(++g))<<16|(255&t.charCodeAt(++g))<<24))+((1540483477*(n>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),s-=4,++g;switch(s){case 3:h^=(255&t.charCodeAt(g+2))<<16;case 2:h^=(255&t.charCodeAt(g+1))<<8;case 1:h=1540483477*(65535&(h^=255&t.charCodeAt(g)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var om=od,sm=sd;sh.exports=om,Lo.murmur3=om,Lo.murmur2=sm;class ad{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,s,h){this.ids.push(vf(e)),this.positions.push(n,s,h)}getPositions(e){const n=vf(e);let s=0,h=this.ids.length-1;for(;s<h;){const y=s+h>>1;this.ids[y]>=n?h=y:s=y+1}const g=[];for(;this.ids[s]===n;)g.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return g}static serialize(e,n){const s=new Float64Array(e.ids),h=new Uint32Array(e.positions);return xf(s,h,0,s.length-1),n&&n.push(s.buffer,h.buffer),{ids:s,positions:h}}static deserialize(e){const n=new ad;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function vf(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:Lo(String(t))}function xf(t,e,n,s){for(;n<s;){const h=t[n+s>>1];let g=n-1,y=s+1;for(;;){do{g++}while(t[g]<h);do{y--}while(t[y]>h);if(g>=y)break;ah(t,g,y),ah(e,3*g,3*y),ah(e,3*g+1,3*y+1),ah(e,3*g+2,3*y+2)}y-n<s-y?(xf(t,e,n,y),n=y+1):(xf(t,e,y+1,s),s=y)}}function ah(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}yn(ad,"FeaturePositionMap");class hc{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class ld extends hc{constructor(e){super(e),this.current=0}set(e,n,s){this.fetchUniformLocation(e,n)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class cd extends hc{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,s){this.fetchUniformLocation(e,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class ud extends hc{constructor(e){super(e),this.current=Hr.transparent}set(e,n,s){this.fetchUniformLocation(e,n)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const Wg=new Float32Array(16),lh=new Float32Array(9),Zg=new Float32Array(4);function wf(t){return[An(255*t.r,255*t.g),An(255*t.b,255*t.a)]}class Zc{constructor(e,n,s){this.value=e,this.uniformNames=n.map(h=>`u_${h}`),this.type=s}setUniform(e,n,s,h,g){n.set(e,g,h.constantOr(this.value))}getBinding(e,n){return"color"===this.type?new ud(e):new ld(e)}}class Ac{constructor(e,n){this.uniformNames=n.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,s,h,g){const y="u_pattern"===g||"u_dash"===g?this.pattern:"u_pixel_ratio"===g?this.pixelRatio:null;y&&n.set(e,g,y)}getBinding(e,n){return"u_pattern"===n||"u_dash"===n?new cd(e):new ld(e)}}class $l{constructor(e,n,s,h){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=n.map(g=>({name:`a_${g}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,n,s,h,g,y){const w=this.paintVertexArray.length,T=this.expression.evaluate(new qe(0),n,{},g,h,y);this.paintVertexArray.resize(e),this._setPaintValue(w,e,T)}updatePaintArray(e,n,s,h,g){const y=this.expression.evaluate({zoom:0},s,h,void 0,g);this._setPaintValue(e,n,y)}_setPaintValue(e,n,s){if("color"===this.type){const h=wf(s);for(let g=e;g<n;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class na{constructor(e,n,s,h,g,y){this.expression=e,this.uniformNames=n.map(w=>`u_${w}_t`),this.type=s,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=n.map(w=>({name:`a_${w}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new y}populatePaintArray(e,n,s,h,g,y){const w=this.expression.evaluate(new qe(this.zoom),n,{},g,h,y),T=this.expression.evaluate(new qe(this.zoom+1),n,{},g,h,y),D=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(D,e,w,T)}updatePaintArray(e,n,s,h,g){const y=this.expression.evaluate({zoom:this.zoom},s,h,void 0,g),w=this.expression.evaluate({zoom:this.zoom+1},s,h,void 0,g);this._setPaintValue(e,n,y,w)}_setPaintValue(e,n,s,h){if("color"===this.type){const g=wf(s),y=wf(h);for(let w=e;w<n;w++)this.paintVertexArray.emplace(w,g[0],g[1],y[0],y[1])}else{for(let g=e;g<n;g++)this.paintVertexArray.emplace(g,s,h);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,s,h,g){const y=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,w=ft(this.expression.interpolationFactor(y,this.zoom,this.zoom+1),0,1);n.set(e,g,w)}getBinding(e,n){return new ld(e)}}class Gl{constructor(e,n,s,h,g){this.expression=e,this.layerId=g,this.paintVertexAttributes=("array"===s?yf:im).members;for(let y=0;y<n.length;++y);this.paintVertexArray=new h}populatePaintArray(e,n,s){const h=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(h,e,n.patterns&&n.patterns[this.layerId],s)}updatePaintArray(e,n,s,h,g,y){this._setPaintValues(e,n,s.patterns&&s.patterns[this.layerId],y)}_setPaintValues(e,n,s,h){if(!h||!s)return;const g=h[s];if(!g)return;const{tl:y,br:w,pixelRatio:T}=g;for(let D=e;D<n;D++)this.paintVertexArray.emplace(D,y[0],y[1],w[0],w[1],T)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class dc{constructor(e,n,s=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const g in e.paint._values){if(!s(g))continue;const y=e.paint.get(g);if(!(y instanceof Ct&&ai(y.property.specification)))continue;const w=Xg(g,e.type),T=y.value,D=y.property.specification.type,k=!!y.property.useIntegerZoom,O="line-dasharray"===g||g.endsWith("pattern"),B="line-dasharray"===g&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==T.kind||B)if("source"===T.kind||B||O){const V=am(g,D,"source");this.binders[g]=O?new Gl(T,w,D,V,e.id):new $l(T,w,D,V),h.push(`/a_${g}`)}else{const V=am(g,D,"composite");this.binders[g]=new na(T,w,D,k,n,V),h.push(`/z_${g}`)}else this.binders[g]=O?new Ac(T.value,w):new Zc(T.value,w,D),h.push(`/u_${g}`)}this.cacheKey=h.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof $l||n instanceof na?n.maxValue:0}populatePaintArrays(e,n,s,h,g,y){for(const w in this.binders){const T=this.binders[w];(T instanceof $l||T instanceof na||T instanceof Gl)&&T.populatePaintArray(e,n,s,h,g,y)}}setConstantPatternPositions(e){for(const n in this.binders){const s=this.binders[n];s instanceof Ac&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,n,s,h,g,y){let w=!1;for(const T in e){const D=n.getPositions(T);for(const k of D){const O=s.feature(k.index);for(const B in this.binders){const V=this.binders[B];if((V instanceof $l||V instanceof na||V instanceof Gl)&&!0===V.expression.isStateDependent){const G=h.paint.get(B);V.expression=G.value,V.updatePaintArray(k.start,k.end,O,e[T],g,y),w=!0}}}}return w}defines(){const e=[];for(const n in this.binders){const s=this.binders[n];(s instanceof Zc||s instanceof Ac)&&e.push(...s.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof $l||s instanceof na||s instanceof Gl)for(let h=0;h<s.paintVertexAttributes.length;h++)e.push(s.paintVertexAttributes[h].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof Zc||s instanceof Ac||s instanceof na)for(const h of s.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof Zc||h instanceof Ac||h instanceof na)for(const g of h.uniformNames)n.push({name:g,property:s,binding:h.getBinding(e,g)})}return n}setUniforms(e,n,s,h,g){for(const{name:y,property:w,binding:T}of s)this.binders[w].setUniform(e,T,g,h.get(w),y)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof $l||n instanceof na||n instanceof Gl)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const s=this.binders[n];(s instanceof $l||s instanceof na||s instanceof Gl)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof $l||n instanceof na||n instanceof Gl)&&n.destroy()}}}class Xc{constructor(e,n,s=(()=>!0)){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new dc(h,n,s);this.needsUpload=!1,this._featureMap=new ad,this._bufferOffset=0}populatePaintArrays(e,n,s,h,g,y,w){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(e,n,h,g,y,w);void 0!==n.id&&this._featureMap.add(n.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,s,h,g){for(const y of s)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(e,this._featureMap,n,y,h,g)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const bf={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Xg(t,e){return bf[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Kg={"line-pattern":{source:To,composite:To},"fill-pattern":{source:To,composite:To},"fill-extrusion-pattern":{source:To,composite:To},"line-dasharray":{source:ea,composite:ea}},Yg={color:{source:Ic,composite:Si},number:{source:ta,composite:Ic}};function am(t,e,n){const s=Kg[t];return s&&s[n]||Yg[e][n]}yn(Zc,"ConstantBinder"),yn(Ac,"PatternConstantBinder"),yn($l,"SourceExpressionBinder"),yn(Gl,"PatternCompositeBinder"),yn(na,"CompositeExpressionBinder"),yn(dc,"ProgramConfiguration",{omit:["_buffers"]}),yn(Xc,"ProgramConfigurationSet");const hd="-transition";class wl extends ki{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new ut(n.layout)),n.paint)){this._transitionablePaint=new Ht(n.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ye(n.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,s={}){null!=n&&this._validate(Gc,`layers.${this.id}.layout.${e}`,e,n,s)||("visibility"!==e?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return vr(e,hd)?this._transitionablePaint.getTransition(e.slice(0,-hd.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,s={}){if(null!=n&&this._validate(Qh,`layers.${this.id}.paint.${e}`,e,n,s))return!1;if(vr(e,hd))return this._transitionablePaint.setTransition(e.slice(0,-hd.length),n||void 0),!1;{const h=this._transitionablePaint._values[e],g=h.value.isDataDriven(),y=h.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const w=this._transitionablePaint._values[e].value,T=w.isDataDriven(),D=vr(e,"pattern")||"line-dasharray"===e;return T||g||D||this._handleOverridablePaintPropertyUpdate(e,y,w)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,n,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),er(e,(n,s)=>!(void 0===n||"layout"===s&&!Object.keys(n).length||"paint"===s&&!Object.keys(n).length))}_validate(e,n,s,h,g={}){return(!g||!1!==g.validate)&&nl(this,e.call(vl,{key:n,layerType:this.type,objectKey:s,value:h,styleSpec:st,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof Ct&&ai(n.property.specification)&&("source"===n.value.kind||"composite"===n.value.kind)&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Pl(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const lm=Sn([{name:"a_pos",components:2,type:"Int16"}],4),Ef=Sn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class yo{constructor(e=[]){this.segments=e}prepareSegment(e,n,s,h){let g=this.segments[this.segments.length-1];return e>yo.MAX_VERTEX_ARRAY_LENGTH&&cr(`Max vertices per segment is ${yo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!g||g.vertexLength+e>yo.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:n.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},void 0!==h&&(g.sortKey=h),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,s,h){return new yo([{vertexOffset:e,primitiveOffset:n,vertexLength:s,primitiveLength:h,vaos:{},sortKey:0}])}}yo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,yn(yo,"SegmentVector");var Wn=8192;class Pc{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof qr?new qr(e.lng,e.lat):qr.convert(e),this}setSouthWest(e){return this._sw=e instanceof qr?new qr(e.lng,e.lat):qr.convert(e),this}extend(e){const n=this._sw,s=this._ne;let h,g;if(e instanceof qr)h=e,g=e;else{if(!(e instanceof Pc))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Pc.convert(e)):this.extend(qr.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(qr.convert(e)):this;if(h=e._sw,g=e._ne,!h||!g)return this}return n||s?(n.lng=Math.min(h.lng,n.lng),n.lat=Math.min(h.lat,n.lat),s.lng=Math.max(g.lng,s.lng),s.lat=Math.max(g.lat,s.lat)):(this._sw=new qr(h.lng,h.lat),this._ne=new qr(g.lng,g.lat)),this}getCenter(){return new qr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new qr(this.getWest(),this.getNorth())}getSouthEast(){return new qr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:s}=qr.convert(e);let h=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&h}static convert(e){return!e||e instanceof Pc?e:new Pc(e)}}var dd=1e-6,Ca=typeof Float32Array<"u"?Float32Array:Array;function Tf(){var t=new Ca(9);return Ca!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Rc(t,e,n){var s=e[0],h=e[1],g=e[2],y=e[3],w=e[4],T=e[5],D=e[6],k=e[7],O=e[8],B=n[0],V=n[1],G=n[2],J=n[3],he=n[4],ve=n[5],Ie=n[6],ye=n[7],Ce=n[8];return t[0]=B*s+V*y+G*D,t[1]=B*h+V*w+G*k,t[2]=B*g+V*T+G*O,t[3]=J*s+he*y+ve*D,t[4]=J*h+he*w+ve*k,t[5]=J*g+he*T+ve*O,t[6]=Ie*s+ye*y+Ce*D,t[7]=Ie*h+ye*w+Ce*k,t[8]=Ie*g+ye*T+Ce*O,t}function ol(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function fd(t,e){var n=e[0],s=e[1],h=e[2],g=e[3],y=e[4],w=e[5],T=e[6],D=e[7],k=e[8],O=e[9],B=e[10],V=e[11],G=e[12],J=e[13],he=e[14],ve=e[15],Ie=n*w-s*y,ye=n*T-h*y,Ce=n*D-g*y,ke=s*T-h*w,Pe=s*D-g*w,et=h*D-g*T,Xe=k*J-O*G,pt=k*he-B*G,Vt=k*ve-V*G,it=O*he-B*J,xt=O*ve-V*J,Tt=B*ve-V*he,Pt=Ie*Tt-ye*xt+Ce*it+ke*Vt-Pe*pt+et*Xe;return Pt?(t[0]=(w*Tt-T*xt+D*it)*(Pt=1/Pt),t[1]=(h*xt-s*Tt-g*it)*Pt,t[2]=(J*et-he*Pe+ve*ke)*Pt,t[3]=(B*Pe-O*et-V*ke)*Pt,t[4]=(T*Vt-y*Tt-D*pt)*Pt,t[5]=(n*Tt-h*Vt+g*pt)*Pt,t[6]=(he*Ce-G*et-ve*ye)*Pt,t[7]=(k*et-B*Ce+V*ye)*Pt,t[8]=(y*xt-w*Vt+D*Xe)*Pt,t[9]=(s*Vt-n*xt-g*Xe)*Pt,t[10]=(G*Pe-J*Ce+ve*Ie)*Pt,t[11]=(O*Ce-k*Pe-V*Ie)*Pt,t[12]=(w*pt-y*it-T*Xe)*Pt,t[13]=(n*it-s*pt+h*Xe)*Pt,t[14]=(J*ye-G*ke-he*Ie)*Pt,t[15]=(k*ke-O*ye+B*Ie)*Pt,t):null}function Kc(t,e,n){var s=e[0],h=e[1],g=e[2],y=e[3],w=e[4],T=e[5],D=e[6],k=e[7],O=e[8],B=e[9],V=e[10],G=e[11],J=e[12],he=e[13],ve=e[14],Ie=e[15],ye=n[0],Ce=n[1],ke=n[2],Pe=n[3];return t[0]=ye*s+Ce*w+ke*O+Pe*J,t[1]=ye*h+Ce*T+ke*B+Pe*he,t[2]=ye*g+Ce*D+ke*V+Pe*ve,t[3]=ye*y+Ce*k+ke*G+Pe*Ie,t[4]=(ye=n[4])*s+(Ce=n[5])*w+(ke=n[6])*O+(Pe=n[7])*J,t[5]=ye*h+Ce*T+ke*B+Pe*he,t[6]=ye*g+Ce*D+ke*V+Pe*ve,t[7]=ye*y+Ce*k+ke*G+Pe*Ie,t[8]=(ye=n[8])*s+(Ce=n[9])*w+(ke=n[10])*O+(Pe=n[11])*J,t[9]=ye*h+Ce*T+ke*B+Pe*he,t[10]=ye*g+Ce*D+ke*V+Pe*ve,t[11]=ye*y+Ce*k+ke*G+Pe*Ie,t[12]=(ye=n[12])*s+(Ce=n[13])*w+(ke=n[14])*O+(Pe=n[15])*J,t[13]=ye*h+Ce*T+ke*B+Pe*he,t[14]=ye*g+Ce*D+ke*V+Pe*ve,t[15]=ye*y+Ce*k+ke*G+Pe*Ie,t}function pd(t,e,n){var s,h,g,y,w,T,D,k,O,B,V,G,J=n[0],he=n[1],ve=n[2];return e===t?(t[12]=e[0]*J+e[4]*he+e[8]*ve+e[12],t[13]=e[1]*J+e[5]*he+e[9]*ve+e[13],t[14]=e[2]*J+e[6]*he+e[10]*ve+e[14],t[15]=e[3]*J+e[7]*he+e[11]*ve+e[15]):(h=e[1],g=e[2],y=e[3],w=e[4],T=e[5],D=e[6],k=e[7],O=e[8],B=e[9],V=e[10],G=e[11],t[0]=s=e[0],t[1]=h,t[2]=g,t[3]=y,t[4]=w,t[5]=T,t[6]=D,t[7]=k,t[8]=O,t[9]=B,t[10]=V,t[11]=G,t[12]=s*J+w*he+O*ve+e[12],t[13]=h*J+T*he+B*ve+e[13],t[14]=g*J+D*he+V*ve+e[14],t[15]=y*J+k*he+G*ve+e[15]),t}function Hl(t,e,n){var s=n[0],h=n[1],g=n[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*h,t[5]=e[5]*h,t[6]=e[6]*h,t[7]=e[7]*h,t[8]=e[8]*g,t[9]=e[9]*g,t[10]=e[10]*g,t[11]=e[11]*g,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Df(t,e,n){var s=Math.sin(n),h=Math.cos(n),g=e[4],y=e[5],w=e[6],T=e[7],D=e[8],k=e[9],O=e[10],B=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=g*h+D*s,t[5]=y*h+k*s,t[6]=w*h+O*s,t[7]=T*h+B*s,t[8]=D*h-g*s,t[9]=k*h-y*s,t[10]=O*h-w*s,t[11]=B*h-T*s,t}function ch(t,e,n){var s=Math.sin(n),h=Math.cos(n),g=e[0],y=e[1],w=e[2],T=e[3],D=e[8],k=e[9],O=e[10],B=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=g*h-D*s,t[1]=y*h-k*s,t[2]=w*h-O*s,t[3]=T*h-B*s,t[8]=g*s+D*h,t[9]=y*s+k*h,t[10]=w*s+O*h,t[11]=T*s+B*h,t}function Cf(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Sf(t,e,n){var s,h,g,y=n[0],w=n[1],T=n[2],D=Math.hypot(y,w,T);return D<dd?null:(y*=D=1/D,w*=D,T*=D,s=Math.sin(e),h=Math.cos(e),t[0]=y*y*(g=1-h)+h,t[1]=w*y*g+T*s,t[2]=T*y*g-w*s,t[3]=0,t[4]=y*w*g-T*s,t[5]=w*w*g+h,t[6]=T*w*g+y*s,t[7]=0,t[8]=y*T*g+w*s,t[9]=w*T*g-y*s,t[10]=T*T*g+h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Mf=Kc;function md(){var t=new Ca(3);return Ca!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function uh(t){var e=new Ca(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function kc(t){return Math.hypot(t[0],t[1],t[2])}function Yc(t,e,n){var s=new Ca(3);return s[0]=t,s[1]=e,s[2]=n,s}function bl(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function hh(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function gd(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function fc(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function dh(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function ka(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function fh(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t}function ra(t,e){var n=e[0],s=e[1],h=e[2],g=n*n+s*s+h*h;return g>0&&(g=1/Math.sqrt(g)),t[0]=e[0]*g,t[1]=e[1]*g,t[2]=e[2]*g,t}function sl(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function _d(t,e,n){var s=e[0],h=e[1],g=e[2],y=n[0],w=n[1],T=n[2];return t[0]=h*T-g*w,t[1]=g*y-s*T,t[2]=s*w-h*y,t}function fo(t,e,n){var s=e[0],h=e[1],g=e[2],y=n[3]*s+n[7]*h+n[11]*g+n[15];return t[0]=(n[0]*s+n[4]*h+n[8]*g+n[12])/(y=y||1),t[1]=(n[1]*s+n[5]*h+n[9]*g+n[13])/y,t[2]=(n[2]*s+n[6]*h+n[10]*g+n[14])/y,t}function ph(t,e,n){var s=n[0],h=n[1],g=n[2],y=e[0],w=e[1],T=e[2],D=h*T-g*w,k=g*y-s*T,O=s*w-h*y,B=h*O-g*k,V=g*D-s*O,G=s*k-h*D,J=2*n[3];return k*=J,O*=J,V*=2,G*=2,t[0]=y+(D*=J)+(B*=2),t[1]=w+k+V,t[2]=T+O+G,t}var Jc,ia=hh,Jg=gd,Qg=kc;function e_(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function cm(t,e){var n=e[0],s=e[1],h=e[2],g=e[3],y=n*n+s*s+h*h+g*g;return y>0&&(y=1/Math.sqrt(y)),t[0]=n*y,t[1]=s*y,t[2]=h*y,t[3]=g*y,t}function pc(t,e,n){var s=e[0],h=e[1],g=e[2],y=e[3];return t[0]=n[0]*s+n[4]*h+n[8]*g+n[12]*y,t[1]=n[1]*s+n[5]*h+n[9]*g+n[13]*y,t[2]=n[2]*s+n[6]*h+n[10]*g+n[14]*y,t[3]=n[3]*s+n[7]*h+n[11]*g+n[15]*y,t}function um(){var t=new Ca(4);return Ca!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function If(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function mh(t,e,n){n*=.5;var s=e[0],h=e[1],g=e[2],y=e[3],w=Math.sin(n),T=Math.cos(n);return t[0]=s*T+y*w,t[1]=h*T+g*w,t[2]=g*T-h*w,t[3]=y*T-s*w,t}function yd(t,e,n){n*=.5;var s=e[0],h=e[1],g=e[2],y=e[3],w=Math.sin(n),T=Math.cos(n);return t[0]=s*T-g*w,t[1]=h*T+y*w,t[2]=g*T+s*w,t[3]=y*T-h*w,t}md(),Jc=new Ca(4),Ca!=Float32Array&&(Jc[0]=0,Jc[1]=0,Jc[2]=0,Jc[3]=0);var hm=cm;md(),Yc(1,0,0),Yc(0,1,0),um(),um(),Tf();const dm=Sn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Af}=dm,Pf=Sn([{name:"a_pos_3",components:3,type:"Int16"}]);var gh=Sn([{name:"a_pos",type:"Int16",components:2}]);class Rf{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,s){const h=sl(n,this.dir);if(Math.abs(h)<1e-6)return!1;const g=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/h;return s[0]=this.pos[0]+this.dir[0]*g,s[1]=this.pos[1]+this.dir[1]*g,s[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(e,n,s){if(J=(V=this.pos)[0],he=V[1],ve=V[2],Ie=(G=e)[0],ye=G[1],Ce=G[2],Math.abs(J-Ie)<=dd*Math.max(1,Math.abs(J),Math.abs(Ie))&&Math.abs(he-ye)<=dd*Math.max(1,Math.abs(he),Math.abs(ye))&&Math.abs(ve-Ce)<=dd*Math.max(1,Math.abs(ve),Math.abs(Ce))||0===n)return s[0]=s[1]=s[2]=0,!1;var V,G,J,he,ve,Ie,ye,Ce;const[h,g,y]=this.dir,w=this.pos[0]-e[0],T=this.pos[1]-e[1],D=this.pos[2]-e[2],k=h*h+g*g+y*y,O=2*(w*h+T*g+D*y),B=O*O-4*k*(w*w+T*T+D*D-n*n);if(B<0){const V=Math.max(-O/2,0),G=w+h*V,J=T+g*V,he=D+y*V,ve=Math.hypot(G,J,he);return s[0]=G*n/ve,s[1]=J*n/ve,s[2]=he*n/ve,!1}{const V=(-O-Math.sqrt(B))/(2*k);if(V<0){const G=Math.hypot(w,T,D);return s[0]=w*n/G,s[1]=T*n/G,s[2]=D*n/G,!1}return s[0]=w+h*V,s[1]=T+g*V,s[2]=D+y*V,!0}}}class kf{constructor(e,n,s,h,g){this.TL=e,this.TR=n,this.BR=s,this.BL=h,this.horizon=g}static fromInvProjectionMatrix(e,n,s){const h=[-1,1,1],g=[1,1,1],y=[1,-1,1],w=[-1,-1,1],T=fo(h,h,e),D=fo(g,g,e),k=fo(y,y,e),O=fo(w,w,e);return new kf(T,D,k,O,n/s)}}class Lf{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,s,h){const g=Math.pow(2,s),y=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const D=pc([],T,e),k=1/D[3]/n*g;return(O=D)[0]=(B=D)[0]*(V=[k,k,h?1/D[3]:k,k])[0],O[1]=B[1]*V[1],O[2]=B[2]*V[2],O[3]=B[3]*V[3],O;var O,B,V}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const D=ra([],_d([],ia([],y[T[0]],y[T[1]]),ia([],y[T[2]],y[T[1]]))),k=-sl(D,y[T[1]]);return D.concat(k)});return new Lf(y,w)}}class oa{static fromPoints(e){const n=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const h of e)fc(n,n,h),dh(s,s,h);return new oa(n,s)}static applyTransform(e,n){const s=e.getCorners();for(let h=0;h<s.length;++h)fo(s[h],s[h],n);return oa.fromPoints(s)}constructor(e,n){this.min=e,this.max=n,this.center=ka([],bl([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],s=uh(this.min),h=uh(this.max);for(let g=0;g<n.length;g++)s[g]=n[g]?this.min[g]:this.center[g],h[g]=n[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new oa(s,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){const n=this.getCorners();let s=!0;for(let h=0;h<e.planes.length;h++){const g=e.planes[h];let y=0;for(let w=0;w<n.length;w++)y+=sl(g,n[w])+g[3]>=0;if(0===y)return 0;y!==n.length&&(s=!1)}if(s)return 2;for(let h=0;h<3;h++){let g=Number.MAX_VALUE,y=-Number.MAX_VALUE;for(let w=0;w<e.points.length;w++){const T=e.points[w][h]-this.min[h];g=Math.min(g,T),y=Math.max(y,T)}if(y<0||g>this.max[h]-this.min[h])return 0}return 1}}const $s=Wn/Math.PI/2,_h=[64,32,16],Tl=-$s,Dl=$s,jy=[new oa([Tl,Tl,Tl],[Dl,Dl,Dl]),new oa([Tl,Tl,Tl],[0,0,Dl]),new oa([0,Tl,Tl],[Dl,0,Dl]),new oa([Tl,0,Tl],[0,Dl,Dl]),new oa([0,0,Tl],[Dl,Dl,Dl])];function Of(t){return t*$s/Au}function t_(t,e,n,s=!0){const h=ka([],t._camera.position,t.worldSize),g=[e,n,1,1];pc(g,g,t.pixelMatrixInverse),e_(g,g,1/g[3]);const y=ra([],ia([],g,h)),w=t.globeMatrix,T=[w[12],w[13],w[14]],D=ia([],T,h),k=kc(D),O=ra([],D),B=t.worldSize/(2*Math.PI),V=sl(O,y),G=Math.asin(B/k);if(G<Math.acos(V)){if(!s)return null;const Vt=[],it=[];ka(Vt,y,k/V),ra(it,ia(it,Vt,D)),ra(y,bl(y,D,ka(y,it,Math.tan(G)*k)))}const J=[];new Rf(h,y).closestPointOnSphere(T,B,J);const he=ra([],vi(w,0)),ve=ra([],vi(w,1)),Ie=ra([],vi(w,2)),ye=sl(he,J),Ce=sl(ve,J),ke=sl(Ie,J),Pe=Kt(Math.asin(-Ce/B));let et=Kt(Math.atan2(ye,ke));et=t.center.lng+function(Vt,it){const xt=(it-Vt+180)%360-180;return xt<-180?xt+360:xt}(t.center.lng,et);const Xe=Wl(et),pt=ft(Hi(Pe),0,1);return new Pu(Xe,pt)}class fm{constructor(e,n,s){this.a=ia([],e,s),this.b=ia([],n,s),this.center=s;const h=ra([],this.a),g=ra([],this.b);this.angle=Math.acos(sl(h,g))}}function Ff(t,e){if(0===t.angle)return null;let n;return n=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(s,h,g,y){const w=Math.sin(g);return s*(Math.sin((1-y)*g)/w)+h*(Math.sin(y*g)/w)}(t.a[e],t.b[e],t.angle,ft(n,0,1))+t.center[e]}function ql(t){if(t.z<=1)return jy[t.z+2*t.y+t.x];const e=xd(Lc(t));return oa.fromPoints(e)}function Qc(t,e,n){return ka(t,t,1-n),fh(t,t,e,n)}function pm(t,e){const n=vh(e.zoom);if(0===n)return ql(t);const s=Lc(t),h=xd(s),g=Wl(s.getWest())*e.worldSize,y=Wl(s.getEast())*e.worldSize,w=Hi(s.getNorth())*e.worldSize,T=Hi(s.getSouth())*e.worldSize,D=[g,w,0],k=[y,w,0],O=[g,T,0],B=[y,T,0],V=fd([],e.globeMatrix);return fo(D,D,V),fo(k,k,V),fo(O,O,V),fo(B,B,V),h[0]=Qc(h[0],O,n),h[1]=Qc(h[1],B,n),h[2]=Qc(h[2],k,n),h[3]=Qc(h[3],D,n),oa.fromPoints(h)}function vd(t,e,n){for(const s of t)fo(s,s,e),ka(s,s,n)}function Lc({x:t,y:e,z:n}){const s=1/(1<<n),h=new qr(Ga(t*s),vs((e+1)*s)),g=new qr(Ga((t+1)*s),vs(e*s));return new Pc(h,g)}function xd(t){const e=je(t.getNorth()),n=je(t.getSouth()),s=Math.cos(e),h=Math.cos(n),g=Math.sin(e),y=Math.sin(n),w=t.getWest(),T=t.getEast();return[eu(h,y,w),eu(h,y,T),eu(s,g,T),eu(s,g,w)]}function eu(t,e,n,s=$s){return n=je(n),[t*Math.sin(n)*s,-e*s,t*Math.cos(n)*s]}function tu(t,e,n){return eu(Math.cos(je(t)),Math.sin(je(t)),e,n)}function wd(t,e,n,s){const h=1<<n.z,g=(t/Wn+n.x)/h;return tu(vs((e/Wn+n.y)/h),Ga(g),s)}function zf({min:t,max:e}){return 16383/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const n_=new Float64Array(16);function nu(t){const e=zf(t),n=Cf(n_,[e,e,e]);return pd(n,n,((s=[])[0]=-(h=t.min)[0],s[1]=-h[1],s[2]=-h[2],s));var s,h}function yh(t){const e=(s=t.min,(n=n_)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=s[0],n[13]=s[1],n[14]=s[2],n[15]=1,n);var n,s;const h=1/zf(t);return Hl(e,e,[h,h,h])}function r_(t,e,n,s,h){const g=function(T){const D=Wn/(2*Math.PI);return T/(2*Math.PI)/D}(n),y=[t,e,-n/(2*Math.PI)],w=ol(new Float64Array(16));return pd(w,w,y),Hl(w,w,[g,g,g]),Df(w,w,je(-h)),ch(w,w,je(-s)),w}function vh(t){return fn(5,6,t)}function Bf(t,e){const n=tu(e.lat,e.lng);return y=(h=hh([],function(G){const J=tu(G._center.lat,G._center.lng);let he=_d([],Yc(0,1,0),J);const ve=Sf([],-G.angle,J);he=fo(he,he,ve),Sf(ve,-G._pitch,he);const Ie=ra([],J);return ka(Ie,Ie,Of(G.cameraToCenterDistance/G.pixelsPerMeter)),fo(Ie,Ie,ve),bl([],J,Ie)}(t),n))[0],w=h[1],T=h[2],D=(g=n)[0],k=g[1],O=g[2],V=(B=Math.sqrt(y*y+w*w+T*T)*Math.sqrt(D*D+k*k+O*O))&&sl(h,g)/B,Math.acos(Math.min(Math.max(V,-1),1));var h,g,y,w,T,D,k,O,B,V}function Nf(t,e){return Bf(t,e)>Math.PI/2*1.01}const mm=je(85),i_=Math.cos(mm),o_=Math.sin(mm),Au=6371008.8,xh=2*Math.PI*Au;class qr{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new qr(vn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,s=this.lat*n,h=e.lat*n,g=Math.sin(s)*Math.sin(h)+Math.cos(s)*Math.cos(h)*Math.cos((e.lng-this.lng)*n);return Au*Math.acos(Math.min(g,1))}toBounds(e=0){const n=360*e/40075017,s=n/Math.cos(Math.PI/180*this.lat);return new Pc(new qr(this.lng-s,this.lat-n),new qr(this.lng+s,this.lat+n))}toEcef(e){const n=Of(e);return tu(this.lat,this.lng,$s+n)}static convert(e){if(e instanceof qr)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new qr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new qr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}function wh(t){return xh*Math.cos(t*Math.PI/180)}function Wl(t){return(180+t)/360}function Hi(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Cl(t,e){return t/wh(e)}function Ga(t){return 360*t-180}function vs(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Uf(t,e){return t*wh(vs(e))}const Ms=85.051129;function gm(t){return 1/Math.cos(t*Math.PI/180)}class Pu{constructor(e,n,s=0){this.x=+e,this.y=+n,this.z=+s}static fromLngLat(e,n=0){const s=qr.convert(e);return new Pu(Wl(s.lng),Hi(s.lat),Cl(n,s.lat))}toLngLat(){return new qr(Ga(this.x),vs(this.y))}toAltitude(){return Uf(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/xh*gm(vs(this.y))}}function jf(t,e,n,s,h,g,y,w,T){const D=(e+s)/2,k=(n+h)/2,O=new dt(D,k);w(O),function(B,V,G,J,he,ve){const Ie=G-he,ye=J-ve;return Math.abs((J-V)*Ie-(G-B)*ye)/Math.hypot(Ie,ye)}(O.x,O.y,g.x,g.y,y.x,y.y)>=T?(jf(t,e,n,D,k,g,O,w,T),jf(t,D,k,s,h,O,y,w,T)):t.push(y)}function Vf(t,e,n){let s=t[0],h=s.x,g=s.y;e(s);const y=[s];for(let w=1;w<t.length;w++){const T=t[w],{x:D,y:k}=T;e(T),jf(y,h,g,D,k,s,T,e,n),h=D,g=k,s=T}return y}function _m(t,e,n,s){if(s(e,n)){const h=e.add(n)._mult(.5);_m(t,e,h,s),_m(t,h,n,s)}else t.push(n)}function Vy(t,e){let n=t[0];const s=[n];for(let h=1;h<t.length;h++){const g=t[h];_m(s,n,g,e),n=g}return s}const ru=Math.pow(2,14)-1,bd=-ru-1;function ym(t,e){const n=Math.round(t.x*e),s=Math.round(t.y*e);return t.x=ft(n,bd,ru),t.y=ft(s,bd,ru),(n<t.x||n>t.x+1||s<t.y||s>t.y+1)&&cr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Zl(t,e,n){const s=t.loadGeometry(),h=t.extent,g=Wn/h;if(e&&n&&n.projection.isReprojectedInTileSpace){const y=1<<e.z,{scale:w,x:T,y:D,projection:k}=n,O=B=>{const V=Ga((e.x+B.x/h)/y),G=vs((e.y+B.y/h)/y),J=k.project(V,G);B.x=(J.x*w-T)*h,B.y=(J.y*w-D)*h};for(let B=0;B<s.length;B++)if(1!==t.type)s[B]=Vf(s[B],O,1);else{const V=[];for(const G of s[B])G.x<0||G.x>=h||G.y<0||G.y>=h||(O(G),V.push(G));s[B]=V}}for(const y of s)for(const w of y)ym(w,g);return s}function Oc(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Zl(t):[]}}function Ed(t,e,n,s,h){t.emplaceBack(2*e+(s+1)/2,2*n+(h+1)/2)}function Td(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class Dd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Fn,this.indexArray=new Ss,this.segments=new yo,this.programConfigurations=new Xc(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,h){const g=this.layers[0],y=[];let w=null;"circle"===g.type&&(w=g.layout.get("circle-sort-key"));for(const{feature:D,id:k,index:O,sourceLayerIndex:B}of e){const V=this.layers[0]._featureFilter.needGeometry,G=Oc(D,V);if(!this.layers[0]._featureFilter.filter(new qe(this.zoom),G,s))continue;const J=w?w.evaluate(G,{},s):void 0,he={id:k,properties:D.properties,type:D.type,sourceLayerIndex:B,index:O,geometry:V?G.geometry:Zl(D,s,h),patterns:{},sortKey:J};y.push(he)}w&&y.sort((D,k)=>D.sortKey-k.sortKey);let T=null;"globe"===h.projection.name&&(this.globeExtVertexArray=new Ea,T=h.projection);for(const D of y){const{geometry:k,index:O,sourceLayerIndex:B}=D,V=e[O].feature;this.addFeature(D,k,O,n.availableImages,s,T),n.featureIndex.insert(V,k,O,B,this.index)}}update(e,n,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lm.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Ef.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,s,h,g,y){for(const w of n)for(const T of w){const D=T.x,k=T.y;if(D<0||D>=Wn||k<0||k>=Wn)continue;if(y){const V=y.projectTilePoint(D,k,g),G=y.upVector(g,D,k),J=this.globeExtVertexArray;Td(J,V,G),Td(J,V,G),Td(J,V,G),Td(J,V,G)}const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),B=O.vertexLength;Ed(this.layoutVertexArray,D,k,-1,-1),Ed(this.layoutVertexArray,D,k,1,-1),Ed(this.layoutVertexArray,D,k,1,1),Ed(this.layoutVertexArray,D,k,-1,1),this.indexArray.emplaceBack(B,B+1,B+2),this.indexArray.emplaceBack(B,B+2,B+3),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},h,g)}}function $f(t,e){for(let n=0;n<t.length;n++)if(iu(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(iu(t,e[n]))return!0;return!!qf(t,e)}function Gf(t,e,n){return!!iu(t,e)||!!Cd(e,t,n)}function s_(t,e){if(1===t.length)return Fc(e,t[0]);for(let n=0;n<e.length;n++){const s=e[n];for(let h=0;h<s.length;h++)if(iu(t,s[h]))return!0}for(let n=0;n<t.length;n++)if(Fc(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(qf(t,e[n]))return!0;return!1}function Hf(t,e,n){if(t.length>1){if(qf(t,e))return!0;for(let s=0;s<e.length;s++)if(Cd(e[s],t,n))return!0}for(let s=0;s<t.length;s++)if(Cd(t[s],e,n))return!0;return!1}function qf(t,e){if(0===t.length||0===e.length)return!1;for(let n=0;n<t.length-1;n++){const s=t[n],h=t[n+1];for(let g=0;g<e.length-1;g++)if(Wf(s,h,e[g],e[g+1]))return!0}return!1}function Wf(t,e,n,s){return Ar(t,n,s)!==Ar(e,n,s)&&Ar(t,e,n)!==Ar(t,e,s)}function Cd(t,e,n){const s=n*n;if(1===e.length)return t.distSqr(e[0])<s;for(let h=1;h<e.length;h++)if(Zf(t,e[h-1],e[h])<s)return!0;return!1}function Zf(t,e,n){const s=e.distSqr(n);if(0===s)return t.distSqr(e);const h=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/s;return t.distSqr(h<0?e:h>1?n:n.sub(e)._mult(h)._add(e))}function Fc(t,e){let n,s,h,g=!1;for(let y=0;y<t.length;y++){n=t[y];for(let w=0,T=n.length-1;w<n.length;T=w++)s=n[w],h=n[T],s.y>e.y!=h.y>e.y&&e.x<(h.x-s.x)*(e.y-s.y)/(h.y-s.y)+s.x&&(g=!g)}return g}function iu(t,e){let n=!1;for(let s=0,h=t.length-1;s<t.length;h=s++){const g=t[s],y=t[h];g.y>e.y!=y.y>e.y&&e.x<(y.x-g.x)*(e.y-g.y)/(y.y-g.y)+g.x&&(n=!n)}return n}function Sd(t,e,n,s,h){for(const y of t)if(e<=y.x&&n<=y.y&&s>=y.x&&h>=y.y)return!0;const g=[new dt(e,n),new dt(e,h),new dt(s,h),new dt(s,n)];if(t.length>2)for(const y of g)if(iu(t,y))return!0;for(let y=0;y<t.length-1;y++)if(Md(t[y],t[y+1],g))return!0;return!1}function Md(t,e,n){const s=n[0],h=n[2];if(t.x<s.x&&e.x<s.x||t.x>h.x&&e.x>h.x||t.y<s.y&&e.y<s.y||t.y>h.y&&e.y>h.y)return!1;const g=Ar(t,e,n[0]);return g!==Ar(t,e,n[1])||g!==Ar(t,e,n[2])||g!==Ar(t,e,n[3])}function Ru(t,e,n){const s=e.paint.get(t).value;return"constant"===s.kind?s.value:n.programConfigurations.get(e.id).getMaxValue(t)}function ku(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function bh(t,e,n,s,h){if(!e[0]&&!e[1])return t;const g=dt.convert(e)._mult(h);"viewport"===n&&g._rotate(-s);const y=[];for(let w=0;w<t.length;w++)y.push(t[w].sub(g));return y}function zc(t,e,n,s){const h=dt.convert(t)._mult(s);return"viewport"===e&&h._rotate(-n),h}yn(Dd,"CircleBucket",{omit:["layers"]});const vm=new Nt({"circle-sort-key":new rt(st.layout_circle["circle-sort-key"])});var Xf={paint:new Nt({"circle-radius":new rt(st.paint_circle["circle-radius"]),"circle-color":new rt(st.paint_circle["circle-color"]),"circle-blur":new rt(st.paint_circle["circle-blur"]),"circle-opacity":new rt(st.paint_circle["circle-opacity"]),"circle-translate":new He(st.paint_circle["circle-translate"]),"circle-translate-anchor":new He(st.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new He(st.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new He(st.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new rt(st.paint_circle["circle-stroke-width"]),"circle-stroke-color":new rt(st.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new rt(st.paint_circle["circle-stroke-opacity"])}),layout:vm};function xm(t,e,n,s,h,g,y,w,T){if(g&&t.queryGeometry.isAboveHorizon)return!1;g&&(T*=t.pixelToTileUnitsFactor);const D=t.tileID.canonical,k=n.projection.upVectorScale(D,n.center.lat,n.worldSize).metersToTile;for(const O of e)for(const B of O){const V=B.add(w),G=h&&n.elevation?n.elevation.exaggeration()*h.getElevationAt(V.x,V.y,!0):0,J=n.projection.projectTilePoint(V.x,V.y,D);if(G>0){const ye=n.projection.upVector(D,V.x,V.y);J.x+=ye[0]*k*G,J.y+=ye[1]*k*G,J.z+=ye[2]*k*G}const he=g?V:a_(J.x,J.y,J.z,s),ve=g?t.tilespaceRays.map(ye=>l_(ye,G)):t.queryGeometry.screenGeometry,Ie=pc([],[J.x,J.y,J.z,1],s);if(!y&&g?T*=Ie[3]/n.cameraToCenterDistance:y&&!g&&(T*=n.cameraToCenterDistance/Ie[3]),g){const ye=vs((B.y/Wn+D.y)/(1<<D.z));T/=n.projection.pixelsPerMeter(ye,1)/Cl(1,ye)}if(Gf(ve,he,T))return!0}return!1}function a_(t,e,n,s){const h=pc([],[t,e,n,1],s);return new dt(h[0]/h[3],h[1]/h[3])}const Kf=Yc(0,0,0),Lu=Yc(0,0,1);function l_(t,e){const n=md();return Kf[2]=e,t.intersectsPlane(Kf,Lu,n),new dt(n[0],n[1])}class wm extends Dd{}function bm(t,{width:e,height:n},s,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*n*s)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*n*s);return t.width=e,t.height=n,t.data=h,t}function Id(t,e,n){const{width:s,height:h}=e;s===t.width&&h===t.height||(Yf(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,s),height:Math.min(t.height,h)},n),t.width=s,t.height=h,t.data=e.data)}function Yf(t,e,n,s,h,g){if(0===h.width||0===h.height)return e;if(h.width>t.width||h.height>t.height||n.x>t.width-h.width||n.y>t.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||s.x>e.width-h.width||s.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const y=t.data,w=e.data;for(let T=0;T<h.height;T++){const D=((n.y+T)*t.width+n.x)*g,k=((s.y+T)*e.width+s.x)*g;for(let O=0;O<h.width*g;O++)w[k+O]=y[D+O]}return e}yn(wm,"HeatmapBucket",{omit:["layers"]});class Xl{constructor(e,n){bm(this,e,1,n)}resize(e){Id(this,new Xl(e),1)}clone(){return new Xl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,h,g){Yf(e,n,s,h,g,1)}}class La{constructor(e,n){bm(this,e,4,n)}resize(e){Id(this,new La(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new La({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,h,g){Yf(e,n,s,h,g,4)}}yn(Xl,"AlphaImage"),yn(La,"RGBAImage");var Em={paint:new Nt({"heatmap-radius":new rt(st.paint_heatmap["heatmap-radius"]),"heatmap-weight":new rt(st.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new He(st.paint_heatmap["heatmap-intensity"]),"heatmap-color":new St(st.paint_heatmap["heatmap-color"]),"heatmap-opacity":new He(st.paint_heatmap["heatmap-opacity"])})};function Tm(t){const e={},n=t.resolution||256,s=t.clips?t.clips.length:1,h=t.image||new La({width:n,height:s}),g=(y,w,T)=>{e[t.evaluationKey]=T;const D=t.expression.evaluate(e);h.data[y+w+0]=Math.floor(255*D.r/D.a),h.data[y+w+1]=Math.floor(255*D.g/D.a),h.data[y+w+2]=Math.floor(255*D.b/D.a),h.data[y+w+3]=Math.floor(255*D.a)};if(t.clips)for(let y=0,w=0;y<s;++y,w+=4*n)for(let T=0,D=0;T<n;T++,D+=4){const k=T/(n-1),{start:O,end:B}=t.clips[y];g(w,D,O*(1-k)+B*k)}else for(let y=0,w=0;y<n;y++,w+=4)g(0,w,y/(n-1));return h}var c_={paint:new Nt({"hillshade-illumination-direction":new He(st.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new He(st.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new He(st.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new He(st.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new He(st.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new He(st.paint_hillshade["hillshade-accent-color"])})};const Eh=Sn([{name:"a_pos",components:2,type:"Int16"}],4),{members:u_}=Eh;var Sl={};function Bc(t,e,n){n=n||2;var s,h,g,y,w,T,D,k=e&&e.length,O=k?e[0]*n:t.length,B=Dm(t,0,O,n,!0),V=[];if(!B||B.next===B.prev)return V;if(k&&(B=function(J,he,ve,Ie){var ye,Ce,ke,Pe=[];for(ye=0,Ce=he.length;ye<Ce;ye++)(ke=Dm(J,he[ye]*Ie,ye<Ce-1?he[ye+1]*Ie:J.length,Ie,!1))===ke.next&&(ke.steiner=!0),Pe.push(Ch(ke));for(Pe.sort(Jf),ye=0;ye<Pe.length;ye++)ve=Qf(Pe[ye],ve);return ve}(t,e,B,n)),t.length>80*n){s=g=t[0],h=y=t[1];for(var G=n;G<O;G+=n)(w=t[G])<s&&(s=w),(T=t[G+1])<h&&(h=T),w>g&&(g=w),T>y&&(y=T);D=0!==(D=Math.max(g-s,y-h))?32767/D:0}return Th(B,V,n,s,h,D,0),V}function Dm(t,e,n,s,h){var g,y;if(h===Am(t,e,n,s)>0)for(g=e;g<n;g+=s)y=Mm(g,t[g],t[g+1],y);else for(g=n-s;g>=e;g-=s)y=Mm(g,t[g],t[g+1],y);return y&&Ad(y,y.next)&&(Sh(y),y=y.next),y}function Nc(t,e){if(!t)return t;e||(e=t);var n,s=t;do{if(n=!1,s.steiner||!Ad(s,s.next)&&0!==Do(s.prev,s,s.next))s=s.next;else{if(Sh(s),(s=e=s.prev)===s.next)break;n=!0}}while(n||s!==e);return e}function Th(t,e,n,s,h,g,y){if(t){!y&&g&&function(k,O,B,V){var G=k;do{0===G.z&&(G.z=Dh(G.x,G.y,O,B,V)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next}while(G!==k);G.prevZ.nextZ=null,G.prevZ=null,function(J){var he,ve,Ie,ye,Ce,ke,Pe,et,Xe=1;do{for(ve=J,J=null,Ce=null,ke=0;ve;){for(ke++,Ie=ve,Pe=0,he=0;he<Xe&&(Pe++,Ie=Ie.nextZ);he++);for(et=Xe;Pe>0||et>0&&Ie;)0!==Pe&&(0===et||!Ie||ve.z<=Ie.z)?(ye=ve,ve=ve.nextZ,Pe--):(ye=Ie,Ie=Ie.nextZ,et--),Ce?Ce.nextZ=ye:J=ye,ye.prevZ=Ce,Ce=ye;ve=Ie}Ce.nextZ=null,Xe*=2}while(ke>1)}(G)}(t,s,h,g);for(var w,T,D=t;t.prev!==t.next;)if(w=t.prev,T=t.next,g?d_(t,s,h,g):h_(t))e.push(w.i/n|0),e.push(t.i/n|0),e.push(T.i/n|0),Sh(t),t=T.next,D=T.next;else if((t=T)===D){y?1===y?Th(t=Cm(Nc(t),e,n),e,n,s,h,g,2):2===y&&f_(t,e,n,s,h,g):Th(Nc(t),e,n,s,h,g,1);break}}}function h_(t){var e=t.prev,n=t,s=t.next;if(Do(e,n,s)>=0)return!1;for(var h=e.x,g=n.x,y=s.x,w=e.y,T=n.y,D=s.y,k=h<g?h<y?h:y:g<y?g:y,O=w<T?w<D?w:D:T<D?T:D,B=h>g?h>y?h:y:g>y?g:y,V=w>T?w>D?w:D:T>D?T:D,G=s.next;G!==e;){if(G.x>=k&&G.x<=B&&G.y>=O&&G.y<=V&&Ou(h,w,g,T,y,D,G.x,G.y)&&Do(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function d_(t,e,n,s){var h=t.prev,g=t,y=t.next;if(Do(h,g,y)>=0)return!1;for(var w=h.x,T=g.x,D=y.x,k=h.y,O=g.y,B=y.y,V=w<T?w<D?w:D:T<D?T:D,G=k<O?k<B?k:B:O<B?O:B,J=w>T?w>D?w:D:T>D?T:D,he=k>O?k>B?k:B:O>B?O:B,ve=Dh(V,G,e,n,s),Ie=Dh(J,he,e,n,s),ye=t.prevZ,Ce=t.nextZ;ye&&ye.z>=ve&&Ce&&Ce.z<=Ie;){if(ye.x>=V&&ye.x<=J&&ye.y>=G&&ye.y<=he&&ye!==h&&ye!==y&&Ou(w,k,T,O,D,B,ye.x,ye.y)&&Do(ye.prev,ye,ye.next)>=0||(ye=ye.prevZ,Ce.x>=V&&Ce.x<=J&&Ce.y>=G&&Ce.y<=he&&Ce!==h&&Ce!==y&&Ou(w,k,T,O,D,B,Ce.x,Ce.y)&&Do(Ce.prev,Ce,Ce.next)>=0))return!1;Ce=Ce.nextZ}for(;ye&&ye.z>=ve;){if(ye.x>=V&&ye.x<=J&&ye.y>=G&&ye.y<=he&&ye!==h&&ye!==y&&Ou(w,k,T,O,D,B,ye.x,ye.y)&&Do(ye.prev,ye,ye.next)>=0)return!1;ye=ye.prevZ}for(;Ce&&Ce.z<=Ie;){if(Ce.x>=V&&Ce.x<=J&&Ce.y>=G&&Ce.y<=he&&Ce!==h&&Ce!==y&&Ou(w,k,T,O,D,B,Ce.x,Ce.y)&&Do(Ce.prev,Ce,Ce.next)>=0)return!1;Ce=Ce.nextZ}return!0}function Cm(t,e,n){var s=t;do{var h=s.prev,g=s.next.next;!Ad(h,g)&&Sm(h,s,s.next,g)&&Kl(h,g)&&Kl(g,h)&&(e.push(h.i/n|0),e.push(s.i/n|0),e.push(g.i/n|0),Sh(s),Sh(s.next),s=t=g),s=s.next}while(s!==t);return Nc(s)}function f_(t,e,n,s,h,g){var y=t;do{for(var w=y.next.next;w!==y.prev;){if(y.i!==w.i&&m_(y,w)){var T=Yl(y,w);return y=Nc(y,y.next),T=Nc(T,T.next),Th(y,e,n,s,h,g,0),void Th(T,e,n,s,h,g,0)}w=w.next}y=y.next}while(y!==t)}function Jf(t,e){return t.x-e.x}function Qf(t,e){var n=function(h,g){var y,w=g,T=h.x,D=h.y,k=-1/0;do{if(D<=w.y&&D>=w.next.y&&w.next.y!==w.y){var O=w.x+(D-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(O<=T&&O>k&&(k=O,y=w.x<w.next.x?w:w.next,O===T))return y}w=w.next}while(w!==g);if(!y)return null;var B,V=y,G=y.x,J=y.y,he=1/0;w=y;do{T>=w.x&&w.x>=G&&T!==w.x&&Ou(D<J?T:k,D,G,J,D<J?k:T,D,w.x,w.y)&&(B=Math.abs(D-w.y)/(T-w.x),Kl(w,h)&&(B<he||B===he&&(w.x>y.x||w.x===y.x&&p_(y,w)))&&(y=w,he=B)),w=w.next}while(w!==V);return y}(t,e);if(!n)return e;var s=Yl(n,t);return Nc(s,s.next),Nc(n,n.next)}function p_(t,e){return Do(t.prev,t,e.prev)<0&&Do(e.next,t,t.next)<0}function Dh(t,e,n,s,h){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Ch(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Ou(t,e,n,s,h,g,y,w){return(h-y)*(e-w)>=(t-y)*(g-w)&&(t-y)*(s-w)>=(n-y)*(e-w)&&(n-y)*(g-w)>=(h-y)*(s-w)}function m_(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,s){var h=n;do{if(h.i!==n.i&&h.next.i!==n.i&&h.i!==s.i&&h.next.i!==s.i&&Sm(h,h.next,n,s))return!0;h=h.next}while(h!==n);return!1}(t,e)&&(Kl(t,e)&&Kl(e,t)&&function(n,s){var h=n,g=!1,y=(n.x+s.x)/2,w=(n.y+s.y)/2;do{h.y>w!=h.next.y>w&&h.next.y!==h.y&&y<(h.next.x-h.x)*(w-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next}while(h!==n);return g}(t,e)&&(Do(t.prev,t,e.prev)||Do(t,e.prev,e))||Ad(t,e)&&Do(t.prev,t,t.next)>0&&Do(e.prev,e,e.next)>0)}function Do(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Ad(t,e){return t.x===e.x&&t.y===e.y}function Sm(t,e,n,s){var h=Rd(Do(t,e,n)),g=Rd(Do(t,e,s)),y=Rd(Do(n,s,t)),w=Rd(Do(n,s,e));return h!==g&&y!==w||!(0!==h||!Pd(t,n,e))||!(0!==g||!Pd(t,s,e))||!(0!==y||!Pd(n,t,s))||!(0!==w||!Pd(n,e,s))}function Pd(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Rd(t){return t>0?1:t<0?-1:0}function Kl(t,e){return Do(t.prev,t,t.next)<0?Do(t,e,t.next)>=0&&Do(t,t.prev,e)>=0:Do(t,e,t.prev)<0||Do(t,t.next,e)<0}function Yl(t,e){var n=new Im(t.i,t.x,t.y),s=new Im(e.i,e.x,e.y),h=t.next,g=e.prev;return t.next=e,e.prev=t,n.next=h,h.prev=n,s.next=n,n.prev=s,g.next=s,s.prev=g,s}function Mm(t,e,n,s){var h=new Im(t,e,n);return s?(h.next=s.next,h.prev=s,s.next.prev=h,s.next=h):(h.prev=h,h.next=h),h}function Sh(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Im(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Am(t,e,n,s){for(var h=0,g=e,y=n-s;g<n;g+=s)h+=(t[y]-t[g])*(t[g+1]+t[y+1]),y=g;return h}function Pm(t,e,n,s,h){g_(t,e,n||0,s||t.length-1,h||Rm)}function g_(t,e,n,s,h){for(;s>n;){if(s-n>600){var g=s-n+1,y=e-n+1,w=Math.log(g),T=.5*Math.exp(2*w/3),D=.5*Math.sqrt(w*T*(g-T)/g)*(y-g/2<0?-1:1);g_(t,e,Math.max(n,Math.floor(e-y*T/g+D)),Math.min(s,Math.floor(e+(g-y)*T/g+D)),h)}var k=t[e],O=n,B=s;for(Fu(t,n,e),h(t[s],k)>0&&Fu(t,n,s);O<B;){for(Fu(t,O,B),O++,B--;h(t[O],k)<0;)O++;for(;h(t[B],k)>0;)B--}0===h(t[n],k)?Fu(t,n,B):Fu(t,++B,s),B<=e&&(n=B+1),e<=B&&(s=B-1)}}function Fu(t,e,n){var s=t[e];t[e]=t[n],t[n]=s}function Rm(t,e){return t<e?-1:t>e?1:0}function ep(t,e){const n=t.length;if(n<=1)return[t];const s=[];let h,g;for(let y=0;y<n;y++){const w=nn(t[y]);0!==w&&(t[y].area=Math.abs(w),void 0===g&&(g=w<0),g===w<0?(h&&s.push(h),h=[t[y]]):h.push(t[y]))}if(h&&s.push(h),e>1)for(let y=0;y<s.length;y++)s[y].length<=e||(Pm(s[y],e,1,s[y].length-1,km),s[y]=s[y].slice(0,e));return s}function km(t,e){return e.area-t.area}function tp(t,e,n){const s=n.patternDependencies;let h=!1;for(const g of e){const y=g.paint.get(`${t}-pattern`);y.isConstant()||(h=!0);const w=y.constantOr(null);w&&(h=!0,s[w]=!0)}return h}function np(t,e,n,s,h){const g=h.patternDependencies;for(const y of e){const w=y.paint.get(`${t}-pattern`).value;if("constant"!==w.kind){let T=w.evaluate({zoom:s},n,{},h.availableImages);T=T&&T.name?T.name:T,g[T]=!0,n.patterns[y.id]=T}}return n}({get exports(){return Sl},set exports(t){Sl=t}}).exports=Bc,Sl.default=Bc,Bc.deviation=function(t,e,n,s){var h=e&&e.length,g=Math.abs(Am(t,0,h?e[0]*n:t.length,n));if(h)for(var y=0,w=e.length;y<w;y++)g-=Math.abs(Am(t,e[y]*n,y<w-1?e[y+1]*n:t.length,n));var T=0;for(y=0;y<s.length;y+=3){var D=s[y]*n,k=s[y+1]*n,O=s[y+2]*n;T+=Math.abs((t[D]-t[O])*(t[k+1]-t[D+1])-(t[D]-t[k])*(t[O+1]-t[D+1]))}return 0===g&&0===T?0:Math.abs((T-g)/g)},Bc.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},s=0,h=0;h<t.length;h++){for(var g=0;g<t[h].length;g++)for(var y=0;y<e;y++)n.vertices.push(t[h][g][y]);h>0&&n.holes.push(s+=t[h-1].length)}return n};class Oa{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Fn,this.indexArray=new Ss,this.indexArray2=new ys,this.programConfigurations=new Xc(e.layers,e.zoom),this.segments=new yo,this.segments2=new yo,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,s,h){this.hasPattern=tp("fill",this.layers,n);const g=this.layers[0].layout.get("fill-sort-key"),y=[];for(const{feature:w,id:T,index:D,sourceLayerIndex:k}of e){const O=this.layers[0]._featureFilter.needGeometry,B=Oc(w,O);if(!this.layers[0]._featureFilter.filter(new qe(this.zoom),B,s))continue;const V=g?g.evaluate(B,{},s,n.availableImages):void 0,G={id:T,properties:w.properties,type:w.type,sourceLayerIndex:k,index:D,geometry:O?B.geometry:Zl(w,s,h),patterns:{},sortKey:V};y.push(G)}g&&y.sort((w,T)=>w.sortKey-T.sortKey);for(const w of y){const{geometry:T,index:D,sourceLayerIndex:k}=w;if(this.hasPattern){const O=np("fill",this.layers,w,this.zoom,n);this.patternFeatures.push(O)}else this.addFeature(w,T,D,s,{},n.availableImages);n.featureIndex.insert(e[D].feature,T,D,k,this.index)}}update(e,n,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,h)}addFeatures(e,n,s,h,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,u_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,s,h,g,y=[]){for(const w of ep(n,500)){let T=0;for(const G of w)T+=G.length;const D=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),k=D.vertexLength,O=[],B=[];for(const G of w){if(0===G.length)continue;G!==w[0]&&B.push(O.length/2);const J=this.segments2.prepareSegment(G.length,this.layoutVertexArray,this.indexArray2),he=J.vertexLength;this.layoutVertexArray.emplaceBack(G[0].x,G[0].y),this.indexArray2.emplaceBack(he+G.length-1,he),O.push(G[0].x),O.push(G[0].y);for(let ve=1;ve<G.length;ve++)this.layoutVertexArray.emplaceBack(G[ve].x,G[ve].y),this.indexArray2.emplaceBack(he+ve-1,he+ve),O.push(G[ve].x),O.push(G[ve].y);J.vertexLength+=G.length,J.primitiveLength+=G.length}const V=Sl(O,B);for(let G=0;G<V.length;G+=3)this.indexArray.emplaceBack(k+V[G],k+V[G+1],k+V[G+2]);D.vertexLength+=T,D.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,g,y,h)}}yn(Oa,"FillBucket",{omit:["layers","patternFeatures"]});const __=new Nt({"fill-sort-key":new rt(st.layout_fill["fill-sort-key"])});var Lm={paint:new Nt({"fill-antialias":new He(st.paint_fill["fill-antialias"]),"fill-opacity":new rt(st.paint_fill["fill-opacity"]),"fill-color":new rt(st.paint_fill["fill-color"]),"fill-outline-color":new rt(st.paint_fill["fill-outline-color"]),"fill-translate":new He(st.paint_fill["fill-translate"]),"fill-translate-anchor":new He(st.paint_fill["fill-translate-anchor"]),"fill-pattern":new rt(st.paint_fill["fill-pattern"])}),layout:__};const y_=Sn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),v_=Sn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),x_=Sn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:w_}=y_;var Mh={},b_=dt,Om=zu;function zu(t,e,n,s,h){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=s,this._values=h,t.readFields(Or,this,e)}function Or(t,e,n){1==t?e.id=n.readVarint():2==t?function(s,h){for(var g=s.readVarint()+s.pos;s.pos<g;){var y=h._keys[s.readVarint()],w=h._values[s.readVarint()];h.properties[y]=w}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function Fm(t){for(var e,n,s=0,h=0,g=t.length,y=g-1;h<g;y=h++)s+=((n=t[y]).x-(e=t[h]).x)*(e.y+n.y);return s}zu.types=["Unknown","Point","LineString","Polygon"],zu.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,s=1,h=0,g=0,y=0,w=[];t.pos<n;){if(h<=0){var T=t.readVarint();s=7&T,h=T>>3}if(h--,1===s||2===s)g+=t.readSVarint(),y+=t.readSVarint(),1===s&&(e&&w.push(e),e=[]),e.push(new b_(g,y));else{if(7!==s)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&w.push(e),w},zu.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,s=0,h=0,g=0,y=1/0,w=-1/0,T=1/0,D=-1/0;t.pos<e;){if(s<=0){var k=t.readVarint();n=7&k,s=k>>3}if(s--,1===n||2===n)(h+=t.readSVarint())<y&&(y=h),h>w&&(w=h),(g+=t.readSVarint())<T&&(T=g),g>D&&(D=g);else if(7!==n)throw new Error("unknown command "+n)}return[y,T,w,D]},zu.prototype.toGeoJSON=function(t,e,n){var s,h,g=this.extent*Math.pow(2,n),y=this.extent*t,w=this.extent*e,T=this.loadGeometry(),D=zu.types[this.type];function k(V){for(var G=0;G<V.length;G++){var J=V[G];V[G]=[360*(J.x+y)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(J.y+w)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(s=0;s<T.length;s++)O[s]=T[s][0];k(T=O);break;case 2:for(s=0;s<T.length;s++)k(T[s]);break;case 3:for(T=function(V){var G=V.length;if(G<=1)return[V];for(var J,he,ve=[],Ie=0;Ie<G;Ie++){var ye=Fm(V[Ie]);0!==ye&&(void 0===he&&(he=ye<0),he===ye<0?(J&&ve.push(J),J=[V[Ie]]):J.push(V[Ie]))}return J&&ve.push(J),ve}(T),s=0;s<T.length;s++)for(h=0;h<T[s].length;h++)k(T[s][h])}1===T.length?T=T[0]:D="Multi"+D;var B={type:"Feature",geometry:{type:D,coordinates:T},properties:this.properties};return"id"in this&&(B.id=this.id),B};var zm=Om,rp=Bm;function Bm(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(E_,this,e),this.length=this._features.length}function E_(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(s){for(var h=null,g=s.readVarint()+s.pos;s.pos<g;){var y=s.readVarint()>>3;h=1===y?s.readString():2===y?s.readFloat():3===y?s.readDouble():4===y?s.readVarint64():5===y?s.readVarint():6===y?s.readSVarint():7===y?s.readBoolean():null}return h}(n))}Bm.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new zm(this._pbf,e,this.extent,this._keys,this._values)};var Nm=rp;function T_(t,e,n){if(3===t){var s=new Nm(n,n.readVarint()+n.pos);s.length&&(e[s.name]=s)}}var kd=Mh.VectorTile=function(t,e){this.layers=t.readFields(T_,{},e)},Ld=Mh.VectorTileFeature=Om;function Od(t,e,n,s){const h=[],g=0===s?(y,w,T,D,k,O)=>{y.push(new dt(O,T+(O-w)/(D-w)*(k-T)))}:(y,w,T,D,k,O)=>{y.push(new dt(w+(O-T)/(k-T)*(D-w),O))};for(const y of t){const w=[];for(const T of y){if(T.length<=2)continue;const D=[];for(let B=0;B<T.length-1;B++){const V=T[B].x,G=T[B].y,J=T[B+1].x,he=T[B+1].y,ve=0===s?V:G,Ie=0===s?J:he;ve<e?Ie>e&&g(D,V,G,J,he,e):ve>n?Ie<n&&g(D,V,G,J,he,n):D.push(T[B]),Ie<e&&ve>=e&&g(D,V,G,J,he,e),Ie>n&&ve<=n&&g(D,V,G,J,he,n)}let k=T[T.length-1];const O=0===s?k.x:k.y;O>=e&&O<=n&&D.push(k),D.length&&(k=D[D.length-1],D[0].x===k.x&&D[0].y===k.y||D.push(D[0]),w.push(D))}w.length&&h.push(w)}return h}Mh.VectorTileLayer=rp;const $y=Ld.types,Um=Math.pow(2,13);function Bu(t,e,n,s,h,g,y,w){t.emplaceBack((e<<1)+y,(n<<1)+g,(Math.floor(s*Um)<<1)+h,Math.round(w))}function Ml(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class jm{constructor(){this.acc=new dt(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new dt(e.x,e.y),this.max=new dt(e.x,e.y))}append(e,n){this.currentPolyCount.edges++,this.acc._add(e);const s=this.min,h=this.max;e.x<s.x?s.x=e.x:e.x>h.x&&(h.x=e.x),e.y<s.y?s.y=e.y:e.y>h.y&&(h.y=e.y),((0===e.x||e.x===Wn)&&e.x===n.x)!=((0===e.y||e.y===Wn)&&e.y===n.y)&&this.processBorderOverlap(e,n),n.x<0!=e.x<0&&this.addBorderIntersection(0,fr(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Wn!=e.x>Wn&&this.addBorderIntersection(1,fr(n.y,e.y,(Wn-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,fr(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Wn!=e.y>Wn&&this.addBorderIntersection(3,fr(n.x,e.x,(Wn-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];n<s[0]&&(s[0]=n),n>s[1]&&(s[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const s=0===e.x?0:1;this.addBorderIntersection(s,n.y),this.addBorderIntersection(s,e.y)}else{const s=0===e.y?2:3;this.addBorderIntersection(s,n.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((n,s)=>n+s.edges,0);return 0!==e?this.acc.div(e)._round():new dt(0,0)}span(){return new dt(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0)}}class ou{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new ci,this.centroidVertexArray=new id,this.indexArray=new Ss,this.programConfigurations=new Xc(e.layers,e.zoom),this.segments=new yo,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=e.enableTerrain}populate(e,n,s,h){this.features=[],this.hasPattern=tp("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(g){const y=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*y/(y*y+1)/Wn/(1<<g.z)}(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:g,id:y,index:w,sourceLayerIndex:T}of e){const D=this.layers[0]._featureFilter.needGeometry,k=Oc(g,D);if(!this.layers[0]._featureFilter.filter(new qe(this.zoom),k,s))continue;const O={id:y,sourceLayerIndex:T,index:w,geometry:D?k.geometry:Zl(g,s,h),properties:g.properties,type:g.type,patterns:{}},B=this.layoutVertexArray.length;this.hasPattern?this.features.push(np("fill-extrusion",this.layers,O,this.zoom,n)):this.addFeature(O,O.geometry,w,s,{},n.availableImages,h),n.featureIndex.insert(g,O.geometry,w,T,this.index,B)}this.sortBorders()}addFeatures(e,n,s,h,g){for(const y of this.features){const{geometry:w}=y;this.addFeature(y,w,y.index,n,s,h,g)}this.sortBorders()}update(e,n,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,w_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,x_.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,v_.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,s,h,g,y,w){const T=[new dt(0,0),new dt(Wn,Wn)],D=w.projection,k="globe"===D.name,O=this.enableTerrain&&!k?new jm:null,B="Polygon"===$y[e.type];k&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Ea);const V=ep(n,500);for(let ve=V.length-1;ve>=0;ve--){const Ie=V[ve];(0===Ie.length||(G=Ie[0]).every(ye=>ye.x<=0)||G.every(ye=>ye.x>=Wn)||G.every(ye=>ye.y<=0)||G.every(ye=>ye.y>=Wn))&&V.splice(ve,1)}var G;let J;if(k)J=I_(V,T,h);else{J=[];for(const ve of V)J.push({polygon:ve,bounds:T})}const he=B?this.edgeRadius:0;for(const{polygon:ve,bounds:Ie}of J){let ye=0,Ce=0;for(const Pe of ve)B&&!Pe[0].equals(Pe[Pe.length-1])&&Pe.push(Pe[0]),Ce+=B?Pe.length-1:Pe.length;const ke=this.segments.prepareSegment((B?5:4)*Ce,this.layoutVertexArray,this.indexArray);if(B){const Pe=[],et=[];ye=ke.vertexLength;for(const pt of ve){let Vt,it;pt.length&&pt!==ve[0]&&et.push(Pe.length/2),Vt=pt[1].sub(pt[0])._perp()._unit();for(let xt=1;xt<pt.length;xt++){const Tt=pt[xt],Pt=pt[xt===pt.length-1?1:xt+1];let{x:jt,y:at}=Tt;if(he){it=Pt.sub(Tt)._perp()._unit();const Jt=Vt.add(it)._unit(),Un=he*Math.min(4,1/(Vt.x*Jt.x+Vt.y*Jt.y));jt+=Un*Jt.x,at+=Un*Jt.y,Vt=it}Bu(this.layoutVertexArray,jt,at,0,0,1,1,0),ke.vertexLength++,Pe.push(Tt.x,Tt.y),k&&Ml(this.layoutVertexExtArray,D.projectTilePoint(jt,at,h),D.upVector(h,jt,at))}}const Xe=Sl(Pe,et);for(let pt=0;pt<Xe.length;pt+=3)this.indexArray.emplaceBack(ye+Xe[pt],ye+Xe[pt+2],ye+Xe[pt+1]),ke.primitiveLength++}for(const Pe of ve){O&&Pe.length&&O.startRing(Pe[0]);let et,Xe,pt,Vt=Pe.length>4&&M_(Pe[Pe.length-2],Pe[0],Pe[1]),it=he?D_(Pe[Pe.length-2],Pe[0],Pe[1],he):0;Xe=Pe[1].sub(Pe[0])._perp()._unit();let xt=!0;for(let Tt=1,Pt=0;Tt<Pe.length;Tt++){let jt=Pe[Tt-1],at=Pe[Tt];const Jt=Pe[Tt===Pe.length-1?1:Tt+1];if(O&&B&&O.currentPolyCount.top++,S_(at,jt,Ie)){he&&(Xe=Jt.sub(at)._perp()._unit(),xt=!xt);continue}O&&O.append(at,jt);const Un=at.sub(jt)._perp(),rn=Un.x/(Math.abs(Un.x)+Math.abs(Un.y)),bn=Un.y>0?1:0,Qt=jt.dist(at);if(Pt+Qt>32768&&(Pt=0),he){pt=Jt.sub(at)._perp()._unit();let wr=C_(jt,at,Jt,Fd(Xe,pt),he);isNaN(wr)&&(wr=0);const Zn=at.sub(jt)._unit();jt=jt.add(Zn.mult(it))._round(),at=at.add(Zn.mult(-wr))._round(),it=wr,Xe=pt}const Gn=ke.vertexLength,Ir=Pe.length>4&&M_(jt,at,Jt);let Dr=Vm(Pt,Vt,xt);if(Bu(this.layoutVertexArray,jt.x,jt.y,rn,bn,0,0,Dr),Bu(this.layoutVertexArray,jt.x,jt.y,rn,bn,0,1,Dr),Pt+=Qt,Dr=Vm(Pt,Ir,!xt),Vt=Ir,Bu(this.layoutVertexArray,at.x,at.y,rn,bn,0,0,Dr),Bu(this.layoutVertexArray,at.x,at.y,rn,bn,0,1,Dr),ke.vertexLength+=4,this.indexArray.emplaceBack(Gn+0,Gn+1,Gn+2),this.indexArray.emplaceBack(Gn+1,Gn+3,Gn+2),ke.primitiveLength+=2,he){const wr=ye+(1===Tt?Pe.length-2:Tt-2),Zn=1===Tt?ye:wr+1;if(this.indexArray.emplaceBack(Gn+1,wr,Gn+3),this.indexArray.emplaceBack(wr,Zn,Gn+3),ke.primitiveLength+=2,void 0===et&&(et=Gn),!S_(Jt,Pe[Tt],Ie)){const ii=Tt===Pe.length-1?et:ke.vertexLength;this.indexArray.emplaceBack(Gn+2,Gn+3,ii),this.indexArray.emplaceBack(Gn+3,ii+1,ii),this.indexArray.emplaceBack(Gn+3,Zn,ii+1),ke.primitiveLength+=3}xt=!xt}if(k){const wr=this.layoutVertexExtArray,Zn=D.projectTilePoint(jt.x,jt.y,h),ii=D.projectTilePoint(at.x,at.y,h),ir=D.upVector(h,jt.x,jt.y),Fr=D.upVector(h,at.x,at.y);Ml(wr,Zn,ir),Ml(wr,Zn,ir),Ml(wr,ii,Fr),Ml(wr,ii,Fr)}}B&&(ye+=Pe.length-1)}}if(O&&O.polyCount.length>0){if(O.borders){O.vertexArrayOffset=this.centroidVertexArray.length;const ve=O.borders,Ie=this.featuresOnBorder.push(O)-1;for(let ye=0;ye<4;ye++)ve[ye][0]!==Number.MAX_VALUE&&this.borders[ye].push(Ie)}this.encodeCentroid(O.borders?void 0:O.centroid(),O)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,g,y,h)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((n,s)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,n,s=!0){let h,g;if(e)if(0!==e.y){const w=n.span()._mult(this.tileToMeter);h=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(w.x/10)),g=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(w.y/10))}else h=Math.ceil(7*(e.x+450)),g=0;else h=0,g=+s;let y=s?this.centroidVertexArray.length:n.vertexArrayOffset;for(const w of n.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*w.edges+w.top);for(let T=0;T<w.top;T++)this.centroidVertexArray.emplace(y++,h,g);for(let T=0;T<2*w.edges;T++)this.centroidVertexArray.emplace(y++,0,g),this.centroidVertexArray.emplace(y++,h,g)}}}function Fd(t,e){const n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function D_(t,e,n,s){const h=e.sub(t)._perp()._unit(),g=n.sub(e)._perp()._unit();return C_(t,e,n,Fd(h,g),s)}function C_(t,e,n,s,h){const g=Math.sqrt(1-s*s);return Math.min(t.dist(e)/3,e.dist(n)/3,h*g/s)}function S_(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function M_(t,e,n){if(t.x<0||t.x>=Wn||e.x<0||e.x>=Wn||n.x<0||n.x>=Wn)return!1;const s=n.sub(e),h=s.perp(),g=t.sub(e);return(s.x*g.x+s.y*g.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(g.x*g.x+g.y*g.y))>-.866&&h.x*g.x+h.y*g.y<0}function Vm(t,e,n){const s=e?2|t:-3&t;return n?1|s:-2&s}function ip(){const t=Math.PI/32,e=Math.tan(t),n=Au;return n*Math.sqrt(1+2*e*e)-n}function I_(t,e,n){const s=1<<n.z,h=Ga(n.x/s),g=Ga((n.x+1)/s),y=vs(n.y/s),w=vs((n.y+1)/s);return function(T,D,k,O,B=0,V){const G=[];if(!T.length||!k||!O)return G;const J=(Pe,et)=>{for(const Xe of Pe)G.push({polygon:Xe,bounds:et})},he=Math.ceil(Math.log2(k)),ve=Math.ceil(Math.log2(O)),Ie=he-ve,ye=[];for(let Pe=0;Pe<Math.abs(Ie);Pe++)ye.push(Ie>0?0:1);for(let Pe=0;Pe<Math.min(he,ve);Pe++)ye.push(0),ye.push(1);let Ce=T;if(Ce=Od(Ce,D[0].y-B,D[1].y+B,1),Ce=Od(Ce,D[0].x-B,D[1].x+B,0),!Ce.length)return G;const ke=[];for(ye.length?ke.push({polygons:Ce,bounds:D,depth:0}):J(Ce,D);ke.length;){const Pe=ke.pop(),et=Pe.depth,Xe=ye[et],pt=Pe.bounds[0],Vt=Pe.bounds[1],it=0===Xe?pt.x:pt.y,xt=0===Xe?Vt.x:Vt.y,Tt=V?V(Xe,it,xt):.5*(it+xt),Pt=Od(Pe.polygons,it-B,Tt+B,Xe),jt=Od(Pe.polygons,Tt-B,xt+B,Xe);if(Pt.length){const at=[pt,new dt(0===Xe?Tt:Vt.x,1===Xe?Tt:Vt.y)];ye.length>et+1?ke.push({polygons:Pt,bounds:at,depth:et+1}):J(Pt,at)}if(jt.length){const at=[new dt(0===Xe?Tt:pt.x,1===Xe?Tt:pt.y),Vt];ye.length>et+1?ke.push({polygons:jt,bounds:at,depth:et+1}):J(jt,at)}}return G}(t,e,Math.ceil((g-h)/11.25),Math.ceil((y-w)/11.25),1,(T,D,k)=>{if(0===T)return.5*(D+k);{const O=vs((n.y+D/Wn)/s);return(Hi(.5*(vs((n.y+k/Wn)/s)+O))*s-n.y)*Wn}})}yn(ou,"FillExtrusionBucket",{omit:["layers","features"]}),yn(jm,"PartMetadata");const A_=new Nt({"fill-extrusion-edge-radius":new He(st["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var Nu={paint:new Nt({"fill-extrusion-opacity":new He(st["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new rt(st["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new He(st["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new He(st["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new rt(st["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new rt(st["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new rt(st["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new He(st["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new He(st["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new He(st["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:A_};function $m(t,e,n){var s=2*Math.PI*6378137/256/Math.pow(2,n);return[t*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class Ih{constructor(e,n,s){this.z=e,this.x=n,this.y=s,this.key=Uu(0,e,e,n,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const s=(y=this.y,w=this.z,T=$m(256*(g=this.x),256*(y=Math.pow(2,w)-y-1),w),D=$m(256*(g+1),256*(y+1),w),T[0]+","+T[1]+","+D[0]+","+D[1]),h=function(g,y,w){let T,D="";for(let k=g;k>0;k--)T=1<<k-1,D+=(y&T?1:0)+(w&T?2:0);return D}(this.z,this.x,this.y);var g,y,w,T,D;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Ah{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Uu(e,n.z,n.z,n.x,n.y)}}class sa{constructor(e,n,s,h,g){this.overscaledZ=e,this.wrap=n,this.canonical=new Ih(s,+h,+g),this.key=0===n&&e===s?this.canonical.key:Uu(n,e,s,h,g)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new sa(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new sa(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Uu(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Uu(this.wrap*+n,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new sa(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,s=2*this.canonical.x,h=2*this.canonical.y;return[new sa(n,this.wrap,n,s,h),new sa(n,this.wrap,n,s+1,h),new sa(n,this.wrap,n,s,h+1),new sa(n,this.wrap,n,s+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new sa(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new sa(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Ah(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Uu(t,e,n,s,h){const g=1<<Math.min(n,22);let y=g*(h%g)+s%g;return t&&n<22&&(y+=g*g*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*y+n)+(e-n)}yn(Ih,"CanonicalTileID"),yn(sa,"OverscaledTileID",{omit:["projMatrix"]});class ju extends dt{constructor(e,n,s){super(e,n),this.z=s}}function Ph(t,e){return t.x*e.x+t.y*e.y}function Gm(t,e){if(1===t.length){let n=0;const s=e[n++];let h;for(;!h||s.equals(h);)if(h=e[n++],!h)return 1/0;for(;n<e.length;n++){const g=e[n],y=t[0],w=h.sub(s),T=g.sub(s),D=y.sub(s),k=Ph(w,w),O=Ph(w,T),B=Ph(T,T),V=Ph(D,w),G=Ph(D,T),J=k*B-O*O,he=(B*V-O*G)/J,ve=(k*G-O*V)/J,Ie=s.z*(1-he-ve)+h.z*he+g.z*ve;if(isFinite(Ie))return Ie}return 1/0}{let n=1/0;for(const s of e)n=Math.min(n,s.z);return n}}function Hm(t,e,n,s,h,g,y,w){const T=y*h.getElevationAt(t,e,!0,!0),D=0!==g[0],k=D?0===g[1]?y*(g[0]/7-450):y*function(O,B,V){const G=Math.floor(B[0]/8),J=Math.floor(B[1]/8),he=10*(B[0]-8*G),ve=10*(B[1]-8*J),Ie=O.getElevationAt(G,J,!0,!0),ye=O.getMeterToDEM(V),Ce=Math.floor(.5*(he*ye-1)),ke=Math.floor(.5*(ve*ye-1)),Pe=O.tileCoordToPixel(G,J),et=2*Ce+1,Xe=2*ke+1,pt=(Un=et,rn=Xe,[(jt=O).getElevationAtPixel(at=Pe.x-Ce,Jt=Pe.y-ke,!0),jt.getElevationAtPixel(at+rn,Jt,!0),jt.getElevationAtPixel(at,Jt+rn,!0),jt.getElevationAtPixel(at+Un,Jt+rn,!0)]),Vt=Math.abs(pt[0]-pt[1]),it=Math.abs(pt[2]-pt[3]),xt=Math.abs(pt[0]-pt[2])+Math.abs(pt[1]-pt[3]),Tt=Math.min(.25,.5*ye*(Vt+it)/et),Pt=Math.min(.25,.5*ye*xt/Xe);var jt,at,Jt,Un,rn;return Ie+Math.max(Tt*he,Pt*ve)}(h,g,w):T;return{base:T+(0===n)?-1:n,top:D?Math.max(k+s,T+n+2):T+s}}const P_=Sn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:qm}=P_,R_=Sn([{name:"a_packed",components:4,type:"Float32"}]),{members:Wm}=R_,Zm=Ld.types,op=Math.cos(Math.PI/180*37.5);class sp{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new bi,this.layoutVertexArray2=new Si,this.indexArray=new Ss,this.programConfigurations=new Xc(e.layers,e.zoom),this.segments=new yo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,h){this.hasPattern=tp("line",this.layers,n);const g=this.layers[0].layout.get("line-sort-key"),y=[];for(const{feature:k,id:O,index:B,sourceLayerIndex:V}of e){const G=this.layers[0]._featureFilter.needGeometry,J=Oc(k,G);if(!this.layers[0]._featureFilter.filter(new qe(this.zoom),J,s))continue;const he=g?g.evaluate(J,{},s):void 0,ve={id:O,properties:k.properties,type:k.type,sourceLayerIndex:V,index:B,geometry:G?J.geometry:Zl(k,s,h),patterns:{},sortKey:he};y.push(ve)}g&&y.sort((k,O)=>k.sortKey-O.sortKey);const{lineAtlas:w,featureIndex:T}=n,D=this.addConstantDashes(w);for(const k of y){const{geometry:O,index:B,sourceLayerIndex:V}=k;if(D&&this.addFeatureDashes(k,w),this.hasPattern){const G=np("line",this.layers,k,this.zoom,n);this.patternFeatures.push(G)}else this.addFeature(k,O,B,s,w.positions,n.availableImages);T.insert(e[B].feature,O,B,V,this.index)}}addConstantDashes(e){let n=!1;for(const s of this.layers){const h=s.paint.get("line-dasharray").value,g=s.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==g.kind)n=!0;else{const y=g.value,w=h.value;if(!w)continue;e.addDash(w,y)}}return n}addFeatureDashes(e,n){const s=this.zoom;for(const h of this.layers){const g=h.paint.get("line-dasharray").value,y=h.layout.get("line-cap").value;if("constant"===g.kind&&"constant"===y.kind)continue;let w,T;if("constant"===g.kind){if(w=g.value,!w)continue}else w=g.evaluate({zoom:s},e);T="constant"===y.kind?y.value:y.evaluate({zoom:s},e),n.addDash(w,T),e.patterns[h.id]=n.getKey(w,T)}}update(e,n,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,h)}addFeatures(e,n,s,h,g){for(const y of this.patternFeatures)this.addFeature(y,y.geometry,y.index,n,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Wm)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,qm),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,s,h,g,y){const w=this.layers[0].layout,T=w.get("line-join").evaluate(e,{}),D=w.get("line-cap").evaluate(e,{}),k=w.get("line-miter-limit"),O=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const B of n)this.addLine(B,e,T,D,k,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,g,y,h)}addLine(e,n,s,h,g,y){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ve=0;ve<e.length-1;ve++)this.totalDistance+=e[ve].dist(e[ve+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w="Polygon"===Zm[n.type];let T=e.length;for(;T>=2&&e[T-1].equals(e[T-2]);)T--;let D=0;for(;D<T-1&&e[D].equals(e[D+1]);)D++;if(T<(w?3:2))return;"bevel"===s&&(g=1.05);const k=this.overscaling<=16?122880/(512*this.overscaling):0,O=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let B,V,G,J,he;this.e1=this.e2=-1,w&&(B=e[T-2],he=e[D].sub(B)._unit()._perp());for(let ve=D;ve<T;ve++){if(G=ve===T-1?w?e[D+1]:void 0:e[ve+1],G&&e[ve].equals(G))continue;he&&(J=he),B&&(V=B),B=e[ve],he=G?G.sub(B)._unit()._perp():J,J=J||he;let Ie=J.add(he);0===Ie.x&&0===Ie.y||Ie._unit();const ye=J.x*he.x+J.y*he.y,Ce=Ie.x*he.x+Ie.y*he.y,ke=0!==Ce?1/Ce:1/0,Pe=2*Math.sqrt(2-2*Ce),et=Ce<op&&V&&G,Xe=J.x*he.y-J.y*he.x>0;if(et&&ve>D){const it=B.dist(V);if(it>2*k){const xt=B.sub(B.sub(V)._mult(k/it)._round());this.updateDistance(V,xt),this.addCurrentVertex(xt,J,0,0,O),V=xt}}const pt=V&&G;let Vt=pt?s:w?"butt":h;if(pt&&"round"===Vt&&(ke<y?Vt="miter":ke<=2&&(Vt="fakeround")),"miter"===Vt&&ke>g&&(Vt="bevel"),"bevel"===Vt&&(ke>2&&(Vt="flipbevel"),ke<g&&(Vt="miter")),V&&this.updateDistance(V,B),"miter"===Vt)Ie._mult(ke),this.addCurrentVertex(B,Ie,0,0,O);else if("flipbevel"===Vt){if(ke>100)Ie=he.mult(-1);else{const it=ke*J.add(he).mag()/J.sub(he).mag();Ie._perp()._mult(it*(Xe?-1:1))}this.addCurrentVertex(B,Ie,0,0,O),this.addCurrentVertex(B,Ie.mult(-1),0,0,O)}else if("bevel"===Vt||"fakeround"===Vt){const it=-Math.sqrt(ke*ke-1),xt=Xe?it:0,Tt=Xe?0:it;if(V&&this.addCurrentVertex(B,J,xt,Tt,O),"fakeround"===Vt){const Pt=Math.round(180*Pe/Math.PI/20);for(let jt=1;jt<Pt;jt++){let at=jt/Pt;if(.5!==at){const Un=at-.5;at+=at*Un*(at-1)*((1.0904+ye*(ye*(3.55645-1.43519*ye)-3.2452))*Un*Un+(.848013+ye*(.215638*ye-1.06021)))}const Jt=he.sub(J)._mult(at)._add(J)._unit()._mult(Xe?-1:1);this.addHalfVertex(B,Jt.x,Jt.y,!1,Xe,0,O)}}G&&this.addCurrentVertex(B,he,-xt,-Tt,O)}else if("butt"===Vt)this.addCurrentVertex(B,Ie,0,0,O);else if("square"===Vt){const it=V?1:-1;V||this.addCurrentVertex(B,Ie,it,it,O),this.addCurrentVertex(B,Ie,0,0,O),V&&this.addCurrentVertex(B,Ie,it,it,O)}else"round"===Vt&&(V&&(this.addCurrentVertex(B,J,0,0,O),this.addCurrentVertex(B,J,1,1,O,!0)),G&&(this.addCurrentVertex(B,he,-1,-1,O,!0),this.addCurrentVertex(B,he,0,0,O)));if(et&&ve<T-1){const it=B.dist(G);if(it>2*k){const xt=B.add(G.sub(B)._mult(k/it)._round());this.updateDistance(B,xt),this.addCurrentVertex(xt,he,0,0,O),B=xt}}}}addCurrentVertex(e,n,s,h,g,y=!1){const w=n.y*h-n.x,T=-n.y-n.x*h;this.addHalfVertex(e,n.x+n.y*s,n.y-n.x*s,y,!1,s,g),this.addHalfVertex(e,w,T,y,!0,-h,g)}addHalfVertex({x:e,y:n},s,h,g,y,w,T){this.layoutVertexArray.emplaceBack((e<<1)+(g?1:0),(n<<1)+(y?1:0),Math.round(63*s)+128,Math.round(63*h)+128,1+(0===w?0:w<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const D=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),T.primitiveLength++),y?this.e2=D:this.e1=D}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}yn(sp,"LineBucket",{omit:["layers","patternFeatures"]});const ap=new Nt({"line-cap":new rt(st.layout_line["line-cap"]),"line-join":new rt(st.layout_line["line-join"]),"line-miter-limit":new He(st.layout_line["line-miter-limit"]),"line-round-limit":new He(st.layout_line["line-round-limit"]),"line-sort-key":new rt(st.layout_line["line-sort-key"])});var Xm={paint:new Nt({"line-opacity":new rt(st.paint_line["line-opacity"]),"line-color":new rt(st.paint_line["line-color"]),"line-translate":new He(st.paint_line["line-translate"]),"line-translate-anchor":new He(st.paint_line["line-translate-anchor"]),"line-width":new rt(st.paint_line["line-width"]),"line-gap-width":new rt(st.paint_line["line-gap-width"]),"line-offset":new rt(st.paint_line["line-offset"]),"line-blur":new rt(st.paint_line["line-blur"]),"line-dasharray":new rt(st.paint_line["line-dasharray"]),"line-pattern":new rt(st.paint_line["line-pattern"]),"line-gradient":new St(st.paint_line["line-gradient"]),"line-trim-offset":new He(st.paint_line["line-trim-offset"])}),layout:ap};const k_=new class extends rt{possiblyEvaluate(t,e){return e=new qe(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,s){return e=$e({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,s)}}(Xm.paint.properties["line-width"].specification);function su(t,e){return e>0?e+2*t:t}k_.useIntegerZoom=!0;const Km=Sn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),L_=Sn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Ym=Sn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Sn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const O_=Sn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),F_=Sn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Sn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Rh=Sn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Vu=Sn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Sn([{name:"triangle",components:3,type:"Uint16"}]),Sn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Sn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Sn([{type:"Float32",name:"offsetX"}]),Sn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var rs=24;const Fa=128;function kh(t,e){const{expression:n}=e;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new qe(t+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:h}=n;let g=0;for(;g<s.length&&s[g]<=t;)g++;g=Math.max(0,g-1);let y=g;for(;y<s.length&&s[y]<t+1;)y++;y=Math.min(s.length-1,y);const w=s[g],T=s[y];return"composite"===n.kind?{kind:"composite",minZoom:w,maxZoom:T,interpolationType:h}:{kind:"camera",minZoom:w,maxZoom:T,minSize:n.evaluate(new qe(w)),maxSize:n.evaluate(new qe(T)),interpolationType:h}}}function au(t,{uSize:e,uSizeT:n},{lowerSize:s,upperSize:h}){return"source"===t.kind?s/Fa:"composite"===t.kind?fr(s/Fa,h/Fa,n):e}function lu(t,e){let n=0,s=0;if("constant"===t.kind)s=t.layoutSize;else if("source"!==t.kind){const{interpolationType:h,minZoom:g,maxZoom:y}=t,w=h?ft(Po.interpolationFactor(h,e,g,y),0,1):0;"camera"===t.kind?s=fr(t.minSize,t.maxSize,w):n=w}return{uSizeT:n,uSize:s}}var lp=Object.freeze({__proto__:null,getSizeData:kh,evaluateSizeForFeature:au,evaluateSizeForZoom:lu,SIZE_PACK_FACTOR:Fa});function cp(t,e,n){return t.sections.forEach(s=>{s.text=function(h,g,y){const w=g.layout.get("text-transform").evaluate(y,{});return"uppercase"===w?h=h.toLocaleUpperCase():"lowercase"===w&&(h=h.toLocaleLowerCase()),ze.applyArabicShaping&&(h=ze.applyArabicShaping(h)),h}(s.text,e,n)}),t}const cu={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function Jm(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function up(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}var Lh=Mi,Qm=function(t,e,n,s,h){var g,y,w=8*h-s-1,T=(1<<w)-1,D=T>>1,k=-7,O=n?h-1:0,B=n?-1:1,V=t[e+O];for(O+=B,g=V&(1<<-k)-1,V>>=-k,k+=w;k>0;g=256*g+t[e+O],O+=B,k-=8);for(y=g&(1<<-k)-1,g>>=-k,k+=s;k>0;y=256*y+t[e+O],O+=B,k-=8);if(0===g)g=1-D;else{if(g===T)return y?NaN:1/0*(V?-1:1);y+=Math.pow(2,s),g-=D}return(V?-1:1)*y*Math.pow(2,g-s)},hp=function(t,e,n,s,h,g){var y,w,T,D=8*g-h-1,k=(1<<D)-1,O=k>>1,B=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,V=s?0:g-1,G=s?1:-1,J=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(w=isNaN(e)?1:0,y=k):(y=Math.floor(Math.log(e)/Math.LN2),e*(T=Math.pow(2,-y))<1&&(y--,T*=2),(e+=y+O>=1?B/T:B*Math.pow(2,1-O))*T>=2&&(y++,T/=2),y+O>=k?(w=0,y=k):y+O>=1?(w=(e*T-1)*Math.pow(2,h),y+=O):(w=e*Math.pow(2,O-1)*Math.pow(2,h),y=0));h>=8;t[n+V]=255&w,V+=G,w/=256,h-=8);for(y=y<<h|w,D+=h;D>0;t[n+V]=255&y,V+=G,y/=256,D-=8);t[n+V-G]|=128*J};function Mi(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Mi.Varint=0,Mi.Fixed64=1,Mi.Bytes=2,Mi.Fixed32=5;var zd=4294967296,dp=1/zd,eg=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function gc(t){return t.type===Mi.Bytes?t.readVarint()+t.pos:t.pos+1}function fp(t,e,n){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(s);for(var h=n.pos-1;h>=t;h--)n.buf[h+s]=n.buf[h]}function z_(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function Gy(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function pp(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function tg(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function B_(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function N_(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function U_(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function ng(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function j_(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Bd(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Uc(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function rg(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function V_(t,e,n){e.glyphs=[],1===t&&n.readMessage($_,e)}function $_(t,e,n){if(3===t){const{id:s,bitmap:h,width:g,height:y,left:w,top:T,advance:D}=n.readMessage(G_,{});e.glyphs.push({id:s,bitmap:new Xl({width:g+6,height:y+6},h),metrics:{width:g,height:y,left:w,top:T,advance:D}})}else 4===t?e.ascender=n.readSVarint():5===t&&(e.descender=n.readSVarint())}function G_(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function mp(t){let e=0,n=0;for(const y of t)e+=y.w*y.h,n=Math.max(n,y.w);t.sort((y,w)=>w.h-y.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let h=0,g=0;for(const y of t)for(let w=s.length-1;w>=0;w--){const T=s[w];if(!(y.w>T.w||y.h>T.h)){if(y.x=T.x,y.y=T.y,g=Math.max(g,y.y+y.h),h=Math.max(h,y.x+y.w),y.w===T.w&&y.h===T.h){const D=s.pop();w<s.length&&(s[w]=D)}else y.h===T.h?(T.x+=y.w,T.w-=y.w):y.w===T.w?(T.y+=y.h,T.h-=y.h):(s.push({x:T.x+y.w,y:T.y,w:T.w-y.w,h:y.h}),T.y+=y.h,T.h-=y.h);break}}return{w:h,h:g,fill:e/(h*g)||0}}Mi.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var s=this.readVarint(),h=s>>3,g=this.pos;this.type=7&s,t(h,e,this),this.pos===g&&this.skip(s)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Bd(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=rg(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Bd(this.buf,this.pos)+Bd(this.buf,this.pos+4)*zd;return this.pos+=8,t},readSFixed64:function(){var t=Bd(this.buf,this.pos)+rg(this.buf,this.pos+4)*zd;return this.pos+=8,t},readFloat:function(){var t=Qm(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Qm(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,s=this.buf;return e=127&(n=s[this.pos++]),n<128?e:(e|=(127&(n=s[this.pos++]))<<7,n<128?e:(e|=(127&(n=s[this.pos++]))<<14,n<128?e:(e|=(127&(n=s[this.pos++]))<<21,n<128?e:function(h,g,y){var w,T,D=y.buf;if(w=(112&(T=D[y.pos++]))>>4,T<128||(w|=(127&(T=D[y.pos++]))<<3,T<128)||(w|=(127&(T=D[y.pos++]))<<10,T<128)||(w|=(127&(T=D[y.pos++]))<<17,T<128)||(w|=(127&(T=D[y.pos++]))<<24,T<128)||(w|=(1&(T=D[y.pos++]))<<31,T<128))return function Is(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(h,w,g);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=s[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&eg?eg.decode(this.buf.subarray(e,t)):function(n,s,h){for(var g="",y=s;y<h;){var w,T,D,k=n[y],O=null,B=k>239?4:k>223?3:k>191?2:1;if(y+B>h)break;1===B?k<128&&(O=k):2===B?128==(192&(w=n[y+1]))&&(O=(31&k)<<6|63&w)<=127&&(O=null):3===B?(T=n[y+2],128==(192&(w=n[y+1]))&&128==(192&T)&&((O=(15&k)<<12|(63&w)<<6|63&T)<=2047||O>=55296&&O<=57343)&&(O=null)):4===B&&(T=n[y+2],D=n[y+3],128==(192&(w=n[y+1]))&&128==(192&T)&&128==(192&D)&&((O=(15&k)<<18|(63&w)<<12|(63&T)<<6|63&D)<=65535||O>=1114112)&&(O=null)),null===O?(O=65533,B=1):O>65535&&(O-=65536,g+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),g+=String.fromCharCode(O),y+=B}return g}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Mi.Bytes)return t.push(this.readVarint(e));var n=gc(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Mi.Bytes)return t.push(this.readSVarint());var e=gc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Mi.Bytes)return t.push(this.readBoolean());var e=gc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Mi.Bytes)return t.push(this.readFloat());var e=gc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Mi.Bytes)return t.push(this.readDouble());var e=gc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Mi.Bytes)return t.push(this.readFixed32());var e=gc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Mi.Bytes)return t.push(this.readSFixed32());var e=gc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Mi.Bytes)return t.push(this.readFixed64());var e=gc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Mi.Bytes)return t.push(this.readSFixed64());var e=gc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Mi.Varint)for(;this.buf[this.pos++]>127;);else if(e===Mi.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Mi.Fixed32)this.pos+=4;else{if(e!==Mi.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Uc(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Uc(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Uc(this.buf,-1&t,this.pos),Uc(this.buf,Math.floor(t*dp),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Uc(this.buf,-1&t,this.pos),Uc(this.buf,Math.floor(t*dp),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var s,h,g,w;if(e>=0?(s=e%4294967296|0,h=e/4294967296|0):(h=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,h=h+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),g=s,(w=n).buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,w.buf[w.pos]=127&(g>>>=7),function(g,y){var w=(7&g)<<4;y.buf[y.pos++]|=w|((g>>>=3)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g|((g>>>=7)?128:0),g&&(y.buf[y.pos++]=127&g)))))}(h,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(s,h,g){for(var y,w,T=0;T<h.length;T++){if((y=h.charCodeAt(T))>55295&&y<57344){if(!w){y>56319||T+1===h.length?(s[g++]=239,s[g++]=191,s[g++]=189):w=y;continue}if(y<56320){s[g++]=239,s[g++]=191,s[g++]=189,w=y;continue}y=w-55296<<10|y-56320|65536,w=null}else w&&(s[g++]=239,s[g++]=191,s[g++]=189,w=null);y<128?s[g++]=y:(y<2048?s[g++]=y>>6|192:(y<65536?s[g++]=y>>12|224:(s[g++]=y>>18|240,s[g++]=y>>12&63|128),s[g++]=y>>6&63|128),s[g++]=63&y|128)}return g}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&fp(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),hp(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),hp(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var s=this.pos-n;s>=128&&fp(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeMessage:function(t,e,n){this.writeTag(t,Mi.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,z_,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Gy,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,B_,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,pp,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,tg,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,N_,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,U_,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,ng,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,j_,e)},writeBytesField:function(t,e){this.writeTag(t,Mi.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Mi.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Mi.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Mi.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Mi.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Mi.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Mi.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Mi.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Mi.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Mi.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class al{constructor(e,{pixelRatio:n,version:s,stretchX:h,stretchY:g,content:y}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=h,this.stretchY=g,this.content=y,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Nd{constructor(e,n){const s={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(e,s,g),this.addImages(n,h,g);const{w:y,h:w}=mp(g),T=new La({width:y||1,height:w||1});for(const D in e){const k=e[D],O=s[D].paddedRect;La.copy(k.data,T,{x:0,y:0},{x:O.x+1,y:O.y+1},k.data)}for(const D in n){const k=n[D],O=h[D].paddedRect,B=O.x+1,V=O.y+1,G=k.data.width,J=k.data.height;La.copy(k.data,T,{x:0,y:0},{x:B,y:V},k.data),La.copy(k.data,T,{x:0,y:J-1},{x:B,y:V-1},{width:G,height:1}),La.copy(k.data,T,{x:0,y:0},{x:B,y:V+J},{width:G,height:1}),La.copy(k.data,T,{x:G-1,y:0},{x:B-1,y:V},{width:1,height:J}),La.copy(k.data,T,{x:0,y:0},{x:B+G,y:V},{width:1,height:J})}this.image=T,this.iconPositions=s,this.patternPositions=h}addImages(e,n,s){for(const h in e){const g=e[h],y={x:0,y:0,w:g.data.width+2,h:g.data.height+2};s.push(y),n[h]=new al(y,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),n),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),n)}patchUpdatedImage(e,n,s){if(!e||!n||e.version===n.version)return;e.version=n.version;const[h,g]=e.tl;s.update(n.data,void 0,{x:h,y:g})}}yn(al,"ImagePosition"),yn(Nd,"ImageAtlas");const Ha={horizontal:1,vertical:2,horizontalOnly:3};class Oh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const s=new Oh;return s.scale=e||1,s.fontStack=n,s}static forImage(e){const n=new Oh;return n.imageName=e,n}}class uu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const s=new uu;for(let h=0;h<e.sections.length;h++){const g=e.sections[h];g.image?s.addImageSection(g):s.addTextSection(g,n)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(n,s){let h="";for(let g=0;g<n.length;g++){const y=n.charCodeAt(g+1)||null,w=n.charCodeAt(g-1)||null;h+=!s&&(y&&b(y)&&!cu[n[g+1]]||w&&b(w)&&!cu[n[g-1]])||!cu[n[g]]?n[g]:cu[n[g]]}return h}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Ud[this.text.charCodeAt(s)];s++)e++;let n=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Ud[this.text.charCodeAt(s)];s--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const s=new uu;return s.text=this.text.substring(e,n),s.sectionIndex=this.sectionIndex.slice(e,n),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Oh.forText(e.scale,e.fontStack||n));const s=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(s)}addImageSection(e){const n=e.image?e.image.name:"";if(0===n.length)return void cr("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Oh.forImage(n)),this.sectionIndex.push(this.sections.length-1)):cr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function gp(t,e,n,s,h,g,y,w,T,D,k,O,B,V,G){const J=uu.fromFeature(t,h);O===Ha.vertical&&J.verticalizePunctuation(B);let he=[];const ve=function(Pe,et,Xe,pt,Vt,it){if(!Pe)return[];const xt=[],Tt=function(Jt,Un,rn,bn,Qt,Gn){let Ir=0;for(let Dr=0;Dr<Jt.length();Dr++){const wr=Jt.getSection(Dr);Ir+=jd(Jt.getCharCode(Dr),wr,bn,Qt,Un,Gn)}return Ir/Math.max(1,Math.ceil(Ir/rn))}(Pe,et,Xe,pt,Vt,it),Pt=Pe.text.indexOf("\u200b")>=0;let jt=0;for(let Jt=0;Jt<Pe.length();Jt++){const Un=Pe.getSection(Jt),rn=Pe.getCharCode(Jt);if(Ud[rn]||(jt+=jd(rn,Un,pt,Vt,et,it)),Jt<Pe.length()-1){const bn=!((at=rn)<11904||!(ed(at)||Wc(at)||p(at)||Iu(at)||uc(at)||rl(at)||td(at)||li(at)||Su(at)||Mu(at)||cc(at)||_(at)||qc(at)||Hc(at)||Sc(at)||oh(at)||Bl(at)||ba(at)||Mc(at)||go(at)));(H_[rn]||bn||Un.imageName)&&xt.push(Fh(Jt+1,jt,Tt,xt,q_(rn,Pe.getCharCode(Jt+1),bn&&Pt),!1))}}var at;return Vd(Fh(Pe.length(),jt,Tt,xt,0,!0))}(J,D,g,e,s,V),{processBidirectionalText:Ie,processStyledBidirectionalText:ye}=ze;if(Ie&&1===J.sections.length){const Pe=Ie(J.toString(),ve);for(const et of Pe){const Xe=new uu;Xe.text=et,Xe.sections=J.sections;for(let pt=0;pt<et.length;pt++)Xe.sectionIndex.push(0);he.push(Xe)}}else if(ye){const Pe=ye(J.text,J.sectionIndex,ve);for(const et of Pe){const Xe=new uu;Xe.text=et[0],Xe.sectionIndex=et[1],Xe.sections=J.sections,he.push(Xe)}}else he=function(Pe,et){const Xe=[],pt=Pe.text;let Vt=0;for(const it of et)Xe.push(Pe.substring(Vt,it)),Vt=it;return Vt<pt.length&&Xe.push(Pe.substring(Vt,pt.length)),Xe}(J,ve);const Ce=[],ke={positionedLines:Ce,text:J.toString(),top:k[1],bottom:k[1],left:k[0],right:k[0],writingMode:O,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Pe,et,Xe,pt,Vt,it,xt,Tt,Pt,jt,at,Jt){let Un=0,rn=0,bn=0;const Qt="right"===Tt?1:"left"===Tt?0:.5;let Gn=!1;for(const ir of Vt){const Fr=ir.getSections();for(const _i of Fr){if(_i.imageName)continue;const Bi=et[_i.fontStack];if(Bi&&(Gn=void 0!==Bi.ascender&&void 0!==Bi.descender,!Gn))break}if(!Gn)break}let Ir=0;for(const ir of Vt){ir.trim();const Fr=ir.getMaxScale(),_i=(Fr-1)*rs,Bi={positionedGlyphs:[],lineOffset:0};Pe.positionedLines[Ir]=Bi;const Ii=Bi.positionedGlyphs;let Ni=0;if(!ir.length()){rn+=it,++Ir;continue}let qi=0,po=0;for(let hi=0;hi<ir.length();hi++){const Oo=ir.getSection(hi),Co=ir.getSectionIndex(hi),Xr=ir.getCharCode(hi);let no=Oo.scale,Wo=null,yi=null,vo=null,Hs=rs,ws=0;const os=!(Pt===Ha.horizontal||!at&&!v(Xr)||at&&(Ud[Xr]||(Dr=Xr,$a(Dr)||Cu(Dr)||zl(Dr)||_s(Dr)||l(Dr))));if(Oo.imageName){const qs=pt[Oo.imageName];if(!qs)continue;vo=Oo.imageName,Pe.iconsInText=Pe.iconsInText||!0,yi=qs.paddedRect;const ss=qs.displaySize;no=no*rs/Jt,Wo={width:ss[0],height:ss[1],left:1,top:-3,advance:os?ss[1]:ss[0],localGlyph:!1},ws=Gn?-Wo.height*no:Fr*rs-17-ss[1]*no,Hs=Wo.advance;const nc=(os?ss[0]:ss[1])*no-rs*Fr;nc>0&&nc>Ni&&(Ni=nc)}else{const qs=Xe[Oo.fontStack];if(!qs)continue;qs[Xr]&&(yi=qs[Xr]);const ss=et[Oo.fontStack];if(!ss)continue;const nc=ss.glyphs[Xr];if(!nc)continue;if(Wo=nc.metrics,Hs=8203!==Xr?rs:0,Gn){const xu=void 0!==ss.ascender?Math.abs(ss.ascender):0,th=void 0!==ss.descender?Math.abs(ss.descender):0,nh=(xu+th)*no;qi<nh&&(qi=nh,po=(xu-th)/2*no),ws=-xu*no}else ws=(Fr-no)*rs-17}os?(Pe.verticalizable=!0,Ii.push({glyph:Xr,imageName:vo,x:Un,y:rn+ws,vertical:os,scale:no,localGlyph:Wo.localGlyph,fontStack:Oo.fontStack,sectionIndex:Co,metrics:Wo,rect:yi}),Un+=Hs*no+jt):(Ii.push({glyph:Xr,imageName:vo,x:Un,y:rn+ws,vertical:os,scale:no,localGlyph:Wo.localGlyph,fontStack:Oo.fontStack,sectionIndex:Co,metrics:Wo,rect:yi}),Un+=Wo.advance*no+jt)}0!==Ii.length&&(bn=Math.max(Un-jt,bn),Gn?W_(Ii,Qt,Ni,po,it*Fr/2):W_(Ii,Qt,Ni,0,it/2)),Un=0;const xs=it*Fr+Ni;Bi.lineOffset=Math.max(Ni,_i),rn+=xs,++Ir}var Dr;const wr=rn,{horizontalAlign:Zn,verticalAlign:ii}=$u(xt);(function(ir,Fr,_i,Bi,Ii,Ni){const qi=(Fr-_i)*Ii,po=-Ni*Bi;for(const xs of ir)for(const hi of xs.positionedGlyphs)hi.x+=qi,hi.y+=po})(Pe.positionedLines,Qt,Zn,ii,bn,wr),Pe.top+=-ii*wr,Pe.bottom=Pe.top+wr,Pe.left+=-Zn*bn,Pe.right=Pe.left+bn,Pe.hasBaseline=Gn}(ke,e,n,s,he,y,w,T,O,D,B,G),!function(Pe){for(const et of Pe)if(0!==et.positionedGlyphs.length)return!1;return!0}(Ce)&&ke}const Ud={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},H_={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function jd(t,e,n,s,h,g){if(e.imageName){const y=s[e.imageName];return y?y.displaySize[0]*e.scale*rs/g+h:0}{const y=n[e.fontStack],w=y&&y.glyphs[t];return w?w.metrics.advance*e.scale+h:0}}function ig(t,e,n,s){const h=Math.pow(t-e,2);return s?t<e?h/2:2*h:h+Math.abs(n)*n}function q_(t,e,n){let s=0;return 10===t&&(s-=1e4),n&&(s+=150),40!==t&&65288!==t||(s+=50),41!==e&&65289!==e||(s+=50),s}function Fh(t,e,n,s,h,g){let y=null,w=ig(e,n,h,g);for(const T of s){const D=ig(e-T.x,n,h,g)+T.badness;D<=w&&(y=T,w=D)}return{index:t,x:e,priorBreak:y,badness:w}}function Vd(t){return t?Vd(t.priorBreak).concat(t.index):[]}function $u(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function W_(t,e,n,s,h){if(!(e||n||s||h))return;const g=t.length-1,y=t[g],w=(y.x+y.metrics.advance*y.scale)*e;for(let T=0;T<=g;T++)t[T].x-=w,t[T].y+=n+s+h}function _p(t,e,n){const{horizontalAlign:s,verticalAlign:h}=$u(n),g=e[0]-t.displaySize[0]*s,y=e[1]-t.displaySize[1]*h;return{image:t,top:y,bottom:y+t.displaySize[1],left:g,right:g+t.displaySize[0]}}function Z_(t,e,n,s,h,g){const y=t.image;let w;if(y.content){const he=y.content,ve=y.pixelRatio||1;w=[he[0]/ve,he[1]/ve,y.displaySize[0]-he[2]/ve,y.displaySize[1]-he[3]/ve]}const T=e.left*g,D=e.right*g;let k,O,B,V;"width"===n||"both"===n?(V=h[0]+T-s[3],O=h[0]+D+s[1]):(V=h[0]+(T+D-y.displaySize[0])/2,O=V+y.displaySize[0]);const G=e.top*g,J=e.bottom*g;return"height"===n||"both"===n?(k=h[1]+G-s[0],B=h[1]+J+s[2]):(k=h[1]+(G+J-y.displaySize[1])/2,B=k+y.displaySize[1]),{image:y,top:k,right:O,bottom:B,left:V,collisionPadding:w}}class Jl extends dt{constructor(e,n,s,h,g){super(e,n),this.angle=h,this.z=s,void 0!==g&&(this.segment=g)}clone(){return new Jl(this.x,this.y,this.z,this.angle,this.segment)}}function yp(t,e,n,s,h){if(void 0===e.segment)return!0;let g=e,y=e.segment+1,w=0;for(;w>-n/2;){if(y--,y<0)return!1;w-=t[y].dist(g),g=t[y]}w+=t[y].dist(t[y+1]),y++;const T=[];let D=0;for(;w<n/2;){const k=t[y],O=t[y+1];if(!O)return!1;let B=t[y-1].angleTo(k)-k.angleTo(O);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:w,angleDelta:B}),D+=B;w-T[0].distance>s;)D-=T.shift().angleDelta;if(D>h)return!1;y++,w+=k.dist(O)}return!0}function vp(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function xp(t,e,n){return t?.6*e*n:0}function $d(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function _c(t,e,n,s,h,g){const y=xp(n,h,g),w=$d(n,s)*g;let T=0;const D=vp(t)/2;for(let k=0;k<t.length-1;k++){const O=t[k],B=t[k+1],V=O.dist(B);if(T+V>D){const G=(D-T)/V,J=fr(O.x,B.x,G),he=fr(O.y,B.y,G),ve=new Jl(J,he,0,B.angleTo(O),k);return!y||yp(t,ve,w,y,e)?ve:void 0}T+=V}}function Gd(t,e,n,s,h,g,y,w,T){const D=xp(s,g,y),k=$d(s,h),O=k*y,B=0===t[0].x||t[0].x===T||0===t[0].y||t[0].y===T;return e-O<e/4&&(e=O+e/4),zh(t,B?e/2*w%e:(k/2+2*g)*y*w%e,e,D,n,O,B,!1,T)}function zh(t,e,n,s,h,g,y,w,T){const D=g/2,k=vp(t);let O=0,B=e-n,V=[];for(let G=0;G<t.length-1;G++){const J=t[G],he=t[G+1],ve=J.dist(he),Ie=he.angleTo(J);for(;B+n<O+ve;){B+=n;const ye=(B-O)/ve,Ce=fr(J.x,he.x,ye),ke=fr(J.y,he.y,ye);if(Ce>=0&&Ce<T&&ke>=0&&ke<T&&B-D>=0&&B+D<=k){const Pe=new Jl(Ce,ke,0,Ie,G);Pe._round(),s&&!yp(t,Pe,g,s,h)||V.push(Pe)}}O+=ve}return w||V.length||y||(V=zh(t,O/2,n,s,h,g,y,!0,T)),V}function Gu(t,e,n,s,h){const g=[];for(let y=0;y<t.length;y++){const w=t[y];let T;for(let D=0;D<w.length-1;D++){let k=w[D],O=w[D+1];k.x<e&&O.x<e||(k.x<e?k=new dt(e,k.y+(e-k.x)/(O.x-k.x)*(O.y-k.y))._round():O.x<e&&(O=new dt(e,k.y+(e-k.x)/(O.x-k.x)*(O.y-k.y))._round()),k.y<n&&O.y<n||(k.y<n?k=new dt(k.x+(n-k.y)/(O.y-k.y)*(O.x-k.x),n)._round():O.y<n&&(O=new dt(k.x+(n-k.y)/(O.y-k.y)*(O.x-k.x),n)._round()),k.x>=s&&O.x>=s||(k.x>=s?k=new dt(s,k.y+(s-k.x)/(O.x-k.x)*(O.y-k.y))._round():O.x>=s&&(O=new dt(s,k.y+(s-k.x)/(O.x-k.x)*(O.y-k.y))._round()),k.y>=h&&O.y>=h||(k.y>=h?k=new dt(k.x+(h-k.y)/(O.y-k.y)*(O.x-k.x),h)._round():O.y>=h&&(O=new dt(k.x+(h-k.y)/(O.y-k.y)*(O.x-k.x),h)._round()),T&&k.equals(T[T.length-1])||(T=[k],g.push(T)),T.push(O)))))}}return g}yn(Jl,"Anchor");const Bh=1e20;function wp(t,e,n,s,h,g,y,w,T){for(let D=e;D<e+s;D++)bp(t,n*g+D,g,h,y,w,T);for(let D=n;D<n+h;D++)bp(t,D*g+e,1,s,y,w,T)}function bp(t,e,n,s,h,g,y){g[0]=0,y[0]=-Bh,y[1]=Bh,h[0]=t[e];for(let w=1,T=0,D=0;w<s;w++){h[w]=t[e+w*n];const k=w*w;do{const O=g[T];D=(h[w]-h[O]+k-O*O)/(w-O)/2}while(D<=y[T]&&--T>-1);T++,g[T]=w,y[T]=D,y[T+1]=Bh}for(let w=0,T=0;w<s;w++){for(;y[T+1]<w;)T++;const D=g[T],k=w-D;t[e+w*n]=h[D]+k*k}}const Ep={none:0,ideographs:1,all:2};class Hu{constructor(e,n,s){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const s=[];for(const h in e)for(const g of e[h])s.push({stack:h,id:g});dn(s,({stack:h,id:g},y)=>{let w=this.entries[h];w||(w=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=w.glyphs[g];if(void 0!==T)return void y(null,{stack:h,id:g,glyph:T});if(T=this._tinySDF(w,h,g),T)return w.glyphs[g]=T,void y(null,{stack:h,id:g,glyph:T});const D=Math.floor(g/256);if(256*D>65535)return void y(new Error("glyphs > 65535 not supported"));if(w.ranges[D])return void y(null,{stack:h,id:g,glyph:T});let k=w.requests[D];k||(k=w.requests[D]=[],Hu.loadGlyphRange(h,D,this.url,this.requestManager,(O,B)=>{if(B){w.ascender=B.ascender,w.descender=B.descender;for(const V in B.glyphs)this._doesCharSupportLocalGlyph(+V)||(w.glyphs[+V]=B.glyphs[+V]);w.ranges[D]=!0}for(const V of k)V(O,B);delete w.requests[D]})),k.push((O,B)=>{O?y(O):B&&y(null,{stack:h,id:g,glyph:B.glyphs[g]||null})})},(h,g)=>{if(h)n(h);else if(g){const y={};for(const{stack:w,id:T,glyph:D}of g)void 0===y[w]&&(y[w]={}),void 0===y[w].glyphs&&(y[w].glyphs={}),y[w].glyphs[T]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},y[w].ascender=this.entries[w].ascender,y[w].descender=this.entries[w].descender;n(null,y)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Ep.none&&(this.localGlyphMode===Ep.all?!!this.localFontFamily:!!this.localFontFamily&&(Mu(e)||Nl(e)||qc(e)||Bl(e)||li(e)))}_tinySDF(e,n,s){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(s))return;let g=e.tinySDF;if(!g){let J="400";/bold/i.test(n)?J="900":/medium/i.test(n)?J="500":/light/i.test(n)&&(J="200"),g=e.tinySDF=new Hu.TinySDF({fontFamily:h,fontWeight:J,fontSize:48,buffer:6,radius:16}),g.fontWeight=J}if(this.localGlyphs[g.fontWeight][s])return this.localGlyphs[g.fontWeight][s];const y=String.fromCharCode(s),{data:w,width:T,height:D,glyphWidth:k,glyphHeight:O,glyphLeft:B,glyphTop:V,glyphAdvance:G}=g.draw(y);return this.localGlyphs[g.fontWeight][s]={id:s,bitmap:new Xl({width:T,height:D},w),metrics:{width:k/2,height:O/2,left:B/2,top:V/2-27,advance:G/2,localGlyph:!0}}}}function qu(t,e,n,s){const h=[],g=t.image,y=g.pixelRatio,w=g.paddedRect.w-2,T=g.paddedRect.h-2,D=t.right-t.left,k=t.bottom-t.top,O=g.stretchX||[[0,w]],B=g.stretchY||[[0,T]],V=(it,xt)=>it+xt[1]-xt[0],G=O.reduce(V,0),J=B.reduce(V,0),he=w-G,ve=T-J;let Ie=0,ye=G,Ce=0,ke=J,Pe=0,et=he,Xe=0,pt=ve;if(g.content&&s){const it=g.content;Ie=Hd(O,0,it[0]),Ce=Hd(B,0,it[1]),ye=Hd(O,it[0],it[2]),ke=Hd(B,it[1],it[3]),Pe=it[0]-Ie,Xe=it[1]-Ce,et=it[2]-it[0]-ye,pt=it[3]-it[1]-ke}const Vt=(it,xt,Tt,Pt)=>{const jt=qd(it.stretch-Ie,ye,D,t.left),at=Wd(it.fixed-Pe,et,it.stretch,G),Jt=qd(xt.stretch-Ce,ke,k,t.top),Un=Wd(xt.fixed-Xe,pt,xt.stretch,J),rn=qd(Tt.stretch-Ie,ye,D,t.left),bn=Wd(Tt.fixed-Pe,et,Tt.stretch,G),Qt=qd(Pt.stretch-Ce,ke,k,t.top),Gn=Wd(Pt.fixed-Xe,pt,Pt.stretch,J),Ir=new dt(jt,Jt),Dr=new dt(rn,Jt),wr=new dt(rn,Qt),Zn=new dt(jt,Qt),ii=new dt(at/y,Un/y),ir=new dt(bn/y,Gn/y),Fr=e*Math.PI/180;if(Fr){const Ii=Math.sin(Fr),Ni=Math.cos(Fr),qi=[Ni,-Ii,Ii,Ni];Ir._matMult(qi),Dr._matMult(qi),Zn._matMult(qi),wr._matMult(qi)}const _i=it.stretch+it.fixed,Bi=xt.stretch+xt.fixed;return{tl:Ir,tr:Dr,bl:Zn,br:wr,tex:{x:g.paddedRect.x+1+_i,y:g.paddedRect.y+1+Bi,w:Tt.stretch+Tt.fixed-_i,h:Pt.stretch+Pt.fixed-Bi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ii,pixelOffsetBR:ir,minFontScaleX:et/y/D,minFontScaleY:pt/y/k,isSDF:n}};if(s&&(g.stretchX||g.stretchY)){const it=X_(O,he,G),xt=X_(B,ve,J);for(let Tt=0;Tt<it.length-1;Tt++){const Pt=it[Tt],jt=it[Tt+1];for(let at=0;at<xt.length-1;at++)h.push(Vt(Pt,xt[at],jt,xt[at+1]))}}else h.push(Vt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:T+1}));return h}function Hd(t,e,n){let s=0;for(const h of t)s+=Math.max(e,Math.min(n,h[1]))-Math.max(e,Math.min(n,h[0]));return s}function X_(t,e,n){const s=[{fixed:-1,stretch:0}];for(const[h,g]of t){const y=s[s.length-1];s.push({fixed:h-y.stretch,stretch:y.stretch}),s.push({fixed:h-y.stretch,stretch:y.stretch+(g-h)})}return s.push({fixed:e+1,stretch:n}),s}function qd(t,e,n,s){return t/e*n+s}function Wd(t,e,n,s){return t-e*n/s}function K_(t,e,n,s){const h=e+t.positionedLines[s].lineOffset;return 0===s?n+h/2:n+(h+(e+t.positionedLines[s-1].lineOffset))/2}Hu.loadGlyphRange=function(t,e,n,s,h){const g=256*e,y=g+255,w=s.transformRequest(s.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${g}-${y}`),un.Glyphs);tr(w,(T,D)=>{if(T)h(T);else if(D){const k={},O=new Lh(D).readFields(V_,{});for(const B of O.glyphs)k[B.id]=B;h(null,{glyphs:k,ascender:O.ascender,descender:O.descender})}})},Hu.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:s=.25,fontFamily:h="sans-serif",fontWeight:g="normal",fontStyle:y="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=n;const w=this.size=t+4*e,T=this._createCanvas(w),D=this.ctx=T.getContext("2d",{willReadFrequently:!0});D.font=`${y} ${g} ${t}px ${h}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:h,actualBoundingBoxRight:g}=this.ctx.measureText(t),y=Math.ceil(n),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-h))),T=Math.min(this.size-this.buffer,y+Math.ceil(s)),D=w+2*this.buffer,k=T+2*this.buffer,O=Math.max(D*k,0),B=new Uint8ClampedArray(O),V={data:B,width:D,height:k,glyphWidth:w,glyphHeight:T,glyphTop:y,glyphLeft:0,glyphAdvance:e};if(0===w||0===T)return V;const{ctx:G,buffer:J,gridInner:he,gridOuter:ve}=this;G.clearRect(J,J,w,T),G.fillText(t,J,J+y);const Ie=G.getImageData(J,J,w,T);ve.fill(Bh,0,O),he.fill(0,0,O);for(let ye=0;ye<T;ye++)for(let Ce=0;Ce<w;Ce++){const ke=Ie.data[4*(ye*w+Ce)+3]/255;if(0===ke)continue;const Pe=(ye+J)*D+Ce+J;if(1===ke)ve[Pe]=0,he[Pe]=Bh;else{const et=.5-ke;ve[Pe]=et>0?et*et:0,he[Pe]=et<0?et*et:0}}wp(ve,0,0,D,k,D,this.f,this.v,this.z),wp(he,J,J,w,T,D,this.f,this.v,this.z);for(let ye=0;ye<O;ye++){const Ce=Math.sqrt(ve[ye])-Math.sqrt(he[ye]);B[ye]=Math.round(255-255*(Ce/this.radius+this.cutoff))}return V}};class Y_{constructor(e=[],n=J_){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:s}=this,h=n[e];for(;e>0;){const g=e-1>>1,y=n[g];if(s(h,y)>=0)break;n[e]=y,e=g}n[e]=h}_down(e){const{data:n,compare:s}=this,h=this.length>>1,g=n[e];for(;e<h;){let y=1+(e<<1),w=n[y];const T=y+1;if(T<this.length&&s(n[T],w)<0&&(y=T,w=n[T]),s(w,g)>=0)break;n[e]=w,e=y}n[e]=g}}function J_(t,e){return t<e?-1:t>e?1:0}function Q_(t,e=1,n=!1){let s=1/0,h=1/0,g=-1/0,y=-1/0;const w=t[0];for(let V=0;V<w.length;V++){const G=w[V];(!V||G.x<s)&&(s=G.x),(!V||G.y<h)&&(h=G.y),(!V||G.x>g)&&(g=G.x),(!V||G.y>y)&&(y=G.y)}const T=Math.min(g-s,y-h);let D=T/2;const k=new Y_([],ey);if(0===T)return new dt(s,h);for(let V=s;V<g;V+=T)for(let G=h;G<y;G+=T)k.push(new hu(V+D,G+D,D,t));let O=function(V){let G=0,J=0,he=0;const ve=V[0];for(let Ie=0,ye=ve.length,Ce=ye-1;Ie<ye;Ce=Ie++){const ke=ve[Ie],Pe=ve[Ce],et=ke.x*Pe.y-Pe.x*ke.y;J+=(ke.x+Pe.x)*et,he+=(ke.y+Pe.y)*et,G+=3*et}return new hu(J/G,he/G,0,V)}(t),B=k.length;for(;k.length;){const V=k.pop();(V.d>O.d||!O.d)&&(O=V,n&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,B)),V.max-O.d<=e||(D=V.h/2,k.push(new hu(V.p.x-D,V.p.y-D,D,t)),k.push(new hu(V.p.x+D,V.p.y-D,D,t)),k.push(new hu(V.p.x-D,V.p.y+D,D,t)),k.push(new hu(V.p.x+D,V.p.y+D,D,t)),B+=4)}return n&&(console.log(`num probes: ${B}`),console.log(`best distance: ${O.d}`)),O.p}function ey(t,e){return e.max-t.max}class hu{constructor(e,n,s,h){this.p=new dt(e,n),this.h=s,this.d=function(g,y){let w=!1,T=1/0;for(let D=0;D<y.length;D++){const k=y[D];for(let O=0,B=k.length,V=B-1;O<B;V=O++){const G=k[O],J=k[V];G.y>g.y!=J.y>g.y&&g.x<(J.x-G.x)*(g.y-G.y)/(J.y-G.y)+G.x&&(w=!w),T=Math.min(T,Zf(g,G,J))}}return(w?1:-1)*Math.sqrt(T)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const Nh=Number.POSITIVE_INFINITY,ty=Math.sqrt(2);function Zd(t,[e,n]){let s=0,h=0;if(n===Nh){e<0&&(e=0);const g=e/ty;switch(t){case"top-right":case"top-left":h=g-7;break;case"bottom-right":case"bottom-left":h=7-g;break;case"bottom":h=7-e;break;case"top":h=e-7}switch(t){case"top-right":case"bottom-right":s=-g;break;case"top-left":case"bottom-left":s=g;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":h=n-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-n}switch(t){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,h]}function ny(t,e,n,s,h,g,y,w,T,D){t.createArrays(),t.tilePixelRatio=Wn/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const k=t.layers[0].layout,O=t.layers[0]._unevaluatedLayout._values,B={};if("composite"===t.textSizeData.kind){const{minZoom:J,maxZoom:he}=t.textSizeData;B.compositeTextSizes=[O["text-size"].possiblyEvaluate(new qe(J),w),O["text-size"].possiblyEvaluate(new qe(he),w)]}if("composite"===t.iconSizeData.kind){const{minZoom:J,maxZoom:he}=t.iconSizeData;B.compositeIconSizes=[O["icon-size"].possiblyEvaluate(new qe(J),w),O["icon-size"].possiblyEvaluate(new qe(he),w)]}B.layoutTextSize=O["text-size"].possiblyEvaluate(new qe(T+1),w),B.layoutIconSize=O["icon-size"].possiblyEvaluate(new qe(T+1),w),B.textMaxSize=O["text-size"].possiblyEvaluate(new qe(18),w);const V="map"===k.get("text-rotation-alignment")&&"point"!==k.get("symbol-placement"),G=k.get("text-size");for(const J of t.features){const he=k.get("text-font").evaluate(J,{},w).join(","),ve=G.evaluate(J,{},w),Ie=B.layoutTextSize.evaluate(J,{},w),ye=(B.layoutIconSize.evaluate(J,{},w),{horizontal:{},vertical:void 0}),Ce=J.text;let ke,Pe=[0,0];if(Ce){const pt=Ce.toString(),Vt=k.get("text-letter-spacing").evaluate(J,{},w)*rs,it=k.get("text-line-height").evaluate(J,{},w)*rs,xt=d(pt)?Vt:0,Tt=k.get("text-anchor").evaluate(J,{},w),Pt=k.get("text-variable-anchor");if(!Pt){const rn=k.get("text-radial-offset").evaluate(J,{},w);Pe=rn?Zd(Tt,[rn*rs,Nh]):k.get("text-offset").evaluate(J,{},w).map(bn=>bn*rs)}let jt=V?"center":k.get("text-justify").evaluate(J,{},w);const at="point"===k.get("symbol-placement"),Jt=at?k.get("text-max-width").evaluate(J,{},w)*rs:1/0,Un=rn=>{t.allowVerticalPlacement&&u(pt)&&(ye.vertical=gp(Ce,e,n,h,he,Jt,it,Tt,rn,xt,Pe,Ha.vertical,!0,Ie,ve))};if(!V&&Pt){const rn="auto"===jt?Pt.map(Qt=>Tp(Qt)):[jt];let bn=!1;for(let Qt=0;Qt<rn.length;Qt++){const Gn=rn[Qt];if(!ye.horizontal[Gn])if(bn)ye.horizontal[Gn]=ye.horizontal[0];else{const Ir=gp(Ce,e,n,h,he,Jt,it,"center",Gn,xt,Pe,Ha.horizontal,!1,Ie,ve);Ir&&(ye.horizontal[Gn]=Ir,bn=1===Ir.positionedLines.length)}}Un("left")}else{if("auto"===jt&&(jt=Tp(Tt)),at||k.get("text-writing-mode").indexOf("horizontal")>=0||!u(pt)){const rn=gp(Ce,e,n,h,he,Jt,it,Tt,jt,xt,Pe,Ha.horizontal,!1,Ie,ve);rn&&(ye.horizontal[jt]=rn)}Un(at?"left":jt)}}let et=!1;if(J.icon&&J.icon.name){const pt=s[J.icon.name];pt&&(ke=_p(h[J.icon.name],k.get("icon-offset").evaluate(J,{},w),k.get("icon-anchor").evaluate(J,{},w)),et=pt.sdf,void 0===t.sdfIcons?t.sdfIcons=pt.sdf:t.sdfIcons!==pt.sdf&&cr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(pt.pixelRatio!==t.pixelRatio||0!==k.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const Xe=sg(ye.horizontal)||ye.vertical;t.iconsInText||(t.iconsInText=!!Xe&&Xe.iconsInText),(Xe||ke)&&ry(t,J,ye,ke,s,B,Ie,0,Pe,et,y,w,D)}g&&t.generateCollisionDebugBuffers(T,t.collisionBoxArray)}function Tp(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function ry(t,e,n,s,h,g,y,w,T,D,k,O,B){let V=g.textMaxSize.evaluate(e,{},O);void 0===V&&(V=y);const G=t.layers[0].layout,J=G.get("icon-offset").evaluate(e,{},O),he=sg(n.horizontal)||n.vertical,ve="globe"===B.name,Ie=y/24,ye=t.tilePixelRatio*V/24,Ce=(xt=t.overscaling,t.zoom>18&&xt>2&&(xt>>=1),Math.max(Wn/(512*xt),1)*G.get("symbol-spacing")),ke=G.get("text-padding")*t.tilePixelRatio,Pe=G.get("icon-padding")*t.tilePixelRatio,et=je(G.get("text-max-angle")),Xe="map"===G.get("text-rotation-alignment")&&"point"!==G.get("symbol-placement"),pt="map"===G.get("icon-rotation-alignment")&&"point"!==G.get("symbol-placement"),Vt=G.get("symbol-placement"),it=Ce/2;var xt;const Tt=G.get("icon-text-fit");let Pt;s&&"none"!==Tt&&(t.allowVerticalPlacement&&n.vertical&&(Pt=Z_(s,n.vertical,Tt,G.get("icon-text-fit-padding"),J,Ie)),he&&(s=Z_(s,he,Tt,G.get("icon-text-fit-padding"),J,Ie)));const jt=(at,Jt,Un)=>{if(Jt.x<0||Jt.x>=Wn||Jt.y<0||Jt.y>=Wn)return;let rn=null;if(ve){const{x:bn,y:Qt,z:Gn}=B.projectTilePoint(Jt.x,Jt.y,Un);rn={anchor:new Jl(bn,Qt,Gn,0,void 0),up:B.upVector(Un,Jt.x,Jt.y)}}!function(bn,Qt,Gn,Ir,Dr,wr,Zn,ii,ir,Fr,_i,Bi,Ii,Ni,qi,po,xs,hi,Oo,Co,Xr,no,Wo,yi,vo){const Hs=bn.addToLineVertexArray(Qt,Ir);let ws,os,qs,ss,nc,xu,th,nh=0,Np=0,Up=0,jp=0,df=-1,bc=-1;const rc={};let Ig=Lo("");const ul=Gn?Gn.anchor:Qt;let Ag=0,Kh=0;if(void 0===ir._unevaluatedLayout.getValue("text-radial-offset")?[Ag,Kh]=ir.layout.get("text-offset").evaluate(Xr,{},vo).map(Wa=>Wa*rs):(Ag=ir.layout.get("text-radial-offset").evaluate(Xr,{},vo)*rs,Kh=Nh),bn.allowVerticalPlacement&&Dr.vertical){const Wa=Dr.vertical;if(qi)xu=Kd(Wa),ii&&(th=Kd(ii));else{const Nn=ir.layout.get("text-rotate").evaluate(Xr,{},vo)+90;qs=Xd(Fr,ul,Qt,_i,Bi,Ii,Wa,Ni,Nn,po),ii&&(ss=Xd(Fr,ul,Qt,_i,Bi,Ii,ii,hi,Nn))}}if(wr){const Wa=ir.layout.get("icon-rotate").evaluate(Xr,{},vo),Nn="none"!==ir.layout.get("icon-text-fit"),Yh=qu(wr,Wa,Wo,Nn),Vp=ii?qu(ii,Wa,Wo,Nn):void 0;os=Xd(Fr,ul,Qt,_i,Bi,Ii,wr,hi,Wa),nh=4*Yh.length;const Rg=bn.iconSizeData;let hl=null;"source"===Rg.kind?(hl=[Fa*ir.layout.get("icon-size").evaluate(Xr,{},vo)],hl[0]>jc&&cr(`${bn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Rg.kind&&(hl=[Fa*no.compositeIconSizes[0].evaluate(Xr,{},vo),Fa*no.compositeIconSizes[1].evaluate(Xr,{},vo)],(hl[0]>jc||hl[1]>jc)&&cr(`${bn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),bn.addSymbols(bn.icon,Yh,hl,Co,Oo,Xr,!1,Gn,Qt,Hs.lineStartIndex,Hs.lineLength,-1,yi,vo),df=bn.icon.placedSymbolArray.length-1,Vp&&(Np=4*Vp.length,bn.addSymbols(bn.icon,Vp,hl,Co,Oo,Xr,Ha.vertical,Gn,Qt,Hs.lineStartIndex,Hs.lineLength,-1,yi,vo),bc=bn.icon.placedSymbolArray.length-1)}for(const Wa in Dr.horizontal){const Nn=Dr.horizontal[Wa];ws||(Ig=Lo(Nn.text),qi?nc=Kd(Nn):ws=Xd(Fr,ul,Qt,_i,Bi,Ii,Nn,Ni,ir.layout.get("text-rotate").evaluate(Xr,{},vo),po));const Yh=1===Nn.positionedLines.length;if(Up+=og(bn,Gn,Qt,Nn,Zn,ir,qi,Xr,po,Hs,Dr.vertical?Ha.horizontal:Ha.horizontalOnly,Yh?Object.keys(Dr.horizontal):[Wa],rc,df,no,yi,vo),Yh)break}Dr.vertical&&(jp+=og(bn,Gn,Qt,Dr.vertical,Zn,ir,qi,Xr,po,Hs,Ha.vertical,["vertical"],rc,bc,no,yi,vo));let wu=-1;const ff=(Wa,Nn)=>Wa?Math.max(Wa,Nn):Nn;wu=ff(nc,wu),wu=ff(xu,wu),wu=ff(th,wu);const Pg=wu>-1?1:0;bn.glyphOffsetArray.length>=yc.MAX_GLYPHS&&cr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==Xr.sortKey&&bn.addToSortKeyRanges(bn.symbolInstances.length,Xr.sortKey),bn.symbolInstances.emplaceBack(ul.x,ul.y,ul.z,Qt.x,Qt.y,rc.right>=0?rc.right:-1,rc.center>=0?rc.center:-1,rc.left>=0?rc.left:-1,rc.vertical>=0?rc.vertical:-1,df,bc,Ig,void 0!==ws?ws:bn.collisionBoxArray.length,void 0!==ws?ws+1:bn.collisionBoxArray.length,void 0!==qs?qs:bn.collisionBoxArray.length,void 0!==qs?qs+1:bn.collisionBoxArray.length,void 0!==os?os:bn.collisionBoxArray.length,void 0!==os?os+1:bn.collisionBoxArray.length,ss||bn.collisionBoxArray.length,ss?ss+1:bn.collisionBoxArray.length,_i,Up,jp,nh,Np,Pg,0,Ag,Kh,wu)}(t,Jt,rn,at,n,s,h,Pt,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,ke,Xe,T,0,Pe,pt,J,e,g,D,k,O)};if("line"===Vt)for(const at of Gu(e.geometry,0,0,Wn,Wn)){const Jt=Gd(at,Ce,et,n.vertical||he,s,24,ye,t.overscaling,Wn);for(const Un of Jt)he&&ag(t,he.text,it,Un)||jt(at,Un,O)}else if("line-center"===Vt){for(const at of e.geometry)if(at.length>1){const Jt=_c(at,et,n.vertical||he,s,24,ye);Jt&&jt(at,Jt,O)}}else if("Polygon"===e.type)for(const at of ep(e.geometry,0)){const Jt=Q_(at,16);jt(at[0],new Jl(Jt.x,Jt.y,0,0,void 0),O)}else if("LineString"===e.type)for(const at of e.geometry)jt(at,new Jl(at[0].x,at[0].y,0,0,void 0),O);else if("Point"===e.type)for(const at of e.geometry)for(const Jt of at)jt([Jt],new Jl(Jt.x,Jt.y,0,0,void 0),O)}const jc=32640;function og(t,e,n,s,h,g,y,w,T,D,k,O,B,V,G,J,he){const ve=function(Ce,ke,Pe,et,Xe,pt,Vt,it){const xt=[];if(0===ke.positionedLines.length)return xt;const Tt=et.layout.get("text-rotate").evaluate(pt,{})*Math.PI/180,Pt=function(rn){const bn=rn[0],Qt=rn[1],Gn=bn*Qt;return Gn>0?[bn,-Qt]:Gn<0?[-bn,Qt]:0===bn?[Qt,bn]:[Qt,-bn]}(Pe);let jt=Math.abs(ke.top-ke.bottom);for(const rn of ke.positionedLines)jt-=rn.lineOffset;const at=ke.positionedLines.length,Jt=jt/at;let Un=ke.top-Pe[1];for(let rn=0;rn<at;++rn){const bn=ke.positionedLines[rn];Un=K_(ke,Jt,Un,rn);for(const Qt of bn.positionedGlyphs){if(!Qt.rect)continue;const Gn=Qt.rect||{};let Ir=4,Dr=!0,wr=1,Zn=0;if(Qt.imageName){const yi=Vt[Qt.imageName];if(!yi)continue;if(yi.sdf){cr("SDF images are not supported in formatted text and will be ignored.");continue}Dr=!1,wr=yi.pixelRatio,Ir=1/wr}const ii=(Xe||it)&&Qt.vertical,ir=Qt.metrics.advance*Qt.scale/2,Fr=Qt.metrics,_i=Qt.rect;if(null===_i)continue;it&&ke.verticalizable&&(Zn=Qt.imageName?ir-Qt.metrics.width*Qt.scale/2:0);const Bi=Xe?[Qt.x+ir,Qt.y]:[0,0];let Ii=[0,0],Ni=[0,0],qi=!1;Xe||(ii?(Ni=[Qt.x+ir+Pt[0],Qt.y+Pt[1]-Zn],qi=!0):Ii=[Qt.x+ir+Pe[0],Qt.y+Pe[1]-Zn]);const po=_i.w*Qt.scale/(wr*(Qt.localGlyph?2:1)),xs=_i.h*Qt.scale/(wr*(Qt.localGlyph?2:1));let hi,Oo,Co,Xr;if(ii){const yi=Qt.y-Un,vo=new dt(-ir,ir-yi),Hs=-Math.PI/2,ws=new dt(...Ni);hi=new dt(-ir+Ii[0],Ii[1]),hi._rotateAround(Hs,vo)._add(ws),hi.x+=-yi+ir,hi.y-=(Fr.left-Ir)*Qt.scale;const os=Qt.imageName?Fr.advance*Qt.scale:rs*Qt.scale,qs=String.fromCharCode(Qt.glyph);Jm(qs)?hi.x+=(1-Ir)*Qt.scale:up(qs)?hi.x+=os-Fr.height*Qt.scale+(-Ir-1)*Qt.scale:hi.x+=Qt.imageName||Fr.width+2*Ir===_i.w&&Fr.height+2*Ir===_i.h?(os-xs)/2:(os-(Fr.height+2*Ir)*Qt.scale)/2,Oo=new dt(hi.x,hi.y-po),Co=new dt(hi.x+xs,hi.y),Xr=new dt(hi.x+xs,hi.y-po)}else{const yi=(Fr.left-Ir)*Qt.scale-ir+Ii[0],vo=(-Fr.top-Ir)*Qt.scale+Ii[1],Hs=yi+po,ws=vo+xs;hi=new dt(yi,vo),Oo=new dt(Hs,vo),Co=new dt(yi,ws),Xr=new dt(Hs,ws)}if(Tt){let yi;yi=Xe?new dt(0,0):qi?new dt(Pt[0],Pt[1]):new dt(Pe[0],Pe[1]),hi._rotateAround(Tt,yi),Oo._rotateAround(Tt,yi),Co._rotateAround(Tt,yi),Xr._rotateAround(Tt,yi)}const no=new dt(0,0),Wo=new dt(0,0);xt.push({tl:hi,tr:Oo,bl:Co,br:Xr,tex:Gn,writingMode:ke.writingMode,glyphOffset:Bi,sectionIndex:Qt.sectionIndex,isSDF:Dr,pixelOffsetTL:no,pixelOffsetBR:Wo,minFontScaleX:0,minFontScaleY:0})}}return xt}(0,s,T,g,y,w,h,t.allowVerticalPlacement),Ie=t.textSizeData;let ye=null;"source"===Ie.kind?(ye=[Fa*g.layout.get("text-size").evaluate(w,{},he)],ye[0]>jc&&cr(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===Ie.kind&&(ye=[Fa*G.compositeTextSizes[0].evaluate(w,{},he),Fa*G.compositeTextSizes[1].evaluate(w,{},he)],(ye[0]>jc||ye[1]>jc)&&cr(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,ve,ye,T,y,w,k,e,n,D.lineStartIndex,D.lineLength,V,J,he);for(const Ce of O)B[Ce]=t.text.placedSymbolArray.length-1;return 4*ve.length}function sg(t){for(const e in t)return t[e];return null}function Xd(t,e,n,s,h,g,y,w,T,D){let k=y.top,O=y.bottom,B=y.left,V=y.right;const G=y.collisionPadding;if(G&&(B-=G[0],k-=G[1],V+=G[2],O+=G[3]),T){const J=new dt(B,k),he=new dt(V,k),ve=new dt(B,O),Ie=new dt(V,O),ye=je(T);let Ce=new dt(0,0);D&&(Ce=new dt(D[0],D[1])),J._rotateAround(ye,Ce),he._rotateAround(ye,Ce),ve._rotateAround(ye,Ce),Ie._rotateAround(ye,Ce),B=Math.min(J.x,he.x,ve.x,Ie.x),V=Math.max(J.x,he.x,ve.x,Ie.x),k=Math.min(J.y,he.y,ve.y,Ie.y),O=Math.max(J.y,he.y,ve.y,Ie.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,B,k,V,O,w,s,h,g),t.length-1}function Kd(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function ag(t,e,n,s){const h=t.compareText;if(e in h){const g=h[e];for(let y=g.length-1;y>=0;y--)if(s.dist(g[y])<n)return!0}else h[e]=[];return h[e].push(s),!1}function lg(t,e){const n=t.fovAboveCenter,s=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,h=(t._camera.position[2]*t.worldSize-s)/Math.cos(t._pitch),g=Math.sin(n)*h/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),y=Math.sin(t._pitch)*g+h;return Math.min(1.01*y,h*(1/t._horizonShift))}function Wu(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),s=t.x*n,h=(t.x+1)*n,g=t.y*n,y=(t.y+1)*n,w=Ga(s),T=Ga(h),D=vs(g),k=vs(y),O=e.project(w,D),B=e.project(T,D),V=e.project(T,k),G=e.project(w,k);let J=Math.min(O.x,B.x,V.x,G.x),he=Math.min(O.y,B.y,V.y,G.y),ve=Math.max(O.x,B.x,V.x,G.x),Ie=Math.max(O.y,B.y,V.y,G.y);const ye=n/16;function Ce(Pe,et,Xe,pt,Vt,it){const xt=(Xe+Vt)/2,Tt=(pt+it)/2,Pt=e.project(Ga(xt),vs(Tt)),jt=Math.max(0,J-Pt.x,he-Pt.y,Pt.x-ve,Pt.y-Ie);J=Math.min(J,Pt.x),ve=Math.max(ve,Pt.x),he=Math.min(he,Pt.y),Ie=Math.max(Ie,Pt.y),jt>ye&&(Ce(Pe,Pt,Xe,pt,xt,Tt),Ce(Pt,et,xt,Tt,Vt,it))}Ce(O,B,s,g,h,g),Ce(B,V,h,g,h,y),Ce(V,G,h,y,s,y),Ce(G,O,s,y,s,g),J-=ye,he-=ye,ve+=ye,Ie+=ye;const ke=1/Math.max(ve-J,Ie-he);return{scale:ke,x:J*ke,y:he*ke,x2:ve*ke,y2:Ie*ke,projection:e}}const cg=ol(new Float32Array(16));class du{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new qr(0,0)}projectTilePoint(e,n,s){return{x:e,y:n,z:0}}locationPoint(e,n,s=!0){return e._coordinatePoint(e.locationCoordinate(n),s)}pixelsPerMeter(e,n){return Cl(1,e)*n}pixelSpaceConversion(e,n,s){return 1}farthestPixelDistance(e){return lg(e,e.pixelsPerMeter)}pointCoordinate(e,n,s,h){const g=e.horizonLineFromTop(!1),y=new dt(n,Math.max(g,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(y,h))}pointCoordinate3D(e,n,s){const h=new dt(n,s);if(e.elevation)return e.elevation.pointCoordinate(h);{const g=this.pointCoordinate(e,h.x,h.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);const s=e.horizonLineFromTop();return n.y<s}createInversionMatrix(e,n){return cg}createTileMatrix(e,n,s){let h,g,y;const w=s.canonical,T=ol(new Float64Array(16));if(this.isReprojectedInTileSpace){const D=Wu(w,this);h=1,g=D.x+s.wrap*D.scale,y=D.y,Hl(T,T,[h/D.scale,h/D.scale,e.pixelsPerMeter/n])}else h=n/e.zoomScale(w.z),g=(w.x+Math.pow(2,w.z)*s.wrap)*h,y=w.y*h;return pd(T,T,[g,y,0]),Hl(T,T,[h/Wn,h/Wn,1]),T}upVector(e,n,s){return[0,0,1]}upVectorScale(e,n,s){return{metersToTile:1}}}class Yd extends du{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,s]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(je(n));this.n=(h+Math.sin(je(s)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:s,c:h,r0:g}=this,y=je(e-this.center[0]),w=je(n),T=Math.sqrt(h-2*s*Math.sin(w))/s;return{x:T*Math.sin(y*s),y:T*Math.cos(y*s)-g,z:0}}unproject(e,n){const{n:s,c:h,r0:g}=this,y=g+n;let w=Math.atan2(e,Math.abs(y))*Math.sign(y);y*s<0&&(w-=Math.PI*Math.sign(e)*Math.sign(y));const T=je(this.center[0])*s;w=vn(w,-Math.PI-T,Math.PI-T);const D=ft(Kt(w/s)+this.center[0],-180,180),k=Math.asin(ft((h-(e*e+y*y)*s*s)/(2*s),-1,1)),O=ft(Kt(k),-Ms,Ms);return new qr(D,O)}}const Uh=1.340264,jh=-.081106,fu=893e-6,Vh=.003796,qa=Math.sqrt(3)/2;class $h extends du{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(qa*Math.sin(n)),h=s*s,g=h*h*h;return{x:.5*(e*Math.cos(s)/(qa*(Uh+3*jh*h+g*(7*fu+9*Vh*h)))/Math.PI+.5),y:1-.5*(s*(Uh+jh*h+g*(fu+Vh*h))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,h=s*s,g=h*h*h;for(let k,O,B,V=0;V<12&&(O=s*(Uh+jh*h+g*(fu+Vh*h))-n,B=Uh+3*jh*h+g*(7*fu+9*Vh*h),k=O/B,s=ft(s-k,-Math.PI/3,Math.PI/3),h=s*s,g=h*h*h,!(Math.abs(k)<1e-12));++V);const y=qa*e*(Uh+3*jh*h+g*(7*fu+9*Vh*h))/Math.cos(s),w=Math.asin(Math.sin(s)/qa),T=ft(180*y/Math.PI,-180,180),D=ft(180*w/Math.PI,-Ms,Ms);return new qr(T,D)}}class aa extends du{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const s=360*(e-.5),h=ft(360*(.5-n),-Ms,Ms);return new qr(s,h)}}const ll=Math.PI/2;function pu(t){return Math.tan((ll+t)/2)}class cl extends du{constructor(e){super(e),this.center=e.center||[0,30];const[n,s]=this.parallels=e.parallels||[30,30];let h=je(n),g=je(s);this.southernCenter=h+g<0,this.southernCenter&&(h=-h,g=-g);const y=Math.cos(h),w=pu(h);this.n=h===g?Math.sin(h):Math.log(y/Math.cos(g))/Math.log(pu(g)/w),this.f=y*Math.pow(pu(h),this.n)/this.n}project(e,n){n=je(n),this.southernCenter&&(n=-n),e=je(e-this.center[0]);const s=1e-6,{n:h,f:g}=this;g>0?n<-ll+s&&(n=-ll+s):n>ll-s&&(n=ll-s);const y=g/Math.pow(pu(n),h);let w=y*Math.sin(h*e),T=g-y*Math.cos(h*e);return w=.5*(w/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:w,y:this.southernCenter?T:1-T,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:s,f:h}=this,g=h-n,y=Math.sign(g),w=Math.sign(s)*Math.sqrt(e*e+g*g);let T=Math.atan2(e,Math.abs(g))*y;g*s<0&&(T-=Math.PI*Math.sign(e)*y);const D=ft(Kt(T/s)+this.center[0],-180,180),k=ft(Kt(2*Math.atan(Math.pow(h/w,1/s))-ll),-Ms,Ms);return new qr(D,this.southernCenter?-k:k)}}class Jd extends du{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Wl(e),y:Hi(n),z:0}}unproject(e,n){const s=Ga(e),h=vs(n);return new qr(s,h)}}const mu=je(Ms);class Zu extends du{project(e,n){const s=(n=je(n))*n,h=s*s;return{x:.5*((e=je(e))*(.8707-.131979*s+h*(h*(.003971*s-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+s*(.015085+h*(.028874*s-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,h=25,g=0,y=s*s;do{y=s*s;const D=y*y;g=(s*(1.007226+y*(.015085+D*(.028874*y-.044475-.005916*D)))-n)/(1.007226+y*(.045255+D*(.259866*y-.311325-.005916*11*D))),s=ft(s-g,-mu,mu)}while(Math.abs(g)>1e-6&&--h>0);y=s*s;const w=ft(Kt(e/(.8707+y*(y*(y*y*y*(.003971-.001529*y)-.013791)-.131979))),-180,180),T=Kt(s);return new qr(w,T)}}const gu=je(Ms);class Xu extends du{project(e,n){n=je(n),e=je(e);const s=Math.cos(n),h=2/Math.PI,g=Math.acos(s*Math.cos(e/2)),y=Math.sin(g)/g,w=.5*(e*h+2*s*Math.sin(e/2)/y)||0,T=.5*(n+Math.sin(n)/y)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(e,n){let s=e=(2*e-.5)*Math.PI,h=n=(2*(1-n)-1)*Math.PI,g=25;const y=1e-6;let w=0,T=0;do{const D=Math.cos(h),k=Math.sin(h),O=2*k*D,B=k*k,V=D*D,G=Math.cos(s/2),J=Math.sin(s/2),he=2*G*J,ve=J*J,Ie=1-V*G*G,ye=Ie?1/Ie:0,Ce=Ie?Math.acos(D*G)*Math.sqrt(1/Ie):0,ke=.5*(2*Ce*D*J+2*s/Math.PI)-e,Pe=.5*(Ce*k+h)-n,et=.5*ye*(V*ve+Ce*D*G*B)+1/Math.PI,Xe=ye*(he*O/4-Ce*k*J),pt=.125*ye*(O*J-Ce*k*V*he),Vt=.5*ye*(B*G+Ce*ve*D)+.5,it=Xe*pt-Vt*et;w=(Pe*Xe-ke*Vt)/it,T=(ke*pt-Pe*et)/it,s=ft(s-w,-Math.PI,Math.PI),h=ft(h-T,-gu,gu)}while((Math.abs(w)>y||Math.abs(T)>y)&&--g>0);return new qr(Kt(s),Kt(h))}}class _u extends du{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(je(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:s,cosPhi:h}=this;return{x:je(e)*h*s+.5,y:-Math.sin(je(n))/h*s+.5,z:0}}unproject(e,n){const{scale:s,cosPhi:h}=this,g=-(n-.5)/s,y=ft(Kt((e-.5)/s)/h,-180,180),w=Math.asin(ft(g*h,-1,1)),T=ft(Kt(w),-Ms,Ms);return new qr(y,T)}}class Ku extends Jd{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,s){const h=wd(e,n,s);return fo(h,h,nu(ql(s))),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,n){const s=tu(n.lat,n.lng),h=ra([],s),g=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;fh(s,s,h,Cl(1,0)*Wn*g);const y=ol(new Float64Array(16));return Kc(y,e.pixelMatrix,e.globeMatrix),fo(s,s,y),new dt(s[0],s[1])}pixelsPerMeter(e,n){return Cl(1,0)*n}pixelSpaceConversion(e,n,s){const h=Cl(1,e)*n,g=fr(Cl(1,45)*n,h,s);return this.pixelsPerMeter(e,n)/g}createTileMatrix(e,n,s){const h=yh(ql(s.canonical));return Kc(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,n){const{center:s}=e,h=nu(ql(n));return ch(h,h,je(s.lng)),Df(h,h,je(s.lat)),Hl(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,n,s,h){return t_(e,n,s,!0)||new Pu(0,0)}pointCoordinate3D(e,n,s){const h=this.pointCoordinate(e,n,s,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,n){return!t_(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(h,g){const y=h.cameraToCenterDistance,w=h._centerAltitude*g,T=h._camera,D=h._camera.forward(),k=bl([],ka([],D,-y),[0,0,w]),O=h.worldSize/(2*Math.PI),B=[0,0,-O],V=h.width/h.height,G=Math.tan(h.fovAboveCenter),J=ka([],T.up(),G),he=ka([],T.right(),G*V),ve=ra([],bl([],bl([],D,J),he)),Ie=[];let ye;if(new Rf(k,ve).closestPointOnSphere(B,O,Ie)){const Ce=bl([],Ie,B),ke=ia([],Ce,k);ye=Math.cos(h.fovAboveCenter)*kc(ke)}else{const Ce=ia([],k,B),ke=ia([],B,k);ra(ke,ke);const Pe=kc(Ce)-O;ye=Math.sqrt(Pe*(Pe+2*O));const et=Math.acos(ye/(O+Pe))-Math.acos(sl(D,ke));ye*=Math.cos(et)}return 1.01*ye}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=vh(e.zoom);if(s>0){const h=lg(e,Cl(1,e.center.lat)*e.worldSize),g=e.worldSize/(2*Math.PI),y=Math.max(e.width,e.height)/e.worldSize*Math.PI;return fr(n,h+g*(1-Math.cos(y)),Math.pow(s,10))}return n}upVector(e,n,s){return wd(n,s,e,1)}upVectorScale(e){return{metersToTile:Of(zf(ql(e)))}}}function yu(t){const e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Jd(t);case"equirectangular":return new aa(t);case"naturalEarth":return new Zu(t);case"equalEarth":return new $h(t);case"winkelTripel":return new Xu(t);case"albers":return n?new _u(t):new Yd(t);case"lambertConformalConic":return n?new _u(t):new cl(t);case"globe":return new Ku(t)}throw new Error(`Invalid projection name: ${t.name}`)}const Yu=Ld.types,Ju=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Gh(t,e,n,s,h,g,y,w,T,D,k,O,B){const V=w?Math.min(jc,Math.round(w[0])):0,G=w?Math.min(jc,Math.round(w[1])):0;t.emplaceBack(e,n,Math.round(32*s),Math.round(32*h),g,y,(V<<1)+(T?1:0),G,16*D,16*k,256*O,256*B)}function Hh(t,e,n,s,h,g,y){t.emplaceBack(e,n,s,h,g,y)}function qh(t,e,n,s,h){t.emplaceBack(e,n,s,h),t.emplaceBack(e,n,s,h),t.emplaceBack(e,n,s,h),t.emplaceBack(e,n,s,h)}function ug(t){for(const e of t.sections)if(z(e.text))return!0;return!1}class Qd{constructor(e){this.layoutVertexArray=new Ul,this.indexArray=new Ss,this.programConfigurations=e,this.segments=new yo,this.dynamicLayoutVertexArray=new Si,this.opacityVertexArray=new ui,this.placedSymbolArray=new Qp,this.globeExtVertexArray=new Yi}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,n,s,h){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Km.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Ym.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,Ju,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,L_.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}yn(Qd,"SymbolBuffers");class ef{constructor(e,n,s){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new s,this.segments=new yo,this.collisionVertexArray=new Gi,this.collisionVertexArrayExt=new Vs}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,O_.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,F_.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}yn(ef,"CollisionBuffers");class yc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(y=>y.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ol([]),this.placementViewportMatrix=ol([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=kh(this.zoom,n["text-size"]),this.iconSizeData=kh(this.zoom,n["icon-size"]);const s=this.layers[0].layout,h=s.get("symbol-sort-key"),g=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==g&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===g||"auto"===g&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(y=>Ha[y]),this.stateDependentLayerIds=this.layers.filter(y=>y.isStateDependent()).map(y=>y.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Qd(new Xc(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Qd(new Xc(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new _f,this.lineVertexArray=new nm,this.symbolInstances=new tm}calculateGlyphDependencies(e,n,s,h,g){for(let y=0;y<e.length;y++)if(n[e.charCodeAt(y)]=!0,h&&g){const w=cu[e.charAt(y)];w&&(n[w.charCodeAt(0)]=!0)}}populate(e,n,s,h){const g=this.layers[0],y=g.layout,w="globe"===this.projection.name,T=y.get("text-font"),D=y.get("text-field"),k=y.get("icon-image"),O=("constant"!==D.value.kind||D.value.value instanceof ji&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&("constant"!==T.value.kind||T.value.value.length>0),B="constant"!==k.value.kind||!!k.value.value||Object.keys(k.parameters).length>0,V=y.get("symbol-sort-key");if(this.features=[],!O&&!B)return;const G=n.iconDependencies,J=n.glyphDependencies,he=n.availableImages,ve=new qe(this.zoom);for(const{feature:Ie,id:ye,index:Ce,sourceLayerIndex:ke}of e){const Pe=g._featureFilter.needGeometry,et=Oc(Ie,Pe);if(!g._featureFilter.filter(ve,et,s))continue;if(Pe||(et.geometry=Zl(Ie,s,h)),w&&1!==Ie.type&&s.z<=5){const it=et.geometry,xt=.98078528056,Tt=(Pt,jt)=>sl(wd(Pt.x,Pt.y,s,1),wd(jt.x,jt.y,s,1))<xt;for(let Pt=0;Pt<it.length;Pt++)it[Pt]=Vy(it[Pt],Tt)}let Xe,pt;if(O){const it=g.getValueAndResolveTokens("text-field",et,s,he),xt=ji.factory(it);ug(xt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===Re()||this.hasRTLText&&ze.isParsed())&&(Xe=cp(xt,g,et))}if(B){const it=g.getValueAndResolveTokens("icon-image",et,s,he);pt=it instanceof co?it:co.fromString(it)}if(!Xe&&!pt)continue;const Vt=this.sortFeaturesByKey?V.evaluate(et,{},s):void 0;if(this.features.push({id:ye,text:Xe,icon:pt,index:Ce,sourceLayerIndex:ke,geometry:et.geometry,properties:Ie.properties,type:Yu[Ie.type],sortKey:Vt}),pt&&(G[pt.name]=!0),Xe){const it=T.evaluate(et,{},s).join(","),xt="map"===y.get("text-rotation-alignment")&&"point"!==y.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ha.vertical)>=0;for(const Tt of Xe.sections)if(Tt.image)G[Tt.image.name]=!0;else{const Pt=u(Xe.toString()),jt=Tt.fontStack||it,at=J[jt]=J[jt]||{};this.calculateGlyphDependencies(Tt.text,at,xt,this.allowVerticalPlacement,Pt)}}}"line"===y.get("symbol-placement")&&(this.features=function(Ie){const ye={},Ce={},ke=[];let Pe=0;function et(it){ke.push(Ie[it]),Pe++}function Xe(it,xt,Tt){const Pt=Ce[it];return delete Ce[it],Ce[xt]=Pt,ke[Pt].geometry[0].pop(),ke[Pt].geometry[0]=ke[Pt].geometry[0].concat(Tt[0]),Pt}function pt(it,xt,Tt){const Pt=ye[xt];return delete ye[xt],ye[it]=Pt,ke[Pt].geometry[0].shift(),ke[Pt].geometry[0]=Tt[0].concat(ke[Pt].geometry[0]),Pt}function Vt(it,xt,Tt){const Pt=Tt?xt[0][xt[0].length-1]:xt[0][0];return`${it}:${Pt.x}:${Pt.y}`}for(let it=0;it<Ie.length;it++){const xt=Ie[it],Tt=xt.geometry,Pt=xt.text?xt.text.toString():null;if(!Pt){et(it);continue}const jt=Vt(Pt,Tt),at=Vt(Pt,Tt,!0);if(jt in Ce&&at in ye&&Ce[jt]!==ye[at]){const Jt=pt(jt,at,Tt),Un=Xe(jt,at,ke[Jt].geometry);delete ye[jt],delete Ce[at],Ce[Vt(Pt,ke[Un].geometry,!0)]=Un,ke[Jt].geometry=null}else jt in Ce?Xe(jt,at,Tt):at in ye?pt(jt,at,Tt):(et(it),ye[jt]=Pe-1,Ce[at]=Pe-1)}return ke.filter(it=>it.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ie,ye)=>Ie.sortKey-ye.sortKey)}update(e,n,s,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,s,h),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,s,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=yu(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const s=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:h,y:g}of n)this.lineVertexArray.emplaceBack(h,g);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,n,s,h,g,y,w,T,D,k,O,B,V,G){const J=e.indexArray,he=e.layoutVertexArray,ve=e.globeExtVertexArray,Ie=e.segments.prepareSegment(4*n.length,he,J,this.canOverlap?y.sortKey:void 0),ye=this.glyphOffsetArray.length,Ce=Ie.vertexLength,ke=this.allowVerticalPlacement&&w===Ha.vertical?Math.PI/2:0,Pe=y.text&&y.text.sections;for(let Xe=0;Xe<n.length;Xe++){const{tl:pt,tr:Vt,bl:it,br:xt,tex:Tt,pixelOffsetTL:Pt,pixelOffsetBR:jt,minFontScaleX:at,minFontScaleY:Jt,glyphOffset:Un,isSDF:rn,sectionIndex:bn}=n[Xe],Qt=Ie.vertexLength,Gn=Un[1];if(Gh(he,D.x,D.y,pt.x,Gn+pt.y,Tt.x,Tt.y,s,rn,Pt.x,Pt.y,at,Jt),Gh(he,D.x,D.y,Vt.x,Gn+Vt.y,Tt.x+Tt.w,Tt.y,s,rn,jt.x,Pt.y,at,Jt),Gh(he,D.x,D.y,it.x,Gn+it.y,Tt.x,Tt.y+Tt.h,s,rn,Pt.x,jt.y,at,Jt),Gh(he,D.x,D.y,xt.x,Gn+xt.y,Tt.x+Tt.w,Tt.y+Tt.h,s,rn,jt.x,jt.y,at,Jt),T){const{x:Ir,y:Dr,z:wr}=T.anchor,[Zn,ii,ir]=T.up;Hh(ve,Ir,Dr,wr,Zn,ii,ir),Hh(ve,Ir,Dr,wr,Zn,ii,ir),Hh(ve,Ir,Dr,wr,Zn,ii,ir),Hh(ve,Ir,Dr,wr,Zn,ii,ir),qh(e.dynamicLayoutVertexArray,Ir,Dr,wr,ke)}else qh(e.dynamicLayoutVertexArray,D.x,D.y,D.z,ke);J.emplaceBack(Qt,Qt+1,Qt+2),J.emplaceBack(Qt+1,Qt+2,Qt+3),Ie.vertexLength+=4,Ie.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Un[0]),Xe!==n.length-1&&bn===n[Xe+1].sectionIndex||e.programConfigurations.populatePaintArrays(he.length,y,y.index,{},V,G,Pe&&Pe[bn])}const et=T?T.anchor:D;e.placedSymbolArray.emplaceBack(et.x,et.y,et.z,D.x,D.y,ye,this.glyphOffsetArray.length-ye,Ce,k,O,D.segment,s?s[0]:0,s?s[1]:0,h[0],h[1],w,0,!1,0,B,0)}_commitLayoutVertex(e,n,s,h,g,y,w){e.emplaceBack(n,s,h,g,y,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(e,n,s,h,g,y,w){const T=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),D=T.vertexLength,k=w.tileAnchorX,O=w.tileAnchorY;for(let V=0;V<4;V++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,h,g,y,k,O,new dt(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,h,g,y,k,O,new dt(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,h,g,y,k,O,new dt(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,h,g,y,k,O,new dt(e.x1,e.y2)),T.vertexLength+=4;const B=s.indexArray;B.emplaceBack(D,D+1),B.emplaceBack(D+1,D+2),B.emplaceBack(D+2,D+3),B.emplaceBack(D+3,D),T.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,s,h,g,y){for(let w=h;w<g;w++){const T=s.get(w),D=this.getSymbolInstanceTextSize(e,y,n,w);this._addCollisionDebugVertices(T,D,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,y)}}_addIconDebugCollisionBoxes(e,n,s,h,g,y){for(let w=h;w<g;w++){const T=s.get(w),D=this.getSymbolInstanceIconSize(e,n,y.placedIconSymbolIndex);this._addCollisionDebugVertices(T,D,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,y)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new ef(_o,Rh.members,ys),this.iconCollisionBox=new ef(_o,Rh.members,ys);const s=lu(this.iconSizeData,e),h=lu(this.textSizeData,e);for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(h,e,n,y.textBoxStartIndex,y.textBoxEndIndex,y),this._addTextDebugCollisionBoxes(h,e,n,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._addIconDebugCollisionBoxes(s,e,n,y.iconBoxStartIndex,y.iconBoxEndIndex,y),this._addIconDebugCollisionBoxes(s,e,n,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y)}}getSymbolInstanceTextSize(e,n,s,h){const g=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:h),y=au(this.textSizeData,e,g)/rs;return this.tilePixelRatio*y}getSymbolInstanceIconSize(e,n,s){const h=this.icon.placedSymbolArray.get(s),g=au(this.iconSizeData,e,h);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(e,n,s){e.emplaceBack(n,-s,-s),e.emplaceBack(n,s,-s),e.emplaceBack(n,s,s),e.emplaceBack(n,-s,s)}_updateTextDebugCollisionBoxes(e,n,s,h,g,y){for(let w=h;w<g;w++){const T=s.get(w),D=this.getSymbolInstanceTextSize(e,y,n,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,T.padding)}}_updateIconDebugCollisionBoxes(e,n,s,h,g,y){for(let w=h;w<g;w++){const T=s.get(w),D=this.getSymbolInstanceIconSize(e,n,y);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,D,T.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=lu(this.iconSizeData,e),h=lu(this.textSizeData,e);for(let g=0;g<this.symbolInstances.length;g++){const y=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(h,e,n,y.textBoxStartIndex,y.textBoxEndIndex,y),this._updateTextDebugCollisionBoxes(h,e,n,y.verticalTextBoxStartIndex,y.verticalTextBoxEndIndex,y),this._updateIconDebugCollisionBoxes(s,e,n,y.iconBoxStartIndex,y.iconBoxEndIndex,y.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(s,e,n,y.verticalIconBoxStartIndex,y.verticalIconBoxEndIndex,y.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,s,h,g,y,w,T,D){const k={};if(n<s){const{x1:O,y1:B,x2:V,y2:G,padding:J,projectedAnchorX:he,projectedAnchorY:ve,projectedAnchorZ:Ie,tileAnchorX:ye,tileAnchorY:Ce,featureIndex:ke}=e.get(n);k.textBox={x1:O,y1:B,x2:V,y2:G,padding:J,projectedAnchorX:he,projectedAnchorY:ve,projectedAnchorZ:Ie,tileAnchorX:ye,tileAnchorY:Ce},k.textFeatureIndex=ke}if(h<g){const{x1:O,y1:B,x2:V,y2:G,padding:J,projectedAnchorX:he,projectedAnchorY:ve,projectedAnchorZ:Ie,tileAnchorX:ye,tileAnchorY:Ce,featureIndex:ke}=e.get(h);k.verticalTextBox={x1:O,y1:B,x2:V,y2:G,padding:J,projectedAnchorX:he,projectedAnchorY:ve,projectedAnchorZ:Ie,tileAnchorX:ye,tileAnchorY:Ce},k.verticalTextFeatureIndex=ke}if(y<w){const{x1:O,y1:B,x2:V,y2:G,padding:J,projectedAnchorX:he,projectedAnchorY:ve,projectedAnchorZ:Ie,tileAnchorX:ye,tileAnchorY:Ce,featureIndex:ke}=e.get(y);k.iconBox={x1:O,y1:B,x2:V,y2:G,padding:J,projectedAnchorX:he,projectedAnchorY:ve,projectedAnchorZ:Ie,tileAnchorX:ye,tileAnchorY:Ce},k.iconFeatureIndex=ke}if(T<D){const{x1:O,y1:B,x2:V,y2:G,padding:J,projectedAnchorX:he,projectedAnchorY:ve,projectedAnchorZ:Ie,tileAnchorX:ye,tileAnchorY:Ce,featureIndex:ke}=e.get(T);k.verticalIconBox={x1:O,y1:B,x2:V,y2:G,padding:J,projectedAnchorX:he,projectedAnchorY:ve,projectedAnchorZ:Ie,tileAnchorX:ye,tileAnchorY:Ce},k.verticalIconFeatureIndex=ke}return k}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const s=e.placedSymbolArray.get(n),h=s.vertexStartIndex+4*s.numGlyphs;for(let g=s.vertexStartIndex;g<h;g+=4)e.indexArray.emplaceBack(g,g+1,g+2),e.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const n=Math.sin(e),s=Math.cos(e),h=[],g=[],y=[];for(let w=0;w<this.symbolInstances.length;++w){y.push(w);const T=this.symbolInstances.get(w);h.push(0|Math.round(n*T.tileAnchorX+s*T.tileAnchorY)),g.push(T.featureIndex)}return y.sort((w,T)=>h[w]-h[T]||g[T]-g[w]),y}addToSortKeyRanges(e,n){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===n?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const s=this.symbolInstances.get(n);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:D}=s;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),g>=0&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),y>=0&&y!==g&&y!==h&&this.addIndicesForPlacedSymbol(this.text,y),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}yn(yc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),yc.MAX_GLYPHS=65535,yc.addDynamicAttributes=qh;const hg=new Nt({"symbol-placement":new He(st.layout_symbol["symbol-placement"]),"symbol-spacing":new He(st.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new He(st.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new rt(st.layout_symbol["symbol-sort-key"]),"symbol-z-order":new He(st.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new He(st.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new He(st.layout_symbol["icon-ignore-placement"]),"icon-optional":new He(st.layout_symbol["icon-optional"]),"icon-rotation-alignment":new He(st.layout_symbol["icon-rotation-alignment"]),"icon-size":new rt(st.layout_symbol["icon-size"]),"icon-text-fit":new He(st.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new He(st.layout_symbol["icon-text-fit-padding"]),"icon-image":new rt(st.layout_symbol["icon-image"]),"icon-rotate":new rt(st.layout_symbol["icon-rotate"]),"icon-padding":new He(st.layout_symbol["icon-padding"]),"icon-keep-upright":new He(st.layout_symbol["icon-keep-upright"]),"icon-offset":new rt(st.layout_symbol["icon-offset"]),"icon-anchor":new rt(st.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new He(st.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new He(st.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new He(st.layout_symbol["text-rotation-alignment"]),"text-field":new rt(st.layout_symbol["text-field"]),"text-font":new rt(st.layout_symbol["text-font"]),"text-size":new rt(st.layout_symbol["text-size"]),"text-max-width":new rt(st.layout_symbol["text-max-width"]),"text-line-height":new rt(st.layout_symbol["text-line-height"]),"text-letter-spacing":new rt(st.layout_symbol["text-letter-spacing"]),"text-justify":new rt(st.layout_symbol["text-justify"]),"text-radial-offset":new rt(st.layout_symbol["text-radial-offset"]),"text-variable-anchor":new He(st.layout_symbol["text-variable-anchor"]),"text-anchor":new rt(st.layout_symbol["text-anchor"]),"text-max-angle":new He(st.layout_symbol["text-max-angle"]),"text-writing-mode":new He(st.layout_symbol["text-writing-mode"]),"text-rotate":new rt(st.layout_symbol["text-rotate"]),"text-padding":new He(st.layout_symbol["text-padding"]),"text-keep-upright":new He(st.layout_symbol["text-keep-upright"]),"text-transform":new rt(st.layout_symbol["text-transform"]),"text-offset":new rt(st.layout_symbol["text-offset"]),"text-allow-overlap":new He(st.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new He(st.layout_symbol["text-ignore-placement"]),"text-optional":new He(st.layout_symbol["text-optional"])});var tf={paint:new Nt({"icon-opacity":new rt(st.paint_symbol["icon-opacity"]),"icon-color":new rt(st.paint_symbol["icon-color"]),"icon-halo-color":new rt(st.paint_symbol["icon-halo-color"]),"icon-halo-width":new rt(st.paint_symbol["icon-halo-width"]),"icon-halo-blur":new rt(st.paint_symbol["icon-halo-blur"]),"icon-translate":new He(st.paint_symbol["icon-translate"]),"icon-translate-anchor":new He(st.paint_symbol["icon-translate-anchor"]),"text-opacity":new rt(st.paint_symbol["text-opacity"]),"text-color":new rt(st.paint_symbol["text-color"],{runtimeType:xo,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new rt(st.paint_symbol["text-halo-color"]),"text-halo-width":new rt(st.paint_symbol["text-halo-width"]),"text-halo-blur":new rt(st.paint_symbol["text-halo-blur"]),"text-translate":new He(st.paint_symbol["text-translate"]),"text-translate-anchor":new He(st.paint_symbol["text-translate-anchor"])}),layout:hg};class dg{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Ei,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}yn(dg,"FormatSectionOverride",{omit:["defaultValue"]});class nf extends wl{constructor(e){super(e,tf)}recalculate(e,n){super.recalculate(e,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const h=[];for(const g of s)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,s,h){const g=this.layout.get(e).evaluate(n,{},s,h),y=this._unevaluatedLayout._values[e];return y.isDataDriven()||$(y.value)||!g?g:(w=n.properties,g.replace(/{([^{}]+)}/g,(D,k)=>k in w?String(w[k]):""));var w}createBucket(e){return new yc(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of tf.paint.overridableProperties){if(!nf.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),s=new dg(n),h=new P(s,n.property.specification);let g=null;g="constant"===n.value.kind||"source"===n.value.kind?new We("source",h):new Ot("composite",h,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new Ct(n.property,g,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven())&&nf.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const s=e.get("text-field"),h=tf.paint.properties[n];let g=!1;const y=w=>{for(const T of w)if(h.overrides&&h.overrides.hasOverride(T))return void(g=!0)};if("constant"===s.value.kind&&s.value.value instanceof ji)y(s.value.value.sections);else if("source"===s.value.kind){const w=D=>{g||(D instanceof Uo&&wi(D.value)===Jn?y(D.value.sections):D instanceof uo?y(D.sections):D.eachChild(w))},T=s.value;T._styleExpression&&w(T._styleExpression.expression)}return g}getProgramConfiguration(e){return new dc(this,e)}}var fg={paint:new Nt({"background-color":new He(st.paint_background["background-color"]),"background-pattern":new He(st.paint_background["background-pattern"]),"background-opacity":new He(st.paint_background["background-opacity"])})},iy={paint:new Nt({"raster-opacity":new He(st.paint_raster["raster-opacity"]),"raster-hue-rotate":new He(st.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new He(st.paint_raster["raster-brightness-min"]),"raster-brightness-max":new He(st.paint_raster["raster-brightness-max"]),"raster-saturation":new He(st.paint_raster["raster-saturation"]),"raster-contrast":new He(st.paint_raster["raster-contrast"]),"raster-resampling":new He(st.paint_raster["raster-resampling"]),"raster-fade-duration":new He(st.paint_raster["raster-fade-duration"])})};class pg extends wl{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Dp={paint:new Nt({"sky-type":new He(st.paint_sky["sky-type"]),"sky-atmosphere-sun":new He(st.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new He(st.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new He(st.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new He(st.paint_sky["sky-gradient-radius"]),"sky-gradient":new St(st.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new He(st.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new He(st.paint_sky["sky-atmosphere-color"]),"sky-opacity":new He(st.paint_sky["sky-opacity"])})};function Wh(t,e,n){const s=[0,0,1],h=If([]);return yd(h,h,n?-je(t)+Math.PI:je(t)),mh(h,h,-je(e)),ph(s,s,h),ra(s,s)}const oy={circle:class extends wl{constructor(t){super(t,Xf)}createBucket(t){return new Dd(t)}queryRadius(t){const e=t;return Ru("circle-radius",this,e)+Ru("circle-stroke-width",this,e)+ku(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,s,h,g,y,w){const T=zc(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,t.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return xm(t,s,g,y,w,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),T,D)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new dc(this,t)}},heatmap:class extends wl{createBucket(t){return new wm(t)}constructor(t){super(t,Em),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Tm({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Ru("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,s,h,g,y,w){const T=this.paint.get("heatmap-radius").evaluate(e,n);return xm(t,s,g,y,w,!0,!0,new dt(0,0),T)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new dc(this,t)}},hillshade:class extends wl{constructor(t){super(t,c_)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends wl{constructor(t){super(t,Lm)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(t){return new dc(this,t)}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Oa(t)}queryRadius(){return ku(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,s,h,g){return!t.queryGeometry.isAboveHorizon&&s_(bh(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,t.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends wl{constructor(t){super(t,Nu)}createBucket(t){return new ou(t)}queryRadius(){return ku(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new dc(this,t)}queryIntersectsFeature(t,e,n,s,h,g,y,w,T){const D=zc(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,t.pixelToTileUnitsFactor),k=this.paint.get("fill-extrusion-height").evaluate(e,n),O=this.paint.get("fill-extrusion-base").evaluate(e,n),B=[0,0],V=w&&g.elevation,G=g.elevation?g.elevation.exaggeration():1,J=t.tile.getBucket(this);if(V&&J instanceof ou){const Ce=J.centroidVertexArray,ke=T+1;ke<Ce.length&&(B[0]=Ce.geta_centroid_pos0(ke),B[1]=Ce.geta_centroid_pos1(ke))}if(0===B[0]&&1===B[1])return!1;"globe"===g.projection.name&&(s=I_([s],[new dt(0,0),new dt(Wn,Wn)],t.tileID.canonical).map(Ce=>Ce.polygon).flat());const he=V?w:null,[ve,Ie]=(ke=s,Pe=O,et=k,Xe=D,pt=y,Vt=he,it=B,xt=G,Tt=g.center.lat,"globe"===(Ce=g).projection.name?function(jt,at,Jt,Un,rn,bn,Qt,Gn,Ir,Dr,wr){const Zn=[],ii=[],ir=jt.projection.upVectorScale(wr,jt.center.lat,jt.worldSize).metersToTile,Fr=[0,0,0,1],_i=[0,0,0,1],Bi=(Ni,qi,po,xs)=>{Ni[0]=qi,Ni[1]=po,Ni[2]=xs,Ni[3]=1},Ii=ip();Jt>0&&(Jt+=Ii),Un+=Ii;for(const Ni of at){const qi=[],po=[];for(const xs of Ni){const hi=xs.x+rn.x,Oo=xs.y+rn.y,Co=jt.projection.projectTilePoint(hi,Oo,wr),Xr=jt.projection.upVector(wr,xs.x,xs.y);let no=Jt,Wo=Un;if(Qt){const yi=Hm(hi,Oo,Jt,Un,Qt,Gn,Ir,Dr);no+=yi.base,Wo+=yi.top}0!==Jt?Bi(Fr,Co.x+Xr[0]*ir*no,Co.y+Xr[1]*ir*no,Co.z+Xr[2]*ir*no):Bi(Fr,Co.x,Co.y,Co.z),Bi(_i,Co.x+Xr[0]*ir*Wo,Co.y+Xr[1]*ir*Wo,Co.z+Xr[2]*ir*Wo),fo(Fr,Fr,bn),fo(_i,_i,bn),qi.push(new ju(Fr[0],Fr[1],Fr[2])),po.push(new ju(_i[0],_i[1],_i[2]))}Zn.push(qi),ii.push(po)}return[Zn,ii]}(Ce,ke,Pe,et,Xe,pt,Vt,it,xt,Tt,t.tileID.canonical):Vt?function(jt,at,Jt,Un,rn,bn,Qt,Gn,Ir){const Dr=[],wr=[],Zn=[0,0,0,1];for(const ii of jt){const ir=[],Fr=[];for(const _i of ii){const Bi=_i.x+Un.x,Ii=_i.y+Un.y,Ni=Hm(Bi,Ii,at,Jt,bn,Qt,Gn,Ir);Zn[0]=Bi,Zn[1]=Ii,Zn[2]=Ni.base,Zn[3]=1,pc(Zn,Zn,rn),Zn[3]=Math.max(Zn[3],1e-5);const qi=new ju(Zn[0]/Zn[3],Zn[1]/Zn[3],Zn[2]/Zn[3]);Zn[0]=Bi,Zn[1]=Ii,Zn[2]=Ni.top,Zn[3]=1,pc(Zn,Zn,rn),Zn[3]=Math.max(Zn[3],1e-5);const po=new ju(Zn[0]/Zn[3],Zn[1]/Zn[3],Zn[2]/Zn[3]);ir.push(qi),Fr.push(po)}Dr.push(ir),wr.push(Fr)}return[Dr,wr]}(ke,Pe,et,Xe,pt,Vt,it,xt,Tt):function(jt,at,Jt,Un,rn){const bn=[],Qt=[],Gn=rn[8]*at,Ir=rn[9]*at,Dr=rn[10]*at,wr=rn[11]*at,Zn=rn[8]*Jt,ii=rn[9]*Jt,ir=rn[10]*Jt,Fr=rn[11]*Jt;for(const _i of jt){const Bi=[],Ii=[];for(const Ni of _i){const qi=Ni.x+Un.x,po=Ni.y+Un.y,xs=rn[0]*qi+rn[4]*po+rn[12],hi=rn[1]*qi+rn[5]*po+rn[13],Oo=rn[2]*qi+rn[6]*po+rn[14],Co=rn[3]*qi+rn[7]*po+rn[15],Xr=xs+Gn,no=hi+Ir,Wo=Oo+Dr,yi=Math.max(Co+wr,1e-5),vo=xs+Zn,Hs=hi+ii,ws=Oo+ir,os=Math.max(Co+Fr,1e-5);Bi.push(new ju(Xr/yi,no/yi,Wo/yi)),Ii.push(new ju(vo/os,Hs/os,ws/os))}bn.push(Bi),Qt.push(Ii)}return[bn,Qt]}(ke,Pe,et,Xe,pt)),ye=t.queryGeometry;var Ce,ke,Pe,et,Xe,pt,Vt,it,xt,Tt;return function(Ce,ke,Pe){let et=1/0;s_(Pe,ke)&&(et=Gm(Pe,ke[0]));for(let Xe=0;Xe<ke.length;Xe++){const pt=ke[Xe],Vt=Ce[Xe];for(let it=0;it<pt.length-1;it++){const xt=pt[it],Tt=[xt,pt[it+1],Vt[it+1],Vt[it],xt];$f(Pe,Tt)&&(et=Math.min(et,Gm(Pe,Tt)))}}return et!==1/0&&et}(ve,Ie,ye.isPointQuery()?ye.screenBounds:ye.screenGeometry)}},line:class extends wl{constructor(t){super(t,Xm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ma,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=k_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new sp(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new dc(this,t)}queryRadius(t){const e=t,n=su(Ru("line-width",this,e),Ru("line-gap-width",this,e)),s=Ru("line-offset",this,e);return n/2+Math.abs(s)+ku(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,s,h,g){if(t.queryGeometry.isAboveHorizon)return!1;const y=bh(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,t.pixelToTileUnitsFactor),w=t.pixelToTileUnitsFactor/2*su(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),T=this.paint.get("line-offset").evaluate(e,n);return T&&(s=function(D,k){const O=[],B=new dt(0,0);for(let V=0;V<D.length;V++){const G=D[V],J=[];for(let he=0;he<G.length;he++){const Ie=G[he],ye=G[he+1],Ce=0===he?B:Ie.sub(G[he-1])._unit()._perp(),ke=he===G.length-1?B:ye.sub(Ie)._unit()._perp(),Pe=Ce._add(ke)._unit();Pe._mult(1/(Pe.x*ke.x+Pe.y*ke.y)),J.push(Pe._mult(k)._add(Ie))}O.push(J)}return O}(s,T*t.pixelToTileUnitsFactor)),function(D,k,O){for(let B=0;B<k.length;B++){const V=k[B];if(D.length>=3)for(let G=0;G<V.length;G++)if(iu(D,V[G]))return!0;if(Hf(D,V,O))return!0}return!1}(y,s,w)}isTileClipped(){return!0}},symbol:nf,background:class extends wl{constructor(t){super(t,fg)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends wl{constructor(t){super(t,iy)}getProgramIds(){return["raster"]}},sky:class extends wl{constructor(t){super(t,Dp),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Tm({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),h=!s,g=t.style.light,y=g.properties.get("position");return h&&"viewport"===g.properties.get("anchor")&&cr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Wh(y.azimuthal,90-y.polar,e):Wh(s[0],90-s[1],e)}const n=this.paint.get("sky-gradient-center");return Wh(n[0],90-n[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}};class Vc{constructor(e,n,s,h){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(n,h)}update(e,n,s){const{width:h,height:g}=e,{context:y}=this,{gl:w}=y,{HTMLImageElement:T,HTMLCanvasElement:D,HTMLVideoElement:k,ImageData:O,ImageBitmap:B}=Le;if(w.bindTexture(w.TEXTURE_2D,this.texture),y.pixelStoreUnpackFlipY.set(!1),y.pixelStoreUnpack.set(1),y.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!n||!1!==n.premultiply)),s||this.size&&this.size[0]===h&&this.size[1]===g){const{x:V,y:G}=s||{x:0,y:0};e instanceof T||e instanceof D||e instanceof k||e instanceof O||B&&e instanceof B?w.texSubImage2D(w.TEXTURE_2D,0,V,G,w.RGBA,w.UNSIGNED_BYTE,e):w.texSubImage2D(w.TEXTURE_2D,0,V,G,h,g,w.RGBA,w.UNSIGNED_BYTE,e.data)}else this.size=[h,g],e instanceof T||e instanceof D||e instanceof k||e instanceof O||B&&e instanceof B?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,e):w.texImage2D(w.TEXTURE_2D,0,this.format,h,g,0,this.format,w.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&w.generateMipmap(w.TEXTURE_2D)}bind(e,n){const{context:s}=this,{gl:h}=s;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:e),this.filter=e),n!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class rf{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Cp{constructor(){this.tasks={},this.taskQueue=[],hr(["process"],this),this.invoker=new rf(this.process),this.nextId=0}add(e,n){const s=this.nextId++,h=function({type:g,isSymbolTile:y,zoom:w}){return w=w||0,"message"===g?0:"maybePrepare"!==g||y?"parseTile"!==g||y?"parseTile"===g&&y?300-w:"maybePrepare"===g&&y?400-w:500:200-w:100-w}(n);if(0===h){Kr();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:n,priority:h,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){Kr();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let h=0;h<this.taskQueue.length;h++){const g=this.tasks[this.taskQueue[h]];g.priority<n&&(n=g.priority,e=h)}if(null===e)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class mg{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const s=e[n];this._stringToNumber[s]=n,this._numberToString[n]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Sp=["tile","layer","source","sourceLayer","state"];class sf{constructor(e,n,s,h,g){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=s,this._y=h,this.properties=e.properties,this.id=g}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const n of Sp)void 0!==this[n]&&(e[n]=this[n]);return e}}const za=32,Il=33,Ql=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,s=0,h=0,g=0,y=0,w=0;for(1&e?h=g=y=za:n=s=w=za;(e>>=1)>1;){const D=n+h>>1,k=s+g>>1;1&e?(h=n,g=s,n=y,s=w):(n=h,s=g,h=y,g=w),y=D,w=k}const T=4*t;Ql[T+0]=n,Ql[T+1]=s,Ql[T+2]=h,Ql[T+3]=g}const Al=new Uint16Array(2178),vc=new Uint8Array(1089),Qu=new Uint16Array(1089);function Mp(t){return 0===t?-.03125:32===t?.03125:0}var gg=Sn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const Ip={type:2,extent:Wn,loadGeometry:()=>[[new dt(0,0),new dt(8193,0),new dt(8193,8193),new dt(0,8193),new dt(0,0)]]};class af{constructor(e,n,s,h,g){this.tileID=e,this.uid=At(),this.uses=0,this.tileSize=n,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<nr.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Wu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,g){const y={};if(!g)return y;for(const w of h){const T=w.layerIds.map(D=>g.getLayer(D)).filter(Boolean);if(0!==T.length){w.layers=T,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(D=>T.filter(k=>k.id===D)[0]));for(const D of T)y[D.id]=w}}return y}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const g=this.buckets[h];if(g instanceof yc){if(this.hasSymbolBuckets=!0,!s)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const g=this.buckets[h];if(g instanceof yc&&g.hasRTLText){this.hasRTLText=!0,ze.isLoading()||ze.isLoaded()||"deferred"!==Re()||Ae();break}}this.queryPadding=0;for(const h in this.buckets){const g=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(h).queryRadius(g))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new nd}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const h=this.buckets[s];h.uploadPending()&&h.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Vc(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Vc(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Vc(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,s,h,g,y,w,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:w,transform:y,params:g,tileTransform:this.tileTransform},e,n,s):{}}querySourceFeatures(e,n){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const h=s.loadVTLayers(),g=n?n.sourceLayer:"",y=h._geojsonTileLayer||h[g];if(!y)return;const w=Pl(n&&n.filter),{z:T,x:D,y:k}=this.tileID.canonical,O={z:T,x:D,y:k};for(let B=0;B<y.length;B++){const V=y.feature(B);if(w.needGeometry){const he=Oc(V,!0);if(!w.filter(new qe(this.tileID.overscaledZ),he,this.tileID.canonical))continue}else if(!w.filter(new qe(this.tileID.overscaledZ),V))continue;const G=s.getId(V,g),J=new sf(V,T,D,k,G);J.tile=O,e.push(J)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const s=Pr(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let h=!1;if(this.expirationTime>s)h=!1;else if(n)if(this.expirationTime<n)h=!0;else{const g=this.expirationTime-n;g?this.expirationTime=s+Math.max(g,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!n)return;const s=this.latestFeatureIndex.loadVTLayers(),h=n.style.listImages();for(const g in this.buckets){if(!n.style.hasLayer(g))continue;const y=this.buckets[g],w=y.layers[0].sourceLayer||"_geojsonTileLayer",T=s[w],D=e[w];if(!T||!D||0===Object.keys(D).length)continue;if(y.update(D,T,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),y instanceof sp||y instanceof Oa){const O=n.style._getSourceCache(y.layers[0].source);n._terrain&&n._terrain.enabled&&O&&y.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(O.id,this.tileID)}const k=n&&n.style&&n.style.getLayer(g);k&&(this.queryPadding=Math.max(this.queryPadding,k.queryRadius(y)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<nr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=nr.now()+e}setTexture(e,n){const s=n.context,h=s.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Vc(s,e,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE))}setDependencies(e,n){const s={};for(const h of n)s[h]=!0;this.dependencies[e]=s}hasDependency(e,n){for(const s of e){const h=this.dependencies[s];if(h)for(const g of n)if(h[g])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||"mercator"===n.name||this._tileDebugBuffer)return;const s=Zl(Ip,this.tileID.canonical,this.tileTransform)[0],h=new Fn,g=new Vl;for(let y=0;y<s.length;y++){const{x:w,y:T}=s[y];h.emplaceBack(w,T),g.emplaceBack(y)}g.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(g),this._tileDebugBuffer=e.createVertexBuffer(h,gh.members),this._tileDebugSegments=yo.simpleSegment(0,0,h.length,g.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||"mercator"===n.name)return;const s=Zl(Ip,this.tileID.canonical,this.tileTransform)[0];let h,g;if(this.isRaster){const y=function(w,T){const D=Wu(w,T),k=Math.pow(2,w.z);for(let he=0;he<Il;he++)for(let ve=0;ve<Il;ve++){const Ie=Ga((w.x+(ve+Mp(ve))/za)/k),ye=vs((w.y+(he+Mp(he))/za)/k),Ce=T.project(Ie,ye),ke=he*Il+ve;Al[2*ke+0]=Math.round((Ce.x*D.scale-D.x)*Wn),Al[2*ke+1]=Math.round((Ce.y*D.scale-D.y)*Wn)}vc.fill(0),Qu.fill(0);for(let he=2045;he>=0;he--){const ve=4*he,Ie=Ql[ve+0],ye=Ql[ve+1],Ce=Ql[ve+2],ke=Ql[ve+3],Pe=Ie+Ce>>1,et=ye+ke>>1,Xe=Pe+et-ye,pt=et+Ie-Pe,Vt=ye*Il+Ie,it=ke*Il+Ce,xt=et*Il+Pe,Tt=Math.hypot((Al[2*Vt+0]+Al[2*it+0])/2-Al[2*xt+0],(Al[2*Vt+1]+Al[2*it+1])/2-Al[2*xt+1])>=16;vc[xt]=vc[xt]||(Tt?1:0),he<1022&&(vc[xt]=vc[xt]||vc[(ye+pt>>1)*Il+(Ie+Xe>>1)]||vc[(ke+pt>>1)*Il+(Ce+Xe>>1)])}const O=new ci,B=new Ss;let V=0;function G(he,ve){const Ie=ve*Il+he;return 0===Qu[Ie]&&(O.emplaceBack(Al[2*Ie+0],Al[2*Ie+1],he*Wn/za,ve*Wn/za),Qu[Ie]=++V),Qu[Ie]-1}function J(he,ve,Ie,ye,Ce,ke){const Pe=he+Ie>>1,et=ve+ye>>1;if(Math.abs(he-Ce)+Math.abs(ve-ke)>1&&vc[et*Il+Pe])J(Ce,ke,he,ve,Pe,et),J(Ie,ye,Ce,ke,Pe,et);else{const Xe=G(he,ve),pt=G(Ie,ye),Vt=G(Ce,ke);B.emplaceBack(Xe,pt,Vt)}}return J(0,0,za,za,za,0),J(za,za,0,0,0,za),{vertices:O,indices:B}}(this.tileID.canonical,n);h=y.vertices,g=y.indices}else{h=new ci,g=new Ss;for(const{x:w,y:T}of s)h.emplaceBack(w,T,0,0);const y=Sl(h.int16,void 0,4);for(let w=0;w<y.length;w+=3)g.emplaceBack(y[w],y[w+1],y[w+2])}this._tileBoundsBuffer=e.createVertexBuffer(h,gg.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(g),this._tileBoundsSegments=yo.simpleSegment(0,0,h.length,g.length)}_makeGlobeTileDebugBuffers(e,n){const s=n.projection;if(!s||"globe"!==s.name||n.freezeTileCoverage)return;const h=this.tileID.canonical,g=nu(pm(h,n)),y=vh(n.zoom);let w;y>0&&(w=fd(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,h,n,g,w,y),this._makeGlobeTileDebugTextBuffer(e,h,n,g,w,y)}_globePoint(e,n,s,h,g,y,w){let T=wd(e,n,s);if(y){const D=1<<s.z,k=Wl(h.center.lng),O=Hi(h.center.lat),B=(s.x+.5)/D-k;let V=0;B>.5?V=-1:B<-.5&&(V=1);let G=(e/Wn+s.x)/D+V,J=(n/Wn+s.y)/D;G=(G-k)*h._pixelsPerMercatorPixel+k,J=(J-O)*h._pixelsPerMercatorPixel+O;const he=[G*h.worldSize,J*h.worldSize,0];fo(he,he,y),T=Qc(T,he,w)}return fo(T,T,g)}_makeGlobeTileDebugBorderBuffer(e,n,s,h,g,y){const w=new Fn,T=new Vl,D=new ei,k=(B,V,G,J,he)=>{const ve=(G-B)/(he-1),Ie=(J-V)/(he-1),ye=w.length;for(let Ce=0;Ce<he;Ce++){const ke=B+Ce*ve,Pe=V+Ce*Ie;w.emplaceBack(ke,Pe);const et=this._globePoint(ke,Pe,n,s,h,g,y);D.emplaceBack(et[0],et[1],et[2]),T.emplaceBack(ye+Ce)}},O=Wn;k(0,0,O,0,16),k(O,0,O,O,16),k(O,O,0,O,16),k(0,O,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(T),this._tileDebugBuffer=e.createVertexBuffer(w,gh.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(D,Pf.members),this._tileDebugSegments=yo.simpleSegment(0,0,w.length,T.length)}_makeGlobeTileDebugTextBuffer(e,n,s,h,g,y){const w=new Fn,T=new Ss,D=new ei,k=25;T.reserve(32),w.reserve(k),D.reserve(k);const O=(B,V)=>k*B+V;for(let B=0;B<k;B++){const V=2048*B;for(let G=0;G<k;G++){const J=2048*G;w.emplaceBack(J,V);const he=this._globePoint(J,V,n,s,h,g,y);D.emplaceBack(he[0],he[1],he[2])}}for(let B=0;B<4;B++)for(let V=0;V<4;V++){const G=O(B,V),J=O(B,V+1),he=O(B+1,V),ve=O(B+1,V+1);T.emplaceBack(G,J,he),T.emplaceBack(he,J,ve)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(T),this._tileDebugTextBuffer=e.createVertexBuffer(w,gh.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(D,Pf.members),this._tileDebugTextSegments=yo.simpleSegment(0,0,k,32)}}class _g{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,s){const h=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},$e(this.stateChanges[e][h],s),null===this.deletedStates[e]){this.deletedStates[e]={};for(const g in this.state[e])g!==h&&(this.deletedStates[e][g]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][h]){this.deletedStates[e][h]={};for(const g in this.state[e][h])s[g]||(this.deletedStates[e][h][g]=null)}else for(const g in s)this.deletedStates[e]&&this.deletedStates[e][h]&&null===this.deletedStates[e][h][g]&&delete this.deletedStates[e][h][g]}removeFeatureState(e,n,s){if(null===this.deletedStates[e])return;const h=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&void 0!==n)null!==this.deletedStates[e][h]&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][s]=null);else if(void 0!==n)if(this.stateChanges[e]&&this.stateChanges[e][h])for(s in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][s]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,n){const s=String(n),h=$e({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const g=this.deletedStates[e][n];if(null===g)return{};for(const y in g)delete h[y]}return h}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const s={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const g={};for(const y in this.stateChanges[h])this.state[h][y]||(this.state[h][y]={}),$e(this.state[h][y],this.stateChanges[h][y]),g[y]=this.state[h][y];s[h]=g}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const g={};if(null===this.deletedStates[h])for(const y in this.state[h])g[y]={},this.state[h][y]={};else for(const y in this.deletedStates[h]){if(null===this.deletedStates[h][y])this.state[h][y]={};else if(this.state[h][y])for(const w of Object.keys(this.deletedStates[h][y]))delete this.state[h][y][w];g[y]=this.state[h][y]}s[h]=s[h]||{},$e(s[h],g)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const h in e)e[h].setFeatureState(s,n)}}class Ap{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const s=this.toIdx(e,n);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function yg(t,e,n,s){let h=0,g=Number.MAX_VALUE;for(let y=0;y<3;y++)if(Math.abs(s[y])<1e-15){if(n[y]<t[y]||n[y]>e[y])return null}else{const w=1/s[y];let T=(t[y]-n[y])*w,D=(e[y]-n[y])*w;if(T>D){const k=T;T=D,D=k}if(T>h&&(h=T),D<g&&(g=D),h>g)return null}return h}function Pp(t,e,n,s,h,g,y,w,T,D,k){const O=s-t,B=h-e,V=g-n,G=y-t,J=w-e,he=T-n,ve=k[1]*he-k[2]*J,Ie=k[2]*G-k[0]*he,ye=k[0]*J-k[1]*G,Ce=O*ve+B*Ie+V*ye;if(Math.abs(Ce)<1e-15)return null;const ke=1/Ce,Pe=D[0]-t,et=D[1]-e,Xe=D[2]-n,pt=(Pe*ve+et*Ie+Xe*ye)*ke;if(pt<0||pt>1)return null;const Vt=et*V-Xe*B,it=Xe*O-Pe*V,xt=Pe*B-et*O,Tt=(k[0]*Vt+k[1]*it+k[2]*xt)*ke;return Tt<0||pt+Tt>1?null:(G*Vt+J*it+he*xt)*ke}function Rp(t,e,n){return(t-e)/(n-e)}function lf(t,e,n,s,h,g,y,w,T){const D=1<<n,k=g-s,O=y-h,B=(t+1)/D*k+s,V=(e+0)/D*O+h,G=(e+1)/D*O+h;w[0]=(t+0)/D*k+s,w[1]=V,T[0]=B,T[1]=G}class cf{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(g){const y=Math.ceil(Math.log2(g.dim/8)),w=[];let T=Math.ceil(Math.pow(2,y));const D=1/T,k=(V,G,J,he,ve)=>{const Ie=he?1:0,ye=(V+1)*J-Ie,Ce=G*J,ke=(G+1)*J-Ie;ve[0]=V*J,ve[1]=Ce,ve[2]=ye,ve[3]=ke};let O=new Ap(T);const B=[];for(let V=0;V<T*T;V++){k(V%T,Math.floor(V/T),D,!1,B);const G=xc(B[0],B[1],g),J=xc(B[2],B[1],g),he=xc(B[2],B[3],g),ve=xc(B[0],B[3],g);O.minimums.push(Math.min(G,J,he,ve)),O.maximums.push(Math.max(G,J,he,ve)),O.leaves.push(1)}for(w.push(O),T/=2;T>=1;T/=2){const V=w[w.length-1];O=new Ap(T);for(let G=0;G<T*T;G++){k(G%T,Math.floor(G/T),2,!0,B);const J=V.getElevation(B[0],B[1]),he=V.getElevation(B[2],B[1]),ve=V.getElevation(B[2],B[3]),Ie=V.getElevation(B[0],B[3]),ye=V.isLeaf(B[0],B[1]),Ce=V.isLeaf(B[2],B[1]),ke=V.isLeaf(B[2],B[3]),Pe=V.isLeaf(B[0],B[3]),et=Math.min(J.min,he.min,ve.min,Ie.min),Xe=Math.max(J.max,he.max,ve.max,Ie.max),pt=ye&&Ce&&ke&&Pe;O.maximums.push(Xe),O.minimums.push(et),O.leaves.push(Xe-et<=5&&pt?1:0)}w.push(O)}return w}(this.dem),s=n.length-1,h=n[s];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(n,0,0,s,0)}raycastRoot(e,n,s,h,g,y,w=1){return yg([e,n,-100],[s,h,this.maximums[0]*w],g,y)}raycast(e,n,s,h,g,y,w=1){if(!this.nodeCount)return null;const T=this.raycastRoot(e,n,s,h,g,y,w);if(null==T)return null;const D=[],k=[],O=[],B=[],V=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;V.length>0;){const{idx:G,t:J,nodex:he,nodey:ve,depth:Ie}=V.pop();if(this.leaves[G]){lf(he,ve,Ie,e,n,s,h,O,B);const Ce=1<<Ie,ke=(he+0)/Ce,Pe=(he+1)/Ce,et=(ve+0)/Ce,Xe=(ve+1)/Ce,pt=xc(ke,et,this.dem)*w,Vt=xc(Pe,et,this.dem)*w,it=xc(Pe,Xe,this.dem)*w,xt=xc(ke,Xe,this.dem)*w,Tt=Pp(O[0],O[1],pt,B[0],O[1],Vt,B[0],B[1],it,g,y),Pt=Pp(B[0],B[1],it,O[0],B[1],xt,O[0],O[1],pt,g,y),jt=Math.min(null!==Tt?Tt:Number.MAX_VALUE,null!==Pt?Pt:Number.MAX_VALUE);if(jt!==Number.MAX_VALUE)return jt;{const at=fh([],g,y,J);if(kp(pt,Vt,xt,it,Rp(at[0],O[0],B[0]),Rp(at[1],O[1],B[1]))>=at[2])return J}continue}let ye=0;for(let Ce=0;Ce<this._siblingOffset.length;Ce++){lf((he<<1)+this._siblingOffset[Ce][0],(ve<<1)+this._siblingOffset[Ce][1],Ie+1,e,n,s,h,O,B),O[2]=-100,B[2]=this.maximums[this.childOffsets[G]+Ce]*w;const ke=yg(O,B,g,y);if(null!=ke){const Pe=ke;D[Ce]=Pe;let et=!1;for(let Xe=0;Xe<ye&&!et;Xe++)Pe>=D[k[Xe]]&&(k.splice(Xe,0,Ce),et=!0);et||(k[ye]=Ce),ye++}}for(let Ce=0;Ce<ye;Ce++){const ke=k[Ce];V.push({idx:this.childOffsets[G]+ke,t:D[ke],nodex:(he<<1)+this._siblingOffset[ke][0],nodey:(ve<<1)+this._siblingOffset[ke][1],depth:Ie+1})}}return null}_addNode(e,n,s){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,s,h,g){if(1===e[h].isLeaf(n,s))return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const y=h-1,w=e[y];let T=0,D=0;for(let k=0;k<this._siblingOffset.length;k++){const O=2*n+this._siblingOffset[k][0],B=2*s+this._siblingOffset[k][1],V=w.getElevation(O,B),G=w.isLeaf(O,B),J=this._addNode(V.min,V.max,G);G&&(T|=1<<k),D||(D=J)}for(let k=0;k<this._siblingOffset.length;k++)T&1<<k||this._construct(e,2*n+this._siblingOffset[k][0],2*s+this._siblingOffset[k][1],y,D+k)}}function kp(t,e,n,s,h,g){return fr(fr(t,n,g),fr(e,s,g),h)}function xc(t,e,n){const s=n.dim,h=ft(t*s-.5,0,s-1),g=ft(e*s-.5,0,s-1),y=Math.floor(h),w=Math.floor(g),T=Math.min(y+1,s-1),D=Math.min(w+1,s-1);return kp(n.get(y,w),n.get(T,w),n.get(y,D),n.get(T,D),h-y,g-w)}const Lp={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function vg(t,e,n){return(256*t*256+256*e+n)/10-1e4}function xg(t,e,n){return 256*t+e+n/256-32768}class Zh{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,s,h=!1,g=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return cr(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const y=this.dim=n.height-2,w=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=s||"mapbox",this.borderReady=h,!h){for(let T=0;T<y;T++)w[this._idx(-1,T)]=w[this._idx(0,T)],w[this._idx(y,T)]=w[this._idx(y-1,T)],w[this._idx(T,-1)]=w[this._idx(T,0)],w[this._idx(T,y)]=w[this._idx(T,y-1)];w[this._idx(-1,-1)]=w[this._idx(0,0)],w[this._idx(y,-1)]=w[this._idx(y-1,0)],w[this._idx(-1,y)]=w[this._idx(0,y-1)],w[this._idx(y,y)]=w[this._idx(y-1,y-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new cf(this)}get(e,n,s=!1){s&&(e=ft(e,-1,this.dim),n=ft(n,-1,this.dim));const h=4*this._idx(e,n);return("terrarium"===this.encoding?xg:vg)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(e){return Lp[e]}get unpackVector(){return Lp[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const s=[0,0,0,0],h=Zh.getUnpackVector(n);let g=Math.floor((e+h[3])/h[2]);return s[2]=g%256,g=Math.floor(g/256),s[1]=g%256,g=Math.floor(g/256),s[0]=g,s}getPixels(){return new La({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=n*this.dim,g=n*this.dim+this.dim,y=s*this.dim,w=s*this.dim+this.dim;switch(n){case-1:h=g-1;break;case 1:g=h+1}switch(s){case-1:y=w-1;break;case 1:w=y+1}const T=-n*this.dim,D=-s*this.dim;for(let k=y;k<w;k++)for(let O=h;O<g;O++){const B=4*this._idx(O,k),V=4*this._idx(O+T,k+D);this.pixels[B+0]=e.pixels[V+0],this.pixels[B+1]=e.pixels[V+1],this.pixels[B+2]=e.pixels[V+2],this.pixels[B+3]=e.pixels[V+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}yn(Zh,"DEMData"),yn(cf,"DemMinMaxQuadTree",{omit:["dem"]});class wg{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,s){const h=e.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const g={value:n,timeout:void 0};if(void 0!==s&&(g.timeout=setTimeout(()=>{this.remove(e,g)},s)),this.data[h].push(g),this.order.push(h),this.order.length>this.max){const y=this._getAndRemoveByKey(this.order[0]);y&&this.onRemove(y)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const s=e.wrapped().key,h=void 0===n?0:this.data[s].indexOf(n),g=this.data[s][h];return this.data[s].splice(h,1),g.timeout&&clearTimeout(g.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(g.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const s in this.data)for(const h of this.data[s])e(h.value)||n.push(h);for(const s of n)this.remove(s.value.tileID,s)}}class vu{constructor(e,n,s){this.func=e,this.mask=n,this.range=s}}vu.ReadOnly=!1,vu.ReadWrite=!0,vu.disabled=new vu(519,vu.ReadOnly,[0,1]);class ec{constructor(e,n,s,h,g,y){this.test=e,this.ref=n,this.mask=s,this.fail=h,this.depthFail=g,this.pass=y}}ec.disabled=new ec({func:519,mask:0},0,0,7680,7680,7680);class tc{constructor(e,n,s){this.blendFunction=e,this.blendColor=n,this.mask=s}}tc.Replace=[1,0],tc.disabled=new tc(tc.Replace,Hr.transparent,[!1,!1,!1,!1]),tc.unblended=new tc(tc.Replace,Hr.transparent,[!0,!0,!0,!0]),tc.alphaBlended=new tc([1,771],Hr.transparent,[!0,!0,!0,!0]);class Gs{constructor(e,n,s){this.enable=e,this.mode=n,this.frontFace=s}}Gs.disabled=new Gs(!1,1029,2305),Gs.backCCW=new Gs(!0,1029,2305),Gs.backCW=new Gs(!0,1029,2304),Gs.frontCW=new Gs(!0,1028,2304),Gs.frontCCW=new Gs(!0,1028,2305);class wc extends ki{constructor(e,n,s){super(),this.id=e,this._onlySymbols=s,n.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new wg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new _g,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if("loaded"!==n.state&&"errored"!==n.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const s=this._tiles[n];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return ot(this._tiles).map(e=>e.tileID).sort(bg).map(e=>e.key)}getRenderableIds(e){const n=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&n.push(this._tiles[s]);return e?n.sort((s,h)=>{const g=s.tileID,y=h.tileID,w=new dt(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),T=new dt(y.canonical.x,y.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-y.overscaledZ||T.y-w.y||T.x-w.x}).map(s=>s.tileID.key):n.map(s=>s.tileID).sort(bg).map(s=>s.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const s=this._tiles[e];s&&("loading"!==s.state&&(s.state=n),this._loadTile(s,this._tileLoaded.bind(this,s,e,n)))}_tileLoaded(e,n,s,h){if(h)if(e.state="errored",404!==h.status)this._source.fire(new Xo(h,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=nr.now(),"expired"===s&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Cr("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let h=0;h<n.length;h++){const g=n[h];if(e.neighboringTiles&&e.neighboringTiles[g]){const y=this.getTileByID(g);s(e,y),s(y,e)}}function s(h,g){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let y=g.tileID.canonical.x-h.tileID.canonical.x;const w=g.tileID.canonical.y-h.tileID.canonical.y,T=Math.pow(2,h.tileID.canonical.z),D=g.tileID.key;0===y&&0===w||Math.abs(w)>1||(Math.abs(y)>1&&(1===Math.abs(y+T)?y+=T:1===Math.abs(y-T)&&(y-=T)),g.dem&&h.dem&&(h.dem.backfillBorder(g.dem,y,w),h.neighboringTiles&&h.neighboringTiles[D]&&(h.neighboringTiles[D].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,s,h){for(const g in this._tiles){let y=this._tiles[g];if(h[g]||!y.hasData()||y.tileID.overscaledZ<=n||y.tileID.overscaledZ>s)continue;let w=y.tileID;for(;y&&y.tileID.overscaledZ>n+1;){const D=y.tileID.scaledTo(y.tileID.overscaledZ-1);y=this._tiles[D.key],y&&y.hasData()&&(w=D)}let T=w;for(;T.overscaledZ>n;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]){h[w.key]=w;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=n?s:null}for(let s=e.overscaledZ-1;s>=n;s--){const h=e.scaledTo(s),g=this._getLoadedTile(h);if(g)return g}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const s=Math.ceil(e.width/n)+1,h=Math.ceil(e.height/n)+1,g=Math.floor(s*h*5),y="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,g):g,w="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,y):y;this._cache.setMaxSize(w)}handleWrapJump(e){const n=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,n){const s={};for(const h in this._tiles){const g=this._tiles[h];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+n),s[g.tileID.key]=g}this._tiles=s;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(e,n,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let h;this.updateCacheSize(e,n),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(w=>new sa(w.canonical.z,w.wrap,w.canonical.z,w.canonical.x,w.canonical.y)):(h=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(w=>this._source.hasTile(w)))):h=[];const g=this._updateRetainedTiles(h);if(uf(this._source.type)&&0!==h.length){const w={},T={},D=Object.keys(g);for(const O of D){const B=g[O],V=this._tiles[O];if(!V||V.fadeEndTime&&V.fadeEndTime<=nr.now())continue;const G=this.findLoadedParent(B,Math.max(B.overscaledZ-wc.maxOverzooming,this._source.minzoom));G&&(this._addTile(G.tileID),w[G.tileID.key]=G.tileID),T[O]=B}const k=h[h.length-1].overscaledZ;for(const O in this._tiles){const B=this._tiles[O];if(g[O]||!B.hasData())continue;let V=B.tileID;for(;V.overscaledZ>k;){V=V.scaledTo(V.overscaledZ-1);const G=this._tiles[V.key];if(G&&G.hasData()&&T[V.key]){g[O]=B.tileID;break}}}for(const O in w)g[O]||(this._coveredTiles[O]=!0,g[O]=w[O])}for(const w in g)this._tiles[w].clearFadeHold();const y=function(w,T){const D=[];for(const k in w)k in T||D.push(k);return D}(this._tiles,g);for(const w of y){const T=this._tiles[w];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+w)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(0===e.length)return n;const s={},h=e.reduce((D,k)=>Math.min(D,k.overscaledZ),1/0),g=e[0].overscaledZ,y=Math.max(g-wc.maxOverzooming,this._source.minzoom),w=Math.max(g+wc.maxUnderzooming,this._source.minzoom),T={};for(const D of e){const k=this._addTile(D);n[D.key]=D,k.hasData()||h<this._source.maxzoom&&(T[D.key]=D)}this._retainLoadedChildren(T,h,w,n);for(const D of e){let k=this._tiles[D.key];if(k.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const B=D.children(this._source.maxzoom)[0],V=this.getTile(B);if(V&&V.hasData()){n[B.key]=B;continue}}else{const B=D.children(this._source.maxzoom);if(n[B[0].key]&&n[B[1].key]&&n[B[2].key]&&n[B[3].key])continue}let O=k.wasRequested();for(let B=D.overscaledZ-1;B>=y;--B){const V=D.scaledTo(B);if(s[V.key]||(s[V.key]=!0,k=this.getTile(V),!k&&O&&(k=this._addTile(V)),k&&(n[V.key]=V,O=k.wasRequested(),k.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let s,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){s=this._loadedParentTiles[h.key];break}n.push(h.key);const g=h.scaledTo(h.overscaledZ-1);if(s=this._getLoadedTile(g),s)break;h=g}for(const g of n)this._loadedParentTiles[g]=s}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const s=Boolean(n);if(!s){const h=this.map?this.map.painter:null;n=new af(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,s||this._source.fire(new Cr("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=n.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&"reloading"!==n.state?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,s){const h=[],g=this.transform;if(!g)return h;const y="globe"===g.projection.name,w=Wl(g.center.lng);for(const T in this._tiles){const D=this._tiles[T];if(s&&D.clearQueryDebugViz(),D.holdingForFade())continue;let k;if(y){const O=D.tileID.canonical;if(0===O.z){const B=[Math.abs(ft(w,...hf(O,-1))-w),Math.abs(ft(w,...hf(O,1))-w)];k=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs(ft(w,...hf(O,-1))-w),Math.abs(ft(w,...hf(O,0))-w),Math.abs(ft(w,...hf(O,1))-w)];k=[B.indexOf(Math.min(...B))-1]}}else k=[0];for(const O of k){const B=e.containsTile(D,g,n,O);B&&h.push(B)}}return h}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of n)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(uf(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=nr.now())return!0}return!1}setFeatureState(e,n,s){this._state.updateState(e=e||"_geojsonTileLayer",n,s)}removeFeatureState(e,n,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,s)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,s){const h=this._tiles[e];h&&h.setDependencies(n,s)}reloadTilesForDependencies(e,n){for(const s in this._tiles)this._tiles[s].hasDependency(e,n)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,n))}_preloadTiles(e,n){const s=new Map,h=Array.isArray(e)?e:[e],g=this.map.painter.terrain,y=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const w of h){const T=w.coveringTiles({tileSize:y,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of T)s.set(D.key,D);this.usedForTerrain&&w.updateElevation(!1)}dn(Array.from(s.values()),(w,T)=>{const D=new af(w,this._source.tileSize*w.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(D,k=>{"raster-dem"===this._source.type&&D.dem&&this._backfillDEM(D),T(k,D)})},n)}}function bg(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||s-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function uf(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function hf(t,e){const n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}wc.maxOverzooming=10,wc.maxUnderzooming=3;class Fp{constructor(e,n,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=s}static create(e,n,s){const h=s||e.findDEMTileFor(n);if(!h||!h.dem)return;const g=h.dem,y=h.tileID,w=1<<n.canonical.z-y.canonical.z;return new Fp(h,h.tileSize/Wn/w,[(n.canonical.x/w-y.canonical.x)*g.dim,(n.canonical.y/w-y.canonical.y)*g.dim])}tileCoordToPixel(e,n){const s=n*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),g=Math.floor(s);return new dt(h,g)}getElevationAt(e,n,s,h){const g=e*this._scale+this._offset[0],y=n*this._scale+this._offset[1],w=Math.floor(g),T=Math.floor(y),D=this._dem;return h=!!h,s?fr(fr(D.get(w,T,h),D.get(w,T+1,h),y-T),fr(D.get(w+1,T,h),D.get(w+1,T+1,h),y-T),g-w):D.get(w,T,h)}getElevationAtPixel(e,n,s){return this._dem.get(e,n,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Cl(1,e)*this._dem.stride}}class Eg{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new ko(Wn,16,0),this.featureIndexArray=new Da,this.promoteId=n}insert(e,n,s,h,g,y=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,h,g,y);const T=this.grid;for(let D=0;D<n.length;D++){const k=n[D],O=[1/0,1/0,-1/0,-1/0];for(let B=0;B<k.length;B++){const V=k[B];O[0]=Math.min(O[0],V.x),O[1]=Math.min(O[1],V.y),O[2]=Math.max(O[2],V.x),O[3]=Math.max(O[3],V.y)}O[0]<Wn&&O[1]<Wn&&O[2]>=0&&O[3]>=0&&T.insert(w,O[0],O[1],O[2],O[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new kd(new Lh(this.rawTileData)).layers,this.sourceLayerCoder=new mg(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,s,h){this.loadVTLayers();const g=e.params||{},y=Pl(g.filter),w=e.tileResult,T=e.transform,D=w.bufferedTilespaceBounds,k=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(G,J,he,ve)=>Sd(w.bufferedTilespaceGeometry,G,J,he,ve));k.sort(Dg);let O=null;T.elevation&&k.length>0&&(O=Fp.create(T.elevation,this.tileID));const B={};let V;for(let G=0;G<k.length;G++){const J=k[G];if(J===V)continue;V=J;const he=this.featureIndexArray.get(J);let ve=null;this.loadMatchingFeature(B,he,y,g.layers,g.availableImages,n,s,h,(Ie,ye,Ce,ke=0)=>(ve||(ve=Zl(Ie,this.tileID.canonical,e.tileTransform)),ye.queryIntersectsFeature(w,Ie,Ce,ve,this.z,e.transform,e.pixelPosMatrix,O,ke)))}return B}loadMatchingFeature(e,n,s,h,g,y,w,T,D){const{featureIndex:k,bucketIndex:O,sourceLayerIndex:B,layoutVertexArrayOffset:V}=n,G=this.bucketLayerIDs[O];if(h&&!function(Ie,ye){for(let Ce=0;Ce<Ie.length;Ce++)if(ye.indexOf(Ie[Ce])>=0)return!0;return!1}(h,G))return;const J=this.sourceLayerCoder.decode(B),he=this.vtLayers[J].feature(k);if(s.needGeometry){const Ie=Oc(he,!0);if(!s.filter(new qe(this.tileID.overscaledZ),Ie,this.tileID.canonical))return}else if(!s.filter(new qe(this.tileID.overscaledZ),he))return;const ve=this.getId(he,J);for(let Ie=0;Ie<G.length;Ie++){const ye=G[Ie];if(h&&h.indexOf(ye)<0)continue;const Ce=y[ye];if(!Ce)continue;let ke={};void 0!==ve&&T&&(ke=T.getState(Ce.sourceLayer||"_geojsonTileLayer",ve));const Pe=$e({},w[ye]);Pe.paint=Tg(Pe.paint,Ce.paint,he,ke,g),Pe.layout=Tg(Pe.layout,Ce.layout,he,ke,g);const et=!D||D(he,Ce,ke,V);if(!et)continue;const Xe=new sf(he,this.z,this.x,this.y,ve);Xe.layer=Pe;let pt=e[ye];void 0===pt&&(pt=e[ye]=[]),pt.push({featureIndex:k,feature:Xe,intersectionZ:et})}}lookupSymbolFeatures(e,n,s,h,g,y,w,T){const D={};this.loadVTLayers();const k=Pl(g);for(const O of e)this.loadMatchingFeature(D,{bucketIndex:s,sourceLayerIndex:h,featureIndex:O,layoutVertexArrayOffset:0},k,y,w,T,n);return D}loadFeature(e){const{featureIndex:n,sourceLayerIndex:s}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(s),g=this.vtFeatures[h];if(g[n])return g[n];const y=this.vtLayers[h].feature(n);return g[n]=y,y}hasLayer(e){for(const n of this.bucketLayerIDs)for(const s of n)if(e===s)return!0;return!1}getId(e,n){let s=e.id;if(this.promoteId){const h="string"==typeof this.promoteId?this.promoteId:this.promoteId[n];null!=h&&(s=e.properties[h]),"boolean"==typeof s&&(s=Number(s))}return s}}function Tg(t,e,n,s,h){return Mn(t,(g,y)=>{const w=e instanceof Ye?e.get(y):null;return w&&w.evaluate?w.evaluate(n,s,h):w})}function Dg(t,e){return e-t}yn(Eg,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Cg{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new Xl({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const s=this.getKey(e,n);return this.positions[s]}trim(){const e=this.width,n=this.height=Dt(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,s){const h=[];let g=e.length%2==1?-e[e.length-1]*s:0,y=e[0]*s,w=!0;h.push({left:g,right:y,isDash:w,zeroLength:0===e[0]});let T=e[0];for(let D=1;D<e.length;D++){w=!w;const k=e[D];g=T*s,T+=k,y=T*s,h.push({left:g,right:y,isDash:w,zeroLength:0===k})}return h}addRoundDash(e,n,s){const h=n/2;for(let g=-s;g<=s;g++){const y=this.width*(this.nextRow+s+g);let w=0,T=e[w];for(let D=0;D<this.width;D++){D/T.right>1&&(T=e[++w]);const k=Math.abs(D-T.left),O=Math.abs(D-T.right),B=Math.min(k,O);let V;const G=g/s*(h+1);if(T.isDash){const J=h-Math.abs(G);V=Math.sqrt(B*B+J*J)}else V=h-Math.sqrt(B*B+G*G);this.image.data[y+D]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(e,n){for(let T=e.length-1;T>=0;--T){const D=e[T],k=e[T+1];D.zeroLength?e.splice(T,1):k&&k.isDash===D.isDash&&(k.left=D.left,e.splice(T,1))}const s=e[0],h=e[e.length-1];s.isDash===h.isDash&&(s.left=h.left-this.width,h.right=s.right+this.width);const g=this.width*this.nextRow;let y=0,w=e[y];for(let T=0;T<this.width;T++){T/w.right>1&&(w=e[++y]);const D=Math.abs(T-w.left),k=Math.abs(T-w.right),O=Math.min(D,k);this.image.data[g+T]=Math.max(0,Math.min(255,(w.isDash?O:-O)+n+128))}}addDash(e,n){const s=this.getKey(e,n);if(this.positions[s])return this.positions[s];const h="round"===n,g=h?7:0,y=2*g+1;if(this.nextRow+y>this.height)return cr("LineAtlas out of space"),null;0===e.length&&e.push(1);let w=0;for(let k=0;k<e.length;k++)e[k]<0&&(cr("Negative value is found in line dasharray, replacing values with 0"),e[k]=0),w+=e[k];if(0!==w){const k=this.width/w,O=this.getDashRanges(e,this.width,k);h?this.addRoundDash(O,k,g):this.addRegularDash(O,"square"===n?.5*k:0)}const T=this.nextRow+g;this.nextRow+=y;const D={tl:[T,g],br:[w,0]};return this.positions[s]=D,D}}yn(Cg,"LineAtlas");class is{constructor(e){const n={},s=[];for(const w in e){const T=e[w],D=n[w]={};for(const k in T.glyphs){const O=T.glyphs[+k];if(!O||0===O.bitmap.width||0===O.bitmap.height)continue;const B=O.metrics.localGlyph?2:1,V={x:0,y:0,w:O.bitmap.width+2*B,h:O.bitmap.height+2*B};s.push(V),D[k]=V}}const{w:h,h:g}=mp(s),y=new Xl({width:h||1,height:g||1});for(const w in e){const T=e[w];for(const D in T.glyphs){const k=T.glyphs[+D];if(!k||0===k.bitmap.width||0===k.bitmap.height)continue;const O=n[w][D],B=k.metrics.localGlyph?2:1;Xl.copy(k.bitmap,y,{x:0,y:0},{x:O.x+B,y:O.y+B},k.bitmap)}}this.image=y,this.positions=n}}yn(is,"GlyphAtlas");class Sg{constructor(e){this.tileID=new sa(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Wu(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,n,s,h,g){this.status="parsing",this.data=e,this.collisionBoxArray=new nd;const y=new mg(Object.keys(e.layers).sort()),w=new Eg(this.tileID,this.promoteId);w.bucketLayerIDs=[];const T={},D=new Cg(256,256),k={featureIndex:w,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:D,availableImages:s},O=n.familiesBySource[this.source];for(const ke in O){const Pe=e.layers[ke];if(!Pe)continue;let et=!1,Xe=!1;for(const it of O[ke])"symbol"===it[0].type?et=!0:Xe=!0;if(!0===this.isSymbolTile&&!et||!1===this.isSymbolTile&&!Xe)continue;1===Pe.version&&cr(`Vector tile source "${this.source}" layer "${ke}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const pt=y.encode(ke),Vt=[];for(let it=0;it<Pe.length;it++){const xt=Pe.feature(it),Tt=w.getId(xt,ke);Vt.push({feature:xt,id:Tt,index:it,sourceLayerIndex:pt})}for(const it of O[ke]){const xt=it[0];void 0!==this.isSymbolTile&&"symbol"===xt.type!==this.isSymbolTile||xt.minzoom&&this.zoom<Math.floor(xt.minzoom)||xt.maxzoom&&this.zoom>=xt.maxzoom||"none"!==xt.visibility&&(zp(it,this.zoom,s),(T[xt.id]=xt.createBucket({index:w.bucketLayerIDs.length,layers:it,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:pt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(Vt,k,this.tileID.canonical,this.tileTransform),w.bucketLayerIDs.push(it.map(Tt=>Tt.id)))}}let B,V,G,J;D.trim();const he={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ve=Mn(k.glyphDependencies,ke=>Object.keys(ke).map(Number));Object.keys(ve).length?h.send("getGlyphs",{uid:this.uid,stacks:ve},(ke,Pe)=>{B||(B=ke,V=Pe,Ce.call(this))},void 0,!1,he):V={};const Ie=Object.keys(k.iconDependencies);Ie.length?h.send("getImages",{icons:Ie,source:this.source,tileID:this.tileID,type:"icons"},(ke,Pe)=>{B||(B=ke,G=Pe,Ce.call(this))},void 0,!1,he):G={};const ye=Object.keys(k.patternDependencies);function Ce(){if(B)return g(B);if(V&&G&&J){const ke=new is(V),Pe=new Nd(G,J);for(const et in T){const Xe=T[et];Xe instanceof yc?(zp(Xe.layers,this.zoom,s),ny(Xe,V,ke.positions,G,Pe.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):Xe.hasPattern&&(Xe instanceof sp||Xe instanceof Oa||Xe instanceof ou)&&(zp(Xe.layers,this.zoom,s),Xe.addFeatures(k,this.tileID.canonical,Pe.patternPositions,s,this.tileTransform))}this.status="done",g(null,{buckets:ot(T).filter(et=>!et.isEmpty()),featureIndex:w,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:ke.image,lineAtlas:D,imageAtlas:Pe,glyphMap:this.returnDependencies?V:null,iconMap:this.returnDependencies?G:null,glyphPositions:this.returnDependencies?ke.positions:null})}}ye.length?h.send("getImages",{icons:ye,source:this.source,tileID:this.tileID,type:"patterns"},(ke,Pe)=>{B||(B=ke,J=Pe,Ce.call(this))},void 0,!1,he):J={},Ce.call(this)}}function zp(t,e,n){const s=new qe(e);for(const h of t)h.recalculate(s,n)}class Mg{constructor(e){this.entries={},this.scheduler=e}request(e,n,s,h){const g=this.entries[e]=this.entries[e]||{callbacks:[]};if(g.result){const[y,w]=g.result;return this.scheduler?this.scheduler.add(()=>{h(y,w)},n):h(y,w),()=>{}}return g.callbacks.push(h),g.cancel||(g.cancel=s((y,w)=>{g.result=[y,w];for(const T of g.callbacks)this.scheduler?this.scheduler.add(()=>{T(y,w)},n):T(y,w);setTimeout(()=>delete this.entries[e],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(y=>y!==h),g.callbacks.length||(g.cancel(),delete this.entries[e]))}}}function Bp(t,e,n){const s=JSON.stringify(t.request);return t.data&&(this.deduped.entries[s]={result:[null,t.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},h=>{const g=tr(t.request,(y,w,T,D)=>{y?h(y):w&&h(null,{vectorTile:n?void 0:new kd(new Lh(w)),rawData:w,cacheControl:T,expires:D})});return()=>{g.cancel(),h()}},e)}c.ARRAY_TYPE=Ca,c.AUTH_ERR_MSG=xr,c.Aabb=oa,c.Actor=class{constructor(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},hr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Kr()?t:Le,this.scheduler=new Cp}send(t,e,n,s,h=!1,g){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=g,this.callbacks[y]=n);const w=Rr(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:t,hasCallback:!!n,targetMapId:s,mustQueue:h,sourceMapId:this.mapId,data:Qs(e,w)},w),{cancel:()=>{n&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(t){const e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const s=this.cancelCallbacks[n];delete this.cancelCallbacks[n],s&&s.cancel()}else if(e.mustQueue||Kr()){const s=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),s&&s.metadata||{type:"message"})}else this.processTask(n,e)}processTask(t,e){if("<response>"===e.type){const n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(Ra(e.error)):n(null,Ra(e.data)))}else{const n=Rr(this.globalScope)?void 0:[],s=e.hasCallback?(g,y)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:g?Qs(g):null,data:Qs(y,n)},n)}:g=>{},h=Ra(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,h,s);else if(this.parent.getWorkerSource){const g=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,g[0],h.source)[g[1]](h,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},c.CanonicalTileID=Ih,c.Color=Hr,c.ColorMode=tc,c.CullFaceMode=Gs,c.DEMData=Zh,c.DataConstantProperty=He,c.DedupedRequest=Mg,c.DepthMode=vu,c.EXTENT=Wn,c.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const n=e.getSource().maxzoom,s=1<<n,h=Math.floor(t.x),g=Math.floor((t.x-h)*s),y=Math.floor(t.y*s),w=this.findDEMTileFor(new sa(n,h,n,g,y));return!(!w||!w.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const s=this._source();if(!s||t.y<0||t.y>1)return e;const h=s.getSource().maxzoom,g=1<<h,y=Math.floor(t.x),w=t.x-y,T=new sa(h,y,h,Math.floor(w*g),Math.floor(t.y*g)),D=this.findDEMTileFor(T);if(!D||!D.dem)return e;const k=D.dem,O=1<<D.tileID.canonical.z,B=(w*O-D.tileID.canonical.x)*k.dim,V=(t.y*O-D.tileID.canonical.y)*k.dim,G=Math.floor(B),J=Math.floor(V);return(n?this.exaggeration():1)*fr(fr(k.get(G,J),k.get(G,J+1),V-J),fr(k.get(G+1,J),k.get(G+1,J+1),V-J),B-G)}getAtTileOffset(t,e,n){const s=1<<t.canonical.z;return this.getAtPointOrZero(new Pu(t.wrap+(t.canonical.x+e/Wn)/s,(t.canonical.y+n/Wn)/s))}getAtTileOffsetFunc(t,e,n,s){return h=>{const g=this.getAtTileOffset(t,h.x,h.y),y=s.upVector(t.canonical,h.x,h.y);return ka(y,y,g*s.upVectorScale(t.canonical,e,n).metersToTile),y}}getForTilePoints(t,e,n,s){if(this.isUsingMockSource())return!1;const h=Fp.create(this,t,s);return!!h&&(e.forEach(g=>{g[2]=this.exaggeration()*h.getElevationAt(g[0],g[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const n=e.dem.tree,s=e.tileID,h=1<<t.canonical.z-s.canonical.z;let g=t.canonical.x/h-s.canonical.x,y=t.canonical.y/h-s.canonical.y,w=0;for(let T=0;T<t.canonical.z-s.canonical.z&&!n.leaves[w];T++){g*=2,y*=2;const D=2*Math.floor(y)+Math.floor(g);w=n.childOffsets[w]+D,g%=1,y%=1}return{min:this.exaggeration()*n.minimums[w],max:this.exaggeration()*n.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},c.ErrorEvent=Xo,c.EvaluationParameters=qe,c.Event=Cr,c.Evented=ki,c.FillExtrusionBucket=ou,c.Frustum=Lf,c.FrustumCorners=kf,c.GLOBE_RADIUS=$s,c.GLOBE_SCALE_MATCH_LATITUDE=45,c.GLOBE_ZOOM_THRESHOLD_MAX=6,c.GLOBE_ZOOM_THRESHOLD_MIN=5,c.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_fillGridMeshWithLods(t,e){const n=new Fn,s=new Ss,h=[],g=t+1+2,y=e[0]+1,w=e[0]+1+(1+e.length),T=(D,k,O)=>{let B=D===g-1?D-2:0===D?D:D-1;return B+=O?24575:0,[B,k]};for(let D=0;D<g;++D)n.emplaceBack(...T(D,0,!0));for(let D=0;D<y;++D)for(let k=0;k<g;++k)n.emplaceBack(...T(k,D,(0===k||k===g-1)&&!0));for(let D=0;D<e.length;++D){const k=e[D];for(let O=0;O<g;++O)n.emplaceBack(...T(O,k,!0))}for(let D=0;D<e.length;++D){const k=s.length,O=e[D]+1+2,B=new Ss;for(let J=0;J<O-1;J++){const he=J===O-2,ve=he?g*(w-e.length+D-J):g;for(let Ie=0;Ie<g-1;Ie++){const ye=J*g+Ie;0===J||he||0===Ie||Ie===g-2?(B.emplaceBack(ye+1,ye,ye+ve),B.emplaceBack(ye+ve,ye+ve+1,ye+1)):(s.emplaceBack(ye+1,ye,ye+ve),s.emplaceBack(ye+ve,ye+ve+1,ye+1))}}const V=yo.simpleSegment(0,k,n.length,s.length-k);for(let J=0;J<B.uint16.length;J+=3)s.emplaceBack(B.uint16[J],B.uint16[J+1],B.uint16[J+2]);const G=yo.simpleSegment(0,k,n.length,s.length-k);h.push({withoutSkirts:V,withSkirts:G})}return{vertices:n,indices:s,segments:h}}_createGrid(t){const e=this._fillGridMeshWithLods(64,_h);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,gh.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new Ss;for(let h=0;h<=64;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const n=new Ta,s=new Ta;this._poleSegments=[];for(let h=0,g=0;h<5;h++){const y=360/(1<<h);n.emplaceBack(0,-$s,0,.5,0),s.emplaceBack(0,-$s,0,.5,1);for(let w=0;w<=64;w++){const T=w/64,D=fr(0,y,T),[k,O,B]=eu(i_,o_,D,$s);n.emplaceBack(k,O,B,T,0),s.emplaceBack(k,O,B,T,1)}this._poleSegments.push(yo.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,Af,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(s,Af,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const n=new ys,s=64,h=s+1+2,g=1;this._wireframeSegments=[];for(let y=0,w=0;y<_h.length;y++){const T=_h[y];for(let k=g;k<T+g;k++)for(let O=g;O<s+g;O++){const B=k*h+O;n.emplaceBack(B,B+1),n.emplaceBack(B,B+h),n.emplaceBack(B,B+h+1)}const D=T*s*3;this._wireframeSegments.push(yo.simpleSegment(0,w,(T+1)*h,D)),w+=D}this._wireframeIndexBuffer=t.createIndexBuffer(n)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},c.GlyphManager=Hu,c.ImagePosition=al,c.LivePerformanceUtils=Ue,c.LngLat=qr,c.LngLatBounds=Pc,c.LocalGlyphMode=Ep,c.MAX_MERCATOR_LATITUDE=Ms,c.MercatorCoordinate=Pu,c.ONE_EM=rs,c.OverscaledTileID=sa,c.PerformanceMarkers=_e,c.Properties=Nt,c.RGBAImage=La,c.Ray=Rf,c.RequestManager=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",cn,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!Ui(t))return t;const n=Ne(t);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!Ui(t))return t;const n=Ne(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,s){if(!Ui(t))return t;const h=Ne(t);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),n&&h.params.push(`language=${n}`),s&&h.params.push(`worldview=${s}`),this._makeAPIURL(h,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,s){const h=Ne(t);return Ui(t)?(h.path=`/styles/v1${h.path}/sprite${e}${n}`,this._makeAPIURL(h,this._customAccessToken||s)):(h.path+=`${e}${n}`,Rt(h))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!Ui(t))return t;const s=Ne(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&"raster"!==s.authority&&512===n?"@2x":""}${wt.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${zt.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${zt.TILE_URL_VERSION}${s.path}`);const h=this._customAccessToken||function(g){for(const y of g){const w=y.match(/^access_token=(.*)$/);if(w)return w[1]}return null}(s.params)||zt.ACCESS_TOKEN;return zt.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,h)}canonicalizeTileURL(t,e){const n=Ne(t);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let s="mapbox://";n.path.match(/^\/raster\/v1\//)?s+=`raster/${n.path.replace(`/${zt.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${n.path.replace(`/${zt.TILE_URL_VERSION}/`,"")}`;let h=n.params;return e&&(h=h.filter(g=>!g.match(/^access_token=/))),h.length&&(s+=`?${h.join("&")}`),s}canonicalizeTileset(t,e){const n=!!e&&Ui(e),s=[];for(const h of t.tiles||[])Rn(h)?s.push(this.canonicalizeTileURL(h,n)):s.push(h);return s}_makeAPIURL(t,e){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=Ne(zt.API_URL);if(t.protocol=s.protocol,t.authority=s.authority,"http"===t.protocol){const h=t.params.indexOf("secure");h>=0&&t.params.splice(h,1)}if("/"!==s.path&&(t.path=`${s.path}${t.path}`),!zt.REQUIRE_ACCESS_TOKEN)return Rt(t);if(e=e||zt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(h=>-1===h.indexOf("access_token")),t.params.push(`access_token=${e||""}`),Rt(t)}},c.ResourceType=un,c.SegmentVector=yo,c.SourceCache=wc,c.StencilMode=ec,c.StructArrayLayout1ui2=Vl,c.StructArrayLayout2f1f2i16=js,c.StructArrayLayout2i4=Fn,c.StructArrayLayout2ui4=ys,c.StructArrayLayout3f12=Vs,c.StructArrayLayout3ui6=Ss,c.StructArrayLayout4i8=ci,c.StructArrayLayout5f20=Ta,c.Texture=Vc,c.Tile=af,c.Transitionable=Ht,c.Uniform1f=ld,c.Uniform1i=class extends hc{constructor(t){super(t),this.current=0}set(t,e,n){this.fetchUniformLocation(t,e)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},c.Uniform2f=class extends hc{constructor(t){super(t),this.current=[0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}},c.Uniform3f=class extends hc{constructor(t){super(t),this.current=[0,0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}},c.Uniform4f=cd,c.UniformColor=ud,c.UniformMatrix2f=class extends hc{constructor(t){super(t),this.current=Zg}set(t,e,n){if(this.fetchUniformLocation(t,e))for(let s=0;s<4;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}},c.UniformMatrix3f=class extends hc{constructor(t){super(t),this.current=lh}set(t,e,n){if(this.fetchUniformLocation(t,e))for(let s=0;s<9;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},c.UniformMatrix4f=class extends hc{constructor(t){super(t),this.current=Wg}set(t,e,n){if(this.fetchUniformLocation(t,e)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let s=1;s<16;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}},c.UnwrappedTileID=Ah,c.ValidationError=_t,c.VectorTileFeature=Ld,c.VectorTileWorkerSource=class extends ki{constructor(t,e,n,s,h){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=h||Bp,this.loading={},this.loaded={},this.deduped=new Mg(t.scheduler),this.isSpriteLoaded=s,this.scheduler=t.scheduler}loadTile(t,e){const n=t.uid,s=t&&t.request,h=s&&s.collectResourceTiming,g=this.loading[n]=new Sg(t);g.abort=this.loadVectorData(t,(y,w)=>{const T=!this.loading[n];if(delete this.loading[n],T||y||!w)return g.status="done",T||(this.loaded[n]=g),e(y);const D=w.rawData,k={};w.expires&&(k.expires=w.expires),w.cacheControl&&(k.cacheControl=w.cacheControl),g.vectorTile=w.vectorTile||new kd(new Lh(D));const O=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,(B,V)=>{if(B||!V)return e(B);const G={};if(h){const J=kt(s);J.length>0&&(G.resourceTiming=JSON.parse(JSON.stringify(J)))}e(null,$e({rawTileData:D.slice(0)},V,k,G))})};this.isSpriteLoaded?O():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(O,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):O()}),this.loaded=this.loaded||{},this.loaded[n]=g})}reloadTile(t,e){const n=this.loaded,s=t.uid,h=this;if(n&&n[s]){const g=n[s];g.showCollisionBoxes=t.showCollisionBoxes,g.enableTerrain=!!t.enableTerrain,g.projection=t.projection,g.tileTransform=Wu(t.tileID.canonical,t.projection);const y=(w,T)=>{const D=g.reloadCallback;D&&(delete g.reloadCallback,g.parse(g.vectorTile,h.layerIndex,this.availableImages,h.actor,D)),e(w,T)};"parsing"===g.status?g.reloadCallback=y:"done"===g.status&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,y):y())}}abortTile(t,e){const n=t.uid,s=this.loading[n];s&&(s.abort&&s.abort(),delete this.loading[n]),e()}removeTile(t,e){const n=this.loaded,s=t.uid;n&&n[s]&&delete n[s],e()}},c.WritingMode=Ha,c.ZoomDependentExpression=Ot,c.add=bl,c.addDynamicAttributes=qh,c.adjoint=function(t,e){var n=e[0],s=e[1],h=e[2],g=e[3],y=e[4],w=e[5],T=e[6],D=e[7],k=e[8];return t[0]=y*k-w*D,t[1]=h*D-s*k,t[2]=s*w-h*y,t[3]=w*T-g*k,t[4]=n*k-h*T,t[5]=h*g-n*w,t[6]=g*D-y*T,t[7]=s*T-n*D,t[8]=n*y-s*g,t},c.asyncAll=dn,c.bezier=Wt,c.bindAll=hr,c.boundsAttributes=gg,c.bufferConvexPolygon=function(t,e){const n=[];for(let s=0;s<t.length;s++){const h=vn(s-1,-1,t.length-1),g=vn(s+1,-1,t.length-1),y=t[s],w=t[g],T=t[h].sub(y).unit(),D=w.sub(y).unit(),k=D.angleWithSep(T.x,T.y),O=T.add(D).unit().mult(-1*e/Math.sin(k/2));n.push(y.add(O))}return n},c.cacheEntryPossiblyAdded=function(t){Er++,Er>zo&&(t.getActor().send("enforceCacheSizeLimit",di),Er=0)},c.calculateGlobeLabelMatrix=function(t,e){const{x:n,y:s}=t.point,h=r_(n,s,t.worldSize/t._pixelsPerMercatorPixel,0,0);return Kc(h,h,yh(ql(e)))},c.calculateGlobeMatrix=function(t){const{x:e,y:n}=t.point,{lng:s,lat:h}=t._center;return r_(e,n,t.worldSize,s,h)},c.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,n=e/Cl(1,t.center.lat),s=ol(new Float64Array(16));return pd(s,s,[t.point.x,t.point.y,0]),Hl(s,s,[n,n,e]),Float32Array.from(s)},c.circumferenceAtLatitude=wh,c.clamp=ft,c.clearTileCache=function(t){if(!sr())return;const e=Le.caches.delete(xn);t&&e.catch(t).then(()=>t())},c.clipLine=Gu,c.clone=function(t){var e=new Ca(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},c.clone$1=Vn,c.collisionCircleLayout=Vu,c.config=zt,c.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},c.create=function(){var t=new Ca(16);return Ca!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},c.create$1=Tf,c.createExpression=pe,c.createLayout=Sn,c.createStyleLayer=function(t){return"custom"===t.type?new pg(t):new oy[t.type](t)},c.cross=_d,c.degToRad=je,c.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},c.div=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},c.dot=sl,c.earthRadius=Au,c.ease=gt,c.easeCubicInOut=Me,c.ecefToLatLng=function([t,e,n]){const s=Math.hypot(t,e,n),h=Math.atan2(t,n),g=.5*Math.PI-Math.acos(-e/s);return new qr(Kt(h),Kt(g))},c.emitValidationErrors=nl,c.endsWith=vr,c.enforceCacheSizeLimit=function(t){br(),kr&&kr.then(e=>{e.keys().then(n=>{for(let s=0;s<n.length-t;s++)e.delete(n[s])})})},c.evaluateSizeForFeature=au,c.evaluateSizeForZoom=lu,c.evaluateVariableOffset=Zd,c.evented=be,c.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},c.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},c.exported=nr,c.exported$1=wt,c.extend=$e,c.extend$1=Qr,c.fillExtrusionHeightLift=ip,c.filterObject=er,c.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},c.fromQuat=function(t,e){var n=e[0],s=e[1],h=e[2],g=e[3],y=n+n,w=s+s,T=h+h,D=n*y,k=s*y,O=s*w,B=h*y,V=h*w,G=h*T,J=g*y,he=g*w,ve=g*T;return t[0]=1-O-G,t[1]=k+ve,t[2]=B-he,t[3]=0,t[4]=k-ve,t[5]=1-D-G,t[6]=V+J,t[7]=0,t[8]=B+he,t[9]=V-J,t[10]=1-D-O,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},c.fromRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=n,t[2]=0,t[3]=-n,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},c.fromScaling=Cf,c.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return Hn[e]},c.getAABBPointSquareDist=function(t,e,n){let s=0;for(let h=0;h<2;++h){const g=n?n[h]:0;t[h]>g&&(s+=(t[h]-g)*(t[h]-g)),e[h]<g&&(s+=(g-e[h])*(g-e[h]))}return s},c.getAnchorAlignment=$u,c.getAnchorJustification=Tp,c.getBounds=function(t){let e=1/0,n=1/0,s=-1/0,h=-1/0;for(const g of t)e=Math.min(e,g.x),n=Math.min(n,g.y),s=Math.max(s,g.x),h=Math.max(h,g.y);return{min:new dt(e,n),max:new dt(s,h)}},c.getColumn=vi,c.getGridMatrix=function(t,e,n,s){const h=e.getNorth(),g=e.getSouth(),y=e.getWest(),w=e.getEast(),T=1<<t.z,D=w-y,k=h-g,O=D/64,B=-k/_h[n],V=[0,O,0,B,0,0,h,y,0];if(t.z>0){const G=180/s;Rc(V,V,[G/D+1,0,0,0,G/k+1,0,-.5*G/O,.5*G/B,1])}return V[2]=T,V[5]=t.x,V[8]=t.y,V},c.getImage=Bo,c.getJSON=function(t,e){return Jr($e(t,{type:"json"}),e)},c.getLatitudinalLod=function(t){const e=Ms-5;t=ft(t,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(je(t))),3);return Math.round(n*(_h.length-1))},c.getMapSessionAPI=X,c.getPerformanceMeasurement=kt,c.getProjection=yu,c.getRTLTextPluginStatus=Re,c.getReferrer=Lr,c.getTilePoint=function(t,{x:e,y:n},s=0){return new dt(((e-s)*t.scale-t.x)*Wn,(n*t.scale-t.y)*Wn)},c.getTileVec3=function(t,e,n=0){return Yc(((e.x-n)*t.scale-t.x)*Wn,(e.y*t.scale-t.y)*Wn,Uf(e.z,e.y))},c.getVideo=function(t,e){const n=Le.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let s=0;s<t.length;s++){const h=Le.document.createElement("source");ro(t[s])||(n.crossOrigin="Anonymous"),h.src=t[s],n.appendChild(h)}return{cancel:()=>{}}},c.globeCenterToScreenPoint=function(t){const e=[0,0,0],n=ol(new Float64Array(16));return Kc(n,t.pixelMatrix,t.globeMatrix),fo(e,e,n),new dt(e[0],e[1])},c.globeDenormalizeECEF=yh,c.globeECEFOrigin=function(t,e){const n=[0,0,0];return fo(n,n,nu(ql(e.canonical))),fo(n,n,t),n},c.globeMetersToEcef=Of,c.globeNormalizeECEF=nu,c.globePixelsToTileUnits=function(t,e){return Wn/(512*Math.pow(2,t))*zf(ql(e))},c.globePoleMatrixForTile=function(t,e,n){const s=ol(new Float64Array(16)),h=(e/(1<<t)-.5)*Math.PI*2;return ch(s,n.globeMatrix,h),Float32Array.from(s)},c.globeTileBounds=ql,c.globeTiltAtLngLat=Bf,c.globeToMercatorTransition=vh,c.globeUseCustomAntiAliasing=function(t,e,n){const s=vh(n.zoom),h=t.style.map._antialias,g=!!e.extStandardDerivatives,y=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===s&&!h&&!y&&g},c.identity=ol,c.identity$1=If,c.invert=fd,c.isFullscreen=function(){return!!Le.document.fullscreenElement||!!Le.document.webkitFullscreenElement},c.isLngLatBehindGlobe=Nf,c.isMapAuthenticated=function(t){return oe.has(t)},c.isMapboxURL=Ui,c.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!Rr(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},c.latFromMercatorY=vs,c.latLngToECEF=tu,c.len=Qg,c.length=kc,c.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},c.lngFromMercatorX=Ga,c.loadVectorTile=Bp,c.makeRequest=Jr,c.mapValue=function(t,e,n,s,h){return ft((t-e)/(n-e)*(h-s)+s,s,h)},c.mercatorScale=gm,c.mercatorXfromLng=Wl,c.mercatorYfromLat=Hi,c.mercatorZfromAltitude=Cl,c.mul=Mf,c.mul$1=Jg,c.multiply=Kc,c.multiply$1=Rc,c.multiply$2=gd,c.nextPowerOfTwo=Dt,c.normalize=ra,c.normalize$1=hm,c.normalize$2=cm,c.number=fr,c.ortho=function(t,e,n,s,h,g,y){var w=1/(e-n),T=1/(s-h),D=1/(g-y);return t[0]=-2*w,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*T,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*D,t[11]=0,t[12]=(e+n)*w,t[13]=(h+s)*T,t[14]=(y+g)*D,t[15]=1,t},c.pbf=Lh,c.perspective=function(t,e,n,s,h){var g,y=1/Math.tan(e/2);return t[0]=y/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=y,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=h&&h!==1/0?(t[10]=(h+s)*(g=1/(s-h)),t[14]=2*h*s*g):(t[10]=-1,t[14]=-2*s),t},c.pick=function(t,e){const n={};for(let s=0;s<e.length;s++){const h=e[s];h in t&&(n[h]=t[h])}return n},c.plugin=ze,c.pointGeometry=dt,c.polesInViewport=function(t){const e=ol(new Float64Array(16));Kc(e,t.pixelMatrix,t.globeMatrix);const n=[0,Tl,0],s=[0,Dl,0];return fo(n,n,e),fo(s,s,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!Nf(t,new qr(t.center.lat,90)),s[0]>0&&s[0]<=t.width&&s[1]>0&&s[1]<=t.height&&!Nf(t,new qr(t.center.lat,-90))]},c.polygonContainsPoint=iu,c.polygonIntersectsBox=Sd,c.polygonIntersectsPolygon=$f,c.polygonizeBounds=function(t,e,n=0,s=!0){const h=new dt(n,n),g=t.sub(h),y=e.add(h),w=[g,new dt(y.x,g.y),y,new dt(g.x,y.y)];return s&&w.push(g.clone()),w},c.posAttributes=gh,c.postMapLoadEvent=de,c.postPerformanceEvent=ie,c.postTurnstileEvent=q,c.potpack=mp,c.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},c.radToDeg=Kt,c.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],c.registerForPluginStateChange=function(t){return t({pluginStatus:fe,pluginURL:ne}),be.on("pluginStateChange",t),t},c.removeAuthState=function(t){oe.delete(t)},c.renderColorRamp=Tm,c.resample=Vf,c.rotateX=Df,c.rotateX$1=mh,c.rotateY=ch,c.rotateY$1=yd,c.rotateZ=function(t,e,n){var s=Math.sin(n),h=Math.cos(n),g=e[0],y=e[1],w=e[2],T=e[3],D=e[4],k=e[5],O=e[6],B=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=g*h+D*s,t[1]=y*h+k*s,t[2]=w*h+O*s,t[3]=T*h+B*s,t[4]=D*h-g*s,t[5]=k*h-y*s,t[6]=O*h-w*s,t[7]=B*h-T*s,t},c.rotateZ$1=function(t,e,n){n*=.5;var s=e[0],h=e[1],g=e[2],y=e[3],w=Math.sin(n),T=Math.cos(n);return t[0]=s*T+h*w,t[1]=h*T-s*w,t[2]=g*T+y*w,t[3]=y*T-g*w,t},c.scale=Hl,c.scale$1=e_,c.scale$2=ka,c.scaleAndAdd=fh,c.set=function(t,e,n,s){return t[0]=e,t[1]=n,t[2]=s,t},c.setCacheLimits=function(t,e){di=t,zo=e},c.setColumn=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},c.setRTLTextPlugin=function(t,e,n=!1){if(fe===H||fe===ee||fe===re)throw new Error("setRTLTextPlugin cannot be called multiple times.");ne=nr.resolveURL(t),fe=H,ue=e,xe(),n||Ae()},c.smoothstep=fn,c.spec=st,c.squaredLength=function(t){var e=t[0],n=t[1],s=t[2];return e*e+n*n+s*s},c.storeAuthState=function(t,e){e?oe.add(t):oe.delete(t)},c.sub=ia,c.subtract=hh,c.symbolSize=lp,c.tileAABB=function(t,e,n,s,h,g,y,w,T){if("globe"===T.name)return function mc(t,e,n){const s=e/t.worldSize,h=t.globeMatrix;if(n.z<=1){const Xe=ql(n).getCorners();return vd(Xe,h,s),oa.fromPoints(Xe)}const g=Lc(n),y=xd(g);vd(y,h,s);const w=Number.MAX_VALUE,T=[-w,-w,-w],D=[w,w,w];if(g.contains(t.center)){for(const Vt of y)fc(D,D,Vt),dh(T,T,Vt);T[2]=0;const Xe=t.point,pt=[Xe.x*s,Xe.y*s,0];return fc(D,D,pt),dh(T,T,pt),new oa(D,T)}const k=[h[12]*s,h[13]*s,h[14]*s],O=g.getCenter(),B=ft(t.center.lat,-Ms,Ms),V=ft(O.lat,-Ms,Ms),G=Wl(t.center.lng),J=Hi(B);let he=G-Wl(O.lng);const ve=J-Hi(V);he>.5?he-=1:he<-.5&&(he+=1);let Ie=0;Math.abs(he)>Math.abs(ve)?Ie=he>=0?1:3:(Ie=ve>=0?0:2,fh(k,k,[h[4]*s,h[5]*s,h[6]*s],-Math.sin(je(ve>=0?g.getSouth():g.getNorth()))*$s));const ye=y[Ie],Ce=y[(Ie+1)%4],ke=new fm(ye,Ce,k),Pe=[Ff(ke,0)||ye[0],Ff(ke,1)||ye[1],Ff(ke,2)||ye[2]],et=vh(t.zoom);if(et>0){const Xe=function({x:Vt,y:it,z:xt},Tt,Pt,jt,at){const Jt=1/(1<<xt);let Un=Vt*Jt,rn=Un+Jt,bn=it*Jt,Qt=bn+Jt,Gn=0;const Ir=(Un+rn)/2-jt;return Ir>.5?Gn=-1:Ir<-.5&&(Gn=1),Un=((Un+Gn)*Tt-(jt*=Tt))*Pt+jt,rn=((rn+Gn)*Tt-jt)*Pt+jt,bn=(bn*Tt-(at*=Tt))*Pt+at,Qt=(Qt*Tt-at)*Pt+at,[[Un,Qt,0],[rn,Qt,0],[rn,bn,0],[Un,bn,0]]}(n,e,t._pixelsPerMercatorPixel,G,J);for(let Vt=0;Vt<y.length;Vt++)Qc(y[Vt],Xe[Vt],et);const pt=bl([],Xe[Ie],Xe[(Ie+1)%4]);ka(pt,pt,.5),Qc(Pe,pt,et)}for(const Xe of y)fc(D,D,Xe),dh(T,T,Xe);return D[2]=Math.min(ye[2],Ce[2]),fc(D,D,Pe),dh(T,T,Pe),new oa(D,T)}(t,e,new Ih(n,s,h));const D=Wu({z:n,x:s,y:h},T);return new oa([(g+D.x/D.scale)*e,e*(D.y/D.scale),y],[(g+D.x2/D.scale)*e,e*(D.y2/D.scale),w])},c.tileCornersToBounds=Lc,c.tileTransform=Wu,c.transformMat3=function(t,e,n){var s=e[0],h=e[1],g=e[2];return t[0]=s*n[0]+h*n[3]+g*n[6],t[1]=s*n[1]+h*n[4]+g*n[7],t[2]=s*n[2]+h*n[5]+g*n[8],t},c.transformMat4=fo,c.transformMat4$1=pc,c.transformQuat=ph,c.transitionTileAABBinECEF=pm,c.translate=pd,c.transpose=function(t,e){if(t===e){var n=e[1],s=e[2],h=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=s,t[7]=h}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},c.triggerPluginCompletionEvent=we,c.uniqueId=At,c.updateGlobeVertexNormal=function(t,e,n,s,h){const g=5*e+2;t.float32[g+0]=n,t.float32[g+1]=s,t.float32[g+2]=h},c.validateCustomStyleLayer=function(t){const e=[],n=t.id;return void 0===n&&e.push({message:`layers.${n}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},c.validateFilter=t=>Js(Tc(t)),c.validateFog=t=>Js(Fl(t)),c.validateLayer=t=>Js(gl(t)),c.validateLight=t=>Js(ts(t)),c.validateSource=t=>Js(yl(t)),c.validateStyle=vl,c.validateTerrain=t=>Js(Dc(t)),c.values=ot,c.vectorTile=Mh,c.version=en,c.warnOnce=cr,c.window=Le,c.wrap=vn}),ge(0,function(c){function Le(ce){if("number"==typeof ce||"boolean"==typeof ce||"string"==typeof ce||null==ce)return JSON.stringify(ce);if(Array.isArray(ce)){let Y="[";for(const de of ce)Y+=`${Le(de)},`;return`${Y}]`}let q="{";for(const Y of Object.keys(ce).sort())q+=`${Y}:${Le(ce[Y])},`;return`${q}}`}function en(ce){let q="";for(const Y of c.refProperties)q+=`/${Le(ce[Y])}`;return q}class qt{constructor(q){this.keyCache={},q&&this.replace(q)}replace(q){this._layerConfigs={},this._layers={},this.update(q,[])}update(q,Y){for(const Ee of q)this._layerConfigs[Ee.id]=Ee,(this._layers[Ee.id]=c.createStyleLayer(Ee)).compileFilter(),this.keyCache[Ee.id]&&delete this.keyCache[Ee.id];for(const Ee of Y)delete this.keyCache[Ee],delete this._layerConfigs[Ee],delete this._layers[Ee];this.familiesBySource={};const de=function(Ee,ie){const se={};for(let oe=0;oe<Ee.length;oe++){const _e=ie&&ie[Ee[oe].id]||en(Ee[oe]);ie&&(ie[Ee[oe].id]=_e);let Ue=se[_e];Ue||(Ue=se[_e]=[]),Ue.push(Ee[oe])}const X=[];for(const oe in se)X.push(se[oe]);return X}(c.values(this._layerConfigs),this.keyCache);for(const Ee of de){const ie=Ee.map(ct=>this._layers[ct.id]),se=ie[0];if("none"===se.visibility)continue;const X=se.source||"";let oe=this.familiesBySource[X];oe||(oe=this.familiesBySource[X]={});const _e=se.sourceLayer||"_geojsonTileLayer";let Ue=oe[_e];Ue||(Ue=oe[_e]=[]),Ue.push(ie)}}}class zt{loadTile(q,Y){const{uid:de,encoding:Ee,rawImageData:ie,padding:se,buildQuadTree:X}=q,oe=c.window.ImageBitmap&&ie instanceof c.window.ImageBitmap?this.getImageData(ie,se):ie;Y(null,new c.DEMData(de,oe,Ee,se<1,X))}getImageData(q,Y){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(q.width,q.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=q.width,this.offscreenCanvas.height=q.height,this.offscreenCanvasContext.drawImage(q,0,0,q.width,q.height);const de=this.offscreenCanvasContext.getImageData(-Y,-Y,q.width+2*Y,q.height+2*Y);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),de}}var wt=function ce(q,Y){var de,Ee=q&&q.type;if("FeatureCollection"===Ee)for(de=0;de<q.features.length;de++)ce(q.features[de],Y);else if("GeometryCollection"===Ee)for(de=0;de<q.geometries.length;de++)ce(q.geometries[de],Y);else if("Feature"===Ee)ce(q.geometry,Y);else if("Polygon"===Ee)Et(q.coordinates,Y);else if("MultiPolygon"===Ee)for(de=0;de<q.coordinates.length;de++)Et(q.coordinates[de],Y);return q};function Et(ce,q){if(0!==ce.length){mt(ce[0],q);for(var Y=1;Y<ce.length;Y++)mt(ce[Y],!q)}}function mt(ce,q){for(var Y=0,de=0,Ee=0,ie=ce.length,se=ie-1;Ee<ie;se=Ee++){var X=(ce[Ee][0]-ce[se][0])*(ce[se][1]+ce[Ee][1]),oe=Y+X;de+=Math.abs(Y)>=Math.abs(X)?Y-oe+X:X-oe+Y,Y=oe}Y+de>=0!=!!q&&ce.reverse()}const Zt=c.VectorTileFeature.prototype.toGeoJSON;class Pn{constructor(q){this._feature=q,this.extent=c.EXTENT,this.type=q.type,this.properties=q.tags,"id"in q&&!isNaN(q.id)&&(this.id=parseInt(q.id,10))}loadGeometry(){if(1===this._feature.type){const q=[];for(const Y of this._feature.geometry)q.push([new c.pointGeometry(Y[0],Y[1])]);return q}{const q=[];for(const Y of this._feature.geometry){const de=[];for(const Ee of Y)de.push(new c.pointGeometry(Ee[0],Ee[1]));q.push(de)}return q}}toGeoJSON(q,Y,de){return Zt.call(this,q,Y,de)}}class Ut{constructor(q){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.EXTENT,this.length=q.length,this._features=q}feature(q){return new Pn(this._features[q])}}var cn={},In={get exports(){return cn},set exports(ce){cn=ce}},Xn=c.pointGeometry,dt=c.vectorTile.VectorTileFeature,yr=sn;function sn(ce,q){this.options=q||{},this.features=ce,this.length=ce.length}function Bt(ce,q){this.id="number"==typeof ce.id?ce.id:void 0,this.type=ce.type,this.rawGeometry=1===ce.type?[ce.geometry]:ce.geometry,this.properties=ce.tags,this.extent=q||4096}sn.prototype.feature=function(ce){return new Bt(this.features[ce],this.options.extent)},Bt.prototype.loadGeometry=function(){var ce=this.rawGeometry;this.geometry=[];for(var q=0;q<ce.length;q++){for(var Y=ce[q],de=[],Ee=0;Ee<Y.length;Ee++)de.push(new Xn(Y[Ee][0],Y[Ee][1]));this.geometry.push(de)}return this.geometry},Bt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ce=this.geometry,q=1/0,Y=-1/0,de=1/0,Ee=-1/0,ie=0;ie<ce.length;ie++)for(var se=ce[ie],X=0;X<se.length;X++){var oe=se[X];q=Math.min(q,oe.x),Y=Math.max(Y,oe.x),de=Math.min(de,oe.y),Ee=Math.max(Ee,oe.y)}return[q,de,Y,Ee]},Bt.prototype.toGeoJSON=dt.prototype.toGeoJSON;var je=c.pbf,Kt=yr;function Hn(ce){var q=new je;return function(Y,de){for(var Ee in Y.layers)de.writeMessage(3,Me,Y.layers[Ee])}(ce,q),q.finish()}function Me(ce,q){var Y;q.writeVarintField(15,ce.version||1),q.writeStringField(1,ce.name||""),q.writeVarintField(5,ce.extent||4096);var de={keys:[],values:[],keycache:{},valuecache:{}};for(Y=0;Y<ce.length;Y++)de.feature=ce.feature(Y),q.writeMessage(2,Wt,de);var Ee=de.keys;for(Y=0;Y<Ee.length;Y++)q.writeStringField(3,Ee[Y]);var ie=de.values;for(Y=0;Y<ie.length;Y++)q.writeMessage(4,dn,ie[Y])}function Wt(ce,q){var Y=ce.feature;void 0!==Y.id&&q.writeVarintField(1,Y.id),q.writeMessage(2,gt,ce),q.writeVarintField(3,Y.type),q.writeMessage(4,vn,Y)}function gt(ce,q){var Y=ce.feature,de=ce.keys,Ee=ce.values,ie=ce.keycache,se=ce.valuecache;for(var X in Y.properties){var oe=Y.properties[X],_e=ie[X];if(null!==oe){void 0===_e&&(de.push(X),ie[X]=_e=de.length-1),q.writeVarint(_e);var Ue=typeof oe;"string"!==Ue&&"boolean"!==Ue&&"number"!==Ue&&(oe=JSON.stringify(oe));var ct=Ue+":"+oe,lt=se[ct];void 0===lt&&(Ee.push(oe),se[ct]=lt=Ee.length-1),q.writeVarint(lt)}}}function ft(ce,q){return(q<<3)+(7&ce)}function fn(ce){return ce<<1^ce>>31}function vn(ce,q){for(var Y=ce.loadGeometry(),de=ce.type,Ee=0,ie=0,se=Y.length,X=0;X<se;X++){var oe=Y[X],_e=1;1===de&&(_e=oe.length),q.writeVarint(ft(1,_e));for(var Ue=3===de?oe.length-1:oe.length,ct=0;ct<Ue;ct++){1===ct&&1!==de&&q.writeVarint(ft(2,Ue-1));var lt=oe[ct].x-Ee,kt=oe[ct].y-ie;q.writeVarint(fn(lt)),q.writeVarint(fn(kt)),Ee+=lt,ie+=kt}3===de&&q.writeVarint(ft(7,1))}}function dn(ce,q){var Y=typeof ce;"string"===Y?q.writeStringField(1,ce):"boolean"===Y?q.writeBooleanField(7,ce):"number"===Y&&(ce%1!=0?q.writeDoubleField(3,ce):ce<0?q.writeSVarintField(6,ce):q.writeVarintField(5,ce))}function ot(ce,q,Y,de,Ee,ie){if(Ee-de<=Y)return;const se=de+Ee>>1;$e(ce,q,se,de,Ee,ie%2),ot(ce,q,Y,de,se-1,ie+1),ot(ce,q,Y,se+1,Ee,ie+1)}function $e(ce,q,Y,de,Ee,ie){for(;Ee>de;){if(Ee-de>600){const _e=Ee-de+1,Ue=Y-de+1,ct=Math.log(_e),lt=.5*Math.exp(2*ct/3),kt=.5*Math.sqrt(ct*lt*(_e-lt)/_e)*(Ue-_e/2<0?-1:1);$e(ce,q,Y,Math.max(de,Math.floor(Y-Ue*lt/_e+kt)),Math.min(Ee,Math.floor(Y+(_e-Ue)*lt/_e+kt)),ie)}const se=q[2*Y+ie];let X=de,oe=Ee;for(yt(ce,q,de,Y),q[2*Ee+ie]>se&&yt(ce,q,de,Ee);X<oe;){for(yt(ce,q,X,oe),X++,oe--;q[2*X+ie]<se;)X++;for(;q[2*oe+ie]>se;)oe--}q[2*de+ie]===se?yt(ce,q,de,oe):(oe++,yt(ce,q,oe,Ee)),oe<=Y&&(de=oe+1),Y<=oe&&(Ee=oe-1)}}function yt(ce,q,Y,de){At(ce,Y,de),At(q,2*Y,2*de),At(q,2*Y+1,2*de+1)}function At(ce,q,Y){const de=ce[q];ce[q]=ce[Y],ce[Y]=de}function Yt(ce,q,Y,de){const Ee=ce-Y,ie=q-de;return Ee*Ee+ie*ie}In.exports=Hn,cn.fromVectorTileJs=Hn,cn.fromGeojsonVt=function(ce,q){q=q||{};var Y={};for(var de in ce)Y[de]=new Kt(ce[de].features,q),Y[de].name=de,Y[de].version=q.version,Y[de].extent=q.extent;return Hn({layers:Y})},cn.GeoJSONWrapper=Kt;const Dt=ce=>ce[0],an=ce=>ce[1];class hr{constructor(q,Y=Dt,de=an,Ee=64,ie=Float64Array){this.nodeSize=Ee,this.points=q;const se=q.length<65536?Uint16Array:Uint32Array,X=this.ids=new se(q.length),oe=this.coords=new ie(2*q.length);for(let _e=0;_e<q.length;_e++)X[_e]=_e,oe[2*_e]=Y(q[_e]),oe[2*_e+1]=de(q[_e]);ot(X,oe,Ee,0,X.length-1,0)}range(q,Y,de,Ee){return function(ie,se,X,oe,_e,Ue,ct){const lt=[0,ie.length-1,0],kt=[];let hn,Lt;for(;lt.length;){const mn=lt.pop(),Qn=lt.pop(),nr=lt.pop();if(Qn-nr<=ct){for(let Cr=nr;Cr<=Qn;Cr++)hn=se[2*Cr],Lt=se[2*Cr+1],hn>=X&&hn<=_e&&Lt>=oe&&Lt<=Ue&&kt.push(ie[Cr]);continue}const En=Math.floor((nr+Qn)/2);hn=se[2*En],Lt=se[2*En+1],hn>=X&&hn<=_e&&Lt>=oe&&Lt<=Ue&&kt.push(ie[En]);const zr=(mn+1)%2;(0===mn?X<=hn:oe<=Lt)&&(lt.push(nr),lt.push(En-1),lt.push(zr)),(0===mn?_e>=hn:Ue>=Lt)&&(lt.push(En+1),lt.push(Qn),lt.push(zr))}return kt}(this.ids,this.coords,q,Y,de,Ee,this.nodeSize)}within(q,Y,de){return function(Ee,ie,se,X,oe,_e){const Ue=[0,Ee.length-1,0],ct=[],lt=oe*oe;for(;Ue.length;){const kt=Ue.pop(),hn=Ue.pop(),Lt=Ue.pop();if(hn-Lt<=_e){for(let zr=Lt;zr<=hn;zr++)Yt(ie[2*zr],ie[2*zr+1],se,X)<=lt&&ct.push(Ee[zr]);continue}const mn=Math.floor((Lt+hn)/2),Qn=ie[2*mn],nr=ie[2*mn+1];Yt(Qn,nr,se,X)<=lt&&ct.push(Ee[mn]);const En=(kt+1)%2;(0===kt?se-oe<=Qn:X-oe<=nr)&&(Ue.push(Lt),Ue.push(mn-1),Ue.push(En)),(0===kt?se+oe>=Qn:X+oe>=nr)&&(Ue.push(mn+1),Ue.push(hn),Ue.push(En))}return ct}(this.ids,this.coords,q,Y,de,this.nodeSize)}}const vr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ce=>ce},Mn=Math.fround||(er=new Float32Array(1),ce=>(er[0]=+ce,er[0]));var er;class Vn{constructor(q){this.options=Rr(Object.create(vr),q),this.trees=new Array(this.options.maxZoom+1)}load(q){const{log:Y,minZoom:de,maxZoom:Ee,nodeSize:ie}=this.options;Y&&console.time("total time");const se=`prepare ${q.length} points`;Y&&console.time(se),this.points=q;let X=[];for(let oe=0;oe<q.length;oe++)q[oe].geometry&&X.push(cr(q[oe],oe));this.trees[Ee+1]=new hr(X,Yr,vi,ie,Float32Array),Y&&console.timeEnd(se);for(let oe=Ee;oe>=de;oe--){const _e=+Date.now();X=this._cluster(X,oe),this.trees[oe]=new hr(X,Yr,vi,ie,Float32Array),Y&&console.log("z%d: %d clusters in %dms",oe,X.length,+Date.now()-_e)}return Y&&console.timeEnd("total time"),this}getClusters(q,Y){let de=((q[0]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,q[1]));let ie=180===q[2]?180:((q[2]+180)%360+360)%360-180;const se=Math.max(-90,Math.min(90,q[3]));if(q[2]-q[0]>=360)de=-180,ie=180;else if(de>ie){const Ue=this.getClusters([de,Ee,180,se],Y),ct=this.getClusters([-180,Ee,ie,se],Y);return Ue.concat(ct)}const X=this.trees[this._limitZoom(Y)],oe=X.range(Kr(de),Pr(se),Kr(ie),Pr(Ee)),_e=[];for(const Ue of oe){const ct=X.points[Ue];_e.push(ct.numPoints?Ar(ct):this.points[ct.index])}return _e}getChildren(q){const Y=this._getOriginId(q),de=this._getOriginZoom(q),Ee="No cluster with the specified id.",ie=this.trees[de];if(!ie)throw new Error(Ee);const se=ie.points[Y];if(!se)throw new Error(Ee);const X=this.options.radius/(this.options.extent*Math.pow(2,de-1)),oe=ie.within(se.x,se.y,X),_e=[];for(const Ue of oe){const ct=ie.points[Ue];ct.parentId===q&&_e.push(ct.numPoints?Ar(ct):this.points[ct.index])}if(0===_e.length)throw new Error(Ee);return _e}getLeaves(q,Y,de){const Ee=[];return this._appendLeaves(Ee,q,Y=Y||10,de=de||0,0),Ee}getTile(q,Y,de){const Ee=this.trees[this._limitZoom(q)],ie=Math.pow(2,q),{extent:se,radius:X}=this.options,oe=X/se,_e=(de-oe)/ie,Ue=(de+1+oe)/ie,ct={features:[]};return this._addTileFeatures(Ee.range((Y-oe)/ie,_e,(Y+1+oe)/ie,Ue),Ee.points,Y,de,ie,ct),0===Y&&this._addTileFeatures(Ee.range(1-oe/ie,_e,1,Ue),Ee.points,ie,de,ie,ct),Y===ie-1&&this._addTileFeatures(Ee.range(0,_e,oe/ie,Ue),Ee.points,-1,de,ie,ct),ct.features.length?ct:null}getClusterExpansionZoom(q){let Y=this._getOriginZoom(q)-1;for(;Y<=this.options.maxZoom;){const de=this.getChildren(q);if(Y++,1!==de.length)break;q=de[0].properties.cluster_id}return Y}_appendLeaves(q,Y,de,Ee,ie){const se=this.getChildren(Y);for(const X of se){const oe=X.properties;if(oe&&oe.cluster?ie+oe.point_count<=Ee?ie+=oe.point_count:ie=this._appendLeaves(q,oe.cluster_id,de,Ee,ie):ie<Ee?ie++:q.push(X),q.length===de)break}return ie}_addTileFeatures(q,Y,de,Ee,ie,se){for(const X of q){const oe=Y[X],_e=oe.numPoints;let Ue,ct,lt;if(_e)Ue=nn(oe),ct=oe.x,lt=oe.y;else{const Lt=this.points[oe.index];Ue=Lt.properties,ct=Kr(Lt.geometry.coordinates[0]),lt=Pr(Lt.geometry.coordinates[1])}const kt={type:1,geometry:[[Math.round(this.options.extent*(ct*ie-de)),Math.round(this.options.extent*(lt*ie-Ee))]],tags:Ue};let hn;_e?hn=oe.id:this.options.generateId?hn=oe.index:this.points[oe.index].id&&(hn=this.points[oe.index].id),void 0!==hn&&(kt.id=hn),se.features.push(kt)}}_limitZoom(q){return Math.max(this.options.minZoom,Math.min(Math.floor(+q),this.options.maxZoom+1))}_cluster(q,Y){const de=[],{radius:Ee,extent:ie,reduce:se,minPoints:X}=this.options,oe=Ee/(ie*Math.pow(2,Y));for(let _e=0;_e<q.length;_e++){const Ue=q[_e];if(Ue.zoom<=Y)continue;Ue.zoom=Y;const ct=this.trees[Y+1],lt=ct.within(Ue.x,Ue.y,oe),kt=Ue.numPoints||1;let hn=kt;for(const Lt of lt){const mn=ct.points[Lt];mn.zoom>Y&&(hn+=mn.numPoints||1)}if(hn>kt&&hn>=X){let Lt=Ue.x*kt,mn=Ue.y*kt,Qn=se&&kt>1?this._map(Ue,!0):null;const nr=(_e<<5)+(Y+1)+this.points.length;for(const En of lt){const zr=ct.points[En];if(zr.zoom<=Y)continue;zr.zoom=Y;const Cr=zr.numPoints||1;Lt+=zr.x*Cr,mn+=zr.y*Cr,zr.parentId=nr,se&&(Qn||(Qn=this._map(Ue,!0)),se(Qn,this._map(zr)))}Ue.parentId=nr,de.push(zn(Lt/hn,mn/hn,nr,hn,Qn))}else if(de.push(Ue),hn>1)for(const Lt of lt){const mn=ct.points[Lt];mn.zoom<=Y||(mn.zoom=Y,de.push(mn))}}return de}_getOriginId(q){return q-this.points.length>>5}_getOriginZoom(q){return(q-this.points.length)%32}_map(q,Y){if(q.numPoints)return Y?Rr({},q.properties):q.properties;const de=this.points[q.index].properties,Ee=this.options.map(de);return Y&&Ee===de?Rr({},Ee):Ee}}function zn(ce,q,Y,de,Ee){return{x:Mn(ce),y:Mn(q),zoom:1/0,id:Y,parentId:-1,numPoints:de,properties:Ee}}function cr(ce,q){const[Y,de]=ce.geometry.coordinates;return{x:Mn(Kr(Y)),y:Mn(Pr(de)),zoom:1/0,index:q,parentId:-1}}function Ar(ce){return{type:"Feature",id:ce.id,properties:nn(ce),geometry:{type:"Point",coordinates:[(q=ce.x,360*(q-.5)),Zo(ce.y)]}};var q}function nn(ce){const q=ce.numPoints,Y=q>=1e4?`${Math.round(q/1e3)}k`:q>=1e3?Math.round(q/100)/10+"k":q;return Rr(Rr({},ce.properties),{cluster:!0,cluster_id:ce.id,point_count:q,point_count_abbreviated:Y})}function Kr(ce){return ce/360+.5}function Pr(ce){const q=Math.sin(ce*Math.PI/180),Y=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return Y<0?0:Y>1?1:Y}function Zo(ce){const q=(180-360*ce)*Math.PI/180;return 360*Math.atan(Math.exp(q))/Math.PI-90}function Rr(ce,q){for(const Y in q)ce[Y]=q[Y];return ce}function Yr(ce){return ce.x}function vi(ce){return ce.y}function xn(ce,q,Y,de){for(var Ee,ie=de,se=Y-q>>1,X=Y-q,oe=ce[q],_e=ce[q+1],Ue=ce[Y],ct=ce[Y+1],lt=q+3;lt<Y;lt+=3){var kt=kr(ce[lt],ce[lt+1],oe,_e,Ue,ct);if(kt>ie)Ee=lt,ie=kt;else if(kt===ie){var hn=Math.abs(lt-se);hn<X&&(Ee=lt,X=hn)}}ie>de&&(Ee-q>3&&xn(ce,q,Ee,de),ce[Ee+2]=ie,Y-Ee>3&&xn(ce,Ee,Y,de))}function kr(ce,q,Y,de,Ee,ie){var se=Ee-Y,X=ie-de;if(0!==se||0!==X){var oe=((ce-Y)*se+(q-de)*X)/(se*se+X*X);oe>1?(Y=Ee,de=ie):oe>0&&(Y+=se*oe,de+=X*oe)}return(se=ce-Y)*se+(X=q-de)*X}function Wi(ce,q,Y,de){var Ee={id:void 0===ce?null:ce,type:q,geometry:Y,tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ie){var se=ie.geometry,X=ie.type;if("Point"===X||"MultiPoint"===X||"LineString"===X)di(ie,se);else if("Polygon"===X||"MultiLineString"===X)for(var oe=0;oe<se.length;oe++)di(ie,se[oe]);else if("MultiPolygon"===X)for(oe=0;oe<se.length;oe++)for(var _e=0;_e<se[oe].length;_e++)di(ie,se[oe][_e])}(Ee),Ee}function di(ce,q){for(var Y=0;Y<q.length;Y+=3)ce.minX=Math.min(ce.minX,q[Y]),ce.minY=Math.min(ce.minY,q[Y+1]),ce.maxX=Math.max(ce.maxX,q[Y]),ce.maxY=Math.max(ce.maxY,q[Y+1])}function zo(ce,q,Y,de){if(q.geometry){var Ee=q.geometry.coordinates,ie=q.geometry.type,se=Math.pow(Y.tolerance/((1<<Y.maxZoom)*Y.extent),2),X=[],oe=q.id;if(Y.promoteId?oe=q.properties[Y.promoteId]:Y.generateId&&(oe=de||0),"Point"===ie)sr(Ee,X);else if("MultiPoint"===ie)for(var _e=0;_e<Ee.length;_e++)sr(Ee[_e],X);else if("LineString"===ie)br(Ee,X,se,!1);else if("MultiLineString"===ie){if(Y.lineMetrics){for(_e=0;_e<Ee.length;_e++)br(Ee[_e],X=[],se,!1),ce.push(Wi(oe,"LineString",X,q.properties));return}Ai(Ee,X,se,!1)}else if("Polygon"===ie)Ai(Ee,X,se,!0);else{if("MultiPolygon"!==ie){if("GeometryCollection"===ie){for(_e=0;_e<q.geometry.geometries.length;_e++)zo(ce,{id:oe,geometry:q.geometry.geometries[_e],properties:q.properties},Y,de);return}throw new Error("Input data is not a valid GeoJSON object.")}for(_e=0;_e<Ee.length;_e++){var Ue=[];Ai(Ee[_e],Ue,se,!0),X.push(Ue)}}ce.push(Wi(oe,ie,X,q.properties))}}function sr(ce,q){q.push(Er(ce[0])),q.push(un(ce[1])),q.push(0)}function br(ce,q,Y,de){for(var Ee,ie,se=0,X=0;X<ce.length;X++){var oe=Er(ce[X][0]),_e=un(ce[X][1]);q.push(oe),q.push(_e),q.push(0),X>0&&(se+=de?(Ee*_e-oe*ie)/2:Math.sqrt(Math.pow(oe-Ee,2)+Math.pow(_e-ie,2))),Ee=oe,ie=_e}var Ue=q.length-3;q[2]=1,xn(q,0,Ue,Y),q[Ue+2]=1,q.size=Math.abs(se),q.start=0,q.end=q.size}function Ai(ce,q,Y,de){for(var Ee=0;Ee<ce.length;Ee++){var ie=[];br(ce[Ee],ie,Y,de),q.push(ie)}}function Er(ce){return ce/360+.5}function un(ce){var q=Math.sin(ce*Math.PI/180),Y=.5-.25*Math.log((1+q)/(1-q))/Math.PI;return Y<0?0:Y>1?1:Y}function ht(ce,q,Y,de,Ee,ie,se,X){if(de/=q,ie>=(Y/=q)&&se<de)return ce;if(se<Y||ie>=de)return null;for(var oe=[],_e=0;_e<ce.length;_e++){var Ue=ce[_e],ct=Ue.geometry,lt=Ue.type,kt=0===Ee?Ue.minX:Ue.minY,hn=0===Ee?Ue.maxX:Ue.maxY;if(kt>=Y&&hn<de)oe.push(Ue);else if(!(hn<Y||kt>=de)){var Lt=[];if("Point"===lt||"MultiPoint"===lt)Lr(ct,Lt,Y,de,Ee);else if("LineString"===lt)Jr(ct,Lt,Y,de,Ee,!1,X.lineMetrics);else if("MultiLineString"===lt)ro(ct,Lt,Y,de,Ee,!1);else if("Polygon"===lt)ro(ct,Lt,Y,de,Ee,!0);else if("MultiPolygon"===lt)for(var mn=0;mn<ct.length;mn++){var Qn=[];ro(ct[mn],Qn,Y,de,Ee,!0),Qn.length&&Lt.push(Qn)}if(Lt.length){if(X.lineMetrics&&"LineString"===lt){for(mn=0;mn<Lt.length;mn++)oe.push(Wi(Ue.id,lt,Lt[mn],Ue.tags));continue}"LineString"!==lt&&"MultiLineString"!==lt||(1===Lt.length?(lt="LineString",Lt=Lt[0]):lt="MultiLineString"),"Point"!==lt&&"MultiPoint"!==lt||(lt=3===Lt.length?"Point":"MultiPoint"),oe.push(Wi(Ue.id,lt,Lt,Ue.tags))}}}return oe.length?oe:null}function Lr(ce,q,Y,de,Ee){for(var ie=0;ie<ce.length;ie+=3){var se=ce[ie+Ee];se>=Y&&se<=de&&(q.push(ce[ie]),q.push(ce[ie+1]),q.push(ce[ie+2]))}}function Jr(ce,q,Y,de,Ee,ie,se){for(var X,oe,_e=tr(ce),Ue=0===Ee?$r:jr,ct=ce.start,lt=0;lt<ce.length-3;lt+=3){var kt=ce[lt],hn=ce[lt+1],Lt=ce[lt+2],mn=ce[lt+3],Qn=ce[lt+4],nr=0===Ee?kt:hn,En=0===Ee?mn:Qn,zr=!1;se&&(X=Math.sqrt(Math.pow(kt-mn,2)+Math.pow(hn-Qn,2))),nr<Y?En>Y&&(oe=Ue(_e,kt,hn,mn,Qn,Y),se&&(_e.start=ct+X*oe)):nr>de?En<de&&(oe=Ue(_e,kt,hn,mn,Qn,de),se&&(_e.start=ct+X*oe)):Pi(_e,kt,hn,Lt),En<Y&&nr>=Y&&(oe=Ue(_e,kt,hn,mn,Qn,Y),zr=!0),En>de&&nr<=de&&(oe=Ue(_e,kt,hn,mn,Qn,de),zr=!0),!ie&&zr&&(se&&(_e.end=ct+X*oe),q.push(_e),_e=tr(ce)),se&&(ct+=X)}var Cr=ce.length-3;kt=ce[Cr],hn=ce[Cr+1],Lt=ce[Cr+2],(nr=0===Ee?kt:hn)>=Y&&nr<=de&&Pi(_e,kt,hn,Lt),Cr=_e.length-3,ie&&Cr>=3&&(_e[Cr]!==_e[0]||_e[Cr+1]!==_e[1])&&Pi(_e,_e[0],_e[1],_e[2]),_e.length&&q.push(_e)}function tr(ce){var q=[];return q.size=ce.size,q.start=ce.start,q.end=ce.end,q}function ro(ce,q,Y,de,Ee,ie){for(var se=0;se<ce.length;se++)Jr(ce[se],q,Y,de,Ee,ie,!1)}function Pi(ce,q,Y,de){ce.push(q),ce.push(Y),ce.push(de)}function $r(ce,q,Y,de,Ee,ie){var se=(ie-q)/(de-q);return ce.push(ie),ce.push(Y+(Ee-Y)*se),ce.push(1),se}function jr(ce,q,Y,de,Ee,ie){var se=(ie-Y)/(Ee-Y);return ce.push(q+(de-q)*se),ce.push(ie),ce.push(1),se}function Bo(ce,q){for(var Y=[],de=0;de<ce.length;de++){var Ee,ie=ce[de],se=ie.type;if("Point"===se||"MultiPoint"===se||"LineString"===se)Ee=xr(ie.geometry,q);else if("MultiLineString"===se||"Polygon"===se){Ee=[];for(var X=0;X<ie.geometry.length;X++)Ee.push(xr(ie.geometry[X],q))}else if("MultiPolygon"===se)for(Ee=[],X=0;X<ie.geometry.length;X++){for(var oe=[],_e=0;_e<ie.geometry[X].length;_e++)oe.push(xr(ie.geometry[X][_e],q));Ee.push(oe)}Y.push(Wi(ie.id,se,Ee,ie.tags))}return Y}function xr(ce,q){var Y=[];Y.size=ce.size,void 0!==ce.start&&(Y.start=ce.start,Y.end=ce.end);for(var de=0;de<ce.length;de+=3)Y.push(ce[de]+q,ce[de+1],ce[de+2]);return Y}function Ui(ce,q){if(ce.transformed)return ce;var Y,de,Ee,ie=1<<ce.z,se=ce.x,X=ce.y;for(Y=0;Y<ce.features.length;Y++){var oe=ce.features[Y],_e=oe.geometry,Ue=oe.type;if(oe.geometry=[],1===Ue)for(de=0;de<_e.length;de+=2)oe.geometry.push(Rn(_e[de],_e[de+1],q,ie,se,X));else for(de=0;de<_e.length;de++){var ct=[];for(Ee=0;Ee<_e[de].length;Ee+=2)ct.push(Rn(_e[de][Ee],_e[de][Ee+1],q,ie,se,X));oe.geometry.push(ct)}}return ce.transformed=!0,ce}function Rn(ce,q,Y,de,Ee,ie){return[Math.round(Y*(ce*de-Ee)),Math.round(Y*(q*de-ie))]}function Ri(ce,q,Y,de,Ee){for(var ie=q===Ee.maxZoom?0:Ee.tolerance/((1<<q)*Ee.extent),se={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:Y,y:de,z:q,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},X=0;X<ce.length;X++){se.numFeatures++,Zi(se,ce[X],ie,Ee);var oe=ce[X].minX,_e=ce[X].minY,Ue=ce[X].maxX,ct=ce[X].maxY;oe<se.minX&&(se.minX=oe),_e<se.minY&&(se.minY=_e),Ue>se.maxX&&(se.maxX=Ue),ct>se.maxY&&(se.maxY=ct)}return se}function Zi(ce,q,Y,de){var Ee=q.geometry,ie=q.type,se=[];if("Point"===ie||"MultiPoint"===ie)for(var X=0;X<Ee.length;X+=3)se.push(Ee[X]),se.push(Ee[X+1]),ce.numPoints++,ce.numSimplified++;else if("LineString"===ie)Je(se,Ee,ce,Y,!1,!1);else if("MultiLineString"===ie||"Polygon"===ie)for(X=0;X<Ee.length;X++)Je(se,Ee[X],ce,Y,"Polygon"===ie,0===X);else if("MultiPolygon"===ie)for(var oe=0;oe<Ee.length;oe++){var _e=Ee[oe];for(X=0;X<_e.length;X++)Je(se,_e[X],ce,Y,!0,0===X)}if(se.length){var Ue=q.tags||null;if("LineString"===ie&&de.lineMetrics){for(var ct in Ue={},q.tags)Ue[ct]=q.tags[ct];Ue.mapbox_clip_start=Ee.start/Ee.size,Ue.mapbox_clip_end=Ee.end/Ee.size}var lt={geometry:se,type:"Polygon"===ie||"MultiPolygon"===ie?3:"LineString"===ie||"MultiLineString"===ie?2:1,tags:Ue};null!==q.id&&(lt.id=q.id),ce.features.push(lt)}}function Je(ce,q,Y,de,Ee,ie){var se=de*de;if(de>0&&q.size<(Ee?se:de))Y.numPoints+=q.length/3;else{for(var X=[],oe=0;oe<q.length;oe+=3)(0===de||q[oe+2]>se)&&(Y.numSimplified++,X.push(q[oe]),X.push(q[oe+1])),Y.numPoints++;Ee&&function(_e,Ue){for(var ct=0,lt=0,kt=_e.length,hn=kt-2;lt<kt;hn=lt,lt+=2)ct+=(_e[lt]-_e[hn])*(_e[lt+1]+_e[hn+1]);if(ct>0===Ue)for(lt=0,kt=_e.length;lt<kt/2;lt+=2){var Lt=_e[lt],mn=_e[lt+1];_e[lt]=_e[kt-2-lt],_e[lt+1]=_e[kt-1-lt],_e[kt-2-lt]=Lt,_e[kt-1-lt]=mn}}(X,ie),ce.push(X)}}function Fe(ce,q){var Y=(q=this.options=function(Ee,ie){for(var se in ie)Ee[se]=ie[se];return Ee}(Object.create(this.options),q)).debug;if(Y&&console.time("preprocess data"),q.maxZoom<0||q.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(q.promoteId&&q.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ee,ie,se,X,oe,_e,de=function(Ee,ie){var se=[];if("FeatureCollection"===Ee.type)for(var X=0;X<Ee.features.length;X++)zo(se,Ee.features[X],ie,X);else zo(se,"Feature"===Ee.type?Ee:{geometry:Ee},ie);return se}(ce,q);this.tiles={},this.tileCoords=[],Y&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",q.indexMaxZoom,q.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),X=Ee=de,oe=ht(Ee,1,-1-(se=(ie=q).buffer/ie.extent),se,0,-1,2,ie),_e=ht(Ee,1,1-se,2+se,0,-1,2,ie),(oe||_e)&&(X=ht(Ee,1,-se,1+se,0,-1,2,ie)||[],oe&&(X=Bo(oe,1).concat(X)),_e&&(X=X.concat(Bo(_e,-1)))),(de=X).length&&this.splitTile(de,0,0,0),Y&&(de.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ne(ce,q,Y){return 32*((1<<ce)*Y+q)+ce}function Rt(ce,q){const Y=ce.tileID.canonical;if(!this._geoJSONIndex)return q(null,null);const de=this._geoJSONIndex.getTile(Y.z,Y.x,Y.y);if(!de)return q(null,null);const Ee=new Ut(de.features);let ie=cn(Ee);0===ie.byteOffset&&ie.byteLength===ie.buffer.byteLength||(ie=new Uint8Array(ie)),q(null,{vectorTile:Ee,rawData:ie.buffer})}Fe.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Fe.prototype.splitTile=function(ce,q,Y,de,Ee,ie,se){for(var X=[ce,q,Y,de],oe=this.options,_e=oe.debug;X.length;){de=X.pop(),Y=X.pop(),q=X.pop(),ce=X.pop();var Ue=1<<q,ct=Ne(q,Y,de),lt=this.tiles[ct];if(!lt&&(_e>1&&console.time("creation"),lt=this.tiles[ct]=Ri(ce,q,Y,de,oe),this.tileCoords.push({z:q,x:Y,y:de}),_e)){_e>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",q,Y,de,lt.numFeatures,lt.numPoints,lt.numSimplified),console.timeEnd("creation"));var kt="z"+q;this.stats[kt]=(this.stats[kt]||0)+1,this.total++}if(lt.source=ce,Ee){if(q===oe.maxZoom||q===Ee)continue;var hn=1<<Ee-q;if(Y!==Math.floor(ie/hn)||de!==Math.floor(se/hn))continue}else if(q===oe.indexMaxZoom||lt.numPoints<=oe.indexMaxPoints)continue;if(lt.source=null,0!==ce.length){_e>1&&console.time("clipping");var Lt,mn,Qn,nr,En,zr,Cr=.5*oe.buffer/oe.extent,Xo=.5-Cr,ki=.5+Cr,st=1+Cr;Lt=mn=Qn=nr=null,En=ht(ce,Ue,Y-Cr,Y+ki,0,lt.minX,lt.maxX,oe),zr=ht(ce,Ue,Y+Xo,Y+st,0,lt.minX,lt.maxX,oe),ce=null,En&&(Lt=ht(En,Ue,de-Cr,de+ki,1,lt.minY,lt.maxY,oe),mn=ht(En,Ue,de+Xo,de+st,1,lt.minY,lt.maxY,oe),En=null),zr&&(Qn=ht(zr,Ue,de-Cr,de+ki,1,lt.minY,lt.maxY,oe),nr=ht(zr,Ue,de+Xo,de+st,1,lt.minY,lt.maxY,oe),zr=null),_e>1&&console.timeEnd("clipping"),X.push(Lt||[],q+1,2*Y,2*de),X.push(mn||[],q+1,2*Y,2*de+1),X.push(Qn||[],q+1,2*Y+1,2*de),X.push(nr||[],q+1,2*Y+1,2*de+1)}}},Fe.prototype.getTile=function(ce,q,Y){var de=this.options,Ee=de.extent,ie=de.debug;if(ce<0||ce>24)return null;var se=1<<ce,X=Ne(ce,q=(q%se+se)%se,Y);if(this.tiles[X])return Ui(this.tiles[X],Ee);ie>1&&console.log("drilling down to z%d-%d-%d",ce,q,Y);for(var oe,_e=ce,Ue=q,ct=Y;!oe&&_e>0;)_e--,Ue=Math.floor(Ue/2),ct=Math.floor(ct/2),oe=this.tiles[Ne(_e,Ue,ct)];return oe&&oe.source?(ie>1&&console.log("found parent tile z%d-%d-%d",_e,Ue,ct),ie>1&&console.time("drilling down"),this.splitTile(oe.source,_e,Ue,ct,ce,q,Y),ie>1&&console.timeEnd("drilling down"),this.tiles[X]?Ui(this.tiles[X],Ee):null):null};class It extends c.VectorTileWorkerSource{constructor(q,Y,de,Ee,ie){super(q,Y,de,Ee,Rt),ie&&(this.loadGeoJSON=ie)}loadData(q,Y){const de=q&&q.request,Ee=de&&de.collectResourceTiming;this.loadGeoJSON(q,(ie,se)=>{if(ie||!se)return Y(ie);if("object"!=typeof se)return Y(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));{wt(se,!0);try{if(q.filter){const oe=c.createExpression(q.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===oe.result)throw new Error(oe.value.map(Ue=>`${Ue.key}: ${Ue.message}`).join(", "));se={type:"FeatureCollection",features:se.features.filter(Ue=>oe.value.evaluate({zoom:0},Ue))}}this._geoJSONIndex=q.cluster?new Vn(function({superclusterOptions:oe,clusterProperties:_e}){if(!_e||!oe)return oe;const Ue={},ct={},lt={accumulated:null,zoom:0},kt={properties:null},hn=Object.keys(_e);for(const Lt of hn){const[mn,Qn]=_e[Lt],nr=c.createExpression(Qn),En=c.createExpression("string"==typeof mn?[mn,["accumulated"],["get",Lt]]:mn);Ue[Lt]=nr.value,ct[Lt]=En.value}return oe.map=Lt=>{kt.properties=Lt;const mn={};for(const Qn of hn)mn[Qn]=Ue[Qn].evaluate(lt,kt);return mn},oe.reduce=(Lt,mn)=>{kt.properties=mn;for(const Qn of hn)lt.accumulated=Lt[Qn],Lt[Qn]=ct[Qn].evaluate(lt,kt)},oe}(q)).load(se.features):new Fe(oe=se,q.geojsonVtOptions)}catch(oe){return Y(oe)}this.loaded={};const X={};if(Ee){const oe=c.getPerformanceMeasurement(de);oe&&(X.resourceTiming={},X.resourceTiming[q.source]=JSON.parse(JSON.stringify(oe)))}Y(null,X)}var oe})}reloadTile(q,Y){const de=this.loaded;return de&&de[q.uid]?super.reloadTile(q,Y):this.loadTile(q,Y)}loadGeoJSON(q,Y){if(q.request)c.getJSON(q.request,Y);else{if("string"!=typeof q.data)return Y(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`));try{return Y(null,JSON.parse(q.data))}catch{return Y(new Error(`Input data given to '${q.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(q,Y){try{Y(null,this._geoJSONIndex.getClusterExpansionZoom(q.clusterId))}catch(de){Y(de)}}getClusterChildren(q,Y){try{Y(null,this._geoJSONIndex.getChildren(q.clusterId))}catch(de){Y(de)}}getClusterLeaves(q,Y){try{Y(null,this._geoJSONIndex.getLeaves(q.clusterId,q.limit,q.offset))}catch(de){Y(de)}}}class On{constructor(q){this.self=q,this.actor=new c.Actor(q,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=c.getProjection({name:"mercator"}),this.workerSourceTypes={vector:c.VectorTileWorkerSource,geojson:It},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(Y,de)=>{if(this.workerSourceTypes[Y])throw new Error(`Worker source with name "${Y}" already registered.`);this.workerSourceTypes[Y]=de},this.self.registerRTLTextPlugin=Y=>{if(c.plugin.isParsed())throw new Error("RTL text plugin already registered.");c.plugin.applyArabicShaping=Y.applyArabicShaping,c.plugin.processBidirectionalText=Y.processBidirectionalText,c.plugin.processStyledBidirectionalText=Y.processStyledBidirectionalText}}clearCaches(q,Y,de){delete this.layerIndexes[q],delete this.availableImages[q],delete this.workerSources[q],delete this.demWorkerSources[q],de()}checkIfReady(q,Y,de){de()}setReferrer(q,Y){this.referrer=Y}spriteLoaded(q,Y){this.isSpriteLoaded[q]=Y;for(const de in this.workerSources[q]){const Ee=this.workerSources[q][de];for(const ie in Ee)Ee[ie]instanceof c.VectorTileWorkerSource&&(Ee[ie].isSpriteLoaded=Y,Ee[ie].fire(new c.Event("isSpriteLoaded")))}}setImages(q,Y,de){this.availableImages[q]=Y;for(const Ee in this.workerSources[q]){const ie=this.workerSources[q][Ee];for(const se in ie)ie[se].availableImages=Y}de()}enableTerrain(q,Y,de){this.terrain=Y,de()}setProjection(q,Y){this.projections[q]=c.getProjection(Y)}setLayers(q,Y,de){this.getLayerIndex(q).replace(Y),de()}updateLayers(q,Y,de){this.getLayerIndex(q).update(Y.layers,Y.removedIds),de()}loadTile(q,Y,de){const Ee=this.enableTerrain?c.extend({enableTerrain:this.terrain},Y):Y;Ee.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,Y.type,Y.source).loadTile(Ee,de)}loadDEMTile(q,Y,de){const Ee=this.enableTerrain?c.extend({buildQuadTree:this.terrain},Y):Y;this.getDEMWorkerSource(q,Y.source).loadTile(Ee,de)}reloadTile(q,Y,de){const Ee=this.enableTerrain?c.extend({enableTerrain:this.terrain},Y):Y;Ee.projection=this.projections[q]||this.defaultProjection,this.getWorkerSource(q,Y.type,Y.source).reloadTile(Ee,de)}abortTile(q,Y,de){this.getWorkerSource(q,Y.type,Y.source).abortTile(Y,de)}removeTile(q,Y,de){this.getWorkerSource(q,Y.type,Y.source).removeTile(Y,de)}removeSource(q,Y,de){if(!this.workerSources[q]||!this.workerSources[q][Y.type]||!this.workerSources[q][Y.type][Y.source])return;const Ee=this.workerSources[q][Y.type][Y.source];delete this.workerSources[q][Y.type][Y.source],void 0!==Ee.removeSource?Ee.removeSource(Y,de):de()}loadWorkerSource(q,Y,de){try{this.self.importScripts(Y.url),de()}catch(Ee){de(Ee.toString())}}syncRTLPluginState(q,Y,de){try{c.plugin.setState(Y);const Ee=c.plugin.getPluginURL();if(c.plugin.isLoaded()&&!c.plugin.isParsed()&&null!=Ee){this.self.importScripts(Ee);const ie=c.plugin.isParsed();de(ie?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ee}`),ie)}}catch(Ee){de(Ee.toString())}}getAvailableImages(q){let Y=this.availableImages[q];return Y||(Y=[]),Y}getLayerIndex(q){let Y=this.layerIndexes[q];return Y||(Y=this.layerIndexes[q]=new qt),Y}getWorkerSource(q,Y,de){return this.workerSources[q]||(this.workerSources[q]={}),this.workerSources[q][Y]||(this.workerSources[q][Y]={}),this.workerSources[q][Y][de]||(this.workerSources[q][Y][de]=new this.workerSourceTypes[Y]({send:(ie,se,X,oe,_e,Ue)=>{this.actor.send(ie,se,X,q,_e,Ue)},scheduler:this.actor.scheduler},this.getLayerIndex(q),this.getAvailableImages(q),this.isSpriteLoaded[q])),this.workerSources[q][Y][de]}getDEMWorkerSource(q,Y){return this.demWorkerSources[q]||(this.demWorkerSources[q]={}),this.demWorkerSources[q][Y]||(this.demWorkerSources[q][Y]=new zt),this.demWorkerSources[q][Y]}enforceCacheSizeLimit(q,Y){c.enforceCacheSizeLimit(Y)}getWorkerPerformanceMetrics(q,Y,de){de(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new On(self)),On}),ge(0,function(c){function Le(p,r){if(Array.isArray(p)){if(!Array.isArray(r)||p.length!==r.length)return!1;for(let l=0;l<p.length;l++)if(!Le(p[l],r[l]))return!1;return!0}if("object"==typeof p&&null!==p&&null!==r){if("object"!=typeof r||Object.keys(p).length!==Object.keys(r).length)return!1;for(const l in p)if(!Le(p[l],r[l]))return!1;return!0}return p===r}var en=qt;function qt(p){return r=p,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var _,u,d=new Blob([""],{type:"text/javascript"}),f=URL.createObjectURL(d);try{u=new Worker(f),_=!0}catch{_=!1}return u&&u.terminate(),URL.revokeObjectURL(f),_}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var _=document.createElement("canvas");_.width=_.height=1;var u=_.getContext("2d");if(!u)return!1;var d=u.getImageData(0,0,1,1);return d&&d.width===_.width}()||(void 0===zt[l=r&&r.failIfMajorPerformanceCaveat]&&(zt[l]=function(_){var u,f,v,b,d=(f=_,v=document.createElement("canvas"),(b=Object.create(qt.webGLContextAttributes)).failIfMajorPerformanceCaveat=f,v.getContext("webgl",b)||v.getContext("experimental-webgl",b));if(!d)return!1;try{u=d.createShader(d.VERTEX_SHADER)}catch{return!1}return!(!u||d.isContextLost())&&(d.shaderSource(u,"void main() {}"),d.compileShader(u),!0===d.getShaderParameter(u,d.COMPILE_STATUS))}(l)),!zt[l]||document.documentMode));var r,l}var zt={};function wt(p,r,l){const _=c.window.document.createElement(p);return void 0!==r&&(_.className=r),l&&l.appendChild(_),_}function Et(p,r,l){const _=c.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const u of Object.keys(r))_.setAttributeNS(null,u,r[u]);return l&&l.appendChild(_),_}qt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const mt=c.window.document&&c.window.document.documentElement.style,Zt=mt&&void 0!==mt.userSelect?"userSelect":"WebkitUserSelect";let Pn;function Ut(){mt&&Zt&&(Pn=mt[Zt],mt[Zt]="none")}function cn(){mt&&Zt&&(mt[Zt]=Pn)}function In(p){p.preventDefault(),p.stopPropagation(),c.window.removeEventListener("click",In,!0)}function Xn(){c.window.addEventListener("click",In,!0),c.window.setTimeout(()=>{c.window.removeEventListener("click",In,!0)},0)}function dt(p,r){const l=p.getBoundingClientRect();return Bt(p,l,r)}function yr(p,r){const l=p.getBoundingClientRect(),_=[];for(let u=0;u<r.length;u++)_.push(Bt(p,l,r[u]));return _}function sn(p){return void 0!==c.window.InstallTrigger&&2===p.button&&p.ctrlKey&&c.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function Bt(p,r,l){const _=p.offsetWidth===r.width?1:p.offsetWidth/r.width;return new c.pointGeometry((l.clientX-r.left)*_,(l.clientY-r.top)*_)}function je(p,r){var l=r[0],_=r[1],u=r[2],d=r[3],f=l*d-u*_;return f?(p[0]=d*(f=1/f),p[1]=-_*f,p[2]=-u*f,p[3]=l*f,p):null}function Kt(p){const{userImage:r}=p;return!!(r&&r.render&&r.render())&&(p.data.replace(new Uint8Array(r.data.buffer)),!0)}class Hn extends c.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:l,callback:_}of this.requestors)this._notify(l,_);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,l){this._validate(r,l)&&(this.images[r]=l)}_validate(r,l){let _=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new c.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),_=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new c.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),_=!1),this._validateContent(l.content,l)||(this.fire(new c.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),_=!1),_}_validateStretch(r,l){if(!r)return!0;let _=0;for(const u of r){if(u[0]<_||u[1]<u[0]||l<u[1])return!1;_=u[1]}return!0}_validateContent(r,l){return!(r&&(4!==r.length||r[0]<0||l.data.width<r[0]||r[1]<0||l.data.height<r[1]||r[2]<0||l.data.width<r[2]||r[3]<0||l.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,l){l.version=this.images[r].version+1,this.images[r]=l,this.updatedImages[r]=!0}removeImage(r){const l=this.images[r];delete this.images[r],delete this.patterns[r],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,l){let _=!0;if(!this.isLoaded())for(const u of r)this.images[u]||(_=!1);this.isLoaded()||_?this._notify(r,l):this.requestors.push({ids:r,callback:l})}_notify(r,l){const _={};for(const u of r){this.images[u]||this.fire(new c.Event("styleimagemissing",{id:u}));const d=this.images[u];d?_[u]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,hasRenderCallback:Boolean(d.userImage&&d.userImage.render)}:c.warnOnce(`Image "${u}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,_)}getPixelSize(){const{width:r,height:l}=this.atlasImage;return{width:r,height:l}}getPattern(r){const l=this.patterns[r],_=this.getImage(r);if(!_)return null;if(l&&l.position.version===_.version)return l.position;if(l)l.position.version=_.version;else{const u={w:_.data.width+2,h:_.data.height+2,x:0,y:0},d=new c.ImagePosition(u,_);this.patterns[r]={bin:u,position:d}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const l=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.Texture(r,this.atlasImage,l.RGBA),this.atlasTexture&&this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const d in this.patterns)r.push(this.patterns[d].bin);const{w:l,h:_}=c.potpack(r),u=this.atlasImage;u.resize({width:l||1,height:_||1});for(const d in this.patterns){const{bin:f}=this.patterns[d],v=f.x+1,b=f.y+1,C=this.images[d].data,S=C.width,z=C.height;c.RGBAImage.copy(C,u,{x:0,y:0},{x:v,y:b},{width:S,height:z}),c.RGBAImage.copy(C,u,{x:0,y:z-1},{x:v,y:b-1},{width:S,height:1}),c.RGBAImage.copy(C,u,{x:0,y:0},{x:v,y:b+z},{width:S,height:1}),c.RGBAImage.copy(C,u,{x:S-1,y:0},{x:v-1,y:b},{width:1,height:z}),c.RGBAImage.copy(C,u,{x:0,y:0},{x:v+S,y:b},{width:1,height:z})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const l of r){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const _=this.images[l];Kt(_)&&this.updateImage(l,_)}}}const Me=new c.Properties({anchor:new c.DataConstantProperty(c.spec.light.anchor),position:new class{constructor(){this.specification=c.spec.light.position}possiblyEvaluate(p,r){return function([l,_,u]){const d=c.degToRad(_+90),f=c.degToRad(u);return{x:l*Math.cos(d)*Math.sin(f),y:l*Math.sin(d)*Math.sin(f),z:l*Math.cos(f),azimuthal:_,polar:u}}(p.expression.evaluate(r))}interpolate(p,r,l){return{x:c.number(p.x,r.x,l),y:c.number(p.y,r.y,l),z:c.number(p.z,r.z,l),azimuthal:c.number(p.azimuthal,r.azimuthal,l),polar:c.number(p.polar,r.polar,l)}}},color:new c.DataConstantProperty(c.spec.light.color),intensity:new c.DataConstantProperty(c.spec.light.intensity)}),Wt="-transition";class gt extends c.Evented{constructor(r){super(),this._transitionable=new c.Transitionable(Me),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,l={}){if(!this._validate(c.validateLight,r,l))for(const _ in r){const u=r[_];c.endsWith(_,Wt)?this._transitionable.setTransition(_.slice(0,-Wt.length),u):this._transitionable.setValue(_,u)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,_){return(!_||!1!==_.validate)&&c.emitValidationErrors(this,r.call(c.validateStyle,c.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}const ft=new c.Properties({source:new c.DataConstantProperty(c.spec.terrain.source),exaggeration:new c.DataConstantProperty(c.spec.terrain.exaggeration)}),fn="-transition";class vn extends c.Evented{constructor(r,l){super(),this._transitionable=new c.Transitionable(ft),this.set(r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=l}get(){return this._transitionable.serialize()}set(r){for(const l in r){const _=r[l];c.endsWith(l,fn)?this._transitionable.setTransition(l.slice(0,-fn.length),_):this._transitionable.setValue(l,_)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function dn(p,r,l,_){const u=c.smoothstep(45,65,l),[d,f]=ot(p,_),v=c.length(r);let b=1-Math.min(1,Math.exp((v-d)/(f-d)*-6));return b*=b*b,b=Math.min(1,1.00747*b),b*u*p.alpha}function ot(p,r){const l=.5/Math.tan(.5*r);return[p.range[0]+l,p.range[1]+l]}const $e=new c.Properties({range:new c.DataConstantProperty(c.spec.fog.range),color:new c.DataConstantProperty(c.spec.fog.color),"high-color":new c.DataConstantProperty(c.spec.fog["high-color"]),"space-color":new c.DataConstantProperty(c.spec.fog["space-color"]),"horizon-blend":new c.DataConstantProperty(c.spec.fog["horizon-blend"]),"star-intensity":new c.DataConstantProperty(c.spec.fog["star-intensity"])}),yt="-transition";class At extends c.Evented{constructor(r,l){super(),this._transitionable=new c.Transitionable($e),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){const r=this._transform,l="globe"===r.projection.name,_=c.globeToMercatorTransition(r.zoom),u=this.properties.get("range"),d=[.5,3];return{range:l?[c.number(d[0],u[0],_),c.number(d[1],u[1],_)]:u,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,l={}){if(!this._validate(c.validateFog,r,l)){for(const _ of Object.keys(c.spec.fog))r&&void 0===r[_]&&(r[_]=c.spec.fog[_].default);for(const _ in r){const u=r[_];c.endsWith(_,yt)?this._transitionable.setTransition(_.slice(0,-yt.length),u):this._transitionable.setValue(_,u)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:c.smoothstep(45,65,r))*l.a}getOpacityAtLatLng(r,l){return this._transform.projection.supportsFog?function(_,u,d){const f=c.MercatorCoordinate.fromLngLat(u),v=d.elevation?d.elevation.getAtPointOrZero(f):0,b=[f.x,f.y,v];return c.transformMat4(b,b,d.mercatorFogMatrix),dn(_,b,d.pitch,d._fov)}(this.state,r,l):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?ot(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,l,_){return(!_||!1!==_.validate)&&c.emitValidationErrors(this,r.call(c.validateStyle,c.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}class Yt{constructor(r,l){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=c.uniqueId();const _=this.workerPool.acquire(this.id);for(let u=0;u<_.length;u++){const d=new Yt.Actor(_[u],l,this.id);d.name=`Worker ${u}`,this.actors.push(d)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,l,_){c.asyncAll(this.actors,(u,d)=>{u.send(r,l,d)},_=_||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Dt(p,r,l){return r*(c.EXTENT/(p.tileSize*Math.pow(2,l-p.tileID.overscaledZ)))}Yt.Actor=c.Actor;class an{constructor(r,l,_,u){this.screenBounds=r,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=_,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,u)}static createFromScreenPoints(r,l){let _,u;if(r instanceof c.pointGeometry||"number"==typeof r[0]){const d=c.pointGeometry.convert(r);_=[d],u=l.isPointAboveHorizon(d)}else{const d=c.pointGeometry.convert(r[0]),f=c.pointGeometry.convert(r[1]);_=[d,f],u=c.polygonizeBounds(d,f).every(v=>l.isPointAboveHorizon(v))}return new an(_,l.getCameraPoint(),u,l)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(r){return c.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const l=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new c.pointGeometry(1,1)):this.screenBounds[1],u=c.polygonizeBounds(l,_,0,!1);return this.cameraPoint.y>_.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<_.x?u.splice(3,0,this.cameraPoint):this.cameraPoint.x>=_.x?u[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(u[3]=this.cameraPoint)),c.bufferConvexPolygon(u,r)}bufferedCameraGeometryGlobe(r){const l=this.screenBounds[0],_=1===this.screenBounds.length?this.screenBounds[0].add(new c.pointGeometry(1,1)):this.screenBounds[1],u=c.polygonizeBounds(l,_,r),d=this.cameraPoint.clone();switch(3*((d.y>l.y)+(d.y>_.y))+((d.x>l.x)+(d.x>_.x))){case 0:u[0]=d,u[4]=d.clone();break;case 1:u.splice(1,0,d);break;case 2:u[1]=d;break;case 3:u.splice(4,0,d);break;case 5:u.splice(2,0,d);break;case 6:u[3]=d;break;case 7:u.splice(3,0,d);break;case 8:u[2]=d}return u}containsTile(r,l,_,u=0){const d=r.queryPadding/l._pixelsPerMercatorPixel+1,f=_?this._bufferedCameraMercator(d,l):this._bufferedScreenMercator(d,l);let v=r.tileID.wrap+(f.unwrapped?u:0);const b=f.polygon.map(fe=>c.getTilePoint(r.tileTransform,fe,v));if(!c.polygonIntersectsBox(b,0,0,c.EXTENT,c.EXTENT))return;v=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?u:0);const C=this.screenGeometryMercator.polygon.map(fe=>c.getTileVec3(r.tileTransform,fe,v)),S=C.map(fe=>new c.pointGeometry(fe[0],fe[1])),z=l.getFreeCameraOptions().position||new c.MercatorCoordinate(0,0,0),H=c.getTileVec3(r.tileTransform,z,v),ee=C.map(fe=>{const ne=c.sub(fe,fe,H);return c.normalize(ne,ne),new c.Ray(H,ne)}),re=Dt(r,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:S,tilespaceRays:ee,bufferedTilespaceGeometry:b,bufferedTilespaceBounds:(ue=c.getBounds(b),ue.min.x=c.clamp(ue.min.x,0,c.EXTENT),ue.min.y=c.clamp(ue.min.y,0,c.EXTENT),ue.max.x=c.clamp(ue.max.x,0,c.EXTENT),ue.max.y=c.clamp(ue.max.y,0,c.EXTENT),ue),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:re};var ue}_bufferedScreenMercator(r,l){const _=Mn(r);if(this._screenRaycastCache[_])return this._screenRaycastCache[_];{let u;return u="globe"===l.projection.name?this._projectAndResample(this.bufferedScreenGeometry(r),l):{polygon:this.bufferedScreenGeometry(r).map(d=>l.pointCoordinate3D(d)),unwrapped:!0},this._screenRaycastCache[_]=u,u}}_bufferedCameraMercator(r,l){const _=Mn(r);if(this._cameraRaycastCache[_])return this._cameraRaycastCache[_];{let u;return u="globe"===l.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),l):{polygon:this.bufferedCameraGeometry(r).map(d=>l.pointCoordinate3D(d)),unwrapped:!0},this._cameraRaycastCache[_]=u,u}}_projectAndResample(r,l){const _=function(d,f){const v=c.multiply([],f.pixelMatrix,f.globeMatrix),b=[0,-c.GLOBE_RADIUS,0,1],C=[0,c.GLOBE_RADIUS,0,1],S=[0,0,0,1];c.transformMat4$1(b,b,v),c.transformMat4$1(C,C,v),c.transformMat4$1(S,S,v);const z=new c.pointGeometry(b[0]/b[3],b[1]/b[3]),H=new c.pointGeometry(C[0]/C[3],C[1]/C[3]),ee=c.polygonContainsPoint(d,z)&&b[3]<S[3],re=c.polygonContainsPoint(d,H)&&C[3]<S[3];if(!ee&&!re)return null;const ue=function(ze,qe,Ke){for(let Qe=1;Qe<ze.length;Qe++){const Ht=vr(qe.pointCoordinate3D(ze[Qe-1]).x),Ze=vr(qe.pointCoordinate3D(ze[Qe]).x);if(Ke<0){if(Ht<Ze)return{idx:Qe,t:-Ht/(Ze-1-Ht)}}else if(Ze<Ht)return{idx:Qe,t:(1-Ht)/(Ze+1-Ht)}}return null}(d,f,ee?-1:1);if(!ue)return null;const{idx:fe,t:ne}=ue;let we=fe>1?hr(d.slice(0,fe),f):[],xe=fe<d.length?hr(d.slice(fe),f):[];we=we.map(ze=>new c.pointGeometry(vr(ze.x),ze.y)),xe=xe.map(ze=>new c.pointGeometry(vr(ze.x),ze.y));const be=[...we];0===be.length&&be.push(xe[xe.length-1]);const Re=c.number(be[be.length-1].y,(0===xe.length?we[0]:xe[0]).y,ne);let Ae;return Ae=ee?[new c.pointGeometry(0,Re),new c.pointGeometry(0,0),new c.pointGeometry(1,0),new c.pointGeometry(1,Re)]:[new c.pointGeometry(1,Re),new c.pointGeometry(1,1),new c.pointGeometry(0,1),new c.pointGeometry(0,Re)],be.push(...Ae),0===xe.length?be.push(we[0]):be.push(...xe),{polygon:be.map(ze=>new c.MercatorCoordinate(ze.x,ze.y)),unwrapped:!1}}(r,l);if(_)return _;const u=function(d,f){let v=!1,b=-1/0,C=0;for(let z=0;z<d.length-1;z++)d[z].x>b&&(b=d[z].x,C=z);for(let z=0;z<d.length-1;z++){const H=(C+z)%(d.length-1),ee=d[H],re=d[H+1];Math.abs(ee.x-re.x)>.5&&(ee.x<re.x?(ee.x+=1,0===H&&(d[d.length-1].x+=1)):(re.x+=1,H+1===d.length-1&&(d[0].x+=1)),v=!0)}const S=c.mercatorXfromLng(f.center.lng);return v&&S<Math.abs(S-1)&&d.forEach(z=>{z.x-=1}),{polygon:d,unwrapped:v}}(hr(r,l).map(d=>new c.pointGeometry(vr(d.x),d.y)),l);return{polygon:u.polygon.map(d=>new c.MercatorCoordinate(d.x,d.y)),unwrapped:u.unwrapped}}}function hr(p,r){return c.resample(p,l=>{const _=r.pointCoordinate3D(l);l.x=_.x,l.y=_.y},1/256)}function vr(p){return p<0?1+p%1:p%1}function Mn(p){return 100*p|0}function er(p,r,l,_,u){const d=function(f,v){if(f)return u(f);if(v){p.url&&v.tiles&&p.tiles&&delete p.tiles;const b=c.pick(c.extend(v,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);v.vector_layers&&(b.vectorLayers=v.vector_layers,b.vectorLayerIds=b.vectorLayers.map(C=>C.id)),b.tiles=r.canonicalizeTileset(b,p.url),u(null,b)}};return p.url?c.getJSON(r.transformRequest(r.normalizeSourceURL(p.url,null,l,_),c.ResourceType.Source),d):c.exported.frame(()=>d(null,p))}class Vn{constructor(r,l,_){this.bounds=c.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=l||0,this.maxzoom=_||24}validateBounds(r){return Array.isArray(r)&&4===r.length?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const l=Math.pow(2,r.z),_=Math.floor(c.mercatorXfromLng(this.bounds.getWest())*l),u=Math.floor(c.mercatorYfromLat(this.bounds.getNorth())*l),d=Math.ceil(c.mercatorXfromLng(this.bounds.getEast())*l),f=Math.ceil(c.mercatorYfromLat(this.bounds.getSouth())*l);return r.x>=_&&r.x<d&&r.y>=u&&r.y<f}}class zn{constructor(r,l,_){this.context=r;const u=r.gl;this.buffer=u.createBuffer(),this.dynamicDraw=Boolean(_),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),u.bufferData(u.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?u.DYNAMIC_DRAW:u.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const cr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Ar{constructor(r,l,_,u){this.length=l.length,this.attributes=_,this.itemSize=l.bytesPerElement,this.dynamicDraw=u,this.context=r;const d=r.gl;this.buffer=d.createBuffer(),r.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,l){for(let _=0;_<this.attributes.length;_++){const u=l.attributes[this.attributes[_].name];void 0!==u&&r.enableVertexAttribArray(u)}}setVertexAttribPointers(r,l,_){for(let u=0;u<this.attributes.length;u++){const d=this.attributes[u],f=l.attributes[d.name];void 0!==f&&r.vertexAttribPointer(f,d.components,r[cr[d.type]],!1,this.itemSize,d.offset+this.itemSize*(_||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class nn{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Kr extends nn{getDefault(){return c.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class Pr extends nn{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Zo extends nn{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class Rr extends nn{getDefault(){return[!0,!0,!0,!0]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Yr extends nn{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class vi extends nn{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class xn extends nn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const l=this.current;(r.func!==l.func||r.ref!==l.ref||r.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class kr extends nn{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Wi extends nn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=r,this.dirty=!1}}class di extends nn{getDefault(){return[0,1]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class zo extends nn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=r,this.dirty=!1}}class sr extends nn{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class br extends nn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.BLEND):l.disable(l.BLEND),this.current=r,this.dirty=!1}}class Ai extends nn{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class Er extends nn{getDefault(){return c.Color.transparent}set(r){const l=this.current;(r.r!==l.r||r.g!==l.g||r.b!==l.b||r.a!==l.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class un extends nn{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class ht extends nn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;r?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=r,this.dirty=!1}}class Lr extends nn{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Jr extends nn{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class tr extends nn{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class ro extends nn{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class Pi extends nn{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const l=this.current;(r[0]!==l[0]||r[1]!==l[1]||r[2]!==l[2]||r[3]!==l[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class $r extends nn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class jr extends nn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Bo extends nn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class xr extends nn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Ui extends nn{getDefault(){return null}set(r){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Rn extends nn{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class Ri extends nn{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class Zi extends nn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Je extends nn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Fe extends nn{constructor(r,l){super(r),this.context=r,this.parent=l}getDefault(){return null}}class Ne extends Fe{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Rt extends Fe{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class It extends Rt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class On{constructor(r,l,_,u){this.context=r,this.width=l,this.height=_;const d=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Ne(r,d),u&&(this.depthAttachment=new Rt(r,d))}destroy(){const r=this.context.gl,l=this.colorAttachment.get();if(l&&r.deleteTexture(l),this.depthAttachment){const _=this.depthAttachment.get();_&&r.deleteRenderbuffer(_)}r.deleteFramebuffer(this.framebuffer)}}class ce{constructor(r,l=!1){if(this.gl=r,this.isWebGL2=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),l){const _=r;this.extVertexArrayObject={createVertexArrayOES:_.createVertexArray.bind(r),deleteVertexArrayOES:_.deleteVertexArray.bind(r),bindVertexArrayOES:_.bindVertexArray.bind(r)}}this.clearColor=new Kr(this),this.clearDepth=new Pr(this),this.clearStencil=new Zo(this),this.colorMask=new Rr(this),this.depthMask=new Yr(this),this.stencilMask=new vi(this),this.stencilFunc=new xn(this),this.stencilOp=new kr(this),this.stencilTest=new Wi(this),this.depthRange=new di(this),this.depthTest=new zo(this),this.depthFunc=new sr(this),this.blend=new br(this),this.blendFunc=new Ai(this),this.blendColor=new Er(this),this.blendEquation=new un(this),this.cullFace=new ht(this),this.cullFaceSide=new Lr(this),this.frontFace=new Jr(this),this.program=new tr(this),this.activeTexture=new ro(this),this.viewport=new Pi(this),this.bindFramebuffer=new $r(this),this.bindRenderbuffer=new jr(this),this.bindTexture=new Bo(this),this.bindVertexBuffer=new xr(this),this.bindElementBuffer=new Ui(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Rn(this),this.pixelStoreUnpack=new Ri(this),this.pixelStoreUnpackPremultiplyAlpha=new Zi(this),this.pixelStoreUnpackFlipY=new Je(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),l||(this.extTextureHalfFloat=r.getExtension("OES_texture_half_float")),(l||this.extTextureHalfFloat&&r.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=l||r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,l){return new zn(this,r,l)}createVertexBuffer(r,l,_){return new Ar(this,r,l,_)}createRenderbuffer(r,l,_){const u=this.gl,d=u.createRenderbuffer();return this.bindRenderbuffer.set(d),u.renderbufferStorage(u.RENDERBUFFER,r,l,_),this.bindRenderbuffer.set(null),d}createFramebuffer(r,l,_){return new On(this,r,l,_)}clear({color:r,depth:l,stencil:_}){const u=this.gl;let d=0;r&&(d|=u.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),void 0!==l&&(d|=u.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),void 0!==_&&(d|=u.STENCIL_BUFFER_BIT,this.clearStencil.set(_),this.stencilMask.set(255)),u.clear(d)}setCullFace(r){!1===r.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){Le(r.blendFunction,c.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class q extends c.Evented{constructor(r,l,_,u){if(super(),this.id=r,this.dispatcher=_,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.extend(this,c.pick(l,["url","scheme","tileSize","promoteId"])),this._options=c.extend({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(u),this._tileWorkers={},this._deduped=new c.DedupedRequest}load(r){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,_=this.map._worldview;this._tileJSONRequest=er(this._options,this.map._requestManager,l,_,(u,d)=>{this._tileJSONRequest=null,this._loaded=!0,u?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),_&&2!==_.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${_}`),this.fire(new c.ErrorEvent(u))):d&&(c.extend(this,d),d.bounds&&(this.tileBounds=new Vn(d.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(d.tiles,this.map._requestManager._customAccessToken),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(u)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return c.extend({},this._options)}loadTile(r,l){const _=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),u={request:this.map._requestManager.transformRequest(_,c.ResourceType.Tile),data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile};if(u.request.collectResourceTiming=this._collectResourceTiming,r.actor&&"expired"!==r.state)"loading"===r.state?r.reloadCallback=l:r.request=r.actor.send("reloadTile",u,d.bind(this));else if(r.actor=this._tileWorkers[_]=this._tileWorkers[_]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",u,d.bind(this),void 0,!0);else{const f=c.loadVectorTile.call({deduped:this._deduped},u,(v,b)=>{v||!b?d.call(this,v):(u.data={cacheControl:b.cacheControl,expires:b.expires,rawData:b.rawData.slice(0)},r.actor&&r.actor.send("loadTile",u,d.bind(this),void 0,!0))},!0);r.request={cancel:f}}function d(f,v){return delete r.request,r.aborted?l(null):f&&404!==f.status?l(f):(v&&v.resourceTiming&&(r.resourceTiming=v.resourceTiming),this.map._refreshExpiredTiles&&v&&r.setExpiryData(v),r.loadVectorData(v,this.map.painter),c.cacheEntryPossiblyAdded(this.dispatcher),l(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id})}unloadTile(r){r.unloadVectorData(),r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Y extends c.Evented{constructor(r,l,_,u){super(),this.id=r,this.dispatcher=_,this.setEventedParent(u),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.extend({type:"raster"},l),c.extend(this,c.pick(l,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=er(this._options,this.map._requestManager,null,null,(l,_)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new c.ErrorEvent(l)):_&&(c.extend(this,_),_.bounds&&(this.tileBounds=new Vn(_.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(_.tiles),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(l)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return c.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,l){const _=c.exported.devicePixelRatio>=2,u=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),_,this.tileSize);r.request=c.getImage(this.map._requestManager.transformRequest(u,c.ResourceType.Tile),(d,f,v,b)=>(delete r.request,r.aborted?(r.state="unloaded",l(null)):d?(r.state="errored",l(d)):f?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:v,expires:b}),r.setTexture(f,this.map.painter),r.state="loaded",c.cacheEntryPossiblyAdded(this.dispatcher),void l(null)):l(null)))}static loadTileData(r,l,_){r.setTexture(l,_)}static unloadTileData(r,l){r.texture&&l.saveTileTexture(r.texture)}abortTile(r,l){r.request&&(r.request.cancel(),delete r.request),l()}unloadTile(r,l){r.texture&&this.map.painter.saveTileTexture(r.texture),l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let de;function Ee(p,r,l,_,u,d,f,v){const b=[p,l,u,r,_,d,1,1,1],C=[f,v,1],S=c.adjoint([],b),[z,H,ee]=c.transformMat3(C,C,c.transpose(S,S));return c.multiply$1(b,[z,0,0,0,H,0,0,0,ee],b)}class ie extends c.Evented{constructor(r,l,_,u){super(),this.id=r,this.dispatcher=_,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(u),this.options=l,this._dirty=!1}load(r,l){this._loaded=l||!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=c.getImage(this.map._requestManager.transformRequest(this.url,c.ResourceType.Image),(_,u)=>{if(this._imageRequest=null,this._loaded=!0,_)this.fire(new c.ErrorEvent(_));else if(u){const{HTMLImageElement:d}=c.window;this.image=u instanceof d?c.exported.getImageData(u):u,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const l=r.map(c.MercatorCoordinate.fromLngLat);return this.tileID=function(_){let u=1/0,d=1/0,f=-1/0,v=-1/0;for(const z of _)u=Math.min(u,z.x),d=Math.min(d,z.y),f=Math.max(f,z.x),v=Math.max(v,z.y);const b=Math.max(f-u,v-d),C=Math.max(0,Math.floor(-Math.log(b)/Math.LN2)),S=Math.pow(2,C);return new c.CanonicalTileID(C,Math.floor((u+f)/2*S),Math.floor((d+v)/2*S))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const b in this.tiles){const C=this.tiles[b];"loaded"!==C.state&&(C.state="loaded",C.texture=this.texture)}if(this._boundsArray)return;const l=c.tileTransform(this.tileID,this.map.transform.projection),[_,u,d,f]=this.coordinates.map(b=>{const C=l.projection.project(b[0],b[1]);return c.getTilePoint(l,C)._round()});this.perspectiveTransform=function(b,C,S,z,H,ee,re,ue,fe,ne){const we=Ee(0,0,b,0,0,C,b,C),xe=Ee(S,z,H,ee,re,ue,fe,ne);return c.multiply$1(xe,c.adjoint(we,we),xe),[xe[6]/xe[8]*b/c.EXTENT,xe[7]/xe[8]*C/c.EXTENT]}(this.width,this.height,_.x,_.y,u.x,u.y,f.x,f.y,d.x,d.y);const v=this._boundsArray=new c.StructArrayLayout4i8;v.emplaceBack(_.x,_.y,0,0),v.emplaceBack(u.x,u.y,c.EXTENT,0),v.emplaceBack(f.x,f.y,0,c.EXTENT),v.emplaceBack(d.x,d.y,c.EXTENT,c.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(v,c.boundsAttributes.members),this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const r=this.map.painter.context,l=r.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new c.Texture(r,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(r)}loadTile(r,l){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},l(null)):(r.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const se={vector:q,raster:Y,"raster-dem":class extends Y{constructor(p,r,l,_){super(p,r,l,_),this.type="raster-dem",this.maxzoom=22,this._options=c.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(p,r){const l=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function _(u,d){u&&(p.state="errored",r(u)),d&&(p.dem=d,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",r(null))}p.request=c.getImage(this.map._requestManager.transformRequest(l,c.ResourceType.Tile),function(u,d,f,v){if(delete p.request,p.aborted)p.state="unloaded",r(null);else if(u)p.state="errored",r(u);else if(d){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:f,expires:v});const b=c.window.ImageBitmap&&d instanceof c.window.ImageBitmap&&(null==de&&(de=c.window.OffscreenCanvas&&new c.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof c.window.createImageBitmap),de),C=1-(d.width-c.prevPowerOfTwo(d.width))/2;C<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const S=b?d:c.exported.getImageData(d,C),z={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:S,encoding:this.encoding,padding:C};p.actor&&"expired"!==p.state||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",z,_.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const r=p.canonical,l=Math.pow(2,r.z),_=(r.x-1+l)%l,u=0===r.x?p.wrap-1:p.wrap,d=(r.x+1+l)%l,f=r.x+1===l?p.wrap+1:p.wrap,v={};return v[new c.OverscaledTileID(p.overscaledZ,u,r.z,_,r.y).key]={backfilled:!1},v[new c.OverscaledTileID(p.overscaledZ,f,r.z,d,r.y).key]={backfilled:!1},r.y>0&&(v[new c.OverscaledTileID(p.overscaledZ,u,r.z,_,r.y-1).key]={backfilled:!1},v[new c.OverscaledTileID(p.overscaledZ,p.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},v[new c.OverscaledTileID(p.overscaledZ,f,r.z,d,r.y-1).key]={backfilled:!1}),r.y+1<l&&(v[new c.OverscaledTileID(p.overscaledZ,u,r.z,_,r.y+1).key]={backfilled:!1},v[new c.OverscaledTileID(p.overscaledZ,p.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},v[new c.OverscaledTileID(p.overscaledZ,f,r.z,d,r.y+1).key]={backfilled:!1}),v}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends c.Evented{constructor(p,r,l,_){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(_),this._data=r.data,this._options=c.extend({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const u=c.EXTENT/this.tileSize;this.workerOptions=c.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*u,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*u,extent:c.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:c.EXTENT,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*u,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},r),this}getClusterChildren(p,r){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},r),this}getClusterLeaves(p,r,l,_){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:r,offset:l},_),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new c.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=c.extend({},this.workerOptions),r=this._data;"string"==typeof r?(p.request=this.map._requestManager.transformRequest(c.exported.resolveURL(r),c.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(l,_)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new c.ErrorEvent(l));else{const u={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&_&&_.resourceTiming&&_.resourceTiming[this.id]&&(u.resourceTiming=_.resourceTiming[this.id]),this.fire(new c.Event("data",u)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,r){const l=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(l,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(_,u)=>(delete p.request,p.unloadVectorData(),p.aborted?r(null):_?r(_):(p.loadVectorData(u,this.map.painter,"reloadTile"===l),r(null))),void 0,"loadTile"===l)}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return c.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ie{constructor(p,r,l,_){super(p,r,l,_),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const r of p.urls)this.urls.push(this.map._requestManager.transformRequest(r,c.ResourceType.Source).url);c.getVideo(this.urls,(r,l)=>{this._loaded=!0,r?this.fire(new c.ErrorEvent(r)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const r=this.video.seekable;p<r.start(0)||p>r.end(0)?this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const p=this.map.painter.context,r=p.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new c.Texture(p,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ie,canvas:class extends ie{constructor(p,r,l,_){super(p,r,l,_),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(u=>!Array.isArray(u)||2!==u.length||u.some(d=>"number"!=typeof d))||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof c.window.HTMLCanvasElement||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof c.window.HTMLCanvasElement?this.options.canvas:c.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const r=this.map.painter.context;this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends c.Evented{constructor(p,r,l,_){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=r,this.setEventedParent(_),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new c.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new c.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Vn(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),c.extend(this,c.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return c.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:r,y:l,z:_}=p.canonical;return this._implementation.hasTile({x:r,y:l,z:_})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,r){const{x:l,y:_,z:u}=p.tileID.canonical,d=new c.window.AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:l,y:_,z:u},{signal:d.signal})).then(function(f){return delete p.request,p.aborted?(p.state="unloaded",r(null)):void 0===f?(p.state="errored",r(null)):null===f?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",r(null)):(v=f)instanceof c.window.ImageData||v instanceof c.window.HTMLCanvasElement||v instanceof c.window.ImageBitmap||v instanceof c.window.HTMLImageElement?(this.loadTileData(p,f),p.state="loaded",void r(null)):(p.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var v}.bind(this)).catch(f=>{20!==f.code&&(p.state="errored",r(f))}),p.request.cancel=()=>d.abort()}loadTileData(p,r){Y.loadTileData(p,r,this._map.painter)}unloadTileData(p){Y.unloadTileData(p,this._map.painter)}unloadTile(p,r){if(this.unloadTileData(p),this._implementation.unloadTile){const{x:l,y:_,z:u}=p.tileID.canonical;this._implementation.unloadTile({x:l,y:_,z:u})}r()}abortTile(p,r){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))}}},X=function(p,r,l,_){const u=new se[r.type](p,r,l,_);if(u.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${u.id}`);return c.bindAll(["load","abort","unload","serialize","prepare"],u),u};function oe(p,r){const l=c.identity([]);return c.scale(l,l,[.5*p.width,.5*-p.height,1]),c.translate(l,l,[1,-1,0]),c.multiply(l,l,p.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(l)}function _e(p,r,l,_,u,d,f,v=!1){const b=p.tilesIn(_,f,v);b.sort(ct);const C=[];for(const z of b)C.push({wrappedTileID:z.tile.tileID.wrapped().key,queryResults:z.tile.queryRenderedFeatures(r,l,p._state,z,u,d,oe(p.transform,z.tile.tileID),v)});const S=function(z){const H={},ee={};for(const re of z){const ue=re.queryResults,fe=re.wrappedTileID,ne=ee[fe]=ee[fe]||{};for(const we in ue){const xe=ue[we],be=ne[we]=ne[we]||{},Re=H[we]=H[we]||[];for(const Ae of xe)be[Ae.featureIndex]||(be[Ae.featureIndex]=!0,Re.push(Ae))}}return H}(C);for(const z in S)S[z].forEach(H=>{const ee=H.feature,re=ee.layer;re&&"background"!==re.type&&"sky"!==re.type&&(ee.source=re.source,re["source-layer"]&&(ee.sourceLayer=re["source-layer"]),ee.state=void 0!==ee.id?p.getFeatureState(re["source-layer"],ee.id):{})});return S}function Ue(p,r){const l=p.getRenderableIds().map(d=>p.getTileByID(d)),_=[],u={};for(let d=0;d<l.length;d++){const f=l[d],v=f.tileID.canonical.key;u[v]||(u[v]=!0,f.querySourceFeatures(_,r))}return _}function ct(p,r){const l=p.tileID,_=r.tileID;return l.overscaledZ-_.overscaledZ||l.canonical.y-_.canonical.y||l.wrap-_.wrap||l.canonical.x-_.canonical.x}function lt(){return null!=ba.workerClass?new ba.workerClass:new c.window.Worker(ba.workerUrl)}const kt="mapboxgl_preloaded_worker_pool";class hn{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<hn.workerCount;)this.workers.push(new lt);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],0===this.numActive()&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[kt]}numActive(){return Object.keys(this.active).length}}let Lt;function mn(){return Lt||(Lt=new hn),Lt}function Qn(p,r){const l={};for(const _ in p)"ref"!==_&&(l[_]=p[_]);return c.refProperties.forEach(_=>{_ in r&&(l[_]=r[_])}),l}function nr(p){p=p.slice();const r=Object.create(null);for(let l=0;l<p.length;l++)r[p[l].id]=p[l];for(let l=0;l<p.length;l++)"ref"in p[l]&&(p[l]=Qn(p[l],r[p[l].ref]));return p}hn.workerCount=2;const En={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function zr(p,r,l){l.push({command:En.addSource,args:[p,r[p]]})}function Cr(p,r,l){r.push({command:En.removeSource,args:[p]}),l[p]=!0}function Xo(p,r,l,_){Cr(p,l,_),zr(p,r,l)}function ki(p,r,l){let _;for(_ in p[l])if(p[l].hasOwnProperty(_)&&"data"!==_&&!Le(p[l][_],r[l][_]))return!1;for(_ in r[l])if(r[l].hasOwnProperty(_)&&"data"!==_&&!Le(p[l][_],r[l][_]))return!1;return!0}function st(p,r,l,_,u,d){let f;for(f in r=r||{},p=p||{})p.hasOwnProperty(f)&&(Le(p[f],r[f])||l.push({command:d,args:[_,f,r[f],u]}));for(f in r)r.hasOwnProperty(f)&&!p.hasOwnProperty(f)&&(Le(p[f],r[f])||l.push({command:d,args:[_,f,r[f],u]}))}function Qr(p){return p.id}function xi(p,r){return p[r.id]=r,p}class ls{constructor(r,l){this.reset(r,l)}reset(r,l){this.points=r||[],this._distances=[0];for(let _=1;_<this.points.length;_++)this._distances[_]=this._distances[_-1]+this.points[_].dist(this.points[_-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(1===this.points.length)return this.points[0];r=c.clamp(r,0,1);let l=1,_=this._distances[l];const u=r*this.paddedLength+this.padding;for(;_<u&&l<this._distances.length;)_=this._distances[++l];const d=l-1,f=this._distances[d],v=_-f,b=v>0?(u-f)/v:0;return this.points[d].mult(1-b).add(this.points[l].mult(b))}}class Ba{constructor(r,l,_){const u=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(r/_),this.yCellCount=Math.ceil(l/_);for(let f=0;f<this.xCellCount*this.yCellCount;f++)u.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=l,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,l,_,u,d){this._forEachCell(l,_,u,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(l),this.bboxes.push(_),this.bboxes.push(u),this.bboxes.push(d)}insertCircle(r,l,_,u){this._forEachCell(l-u,_-u,l+u,_+u,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(l),this.circles.push(_),this.circles.push(u)}_insertBoxCell(r,l,_,u,d,f){this.boxCells[d].push(f)}_insertCircleCell(r,l,_,u,d,f){this.circleCells[d].push(f)}_query(r,l,_,u,d,f){if(_<0||r>this.width||u<0||l>this.height)return!d&&[];const v=[];if(r<=0&&l<=0&&this.width<=_&&this.height<=u){if(d)return!0;for(let b=0;b<this.boxKeys.length;b++)v.push({key:this.boxKeys[b],x1:this.bboxes[4*b],y1:this.bboxes[4*b+1],x2:this.bboxes[4*b+2],y2:this.bboxes[4*b+3]});for(let b=0;b<this.circleKeys.length;b++){const C=this.circles[3*b],S=this.circles[3*b+1],z=this.circles[3*b+2];v.push({key:this.circleKeys[b],x1:C-z,y1:S-z,x2:C+z,y2:S+z})}return f?v.filter(f):v}return this._forEachCell(r,l,_,u,this._queryCell,v,{hitTest:d,seenUids:{box:{},circle:{}}},f),d?v.length>0:v}_queryCircle(r,l,_,u,d){const f=r-_,v=r+_,b=l-_,C=l+_;if(v<0||f>this.width||C<0||b>this.height)return!u&&[];const S=[];return this._forEachCell(f,b,v,C,this._queryCellCircle,S,{hitTest:u,circle:{x:r,y:l,radius:_},seenUids:{box:{},circle:{}}},d),u?S.length>0:S}query(r,l,_,u,d){return this._query(r,l,_,u,!1,d)}hitTest(r,l,_,u,d){return this._query(r,l,_,u,!0,d)}hitTestCircle(r,l,_,u){return this._queryCircle(r,l,_,!0,u)}_queryCell(r,l,_,u,d,f,v,b){const C=v.seenUids,S=this.boxCells[d];if(null!==S){const H=this.bboxes;for(const ee of S)if(!C.box[ee]){C.box[ee]=!0;const re=4*ee;if(r<=H[re+2]&&l<=H[re+3]&&_>=H[re+0]&&u>=H[re+1]&&(!b||b(this.boxKeys[ee]))){if(v.hitTest)return f.push(!0),!0;f.push({key:this.boxKeys[ee],x1:H[re],y1:H[re+1],x2:H[re+2],y2:H[re+3]})}}}const z=this.circleCells[d];if(null!==z){const H=this.circles;for(const ee of z)if(!C.circle[ee]){C.circle[ee]=!0;const re=3*ee;if(this._circleAndRectCollide(H[re],H[re+1],H[re+2],r,l,_,u)&&(!b||b(this.circleKeys[ee]))){if(v.hitTest)return f.push(!0),!0;{const ue=H[re],fe=H[re+1],ne=H[re+2];f.push({key:this.circleKeys[ee],x1:ue-ne,y1:fe-ne,x2:ue+ne,y2:fe+ne})}}}}}_queryCellCircle(r,l,_,u,d,f,v,b){const C=v.circle,S=v.seenUids,z=this.boxCells[d];if(null!==z){const ee=this.bboxes;for(const re of z)if(!S.box[re]){S.box[re]=!0;const ue=4*re;if(this._circleAndRectCollide(C.x,C.y,C.radius,ee[ue+0],ee[ue+1],ee[ue+2],ee[ue+3])&&(!b||b(this.boxKeys[re])))return f.push(!0),!0}}const H=this.circleCells[d];if(null!==H){const ee=this.circles;for(const re of H)if(!S.circle[re]){S.circle[re]=!0;const ue=3*re;if(this._circlesCollide(ee[ue],ee[ue+1],ee[ue+2],C.x,C.y,C.radius)&&(!b||b(this.circleKeys[re])))return f.push(!0),!0}}}_forEachCell(r,l,_,u,d,f,v,b){const C=this._convertToXCellCoord(r),S=this._convertToYCellCoord(l),z=this._convertToXCellCoord(_),H=this._convertToYCellCoord(u);for(let ee=C;ee<=z;ee++)for(let re=S;re<=H;re++)if(d.call(this,r,l,_,u,this.xCellCount*re+ee,f,v,b))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,l,_,u,d,f){const v=u-r,b=d-l,C=_+f;return C*C>v*v+b*b}_circleAndRectCollide(r,l,_,u,d,f,v){const b=(f-u)/2,C=Math.abs(r-(u+b));if(C>b+_)return!1;const S=(v-d)/2,z=Math.abs(l-(d+S));if(z>S+_)return!1;if(C<=b||z<=S)return!0;const H=C-b,ee=z-S;return H*H+ee*ee<=_*_}}const Li=Math.tan(85*Math.PI/180);function ar(p,r,l,_,u,d,f){const v=c.create();if(l)if("globe"===d.name){const b=c.calculateGlobeLabelMatrix(u,r);c.multiply(v,v,b)}else{const b=je([],f);v[0]=b[0],v[1]=b[1],v[4]=b[2],v[5]=b[3],_||c.rotateZ(v,v,u.angle)}else c.multiply(v,u.labelPlaneMatrix,p);return v}function oi(p,r,l,_,u,d,f){const v=ar(p,r,l,_,u,d,f);return"globe"===d.name&&l||(v[2]=v[6]=v[10]=v[14]=0),v}function Ei(p,r,l,_,u,d,f){if(l){if("globe"===d.name){const v=ar(p,r,l,_,u,d,f);return c.invert(v,v),c.multiply(v,p,v),v}{const v=c.clone(p),b=c.identity([]);return b[0]=f[0],b[1]=f[1],b[4]=f[2],b[5]=f[3],c.multiply(v,v,b),_||c.rotateZ(v,v,-u.angle),v}}return u.glCoordMatrix}function $t(p,r,l,_){const u=[p,r,l,1];l?c.transformMat4$1(u,u,_):Oi(u,u,_);const d=u[3];return u[0]/=d,u[1]/=d,u[2]/=d,u}function kn(p,r){return Math.min(.5+p/r*.5,1.5)}function Yn(p,r){const l=p[0]/p[3],_=p[1]/p[3];return l>=-r[0]&&l<=r[0]&&_>=-r[1]&&_<=r[1]}function xo(p,r,l,_,u,d,f,v,b,C){const S=l.transform,z=_?p.textSizeData:p.iconSizeData,H=c.evaluateSizeForZoom(z,l.transform.zoom),ee="globe"===S.projection.name,re=[256/l.width*2+1,256/l.height*2+1],ue=_?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;ue.clear();let fe=null;ee&&(fe=_?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const ne=p.lineVertexArray,we=_?p.text.placedSymbolArray:p.icon.placedSymbolArray,xe=l.transform.width/l.transform.height;let be,Re=!1;for(let Ae=0;Ae<we.length;Ae++){const ze=we.get(Ae),{numGlyphs:qe,writingMode:Ke}=ze;if(Ke!==c.WritingMode.vertical||Re||be===c.WritingMode.horizontal||(Re=!0),be=Ke,(ze.hidden||Ke===c.WritingMode.vertical)&&!Re){dr(qe,ue);continue}Re=!1;const Qe=new c.pointGeometry(ze.tileAnchorX,ze.tileAnchorY);let{x:Ht,y:Ze,z:bt}=S.projection.projectTilePoint(Qe.x,Qe.y,C.canonical);if(b){const[_r,wn,ln]=b(Qe);Ht+=_r,Ze+=wn,bt+=ln}const ut=[Ht,Ze,bt,1];if(c.transformMat4$1(ut,ut,r),!Yn(ut,re)){dr(qe,ue);continue}const Ct=kn(l.transform.cameraToCenterDistance,ut[3]),Ye=c.evaluateSizeForFeature(z,H,ze),He=f?Ye/Ct:Ye*Ct,rt=$t(Ht,Ze,bt,u);if(rt[3]<=0){dr(qe,ue);continue}let St={};const Nt=f?null:b,An=pn(ze,He,!1,v,r,u,d,p.glyphOffsetArray,ne,ue,fe,rt,Qe,St,xe,Nt,S.projection,C,f);Re=An.useVertical,Nt&&An.needsFlipping&&(St={}),(An.notEnoughRoom||Re||An.needsFlipping&&pn(ze,He,!0,v,r,u,d,p.glyphOffsetArray,ne,ue,fe,rt,Qe,St,xe,Nt,S.projection,C,f).notEnoughRoom)&&dr(qe,ue)}_?(p.text.dynamicLayoutVertexBuffer.updateData(ue),fe&&p.text.globeExtVertexBuffer.updateData(fe)):(p.icon.dynamicLayoutVertexBuffer.updateData(ue),fe&&p.icon.globeExtVertexBuffer.updateData(fe))}function No(p,r,l,_,u,d,f,v,b,C,S,z,H,ee,re,ue){const{lineStartIndex:fe,glyphStartIndex:ne,segment:we}=v,xe=ne+v.numGlyphs,be=fe+v.lineLength,Re=r.getoffsetX(ne),Ae=r.getoffsetX(xe-1),ze=Nr(p*Re,l,_,u,d,f,we,fe,be,b,C,S,z,H,!0,ee,re,ue);if(!ze)return null;const qe=Nr(p*Ae,l,_,u,d,f,we,fe,be,b,C,S,z,H,!0,ee,re,ue);return qe?{first:ze,last:qe}:null}function $n(p,r,l,_){return p===c.WritingMode.horizontal&&Math.abs(_)>Math.abs(l)?{useVertical:!0}:p===c.WritingMode.vertical?_>0?{needsFlipping:!0}:null:0!==r&&(0===(u=l)||Math.abs(_/u)>Li)?1===r?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null;var u}function pn(p,r,l,_,u,d,f,v,b,C,S,z,H,ee,re,ue,fe,ne,we){const xe=r/24,be=p.lineOffsetX*xe,Re=p.lineOffsetY*xe,{lineStartIndex:Ae,glyphStartIndex:ze,numGlyphs:qe,segment:Ke,writingMode:Qe,flipState:Ht}=p,Ze=Ae+p.lineLength,bt=ut=>{if(S){const[rt,St,Nt]=ut.up,An=C.length;c.updateGlobeVertexNormal(S,An+0,rt,St,Nt),c.updateGlobeVertexNormal(S,An+1,rt,St,Nt),c.updateGlobeVertexNormal(S,An+2,rt,St,Nt),c.updateGlobeVertexNormal(S,An+3,rt,St,Nt)}const[Ct,Ye,He]=ut.point;c.addDynamicAttributes(C,Ct,Ye,He,ut.angle)};if(qe>1){const ut=No(xe,v,be,Re,l,z,H,p,b,d,ee,ue,!1,fe,ne,we);if(!ut)return{notEnoughRoom:!0};if(_&&!l){let[Ct,Ye,He]=ut.first.point,[rt,St,Nt]=ut.last.point;[Ct,Ye]=$t(Ct,Ye,He,f),[rt,St]=$t(rt,St,Nt,f);const An=$n(Qe,Ht,(rt-Ct)*re,St-Ye);if(p.flipState=An&&An.needsFlipping?1:2,An)return An}bt(ut.first);for(let Ct=ze+1;Ct<ze+qe-1;Ct++){const Ye=Nr(xe*v.getoffsetX(Ct),be,Re,l,z,H,Ke,Ae,Ze,b,d,ee,ue,!1,!1,fe,ne,we);if(!Ye)return C.length-=4*(Ct-ze),{notEnoughRoom:!0};bt(Ye)}bt(ut.last)}else{if(_&&!l){const Ct=$t(H.x,H.y,0,u),Ye=Ae+Ke+1,He=new c.pointGeometry(b.getx(Ye),b.gety(Ye)),rt=$t(He.x,He.y,0,u),St=rt[3]>0?rt:Br(H,He,Ct,1,u,void 0,fe,ne.canonical),Nt=$n(Qe,Ht,(St[0]-Ct[0])*re,St[1]-Ct[1]);if(p.flipState=Nt&&Nt.needsFlipping?1:2,Nt)return Nt}const ut=Nr(xe*v.getoffsetX(ze),be,Re,l,z,H,Ke,Ae,Ze,b,d,ee,ue,!1,!1,fe,ne,we);if(!ut)return{notEnoughRoom:!0};bt(ut)}return{}}function Jn(p,r,l,_,u){const{x:d,y:f,z:v}=_.projectTilePoint(p.x,p.y,r);if(!u)return $t(d,f,v,l);const[b,C,S]=u(p);return $t(d+b,f+C,v+S,l)}function Br(p,r,l,_,u,d,f,v){const b=Jn(p.sub(r)._unit()._add(p),v,u,f,d);return c.sub(b,l,b),c.normalize(b,b),c.scaleAndAdd(b,l,b,_)}function Nr(p,r,l,_,u,d,f,v,b,C,S,z,H,ee,re,ue,fe,ne){const we=_?p-r:p+r;let xe=we>0?1:-1,be=0;_&&(xe*=-1,be=Math.PI),xe<0&&(be+=Math.PI);let Re=v+f+(xe>0?0:1)|0,Ae=u,ze=u,qe=0,Ke=0;const Qe=Math.abs(we),Ht=[],Ze=[];let bt=d,ut=bt;const Ct=()=>Br(ut,bt,ze,Qe-qe+1,S,H,ue,fe.canonical);for(;qe+Ke<=Qe;){if(Re+=xe,Re<v||Re>=b)return null;if(ze=Ae,ut=bt,Ht.push(ze),ee&&Ze.push(ut),bt=new c.pointGeometry(C.getx(Re),C.gety(Re)),Ae=z[Re],!Ae){const ln=Jn(bt,fe.canonical,S,ue,H);Ae=ln[3]>0?z[Re]=ln:Ct()}qe+=Ke,Ke=c.distance(ze,Ae)}re&&H&&(z[Re]&&(Ae=Ct(),Ke=c.distance(ze,Ae)),z[Re]=Ae);const Ye=(Qe-qe)/Ke,He=bt.sub(ut)._mult(Ye)._add(ut),rt=c.sub([],Ae,ze),St=c.scaleAndAdd([],ze,rt,Ye);let Nt=[0,0,1],An=rt[0],_r=rt[1];if(ne&&(Nt=ue.upVector(fe.canonical,He.x,He.y),0!==Nt[0]||0!==Nt[1]||1!==Nt[2])){const ln=[Nt[2],0,-Nt[0]],Sn=c.cross([],Nt,ln);c.normalize(ln,ln),c.normalize(Sn,Sn),An=c.dot(rt,ln),_r=c.dot(rt,Sn)}if(l){const ln=c.cross([],Nt,rt);c.normalize(ln,ln),c.scaleAndAdd(St,St,ln,l*xe)}const wn=be+Math.atan2(_r,An);return Ht.push(St),ee&&Ze.push(He),{point:St,angle:wn,path:Ht,tilePath:Ze,up:Nt}}function dr(p,r){const l=r.length,_=l+4*p;r.resize(_),r.float32.fill(-1/0,4*l,4*_)}function Oi(p,r,l){const _=r[0],u=r[1];return p[0]=l[0]*_+l[4]*u+l[12],p[1]=l[1]*_+l[5]*u+l[13],p[3]=l[3]*_+l[7]*u+l[15],p}const Wr=100;class fi{constructor(r,l,_=new Ba(r.width+200,r.height+200,25),u=new Ba(r.width+200,r.height+200,25)){this.transform=r,this.grid=_,this.ignoredGrid=u,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+Wr,this.screenBottomBoundary=r.height+Wr,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=l}placeCollisionBox(r,l,_,u,d,f,v,b){let C=_.projectedAnchorX,S=_.projectedAnchorY,z=_.projectedAnchorZ;const H=_.elevation,ee=_.tileID,re=r.getProjection();if(H&&ee){const[Ae,ze,qe]=re.upVector(ee.canonical,_.tileAnchorX,_.tileAnchorY),Ke=re.upVectorScale(ee.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;C+=Ae*H*Ke,S+=ze*H*Ke,z+=qe*H*Ke}const ue=this.projectAndGetPerspectiveRatio(v,C,S,z,_.tileID,"globe"===re.name||!!H||this.transform.pitch>0,re),fe=f*ue.perspectiveRatio,ne=(_.x1*l+u.x-_.padding)*fe+ue.point.x,we=(_.y1*l+u.y-_.padding)*fe+ue.point.y,xe=(_.x2*l+u.x+_.padding)*fe+ue.point.x,be=(_.y2*l+u.y+_.padding)*fe+ue.point.y,Re=ue.perspectiveRatio<=.55||ue.occluded;return!this.isInsideGrid(ne,we,xe,be)||!d&&this.grid.hitTest(ne,we,xe,be,b)||Re?{box:[],offscreen:!1,occluded:ue.occluded}:{box:[ne,we,xe,be],offscreen:this.isOffscreen(ne,we,xe,be),occluded:!1}}placeCollisionCircles(r,l,_,u,d,f,v,b,C,S,z,H,ee,re,ue){const fe=[],ne=this.transform.elevation,we=r.getProjection(),xe=ne?ne.getAtTileOffsetFunc(ue,this.transform.center.lat,this.transform.worldSize,we):null,be=new c.pointGeometry(_.tileAnchorX,_.tileAnchorY);let{x:Re,y:Ae,z:ze}=we.projectTilePoint(be.x,be.y,ue.canonical);if(xe){const[He,rt,St]=xe(be);Re+=He,Ae+=rt,ze+=St}const qe="globe"===we.name,Ke=this.projectAndGetPerspectiveRatio(v,Re,Ae,ze,ue,qe||!!ne||this.transform.pitch>0,we),{perspectiveRatio:Qe}=Ke,Ht=(z?f/Qe:f*Qe)/c.ONE_EM,Ze=$t(Re,Ae,ze,b),bt=Ke.signedDistanceFromCamera>0?No(Ht,d,_.lineOffsetX*Ht,_.lineOffsetY*Ht,!1,Ze,be,_,u,b,{},ne&&!z?xe:null,z&&!!ne,we,ue,z):null;let ut=!1,Ct=!1,Ye=!0;if(bt&&!Ke.occluded){const He=.5*ee*Qe+re,rt=new c.pointGeometry(-100,-100),St=new c.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Nt=new ls,{first:An,last:_r}=bt,wn=An.path.length;let ln=[];for(let Fn=wn-1;Fn>=1;Fn--)ln.push(An.path[Fn]);for(let Fn=1;Fn<_r.path.length;Fn++)ln.push(_r.path[Fn]);const Sn=2.5*He;C&&(ln=ln.map(([Fn,ei,ci],bi)=>(xe&&!qe&&(ci=xe(bi<wn-1?An.tilePath[wn-1-bi]:_r.tilePath[bi-wn+2])[2]),$t(Fn,ei,ci,C))),ln.some(Fn=>Fn[3]<=0)&&(ln=[]));let Mr=[];if(ln.length>0){let Fn=1/0,ei=-1/0,ci=1/0,bi=-1/0;for(const Si of ln)Fn=Math.min(Fn,Si[0]),ci=Math.min(ci,Si[1]),ei=Math.max(ei,Si[0]),bi=Math.max(bi,Si[1]);ei>=rt.x&&Fn<=St.x&&bi>=rt.y&&ci<=St.y&&(Mr=[ln.map(Si=>new c.pointGeometry(Si[0],Si[1]))],(Fn<rt.x||ei>St.x||ci<rt.y||bi>St.y)&&(Mr=c.clipLine(Mr,rt.x,rt.y,St.x,St.y)))}for(const Fn of Mr){Nt.reset(Fn,.25*He);let ei=0;ei=Nt.length<=.5*He?1:Math.ceil(Nt.paddedLength/Sn)+1;for(let ci=0;ci<ei;ci++){const bi=ci/Math.max(ei-1,1),Si=Nt.lerp(bi),To=Si.x+Wr,ea=Si.y+Wr;fe.push(To,ea,He,0);const Ea=To-He,Ul=ea-He,Yi=To+He,ui=ea+He;if(Ye=Ye&&this.isOffscreen(Ea,Ul,Yi,ui),Ct=Ct||this.isInsideGrid(Ea,Ul,Yi,ui),!l&&this.grid.hitTestCircle(To,ea,He,H)&&(ut=!0,!S))return{circles:[],offscreen:!1,collisionDetected:ut,occluded:!1}}}}return{circles:!S&&ut||!Ct?[]:fe,offscreen:Ye,collisionDetected:ut,occluded:Ke.occluded}}queryRenderedSymbols(r){if(0===r.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const l=[];let _=1/0,u=1/0,d=-1/0,f=-1/0;for(const S of r){const z=new c.pointGeometry(S.x+Wr,S.y+Wr);_=Math.min(_,z.x),u=Math.min(u,z.y),d=Math.max(d,z.x),f=Math.max(f,z.y),l.push(z)}const v=this.grid.query(_,u,d,f).concat(this.ignoredGrid.query(_,u,d,f)),b={},C={};for(const S of v){const z=S.key;if(void 0===b[z.bucketInstanceId]&&(b[z.bucketInstanceId]={}),b[z.bucketInstanceId][z.featureIndex])continue;const H=[new c.pointGeometry(S.x1,S.y1),new c.pointGeometry(S.x2,S.y1),new c.pointGeometry(S.x2,S.y2),new c.pointGeometry(S.x1,S.y2)];c.polygonIntersectsPolygon(l,H)&&(b[z.bucketInstanceId][z.featureIndex]=!0,void 0===C[z.bucketInstanceId]&&(C[z.bucketInstanceId]=[]),C[z.bucketInstanceId].push(z.featureIndex))}return C}insertCollisionBox(r,l,_,u,d){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:_,featureIndex:u,collisionGroupID:d},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,l,_,u,d){const f=l?this.ignoredGrid:this.grid,v={bucketInstanceId:_,featureIndex:u,collisionGroupID:d};for(let b=0;b<r.length;b+=4)f.insertCircle(v,r[b],r[b+1],r[b+2])}projectAndGetPerspectiveRatio(r,l,_,u,d,f,v){const b=[l,_,u,1];let C=!1;u||this.transform.pitch>0?(c.transformMat4$1(b,b,r),this.fogState&&d&&"globe"!==v.name&&(C=function(ee,re,ue,fe,ne,we){const xe=we.calculateFogTileMatrix(ne),be=[re,ue,fe];return c.transformMat4(be,be,xe),dn(ee,be,we.pitch,we._fov)}(this.fogState,l,_,u,d.toUnwrapped(),this.transform)>.9)):Oi(b,b,r);const S=b[3];return{point:new c.pointGeometry((b[0]/S+1)/2*this.transform.width+Wr,(-b[1]/S+1)/2*this.transform.height+Wr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(v)/S*.5,1.5),signedDistanceFromCamera:S,occluded:f&&b[2]>S||C}}isOffscreen(r,l,_,u){return _<Wr||r>=this.screenRightBoundary||u<Wr||l>this.screenBottomBoundary}isInsideGrid(r,l,_,u){return _>=0&&r<this.gridRightBoundary&&u>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const r=c.identity([]);return c.translate(r,r,[-100,-100,0]),r}}function io(p,r,l){const _=r.createTileMatrix(p,p.worldSize,l.toUnwrapped());return c.multiply(new Float32Array(16),p.projMatrix,_)}function oo(p,r,l){if(r.projection.name===l.projection.name)return p.projMatrix;const _=l.clone();return _.setProjection(r.projection),io(_,r.getProjection(),p)}function rr(p,r,l){return r.name===l.projection.name?p.projMatrix:io(l,r,p)}class mo{constructor(r,l,_,u){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?l:-l))):u&&_?1:0,this.placed=_}isHidden(){return 0===this.opacity&&!this.placed}}class lo{constructor(r,l,_,u,d,f=!1){this.text=new mo(r?r.text:null,l,_,d),this.icon=new mo(r?r.icon:null,l,u,d),this.clipped=f}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Fi{constructor(r,l,_,u=!1){this.text=r,this.icon=l,this.skipFade=_,this.clipped=u}}class wo{constructor(){this.invProjMatrix=c.create(),this.viewportMatrix=c.create(),this.circles=[]}}class Vr{constructor(r,l,_,u,d){this.bucketInstanceId=r,this.featureIndex=l,this.sourceLayerIndex=_,this.bucketIndex=u,this.tileID=d}}class Hr{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const l=++this.maxGroupID;this.collisionGroups[r]={ID:l,predicate:_=>_.collisionGroupID===l}}return this.collisionGroups[r]}}function cs(p,r,l,_,u){const{horizontalAlign:d,verticalAlign:f}=c.getAnchorAlignment(p),v=-(d-.5)*r,b=-(f-.5)*l,C=c.evaluateVariableOffset(p,_);return new c.pointGeometry(v+C[0]*u,b+C[1]*u)}function Ti(p,r,l,_,u){const d=new c.pointGeometry(p,r);return l&&d._rotate(_?u:-u),d}class ji{constructor(r,l,_,u,d){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new fi(this.transform,d),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Hr(_),this.collisionCircleArrays={},this.prevPlacement=u,u&&(u.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,l,_,u){const d=_.getBucket(l),f=_.latestFeatureIndex;if(!d||!f||l.id!==d.layerIds[0])return;const v=d.layers[0].layout,b=_.collisionBoxArray,C=Math.pow(2,this.transform.zoom-_.tileID.overscaledZ),S=_.tileSize/c.EXTENT,z=_.tileID.toUnwrapped();this.transform.setProjection(d.projection);const H=(ee=_.tileID,re=d.getProjection(),ue=this.transform,re.name===this.projection?ue.calculateProjMatrix(ee.toUnwrapped()):io(ue,re,ee));var ee,re,ue;const fe="map"===v.get("text-pitch-alignment"),ne="map"===v.get("text-rotation-alignment");l.compileFilter();const we=l.dynamicFilter(),xe=l.dynamicFilterNeedsFeature(),be=this.transform.calculatePixelsToTileUnitsMatrix(_),Re=oi(H,_.tileID.canonical,fe,ne,this.transform,d.getProjection(),be);let Ae=null;if(fe){const Ke=Ei(H,_.tileID.canonical,fe,ne,this.transform,d.getProjection(),be);Ae=c.multiply([],this.transform.labelPlaneMatrix,Ke)}let ze=null;we&&_.latestFeatureIndex&&(ze={unwrappedTileID:z,dynamicFilter:we,dynamicFilterNeedsFeature:xe,featureIndex:_.latestFeatureIndex}),this.retainedQueryData[d.bucketInstanceId]=new Vr(d.bucketInstanceId,f,d.sourceLayerIndex,d.index,_.tileID);const qe={bucket:d,layout:v,posMatrix:H,textLabelPlaneMatrix:Re,labelToScreenMatrix:Ae,clippingData:ze,scale:C,textPixelRatio:S,holdingForFade:_.holdingForFade(),collisionBoxArray:b,partiallyEvaluatedTextSize:c.evaluateSizeForZoom(d.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:c.evaluateSizeForZoom(d.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(u)for(const Ke of d.sortKeyRanges){const{sortKey:Qe,symbolInstanceStart:Ht,symbolInstanceEnd:Ze}=Ke;r.push({sortKey:Qe,symbolInstanceStart:Ht,symbolInstanceEnd:Ze,parameters:qe})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:qe})}attemptAnchorPlacement(r,l,_,u,d,f,v,b,C,S,z,H,ee,re,ue,fe,ne,we){const{textOffset0:xe,textOffset1:be,crossTileID:Re}=H,Ae=[xe,be],ze=cs(r,_,u,Ae,d),qe=this.collisionIndex.placeCollisionBox(re,d,l,Ti(ze.x,ze.y,f,v,this.transform.angle),z,b,C,S.predicate);if(fe){const Ke=re.getSymbolInstanceIconSize(we,this.transform.zoom,H.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(re,Ke,fe,Ti(ze.x,ze.y,f,v,this.transform.angle),z,b,C,S.predicate).box.length)return}if(qe.box.length>0){let Ke;return this.prevPlacement&&this.prevPlacement.variableOffsets[Re]&&this.prevPlacement.placements[Re]&&this.prevPlacement.placements[Re].text&&(Ke=this.prevPlacement.variableOffsets[Re].anchor),this.variableOffsets[Re]={textOffset:Ae,width:_,height:u,anchor:r,textScale:d,prevAnchor:Ke},this.markUsedJustification(re,r,H,ue),re.allowVerticalPlacement&&(this.markUsedOrientation(re,ue,H),this.placedOrientations[Re]=ue),{shift:ze,placedGlyphBoxes:qe}}}placeLayerBucketPart(r,l,_,u){const{bucket:d,layout:f,posMatrix:v,textLabelPlaneMatrix:b,labelToScreenMatrix:C,clippingData:S,textPixelRatio:z,holdingForFade:H,collisionBoxArray:ee,partiallyEvaluatedTextSize:re,partiallyEvaluatedIconSize:ue,collisionGroup:fe}=r.parameters,ne=f.get("text-optional"),we=f.get("icon-optional"),xe=f.get("text-allow-overlap"),be=f.get("icon-allow-overlap"),Re="map"===f.get("text-rotation-alignment"),Ae="map"===f.get("text-pitch-alignment"),ze="none"!==f.get("icon-text-fit"),qe="viewport-y"===f.get("symbol-z-order");this.transform.setProjection(d.projection);let Ke=xe&&(be||!d.hasIconData()||we),Qe=be&&(xe||!d.hasTextData()||ne);!d.collisionArrays&&ee&&d.deserializeCollisionBoxes(ee),_&&u&&d.updateCollisionDebugBuffers(this.transform.zoom,ee);const Ht=(Ze,bt,ut)=>{const{crossTileID:Ct,numVerticalGlyphVertices:Ye}=Ze;if(S){const Yi={zoom:this.transform.zoom,pitch:this.transform.pitch};let ui=null;if(S.dynamicFilterNeedsFeature){const ti=this.retainedQueryData[d.bucketInstanceId];ui=S.featureIndex.loadFeature({featureIndex:Ze.featureIndex,bucketIndex:ti.bucketIndex,sourceLayerIndex:ti.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,S.dynamicFilter)(Yi,ui,this.retainedQueryData[d.bucketInstanceId].tileID.canonical,new c.pointGeometry(Ze.tileAnchorX,Ze.tileAnchorY),this.transform.calculateDistanceTileData(S.unwrappedTileID)))return this.placements[Ct]=new Fi(!1,!1,!1,!0),void(l[Ct]=!0)}if(l[Ct])return;if(H)return void(this.placements[Ct]=new Fi(!1,!1,!1));let He=!1,rt=!1,St=!0,Nt=!1,An=!1,_r=null,wn={box:null,offscreen:null,occluded:null},ln={box:null,offscreen:null,occluded:null},Sn=null,Mr=null,Fn=null,ei=0,ci=0,bi=0;ut.textFeatureIndex?ei=ut.textFeatureIndex:Ze.useRuntimeCollisionCircles&&(ei=Ze.featureIndex),ut.verticalTextFeatureIndex&&(ci=ut.verticalTextFeatureIndex);const Si=Yi=>{Yi.tileID=this.retainedQueryData[d.bucketInstanceId].tileID;const ui=this.transform.elevation;(ui||Yi.elevation)&&(Yi.elevation=ui?ui.getAtTileOffset(Yi.tileID,Yi.tileAnchorX,Yi.tileAnchorY):0)},To=ut.textBox;if(To){Si(To);const Yi=ti=>{let _o=c.WritingMode.horizontal;if(d.allowVerticalPlacement&&!ti&&this.prevPlacement){const js=this.prevPlacement.placedOrientations[Ct];js&&(this.placedOrientations[Ct]=js,_o=js,this.markUsedOrientation(d,_o,Ze))}return _o},ui=(ti,_o)=>{if(d.allowVerticalPlacement&&Ye>0&&ut.verticalTextBox){for(const js of d.writingModes)if(js===c.WritingMode.vertical?(wn=_o(),ln=wn):wn=ti(),wn&&wn.box&&wn.box.length)break}else wn=ti()};if(f.get("text-variable-anchor")){let ti=f.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[Ct]){const Gi=this.prevPlacement.variableOffsets[Ct];ti.indexOf(Gi.anchor)>0&&(ti=ti.filter(Vs=>Vs!==Gi.anchor),ti.unshift(Gi.anchor))}const _o=(Gi,Vs,Ss)=>{const xl=d.getSymbolInstanceTextSize(re,Ze,this.transform.zoom,bt),jl=(Gi.x2-Gi.x1)*xl+2*Gi.padding,ta=(Gi.y2-Gi.y1)*xl+2*Gi.padding,Ta=ze&&!be?Vs:null;Ta&&Si(Ta);let il={box:[],offscreen:!1,occluded:!1};const ys=xe?2*ti.length:ti.length;for(let Vl=0;Vl<ys;++Vl){const Ic=this.attemptAnchorPlacement(ti[Vl%ti.length],Gi,jl,ta,xl,Re,Ae,z,v,fe,Vl>=ti.length,Ze,bt,d,Ss,Ta,re,ue);if(Ic&&(il=Ic.placedGlyphBoxes,il&&il.box&&il.box.length)){He=!0,_r=Ic.shift;break}}return il};ui(()=>_o(To,ut.iconBox,c.WritingMode.horizontal),()=>{const Gi=ut.verticalTextBox;return Gi&&Si(Gi),d.allowVerticalPlacement&&!(wn&&wn.box&&wn.box.length)&&Ye>0&&Gi?_o(Gi,ut.verticalIconBox,c.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),wn&&(He=wn.box,St=wn.offscreen,Nt=wn.occluded);const js=Yi(wn&&wn.box);if(!He&&this.prevPlacement){const Gi=this.prevPlacement.variableOffsets[Ct];Gi&&(this.variableOffsets[Ct]=Gi,this.markUsedJustification(d,Gi.anchor,Ze,js))}}else{const ti=(_o,js)=>{const Gi=d.getSymbolInstanceTextSize(re,Ze,this.transform.zoom,bt),Vs=this.collisionIndex.placeCollisionBox(d,Gi,_o,new c.pointGeometry(0,0),xe,z,v,fe.predicate);return Vs&&Vs.box&&Vs.box.length&&(this.markUsedOrientation(d,js,Ze),this.placedOrientations[Ct]=js),Vs};ui(()=>ti(To,c.WritingMode.horizontal),()=>{const _o=ut.verticalTextBox;return d.allowVerticalPlacement&&Ye>0&&_o?(Si(_o),ti(_o,c.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Yi(wn&&wn.box&&wn.box.length)}}if(Sn=wn,He=Sn&&Sn.box&&Sn.box.length>0,St=Sn&&Sn.offscreen,Nt=Sn&&Sn.occluded,Ze.useRuntimeCollisionCircles){const Yi=d.text.placedSymbolArray.get(Ze.centerJustifiedTextSymbolIndex>=0?Ze.centerJustifiedTextSymbolIndex:Ze.verticalPlacedTextSymbolIndex),ui=c.evaluateSizeForFeature(d.textSizeData,re,Yi),ti=f.get("text-padding");Mr=this.collisionIndex.placeCollisionCircles(d,xe,Yi,d.lineVertexArray,d.glyphOffsetArray,ui,v,b,C,_,Ae,fe.predicate,Ze.collisionCircleDiameter*ui/c.ONE_EM,ti,this.retainedQueryData[d.bucketInstanceId].tileID),He=xe||Mr.circles.length>0&&!Mr.collisionDetected,St=St&&Mr.offscreen,Nt=Mr.occluded}if(ut.iconFeatureIndex&&(bi=ut.iconFeatureIndex),ut.iconBox){const Yi=ui=>{Si(ui);const ti=ze&&_r?Ti(_r.x,_r.y,Re,Ae,this.transform.angle):new c.pointGeometry(0,0),_o=d.getSymbolInstanceIconSize(ue,this.transform.zoom,Ze.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(d,_o,ui,ti,be,z,v,fe.predicate)};ln&&ln.box&&ln.box.length&&ut.verticalIconBox?(Fn=Yi(ut.verticalIconBox),rt=Fn.box.length>0):(Fn=Yi(ut.iconBox),rt=Fn.box.length>0),St=St&&Fn.offscreen,An=Fn.occluded}const ea=ne||0===Ze.numHorizontalGlyphVertices&&0===Ye,Ea=we||0===Ze.numIconVertices;if(ea||Ea?Ea?ea||(rt=rt&&He):He=rt&&He:rt=He=rt&&He,He&&Sn&&Sn.box&&this.collisionIndex.insertCollisionBox(Sn.box,f.get("text-ignore-placement"),d.bucketInstanceId,ln&&ln.box&&ci?ci:ei,fe.ID),rt&&Fn&&this.collisionIndex.insertCollisionBox(Fn.box,f.get("icon-ignore-placement"),d.bucketInstanceId,bi,fe.ID),Mr&&(He&&this.collisionIndex.insertCollisionCircles(Mr.circles,f.get("text-ignore-placement"),d.bucketInstanceId,ei,fe.ID),_)){const Yi=d.bucketInstanceId;let ui=this.collisionCircleArrays[Yi];void 0===ui&&(ui=this.collisionCircleArrays[Yi]=new wo);for(let ti=0;ti<Mr.circles.length;ti+=4)ui.circles.push(Mr.circles[ti+0]),ui.circles.push(Mr.circles[ti+1]),ui.circles.push(Mr.circles[ti+2]),ui.circles.push(Mr.collisionDetected?1:0)}const Ul="globe"!==d.projection.name;Ke=Ke&&(Ul||!Nt),Qe=Qe&&(Ul||!An),this.placements[Ct]=new Fi(He||Ke,rt||Qe,St||d.justReloaded),l[Ct]=!0};if(qe){const Ze=d.getSortedSymbolIndexes(this.transform.angle);for(let bt=Ze.length-1;bt>=0;--bt){const ut=Ze[bt];Ht(d.symbolInstances.get(ut),ut,d.collisionArrays[ut])}}else for(let Ze=r.symbolInstanceStart;Ze<r.symbolInstanceEnd;Ze++)Ht(d.symbolInstances.get(Ze),Ze,d.collisionArrays[Ze]);if(_&&d.bucketInstanceId in this.collisionCircleArrays){const Ze=this.collisionCircleArrays[d.bucketInstanceId];c.invert(Ze.invProjMatrix,v),Ze.viewportMatrix=this.collisionIndex.getViewportMatrix()}d.justReloaded=!1}markUsedJustification(r,l,_,u){const{leftJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:f,rightJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:b,crossTileID:C}=_,S=c.getAnchorJustification(l),z=u===c.WritingMode.vertical?b:"left"===S?d:"center"===S?f:"right"===S?v:-1;d>=0&&(r.text.placedSymbolArray.get(d).crossTileID=z>=0&&d!==z?0:C),f>=0&&(r.text.placedSymbolArray.get(f).crossTileID=z>=0&&f!==z?0:C),v>=0&&(r.text.placedSymbolArray.get(v).crossTileID=z>=0&&v!==z?0:C),b>=0&&(r.text.placedSymbolArray.get(b).crossTileID=z>=0&&b!==z?0:C)}markUsedOrientation(r,l,_){const u=l===c.WritingMode.horizontal||l===c.WritingMode.horizontalOnly?l:0,d=l===c.WritingMode.vertical?l:0,{leftJustifiedTextSymbolIndex:f,centerJustifiedTextSymbolIndex:v,rightJustifiedTextSymbolIndex:b,verticalPlacedTextSymbolIndex:C}=_,S=r.text.placedSymbolArray;f>=0&&(S.get(f).placedOrientation=u),v>=0&&(S.get(v).placedOrientation=u),b>=0&&(S.get(b).placedOrientation=u),C>=0&&(S.get(C).placedOrientation=d)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let _=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const u=l?l.symbolFadeChange(r):1,d=l?l.opacities:{},f=l?l.variableOffsets:{},v=l?l.placedOrientations:{};for(const b in this.placements){const C=this.placements[b],S=d[b];S?(this.opacities[b]=new lo(S,u,C.text,C.icon,null,C.clipped),_=_||C.text!==S.text.placed||C.icon!==S.icon.placed):(this.opacities[b]=new lo(null,u,C.text,C.icon,C.skipFade,C.clipped),_=_||C.text||C.icon)}for(const b in d){const C=d[b];if(!this.opacities[b]){const S=new lo(C,u,!1,!1);S.isHidden()||(this.opacities[b]=S,_=_||C.text.placed||C.icon.placed)}}for(const b in f)this.variableOffsets[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.variableOffsets[b]=f[b]);for(const b in v)this.placedOrientations[b]||!this.opacities[b]||this.opacities[b].isHidden()||(this.placedOrientations[b]=v[b]);_?this.lastPlacementChangeTime=r:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:r)}updateLayerOpacities(r,l){const _={};for(const u of l){const d=u.getBucket(r);d&&u.latestFeatureIndex&&r.id===d.layerIds[0]&&this.updateBucketOpacities(d,_,u.collisionBoxArray)}}updateBucketOpacities(r,l,_){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const u=r.layers[0].layout,d=!!r.layers[0].dynamicFilter(),f=new lo(null,0,!1,!1,!0),v=u.get("text-allow-overlap"),b=u.get("icon-allow-overlap"),C=u.get("text-variable-anchor"),S="map"===u.get("text-rotation-alignment"),z="map"===u.get("text-pitch-alignment"),H="none"!==u.get("icon-text-fit"),ee=new lo(null,0,v&&(b||!r.hasIconData()||u.get("icon-optional")),b&&(v||!r.hasTextData()||u.get("text-optional")),!0);!r.collisionArrays&&_&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(_);const re=(fe,ne,we)=>{for(let xe=0;xe<ne/4;xe++)fe.opacityVertexArray.emplaceBack(we)};let ue=0;for(let fe=0;fe<r.symbolInstances.length;fe++){const ne=r.symbolInstances.get(fe),{numHorizontalGlyphVertices:we,numVerticalGlyphVertices:xe,crossTileID:be,numIconVertices:Re}=ne;let Ae=this.opacities[be];l[be]?Ae=f:Ae||(Ae=ee,this.opacities[be]=Ae),l[be]=!0;const ze=we>0||xe>0,qe=Re>0,Ke=this.placedOrientations[be],Qe=Ke===c.WritingMode.vertical,Ht=Ke===c.WritingMode.horizontal||Ke===c.WritingMode.horizontalOnly;if(!ze&&!qe||Ae.isHidden()||ue++,ze){const Ze=Ji(Ae.text);re(r.text,we,Qe?la:Ze),re(r.text,xe,Ht?la:Ze);const bt=Ae.text.isHidden(),{leftJustifiedTextSymbolIndex:ut,centerJustifiedTextSymbolIndex:Ct,rightJustifiedTextSymbolIndex:Ye,verticalPlacedTextSymbolIndex:He}=ne,rt=r.text.placedSymbolArray,St=bt||Qe?1:0;ut>=0&&(rt.get(ut).hidden=St),Ct>=0&&(rt.get(Ct).hidden=St),Ye>=0&&(rt.get(Ye).hidden=St),He>=0&&(rt.get(He).hidden=bt||Ht?1:0);const Nt=this.variableOffsets[be];Nt&&this.markUsedJustification(r,Nt.anchor,ne,Ke);const An=this.placedOrientations[be];An&&(this.markUsedJustification(r,"left",ne,An),this.markUsedOrientation(r,An,ne))}if(qe){const Ze=Ji(Ae.icon),{placedIconSymbolIndex:bt,verticalPlacedIconSymbolIndex:ut}=ne,Ct=r.icon.placedSymbolArray,Ye=Ae.icon.isHidden()?1:0;bt>=0&&(re(r.icon,Re,Qe?la:Ze),Ct.get(bt).hidden=Ye),ut>=0&&(re(r.icon,ne.numVerticalIconVertices,Ht?la:Ze),Ct.get(ut).hidden=Ye)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Ze=r.collisionArrays[fe];if(Ze){let bt=new c.pointGeometry(0,0),ut=!0;if(Ze.textBox||Ze.verticalTextBox){if(C){const Ye=this.variableOffsets[be];Ye?(bt=cs(Ye.anchor,Ye.width,Ye.height,Ye.textOffset,Ye.textScale),S&&bt._rotate(z?this.transform.angle:-this.transform.angle)):ut=!1}d&&(ut=!Ae.clipped),Ze.textBox&&co(r.textCollisionBox.collisionVertexArray,Ae.text.placed,!ut||Qe,bt.x,bt.y),Ze.verticalTextBox&&co(r.textCollisionBox.collisionVertexArray,Ae.text.placed,!ut||Ht,bt.x,bt.y)}const Ct=ut&&Boolean(!Ht&&Ze.verticalIconBox);Ze.iconBox&&co(r.iconCollisionBox.collisionVertexArray,Ae.icon.placed,Ct,H?bt.x:0,H?bt.y:0),Ze.verticalIconBox&&co(r.iconCollisionBox.collisionVertexArray,Ae.icon.placed,!Ct,H?bt.x:0,H?bt.y:0)}}}if(r.fullyClipped=0===ue,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const fe=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=fe.invProjMatrix,r.placementViewportMatrix=fe.viewportMatrix,r.collisionCircleArray=fe.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return 0===this.fadeDuration?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,l){const _=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*_>r}setStale(){this.stale=!0}}function co(p,r,l,_,u){p.emplaceBack(r?1:0,l?1:0,_||0,u||0),p.emplaceBack(r?1:0,l?1:0,_||0,u||0),p.emplaceBack(r?1:0,l?1:0,_||0,u||0),p.emplaceBack(r?1:0,l?1:0,_||0,u||0)}const Zr=Math.pow(2,25),Xa=Math.pow(2,24),wi=Math.pow(2,17),Ws=Math.pow(2,16),As=Math.pow(2,9),Uo=Math.pow(2,8),pi=Math.pow(2,1);function Ji(p){if(0===p.opacity&&!p.placed)return 0;if(1===p.opacity&&p.placed)return 4294967295;const r=p.placed?1:0,l=Math.floor(127*p.opacity);return l*Zr+r*Xa+l*wi+r*Ws+l*As+r*Uo+l*pi+r}const la=0;class Di{constructor(r){this._sortAcrossTiles="viewport-y"!==r.layout.get("symbol-z-order")&&void 0!==r.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,l,_,u,d){const f=this._bucketParts;for(;this._currentTileIndex<r.length;)if(l.getBucketParts(f,u,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,f.sort((v,b)=>v.sortKey-b.sortKey));this._currentPartIndex<f.length;){const v=f[this._currentPartIndex];if(l.placeLayerBucketPart(v,this._seenCrossTileIDs,_,0===v.symbolInstanceStart),this._currentPartIndex++,d())return!0}return!1}}class uo{constructor(r,l,_,u,d,f,v,b){this.placement=new ji(r,d,f,v,b),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=_,this._showCollisionBoxes=u,this._done=!1}isDone(){return this._done}continuePlacement(r,l,_){const u=c.exported.now(),d=()=>{const f=c.exported.now()-u;return!this._forceFullPlacement&&f>2};for(;this._currentPlacementIndex>=0;){const f=l[r[this._currentPlacementIndex]],v=this.placement.collisionIndex.transform.zoom;if("symbol"===f.type&&(!f.minzoom||f.minzoom<=v)&&(!f.maxzoom||f.maxzoom>v)){if(this._inProgressLayer||(this._inProgressLayer=new Di(f)),this._inProgressLayer.continuePlacement(_[f.source],this.placement,this._showCollisionBoxes,f,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Ps=512/c.EXTENT/2;class us{constructor(r,l,_){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=_;for(let u=0;u<l.length;u++){const d=l.get(u),f=d.key;this.indexedSymbolInstances[f]||(this.indexedSymbolInstances[f]=[]),this.indexedSymbolInstances[f].push({crossTileID:d.crossTileID,coord:this.getScaledCoordinates(d,r)})}}getScaledCoordinates(r,l){const _=Ps/Math.pow(2,l.canonical.z-this.tileID.canonical.z);return{x:Math.floor((l.canonical.x*c.EXTENT+r.tileAnchorX)*_),y:Math.floor((l.canonical.y*c.EXTENT+r.tileAnchorY)*_)}}findMatches(r,l,_){const u=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z);for(let d=0;d<r.length;d++){const f=r.get(d);if(f.crossTileID)continue;const v=this.indexedSymbolInstances[f.key];if(!v)continue;const b=this.getScaledCoordinates(f,l);for(const C of v)if(Math.abs(C.coord.x-b.x)<=u&&Math.abs(C.coord.y-b.y)<=u&&!_[C.crossTileID]){_[C.crossTileID]=!0,f.crossTileID=C.crossTileID;break}}}}class hs{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class ni{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const l=Math.round((r-this.lng)/360);if(0!==l)for(const _ in this.indexes){const u=this.indexes[_],d={};for(const f in u){const v=u[f];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+l),d[v.tileID.key]=v}this.indexes[_]=d}this.lng=r}addBucket(r,l,_){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let d=0;d<l.symbolInstances.length;d++)l.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const u=this.usedCrossTileIDs[r.overscaledZ];for(const d in this.indexes){const f=this.indexes[d];if(Number(d)>r.overscaledZ)for(const v in f){const b=f[v];b.tileID.isChildOf(r)&&b.findMatches(l.symbolInstances,r,u)}else{const v=f[r.scaledTo(Number(d)).key];v&&v.findMatches(l.symbolInstances,r,u)}}for(let d=0;d<l.symbolInstances.length;d++){const f=l.symbolInstances.get(d);f.crossTileID||(f.crossTileID=_.generate(),u[f.crossTileID]=!0)}return void 0===this.indexes[r.overscaledZ]&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new us(r,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(r,l){for(const _ in l.indexedSymbolInstances)for(const u of l.indexedSymbolInstances[_])delete this.usedCrossTileIDs[r][u.crossTileID]}removeStaleBuckets(r){let l=!1;for(const _ in this.indexes){const u=this.indexes[_];for(const d in u)r[u[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(_,u[d]),delete u[d],l=!0)}return l}}class Rs{constructor(){this.layerIndexes={},this.crossTileIDs=new hs,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,l,_,u){let d=this.layerIndexes[r.id];void 0===d&&(d=this.layerIndexes[r.id]=new ni);let f=!1;const v={};"globe"!==u.name&&d.handleWrapJump(_);for(const b of l){const C=b.getBucket(r);C&&r.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(b.tileID,C,this.crossTileIDs)&&(f=!0),v[C.bucketInstanceId]=!0)}return d.removeStaleBuckets(v)&&(f=!0),f}pruneUnusedLayers(r){const l={};r.forEach(_=>{l[_]=!0});for(const _ in this.layerIndexes)l[_]||delete this.layerIndexes[_]}}const ks=(p,r)=>c.emitValidationErrors(p,r&&r.filter(l=>"source.canvas"!==l.identifier)),Ko=c.pick(En,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),So=c.pick(En,["setCenter","setZoom","setBearing","setPitch"]),ds={version:8,layers:[],sources:{}},Es={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Mo extends c.Evented{constructor(r,l={}){super(),this.map=r,this.dispatcher=new Yt(mn(),this),this.imageManager=new Hn,this.imageManager.setEventedParent(this),this.glyphManager=new c.GlyphManager(r._requestManager,l.localFontFamily?c.LocalGlyphMode.all:l.localIdeographFontFamily?c.LocalGlyphMode.ideographs:c.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.crossTileSymbolIndex=new Rs,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",c.getReferrer());const _=this;this._rtlTextPluginCallback=Mo.registerForPluginStateChange(u=>{_.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:u.pluginStatus,pluginURL:u.pluginURL},(d,f)=>{if(c.triggerPluginCompletionEvent(d),f&&f.every(v=>v))for(const v in _._sourceCaches){const b=_._sourceCaches[v],C=b.getSource().type;"vector"!==C&&"geojson"!==C||b.reload()}})}),this.on("data",u=>{if("source"!==u.dataType||"metadata"!==u.sourceDataType)return;const d=this.getSource(u.sourceId);if(d&&d.vectorLayerIds)for(const f in this._layers){const v=this._layers[f];v.source===d.id&&this._validateLayer(v)}})}loadURL(r,l={}){this.fire(new c.Event("dataloading",{dataType:"style"}));const _="boolean"==typeof l.validate?l.validate:!c.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,l.accessToken);const u=this.map._requestManager.transformRequest(r,c.ResourceType.Style);this._request=c.getJSON(u,(d,f)=>{this._request=null,d?this.fire(new c.ErrorEvent(d)):f&&this._load(f,_)})}loadJSON(r,l={}){this.fire(new c.Event("dataloading",{dataType:"style"})),this._request=c.exported.frame(()=>{this._request=null,this._load(r,!1!==l.validate)})}loadEmpty(){this.fire(new c.Event("dataloading",{dataType:"style"})),this._load(ds,!1)}_updateLayerCount(r,l){const _=l?1:-1;r.is3D()&&(this._num3DLayers+=_),"circle"===r.type&&(this._numCircleLayers+=_),"symbol"===r.type&&(this._numSymbolLayers+=_)}_load(r,l){if(l&&ks(this,c.validateStyle(r)))return;this._loaded=!0,this.stylesheet=c.clone$1(r),this._updateMapProjection();for(const u in r.sources)this.addSource(u,r.sources[u],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const _=nr(this.stylesheet.layers);this._order=_.map(u=>u.id),this._layers={},this._serializedLayers={};for(const u of _){const d=c.createStyleLayer(u);d.setEventedParent(this,{layer:{id:d.id}}),this._layers[d.id]=d,this._serializedLayers[d.id]=d.serialize(),this._updateLayerCount(d,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new gt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new c.Event("data",{dataType:"style"})),this.fire(new c.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(l,_,u){let d,f,v;const b=c.exported.devicePixelRatio>1?"@2x":"";let C=c.getJSON(_.transformRequest(_.normalizeSpriteURL(l,b,".json"),c.ResourceType.SpriteJSON),(H,ee)=>{C=null,v||(v=H,d=ee,z())}),S=c.getImage(_.transformRequest(_.normalizeSpriteURL(l,b,".png"),c.ResourceType.SpriteImage),(H,ee)=>{S=null,v||(v=H,f=ee,z())});function z(){if(v)u(v);else if(d&&f){const H=c.exported.getImageData(f),ee={};for(const re in d){const{width:ue,height:fe,x:ne,y:we,sdf:xe,pixelRatio:be,stretchX:Re,stretchY:Ae,content:ze}=d[re],qe=new c.RGBAImage({width:ue,height:fe});c.RGBAImage.copy(H,qe,{x:ne,y:we},{x:0,y:0},{width:ue,height:fe}),ee[re]={data:qe,pixelRatio:be,sdf:xe,stretchX:Re,stretchY:Ae,content:ze}}u(null,ee)}}return{cancel(){C&&(C.cancel(),C=null),S&&(S.cancel(),S=null)}}}(r,this.map._requestManager,(l,_)=>{if(this._spriteRequest=null,l)this.fire(new c.ErrorEvent(l));else if(_)for(const u in _)this.imageManager.addImage(u,_[u]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new c.Event("data",{dataType:"style"}))})}_validateLayer(r){const l=this.getSource(r.source);if(!l)return;const _=r.sourceLayer;_&&("geojson"===l.type||l.vectorLayerIds&&-1===l.vectorLayerIds.indexOf(_))&&this.fire(new c.ErrorEvent(new Error(`Source layer "${_}" does not exist on source "${l.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const l=[];for(const _ of r){const u=this._layers[_];"custom"!==u.type&&l.push(u.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&("function"==typeof r.isLayerDraped?r.isLayerDraped():Es[r.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const l=this._changed;if(this._changed){const u=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(u.length||d.length)&&this._updateWorkerLayers(u,d);for(const f in this._updatedSources){const v=this._updatedSources[f];"reload"===v?this._reloadSource(f):"clear"===v&&this._clearSource(f)}this._updateTilesForChangedImages();for(const f in this._updatedPaintProps)this._layers[f].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const _={};for(const u in this._sourceCaches){const d=this._sourceCaches[u];_[u]=d.used,d.used=!1}for(const u of this._order){const d=this._layers[u];if(d.recalculate(r,this._availableImages),!d.isHidden(r.zoom)){const v=this._getLayerSourceCache(d);v&&(v.used=!0)}const f=this.map.painter;if(f){const v=d.getProgramIds();if(!v)continue;const b=d.getProgramConfiguration(r.zoom);for(const C of v)f.useProgram(C,b)}}for(const u in _){const d=this._sourceCaches[u];_[u]!==d.used&&d.getSource().fire(new c.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:d.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new c.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),ks(this,c.validateStyle(r)))return!1;(r=c.clone$1(r)).layers=nr(r.layers);const l=function(u,d){if(!u)return[{command:En.setStyle,args:[d]}];let f=[];try{if(!Le(u.version,d.version))return[{command:En.setStyle,args:[d]}];Le(u.center,d.center)||f.push({command:En.setCenter,args:[d.center]}),Le(u.zoom,d.zoom)||f.push({command:En.setZoom,args:[d.zoom]}),Le(u.bearing,d.bearing)||f.push({command:En.setBearing,args:[d.bearing]}),Le(u.pitch,d.pitch)||f.push({command:En.setPitch,args:[d.pitch]}),Le(u.sprite,d.sprite)||f.push({command:En.setSprite,args:[d.sprite]}),Le(u.glyphs,d.glyphs)||f.push({command:En.setGlyphs,args:[d.glyphs]}),Le(u.transition,d.transition)||f.push({command:En.setTransition,args:[d.transition]}),Le(u.light,d.light)||f.push({command:En.setLight,args:[d.light]}),Le(u.fog,d.fog)||f.push({command:En.setFog,args:[d.fog]}),Le(u.projection,d.projection)||f.push({command:En.setProjection,args:[d.projection]});const v={},b=[];!function(z,H,ee,re){let ue;for(ue in H=H||{},z=z||{})z.hasOwnProperty(ue)&&(H.hasOwnProperty(ue)||Cr(ue,ee,re));for(ue in H){if(!H.hasOwnProperty(ue))continue;const fe=H[ue];z.hasOwnProperty(ue)?Le(z[ue],fe)||("geojson"===z[ue].type&&"geojson"===fe.type&&ki(z,H,ue)?ee.push({command:En.setGeoJSONSourceData,args:[ue,fe.data]}):Xo(ue,H,ee,re)):zr(ue,H,ee)}}(u.sources,d.sources,b,v);const C=[];u.layers&&u.layers.forEach(z=>{z.source&&v[z.source]?f.push({command:En.removeLayer,args:[z.id]}):C.push(z)});let S=u.terrain;S&&v[S.source]&&(f.push({command:En.setTerrain,args:[void 0]}),S=void 0),f=f.concat(b),Le(S,d.terrain)||f.push({command:En.setTerrain,args:[d.terrain]}),function(z,H,ee){H=H||[];const re=(z=z||[]).map(Qr),ue=H.map(Qr),fe=z.reduce(xi,{}),ne=H.reduce(xi,{}),we=re.slice(),xe=Object.create(null);let be,Re,Ae,ze,qe,Ke,Qe;for(be=0,Re=0;be<re.length;be++)Ae=re[be],ne.hasOwnProperty(Ae)?Re++:(ee.push({command:En.removeLayer,args:[Ae]}),we.splice(we.indexOf(Ae,Re),1));for(be=0,Re=0;be<ue.length;be++)Ae=ue[ue.length-1-be],we[we.length-1-be]!==Ae&&(fe.hasOwnProperty(Ae)?(ee.push({command:En.removeLayer,args:[Ae]}),we.splice(we.lastIndexOf(Ae,we.length-Re),1)):Re++,Ke=we[we.length-be],ee.push({command:En.addLayer,args:[ne[Ae],Ke]}),we.splice(we.length-be,0,Ae),xe[Ae]=!0);for(be=0;be<ue.length;be++)if(Ae=ue[be],ze=fe[Ae],qe=ne[Ae],!xe[Ae]&&!Le(ze,qe))if(Le(ze.source,qe.source)&&Le(ze["source-layer"],qe["source-layer"])&&Le(ze.type,qe.type)){for(Qe in st(ze.layout,qe.layout,ee,Ae,null,En.setLayoutProperty),st(ze.paint,qe.paint,ee,Ae,null,En.setPaintProperty),Le(ze.filter,qe.filter)||ee.push({command:En.setFilter,args:[Ae,qe.filter]}),Le(ze.minzoom,qe.minzoom)&&Le(ze.maxzoom,qe.maxzoom)||ee.push({command:En.setLayerZoomRange,args:[Ae,qe.minzoom,qe.maxzoom]}),ze)ze.hasOwnProperty(Qe)&&"layout"!==Qe&&"paint"!==Qe&&"filter"!==Qe&&"metadata"!==Qe&&"minzoom"!==Qe&&"maxzoom"!==Qe&&(0===Qe.indexOf("paint.")?st(ze[Qe],qe[Qe],ee,Ae,Qe.slice(6),En.setPaintProperty):Le(ze[Qe],qe[Qe])||ee.push({command:En.setLayerProperty,args:[Ae,Qe,qe[Qe]]}));for(Qe in qe)qe.hasOwnProperty(Qe)&&!ze.hasOwnProperty(Qe)&&"layout"!==Qe&&"paint"!==Qe&&"filter"!==Qe&&"metadata"!==Qe&&"minzoom"!==Qe&&"maxzoom"!==Qe&&(0===Qe.indexOf("paint.")?st(ze[Qe],qe[Qe],ee,Ae,Qe.slice(6),En.setPaintProperty):Le(ze[Qe],qe[Qe])||ee.push({command:En.setLayerProperty,args:[Ae,Qe,qe[Qe]]}))}else ee.push({command:En.removeLayer,args:[Ae]}),Ke=we[we.lastIndexOf(Ae)+1],ee.push({command:En.addLayer,args:[qe,Ke]})}(C,d.layers,f)}catch(v){console.warn("Unable to compute style diff:",v),f=[{command:En.setStyle,args:[d]}]}return f}(this.serialize(),r).filter(u=>!(u.command in So));if(0===l.length)return!1;const _=l.filter(u=>!(u.command in Ko));if(_.length>0)throw new Error(`Unimplemented: ${_.map(u=>u.command).join(", ")}.`);return l.forEach(u=>{"setTransition"!==u.command&&"setProjection"!==u.command&&this[u.command].apply(this,u.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,l){return this.getImage(r)?this.fire(new c.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,l),this._afterImageUpdated(r),this)}updateImage(r,l){this.imageManager.updateImage(r,l)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new c.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,l,_={}){if(this._checkLoaded(),void 0!==this.getSource(r))throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(c.validateSource,`sources.${r}`,l,null,_))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const u=X(r,l,this.dispatcher,this);u.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:u.serialize(),sourceId:r}));const d=f=>{const v=(f?"symbol:":"other:")+r,b=this._sourceCaches[v]=new c.SourceCache(v,u,f);(f?this._symbolSourceCaches:this._otherSourceCaches)[r]=b,b.style=this,b.onAdd(this.map)};d(!1),"vector"!==l.type&&"geojson"!==l.type||d(!0),u.onAdd&&u.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const l=this.getSource(r);if(!l)throw new Error("There is no source with this ID");for(const u in this._layers)if(this._layers[u].source===r)return this.fire(new c.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${u}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new c.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const _=this._getSourceCaches(r);for(const u of _)delete this._sourceCaches[u.id],delete this._updatedSources[u.id],u.fire(new c.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:u.getSource().id})),u.setEventedParent(null),u.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,l){this._checkLoaded(),this.getSource(r).setData(l),this._changed=!0}getSource(r){const l=this._getSourceCache(r);return l&&l.getSource()}_getSources(){const r=[];for(const l in this._otherSourceCaches){const _=this._getSourceCache(l);_&&r.push(_.getSource())}return r}addLayer(r,l,_={}){this._checkLoaded();const u=r.id;if(this.getLayer(u))return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${u}" already exists on this map`)));let d;if("custom"===r.type){if(ks(this,c.validateCustomStyleLayer(r)))return;d=c.createStyleLayer(r)}else{if("object"==typeof r.source&&(this.addSource(u,r.source),r=c.clone$1(r),r=c.extend(r,{source:u})),this._validate(c.validateLayer,`layers.${u}`,r,{arrayIndex:-1},_))return;d=c.createStyleLayer(r),this._validateLayer(d),d.setEventedParent(this,{layer:{id:u}}),this._serializedLayers[d.id]=d.serialize(),this._updateLayerCount(d,!0)}const f=l?this._order.indexOf(l):this._order.length;if(l&&-1===f)return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(f,0,u),this._layerOrderChanged=!0,this._layers[u]=d;const v=this._getLayerSourceCache(d);if(this._removedLayers[u]&&d.source&&v&&"custom"!==d.type){const b=this._removedLayers[u];delete this._removedLayers[u],b.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",v.pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,l){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===l)return;const _=this._order.indexOf(r);this._order.splice(_,1);const u=l?this._order.indexOf(l):this._order.length;l&&-1===u?this.fire(new c.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(u,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const l=this._layers[r];if(!l)return void this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const _=this._order.indexOf(r);this._order.splice(_,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=l,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const l in this._layers)if(this._layers[l].type===r)return!0;return!1}setLayerZoomRange(r,l,_){this._checkLoaded();const u=this.getLayer(r);u?u.minzoom===l&&u.maxzoom===_||(null!=l&&(u.minzoom=l),null!=_&&(u.maxzoom=_),this._updateLayer(u)):this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,l,_={}){this._checkLoaded();const u=this.getLayer(r);if(u){if(!Le(u.filter,l))return null==l?(u.filter=void 0,void this._updateLayer(u)):void(this._validate(c.validateFilter,`layers.${u.id}.filter`,l,{layerType:u.type},_)||(u.filter=c.clone$1(l),this._updateLayer(u)))}else this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const l=this.getLayer(r);return l&&c.clone$1(l.filter)}setLayoutProperty(r,l,_,u={}){this._checkLoaded();const d=this.getLayer(r);d?Le(d.getLayoutProperty(l),_)||(d.setLayoutProperty(l,_,u),this._updateLayer(d)):this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,l){const _=this.getLayer(r);if(_)return _.getLayoutProperty(l);this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,l,_,u={}){this._checkLoaded();const d=this.getLayer(r);d?Le(d.getPaintProperty(l),_)||(d.setPaintProperty(l,_,u)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new c.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,l){const _=this.getLayer(r);return _&&_.getPaintProperty(l)}setFeatureState(r,l){this._checkLoaded();const _=r.source,u=r.sourceLayer,d=this.getSource(_);if(!d)return void this.fire(new c.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const f=d.type;if("geojson"===f&&u)return void this.fire(new c.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===f&&!u)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===r.id&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided.")));const v=this._getSourceCaches(_);for(const b of v)b.setFeatureState(u,r.id,l)}removeFeatureState(r,l){this._checkLoaded();const _=r.source,u=this.getSource(_);if(!u)return void this.fire(new c.ErrorEvent(new Error(`The source '${_}' does not exist in the map's style.`)));const d=u.type,f="vector"===d?r.sourceLayer:void 0;if("vector"===d&&!f)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&"string"!=typeof r.id&&"number"!=typeof r.id)return void this.fire(new c.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const v=this._getSourceCaches(_);for(const b of v)b.removeFeatureState(f,r.id,l)}getFeatureState(r){this._checkLoaded();const l=r.source,_=r.sourceLayer,u=this.getSource(l);if(u){if("vector"!==u.type||_)return void 0===r.id&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(_,r.id);this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new c.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return c.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const l in this._sourceCaches){const _=this._sourceCaches[l].getSource();r[_.id]||(r[_.id]=_.serialize())}return c.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},l=>void 0!==l)}_updateLayer(r){this._updatedLayers[r.id]=!0;const l=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&l&&"raster"!==l.getSource().type&&(this._updatedSources[r.source]="reload",l.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const l=f=>"fill-extrusion"===this._layers[f].type,_={},u=[];for(let f=this._order.length-1;f>=0;f--){const v=this._order[f];if(l(v)){_[v]=f;for(const b of r){const C=b[v];if(C)for(const S of C)u.push(S)}}}u.sort((f,v)=>v.intersectionZ-f.intersectionZ);const d=[];for(let f=this._order.length-1;f>=0;f--){const v=this._order[f];if(l(v))for(let b=u.length-1;b>=0;b--){const C=u[b].feature;if(_[C.layer.id]<f)break;d.push(C),u.pop()}else for(const b of r){const C=b[v];if(C)for(const S of C)d.push(S.feature)}}return d}queryRenderedFeatures(r,l,_){l&&l.filter&&this._validate(c.validateFilter,"queryRenderedFeatures.filter",l.filter,null,l);const u={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new c.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const b of l.layers){const C=this._layers[b];if(!C)return this.fire(new c.ErrorEvent(new Error(`The layer '${b}' does not exist in the map's style and cannot be queried for features.`))),[];u[C.source]=!0}}const d=[];l.availableImages=this._availableImages;const f=l&&l.layers?l.layers.some(b=>{const C=this.getLayer(b);return C&&C.is3D()}):this.has3DLayers(),v=an.createFromScreenPoints(r,_);for(const b in this._sourceCaches){const C=this._sourceCaches[b].getSource().id;l.layers&&!u[C]||d.push(_e(this._sourceCaches[b],this._layers,this._serializedLayers,v,l,_,f,!!this.map._showQueryGeometry))}return this.placement&&d.push(function(b,C,S,z,H,ee,re){const ue={},fe=ee.queryRenderedSymbols(z),ne=[];for(const we of Object.keys(fe).map(Number))ne.push(re[we]);ne.sort(ct);for(const we of ne){const xe=we.featureIndex.lookupSymbolFeatures(fe[we.bucketInstanceId],C,we.bucketIndex,we.sourceLayerIndex,H.filter,H.layers,H.availableImages,b);for(const be in xe){const Re=ue[be]=ue[be]||[],Ae=xe[be];Ae.sort((ze,qe)=>{const Ke=we.featureSortOrder;if(Ke){const Qe=Ke.indexOf(ze.featureIndex);return Ke.indexOf(qe.featureIndex)-Qe}return qe.featureIndex-ze.featureIndex});for(const ze of Ae)Re.push(ze)}}for(const we in ue)ue[we].forEach(xe=>{const be=xe.feature,Re=S(b[we]);if(!Re)return;const Ae=Re.getFeatureState(be.layer["source-layer"],be.id);be.source=be.layer.source,be.layer["source-layer"]&&(be.sourceLayer=be.layer["source-layer"]),be.state=Ae});return ue}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),v.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(r,l){l&&l.filter&&this._validate(c.validateFilter,"querySourceFeatures.filter",l.filter,null,l);const _=this._getSourceCaches(r);let u=[];for(const d of _)u=u.concat(Ue(d,l));return u}addSourceType(r,l,_){return Mo.getSourceType(r)?_(new Error(`A source type called "${r}" already exists.`)):(Mo.setSourceType(r,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:l.workerSourceURL},_):_(null,null))}getLight(){return this.light.getLight()}setLight(r,l={}){this._checkLoaded();const _=this.light.getLight();let u=!1;for(const f in r)if(!Le(r[f],_[f])){u=!0;break}if(!u)return;const d=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,l),this.light.updateTransitions(d)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,l=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let _=r;if(1===l){if("object"==typeof _.source){const u="terrain-dem-src";this.addSource(u,_.source),_=c.clone$1(_),_=c.extend(_,{source:u})}if(this._validate(c.validateTerrain,"terrain",_))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode){if(!_)return;this._createTerrain(_,l)}else{const u=this.terrain,d=u.get();for(const f of Object.keys(c.spec.terrain))!_.hasOwnProperty(f)&&c.spec.terrain[f].default&&(_[f]=c.spec.terrain[f].default);for(const f in _)if(!Le(_[f],d[f])){u.set(_),this.stylesheet.terrain=_;const v=this._setTransitionParameters({duration:0});u.updateTransitions(v);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const l=this.fog=new At(r,this.map.transform);this.stylesheet.fog=r;const _=this._setTransitionParameters({duration:0});l.updateTransitions(_)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,_=l.get();0===Object.keys(r).length&&l.set(r);for(const u in r)if(!Le(r[u],_[u])){l.set(r),this.stylesheet.fog=r;const d=this._setTransitionParameters({duration:0});l.updateTransitions(d);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:c.exported.now(),transition:c.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(_=>this.isLayerDraped(this._layers[_])),l=this._order.filter(_=>!this.isLayerDraped(this._layers[_]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...l)}_createTerrain(r,l){const _=this.terrain=new vn(r,l);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const u=this._setTransitionParameters({duration:0});_.updateTransitions(u)}_force3DLayerUpdate(){for(const r in this._layers){const l=this._layers[r];"fill-extrusion"===l.type&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const l=this._layers[r];"symbol"===l.type&&this._updateLayer(l)}}_validate(r,l,_,u,d={}){return(!d||!1!==d.validate)&&ks(this,r.call(c.validateStyle,c.extend({key:l,style:this.serialize(),value:_,styleSpec:c.spec},u)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const l=this._getSourceCaches(r);for(const _ of l)_.clearTiles()}_reloadSource(r){const l=this._getSourceCaches(r);for(const _ of l)_.resume(),_.reload()}_reloadSources(){for(const r of this._getSources())r.reload&&r.reload()}_updateSources(r){for(const l in this._sourceCaches)this._sourceCaches[l].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const l=this._sourceCaches[r];l.resume(),l.reload()}}_updatePlacement(r,l,_,u,d=!1){let f=!1,v=!1;const b={};for(const C of this._order){const S=this._layers[C];if("symbol"!==S.type)continue;if(!b[S.source]){const H=this._getLayerSourceCache(S);if(!H)continue;b[S.source]=H.getRenderableIds(!0).map(ee=>H.getTileByID(ee)).sort((ee,re)=>re.tileID.overscaledZ-ee.tileID.overscaledZ||(ee.tileID.isLessThan(re.tileID)?-1:1))}const z=this.crossTileSymbolIndex.addLayer(S,b[S.source],r.center.lng,r.projection);f=f||z}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),d=d||this._layerOrderChanged||0===_,this._layerOrderChanged&&this.fire(new c.Event("neworder")),(d||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.exported.now(),r.zoom))&&(this.pauseablePlacement=new uo(r,this._order,d,l,_,u,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,b),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.exported.now()),v=!0),f&&this.pauseablePlacement.placement.setStale()),v||f)for(const C of this._order){const S=this._layers[C];"symbol"===S.type&&this.placement.updateLayerOpacities(S,b[S.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,l,_){this.imageManager.getImages(l.icons,_),this._updateTilesForChangedImages();const u=d=>{d&&d.setDependencies(l.tileID.key,l.type,l.icons)};u(this._otherSourceCaches[l.source]),u(this._symbolSourceCaches[l.source])}getGlyphs(r,l,_){this.glyphManager.getGlyphs(l.stacks,_)}getResource(r,l,_){return c.makeRequest(l,_)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return"symbol"===r.type?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const l=[];return this._otherSourceCaches[r]&&l.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&l.push(this._symbolSourceCaches[r]),l}_isSourceCacheLoaded(r){const l=this._getSourceCaches(r);return 0===l.length?(this.fire(new c.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):l.every(_=>_.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Mo.getSourceType=function(p){return se[p]},Mo.setSourceType=function(p,r){se[p]=r},Mo.registerForPluginStateChange=c.registerForPluginStateChange;var Ls="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Ka="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Sa="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",Na="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",bo="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let ca={},Os={};const jo=[];Zs(Ls,jo),Zs(Sa,jo),Zs(Na,jo),Zs(bo,jo),ca=gr("",Sa),Os=gr(bo,Na);const Ya=gr("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),ua=Ls,Yo="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Fs={background:gr("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:gr("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:gr("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:gr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:gr("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:gr("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:gr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:gr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:gr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:gr("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:gr("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:gr("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:gr("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:gr("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:gr("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:gr("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:gr("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:gr("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:gr("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:gr("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:gr("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:gr("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:gr("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:gr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:gr("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:gr("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ka),skyboxGradient:gr("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ka),skyboxCapture:gr("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:gr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:gr("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Zs(p,r){const l=p.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let _ of l)if(_=_.trim(),"#"===_[0]&&_.includes("if")&&!_.includes("endif")){_=_.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const u=_.split(" ");for(const d of u)r.includes(d)||r.push(d)}}function gr(p,r){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,_=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),u={},d=[...jo];return Zs(p,d),Zs(r,d),{fragmentSource:p=p.replace(l,(f,v,b,C,S)=>(u[S]=!0,"define"===v?`\n#ifndef HAS_UNIFORM_u_${S}\nvarying ${b} ${C} ${S};\n#else\nuniform ${b} ${C} u_${S};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${S}\n    ${b} ${C} ${S} = u_${S};\n#endif\n`)),vertexSource:r=r.replace(l,(f,v,b,C,S)=>{const z="float"===C?"vec2":"vec4",H=S.match(/color/)?"color":z;return u[S]?"define"===v?`\n#ifndef HAS_UNIFORM_u_${S}\nuniform lowp float u_${S}_t;\nattribute ${b} ${z} a_${S};\nvarying ${b} ${C} ${S};\n#else\nuniform ${b} ${C} u_${S};\n#endif\n`:"vec4"===H?`\n#ifndef HAS_UNIFORM_u_${S}\n    ${S} = a_${S};\n#else\n    ${b} ${C} ${S} = u_${S};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${S}\n    ${S} = unpack_mix_${H}(a_${S}, u_${S}_t);\n#else\n    ${b} ${C} ${S} = u_${S};\n#endif\n`:"define"===v?`\n#ifndef HAS_UNIFORM_u_${S}\nuniform lowp float u_${S}_t;\nattribute ${b} ${z} a_${S};\n#else\nuniform ${b} ${C} u_${S};\n#endif\n`:"vec4"===H?`\n#ifndef HAS_UNIFORM_u_${S}\n    ${b} ${C} ${S} = a_${S};\n#else\n    ${b} ${C} ${S} = u_${S};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${S}\n    ${b} ${C} ${S} = unpack_mix_${H}(a_${S}, u_${S}_t);\n#else\n    ${b} ${C} ${S} = u_${S};\n#endif\n`}),staticAttributes:_,usedDefines:d}}class Vo{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,l,_,u,d,f,v){this.context=r;let b=this.boundPaintVertexBuffers.length!==u.length;for(let S=0;!b&&S<u.length;S++)this.boundPaintVertexBuffers[S]!==u[S]&&(b=!0);let C=this.boundDynamicVertexBuffers.length!==v.length;for(let S=0;!C&&S<v.length;S++)this.boundDynamicVertexBuffers[S]!==v[S]&&(C=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==_||b||C||this.boundIndexBuffer!==d||this.boundVertexOffset!==f)this.freshBind(l,_,u,d,f,v);else{r.bindVertexArrayOES.set(this.vao);for(const S of v)S&&S.bind();d&&d.dynamicDraw&&d.bind()}}freshBind(r,l,_,u,d,f){let v;const b=r.numAttributes,C=this.context,S=C.gl;if(C.extVertexArrayObject)this.vao&&this.destroy(),this.vao=C.extVertexArrayObject.createVertexArrayOES(),C.bindVertexArrayOES.set(this.vao),v=0,this.boundProgram=r,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=_,this.boundIndexBuffer=u,this.boundVertexOffset=d,this.boundDynamicVertexBuffers=f;else{v=C.currentNumAttributes||0;for(let z=b;z<v;z++)S.disableVertexAttribArray(z)}l.enableAttributes(S,r),l.bind(),l.setVertexAttribPointers(S,r,d);for(const z of _)z.enableAttributes(S,r),z.bind(),z.setVertexAttribPointers(S,r,d);for(const z of f)z&&(z.enableAttributes(S,r),z.bind(),z.setVertexAttribPointers(S,r,d));u&&u.bind(),C.currentNumAttributes=b}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function Xs(p,r){const l=Math.pow(2,r.canonical.z),_=r.canonical.y;return[new c.MercatorCoordinate(0,_/l).toLngLat().lat,new c.MercatorCoordinate(0,(_+1)/l).toLngLat().lat]}function Io(p,r,l,_,u,d,f){const v=p.context,b=v.gl,C=l.fbo;if(!C)return;p.prepareDrawTile();const S=p.useProgram("hillshade");v.activeTexture.set(b.TEXTURE0),b.bindTexture(b.TEXTURE_2D,C.colorAttachment.get());const z=((ue,fe,ne,we)=>{const xe=ne.paint.get("hillshade-shadow-color"),be=ne.paint.get("hillshade-highlight-color"),Re=ne.paint.get("hillshade-accent-color");let Ae=ne.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===ne.paint.get("hillshade-illumination-anchor")&&(Ae-=ue.transform.angle);const ze=!ue.options.moving;return{u_matrix:we||ue.transform.calculateProjMatrix(fe.tileID.toUnwrapped(),ze),u_image:0,u_latrange:Xs(0,fe.tileID),u_light:[ne.paint.get("hillshade-exaggeration"),Ae],u_shadow:xe,u_highlight:be,u_accent:Re}})(p,l,_,p.terrain?r.projMatrix:null);p.prepareDrawProgram(v,S,r.toUnwrapped());const{tileBoundsBuffer:H,tileBoundsIndexBuffer:ee,tileBoundsSegments:re}=p.getTileBoundsBuffers(l);S.draw(v,b.TRIANGLES,u,d,f,c.CullFaceMode.disabled,z,_.id,H,ee,re)}function Jo(p,r,l){if(!r.needsDEMTextureUpload)return;const _=p.context,u=_.gl;_.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||p.getTileTexture(l.stride);const d=l.getPixels();r.demTexture?r.demTexture.update(d,{premultiply:!1}):r.demTexture=new c.Texture(_,d,u.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Vi(p,r,l,_,u,d){const f=p.context,v=f.gl;if(!r.dem)return;const b=r.dem;if(f.activeTexture.set(v.TEXTURE1),Jo(p,r,b),!r.demTexture)return;r.demTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE);const C=b.dim;f.activeTexture.set(v.TEXTURE0);let S=r.fbo;if(!S){const re=new c.Texture(f,{width:C,height:C,data:null},v.RGBA);re.bind(v.LINEAR,v.CLAMP_TO_EDGE),S=r.fbo=f.createFramebuffer(C,C,!0),S.colorAttachment.set(re.texture)}f.bindFramebuffer.set(S.framebuffer),f.viewport.set([0,0,C,C]);const{tileBoundsBuffer:z,tileBoundsIndexBuffer:H,tileBoundsSegments:ee}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(f,v.TRIANGLES,_,u,d,c.CullFaceMode.disabled,((re,ue)=>{const fe=ue.stride,ne=c.create();return c.ortho(ne,0,c.EXTENT,-c.EXTENT,0,0,1),c.translate(ne,ne,[0,-c.EXTENT,0]),{u_matrix:ne,u_image:1,u_dimension:[fe,fe],u_zoom:re.overscaledZ,u_unpack:ue.unpackVector}})(r.tileID,b),l.id,z,H,ee),r.needsHillshadePrepare=!1}const Qo=p=>({u_matrix:new c.UniformMatrix4f(p),u_image0:new c.Uniform1i(p),u_skirt_height:new c.Uniform1f(p)}),zs=(p,r)=>({u_matrix:p,u_image0:0,u_skirt_height:r}),Bs=(p,r,l,_,u,d,f,v,b,C,S,z,H,ee,re)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(_),u_merc_matrix:l,u_zoom_transition:u,u_merc_center:d,u_image0:0,u_frustum_tl:f,u_frustum_tr:v,u_frustum_br:b,u_frustum_bl:C,u_globe_pos:S,u_globe_radius:z,u_viewport:H,u_grid_matrix:re?Float32Array.from(re):new Float32Array(9),u_skirt_height:ee});function Ts(p,r){return null!=p&&null!=r&&!(!p.hasData()||!r.hasData())&&null!=p.demTexture&&null!=r.demTexture&&p.tileID.key!==r.tileID.key}const fs=new class{constructor(){this.operations={}}newMorphing(p,r,l,_,u){if(p in this.operations){const d=this.operations[p];d.to.tileID.key!==l.tileID.key&&(d.queued=l)}else this.operations[p]={startTime:_,phase:0,duration:u,from:r,to:l,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const r=this.operations[p];return{from:r.from,to:r.to,phase:r.phase}}update(p){for(const r in this.operations){const l=this.operations[r];for(l.phase=(p-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,p)){delete this.operations[r];break}}}_nextOp(p,r){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=r,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},Ns={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function so(p){return 6*Math.pow(1.5,22-p)}function Ma(p,r){const l=1<<p.z;return!r&&(0===p.x||p.x===l-1)||0===p.y||p.y===l-1}const fr=p=>({u_matrix:p});function ri(p,r,l,_,u){if(u>0){const d=c.exported.now(),f=(d-p.timeAdded)/u,v=r?(d-r.timeAdded)/u:-1,b=l.getSource(),C=_.coveringZoomLevel({tileSize:b.tileSize,roundZoom:b.roundZoom}),S=!r||Math.abs(r.tileID.overscaledZ-C)>Math.abs(p.tileID.overscaledZ-C),z=S&&p.refreshedUponExpiration?1:c.clamp(S?f:1-v,0,1);return p.refreshedUponExpiration&&f>=1&&(p.refreshedUponExpiration=!1),r?{opacity:1,mix:1-z}:{opacity:z,mix:0}}return{opacity:1,mix:0}}class Ja extends c.SourceCache{constructor(r){const l={type:"raster-dem",maxzoom:r.transform.maxZoom},_=new Yt(mn(),null),u=X("mock-dem",l,_,r.style);super("mock-dem",u,!1),u.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,l){r.state="loaded",l(null)}}class ha extends c.SourceCache{constructor(r){const l=X("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new Yt(mn(),null),r.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,l,_){if(r.freezeTileCoverage)return;this.transform=r;const u=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((d,f)=>{if(d[f.key]="",!this._tiles[f.key]){const v=new c.Tile(f,this._source.tileSize*f.overscaleFactor(),r.tileZoom);v.state="loaded",this._tiles[f.key]=v}return d},{});for(const d in this._tiles)d in u||(this.freeFBO(d),this._tiles[d].unloadVectorData(),delete this._tiles[d])}freeFBO(r){const l=this.proxyCachedFBO[r];if(void 0!==l){const _=Object.values(l);this.renderCachePool.push(..._),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Qi extends c.OverscaledTileID{constructor(r,l,_){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=l,this.projMatrix=_}}class $i extends c.Elevation{constructor(r,l){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[_,u,d]=function(b){const C=new c.StructArrayLayout2i4,S=new c.StructArrayLayout3ui6,z=131;C.reserve(17161),S.reserve(33800);const H=c.EXTENT/128,ee=c.EXTENT+H/2,re=ee+H;for(let fe=-H;fe<re;fe+=H)for(let ne=-H;ne<re;ne+=H){const we=ne<0||ne>ee||fe<0||fe>ee?24575:0,xe=c.clamp(Math.round(ne),0,c.EXTENT),be=c.clamp(Math.round(fe),0,c.EXTENT);C.emplaceBack(xe+we,be)}const ue=(fe,ne)=>{const we=ne*z+fe;S.emplaceBack(we+1,we,we+z),S.emplaceBack(we+z,we+z+1,we+1)};for(let fe=1;fe<129;fe++)for(let ne=1;ne<129;ne++)ue(ne,fe);return[0,129].forEach(fe=>{for(let ne=0;ne<130;ne++)ue(ne,fe),ue(fe,ne)}),[C,S,32768]}(),f=r.context;this.gridBuffer=f.createVertexBuffer(_,c.posAttributes.members),this.gridIndexBuffer=f.createIndexBuffer(u),this.gridSegments=c.SegmentVector.simpleSegment(0,0,_.length,u.length),this.gridNoSkirtSegments=c.SegmentVector.simpleSegment(0,0,_.length,d),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ha(l.map),this.orthoMatrix=c.create(),c.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,c.EXTENT,0,c.EXTENT,0,1);const v=f.gl;this._overlapStencilMode=new c.StencilMode({func:v.GEQUAL,mask:255},0,255,v.KEEP,v.KEEP,v.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ja(l.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,l,_){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const u=r.terrain.properties;this.sourceCache=0===r.terrain.drapeRenderMode?this._mockSourceCache:r._getSourceCache(u.get("source")),this._exaggeration=u.get("exaggeration");const d=()=>{this.sourceCache.used&&c.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const f=this.getScaledDemTileSize();this.sourceCache.update(l,f,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,d(),this._initializing=!0),d(),l.updateElevation(!0,_),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==r.efficiency&&c.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&"source"===r.dataType?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):"style"===r.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,_=this.painter.transform;this._initializing&&(this._initializing=0===_._centerAltitude&&-1===this.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(_.center),-1),this._emptyDEMTextureDirty=!this._initializing);const u=this.proxyCoords=l.getIds().map(b=>{const C=l.getTileByID(b).tileID;return C.projMatrix=_.calculateProjMatrix(C.toUnwrapped()),C});(function(b,C){const S=C.transform.pointCoordinate(C.transform.getCameraPoint()),z=new c.pointGeometry(S.x,S.y);b.sort((H,ee)=>{if(ee.overscaledZ-H.overscaledZ)return ee.overscaledZ-H.overscaledZ;const re=new c.pointGeometry(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),ue=new c.pointGeometry(ee.canonical.x+(1<<ee.canonical.z)*ee.wrap,ee.canonical.y),fe=z.mult(1<<H.canonical.z);return fe.x-=.5,fe.y-=.5,fe.distSqr(re)-fe.distSqr(ue)})})(u,this.painter),this._previousZoom=_.zoom;const d=this.proxyToSource||{};this.proxyToSource={},u.forEach(b=>{this.proxyToSource[b.key]={}}),this.terrainTileForTile={};const f=this._style._sourceCaches;for(const b in f){const C=f[b];if(!C.used||(C!==this.sourceCache&&this.resetTileLookupCache(C.id),this._setupProxiedCoordsForOrtho(C,r[b],d),C.usedForTerrain))continue;const S=r[b];C.getSource().reparseOverscaled&&this._assignTerrainTiles(S)}this.proxiedCoords[l.id]=u.map(b=>new Qi(b,b.key,this.orthoMatrix)),this._assignTerrainTiles(u),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(d),this.renderingToTexture=!1,this._updateTimestamp=c.exported.now();const v={};this._visibleDemTiles=[];for(const b of this.proxyCoords){const C=this.terrainTileForTile[b.key];if(!C)continue;const S=C.tileID.key;S in v||(this._visibleDemTiles.push(C),v[S]=S)}}_assignTerrainTiles(r){this._initializing||r.forEach(l=>{if(this.terrainTileForTile[l.key])return;const _=this._findTileCoveringTileID(l,this.sourceCache);_&&(this.terrainTileForTile[l.key]=_)})}_prepareDEMTextures(){const r=this.painter.context,l=r.gl;for(const _ in this.terrainTileForTile){const u=this.terrainTileForTile[_],d=u.dem;!d||u.demTexture&&!u.needsDEMTextureUpload||(r.activeTexture.set(l.TEXTURE1),Jo(this.painter,u,d))}}_prepareDemTileUniforms(r,l,_,u){if(!l||null==l.demTexture)return!1;const d=r.tileID.canonical,f=Math.pow(2,l.tileID.canonical.z-d.z),v=u||"";return _[`u_dem_tl${v}`]=[d.x*f%1,d.y*f%1],_[`u_dem_scale${v}`]=f,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,l=r.gl;if(!this._emptyDepthBufferTexture){const _=new c.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new c.Texture(r,_,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const l=this._visibleDemTiles.reduce((_,u)=>{if(!u.dem)return _;const d=u.dem.tree.minimums[0];return d>0&&r++,_+d},0);return r?l/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,l=r.gl;r.activeTexture.set(l.TEXTURE2);const _=this._getLoadedAreaMinimum(),u=new c.RGBAImage({width:1,height:1},new Uint8Array(c.DEMData.pack(_,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let d=this._emptyDEMTexture;return d?d.update(u,{premultiply:!1}):d=this._emptyDEMTexture=new c.Texture(r,u,l.RGBA,{premultiply:!1}),d}setupElevationDraw(r,l,_){const u=this.painter.context,d=u.gl,f=(v=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:c.DEMData.getUnpackVector(v),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var v;f.u_dem_size=this.sourceCache.getSource().tileSize,f.u_exaggeration=this.exaggeration();let b=null,C=null,S=1;if(_&&_.morphing&&this._useVertexMorphing){const z=_.morphing.srcDemTile,H=_.morphing.dstDemTile;S=_.morphing.phase,z&&H&&(this._prepareDemTileUniforms(r,z,f,"_prev")&&(C=z),this._prepareDemTileUniforms(r,H,f)&&(b=H))}if(C&&b?(u.activeTexture.set(d.TEXTURE2),b.demTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE,d.NEAREST),u.activeTexture.set(d.TEXTURE4),C.demTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE,d.NEAREST),f.u_dem_lerp=S):(b=this.terrainTileForTile[r.tileID.key],u.activeTexture.set(d.TEXTURE2),(this._prepareDemTileUniforms(r,b,f)?b.demTexture:this.emptyDEMTexture).bind(d.NEAREST,d.CLAMP_TO_EDGE)),u.activeTexture.set(d.TEXTURE3),_&&_.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE),this._depthFBO&&(f.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE),f.u_depth_size_inv=[1,1]),_&&_.useMeterToDem&&b){const z=(1<<b.tileID.canonical.z)*c.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;f.u_meter_to_dem=z}if(_&&_.labelPlaneMatrixInv&&(f.u_label_plane_matrix_inv=_.labelPlaneMatrixInv),l.setTerrainUniformValues(u,f),"globe"===this.painter.transform.projection.name){const z=this.globeUniformValues(this.painter.transform,r.tileID.canonical,_&&_.useDenormalizedUpVectorScale);l.setGlobeUniformValues(u,z)}}globeUniformValues(r,l,_){const u=r.projection;return{u_tile_tl_up:u.upVector(l,0,0),u_tile_tr_up:u.upVector(l,c.EXTENT,0),u_tile_br_up:u.upVector(l,c.EXTENT,c.EXTENT),u_tile_bl_up:u.upVector(l,0,c.EXTENT),u_tile_up_scale:_?c.globeMetersToEcef(1):u.upVectorScale(l,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const l=this.painter,_=this.painter.context;0!==r.length&&(_.bindFramebuffer.set(null),_.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(u,d,f,v,b){if("globe"===u.transform.projection.name)!function(C,S,z,H,ee){const re=C.context,ue=re.gl;let fe,ne;const we=C.options.showTerrainWireframe?2:0,xe=C.transform,be=c.globeUseCustomAntiAliasing(C,re,xe),Re=(Ct,Ye)=>{if(ne===Ct)return;const He=[Ns[Ct],"PROJECTION_GLOBE_VIEW"];be&&He.push("CUSTOM_ANTIALIASING"),Ye&&He.push(Ns[we]),fe=C.useProgram("globeRaster",null,He),ne=Ct},Ae=C.colorModeForRenderPass(),ze=new c.DepthMode(ue.LEQUAL,c.DepthMode.ReadWrite,C.depthRangeFor3D);fs.update(ee);const qe=c.calculateGlobeMercatorMatrix(xe),Ke=[c.mercatorXfromLng(xe.center.lng),c.mercatorYfromLat(xe.center.lat)],Qe=we?[!1,!0]:[!1],Ht=C.globeSharedBuffers,Ze=[xe.width*c.exported.devicePixelRatio,xe.height*c.exported.devicePixelRatio],bt=Float32Array.from(xe.globeMatrix),ut={useDenormalizedUpVectorScale:!0};if(Qe.forEach(Ct=>{const Ye=C.transform,He=so(Ye.zoom)*S.exaggeration();ne=-1;const rt=Ct?ue.LINES:ue.TRIANGLES;for(const St of H){const Nt=z.getTile(St),An=c.StencilMode.disabled,_r=S.prevTerrainTileForTile[St.key],wn=S.terrainTileForTile[St.key];Ts(_r,wn)&&fs.newMorphing(St.key,_r,wn,ee,250),re.activeTexture.set(ue.TEXTURE0),Nt.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);const ln=fs.getMorphValuesForProxy(St.key),Sn=ln?1:0;ln&&c.extend$1(ut,{morphing:{srcDemTile:ln.from,dstDemTile:ln.to,phase:c.easeCubicInOut(ln.phase)}});const Mr=c.tileCornersToBounds(St.canonical),Fn=c.getLatitudinalLod(Mr.getCenter().lat),ei=c.getGridMatrix(St.canonical,Mr,Fn,Ye.worldSize/Ye._pixelsPerMercatorPixel),ci=c.globeNormalizeECEF(c.globeTileBounds(St.canonical)),bi=Bs(Ye.projMatrix,bt,qe,ci,c.globeToMercatorTransition(Ye.zoom),Ke,Ye.frustumCorners.TL,Ye.frustumCorners.TR,Ye.frustumCorners.BR,Ye.frustumCorners.BL,Ye.globeCenterInViewSpace,Ye.globeRadius,Ze,He,ei);if(Re(Sn,Ct),S.setupElevationDraw(Nt,fe,ut),C.prepareDrawProgram(re,fe,St.toUnwrapped()),Ht){const[Si,To,ea]=Ct?Ht.getWirefameBuffers(C.context,Fn):Ht.getGridBuffers(Fn,0!==He);fe.draw(re,rt,ze,An,Ae,c.CullFaceMode.backCCW,bi,"globe_raster",Si,To,ea)}}}),Ht){const Ct=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];be&&Ct.push("CUSTOM_ANTIALIASING"),fe=C.useProgram("globeRaster",null,Ct);for(const Ye of H){const{x:He,y:rt,z:St}=Ye.canonical,Nt=0===rt,An=rt===(1<<St)-1,[_r,wn,ln,Sn]=Ht.getPoleBuffers(St);if(Sn&&(Nt||An)){const Mr=z.getTile(Ye);re.activeTexture.set(ue.TEXTURE0),Mr.texture.bind(ue.LINEAR,ue.CLAMP_TO_EDGE);let Fn=c.globePoleMatrixForTile(St,He,xe);const ei=c.globeNormalizeECEF(c.globeTileBounds(Ye.canonical)),ci=(bi,Si)=>bi.draw(re,ue.TRIANGLES,ze,c.StencilMode.disabled,Ae,c.CullFaceMode.disabled,Bs(xe.projMatrix,Fn,Fn,ei,0,Ke,xe.frustumCorners.TL,xe.frustumCorners.TR,xe.frustumCorners.BR,xe.frustumCorners.BL,xe.globeCenterInViewSpace,xe.globeRadius,Ze,0),"globe_pole_raster",Si,ln,Sn);S.setupElevationDraw(Mr,fe,ut),C.prepareDrawProgram(re,fe,Ye.toUnwrapped()),Nt&&ci(fe,_r),An&&(Fn=c.scale(c.create(),Fn,[1,-1,1]),ci(fe,wn))}}}}(u,d,f,v,b);else{const C=u.context,S=C.gl;let z,H;const ee=u.options.showTerrainWireframe?2:0,re=(xe,be)=>{if(H===xe)return;const Re=[Ns[xe]];be&&Re.push(Ns[ee]),z=u.useProgram("terrainRaster",null,Re),H=xe},ue=u.colorModeForRenderPass(),fe=new c.DepthMode(S.LEQUAL,c.DepthMode.ReadWrite,u.depthRangeFor3D);fs.update(b);const ne=u.transform,we=so(ne.zoom)*d.exaggeration();(ee?[!1,!0]:[!1]).forEach(xe=>{H=-1;const be=xe?S.LINES:S.TRIANGLES,[Re,Ae]=xe?d.getWirefameBuffer():[d.gridIndexBuffer,d.gridSegments];for(const ze of v){const qe=f.getTile(ze),Ke=c.StencilMode.disabled,Qe=d.prevTerrainTileForTile[ze.key],Ht=d.terrainTileForTile[ze.key];Ts(Qe,Ht)&&fs.newMorphing(ze.key,Qe,Ht,b,250),C.activeTexture.set(S.TEXTURE0),qe.texture.bind(S.LINEAR,S.CLAMP_TO_EDGE,S.LINEAR_MIPMAP_NEAREST);const Ze=fs.getMorphValuesForProxy(ze.key),bt=Ze?1:0;let ut;Ze&&(ut={morphing:{srcDemTile:Ze.from,dstDemTile:Ze.to,phase:c.easeCubicInOut(Ze.phase)}});const Ct=zs(ze.projMatrix,Ma(ze.canonical,ne.renderWorldCopies)?we/10:we);re(bt,xe),d.setupElevationDraw(qe,z,ut),u.prepareDrawProgram(C,z,ze.toUnwrapped()),z.draw(C,be,fe,Ke,ue,c.CullFaceMode.backCCW,Ct,"terrain_raster",d.gridBuffer,Re,Ae)}})}}(l,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(0===this._drapedRenderBatches.length)return r+1;this.renderingToTexture=!0;const l=this.painter,_=this.painter.context,u=this.proxySourceCache,d=this.proxiedCoords[u.id],f=this._drapedRenderBatches.shift(),v=[],b=l.style.order;let C=0;for(const S of d){const z=u.getTileByID(S.proxyTileKey),H=u.proxyCachedFBO[S.key]?u.proxyCachedFBO[S.key][r]:void 0,ee=void 0!==H?u.renderCache[H]:this.pool[C++],re=void 0!==H;if(z.texture=ee.tex,re&&!ee.dirty){v.push(z.tileID);continue}let ue;_.bindFramebuffer.set(ee.fb.framebuffer),this.renderedToTile=!1,ee.dirty&&(_.clear({color:c.Color.transparent,stencil:0}),ee.dirty=!1);for(let fe=f.start;fe<=f.end;++fe){const ne=l.style._layers[b[fe]];if(ne.isHidden(l.transform.zoom))continue;const we=l.style._getLayerSourceCache(ne),xe=we?this.proxyToSource[S.key][we.id]:[S];if(!xe)continue;const be=xe;_.viewport.set([0,0,ee.fb.width,ee.fb.height]),ue!==(we?we.id:null)&&(this._setupStencil(ee,xe,ne,we),ue=we?we.id:null),l.renderLayer(l,we,ne,be)}this.renderedToTile?(ee.dirty=!0,v.push(z.tileID)):re||--C,5===C&&(C=0,this.renderToBackBuffer(v))}return this.renderToBackBuffer(v),this.renderingToTexture=!1,_.bindFramebuffer.set(null),_.viewport.set([0,0,l.width,l.height]),f.end+1}postRender(){}renderCacheEfficiency(r){const l=r.order.length;if(0===l)return{efficiency:100};let _,u=0,d=0,f=!1;for(let v=0;v<l;++v){const b=r._layers[r.order[v]];this._style.isLayerDraped(b)?(f&&++u,++d):f||(f=!0,_=b.id)}return 0===d?{efficiency:100}:{efficiency:100*(1-u/d),firstUndrapedLayer:_}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{r=Math.min(r,l.dem.tree.minimums[0])}),0===r?r:(r-30)*this._exaggeration}raycast(r,l,_){if(!this._visibleDemTiles)return null;const u=this._visibleDemTiles.filter(d=>d.dem).map(d=>{const f=d.tileID,v=1<<f.overscaledZ,{x:b,y:C}=f.canonical,S=b/v,z=(b+1)/v,H=C/v,ee=(C+1)/v;return{minx:S,miny:H,maxx:z,maxy:ee,t:d.dem.tree.raycastRoot(S,H,z,ee,r,l,_),tile:d}});u.sort((d,f)=>(null!==d.t?d.t:Number.MAX_VALUE)-(null!==f.t?f.t:Number.MAX_VALUE));for(const d of u){if(null==d.t)return null;const f=d.tile.dem.tree.raycast(d.minx,d.miny,d.maxx,d.maxy,r,l,_);if(null!=f)return f}return null}_createFBO(){const r=this.painter.context,l=r.gl,_=this.drapeBufferSize;r.activeTexture.set(l.TEXTURE0);const u=new c.Texture(r,{width:_[0],height:_[1],data:null},l.RGBA);u.bind(l.LINEAR,l.CLAMP_TO_EDGE);const d=r.createFramebuffer(_[0],_[1],!1);return d.colorAttachment.set(u.texture),d.depthAttachment=new It(r,d.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,_[0],_[1]),this._stencilRef=0,d.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):d.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:d,tex:u,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const l=this._style._layers[r],_=l.isHidden(this.painter.transform.zoom);return"custom"===l.type?!_&&l.shouldRedrape():!_&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const _ of this._style._getSources())if(_ instanceof q){r=!0;break}if(!r)return;const l={};for(let _=0;_<this._style.order.length;++_){const u=this._style._layers[this._style.order[_]],d=this._style._getLayerSourceCache(u);if(d&&!l[d.id]&&!u.isHidden(this.painter.transform.zoom)&&"line"===u.type&&u.widthExpression()instanceof c.ZoomDependentExpression){l[d.id]=!0;for(const f of this.proxyCoords){const v=this.proxyToSource[f.key][d.id];if(v)for(const b of v)this._clearRenderCacheForTile(d.id,b)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const _ in this._style._sourceCaches)if(this._style._sourceCaches[_]._source instanceof Y){r=!0;break}if(!r)return;const l={};for(let _=0;_<this._style.order.length;++_){const u=this._style._layers[this._style.order[_]],d=this._style._getLayerSourceCache(u);if(!d||l[d.id]||u.isHidden(this.painter.transform.zoom)||"raster"!==u.type)continue;const f=u.paint.get("raster-fade-duration");for(const v of this.proxyCoords){const b=this.proxyToSource[v.key][d.id];if(b)for(const C of b){const S=ri(d.getTile(C),d.findLoadedParent(C,0),d,this.painter.transform,f);(1!==S.opacity||0!==S.mix)&&this._clearRenderCacheForTile(d.id,C)}}}}_setupDrapedRenderBatches(){const r=this._style.order,l=r.length;if(0===l)return;const _=[];let u,d=0,f=this._style._layers[r[d]];for(;!this._style.isLayerDraped(f)&&f.isHidden(this.painter.transform.zoom)&&++d<l;)f=this._style._layers[r[d]];for(;d<l;++d){const v=this._style._layers[r[d]];v.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(v)?void 0===u&&(u=d):void 0!==u&&(_.push({start:u,end:d-1}),u=void 0))}void 0!==u&&_.push({start:u,end:d-1}),this._drapedRenderBatches=_}_setupRenderCache(r){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const f=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let v=0;v<f.length;++v){const b=Object.values(f[v]);l.renderCachePool.push(...b)}}return}this._clearRasterLayersFromRenderCache();const _=this.proxyCoords,u=this._tilesDirty;for(let f=_.length-1;f>=0;f--){const v=_[f];if(l.getTileByID(v.key),void 0!==l.proxyCachedFBO[v.key]){const b=r[v.key],C=this.proxyToSource[v.key];let S=0;for(const z in C){const H=C[z],ee=b[z];if(!ee||ee.length!==H.length||H.some((re,ue)=>re!==ee[ue]||u[z]&&u[z].hasOwnProperty(re.key))){S=-1;break}++S}for(const z in l.proxyCachedFBO[v.key])l.renderCache[l.proxyCachedFBO[v.key][z]].dirty=S<0||S!==Object.values(b).length}}const d=[...this._drapedRenderBatches];d.sort((f,v)=>v.end-v.start-(f.end-f.start));for(const f of d)for(const v of _){if(l.proxyCachedFBO[v.key])continue;let b=l.renderCachePool.pop();void 0===b&&l.renderCache.length<50&&(b=l.renderCache.length,l.renderCache.push(this._createFBO())),void 0!==b&&(l.proxyCachedFBO[v.key]={},l.proxyCachedFBO[v.key][f.start]=b,l.renderCache[b].dirty=!0)}this._tilesDirty={}}_setupStencil(r,l,_,u){if(!u||!this._sourceTilesOverlap[u.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const d=this.painter.context,f=d.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let v;if(_.isTileClipped())v=l.length,this._overlapStencilMode.test={func:f.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);v=1,this._overlapStencilMode.test={func:f.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+v>255&&(d.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=v,this._overlapStencilMode.ref=this._stencilRef,_.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):c.StencilMode.disabled}_renderTileClippingMasks(r,l){const _=this.painter,u=this.painter.context,d=u.gl;_._tileClippingMaskIDs={},u.setColorMode(c.ColorMode.disabled),u.setDepthMode(c.DepthMode.disabled);const f=_.useProgram("clippingMask");for(const v of r){const b=_._tileClippingMaskIDs[v.key]=--l;f.draw(u,d.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:d.ALWAYS,mask:0},b,255,d.KEEP,d.KEEP,d.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,fr(v.projMatrix),"$clipping",_.tileExtentBuffer,_.quadTriangleIndexBuffer,_.tileExtentSegments)}}pointCoordinate(r){const l=this.painter.transform;if(r.x<0||r.x>l.width||r.y<0||r.y>l.height)return null;const _=[r.x,r.y,1,1];c.transformMat4$1(_,_,l.pixelMatrixInverse),c.scale$1(_,_,1/_[3]),_[0]/=l.worldSize,_[1]/=l.worldSize;const u=l._camera.position,d=c.mercatorZfromAltitude(1,l.center.lat),f=[u[0],u[1],u[2]/d,0],v=c.subtract([],_.slice(0,3),f);c.normalize(v,v);const b=this.raycast(f,v,this._exaggeration);return null!==b&&b?(c.scaleAndAdd(f,f,v,b),f[3]=f[2],f[2]*=d,f):null}drawDepth(){const r=this.painter,l=r.context,_=this.proxySourceCache,u=Math.ceil(r.width),d=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===u&&this._depthFBO.height===d||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const f=l.gl,v=l.createFramebuffer(u,d,!0);l.activeTexture.set(f.TEXTURE0);const b=new c.Texture(l,{width:u,height:d,data:null},f.RGBA);b.bind(f.NEAREST,f.CLAMP_TO_EDGE),v.colorAttachment.set(b.texture);const C=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,u,d);v.depthAttachment.set(C),this._depthFBO=v,this._depthTexture=b}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,u,d]),function(f,v,b,C){if("globe"===f.transform.projection.name)return;const S=f.context,z=S.gl;S.clear({depth:1});const H=f.useProgram("terrainDepth"),ee=new c.DepthMode(z.LESS,c.DepthMode.ReadWrite,f.depthRangeFor3D);for(const re of C){const ue=b.getTile(re),fe=zs(re.projMatrix,0);v.setupElevationDraw(ue,H),H.draw(S,z.TRIANGLES,ee,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.backCCW,fe,"terrain_depth",v.gridBuffer,v.gridIndexBuffer,v.gridNoSkirtSegments)}}(r,this,_,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,l,_){if(r.getSource()instanceof ie)return this._setupProxiedCoordsForImageSource(r,l,_);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const u=this.proxiedCoords[r.id]=[],d=this.proxyCoords;for(let v=0;v<d.length;v++){const b=d[v],C=this._findTileCoveringTileID(b,r);if(C){const S=this._createProxiedId(b,C,_[b.key]&&_[b.key][r.id]);u.push(S),this.proxyToSource[b.key][r.id]=[S]}}let f=!1;for(let v=0;v<l.length;v++){const b=r.getTile(l[v]);if(!b||!b.hasData())continue;const C=this._findTileCoveringTileID(b.tileID,this.proxySourceCache);if(C&&C.tileID.canonical.z!==b.tileID.canonical.z){const S=this.proxyToSource[C.tileID.key][r.id],z=this._createProxiedId(C.tileID,b,_[C.tileID.key]&&_[C.tileID.key][r.id]);S?S.splice(S.length-1,0,z):this.proxyToSource[C.tileID.key][r.id]=[z],u.push(z),f=!0}}this._sourceTilesOverlap[r.id]=f}_setupProxiedCoordsForImageSource(r,l,_){if(!r.getSource().loaded())return;const u=this.proxiedCoords[r.id]=[],d=this.proxyCoords,f=r.getSource(),v=new c.pointGeometry(f.tileID.x,f.tileID.y)._div(1<<f.tileID.z),b=f.coordinates.map(c.MercatorCoordinate.fromLngLat).reduce((S,z)=>(S.min.x=Math.min(S.min.x,z.x-v.x),S.min.y=Math.min(S.min.y,z.y-v.y),S.max.x=Math.max(S.max.x,z.x-v.x),S.max.y=Math.max(S.max.y,z.y-v.y),S),{min:new c.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new c.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),C=(S,z)=>{const H=S.wrap+S.canonical.x/(1<<S.canonical.z),ee=S.canonical.y/(1<<S.canonical.z),re=c.EXTENT/(1<<S.canonical.z),ue=z.wrap+z.canonical.x/(1<<z.canonical.z),fe=z.canonical.y/(1<<z.canonical.z);return H+re<ue+b.min.x||H>ue+b.max.x||ee+re<fe+b.min.y||ee>fe+b.max.y};for(let S=0;S<d.length;S++){const z=d[S];for(let H=0;H<l.length;H++){const ee=r.getTile(l[H]);if(!ee||!ee.hasData()||C(z,ee.tileID))continue;const re=this._createProxiedId(z,ee,_[z.key]&&_[z.key][r.id]),ue=this.proxyToSource[z.key][r.id];ue?ue.push(re):this.proxyToSource[z.key][r.id]=[re],u.push(re)}}}_createProxiedId(r,l,_){let u=this.orthoMatrix;if(_){const d=_.find(f=>f.key===l.tileID.key);if(d)return d}if(l.tileID.key!==r.key){const d=r.canonical.z-l.tileID.canonical.z;let f,v,b;u=c.create();const C=l.tileID.wrap-r.wrap<<r.overscaledZ;d>0?(f=c.EXTENT>>d,v=f*((l.tileID.canonical.x<<d)-r.canonical.x+C),b=f*((l.tileID.canonical.y<<d)-r.canonical.y)):(f=c.EXTENT<<-d,v=c.EXTENT*(l.tileID.canonical.x-(r.canonical.x+C<<-d)),b=c.EXTENT*(l.tileID.canonical.y-(r.canonical.y<<-d))),c.ortho(u,0,f,0,f,0,1),c.translate(u,u,[v,b,0])}return new Qi(l.tileID,r.key,u)}_findTileCoveringTileID(r,l){let _=l.getTile(r);if(_&&_.hasData())return _;const u=this._findCoveringTileCache[l.id],d=u[r.key];if(_=d?l.getTileByID(d):null,_&&_.hasData()||null===d)return _;let f=_?_.tileID:r,v=f.overscaledZ;const b=l.getSource().minzoom,C=[];if(!d){const z=l.getSource().maxzoom;if(r.canonical.z>=z){const H=r.canonical.z-z;l.getSource().reparseOverscaled?(v=Math.max(r.canonical.z+2,l.transform.tileZoom),f=new c.OverscaledTileID(v,r.wrap,z,r.canonical.x>>H,r.canonical.y>>H)):0!==H&&(v=z,f=new c.OverscaledTileID(v,r.wrap,z,r.canonical.x>>H,r.canonical.y>>H))}f.key!==r.key&&(C.push(f.key),_=l.getTile(f))}const S=z=>{C.forEach(H=>{u[H]=z}),C.length=0};for(v-=1;v>=b&&(!_||!_.hasData());v--){_&&S(_.tileID.key);const z=f.calculateScaledKey(v);if(_=l.getTileByID(z),_&&_.hasData())break;const H=u[z];if(null===H)break;void 0===H?C.push(z):_=l.getTileByID(H)}return S(_?_.tileID.key:null),_&&_.hasData()?_:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,l){let _=this._tilesDirty[r];_||(_=this._tilesDirty[r]={}),_[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(l){let _=0;const u=new c.StructArrayLayout2ui4,d=131;for(let f=1;f<129;f++){for(let v=1;v<129;v++)_=f*d+v,u.emplaceBack(_,_+1),u.emplaceBack(_,_+d),u.emplaceBack(_+1,_+d),128===f&&u.emplaceBack(_+d,_+d+1);u.emplaceBack(_+1,_+1+d)}return u}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=c.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class da{static cacheKey(r,l,_,u){let d=`${l}${u?u.cacheKey:""}`;for(const f of _)r.usedDefines.includes(f)&&(d+=`/${f}`);return d}constructor(r,l,_,u,d,f){const v=r.gl;this.program=v.createProgram();const b=function(ne){const we=[];for(let xe=0;xe<ne.length;xe++){if(null===ne[xe])continue;const be=ne[xe].split(" ");we.push(be.pop())}return we}(_.staticAttributes),C=u?u.getBinderAttributes():[],S=b.concat(C);let z=u?u.defines():[];z=z.concat(f.map(ne=>`#define ${ne}`));const H=r.isWebGL2?"#version 300 es\n":"",ee=H+z.concat(r.extStandardDerivatives&&0===H.length?"#extension GL_OES_standard_derivatives : enable\n".concat(Yo):Yo,Yo,ua,Ya.fragmentSource,Os.fragmentSource,_.fragmentSource).join("\n"),re=H+z.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",ua,Ya.vertexSource,Os.vertexSource,ca.vertexSource,_.vertexSource).join("\n"),ue=v.createShader(v.FRAGMENT_SHADER);if(v.isContextLost())return void(this.failedToCreate=!0);v.shaderSource(ue,ee),v.compileShader(ue),v.attachShader(this.program,ue);const fe=v.createShader(v.VERTEX_SHADER);if(v.isContextLost())this.failedToCreate=!0;else{v.shaderSource(fe,re),v.compileShader(fe),v.attachShader(this.program,fe),this.attributes={},this.numAttributes=S.length;for(let ne=0;ne<this.numAttributes;ne++)S[ne]&&(v.bindAttribLocation(this.program,ne,S[ne]),this.attributes[S[ne]]=ne);v.linkProgram(this.program),v.deleteShader(fe),v.deleteShader(ue),this.fixedUniforms=d(r),this.binderUniforms=u?u.getUniforms(r):[],f.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new c.Uniform1i(ne=r),u_dem_prev:new c.Uniform1i(ne),u_dem_unpack:new c.Uniform4f(ne),u_dem_tl:new c.Uniform2f(ne),u_dem_scale:new c.Uniform1f(ne),u_dem_tl_prev:new c.Uniform2f(ne),u_dem_scale_prev:new c.Uniform1f(ne),u_dem_size:new c.Uniform1f(ne),u_dem_lerp:new c.Uniform1f(ne),u_exaggeration:new c.Uniform1f(ne),u_depth:new c.Uniform1i(ne),u_depth_size_inv:new c.Uniform2f(ne),u_meter_to_dem:new c.Uniform1f(ne),u_label_plane_matrix_inv:new c.UniformMatrix4f(ne)}),f.includes("GLOBE")&&(this.globeUniforms=(ne=>({u_tile_tl_up:new c.Uniform3f(ne),u_tile_tr_up:new c.Uniform3f(ne),u_tile_br_up:new c.Uniform3f(ne),u_tile_bl_up:new c.Uniform3f(ne),u_tile_up_scale:new c.Uniform1f(ne)}))(r)),f.includes("FOG")&&(this.fogUniforms=(ne=>({u_fog_matrix:new c.UniformMatrix4f(ne),u_fog_range:new c.Uniform2f(ne),u_fog_color:new c.Uniform4f(ne),u_fog_horizon_blend:new c.Uniform1f(ne),u_fog_temporal_offset:new c.Uniform1f(ne),u_frustum_tl:new c.Uniform3f(ne),u_frustum_tr:new c.Uniform3f(ne),u_frustum_br:new c.Uniform3f(ne),u_frustum_bl:new c.Uniform3f(ne),u_globe_pos:new c.Uniform3f(ne),u_globe_radius:new c.Uniform1f(ne),u_globe_transition:new c.Uniform1f(ne),u_is_globe:new c.Uniform1i(ne),u_viewport:new c.Uniform2f(ne)}))(r))}var ne}setTerrainUniformValues(r,l){if(!this.terrainUniforms)return;const _=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const u in l)_[u]&&_[u].set(this.program,u,l[u])}}setGlobeUniformValues(r,l){if(!this.globeUniforms)return;const _=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const u in l)_[u]&&_[u].set(this.program,u,l[u])}}setFogUniformValues(r,l){if(!this.fogUniforms)return;const _=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const u in l)_[u].set(this.program,u,l[u])}}draw(r,l,_,u,d,f,v,b,C,S,z,H,ee,re,ue){const fe=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(_),r.setStencilMode(u),r.setColorMode(d),r.setCullFace(f);for(const we of Object.keys(this.fixedUniforms))this.fixedUniforms[we].set(this.program,we,v[we]);re&&re.setUniforms(this.program,r,this.binderUniforms,H,{zoom:ee});const ne={[fe.LINES]:2,[fe.TRIANGLES]:3,[fe.LINE_STRIP]:1}[l];for(const we of z.get()){const xe=we.vaos||(we.vaos={});(xe[b]||(xe[b]=new Vo)).bind(r,this,C,re?re.getPaintVertexBuffers():[],S,we.vertexOffset,ue||[]),fe.drawElements(l,we.primitiveLength*ne,fe.UNSIGNED_SHORT,we.primitiveOffset*ne*2)}}}function $o(p,r){const l=Math.pow(2,r.tileID.overscaledZ),_=r.tileSize*Math.pow(2,p.transform.tileZoom)/l,u=_*(r.tileID.canonical.x+r.tileID.wrap*l),d=_*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_tile_units_to_pixels:1/Dt(r,1,p.transform.tileZoom),u_pixel_coord_upper:[u>>16,d>>16],u_pixel_coord_lower:[65535&u,65535&d]}}const Ao=c.create(),Ks=(p,r,l,_,u,d,f,v,b,C,S)=>{const z=r.style.light,H=z.properties.get("position"),ee=[H.x,H.y,H.z],re=c.create$1();"viewport"===z.properties.get("anchor")&&(c.fromRotation(re,-r.transform.angle),c.transformMat3(ee,ee,re));const ue=z.properties.get("color"),fe=r.transform,ne={u_matrix:p,u_lightpos:ee,u_lightintensity:z.properties.get("intensity"),u_lightcolor:[ue.r,ue.g,ue.b],u_vertical_gradient:+l,u_opacity:_,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Ao,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:u,u_edge_radius:d};return"globe"===fe.projection.name&&(ne.u_tile_id=[f.canonical.x,f.canonical.y,1<<f.canonical.z],ne.u_zoom_transition=b,ne.u_inv_rot_matrix=S,ne.u_merc_center=C,ne.u_up_dir=fe.projection.upVector(new c.CanonicalTileID(0,0,0),C[0]*c.EXTENT,C[1]*c.EXTENT),ne.u_height_lift=v),ne},Go=(p,r,l,_,u,d,f,v,b,C,S,z)=>{const H=Ks(p,r,l,_,u,d,f,b,C,S,z),ee={u_height_factor:-Math.pow(2,f.overscaledZ)/v.tileSize/8};return c.extend(H,$o(r,v),ee)},ps=p=>({u_matrix:p}),Ho=(p,r,l)=>c.extend(ps(p),$o(r,l)),Ua=(p,r)=>({u_matrix:p,u_world:r}),ms=(p,r,l,_)=>c.extend(Ho(p,r,l),{u_world:_}),Tn=c.create(),fa=(p,r,l,_,u,d)=>{const f=p.transform,v="globe"===f.projection.name;let b;if("map"===d.paint.get("circle-pitch-alignment"))if(v){const S=c.globePixelsToTileUnits(f.zoom,r.canonical)*f._pixelsPerMercatorPixel;b=Float32Array.from([S,0,0,S])}else b=f.calculatePixelsToTileUnitsMatrix(l);else b=new Float32Array([f.pixelsToGLUnits[0],0,0,f.pixelsToGLUnits[1]]);const C={u_camera_to_center_distance:f.cameraToCenterDistance,u_matrix:p.translatePosMatrix(r.projMatrix,l,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:c.exported.devicePixelRatio,u_extrude_scale:b,u_inv_rot_matrix:Tn,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(v){C.u_inv_rot_matrix=_,C.u_merc_center=u,C.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],C.u_zoom_transition=c.globeToMercatorTransition(f.zoom);const S=u[0]*c.EXTENT,z=u[1]*c.EXTENT;C.u_up_dir=f.projection.upVector(new c.CanonicalTileID(0,0,0),S,z)}return C},ja=p=>{const r=[];return"map"===p.paint.get("circle-pitch-alignment")&&r.push("PITCH_WITH_MAP"),"map"===p.paint.get("circle-pitch-scale")&&r.push("SCALE_WITH_MAP"),r},pa=(p,r,l,_)=>{const u=c.EXTENT/l.tileSize;return{u_matrix:p,u_camera_to_center_distance:r.getCameraToCenterDistance(_),u_extrude_scale:[r.pixelsToGLUnits[0]/u,r.pixelsToGLUnits[1]/u]}},Ds=(p,r,l=1)=>({u_matrix:p,u_color:r,u_overlay:0,u_overlay_scale:l}),Va=c.create(),Po=(p,r,l,_,u,d,f)=>{const v=p.transform,b="globe"===v.projection.name,C=b?c.globePixelsToTileUnits(v.zoom,r.canonical)*v._pixelsPerMercatorPixel:Dt(l,1,d),S={u_matrix:r.projMatrix,u_extrude_scale:C,u_intensity:f,u_inv_rot_matrix:Va,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(b){S.u_inv_rot_matrix=_,S.u_merc_center=u,S.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],S.u_zoom_transition=c.globeToMercatorTransition(v.zoom);const z=u[0]*c.EXTENT,H=u[1]*c.EXTENT;S.u_up_dir=v.projection.upVector(new c.CanonicalTileID(0,0,0),z,H)}return S},Ia=(p,r,l,_,u,d,f)=>{const v=p.transform,b=v.calculatePixelsToTileUnitsMatrix(r);return{u_matrix:Sr(p,r,l,_),u_pixels_to_tile_units:b,u_device_pixel_ratio:d,u_units_to_pixels:[1/v.pixelsToGLUnits[0],1/v.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:u,u_texsize:Aa(l)?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Ft(r,p.transform),u_alpha_discard_threshold:0,u_trim_offset:f}},Qa=(p,r,l,_,u)=>{const d=p.transform;return{u_matrix:Sr(p,r,l,_),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:d.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:u,u_image:0,u_tile_units_to_pixels:Ft(r,d),u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Ft(p,r){return 1/Dt(p,1,r.tileZoom)}function Sr(p,r,l,_){return p.translatePosMatrix(_||r.tileID.projMatrix,r,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function Aa(p){const r=p.paint.get("line-dasharray").value;return r.value||"constant"!==r.kind}const el=(p,r,l,_,u,d)=>{return{u_matrix:p,u_tl_parent:r,u_scale_parent:l,u_fade_t:_.mix,u_opacity:_.opacity*u.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:u.paint.get("raster-brightness-min"),u_brightness_high:u.paint.get("raster-brightness-max"),u_saturation_factor:(v=u.paint.get("raster-saturation"),v>0?1-1/(1.001-v):-v),u_contrast_factor:(f=u.paint.get("raster-contrast"),f>0?1/(1-f):1+f),u_spin_weights:mi(u.paint.get("raster-hue-rotate")),u_perspective_transform:d};var f,v};function mi(p){p*=Math.PI/180;const r=Math.sin(p),l=Math.cos(p);return[(2*l+1)/3,(-Math.sqrt(3)*r-l+1)/3,(Math.sqrt(3)*r-l+1)/3]}const gs=c.create(),Xi=(p,r,l,_,u,d,f,v,b,C,S,z,H,ee,re,ue)=>{const fe=u.transform,ne={u_is_size_zoom_constant:+("constant"===p||"source"===p),u_is_size_feature_constant:+("constant"===p||"camera"===p),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:fe.cameraToCenterDistance,u_rotate_symbol:+l,u_aspect_ratio:fe.width/fe.height,u_fade_change:u.options.fadeDuration?u.symbolFadeChange:1,u_matrix:d,u_label_plane_matrix:f,u_coord_matrix:v,u_is_text:+b,u_pitch_with_map:+_,u_texsize:C,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:gs,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:gs,u_up_vector:[0,-1,0]};return"globe"===ue.name&&(ne.u_tile_id=[S.canonical.x,S.canonical.y,1<<S.canonical.z],ne.u_zoom_transition=z,ne.u_inv_rot_matrix=ee,ne.u_merc_center=H,ne.u_camera_forward=fe._camera.forward(),ne.u_ecef_origin=c.globeECEFOrigin(fe.globeMatrix,S.toUnwrapped()),ne.u_tile_matrix=Float32Array.from(fe.globeMatrix),ne.u_up_vector=re),ne},Ro=(p,r,l,_,u,d,f,v,b,C,S,z,H,ee,re,ue,fe)=>c.extend(Xi(p,r,l,_,u,d,f,v,b,C,z,H,ee,re,ue,fe),{u_gamma_scale:_?u.transform.cameraToCenterDistance*Math.cos(u.terrain?0:u.transform._pitch):1,u_device_pixel_ratio:c.exported.devicePixelRatio,u_is_halo:+S}),ma=(p,r,l,_,u,d,f,v,b,C,S,z,H,ee,re,ue)=>c.extend(Ro(p,r,l,_,u,d,f,v,!0,b,!0,S,z,H,ee,re,ue),{u_texsize_icon:C,u_texture_icon:1}),ga=(p,r,l)=>({u_matrix:p,u_opacity:r,u_color:l}),Ys=(p,r,l,_,u)=>c.extend(function(d,f,v){const b=f.imageManager.getPattern(d.toString()),{width:C,height:S}=f.imageManager.getPixelSize(),z=Math.pow(2,v.tileID.overscaledZ),H=v.tileSize*Math.pow(2,f.transform.tileZoom)/z,ee=H*(v.tileID.canonical.x+v.tileID.wrap*z),re=H*v.tileID.canonical.y;return{u_image:0,u_pattern_tl:b.tl,u_pattern_br:b.br,u_texsize:[C,S],u_pattern_size:b.displaySize,u_tile_units_to_pixels:1/Dt(v,1,f.transform.tileZoom),u_pixel_coord_upper:[ee>>16,re>>16],u_pixel_coord_lower:[65535&ee,65535&re]}}(_,l,u),{u_matrix:p,u_opacity:r}),oc={fillExtrusion:p=>({u_matrix:new c.UniformMatrix4f(p),u_lightpos:new c.Uniform3f(p),u_lightintensity:new c.Uniform1f(p),u_lightcolor:new c.Uniform3f(p),u_vertical_gradient:new c.Uniform1f(p),u_opacity:new c.Uniform1f(p),u_edge_radius:new c.Uniform1f(p),u_ao:new c.Uniform2f(p),u_tile_id:new c.Uniform3f(p),u_zoom_transition:new c.Uniform1f(p),u_inv_rot_matrix:new c.UniformMatrix4f(p),u_merc_center:new c.Uniform2f(p),u_up_dir:new c.Uniform3f(p),u_height_lift:new c.Uniform1f(p)}),fillExtrusionPattern:p=>({u_matrix:new c.UniformMatrix4f(p),u_lightpos:new c.Uniform3f(p),u_lightintensity:new c.Uniform1f(p),u_lightcolor:new c.Uniform3f(p),u_vertical_gradient:new c.Uniform1f(p),u_height_factor:new c.Uniform1f(p),u_edge_radius:new c.Uniform1f(p),u_ao:new c.Uniform2f(p),u_tile_id:new c.Uniform3f(p),u_zoom_transition:new c.Uniform1f(p),u_inv_rot_matrix:new c.UniformMatrix4f(p),u_merc_center:new c.Uniform2f(p),u_up_dir:new c.Uniform3f(p),u_height_lift:new c.Uniform1f(p),u_image:new c.Uniform1i(p),u_texsize:new c.Uniform2f(p),u_pixel_coord_upper:new c.Uniform2f(p),u_pixel_coord_lower:new c.Uniform2f(p),u_tile_units_to_pixels:new c.Uniform1f(p),u_opacity:new c.Uniform1f(p)}),fill:p=>({u_matrix:new c.UniformMatrix4f(p)}),fillPattern:p=>({u_matrix:new c.UniformMatrix4f(p),u_image:new c.Uniform1i(p),u_texsize:new c.Uniform2f(p),u_pixel_coord_upper:new c.Uniform2f(p),u_pixel_coord_lower:new c.Uniform2f(p),u_tile_units_to_pixels:new c.Uniform1f(p)}),fillOutline:p=>({u_matrix:new c.UniformMatrix4f(p),u_world:new c.Uniform2f(p)}),fillOutlinePattern:p=>({u_matrix:new c.UniformMatrix4f(p),u_world:new c.Uniform2f(p),u_image:new c.Uniform1i(p),u_texsize:new c.Uniform2f(p),u_pixel_coord_upper:new c.Uniform2f(p),u_pixel_coord_lower:new c.Uniform2f(p),u_tile_units_to_pixels:new c.Uniform1f(p)}),circle:p=>({u_camera_to_center_distance:new c.Uniform1f(p),u_extrude_scale:new c.UniformMatrix2f(p),u_device_pixel_ratio:new c.Uniform1f(p),u_matrix:new c.UniformMatrix4f(p),u_inv_rot_matrix:new c.UniformMatrix4f(p),u_merc_center:new c.Uniform2f(p),u_tile_id:new c.Uniform3f(p),u_zoom_transition:new c.Uniform1f(p),u_up_dir:new c.Uniform3f(p)}),collisionBox:p=>({u_matrix:new c.UniformMatrix4f(p),u_camera_to_center_distance:new c.Uniform1f(p),u_extrude_scale:new c.Uniform2f(p)}),collisionCircle:p=>({u_matrix:new c.UniformMatrix4f(p),u_inv_matrix:new c.UniformMatrix4f(p),u_camera_to_center_distance:new c.Uniform1f(p),u_viewport_size:new c.Uniform2f(p)}),debug:p=>({u_color:new c.UniformColor(p),u_matrix:new c.UniformMatrix4f(p),u_overlay:new c.Uniform1i(p),u_overlay_scale:new c.Uniform1f(p)}),clippingMask:p=>({u_matrix:new c.UniformMatrix4f(p)}),heatmap:p=>({u_extrude_scale:new c.Uniform1f(p),u_intensity:new c.Uniform1f(p),u_matrix:new c.UniformMatrix4f(p),u_inv_rot_matrix:new c.UniformMatrix4f(p),u_merc_center:new c.Uniform2f(p),u_tile_id:new c.Uniform3f(p),u_zoom_transition:new c.Uniform1f(p),u_up_dir:new c.Uniform3f(p)}),heatmapTexture:p=>({u_image:new c.Uniform1i(p),u_color_ramp:new c.Uniform1i(p),u_opacity:new c.Uniform1f(p)}),hillshade:p=>({u_matrix:new c.UniformMatrix4f(p),u_image:new c.Uniform1i(p),u_latrange:new c.Uniform2f(p),u_light:new c.Uniform2f(p),u_shadow:new c.UniformColor(p),u_highlight:new c.UniformColor(p),u_accent:new c.UniformColor(p)}),hillshadePrepare:p=>({u_matrix:new c.UniformMatrix4f(p),u_image:new c.Uniform1i(p),u_dimension:new c.Uniform2f(p),u_zoom:new c.Uniform1f(p),u_unpack:new c.Uniform4f(p)}),line:p=>({u_matrix:new c.UniformMatrix4f(p),u_pixels_to_tile_units:new c.UniformMatrix2f(p),u_device_pixel_ratio:new c.Uniform1f(p),u_units_to_pixels:new c.Uniform2f(p),u_dash_image:new c.Uniform1i(p),u_gradient_image:new c.Uniform1i(p),u_image_height:new c.Uniform1f(p),u_texsize:new c.Uniform2f(p),u_tile_units_to_pixels:new c.Uniform1f(p),u_alpha_discard_threshold:new c.Uniform1f(p),u_trim_offset:new c.Uniform2f(p)}),linePattern:p=>({u_matrix:new c.UniformMatrix4f(p),u_texsize:new c.Uniform2f(p),u_pixels_to_tile_units:new c.UniformMatrix2f(p),u_device_pixel_ratio:new c.Uniform1f(p),u_image:new c.Uniform1i(p),u_units_to_pixels:new c.Uniform2f(p),u_tile_units_to_pixels:new c.Uniform1f(p),u_alpha_discard_threshold:new c.Uniform1f(p)}),raster:p=>({u_matrix:new c.UniformMatrix4f(p),u_tl_parent:new c.Uniform2f(p),u_scale_parent:new c.Uniform1f(p),u_fade_t:new c.Uniform1f(p),u_opacity:new c.Uniform1f(p),u_image0:new c.Uniform1i(p),u_image1:new c.Uniform1i(p),u_brightness_low:new c.Uniform1f(p),u_brightness_high:new c.Uniform1f(p),u_saturation_factor:new c.Uniform1f(p),u_contrast_factor:new c.Uniform1f(p),u_spin_weights:new c.Uniform3f(p),u_perspective_transform:new c.Uniform2f(p)}),symbolIcon:p=>({u_is_size_zoom_constant:new c.Uniform1i(p),u_is_size_feature_constant:new c.Uniform1i(p),u_size_t:new c.Uniform1f(p),u_size:new c.Uniform1f(p),u_camera_to_center_distance:new c.Uniform1f(p),u_rotate_symbol:new c.Uniform1i(p),u_aspect_ratio:new c.Uniform1f(p),u_fade_change:new c.Uniform1f(p),u_matrix:new c.UniformMatrix4f(p),u_label_plane_matrix:new c.UniformMatrix4f(p),u_coord_matrix:new c.UniformMatrix4f(p),u_is_text:new c.Uniform1i(p),u_pitch_with_map:new c.Uniform1i(p),u_texsize:new c.Uniform2f(p),u_tile_id:new c.Uniform3f(p),u_zoom_transition:new c.Uniform1f(p),u_inv_rot_matrix:new c.UniformMatrix4f(p),u_merc_center:new c.Uniform2f(p),u_camera_forward:new c.Uniform3f(p),u_tile_matrix:new c.UniformMatrix4f(p),u_up_vector:new c.Uniform3f(p),u_ecef_origin:new c.Uniform3f(p),u_texture:new c.Uniform1i(p)}),symbolSDF:p=>({u_is_size_zoom_constant:new c.Uniform1i(p),u_is_size_feature_constant:new c.Uniform1i(p),u_size_t:new c.Uniform1f(p),u_size:new c.Uniform1f(p),u_camera_to_center_distance:new c.Uniform1f(p),u_rotate_symbol:new c.Uniform1i(p),u_aspect_ratio:new c.Uniform1f(p),u_fade_change:new c.Uniform1f(p),u_matrix:new c.UniformMatrix4f(p),u_label_plane_matrix:new c.UniformMatrix4f(p),u_coord_matrix:new c.UniformMatrix4f(p),u_is_text:new c.Uniform1i(p),u_pitch_with_map:new c.Uniform1i(p),u_texsize:new c.Uniform2f(p),u_texture:new c.Uniform1i(p),u_gamma_scale:new c.Uniform1f(p),u_device_pixel_ratio:new c.Uniform1f(p),u_tile_id:new c.Uniform3f(p),u_zoom_transition:new c.Uniform1f(p),u_inv_rot_matrix:new c.UniformMatrix4f(p),u_merc_center:new c.Uniform2f(p),u_camera_forward:new c.Uniform3f(p),u_tile_matrix:new c.UniformMatrix4f(p),u_up_vector:new c.Uniform3f(p),u_ecef_origin:new c.Uniform3f(p),u_is_halo:new c.Uniform1i(p)}),symbolTextAndIcon:p=>({u_is_size_zoom_constant:new c.Uniform1i(p),u_is_size_feature_constant:new c.Uniform1i(p),u_size_t:new c.Uniform1f(p),u_size:new c.Uniform1f(p),u_camera_to_center_distance:new c.Uniform1f(p),u_rotate_symbol:new c.Uniform1i(p),u_aspect_ratio:new c.Uniform1f(p),u_fade_change:new c.Uniform1f(p),u_matrix:new c.UniformMatrix4f(p),u_label_plane_matrix:new c.UniformMatrix4f(p),u_coord_matrix:new c.UniformMatrix4f(p),u_is_text:new c.Uniform1i(p),u_pitch_with_map:new c.Uniform1i(p),u_texsize:new c.Uniform2f(p),u_texsize_icon:new c.Uniform2f(p),u_texture:new c.Uniform1i(p),u_texture_icon:new c.Uniform1i(p),u_gamma_scale:new c.Uniform1f(p),u_device_pixel_ratio:new c.Uniform1f(p),u_is_halo:new c.Uniform1i(p)}),background:p=>({u_matrix:new c.UniformMatrix4f(p),u_opacity:new c.Uniform1f(p),u_color:new c.UniformColor(p)}),backgroundPattern:p=>({u_matrix:new c.UniformMatrix4f(p),u_opacity:new c.Uniform1f(p),u_image:new c.Uniform1i(p),u_pattern_tl:new c.Uniform2f(p),u_pattern_br:new c.Uniform2f(p),u_texsize:new c.Uniform2f(p),u_pattern_size:new c.Uniform2f(p),u_pixel_coord_upper:new c.Uniform2f(p),u_pixel_coord_lower:new c.Uniform2f(p),u_tile_units_to_pixels:new c.Uniform1f(p)}),terrainRaster:Qo,terrainDepth:Qo,skybox:p=>({u_matrix:new c.UniformMatrix4f(p),u_sun_direction:new c.Uniform3f(p),u_cubemap:new c.Uniform1i(p),u_opacity:new c.Uniform1f(p),u_temporal_offset:new c.Uniform1f(p)}),skyboxGradient:p=>({u_matrix:new c.UniformMatrix4f(p),u_color_ramp:new c.Uniform1i(p),u_center_direction:new c.Uniform3f(p),u_radius:new c.Uniform1f(p),u_opacity:new c.Uniform1f(p),u_temporal_offset:new c.Uniform1f(p)}),skyboxCapture:p=>({u_matrix_3f:new c.UniformMatrix3f(p),u_sun_direction:new c.Uniform3f(p),u_sun_intensity:new c.Uniform1f(p),u_color_tint_r:new c.Uniform4f(p),u_color_tint_m:new c.Uniform4f(p),u_luminance:new c.Uniform1f(p)}),globeRaster:p=>({u_proj_matrix:new c.UniformMatrix4f(p),u_globe_matrix:new c.UniformMatrix4f(p),u_normalize_matrix:new c.UniformMatrix4f(p),u_merc_matrix:new c.UniformMatrix4f(p),u_zoom_transition:new c.Uniform1f(p),u_merc_center:new c.Uniform2f(p),u_image0:new c.Uniform1i(p),u_grid_matrix:new c.UniformMatrix3f(p),u_skirt_height:new c.Uniform1f(p),u_frustum_tl:new c.Uniform3f(p),u_frustum_tr:new c.Uniform3f(p),u_frustum_br:new c.Uniform3f(p),u_frustum_bl:new c.Uniform3f(p),u_globe_pos:new c.Uniform3f(p),u_globe_radius:new c.Uniform1f(p),u_viewport:new c.Uniform2f(p)}),globeAtmosphere:p=>({u_frustum_tl:new c.Uniform3f(p),u_frustum_tr:new c.Uniform3f(p),u_frustum_br:new c.Uniform3f(p),u_frustum_bl:new c.Uniform3f(p),u_horizon:new c.Uniform1f(p),u_transition:new c.Uniform1f(p),u_fadeout_range:new c.Uniform1f(p),u_color:new c.Uniform4f(p),u_high_color:new c.Uniform4f(p),u_space_color:new c.Uniform4f(p),u_star_intensity:new c.Uniform1f(p),u_star_density:new c.Uniform1f(p),u_star_size:new c.Uniform1f(p),u_temporal_offset:new c.Uniform1f(p),u_horizon_angle:new c.Uniform1f(p),u_rotation_matrix:new c.UniformMatrix4f(p)})};let Us;function Q(p,r,l,_,u,d,f){const v=p.context,b=v.gl,C=p.transform,S=p.useProgram("collisionBox"),z=[];let H=0,ee=0;for(let be=0;be<_.length;be++){const Re=_[be],Ae=r.getTile(Re),ze=Ae.getBucket(l);if(!ze)continue;const qe=oo(Re,ze,C);let Ke=qe;0===u[0]&&0===u[1]||(Ke=p.translatePosMatrix(qe,Ae,u,d));const Qe=f?ze.textCollisionBox:ze.iconCollisionBox,Ht=ze.collisionCircleArray;if(Ht.length>0){const Ze=c.create(),bt=Ke;c.mul(Ze,ze.placementInvProjMatrix,C.glCoordMatrix),c.mul(Ze,Ze,ze.placementViewportMatrix),z.push({circleArray:Ht,circleOffset:ee,transform:bt,invTransform:Ze,projection:ze.getProjection()}),H+=Ht.length/4,ee=H}Qe&&(p.terrain&&p.terrain.setupElevationDraw(Ae,S),S.draw(v,b.LINES,c.DepthMode.disabled,c.StencilMode.disabled,p.colorModeForRenderPass(),c.CullFaceMode.disabled,pa(Ke,C,Ae,ze.getProjection()),l.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,null,C.zoom,null,[Qe.collisionVertexBuffer,Qe.collisionVertexBufferExt]))}if(!f||!z.length)return;const re=p.useProgram("collisionCircle"),ue=new c.StructArrayLayout2f1f2i16;ue.resize(4*H),ue._trim();let fe=0;for(const be of z)for(let Re=0;Re<be.circleArray.length/4;Re++){const Ae=4*Re,ze=be.circleArray[Ae+0],qe=be.circleArray[Ae+1],Ke=be.circleArray[Ae+2],Qe=be.circleArray[Ae+3];ue.emplace(fe++,ze,qe,Ke,Qe,0),ue.emplace(fe++,ze,qe,Ke,Qe,1),ue.emplace(fe++,ze,qe,Ke,Qe,2),ue.emplace(fe++,ze,qe,Ke,Qe,3)}(!Us||Us.length<2*H)&&(Us=function(be){const Re=2*be,Ae=new c.StructArrayLayout3ui6;Ae.resize(Re),Ae._trim();for(let ze=0;ze<Re;ze++){const qe=6*ze;Ae.uint16[qe+0]=4*ze+0,Ae.uint16[qe+1]=4*ze+1,Ae.uint16[qe+2]=4*ze+2,Ae.uint16[qe+3]=4*ze+2,Ae.uint16[qe+4]=4*ze+3,Ae.uint16[qe+5]=4*ze+0}return Ae}(H));const ne=v.createIndexBuffer(Us,!0),we=v.createVertexBuffer(ue,c.collisionCircleLayout.members,!0);for(const be of z){const Re={u_matrix:be.transform,u_inv_matrix:be.invTransform,u_camera_to_center_distance:(xe=C).getCameraToCenterDistance(be.projection),u_viewport_size:[xe.width,xe.height]};re.draw(v,b.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,p.colorModeForRenderPass(),c.CullFaceMode.disabled,Re,l.id,we,ne,c.SegmentVector.simpleSegment(0,2*be.circleOffset,be.circleArray.length,be.circleArray.length/2),null,C.zoom)}var xe;we.destroy(),ne.destroy()}const I=c.create();function R({width:p,height:r,anchor:l,textOffset:_,textScale:u},d){const{horizontalAlign:f,verticalAlign:v}=c.getAnchorAlignment(l),b=-(f-.5)*p,C=-(v-.5)*r,S=c.evaluateVariableOffset(l,_);return new c.pointGeometry((b/u+S[0])*d,(C/u+S[1])*d)}function j(p,r,l,_,u,d,f,v,b,C,S){const z=p.text.placedSymbolArray,H=p.text.dynamicLayoutVertexArray,ee=p.icon.dynamicLayoutVertexArray,re={},ue=p.getProjection(),fe=rr(v,ue,d),ne=d.elevation,we=ue.upVectorScale(v.canonical,d.center.lat,d.worldSize).metersToTile;H.clear();for(let xe=0;xe<z.length;xe++){const be=z.get(xe),{tileAnchorX:Re,tileAnchorY:Ae,numGlyphs:ze}=be,Ke=be.hidden||!be.crossTileID||p.allowVerticalPlacement&&!be.placedOrientation?null:_[be.crossTileID];if(Ke){let Qe=0,Ht=0,Ze=0;if(ne){const An=ne?ne.getAtTileOffset(v,Re,Ae):0,[_r,wn,ln]=ue.upVector(v.canonical,Re,Ae);Qe=An*_r*we,Ht=An*wn*we,Ze=An*ln*we}let[bt,ut,Ct,Ye]=$t(be.projectedAnchorX+Qe,be.projectedAnchorY+Ht,be.projectedAnchorZ+Ze,l?fe:f);const He=kn(d.getCameraToCenterDistance(ue),Ye);let rt=u.evaluateSizeForFeature(p.textSizeData,C,be)*He/c.ONE_EM;l&&(rt*=p.tilePixelRatio/b);const St=R(Ke,rt);l?(({x:bt,y:ut,z:Ct}=ue.projectTilePoint(Re+St.x,Ae+St.y,v.canonical)),[bt,ut,Ct]=$t(bt+Qe,ut+Ht,Ct+Ze,f)):(r&&St._rotate(-d.angle),bt+=St.x,ut+=St.y,Ct=0);const Nt=p.allowVerticalPlacement&&be.placedOrientation===c.WritingMode.vertical?Math.PI/2:0;for(let An=0;An<ze;An++)c.addDynamicAttributes(H,bt,ut,Ct,Nt);S&&be.associatedIconIndex>=0&&(re[be.associatedIconIndex]={x:bt,y:ut,z:Ct,angle:Nt})}else dr(ze,H)}if(S){ee.clear();const xe=p.icon.placedSymbolArray;for(let be=0;be<xe.length;be++){const Re=xe.get(be),{numGlyphs:Ae}=Re,ze=re[be];if(Re.hidden||!ze)dr(Ae,ee);else{const{x:qe,y:Ke,z:Qe,angle:Ht}=ze;for(let Ze=0;Ze<Ae;Ze++)c.addDynamicAttributes(ee,qe,Ke,Qe,Ht)}}p.icon.dynamicLayoutVertexBuffer.updateData(ee)}p.text.dynamicLayoutVertexBuffer.updateData(H)}function te(p,r,l){return l.iconsInText&&r?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function me(p,r,l,_,u,d,f,v,b,C,S,z){const H=p.context,ee=H.gl,re=p.transform,ue="map"===v,fe="map"===b,ne=ue&&"point"!==l.layout.get("symbol-placement"),we=ue&&!fe&&!ne,xe=void 0!==l.layout.get("symbol-sort-key").constantOr(1);let be=!1;const Re=p.depthModeForSublayer(0,c.DepthMode.ReadOnly),Ae=[c.mercatorXfromLng(re.center.lng),c.mercatorYfromLat(re.center.lat)],ze=l.layout.get("text-variable-anchor"),qe="globe"===re.projection.name,Ke=[],Qe=[0,-1,0];let Ht=Qe;!qe&&!re.mercatorFromTransition||ue||(Ht=function(Ze){const bt=Ze._camera.getWorldToCamera(Ze.worldSize,1),ut=c.multiply([],bt,Ze.globeMatrix);c.invert(ut,ut);const Ct=[0,0,0],Ye=[0,1,0,0];return c.transformMat4$1(Ye,Ye,ut),Ct[0]=Ye[0],Ct[1]=Ye[1],Ct[2]=Ye[2],c.normalize(Ct,Ct),Ct}(re));for(const Ze of _){const bt=r.getTile(Ze),ut=bt.getBucket(l);if(!ut||"mercator"===ut.projection.name&&qe)continue;const Ct=u?ut.text:ut.icon;if(!Ct||ut.fullyClipped||!Ct.segments.get().length)continue;const Ye=Ct.programConfigurations.get(l.id),He=u||ut.sdfIcons,rt=u?ut.textSizeData:ut.iconSizeData,St=fe||0!==re.pitch,Nt=c.evaluateSizeForZoom(rt,re.zoom);let An,_r,wn,ln,Sn=[0,0],Mr=null;if(u)_r=bt.glyphAtlasTexture,wn=ee.LINEAR,An=bt.glyphAtlasTexture.size,ut.iconsInText&&(Sn=bt.imageAtlasTexture.size,Mr=bt.imageAtlasTexture,ln=St||p.options.rotating||p.options.zooming||"composite"===rt.kind||"camera"===rt.kind?ee.LINEAR:ee.NEAREST);else{const ta=1!==l.layout.get("icon-size").constantOr(0)||ut.iconsNeedLinear;_r=bt.imageAtlasTexture,wn=He||p.options.rotating||p.options.zooming||ta||St?ee.LINEAR:ee.NEAREST,An=bt.imageAtlasTexture.size}const Fn="globe"===ut.projection.name,ei=Fn?Ht:Qe,ci=Fn?c.globeToMercatorTransition(re.zoom):0,bi=rr(Ze,ut.getProjection(),re),Si=re.calculatePixelsToTileUnitsMatrix(bt),To=ar(bi,bt.tileID.canonical,fe,ue,re,ut.getProjection(),Si),ea=p.terrain&&fe&&ne?c.invert(c.create(),To):I,Ea=Ei(bi,bt.tileID.canonical,fe,ue,re,ut.getProjection(),Si),Ul=ze&&ut.hasTextData(),Yi="none"!==l.layout.get("icon-text-fit")&&Ul&&ut.hasIconData();if(ne){const ta=re.elevation,Ta=ta?ta.getAtTileOffsetFunc(Ze,re.center.lat,re.worldSize,ut.getProjection()):null,il=oi(bi,bt.tileID.canonical,fe,ue,re,ut.getProjection(),Si);xo(ut,bi,p,u,il,Ea,fe,C,Ta,Ze)}const ui=ne||u&&ze||Yi,ti=p.translatePosMatrix(bi,bt,d,f),_o=ui?I:To,js=p.translatePosMatrix(Ea,bt,d,f,!0),Gi=ut.getProjection().createInversionMatrix(re,Ze.canonical),Vs=[];p.terrainRenderModeElevated()&&fe&&Vs.push("PITCH_WITH_MAP_TERRAIN"),Fn&&Vs.push("PROJECTION_GLOBE_VIEW"),ui&&Vs.push("PROJECTED_POS_ON_VIEWPORT");const Ss=He&&0!==l.paint.get(u?"text-halo-width":"icon-halo-width").constantOr(1);let xl;xl=He?ut.iconsInText?ma(rt.kind,Nt,we,fe,p,ti,_o,js,An,Sn,Ze,ci,Ae,Gi,ei,ut.getProjection()):Ro(rt.kind,Nt,we,fe,p,ti,_o,js,u,An,!0,Ze,ci,Ae,Gi,ei,ut.getProjection()):Xi(rt.kind,Nt,we,fe,p,ti,_o,js,u,An,Ze,ci,Ae,Gi,ei,ut.getProjection());const jl={program:p.useProgram(te(He,u,ut),Ye,Vs),buffers:Ct,uniformValues:xl,atlasTexture:_r,atlasTextureIcon:Mr,atlasInterpolation:wn,atlasInterpolationIcon:ln,isSDF:He,hasHalo:Ss,tile:bt,labelPlaneMatrixInv:ea};if(xe&&ut.canOverlap){be=!0;const ta=Ct.segments.get();for(const Ta of ta)Ke.push({segments:new c.SegmentVector([Ta]),sortKey:Ta.sortKey,state:jl})}else Ke.push({segments:Ct.segments,sortKey:0,state:jl})}be&&Ke.sort((Ze,bt)=>Ze.sortKey-bt.sortKey);for(const Ze of Ke){const bt=Ze.state;if(p.terrain&&p.terrain.setupElevationDraw(bt.tile,bt.program,{useDepthForOcclusion:!qe,labelPlaneMatrixInv:bt.labelPlaneMatrixInv}),H.activeTexture.set(ee.TEXTURE0),bt.atlasTexture.bind(bt.atlasInterpolation,ee.CLAMP_TO_EDGE),bt.atlasTextureIcon&&(H.activeTexture.set(ee.TEXTURE1),bt.atlasTextureIcon&&bt.atlasTextureIcon.bind(bt.atlasInterpolationIcon,ee.CLAMP_TO_EDGE)),bt.isSDF){const ut=bt.uniformValues;bt.hasHalo&&(ut.u_is_halo=1,Oe(bt.buffers,Ze.segments,l,p,bt.program,Re,S,z,ut)),ut.u_is_halo=0}Oe(bt.buffers,Ze.segments,l,p,bt.program,Re,S,z,bt.uniformValues)}}function Oe(p,r,l,_,u,d,f,v,b){const C=_.context,S=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.globeExtVertexBuffer];u.draw(C,C.gl.TRIANGLES,d,f,v,c.CullFaceMode.disabled,b,l.id,p.layoutVertexBuffer,p.indexBuffer,r,l.paint,_.transform.zoom,p.programConfigurations.get(l.id),S)}function Be(p,r,l,_,u,d,f){const v=p.context.gl,b=l.paint.get("fill-pattern"),C=b&&b.constantOr(1);let S,z,H,ee,re;f?(z=C&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",S=v.LINES):(z=C?"fillPattern":"fill",S=v.TRIANGLES);for(const ue of _){const fe=r.getTile(ue);if(C&&!fe.patternsLoaded())continue;const ne=fe.getBucket(l);if(!ne)continue;p.prepareDrawTile();const we=ne.programConfigurations.get(l.id),xe=p.useProgram(z,we);C&&(p.context.activeTexture.set(v.TEXTURE0),fe.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),we.updatePaintBuffers());const be=b.constantOr(null);if(be&&fe.imageAtlas){const Ae=fe.imageAtlas.patternPositions[be.toString()];Ae&&we.setConstantPatternPositions(Ae)}const Re=p.translatePosMatrix(ue.projMatrix,fe,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(f){ee=ne.indexBuffer2,re=ne.segments2;const Ae=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[v.drawingBufferWidth,v.drawingBufferHeight];H="fillOutlinePattern"===z&&C?ms(Re,p,fe,Ae):Ua(Re,Ae)}else ee=ne.indexBuffer,re=ne.segments,H=C?Ho(Re,p,fe):ps(Re);p.prepareDrawProgram(p.context,xe,ue.toUnwrapped()),xe.draw(p.context,S,u,p.stencilModeForClipping(ue),d,c.CullFaceMode.disabled,H,l.id,ne.layoutVertexBuffer,ee,re,l.paint,p.transform.zoom,we)}}function tt(p,r,l,_,u,d,f){const v=p.context,b=v.gl,C=p.transform,S=l.paint.get("fill-extrusion-pattern"),z=S.constantOr(1),H=l.paint.get("fill-extrusion-opacity"),ee=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),l.paint.get("fill-extrusion-ambient-occlusion-radius")],re=l.layout.get("fill-extrusion-edge-radius"),ue="globe"===C.projection.name?c.fillExtrusionHeightLift():0,fe="globe"===C.projection.name,ne=fe?c.globeToMercatorTransition(C.zoom):0,we=[c.mercatorXfromLng(C.center.lng),c.mercatorYfromLat(C.center.lat)],xe=[];fe&&xe.push("PROJECTION_GLOBE_VIEW"),ee[0]>0&&xe.push("FAUX_AO");for(const be of _){const Re=r.getTile(be),Ae=Re.getBucket(l);if(!Ae||Ae.projection.name!==C.projection.name)continue;const ze=Ae.programConfigurations.get(l.id),qe=p.useProgram(z?"fillExtrusionPattern":"fillExtrusion",ze,xe);if(p.terrain){const Ct=p.terrain;if(p.style.terrainSetForDrapingOnly())Ct.setupElevationDraw(Re,qe,{useMeterToDem:!0});else{if(!Ae.enableTerrain)continue;if(Ct.setupElevationDraw(Re,qe,{useMeterToDem:!0}),vt(v,r,be,Ae,l,Ct),!Ae.centroidVertexBuffer){const Ye=qe.attributes.a_centroid_pos;void 0!==Ye&&b.vertexAttrib2f(Ye,0,0)}}}z&&(p.context.activeTexture.set(b.TEXTURE0),Re.imageAtlasTexture.bind(b.LINEAR,b.CLAMP_TO_EDGE),ze.updatePaintBuffers());const Ke=S.constantOr(null);if(Ke&&Re.imageAtlas){const Ct=Re.imageAtlas.patternPositions[Ke.toString()];Ct&&ze.setConstantPatternPositions(Ct)}const Qe=p.translatePosMatrix(be.projMatrix,Re,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),Ht=C.projection.createInversionMatrix(C,be.canonical),Ze=l.paint.get("fill-extrusion-vertical-gradient"),bt=z?Go(Qe,p,Ze,H,ee,re,be,Re,ue,ne,we,Ht):Ks(Qe,p,Ze,H,ee,re,be,ue,ne,we,Ht);p.prepareDrawProgram(v,qe,be.toUnwrapped());const ut=[];p.terrain&&ut.push(Ae.centroidVertexBuffer),fe&&ut.push(Ae.layoutVertexExtBuffer),qe.draw(v,v.gl.TRIANGLES,u,d,f,c.CullFaceMode.backCCW,bt,l.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,l.paint,p.transform.zoom,ze,ut)}}function vt(p,r,l,_,u,d){const f=[ne=>{let we=ne.canonical.x-1,xe=ne.wrap;return we<0&&(we=(1<<ne.canonical.z)-1,xe--),new c.OverscaledTileID(ne.overscaledZ,xe,ne.canonical.z,we,ne.canonical.y)},ne=>{let we=ne.canonical.x+1,xe=ne.wrap;return we===1<<ne.canonical.z&&(we=0,xe++),new c.OverscaledTileID(ne.overscaledZ,xe,ne.canonical.z,we,ne.canonical.y)},ne=>new c.OverscaledTileID(ne.overscaledZ,ne.wrap,ne.canonical.z,ne.canonical.x,(0===ne.canonical.y?1<<ne.canonical.z:ne.canonical.y)-1),ne=>new c.OverscaledTileID(ne.overscaledZ,ne.wrap,ne.canonical.z,ne.canonical.x,ne.canonical.y===(1<<ne.canonical.z)-1?0:ne.canonical.y+1)],v=ne=>{const we=r.getSource().minzoom,xe=Re=>{const Ae=r.getTileByID(Re);if(Ae&&Ae.hasData())return Ae.getBucket(u)},be=[0,-1,1];for(const Re of be){if(ne.overscaledZ+Re<we)continue;const Ae=xe(ne.calculateScaledKey(ne.overscaledZ+Re));if(Ae)return Ae}},b=[0,0,0],C=(ne,we)=>(b[0]=Math.min(ne.min.y,we.min.y),b[1]=Math.max(ne.max.y,we.max.y),b[2]=c.EXTENT-we.min.x>ne.max.x?we.min.x-c.EXTENT:ne.max.x,b),S=(ne,we)=>(b[0]=Math.min(ne.min.x,we.min.x),b[1]=Math.max(ne.max.x,we.max.x),b[2]=c.EXTENT-we.min.y>ne.max.y?we.min.y-c.EXTENT:ne.max.y,b),z=[(ne,we)=>C(ne,we),(ne,we)=>C(we,ne),(ne,we)=>S(ne,we),(ne,we)=>S(we,ne)],H=new c.pointGeometry(0,0);let ee,re,ue;const fe=(ne,we,xe,be,Re)=>{const Ae=[[be?xe:ne,be?ne:xe,0],[be?xe:we,be?we:xe,0]],ze=Re<0?c.EXTENT+Re:Re,qe=[be?ze:(ne+we)/2,be?(ne+we)/2:ze,0];return 0===xe&&Re<0||0!==xe&&Re>0?d.getForTilePoints(ue,[qe],!0,re):Ae.push(qe),d.getForTilePoints(l,Ae,!0,ee),Math.max(Ae[0][2],Ae[1][2],qe[2])/d.exaggeration()};for(let ne=0;ne<4;ne++){const we=(ne<2?1:5)-ne,xe=_.borders[ne];if(0===xe.length)continue;const be=ue=f[ne](l),Re=v(be);if(!(Re&&Re instanceof c.FillExtrusionBucket&&Re.enableTerrain)||_.borderDoneWithNeighborZ[ne]===Re.canonical.z&&Re.borderDoneWithNeighborZ[we]===_.canonical.z||(re=d.findDEMTileFor(be),!re||!re.dem))continue;if(!ee){const Ke=d.findDEMTileFor(l);if(!Ke||!Ke.dem)return;ee=Ke}const Ae=Re.borders[we];let ze=0;const qe=Re.borderDoneWithNeighborZ[we]!==_.canonical.z;if(_.canonical.z===Re.canonical.z){for(let Ke=0;Ke<xe.length;Ke++){const Qe=_.featuresOnBorder[xe[Ke]],Ht=Qe.borders[ne];let Ze;for(;ze<Ae.length&&(Ze=Re.featuresOnBorder[Ae[ze]],!(Ze.borders[we][1]>Ht[0]+3));)qe&&Re.encodeCentroid(void 0,Ze,!1),ze++;if(Ze&&ze<Ae.length){const bt=ze;let ut=0;for(;!(Ze.borders[we][0]>Ht[1]-3)&&(ut++,++ze!==Ae.length);)Ze=Re.featuresOnBorder[Ae[ze]];if(Ze=Re.featuresOnBorder[Ae[bt]],Qe.intersectsCount()>1||Ze.intersectsCount()>1||1!==ut){1!==ut&&(ze=bt),_.encodeCentroid(void 0,Qe,!1),qe&&Re.encodeCentroid(void 0,Ze,!1);continue}const Ct=z[ne](Qe,Ze),Ye=ne%2?c.EXTENT-1:0;H.x=fe(Ct[0],Math.min(c.EXTENT-1,Ct[1]),Ye,ne<2,Ct[2]),H.y=0,_.encodeCentroid(H,Qe,!1),qe&&Re.encodeCentroid(H,Ze,!1)}else _.encodeCentroid(void 0,Qe,!1)}_.borderDoneWithNeighborZ[ne]=Re.canonical.z,_.needsCentroidUpdate=!0,qe&&(Re.borderDoneWithNeighborZ[we]=_.canonical.z,Re.needsCentroidUpdate=!0)}else{for(const Ke of xe)_.encodeCentroid(void 0,_.featuresOnBorder[Ke],!1);if(qe){for(const Ke of Ae)Re.encodeCentroid(void 0,Re.featuresOnBorder[Ke],!1);Re.borderDoneWithNeighborZ[we]=_.canonical.z,Re.needsCentroidUpdate=!0}_.borderDoneWithNeighborZ[ne]=Re.canonical.z,_.needsCentroidUpdate=!0}}(_.needsCentroidUpdate||!_.centroidVertexBuffer&&0!==_.centroidVertexArray.length)&&_.uploadCentroid(p)}const on=new c.Color(1,0,0,1),gn=new c.Color(0,1,0,1),pr=new c.Color(0,0,1,1),ur=new c.Color(1,0,1,1),jn=new c.Color(0,1,1,1);function Kn(p,r,l){const _=p.context,u=p.transform,d=_.gl,f="globe"===u.projection.name,v=f?["PROJECTION_GLOBE_VIEW"]:null;let b=l.projMatrix;if(f&&c.globeToMercatorTransition(u.zoom)>0){const Qe=c.transitionTileAABBinECEF(l.canonical,u),Ht=c.globeDenormalizeECEF(Qe);b=c.multiply(new Float32Array(16),u.globeMatrix,Ht),c.multiply(b,u.projMatrix,b)}const C=p.useProgram("debug",null,v),S=r.getTileByID(l.key);p.terrain&&p.terrain.setupElevationDraw(S,C);const z=c.DepthMode.disabled,H=c.StencilMode.disabled,ee=p.colorModeForRenderPass();_.activeTexture.set(d.TEXTURE0),p.emptyTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),f?S._makeGlobeTileDebugBuffers(p.context,u):S._makeDebugTileBoundsBuffers(p.context,u.projection);const ue=S._tileDebugBuffer||p.debugBuffer,fe=S._tileDebugIndexBuffer||p.debugIndexBuffer,ne=S._tileDebugSegments||p.debugSegments;C.draw(_,d.LINE_STRIP,z,H,ee,c.CullFaceMode.disabled,Ds(b,c.Color.red),"$debug",ue,fe,ne,null,null,null,[S._globeTileDebugBorderBuffer]);const we=S.latestRawTileData,xe=Math.floor((we&&we.byteLength||0)/1024),be=r.getTile(l).tileSize,Re=512/Math.min(be,512)*(l.overscaledZ/u.zoom)*.5;let Ae=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(Ae+=` => ${l.overscaledZ}`),Ae+=` ${xe}kb`,function(Qe,Ht){Qe.initDebugOverlayCanvas();const Ze=Qe.debugOverlayCanvas,bt=Qe.context.gl,ut=Qe.debugOverlayCanvas.getContext("2d");ut.clearRect(0,0,Ze.width,Ze.height),ut.shadowColor="white",ut.shadowBlur=2,ut.lineWidth=1.5,ut.strokeStyle="white",ut.textBaseline="top",ut.font="bold 36px Open Sans, sans-serif",ut.fillText(Ht,5,5),ut.strokeText(Ht,5,5),Qe.debugOverlayTexture.update(Ze),Qe.debugOverlayTexture.bind(bt.LINEAR,bt.CLAMP_TO_EDGE)}(p,Ae);const ze=S._tileDebugTextBuffer||p.debugBuffer,qe=S._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,Ke=S._tileDebugTextSegments||p.debugSegments;C.draw(_,d.TRIANGLES,z,H,c.ColorMode.alphaBlended,c.CullFaceMode.disabled,Ds(b,c.Color.transparent,Re),"$debug",ze,qe,Ke,null,null,null,[S._globeTileDebugTextBuffer])}function mr(p,r,l,_){gi(p,0,r+l/2,p.transform.width,l,_)}function Tr(p,r,l,_){gi(p,r-l/2,0,l,p.transform.height,_)}function gi(p,r,l,_,u,d){const f=p.context,v=f.gl;v.enable(v.SCISSOR_TEST),v.scissor(r*c.exported.devicePixelRatio,l*c.exported.devicePixelRatio,_*c.exported.devicePixelRatio,u*c.exported.devicePixelRatio),f.clear({color:d}),v.disable(v.SCISSOR_TEST)}const si=c.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:ai}=si;function ho(p,r,l,_){p.emplaceBack(r,l,_)}class eo{constructor(r){this.vertexArray=new c.StructArrayLayout3f12,this.indices=new c.StructArrayLayout3ui6,ho(this.vertexArray,-1,-1,1),ho(this.vertexArray,1,-1,1),ho(this.vertexArray,-1,1,1),ho(this.vertexArray,1,1,1),ho(this.vertexArray,-1,-1,-1),ho(this.vertexArray,1,-1,-1),ho(this.vertexArray,-1,1,-1),ho(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,ai),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=c.SegmentVector.simpleSegment(0,0,36,12)}}function Cn(p,r,l,_,u,d){const f=p.gl,v=r.paint.get("sky-atmosphere-color"),b=r.paint.get("sky-atmosphere-halo-color"),C=r.paint.get("sky-atmosphere-sun-intensity"),S={u_matrix_3f:c.fromMat4(c.create$1(),_),u_sun_direction:u,u_sun_intensity:C,u_color_tint_r:[(re=v).r,re.g,re.b,re.a],u_color_tint_m:[(ue=b).r,ue.g,ue.b,ue.a],u_luminance:5e-5};var re,ue;f.framebufferTexture2D(f.FRAMEBUFFER,f.COLOR_ATTACHMENT0,f.TEXTURE_CUBE_MAP_POSITIVE_X+d,r.skyboxTexture,0),l.draw(p,f.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.frontCW,S,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const to=c.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Gr{constructor(r){const l=new c.StructArrayLayout5f20;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const _=new c.StructArrayLayout3ui6;_.emplaceBack(0,1,2),_.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(l,to.members),this.indexBuffer=r.createIndexBuffer(_),this.segments=c.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const F={symbol:function(p,r,l,_,u){if("translucent"!==p.renderPass)return;const d=c.StencilMode.disabled,f=p.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(v,b,C,S,z,H,ee){const re=b.transform,ue="map"===z,fe="map"===H;for(const ne of v){const we=S.getTile(ne),xe=we.getBucket(C);if(!xe||!xe.text||!xe.text.segments.get().length)continue;const be=c.evaluateSizeForZoom(xe.textSizeData,re.zoom),Re=rr(ne,xe.getProjection(),re),Ae=re.calculatePixelsToTileUnitsMatrix(we),ze=ar(Re,we.tileID.canonical,fe,ue,re,xe.getProjection(),Ae),qe="none"!==C.layout.get("icon-text-fit")&&xe.hasIconData();if(be){const Ke=Math.pow(2,re.zoom-we.tileID.overscaledZ);j(xe,ue,fe,ee,c.symbolSize,re,ze,ne,Ke,be,qe)}}}(_,p,l,r,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),u),0!==l.paint.get("icon-opacity").constantOr(1)&&me(p,r,l,_,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),d,f),0!==l.paint.get("text-opacity").constantOr(1)&&me(p,r,l,_,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),d,f),r.map.showCollisionBoxes&&(Q(p,r,l,_,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),Q(p,r,l,_,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(p,r,l,_){if("translucent"!==p.renderPass)return;const u=l.paint.get("circle-opacity"),d=l.paint.get("circle-stroke-width"),f=l.paint.get("circle-stroke-opacity"),v=void 0!==l.layout.get("circle-sort-key").constantOr(1);if(0===u.constantOr(1)&&(0===d.constantOr(1)||0===f.constantOr(1)))return;const b=p.context,C=b.gl,S=p.transform,z=p.depthModeForSublayer(0,c.DepthMode.ReadOnly),H=c.StencilMode.disabled,ee=p.colorModeForRenderPass(),re="globe"===S.projection.name,ue=[c.mercatorXfromLng(S.center.lng),c.mercatorYfromLat(S.center.lat)],fe=[];for(let we=0;we<_.length;we++){const xe=_[we],be=r.getTile(xe),Re=be.getBucket(l);if(!Re||Re.projection.name!==S.projection.name)continue;const Ae=Re.programConfigurations.get(l.id),ze=ja(l);re&&ze.push("PROJECTION_GLOBE_VIEW");const qe=p.useProgram("circle",Ae,ze),Ke=Re.layoutVertexBuffer,Qe=Re.globeExtVertexBuffer,Ht=Re.indexBuffer,Ze=S.projection.createInversionMatrix(S,xe.canonical),bt={programConfiguration:Ae,program:qe,layoutVertexBuffer:Ke,globeExtVertexBuffer:Qe,indexBuffer:Ht,uniformValues:fa(p,xe,be,Ze,ue,l),tile:be};if(v){const ut=Re.segments.get();for(const Ct of ut)fe.push({segments:new c.SegmentVector([Ct]),sortKey:Ct.sortKey,state:bt})}else fe.push({segments:Re.segments,sortKey:0,state:bt})}v&&fe.sort((we,xe)=>we.sortKey-xe.sortKey);const ne={useDepthForOcclusion:!re};for(const we of fe){const{programConfiguration:xe,program:be,layoutVertexBuffer:Re,globeExtVertexBuffer:Ae,indexBuffer:ze,uniformValues:qe,tile:Ke}=we.state,Qe=we.segments;p.terrain&&p.terrain.setupElevationDraw(Ke,be,ne),p.prepareDrawProgram(b,be,Ke.tileID.toUnwrapped()),be.draw(b,C.TRIANGLES,z,H,ee,c.CullFaceMode.disabled,qe,l.id,Re,ze,Qe,l.paint,S.zoom,xe,[Ae])}},heatmap:function(p,r,l,_){if(0!==l.paint.get("heatmap-opacity"))if("offscreen"===p.renderPass){const u=p.context,d=u.gl,f=c.StencilMode.disabled,v=new c.ColorMode([d.ONE,d.ONE],c.Color.transparent,[!0,!0,!0,!0]);(function(ee,re,ue,fe){const ne=ee.gl,we=re.width*fe,xe=re.height*fe;ee.activeTexture.set(ne.TEXTURE1),ee.viewport.set([0,0,we,xe]);let be=ue.heatmapFbo;if(!be||be&&(be.width!==we||be.height!==xe)){be&&be.destroy();const Re=ne.createTexture();ne.bindTexture(ne.TEXTURE_2D,Re),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_WRAP_S,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_WRAP_T,ne.CLAMP_TO_EDGE),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_MIN_FILTER,ne.LINEAR),ne.texParameteri(ne.TEXTURE_2D,ne.TEXTURE_MAG_FILTER,ne.LINEAR),be=ue.heatmapFbo=ee.createFramebuffer(we,xe,!1),function(Ae,ze,qe,Ke,Qe,Ht){const Ze=Ae.gl;Ze.texImage2D(Ze.TEXTURE_2D,0,Ae.isWebGL2&&Ae.extRenderToTextureHalfFloat?Ze.RGBA16F:Ze.RGBA,Qe,Ht,0,Ze.RGBA,Ae.extRenderToTextureHalfFloat?Ae.isWebGL2?Ze.HALF_FLOAT:Ae.extTextureHalfFloat.HALF_FLOAT_OES:Ze.UNSIGNED_BYTE,null),Ke.colorAttachment.set(qe)}(ee,0,Re,be,we,xe)}else ne.bindTexture(ne.TEXTURE_2D,be.colorAttachment.get()),ee.bindFramebuffer.set(be.framebuffer)})(u,p,l,"globe"===p.transform.projection.name?.5:.25),u.clear({color:c.Color.transparent});const b=p.transform,C="globe"===b.projection.name,S=C?["PROJECTION_GLOBE_VIEW"]:null,z=C?c.CullFaceMode.frontCCW:c.CullFaceMode.disabled,H=[c.mercatorXfromLng(b.center.lng),c.mercatorYfromLat(b.center.lat)];for(let ee=0;ee<_.length;ee++){const re=_[ee];if(r.hasRenderableParent(re))continue;const ue=r.getTile(re),fe=ue.getBucket(l);if(!fe||fe.projection.name!==b.projection.name)continue;const ne=fe.programConfigurations.get(l.id),we=p.useProgram("heatmap",ne,S),{zoom:xe}=p.transform;p.terrain&&p.terrain.setupElevationDraw(ue,we),p.prepareDrawProgram(u,we,re.toUnwrapped());const be=b.projection.createInversionMatrix(b,re.canonical);we.draw(u,d.TRIANGLES,c.DepthMode.disabled,f,v,z,Po(p,re,ue,be,H,xe,l.paint.get("heatmap-intensity")),l.id,fe.layoutVertexBuffer,fe.indexBuffer,fe.segments,l.paint,p.transform.zoom,ne,C?[fe.globeExtVertexBuffer]:null)}u.viewport.set([0,0,p.width,p.height])}else"translucent"===p.renderPass&&(p.context.setColorMode(p.colorModeForRenderPass()),function(u,d){const f=u.context,v=f.gl,b=d.heatmapFbo;if(!b)return;f.activeTexture.set(v.TEXTURE0),v.bindTexture(v.TEXTURE_2D,b.colorAttachment.get()),f.activeTexture.set(v.TEXTURE1);let C=d.colorRampTexture;C||(C=d.colorRampTexture=new c.Texture(f,d.colorRamp,v.RGBA)),C.bind(v.LINEAR,v.CLAMP_TO_EDGE),u.useProgram("heatmapTexture").draw(f,v.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,u.colorModeForRenderPass(),c.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:d.paint.get("heatmap-opacity")},d.id,u.viewportBuffer,u.quadTriangleIndexBuffer,u.viewportSegments,d.paint,u.transform.zoom)}(p,l))},line:function(p,r,l,_){if("translucent"!==p.renderPass)return;const u=l.paint.get("line-opacity"),d=l.paint.get("line-width");if(0===u.constantOr(1)||0===d.constantOr(1))return;const f=p.depthModeForSublayer(0,c.DepthMode.ReadOnly),v=p.colorModeForRenderPass(),b=p.terrain&&p.terrain.renderingToTexture?1:c.exported.devicePixelRatio,C=l.paint.get("line-dasharray"),S=C.constantOr(1),z=l.layout.get("line-cap"),H=l.paint.get("line-pattern"),ee=H.constantOr(1),re=l.paint.get("line-gradient"),ue=ee?"linePattern":"line",fe=p.context,ne=fe.gl,we=(be=>{const Re=[];Aa(be)&&Re.push("RENDER_LINE_DASH"),be.paint.get("line-gradient")&&Re.push("RENDER_LINE_GRADIENT");const Ae=be.paint.get("line-trim-offset");0===Ae[0]&&0===Ae[1]||Re.push("RENDER_LINE_TRIM_OFFSET");const ze=be.paint.get("line-pattern").constantOr(1),qe=1!==be.paint.get("line-opacity").constantOr(1);return!ze&&qe&&Re.push("RENDER_LINE_ALPHA_DISCARD"),Re})(l);let xe=we.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(xe=!1);for(const be of _){const Re=r.getTile(be);if(ee&&!Re.patternsLoaded())continue;const Ae=Re.getBucket(l);if(!Ae)continue;p.prepareDrawTile();const ze=Ae.programConfigurations.get(l.id),qe=p.useProgram(ue,ze,we),Ke=H.constantOr(null);if(Ke&&Re.imageAtlas){const He=Re.imageAtlas.patternPositions[Ke.toString()];He&&ze.setConstantPatternPositions(He)}const Qe=C.constantOr(null),Ht=z.constantOr(null);if(!ee&&Qe&&Ht&&Re.lineAtlas){const He=Re.lineAtlas.getDash(Qe,Ht);He&&ze.setConstantPatternPositions(He)}let[Ze,bt]=l.paint.get("line-trim-offset");("round"===Ht||"square"===Ht)&&Ze!==bt&&(0===Ze&&(Ze-=1),1===bt&&(bt+=1));const ut=p.terrain?be.projMatrix:null,Ct=ee?Qa(p,Re,l,ut,b):Ia(p,Re,l,ut,Ae.lineClipsArray.length,b,[Ze,bt]);if(re){const He=Ae.gradients[l.id];let rt=He.texture;if(l.gradientVersion!==He.version){let St=256;if(l.stepInterpolant){const Nt=r.getSource().maxzoom,An=be.canonical.z===Nt?Math.ceil(1<<p.transform.maxZoom-be.canonical.z):1;St=c.clamp(c.nextPowerOfTwo(Ae.maxLineLength/c.EXTENT*1024*An),256,fe.maxTextureSize)}He.gradient=c.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:St,image:He.gradient||void 0,clips:Ae.lineClipsArray}),He.texture?He.texture.update(He.gradient):He.texture=new c.Texture(fe,He.gradient,ne.RGBA),He.version=l.gradientVersion,rt=He.texture}fe.activeTexture.set(ne.TEXTURE1),rt.bind(l.stepInterpolant?ne.NEAREST:ne.LINEAR,ne.CLAMP_TO_EDGE)}S&&(fe.activeTexture.set(ne.TEXTURE0),Re.lineAtlasTexture.bind(ne.LINEAR,ne.REPEAT),ze.updatePaintBuffers()),ee&&(fe.activeTexture.set(ne.TEXTURE0),Re.imageAtlasTexture.bind(ne.LINEAR,ne.CLAMP_TO_EDGE),ze.updatePaintBuffers()),p.prepareDrawProgram(fe,qe,be.toUnwrapped());const Ye=He=>{qe.draw(fe,ne.TRIANGLES,f,He,v,c.CullFaceMode.disabled,Ct,l.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,l.paint,p.transform.zoom,ze,[Ae.layoutVertexBuffer2])};if(xe){const He=p.stencilModeForClipping(be).ref;0===He&&p.terrain&&fe.clear({stencil:0});const rt={func:ne.EQUAL,mask:255};Ct.u_alpha_discard_threshold=.8,Ye(new c.StencilMode(rt,He,255,ne.KEEP,ne.KEEP,ne.INVERT)),Ct.u_alpha_discard_threshold=0,Ye(new c.StencilMode(rt,He,255,ne.KEEP,ne.KEEP,ne.KEEP))}else Ye(p.stencilModeForClipping(be))}xe&&(p.resetStencilClippingMasks(),p.terrain&&fe.clear({stencil:0}))},fill:function(p,r,l,_){const u=l.paint.get("fill-color"),d=l.paint.get("fill-opacity");if(0===d.constantOr(1))return;const f=p.colorModeForRenderPass(),v=l.paint.get("fill-pattern"),b=p.opaquePassEnabledForLayer()&&!v.constantOr(1)&&1===u.constantOr(c.Color.transparent).a&&1===d.constantOr(0)?"opaque":"translucent";if(p.renderPass===b){const C=p.depthModeForSublayer(1,"opaque"===p.renderPass?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly);Be(p,r,l,_,C,f,!1)}if("translucent"===p.renderPass&&l.paint.get("fill-antialias")){const C=p.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,c.DepthMode.ReadOnly);Be(p,r,l,_,C,f,!0)}},"fill-extrusion":function(p,r,l,_){const u=l.paint.get("fill-extrusion-opacity");if(0!==u&&"translucent"===p.renderPass){const d=new c.DepthMode(p.context.gl.LEQUAL,c.DepthMode.ReadWrite,p.depthRangeFor3D);if(1!==u||l.paint.get("fill-extrusion-pattern").constantOr(1))tt(p,r,l,_,d,c.StencilMode.disabled,c.ColorMode.disabled),tt(p,r,l,_,d,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const f=p.colorModeForRenderPass();tt(p,r,l,_,d,c.StencilMode.disabled,f)}}},hillshade:function(p,r,l,_){if("offscreen"!==p.renderPass&&"translucent"!==p.renderPass)return;const u=p.context,d=p.depthModeForSublayer(0,c.DepthMode.ReadOnly),f=p.colorModeForRenderPass(),v=p.terrain&&p.terrain.renderingToTexture,[b,C]="translucent"!==p.renderPass||v?[{},_]:p.stencilConfigForOverlap(_);for(const S of C){const z=r.getTile(S);if(z.needsHillshadePrepare&&"offscreen"===p.renderPass)Vi(p,z,l,d,c.StencilMode.disabled,f);else if("translucent"===p.renderPass){const H=v&&p.terrain?p.terrain.stencilModeForRTTOverlap(S):b[S.overscaledZ];Io(p,S,z,l,d,H,f)}}u.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,r,l,_,u,d){if("translucent"!==p.renderPass||0===l.paint.get("raster-opacity")||!_.length)return;const f=p.context,v=f.gl,b=r.getSource(),C=p.useProgram("raster"),S=p.colorModeForRenderPass(),z=p.terrain&&p.terrain.renderingToTexture,[H,ee]=b instanceof ie||z?[{},_]:p.stencilConfigForOverlap(_),re=ee[ee.length-1].overscaledZ,ue=!p.options.moving;for(const fe of ee){const ne=z?c.DepthMode.disabled:p.depthModeForSublayer(fe.overscaledZ-re,1===l.paint.get("raster-opacity")?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly,v.LESS),we=fe.toUnwrapped(),xe=r.getTile(fe);if(z&&(!xe||!xe.hasData()))continue;const be=z?fe.projMatrix:p.transform.calculateProjMatrix(we,ue),Re=p.terrain&&z?p.terrain.stencilModeForRTTOverlap(fe):H[fe.overscaledZ],Ae=d?0:l.paint.get("raster-fade-duration");xe.registerFadeDuration(Ae);const ze=r.findLoadedParent(fe,0),qe=ri(xe,ze,r,p.transform,Ae);let Ke,Qe;p.terrain&&p.terrain.prepareDrawTile();const Ht="nearest"===l.paint.get("raster-resampling")?v.NEAREST:v.LINEAR;f.activeTexture.set(v.TEXTURE0),xe.texture.bind(Ht,v.CLAMP_TO_EDGE),f.activeTexture.set(v.TEXTURE1),ze?(ze.texture.bind(Ht,v.CLAMP_TO_EDGE),Ke=Math.pow(2,ze.tileID.overscaledZ-xe.tileID.overscaledZ),Qe=[xe.tileID.canonical.x*Ke%1,xe.tileID.canonical.y*Ke%1]):xe.texture.bind(Ht,v.CLAMP_TO_EDGE),xe.texture.useMipmap&&f.extTextureFilterAnisotropic&&p.transform.pitch>20&&v.texParameterf(v.TEXTURE_2D,f.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,f.extTextureFilterAnisotropicMax);const Ze=el(be,Qe||[0,0],Ke||1,qe,l,b instanceof ie?b.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(f,C,we),b instanceof ie)b.boundsBuffer&&b.boundsSegments&&C.draw(f,v.TRIANGLES,ne,c.StencilMode.disabled,S,c.CullFaceMode.disabled,Ze,l.id,b.boundsBuffer,p.quadTriangleIndexBuffer,b.boundsSegments);else{const{tileBoundsBuffer:bt,tileBoundsIndexBuffer:ut,tileBoundsSegments:Ct}=p.getTileBoundsBuffers(xe);C.draw(f,v.TRIANGLES,ne,Re,S,c.CullFaceMode.disabled,Ze,l.id,bt,ut,Ct)}}p.resetStencilClippingMasks()},background:function(p,r,l,_){const u=l.paint.get("background-color"),d=l.paint.get("background-opacity");if(0===d)return;const f=p.context,v=f.gl,b=p.transform,C=b.tileSize,S=l.paint.get("background-pattern");if(p.isPatternMissing(S))return;const z=!S&&1===u.a&&1===d&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==z)return;const H=c.StencilMode.disabled,ee=p.depthModeForSublayer(0,"opaque"===z?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly),re=p.colorModeForRenderPass(),ue=p.useProgram(S?"backgroundPattern":"background");let fe,ne=_;ne||(fe=p.getBackgroundTiles(),ne=Object.values(fe).map(we=>we.tileID)),S&&(f.activeTexture.set(v.TEXTURE0),p.imageManager.bind(p.context));for(const we of ne){const xe=we.toUnwrapped(),be=_?we.projMatrix:p.transform.calculateProjMatrix(xe);p.prepareDrawTile();const Re=r?r.getTile(we):fe?fe[we.key]:new c.Tile(we,C,b.zoom,p),Ae=S?Ys(be,d,p,S,{tileID:we,tileSize:C}):ga(be,d,u);p.prepareDrawProgram(f,ue,xe);const{tileBoundsBuffer:ze,tileBoundsIndexBuffer:qe,tileBoundsSegments:Ke}=p.getTileBoundsBuffers(Re);ue.draw(f,v.TRIANGLES,ee,H,re,c.CullFaceMode.disabled,Ae,l.id,ze,qe,Ke)}},sky:function(p,r,l){const _=p.transform,u="mercator"===_.projection.name||"globe"===_.projection.name?1:c.smoothstep(7,8,_.zoom),d=l.paint.get("sky-opacity")*u;if(0===d)return;const f=p.context,v=l.paint.get("sky-type"),b=new c.DepthMode(f.gl.LEQUAL,c.DepthMode.ReadOnly,[0,1]),C=p.frameCounter/1e3%1;"atmosphere"===v?"offscreen"===p.renderPass?l.needsSkyboxCapture(p)&&(function(S,z,H,ee){const re=S.context,ue=re.gl;let fe=z.skyboxFbo;if(!fe){fe=z.skyboxFbo=re.createFramebuffer(32,32,!1),z.skyboxGeometry=new eo(re),z.skyboxTexture=re.gl.createTexture(),ue.bindTexture(ue.TEXTURE_CUBE_MAP,z.skyboxTexture),ue.texParameteri(ue.TEXTURE_CUBE_MAP,ue.TEXTURE_WRAP_S,ue.CLAMP_TO_EDGE),ue.texParameteri(ue.TEXTURE_CUBE_MAP,ue.TEXTURE_WRAP_T,ue.CLAMP_TO_EDGE),ue.texParameteri(ue.TEXTURE_CUBE_MAP,ue.TEXTURE_MIN_FILTER,ue.LINEAR),ue.texParameteri(ue.TEXTURE_CUBE_MAP,ue.TEXTURE_MAG_FILTER,ue.LINEAR);for(let be=0;be<6;++be)ue.texImage2D(ue.TEXTURE_CUBE_MAP_POSITIVE_X+be,0,ue.RGBA,32,32,0,ue.RGBA,ue.UNSIGNED_BYTE,null)}re.bindFramebuffer.set(fe.framebuffer),re.viewport.set([0,0,32,32]);const ne=z.getCenter(S,!0),we=S.useProgram("skyboxCapture"),xe=new Float64Array(16);c.identity(xe),c.rotateY(xe,xe,.5*-Math.PI),Cn(re,z,we,xe,ne,0),c.identity(xe),c.rotateY(xe,xe,.5*Math.PI),Cn(re,z,we,xe,ne,1),c.identity(xe),c.rotateX(xe,xe,.5*-Math.PI),Cn(re,z,we,xe,ne,2),c.identity(xe),c.rotateX(xe,xe,.5*Math.PI),Cn(re,z,we,xe,ne,3),c.identity(xe),Cn(re,z,we,xe,ne,4),c.identity(xe),c.rotateY(xe,xe,Math.PI),Cn(re,z,we,xe,ne,5),re.viewport.set([0,0,S.width,S.height])}(p,l),l.markSkyboxValid(p)):"sky"===p.renderPass&&function(S,z,H,ee,re){const ue=S.context,fe=ue.gl,ne=S.transform,we=S.useProgram("skybox");ue.activeTexture.set(fe.TEXTURE0),fe.bindTexture(fe.TEXTURE_CUBE_MAP,z.skyboxTexture);const xe={u_matrix:ne.skyboxMatrix,u_sun_direction:z.getCenter(S,!1),u_cubemap:0,u_opacity:ee,u_temporal_offset:re};S.prepareDrawProgram(ue,we),we.draw(ue,fe.TRIANGLES,H,c.StencilMode.disabled,S.colorModeForRenderPass(),c.CullFaceMode.backCW,xe,"skybox",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(p,l,b,d,C):"gradient"===v&&"sky"===p.renderPass&&function(S,z,H,ee,re){const ue=S.context,fe=ue.gl,ne=S.transform,we=S.useProgram("skyboxGradient");z.skyboxGeometry||(z.skyboxGeometry=new eo(ue)),ue.activeTexture.set(fe.TEXTURE0);let xe=z.colorRampTexture;xe||(xe=z.colorRampTexture=new c.Texture(ue,z.colorRamp,fe.RGBA)),xe.bind(fe.LINEAR,fe.CLAMP_TO_EDGE);const be=(Re=ne.skyboxMatrix,Ae=z.getCenter(S,!1),ze=z.paint.get("sky-gradient-radius"),qe=ee,Ke=re,{u_matrix:Re,u_color_ramp:0,u_center_direction:Ae,u_radius:c.degToRad(ze),u_opacity:qe,u_temporal_offset:Ke});var Re,Ae,ze,qe,Ke;S.prepareDrawProgram(ue,we),we.draw(ue,fe.TRIANGLES,H,c.StencilMode.disabled,S.colorModeForRenderPass(),c.CullFaceMode.backCW,be,"skyboxGradient",z.skyboxGeometry.vertexBuffer,z.skyboxGeometry.indexBuffer,z.skyboxGeometry.segment)}(p,l,b,d,C)},debug:function(p,r,l){for(let _=0;_<l.length;_++)Kn(p,r,l[_])},custom:function(p,r,l,_){const u=p.context,d=l.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||"offscreen"===p.renderPass)&&l.isLayerDraped()){if("offscreen"===p.renderPass){const f=d.prerender;if(f){if(p.setCustomLayerDefaults(),u.setColorMode(p.colorModeForRenderPass()),"globe"===p.transform.projection.name){const v=p.transform.pointMerc;f.call(d,u.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),c.globeToMercatorTransition(p.transform.zoom),[v.x,v.y],p.transform.pixelsPerMeterRatio)}else f.call(d,u.gl,p.transform.customLayerMatrix());u.setDirty(),p.setBaseState()}}else if("translucent"===p.renderPass){if(p.terrain&&p.terrain.renderingToTexture){const v=d.renderToTile;if(v){const b=_[0].canonical,C=new c.MercatorCoordinate(b.x+_[0].wrap*(1<<b.z),b.y,b.z);u.setDepthMode(c.DepthMode.disabled),u.setStencilMode(c.StencilMode.disabled),u.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),v.call(d,u.gl,C),u.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),u.setColorMode(p.colorModeForRenderPass()),u.setStencilMode(c.StencilMode.disabled);const f="3d"===d.renderingMode?new c.DepthMode(p.context.gl.LEQUAL,c.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,c.DepthMode.ReadOnly);if(u.setDepthMode(f),"globe"===p.transform.projection.name){const v=p.transform.pointMerc;d.render(u.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),c.globeToMercatorTransition(p.transform.zoom),[v.x,v.y],p.transform.pixelsPerMeterRatio)}else d.render(u.gl,p.transform.customLayerMatrix());u.setDirty(),p.setBaseState(),u.bindFramebuffer.set(null)}}else c.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class K{constructor(r,l,_=!1){this.context=new ce(r,_),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=c.SourceCache.maxUnderzooming+c.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Rs,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,l){const _=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(_||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new $i(this,r));const u=this._terrain;this.transform.elevation=_?u:null,u.update(r,this.transform,l)}_updateFog(r){const l=r.fog;if(!l||"globe"===this.transform.projection.name||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[_,u]=l.getFovAdjustedRange(this.transform._fov);if(_>u)return void(this.transform.fogCullDistSq=null);const d=_+.78*(u-_);this.transform.fogCullDistSq=d*d}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,l){if(this.width=r*c.exported.devicePixelRatio,this.height=l*c.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const _ of this.style.order)this.style._layers[_].resize()}setup(){const r=this.context,l=new c.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(c.EXTENT,0),l.emplaceBack(0,c.EXTENT),l.emplaceBack(c.EXTENT,c.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(l,c.posAttributes.members),this.tileExtentSegments=c.SegmentVector.simpleSegment(0,0,4,2);const _=new c.StructArrayLayout2i4;_.emplaceBack(0,0),_.emplaceBack(c.EXTENT,0),_.emplaceBack(0,c.EXTENT),_.emplaceBack(c.EXTENT,c.EXTENT),this.debugBuffer=r.createVertexBuffer(_,c.posAttributes.members),this.debugSegments=c.SegmentVector.simpleSegment(0,0,4,5);const u=new c.StructArrayLayout2i4;u.emplaceBack(-1,-1),u.emplaceBack(1,-1),u.emplaceBack(-1,1),u.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(u,c.posAttributes.members),this.viewportSegments=c.SegmentVector.simpleSegment(0,0,4,2);const d=new c.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(c.EXTENT,0,c.EXTENT,0),d.emplaceBack(0,c.EXTENT,0,c.EXTENT),d.emplaceBack(c.EXTENT,c.EXTENT,c.EXTENT,c.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(d,c.boundsAttributes.members),this.mercatorBoundsSegments=c.SegmentVector.simpleSegment(0,0,4,2);const f=new c.StructArrayLayout3ui6;f.emplaceBack(0,1,2),f.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(f);const v=new c.StructArrayLayout1ui2;for(const C of[0,1,3,2,0])v.emplaceBack(C);this.debugIndexBuffer=r.createIndexBuffer(v),this.emptyTexture=new c.Texture(r,new c.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=c.create();const b=this.context.gl;this.stencilClearMode=new c.StencilMode({func:b.ALWAYS,mask:0},0,255,b.ZERO,b.ZERO,b.ZERO),this.loadTimeStamps.push(c.window.performance.now()),this.atmosphereBuffer=new Gr(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,l=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,l.TRIANGLES,c.DepthMode.disabled,this.stencilClearMode,c.ColorMode.disabled,c.CullFaceMode.disabled,fr(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,l,_){if(!l||this.currentStencilSource===l.id||!r.isTileClipped()||!_||0===_.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let v=!1;for(const b of _)if(void 0===this._tileClippingMaskIDs[b.key]){v=!0;break}if(!v)return}this.currentStencilSource=l.id;const u=this.context,d=u.gl;this.nextStencilID+_.length>256&&this.clearStencil(),u.setColorMode(c.ColorMode.disabled),u.setDepthMode(c.DepthMode.disabled);const f=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const v of _){const b=l.getTile(v),C=this._tileClippingMaskIDs[v.key]=this.nextStencilID++,{tileBoundsBuffer:S,tileBoundsIndexBuffer:z,tileBoundsSegments:H}=this.getTileBoundsBuffers(b);f.draw(u,d.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:d.ALWAYS,mask:0},C,255,d.KEEP,d.KEEP,d.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,fr(v.projMatrix),"$clipping",S,z,H)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,l=this.context.gl;return new c.StencilMode({func:l.NOTEQUAL,mask:255},r,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const l=this.context.gl;return new c.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(r){const l=this.context.gl,_=r.sort((f,v)=>v.overscaledZ-f.overscaledZ),u=_[_.length-1].overscaledZ,d=_[0].overscaledZ-u+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const f={};for(let v=0;v<d;v++)f[v+u]=new c.StencilMode({func:l.GEQUAL,mask:255},v+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=d,[f,_]}return[{[u]:c.StencilMode.disabled},_]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new c.ColorMode([r.CONSTANT_COLOR,r.ONE],new c.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?c.ColorMode.unblended:c.ColorMode.alphaBlended}depthModeForSublayer(r,l,_){if(!this.opaquePassEnabledForLayer())return c.DepthMode.disabled;const u=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new c.DepthMode(_||this.context.gl.LEQUAL,l,[u,u])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,l){this.style=r,this.options=l,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(c.exported.now()),this.imageManager.beginFrame();const _=this.style.order,u=this.style._sourceCaches;for(const C in u){const S=u[C];S.used&&S.prepare(this.context)}const d={},f={},v={};for(const C in u){const S=u[C];d[C]=S.getVisibleCoordinates(),f[C]=d[C].slice().reverse(),v[C]=S.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let C=0;C<_.length;C++)if(this.style._layers[_[C]].is3D()){this.opaquePassCutoff=C;break}if(this.terrain&&(this.terrain.updateTileBinding(v),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new c.GlobeSharedBuffers(this.context)),!c.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const C of _){const S=this.style._layers[C],z=r._getLayerSourceCache(S);if(!S.hasOffscreenPass()||S.isHidden(this.transform.zoom))continue;const H=z?f[z.id]:void 0;("custom"===S.type||S.isSky()||H&&H.length)&&this.renderLayer(this,z,S,H)}this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon];const b=this.terrain;if(b&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&b.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:l.showOverdrawInspector?c.Color.black:c.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=_.length-1;this.currentLayer>=0;this.currentLayer--){const C=this.style._layers[_[this.currentLayer]],S=r._getLayerSourceCache(C);if(C.isSky())continue;const z=S?f[S.id]:void 0;this._renderTileClippingMasks(C,S,z),this.renderLayer(this,S,C,z)}if(this.style.fog&&this.transform.projection.supportsFog&&function(C,S){const z=C.context,H=z.gl,ee=C.transform,re=new c.DepthMode(H.LEQUAL,c.DepthMode.ReadOnly,[0,1]),ue=C.useProgram("globeAtmosphere",null,"globe"===ee.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),fe=c.globeToMercatorTransition(ee.zoom),ne=S.properties.get("color").toArray01(),we=S.properties.get("high-color").toArray01(),xe=S.properties.get("space-color").toArray01PremultipliedAlpha(),be=c.identity$1([]);c.rotateY$1(be,be,-c.degToRad(ee._center.lng)),c.rotateX$1(be,be,c.degToRad(ee._center.lat)),c.rotateZ$1(be,be,ee.angle),c.rotateX$1(be,be,-ee._pitch);const Re=c.fromQuat(new Float32Array(16),be),Ae=c.mapValue(S.properties.get("star-intensity"),0,1,0,.25),qe=c.mapValue(S.properties.get("horizon-blend"),0,1,5e-4,.25),Ke=c.globeUseCustomAntiAliasing(C,z,ee)&&5e-4===qe?ee.worldSize/(2*Math.PI*1.025)-1:ee.globeRadius,Qe=C.frameCounter/1e3%1,Ht=c.length(ee.globeCenterInViewSpace),Ze=Math.sqrt(Math.pow(Ht,2)-Math.pow(Ke,2)),bt=Math.acos(Ze/Ht),ut={u_frustum_tl:ee.frustumCorners.TL,u_frustum_tr:ee.frustumCorners.TR,u_frustum_br:ee.frustumCorners.BR,u_frustum_bl:ee.frustumCorners.BL,u_horizon:ee.frustumCorners.horizon,u_transition:fe,u_fadeout_range:qe,u_color:ne,u_high_color:we,u_space_color:xe,u_star_intensity:Ae,u_star_size:5*c.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Qe,u_horizon_angle:bt,u_rotation_matrix:Re};C.prepareDrawProgram(z,ue);const Ct=C.atmosphereBuffer;Ct&&ue.draw(z,H.TRIANGLES,re,c.StencilMode.disabled,c.ColorMode.alphaBlended,c.CullFaceMode.backCW,ut,"skybox",Ct.vertexBuffer,Ct.indexBuffer,Ct.segments)}(this,this.style.fog),this.renderPass="sky",(c.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<_.length;this.currentLayer++){const C=this.style._layers[_[this.currentLayer]],S=r._getLayerSourceCache(C);C.isSky()&&this.renderLayer(this,S,C,S?f[S.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<_.length;){const C=this.style._layers[_[this.currentLayer]],S=r._getLayerSourceCache(C);if(C.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(C)){if(C.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const z=S?("symbol"===C.type?v:f)[S.id]:void 0;this._renderTileClippingMasks(C,S,S?d[S.id]:void 0),this.renderLayer(this,S,C,z),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let C=null;c.values(this.style._layers).forEach(S=>{const z=r._getLayerSourceCache(S);z&&!S.isHidden(this.transform.zoom)&&(!C||C.getSource().maxzoom<z.getSource().maxzoom)&&(C=z)}),C&&this.options.showTileBoundaries&&F.debug(this,C,C.getVisibleCoordinates())}this.options.showPadding&&function(C){const S=C.transform.padding;mr(C,C.transform.height-(S.top||0),3,on),mr(C,S.bottom||0,3,gn),Tr(C,S.left||0,3,pr),Tr(C,C.transform.width-(S.right||0),3,ur);const z=C.transform.centerPoint;var H,ee,re,ue;gi(H=C,(ee=z.x)-1,(re=C.transform.height-z.y)-10,2,20,ue=jn),gi(H,ee-10,re-1,20,2,ue)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(c.window.performance.now()),this.saveCanvasCopy())}renderLayer(r,l,_,u){_.isHidden(this.transform.zoom)||("background"===_.type||"sky"===_.type||"custom"===_.type||u&&u.length)&&(this.id=_.id,this.gpuTimingStart(_),(!r.transform.projection.unsupportedLayers||!r.transform.projection.unsupportedLayers.includes(_.type)||r.terrain&&"custom"===_.type)&&F[_.type](r,l,_,u,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let _=this.gpuTimers[r.id];_||(_=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),_.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,_.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,l=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(l),r.beginQueryEXT(r.TIME_ELAPSED_EXT,l)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const l={};for(const _ in r){const u=r[_],d=this.context.extTimerQuery,f=d.getQueryObjectEXT(u.query,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(u.query),l[_]=f}return l}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery;let _=0;for(const u of r)_+=l.getQueryObjectEXT(u,l.QUERY_RESULT_EXT)/1e6,l.deleteQueryEXT(u);return _}translatePosMatrix(r,l,_,u,d){if(!_[0]&&!_[1])return r;const f=d?"map"===u?this.transform.angle:0:"viewport"===u?-this.transform.angle:0;if(f){const C=Math.sin(f),S=Math.cos(f);_=[_[0]*S-_[1]*C,_[0]*C+_[1]*S]}const v=[d?_[0]:Dt(l,_[0],this.transform.zoom),d?_[1]:Dt(l,_[1],this.transform.zoom),0],b=new Float32Array(16);return c.translate(b,r,v),b}saveTileTexture(r){const l=this._tileTextures[r.size[0]];l?l.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const l=this._tileTextures[r];return l&&l.length>0?l.pop():null}isPatternMissing(r){return null===r||void 0!==r&&!this.imageManager.getPattern(r.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,l=this.terrain&&0===this.terrain.exaggeration(),_=this.style&&this.style.fog,u=[];return this.terrainRenderModeElevated()&&u.push("TERRAIN"),"globe"===this.transform.projection.name&&u.push("GLOBE"),l&&u.push("ZERO_EXAGGERATION"),_&&!r&&0!==_.getOpacity(this.transform.pitch)&&u.push("FOG"),r&&u.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&u.push("OVERDRAW_INSPECTOR"),u}useProgram(r,l,_){this.cache=this.cache||{};const u=_||[],d=this.currentGlobalDefines().concat(u),f=da.cacheKey(Fs[r],r,d,l);return this.cache[f]||(this.cache[f]=new da(this.context,r,Fs[r],l,oc[r],d)),this.cache[f]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=c.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,l,_){if(this.terrain&&this.terrain.renderingToTexture)return;const u=this.style.fog;if(u){const d=u.getOpacity(this.transform.pitch),f=((v,b,C,S,z,H,ee,re,ue,fe,ne)=>{const we=v.transform,xe=b.properties.get("color").toArray01();xe[3]=S;const be=v.frameCounter/1e3%1;return{u_fog_matrix:C?we.calculateFogTileMatrix(C):v.identityMat,u_fog_range:b.getFovAdjustedRange(we._fov),u_fog_color:xe,u_fog_horizon_blend:b.properties.get("horizon-blend"),u_fog_temporal_offset:be,u_frustum_tl:z,u_frustum_tr:H,u_frustum_br:ee,u_frustum_bl:re,u_globe_pos:ue,u_globe_radius:fe,u_viewport:ne,u_globe_transition:c.globeToMercatorTransition(we.zoom),u_is_globe:+("globe"===we.projection.name)}})(this,u,_,d,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*c.exported.devicePixelRatio,this.transform.height*c.exported.devicePixelRatio]);l.setFogUniformValues(r,f)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,l=r.createTexture();return r.bindTexture(r.TEXTURE_2D,l),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&0!==r.getOpacity(this.transform.pitch)}getBackgroundTiles(){const r=this._backgroundTiles,l=this._backgroundTiles={},_=this.transform.coveringTiles({tileSize:512});for(const u of _)l[u.key]=r[u.key]||new c.Tile(u,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class U{constructor(r=0,l=0,_=0,u=0){if(isNaN(r)||r<0||isNaN(l)||l<0||isNaN(_)||_<0||isNaN(u)||u<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=l,this.left=_,this.right=u}interpolate(r,l,_){return null!=l.top&&null!=r.top&&(this.top=c.number(r.top,l.top,_)),null!=l.bottom&&null!=r.bottom&&(this.bottom=c.number(r.bottom,l.bottom,_)),null!=l.left&&null!=r.left&&(this.left=c.number(r.left,l.left,_)),null!=l.right&&null!=r.right&&(this.right=c.number(r.right,l.right,_)),this}getCenter(r,l){const _=c.clamp((this.left+r-this.right)/2,0,r),u=c.clamp((this.top+l-this.bottom)/2,0,l);return new c.pointGeometry(_,u)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new U(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function ae(p,r){const l=c.getColumn(p,3);c.fromQuat(p,r),c.setColumn(p,3,l)}function Se(p,r){const l=c.identity$1([]);return c.rotateZ$1(l,l,-r),c.rotateX$1(l,l,-p),l}function A(p,r){const l=[p[0],p[1],0],_=[r[0],r[1],0];if(c.length(l)>=1e-15){const f=c.normalize([],l);c.scale$2(_,f,c.dot(_,f)),r[0]=_[0],r[1]=_[1]}const u=c.cross([],r,p);if(c.len(u)<1e-15)return null;const d=Math.atan2(-u[1],u[0]);return Se(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),d)}class P{constructor(r,l){this.position=r,this.orientation=l}get position(){return this._position}set position(r){if(r){const l=r instanceof c.MercatorCoordinate?r:new c.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(l.x=c.wrap(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(r,l){if(this.orientation=null,!this.position)return;const _=this.position,u=this._elevation?this._elevation.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(r)):0,d=c.MercatorCoordinate.fromLngLat(r,u),f=[d.x-_.x,d.y-_.y,d.z-_.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=A(f,l)}setPitchBearing(r,l){this.orientation=Se(c.degToRad(r),c.degToRad(-l))}}class ${constructor(r,l){this._transform=c.identity([]),this.orientation=l,this.position=r}get mercatorPosition(){const r=this.position;return new c.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=c.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var l;r&&c.setColumn(this._transform,3,[(l=r)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||c.identity$1([]),r&&ae(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,l){this._orientation=Se(r,l),ae(this._transform,this._orientation)}forward(){const r=c.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=c.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=c.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,l){const _=new Float64Array(16);return c.invert(_,this.getWorldToCamera(r,l)),_}getWorldToCameraPosition(r,l,_){const u=this.position;c.scale$2(u,u,-r);const d=new Float64Array(16);return c.fromScaling(d,[_,_,_]),c.translate(d,d,u),d[10]*=l,d}getWorldToCamera(r,l){const _=new Float64Array(16),u=new Float64Array(4),d=this.position;return c.conjugate(u,this._orientation),c.scale$2(d,d,-r),c.fromQuat(_,u),c.translate(_,_,d),_[1]*=-1,_[5]*=-1,_[9]*=-1,_[13]*=-1,_[8]*=l,_[9]*=l,_[10]*=l,_[11]*=l,_}getCameraToClipPerspective(r,l,_,u){const d=new Float64Array(16);return c.perspective(d,r,l,_,u),d}getDistanceToElevation(r,l=!1){const _=0===r?0:c.mercatorZfromAltitude(r,l?c.latFromMercatorY(this.position[1]):this.position[1]),u=this.forward();return(_-this.position[2])/u[2]}clone(){return new $([...this.position],[...this.orientation])}}function pe(p,r){const l=Ot(p.projection,p.zoom,p.width,p.height),_=function(d,f,v,b,C){const S=new c.LngLat(v.lng-180*_n,v.lat),z=new c.LngLat(v.lng+180*_n,v.lat),H=d.project(S.lng,S.lat),ee=d.project(z.lng,z.lat),re=-Math.atan2(ee.y-H.y,ee.x-H.x),ue=c.MercatorCoordinate.fromLngLat(v);ue.y=c.clamp(ue.y,-.999975,.999975);const fe=ue.toLngLat(),ne=d.project(fe.lng,fe.lat),we=c.MercatorCoordinate.fromLngLat(fe);we.x+=_n;const xe=we.toLngLat(),be=d.project(xe.lng,xe.lat),Re=Bn(be.x-ne.x,be.y-ne.y,re),Ae=c.MercatorCoordinate.fromLngLat(fe);Ae.y+=_n;const ze=Ae.toLngLat(),qe=d.project(ze.lng,ze.lat),Ke=Bn(qe.x-ne.x,qe.y-ne.y,re),Qe=Math.abs(Re.x)/Math.abs(Ke.y),Ht=c.identity([]);c.rotateZ(Ht,Ht,-re*(1-(C?0:b)));const Ze=c.identity([]);return c.scale(Ze,Ze,[1,1-(1-Qe)*b,1]),Ze[4]=-Ke.x/Ke.y*b,c.rotateZ(Ze,Ze,re),c.multiply(Ze,Ht,Ze),Ze}(p.projection,0,p.center,l,r),u=We(p);return c.scale(_,_,[u,u,1]),_}function We(p){const r=p.projection,l=Ot(p.projection,p.zoom,p.width,p.height),_=qn(r,p.center),u=qn(r,c.LngLat.convert(r.center));return Math.pow(2,_*l+(1-l)*u)}function Ot(p,r,l,_,u=1/0){const d=p.range;if(!d)return 0;const f=Math.min(u,Math.max(l,_)),v=Math.log(f/1024)/Math.LN2;return c.smoothstep(d[0]+v,d[1]+v,r)}const _n=1/4e4;function qn(p,r){const l=c.clamp(r.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),_=new c.LngLat(r.lng-180*_n,l),u=new c.LngLat(r.lng+180*_n,l),d=p.project(_.lng,l),f=p.project(u.lng,l),v=c.MercatorCoordinate.fromLngLat(_),b=c.MercatorCoordinate.fromLngLat(u),C=f.x-d.x,S=f.y-d.y,z=b.x-v.x,H=b.y-v.y,ee=Math.sqrt((z*z+H*H)/(C*C+S*S));return Math.log(ee)/Math.LN2}function Bn(p,r,l){const _=Math.cos(l),u=Math.sin(l);return{x:p*_-r*u,y:p*u+r*_}}class _t{constructor(r,l,_,u,d,f,v){this.tileSize=512,this._renderWorldCopies=void 0===d||d,this._minZoom=r||0,this._maxZoom=l||22,this._minPitch=_??0,this._maxPitch=u??60,this.setProjection(f),this.setMaxBounds(v),this.width=0,this.height=0,this._center=new c.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new U,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new $,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new _t(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r,l=!1){const _=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||_)&&this._updateCameraOnTerrain(),(r||_)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return c.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=c.getProjection(this.projectionOptions);const _=!Le(l,this.getProjection());return _&&this._calcMatrices(),this.mercatorFromTransition=!1,_}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=c.getProjection({name:"mercator"});const l=r!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(r){void 0===r?r=!0:null===r&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return c.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.pointGeometry(this.width,this.height)}get bearing(){return c.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const l=-r*Math.PI/180;var _,u,d,f,v,b,C,S,z,H;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(_=new c.ARRAY_TYPE(4),c.ARRAY_TYPE!=Float32Array&&(_[1]=0,_[2]=0),_[0]=1,_[3]=1,_),u=this.rotationMatrix,f=this.angle,v=(d=this.rotationMatrix)[0],b=d[1],C=d[2],S=d[3],z=Math.sin(f),H=Math.cos(f),u[0]=v*H+C*z,u[1]=b*H+S*z,u[2]=v*-z+C*H,u[3]=b*-z+S*H)}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const l=c.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=c.degToRad(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const l=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],_=this.horizonLineFromTop();let u=0,d=0;for(let f=0;f<l.length;f++){const v=new c.pointGeometry(l[f][0]*this.width,_+l[f][1]*(this.height-_)),b=r.pointCoordinate(v);if(!b)continue;const C=1/Math.hypot(b[0]-this._camera.position[0],b[1]-this._camera.position[1]);u+=b[3]*C,d+=C}return 0===d?NaN:u/d}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const r=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),_=this.pixelsPerMeter/this.worldSize*l,u=this._mercatorZfromZoom(r),d=this._mercatorZfromZoom(this._maxZoom),f=Math.max(u-_,d);this._setZoom(this._zoomFromMercatorZ(f))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let _;_=r.z<this._camera.position[2]?[l.x,l.y,l.z]:[r.x,r.y,r.z];const u=c.length(c.sub([],this._camera.position,_));return c.clamp(this._zoomFromMercatorZ(u),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let l=!1;if(r.orientation&&!c.exactEquals(r.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(r.orientation)),r.position){const _=[r.position.x,r.position.y,r.position.z];c.exactEquals$1(_,this._camera.position)||(this._setCameraPosition(_),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,l=new P;return l.position=new c.MercatorCoordinate(r[0],r[1],r[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(r){if(!c.length$1(r))return!1;c.normalize$1(r,r);const l=c.transformQuat([],[0,0,-1],r),_=c.transformQuat([],[0,-1,0],r);if(_[2]<0)return!1;const u=A(l,_);return!!u&&(this._camera.orientation=u,!0)}_setCameraPosition(r){const l=this.zoomScale(this.minZoom)*this.tileSize,_=this.zoomScale(this.maxZoom)*this.tileSize,u=this.cameraToCenterDistance;r[2]=c.clamp(r[2],u/_,u/l),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,l,_){this._unmodified=!1,this._edgeInsets.interpolate(r,l,_),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const l=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(r){const l=[new c.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const _=this.pointCoordinate(new c.pointGeometry(0,0)),u=this.pointCoordinate(new c.pointGeometry(this.width,0)),d=this.pointCoordinate(new c.pointGeometry(this.width,this.height)),f=this.pointCoordinate(new c.pointGeometry(0,this.height)),v=Math.floor(Math.min(_.x,u.x,d.x,f.x)),b=Math.floor(Math.max(_.x,u.x,d.x,f.x)),C=1;for(let S=v-C;S<=b+C;S++)0!==S&&l.push(new c.UnwrappedTileID(S,r))}return l}coveringTiles(r){let l=this.coveringZoomLevel(r);const _=l,u=this.elevation&&!r.isTerrainDEM,d="mercator"===this.projection.name;if(void 0!==r.minzoom&&l<r.minzoom)return[];void 0!==r.maxzoom&&l>r.maxzoom&&(l=r.maxzoom);const f=this.locationCoordinate(this.center),v=this.center.lat,b=1<<l,C=[b*f.x,b*f.y,0],S="globe"===this.projection.name,z=!S,H=c.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,z),ee=S?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),re=b*c.mercatorZfromAltitude(1,this.center.lat),ue=this._camera.position[2]/c.mercatorZfromAltitude(1,this.center.lat),fe=[b*ee.x,b*ee.y,ue*(z?1:re)],ne=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),we=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,xe=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,be=r.isTerrainDEM?-xe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Re=this.projection.isReprojectedInTileSpace?We(this):1,Ae=Ye=>{const rt=new c.MercatorCoordinate(Ye.x+25e-6,Ye.y,Ye.z),St=new c.MercatorCoordinate(Ye.x,Ye.y+25e-6,Ye.z),Nt=Ye.toLngLat(),An=rt.toLngLat(),_r=St.toLngLat(),wn=this.locationCoordinate(Nt),ln=this.locationCoordinate(An),Sn=this.locationCoordinate(_r),Mr=Math.hypot(ln.x-wn.x,ln.y-wn.y),Fn=Math.hypot(Sn.x-wn.x,Sn.y-wn.y);return Math.sqrt(Mr*Fn)*Re/25e-6},ze=Ye=>{const He=xe,rt=be;return{aabb:c.tileAABB(this,b,0,0,0,Ye,rt,He,this.projection),zoom:0,x:0,y:0,minZ:rt,maxZ:He,wrap:Ye,fullyVisible:!1}},qe=[];let Ke=[];const Qe=l,Ht=r.reparseOverscaled?_:l,Ze=Ye=>Ye*Ye,bt=Ze((ue-this._centerAltitude)*re),ut=Ye=>{if(!this._elevation||!Ye.tileID||!d)return;const He=this._elevation.getMinMaxForTile(Ye.tileID),rt=Ye.aabb;He?(rt.min[2]=He.min,rt.max[2]=He.max,rt.center[2]=(rt.min[2]+rt.max[2])/2):(Ye.shouldSplit=Ct(Ye),Ye.shouldSplit||(rt.min[2]=rt.max[2]=rt.center[2]=this._centerAltitude))},Ct=Ye=>{if(Ye.zoom<we)return!0;if(Ye.zoom===Qe)return!1;if(null!=Ye.shouldSplit)return Ye.shouldSplit;const He=Ye.aabb.distanceX(fe),rt=Ye.aabb.distanceY(fe);let St=bt,Nt=1;if(S){St=Ze(Ye.aabb.distanceZ(fe));const wn=Math.pow(2,Ye.zoom),ln=c.latFromMercatorY((Ye.y+1)/wn),Sn=c.latFromMercatorY(Ye.y/wn),Mr=Math.min(Math.max(v,ln),Sn),Fn=c.circumferenceAtLatitude(Mr)/c.circumferenceAtLatitude(v);if(Nt=Mr===v?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Fn/this._mercatorScaleRatio),this.zoom<=c.GLOBE_ZOOM_THRESHOLD_MIN&&Ye.zoom===Qe-1&&Fn>=.9)return!0}else if(u&&(St=Ze(Ye.aabb.distanceZ(fe)*re)),this.projection.isReprojectedInTileSpace&&_<=5){const wn=Math.pow(2,Ye.zoom),ln=Ae(new c.MercatorCoordinate((Ye.x+.5)/wn,(Ye.y+.5)/wn));Nt=ln>.85?1:ln}const An=He*He+rt*rt+St;return An<Ze((1<<Qe-Ye.zoom)*ne*Nt*((wn,ln)=>{if(ln*Ze(.707)<wn)return 1;const Sn=Math.sqrt(ln/wn);return Sn/(1.4144271570014144+(Math.pow(1.1,Sn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(St,bt),An))};if(this.renderWorldCopies)for(let Ye=1;Ye<=3;Ye++)qe.push(ze(-Ye)),qe.push(ze(Ye));for(qe.push(ze(0));qe.length>0;){const Ye=qe.pop(),He=Ye.x,rt=Ye.y;let St=Ye.fullyVisible;if(!St){const Nt=Ye.aabb.intersects(H);if(0===Nt)continue;St=2===Nt}if(Ye.zoom!==Qe&&Ct(Ye))for(let Nt=0;Nt<4;Nt++){const An=(He<<1)+Nt%2,_r=(rt<<1)+(Nt>>1),wn={aabb:d?Ye.aabb.quadrant(Nt):c.tileAABB(this,b,Ye.zoom+1,An,_r,Ye.wrap,Ye.minZ,Ye.maxZ,this.projection),zoom:Ye.zoom+1,x:An,y:_r,wrap:Ye.wrap,fullyVisible:St,tileID:void 0,shouldSplit:void 0,minZ:Ye.minZ,maxZ:Ye.maxZ};u&&!S&&(wn.tileID=new c.OverscaledTileID(Ye.zoom+1===Qe?Ht:Ye.zoom+1,Ye.wrap,Ye.zoom+1,An,_r),ut(wn)),qe.push(wn)}else{const Nt=Ye.zoom===Qe?Ht:Ye.zoom;if(r.minzoom&&r.minzoom>Nt)continue;const An=C[0]-(.5+He+(Ye.wrap<<Ye.zoom))*(1<<l-Ye.zoom),_r=C[1]-.5-rt,wn=Ye.tileID?Ye.tileID:new c.OverscaledTileID(Nt,Ye.wrap,Ye.zoom,He,rt);Ke.push({tileID:wn,distanceSq:An*An+_r*_r})}}if(this.fogCullDistSq){const Ye=this.fogCullDistSq,He=this.horizonLineFromTop();Ke=Ke.filter(rt=>{const St=[0,0,0,1],Nt=[c.EXTENT,c.EXTENT,0,1],An=this.calculateFogTileMatrix(rt.tileID.toUnwrapped());c.transformMat4$1(St,St,An),c.transformMat4$1(Nt,Nt,An);const _r=c.getAABBPointSquareDist(St,Nt);if(0===_r)return!0;let wn=!1;const ln=this._elevation;if(ln&&_r>Ye&&0!==He){const Sn=this.calculateProjMatrix(rt.tileID.toUnwrapped());let Mr;r.isTerrainDEM||(Mr=ln.getMinMaxForTile(rt.tileID)),Mr||(Mr={min:be,max:xe});const Fn=c.furthestTileCorner(this.rotation),ei=[Fn[0]*c.EXTENT,Fn[1]*c.EXTENT,Mr.max];c.transformMat4(ei,ei,Sn),wn=(1-ei[1])*this.height*.5<He}return _r<Ye||wn})}return Ke.sort((Ye,He)=>Ye.distanceSq-He.distanceSq).map(Ye=>Ye.tileID)}resize(r,l){this.width=r,this.height=l,this.pixelsToGLUnits=[2/r,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const l=c.clamp(r.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),_=this.projection.project(r.lng,l);return new c.pointGeometry(_.x*this.worldSize,_.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/c.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,l){let _,u;const d=this.centerPoint;if("globe"===this.projection.name){const v=this.worldSize;_=(l.x-d.x)/v,u=(l.y-d.y)/v}else{const v=this.pointCoordinate(l),b=this.pointCoordinate(d);_=v.x-b.x,u=v.y-b.y}const f=this.locationCoordinate(r);this.setLocation(new c.MercatorCoordinate(f.x-_,f.y-u))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,l){const _=l?c.mercatorZfromAltitude(l,r.lat):void 0,u=this.projection.project(r.lng,r.lat);return new c.MercatorCoordinate(u.x,u.y,_)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,l){const _=l??this._centerAltitude,u=[r.x,r.y,0,1],d=[r.x,r.y,1,1];c.transformMat4$1(u,u,this.pixelMatrixInverse),c.transformMat4$1(d,d,this.pixelMatrixInverse);const f=d[3];c.scale$1(u,u,1/u[3]),c.scale$1(d,d,1/f);const v=u[2],b=d[2];return{p0:u,p1:d,t:v===b?0:(_-v)/(b-v)}}screenPointToMercatorRay(r){const l=[r.x,r.y,0,1],_=[r.x,r.y,1,1];return c.transformMat4$1(l,l,this.pixelMatrixInverse),c.transformMat4$1(_,_,this.pixelMatrixInverse),c.scale$1(l,l,1/l[3]),c.scale$1(_,_,1/_[3]),l[2]=c.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,_[2]=c.mercatorZfromAltitude(_[2],this._center.lat)*this.worldSize,c.scale$1(l,l,1/this.worldSize),c.scale$1(_,_,1/this.worldSize),new c.Ray([l[0],l[1],l[2]],c.normalize([],c.sub([],_,l)))}rayIntersectionCoordinate(r){const{p0:l,p1:_,t:u}=r,d=c.mercatorZfromAltitude(l[2],this._center.lat),f=c.mercatorZfromAltitude(_[2],this._center.lat);return new c.MercatorCoordinate(c.number(l[0],_[0],u)/this.worldSize,c.number(l[1],_[1],u)/this.worldSize,c.number(d,f,u))}pointCoordinate(r,l=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,l)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let l=this.projection.pointCoordinate3D(this,r.x,r.y);if(l)return new c.MercatorCoordinate(l[0],l[1],l[2]);let _=0,u=this.horizonLineFromTop();if(r.y>u)return this.pointCoordinate(r);const d=.02*u,f=r.clone();for(let v=0;v<10&&u-_>d;v++){f.y=c.number(_,u,.66);const b=this.projection.pointCoordinate3D(this,f.x,f.y);b?(u=f.y,l=b):_=f.y}return l?new c.MercatorCoordinate(l[0],l[1],l[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}_coordinatePoint(r,l){const _=l&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,u=[r.x*this.worldSize,r.y*this.worldSize,_+r.toAltitude(),1];return c.transformMat4$1(u,u,this.pixelMatrix),u[3]>0?new c.pointGeometry(u[0]/u[3],u[1]/u[3]):new c.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:l}=this._edgeInsets,_=this.height-this._edgeInsets.bottom,u=this.width-this._edgeInsets.right,d=this.pointLocation3D(new c.pointGeometry(l,r)),f=this.pointLocation3D(new c.pointGeometry(u,r)),v=this.pointLocation3D(new c.pointGeometry(u,_)),b=this.pointLocation3D(new c.pointGeometry(l,_));let C=Math.min(d.lng,f.lng,v.lng,b.lng),S=Math.max(d.lng,f.lng,v.lng,b.lng),z=Math.min(d.lat,f.lat,v.lat,b.lat),H=Math.max(d.lat,f.lat,v.lat,b.lat);const ee=Math.pow(2,-this.zoom)/16*270,re="globe"===this.projection.name?1:4,ue=(fe,ne,we,xe,be)=>{const Re=(fe+we)/2,Ae=(ne+xe)/2,ze=new c.pointGeometry(Re,Ae),{lng:qe,lat:Ke}=this.pointLocation3D(ze),Qe=Math.max(0,C-qe,z-Ke,qe-S,Ke-H);C=Math.min(C,qe),S=Math.max(S,qe),z=Math.min(z,Ke),H=Math.max(H,Ke),(be<re||Qe>ee)&&(ue(fe,ne,Re,Ae,be+1),ue(Re,Ae,we,xe,be+1))};if(ue(l,r,u,r,1),ue(u,r,u,_,1),ue(u,_,l,_,1),ue(l,_,l,r,1),"globe"===this.projection.name){const[fe,ne]=c.polesInViewport(this);fe?(H=90,S=180,C=-180):ne&&(z=-90,S=180,C=-180)}return new c.LngLatBounds(new c.LngLat(C,z),new c.LngLat(S,H))}_getBoundsRectangular(r,l){const{top:_,left:u}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,f=this.width-this._edgeInsets.right,v=new c.pointGeometry(u,_),b=new c.pointGeometry(f,_),C=new c.pointGeometry(f,d),S=new c.pointGeometry(u,d);let z=this.pointCoordinate(v,r),H=this.pointCoordinate(b,r);const ee=this.pointCoordinate(C,l),re=this.pointCoordinate(S,l),ue=(fe,ne)=>(ne.y-fe.y)/(ne.x-fe.x);return z.y>1&&H.y>=0?z=new c.MercatorCoordinate((1-re.y)/ue(re,z)+re.x,1):z.y<0&&H.y<=1&&(z=new c.MercatorCoordinate(-re.y/ue(re,z)+re.x,0)),H.y>1&&z.y>=0?H=new c.MercatorCoordinate((1-ee.y)/ue(ee,H)+ee.x,1):H.y<0&&z.y<=1&&(H=new c.MercatorCoordinate(-ee.y/ue(ee,H)+ee.x,0)),(new c.LngLatBounds).extend(this.coordinateLocation(z)).extend(this.coordinateLocation(H)).extend(this.coordinateLocation(re)).extend(this.coordinateLocation(ee))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=r.visibleDemTiles.reduce((_,u)=>{if(u.dem){const d=u.dem.tree;_.min=Math.min(_.min,d.minimums[0]),_.max=Math.max(_.max,d.maximums[0])}return _},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*r.exaggeration(),l.max*r.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,_=this.height/2-l*(1-this._horizonShift);return r?Math.max(0,_):_}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-c.MAX_MERCATOR_LATITUDE,this.maxLat=c.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=c.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=c.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=c.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=c.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,l){return this.projection.createTileMatrix(this,l,r)}calculateDistanceTileData(r){const l=r.key,_=this._distanceTileDataCache;if(_[l])return _[l];const u=r.canonical,d=1/this.height,f=this.cameraWorldSize,v=f/this.zoomScale(u.z),b=(u.x+Math.pow(2,u.z)*r.wrap)*v,C=u.y*v,S=this.point;S.x*=f/this.worldSize,S.y*=f/this.worldSize;const z=this.angle,H=Math.sin(-z),ee=-Math.cos(-z);return _[l]={bearing:[H,ee],center:[(S.x-b)*d,(S.y-C)*d],scale:v/c.EXTENT*d},_[l]}calculateFogTileMatrix(r){const l=r.key,_=this._fogTileMatrixCache;if(_[l])return _[l];const u=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return c.multiply(u,this.worldToFogMatrix,u),_[l]=new Float32Array(u),_[l]}calculateProjMatrix(r,l=!1){const _=r.key,u=l?this._alignedProjMatrixCache:this._projMatrixCache;if(u[_])return u[_];const d=this.calculatePosMatrix(r,this.worldSize);return c.multiply(d,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,d),u[_]=new Float32Array(d),u[_]}calculatePixelsToTileUnitsMatrix(r){const l=r.tileID.key,_=this._pixelsToTileUnitsCache;if(_[l])return _[l];const u=function(d,f){const{scale:v}=d.tileTransform,b=v*c.EXTENT/(d.tileSize*Math.pow(2,f.zoom-d.tileID.overscaledZ+d.tileID.canonical.z));return C=new Float32Array(4),H=(S=f.inverseAdjustmentMatrix)[1],ee=S[2],re=S[3],fe=(z=[b,b])[1],C[0]=S[0]*(ue=z[0]),C[1]=H*ue,C[2]=ee*fe,C[3]=re*fe,C;var C,S,z,H,ee,re,ue,fe}(r,this);return _[l]=u,_[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const r=1/this.worldSize,l=c.fromScaling([],[r,r,r]);return c.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const r=this._elevation;this._updateCameraState();const l=c.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,_=this._computeCameraPosition(l),u=this._camera.forward(),d=c.mercatorZfromAltitude(1,this._center.lat);_[2]/=d,u[2]/=d,c.normalize(u,u);const f=r.raycast(_,u,r.exaggeration());if(f){const v=c.scaleAndAdd([],_,u,f),b=new c.MercatorCoordinate(v[0],v[1],c.mercatorZfromAltitude(v[2],c.latFromMercatorY(v[1]))),C=(b.z+c.length([b.x-_[0],b.y-_[1],b.z-_[2]*d]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(C),this._centerAltitude=b.toAltitude(),this._center=this.coordinateLocation(b),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const l=this._elevation,_=c.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,u=this._computeCameraPosition(_),d=l.getAtPointOrZero(new c.MercatorCoordinate(...u)),f=this.pixelsPerMeter/this.worldSize*d,v=this._minimumHeightOverTerrain(),b=u[2]-f;if(b<=v)if(b<0||r){const C=this.locationCoordinate(this._center,this._centerAltitude),S=[u[0],u[1],C.z-u[2]],z=c.length(S);S[2]-=(v-b)/this._pixelsPerMercatorPixel;const H=c.length(S);if(0===H)return;c.scale$2(S,S,z/H*this._pixelsPerMercatorPixel),this._camera.position=[u[0],u[1],C.z*this._pixelsPerMercatorPixel-S[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const H=this.center;return H.lat=c.clamp(H.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(H.lng=c.clamp(H.lng,this.minLng,this.maxLng)),this.center=H,void(this._constraining=!1)}const l=this._unmodified,{x:_,y:u}=this.point;let d=0,f=_,v=u;const b=this.width/2,C=this.height/2,S=this.worldMinY*this.scale,z=this.worldMaxY*this.scale;if(u-C<S&&(v=S+C),u+C>z&&(v=z-C),z-S<this.height&&(d=Math.max(d,this.height/(z-S)),v=(z+S)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const H=this.worldMinX*this.scale,ee=this.worldMaxX*this.scale,re=this.worldSize/2-(H+ee)/2;f=(_+re+this.worldSize)%this.worldSize-re,f-b<H&&(f=H+b),f+b>ee&&(f=ee-b),ee-H<this.width&&(d=Math.max(d,this.width/(ee-H)),f=(ee+H)/2)}f===_&&v===u||(this.center=this.unproject(new c.pointGeometry(f,v))),d&&(this.zoom+=this.scaleZoom(d)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,l=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=c.mercatorZfromAltitude(1,this.center.lat)/c.mercatorZfromAltitude(1,c.GLOBE_SCALE_MATCH_LATITUDE));const _=Ot(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,_),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const u="meters"===this.projection.zAxisUnit?l:1,d=this._camera.getWorldToCamera(this.worldSize,u),f=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);f[8]=2*-r.x/this.width,f[9]=2*r.y/this.height;let v=c.mul([],f,d);if(this.projection.isReprojectedInTileSpace){const Ae=this.locationCoordinate(this.center),ze=c.identity([]);c.translate(ze,ze,[Ae.x*this.worldSize,Ae.y*this.worldSize,0]),c.multiply(ze,ze,pe(this)),c.translate(ze,ze,[-Ae.x*this.worldSize,-Ae.y*this.worldSize,0]),c.multiply(v,v,ze),this.inverseAdjustmentMatrix=function(qe){const Ke=pe(qe,!0);return je([],[Ke[0],Ke[1],Ke[4],Ke[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=c.scale([],v,[this.worldSize,this.worldSize,this.worldSize/u,1]),this.projMatrix=v,this.invProjMatrix=c.invert(new Float64Array(16),this.projMatrix);const b=c.invert([],f);this.frustumCorners=c.FrustumCorners.fromInvProjectionMatrix(b,this.horizonLineFromTop(),this.height);const C=new Float32Array(16);c.identity(C),c.scale(C,C,[1,-1,1]),c.rotateX(C,C,this._pitch),c.rotateZ(C,C,this.angle);const S=c.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),z=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;S[8]=2*-r.x/this.width,S[9]=2*(r.y+z)/this.height,this.skyboxMatrix=c.multiply(C,S,C);const H=this.point,ee=H.x,re=H.y,ue=this.width%2/2,fe=this.height%2/2,ne=Math.cos(this.angle),we=Math.sin(this.angle),xe=ee-Math.round(ee)+ne*ue+we*fe,be=re-Math.round(re)+ne*fe+we*ue,Re=new Float64Array(v);if(c.translate(Re,Re,[xe>.5?xe-1:xe,be>.5?be-1:be,0]),this.alignedProjMatrix=Re,v=c.create(),c.scale(v,v,[this.width/2,-this.height/2,1]),c.translate(v,v,[1,-1,0]),this.labelPlaneMatrix=v,v=c.create(),c.scale(v,v,[1,-1,1]),c.translate(v,v,[-1,-1,0]),c.scale(v,v,[2/this.width,2/this.height,1]),this.glCoordMatrix=v,this.pixelMatrix=c.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},v=c.invert(new Float64Array(16),this.pixelMatrix),!v)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=v,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=c.calculateGlobeMatrix(this);const Ae=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=c.transformMat4(Ae,Ae,d),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=v;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,_=this._camera.position,u=1/this.height/this._pixelsPerMercatorPixel,d=[r,r,l];c.scale$2(d,d,u),c.scale$2(_,_,-1),c.multiply$2(_,_,d);const f=c.create();c.translate(f,f,_),c.scale(f,f,d),this.mercatorFogMatrix=f,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,l,u)}_computeCameraPosition(r){const l=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,_=this._camera.forward(),u=this.point,d=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-r/this.worldSize*this._centerAltitude;return[u.x/this.worldSize-_[0]*d,u.y/this.worldSize-_[1]*d,r/this.worldSize*this._centerAltitude-_[2]*d]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),_=this._camera.position[2],u=r[2];let d=1;this.projection.wrap&&(this.center=this.center.wrap()),u>0&&(d=Math.min((l-_)/u,1)),this._camera.position=c.scaleAndAdd([],this._camera.position,r,d),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,l=this._camera.forward(),{pitch:_,bearing:u}=this._camera.getPitchBearing(),d=c.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,f=this._mercatorZfromZoom(this._maxZoom)*Math.cos(c.degToRad(this._maxPitch)),v=Math.max((r[2]-d)/Math.cos(_),f),b=this._zoomFromMercatorZ(v);c.scaleAndAdd(r,r,l,v),this._pitch=c.clamp(_,c.degToRad(this.minPitch),c.degToRad(this.maxPitch)),this.angle=c.wrap(u,-Math.PI,Math.PI),this._setZoom(c.clamp(b,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new c.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let l=0,_=c.GLOBE_ZOOM_THRESHOLD_MAX,u=0,d=1/0;for(;_-l>1e-6&&_>l;){const f=l+.5*(_-l),v=this.tileSize*Math.pow(2,f),b=this.getCameraToCenterDistance(this.projection,f,v),C=this.scaleZoom(b/(r*this.tileSize)),S=Math.abs(f-C);S<d&&(d=S,u=f),f<C?l=f:_=f}return u}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(c.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,l){const _=Math.min(r.x,l.x),u=Math.max(r.x,l.x),d=Math.min(r.y,l.y),f=Math.max(r.y,l.y);if(d<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const v=[new c.pointGeometry(_,d),new c.pointGeometry(u,f),new c.pointGeometry(_,f),new c.pointGeometry(u,d)],b=this.renderWorldCopies?-3:0,C=this.renderWorldCopies?4:1;for(const S of v){const z=this.pointRayIntersection(S);if(z.t<0)return!0;const H=this.rayIntersectionCoordinate(z);if(H.x<b||H.y<0||H.x>C||H.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+c.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new c.pointGeometry(0,0),new c.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,l){const _=c.length(c.sub([],this._camera.position,r)),u=this._zoomFromMercatorZ(_)+l;return _-this._mercatorZfromZoom(u)}getCameraPoint(){if("globe"===this.projection.name){const r=function([l,_,u],d){const f=[l,_,u,1];c.transformMat4$1(f,f,d);const v=f[3]=Math.max(f[3],1e-6);return f[0]/=v,f[1]/=v,f[2]/=v,f}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new c.pointGeometry(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.pointGeometry(0,r))}}getCameraToCenterDistance(r,l=this.zoom,_=this.worldSize){const u=Ot(r,l,this.width,this.height,1024),d=r.pixelSpaceConversion(this.center.lat,_,u);return.5/Math.tan(.5*this._fov)*this.height*d}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&c.multiply(r,r,this.globeMatrix),r}}function zi(p,r){let l=!1,_=null;const u=()=>{_=null,l&&(p(),_=setTimeout(u,r),l=!1)};return()=>(l=!0,_||u(),_)}class qo{constructor(r){this._hashName=r&&encodeURIComponent(r),c.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=zi(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,c.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),c.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const l=Ci(r);if(this._hashName){const _=this._hashName;let u=!1;const d=c.window.location.hash.slice(1).split("&").map(f=>{const v=f.split("=")[0];return v===_?(u=!0,`${v}=${l}`):f}).filter(f=>f);return u||d.push(`${_}=${l}`),`#${d.join("&")}`}return`#${l}`}_getCurrentHash(){const r=c.window.location.hash.replace("#","");if(this._hashName){let l;return r.split("&").map(_=>_.split("=")).forEach(_=>{_[0]===this._hashName&&(l=_)}),(l&&l[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(_=>isNaN(_))){const _=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(l[3]||0):r.getBearing();return r.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:_,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=c.window.location.href.replace(/(#.+)?$/,this.getHashString());c.window.history.replaceState(c.window.history.state,null,r)}}function Ci(p,r){const l=p.getCenter(),_=Math.round(100*p.getZoom())/100,u=Math.ceil((_*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,u),f=Math.round(l.lng*d)/d,v=Math.round(l.lat*d)/d,b=p.getBearing(),C=p.getPitch();let S=r?`/${f}/${v}/${_}`:`${_}/${v}/${f}`;return(b||C)&&(S+="/"+Math.round(10*b)/10),C&&(S+=`/${Math.round(C)}`),S}const ao={linearity:.3,easing:c.bezier(0,0,.3,1)},Ki=c.extend({deceleration:2500,maxSpeed:1400},ao),Pa=c.extend({deceleration:20,maxSpeed:1400},ao),_a=c.extend({deceleration:1e3,maxSpeed:360},ao),dl=c.extend({deceleration:1e3,maxSpeed:90},ao);class Pl{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,l=c.exported.now();for(;r.length>0&&l-r[0].time>160;)r.shift()}_onMoveEnd(r){if(c.exported.prefersReducedMotion||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new c.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)l.zoom+=d.zoomDelta||0,l.bearing+=d.bearingDelta||0,l.pitch+=d.pitchDelta||0,d.panDelta&&l.pan._add(d.panDelta),d.around&&(l.around=d.around),d.pinchAround&&(l.pinchAround=d.pinchAround);const _=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,u={};if(l.pan.mag()){const d=va(l.pan.mag(),_,c.extend({},Ki,r||{}));u.offset=l.pan.mult(d.amount/l.pan.mag()),u.center=this._map.transform.center,ya(u,d)}if(l.zoom){const d=va(l.zoom,_,Pa);u.zoom=this._map.transform.zoom+d.amount,ya(u,d)}if(l.bearing){const d=va(l.bearing,_,_a);u.bearing=this._map.transform.bearing+c.clamp(d.amount,-179,179),ya(u,d)}if(l.pitch){const d=va(l.pitch,_,dl);u.pitch=this._map.transform.pitch+d.amount,ya(u,d)}if(u.zoom||u.bearing){const d=void 0===l.pinchAround?l.around:l.pinchAround;u.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),u.noMoveStart=!0,u}}function ya(p,r){(!p.duration||p.duration<r.duration)&&(p.duration=r.duration,p.easing=r.easing)}function va(p,r,l){const{maxSpeed:_,linearity:u,deceleration:d}=l,f=c.clamp(p*u/(r/1e3),-_,_),v=Math.abs(f)/(d*u);return{easing:l.easing,duration:1e3*v,amount:f*(v/2)}}class Eo extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,_,u={}){const d=dt(l.getCanvasContainer(),_),f=l.unproject(d);super(r,c.extend({point:d,lngLat:f,originalEvent:_},u)),this._defaultPrevented=!1,this.target=l}}class Rl extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,_){const u="touchend"===r?_.changedTouches:_.touches,d=yr(l.getCanvasContainer(),u),f=d.map(b=>l.unproject(b)),v=d.reduce((b,C,S,z)=>b.add(C.div(z.length)),new c.pointGeometry(0,0));super(r,{points:d,point:v,lngLats:f,lngLat:l.unproject(v),originalEvent:_}),this._defaultPrevented=!1}}class fl extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,l,_){super(r,{originalEvent:_}),this._defaultPrevented=!1}}class sc{constructor(r,l){this._map=r,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new fl(r.type,this._map,r))}mousedown(r,l){return this._mousedownPos=l,this._firePreventable(new Eo(r.type,this._map,r))}mouseup(r){this._map.fire(new Eo(r.type,this._map,r))}preclick(r){const l=c.extend({},r);l.type="preclick",this._map.fire(new Eo(l.type,this._map,l))}click(r,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(r),this._map.fire(new Eo(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new Eo(r.type,this._map,r))}mouseover(r){this._map.fire(new Eo(r.type,this._map,r))}mouseout(r){this._map.fire(new Eo(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Rl(r.type,this._map,r))}touchmove(r){this._map.fire(new Rl(r.type,this._map,r))}touchend(r){this._map.fire(new Rl(r.type,this._map,r))}touchcancel(r){this._map.fire(new Rl(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class tl{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new Eo(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Eo("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new Eo(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class kl{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,l){this.isEnabled()&&r.shiftKey&&0===r.button&&(Ut(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(r,l){if(!this._active)return;const _=l,u=this._startPos,d=this._lastPos;if(!u||!d||d.equals(_)||!this._box&&_.dist(u)<this._clickTolerance)return;this._lastPos=_,this._box||(this._box=wt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const f=Math.min(u.x,_.x),v=Math.max(u.x,_.x),b=Math.min(u.y,_.y),C=Math.max(u.y,_.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${f}px,${b}px)`,this._box.style.width=v-f+"px",this._box.style.height=C-b+"px")})}mouseupWindow(r,l){if(!this._active)return;const _=this._startPos,u=l;if(_&&0===r.button){if(this.reset(),Xn(),_.x!==u.x||_.y!==u.y)return this._map.fire(new c.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:d=>d.fitScreenCoordinates(_,u,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&27===r.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),cn(),delete this._startPos,delete this._lastPos}_fireEvent(r,l){return this._map.fire(new c.Event(r,{originalEvent:l}))}}function pl(p,r){const l={};for(let _=0;_<p.length;_++)l[p[_].identifier]=r[_];return l}class ih{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,l,_){(this.centroid||_.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=r.timeStamp),_.length===this.numTouches&&(this.centroid=function(u){const d=new c.pointGeometry(0,0);for(const f of u)d._add(f);return d.div(u.length)}(l),this.touches=pl(_,l)))}touchmove(r,l,_){if(this.aborted||!this.centroid)return;const u=pl(_,l);for(const d in this.touches){const v=u[d];(!v||v.dist(this.touches[d])>30)&&(this.aborted=!0)}}touchend(r,l,_){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),0===_.length){const u=!this.aborted&&this.centroid;if(this.reset(),u)return u}}}class ml{constructor(r){this.singleTap=new ih(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,l,_){this.singleTap.touchstart(r,l,_)}touchmove(r,l,_){this.singleTap.touchmove(r,l,_)}touchend(r,l,_){const u=this.singleTap.touchend(r,l,_);if(u){const d=r.timeStamp-this.lastTime<500,f=!this.lastTap||this.lastTap.dist(u)<30;if(d&&f||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=u,this.count===this.numTaps)return this.reset(),u}}}class Tc{constructor(){this._zoomIn=new ml({numTouches:1,numTaps:2}),this._zoomOut=new ml({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,l,_){this._zoomIn.touchstart(r,l,_),this._zoomOut.touchstart(r,l,_)}touchmove(r,l,_){this._zoomIn.touchmove(r,l,_),this._zoomOut.touchmove(r,l,_)}touchend(r,l,_){const u=this._zoomIn.touchend(r,l,_),d=this._zoomOut.touchend(r,l,_);return u?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:f=>f.easeTo({duration:300,zoom:f.getZoom()+1,around:f.unproject(u)},{originalEvent:r})}):d?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:f=>f.easeTo({duration:300,zoom:f.getZoom()-1,around:f.unproject(d)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Eu={0:1,2:2};class es{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,l){return!1}_move(r,l){return{}}mousedown(r,l){if(this._lastPoint)return;const _=sn(r);this._correctButton(r,_)&&(this._lastPoint=l,this._eventButton=_)}mousemoveWindow(r,l){const _=this._lastPoint;if(_)if(r.preventDefault(),null!=this._eventButton&&function(u,d){const f=Eu[d];return void 0===u.buttons||(u.buttons&f)!==f}(r,this._eventButton))this.reset();else if(this._moved||!(l.dist(_)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(_,l)}mouseupWindow(r){this._lastPoint&&sn(r)===this._eventButton&&(this._moved&&Xn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tu extends es{mousedown(r,l){super.mousedown(r,l),this._lastPoint&&(this._active=!0)}_correctButton(r,l){return 0===l&&!r.ctrlKey}_move(r,l){return{around:l,panDelta:l.sub(r)}}}class Ll extends es{_correctButton(r,l){return 0===l&&r.ctrlKey||2===l}_move(r,l){const _=.8*(l.x-r.x);if(_)return this._active=!0,{bearingDelta:_}}contextmenu(r){r.preventDefault()}}class gl extends es{_correctButton(r,l){return 0===l&&r.ctrlKey||2===l}_move(r,l){const _=-.5*(l.y-r.y);if(_)return this._active=!0,{pitchDelta:_}}contextmenu(r){r.preventDefault()}}class _l{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),c.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new c.pointGeometry(0,0)}touchstart(r,l,_){return this._calculateTransform(r,l,_)}touchmove(r,l,_){if(this._active&&!(_.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===_.length&&!c.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,l,_)}}touchend(r,l,_){this._calculateTransform(r,l,_),this._active&&_.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,l,_){_.length>0&&(this._active=!0);const u=pl(_,l),d=new c.pointGeometry(0,0),f=new c.pointGeometry(0,0);let v=0;for(const C in u){const S=u[C],z=this._touches[C];z&&(d._add(S),f._add(S.sub(z)),v++,u[C]=S)}if(this._touches=u,v<this._minTouches||!f.mag())return;const b=f.div(v);return this._sum._add(b),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(v),panDelta:b}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=wt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class Ol{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,l,_){return{}}touchstart(r,l,_){this._firstTwoTouches||_.length<2||(this._firstTwoTouches=[_[0].identifier,_[1].identifier],this._start([l[0],l[1]]))}touchmove(r,l,_){const u=this._firstTwoTouches;if(!u)return;r.preventDefault();const[d,f]=u,v=yl(_,l,d),b=yl(_,l,f);if(!v||!b)return;const C=this._aroundCenter?null:v.add(b).div(2);return this._move([v,b],C,r)}touchend(r,l,_){if(!this._firstTwoTouches)return;const[u,d]=this._firstTwoTouches,f=yl(_,l,u),v=yl(_,l,d);f&&v||(this._active&&Xn(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function yl(p,r,l){for(let _=0;_<p.length;_++)if(p[_].identifier===l)return r[_]}function Du(p,r){return Math.log(p/r)/Math.LN2}class ts extends Ol{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,l){const _=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Du(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Du(this._distance,_),pinchAround:l}}}function Dc(p,r){return 180*p.angleWith(r)/Math.PI}class Fl extends Ol{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,l){const _=this._vector;if(this._vector=r[0].sub(r[1]),_&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Dc(this._vector,_),pinchAround:l}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const l=25/(Math.PI*this._minDiameter)*360,_=this._startVector;if(!_)return!1;const u=Dc(r,_);return Math.abs(u)<l}}function ac(p){return Math.abs(p.y)>Math.abs(p.x)}class ns extends Ol{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,ac(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,l,_){const u=this._lastPoints;if(!u)return;const d=r[0].sub(u[0]),f=r[1].sub(u[1]);return this._map._cooperativeGestures&&!c.isFullscreen()&&_.touches.length<3||(this._valid=this.gestureBeginsVertically(d,f,_.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(d.y+f.y)/2*-.5})}gestureBeginsVertically(r,l,_){if(void 0!==this._valid)return this._valid;const u=r.mag()>=2,d=l.mag()>=2;if(!u&&!d)return;if(!u||!d)return null==this._firstMove&&(this._firstMove=_),_-this._firstMove<100&&void 0;const f=r.y>0==l.y>0;return ac(r)&&ac(l)&&f}}const lc={panStep:100,bearingStep:15,pitchStep:10};class vl{constructor(){const r=lc;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let l=0,_=0,u=0,d=0,f=0;switch(r.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:r.shiftKey?_=-1:(r.preventDefault(),d=-1);break;case 39:r.shiftKey?_=1:(r.preventDefault(),d=1);break;case 38:r.shiftKey?u=1:(r.preventDefault(),f=-1);break;case 40:r.shiftKey?u=-1:(r.preventDefault(),f=1);break;default:return}return this._rotationDisabled&&(_=0,u=0),{cameraAnimation:v=>{const b=v.getZoom();v.easeTo({duration:300,easeId:"keyboardHandler",easing:Qh,zoom:l?Math.round(b)+l*(r.shiftKey?2:1):b,bearing:v.getBearing()+_*this._bearingStep,pitch:v.getPitch()+u*this._pitchStep,offset:[-d*this._panStep,-f*this._panStep],center:v.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Qh(p){return p*(2-p)}const Gc=4.000244140625;class Js{constructor(r,l){this._map=r,this._el=r.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,c.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||c.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=r.deltaMode===c.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const _=c.exported.now(),u=_-(this._lastWheelEventTime||0);this._lastWheelEventTime=_,0!==l&&l%Gc==0?this._type="wheel":0!==l&&Math.abs(l)<4?this._type="trackpad":u>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(u*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),r.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=r,this._delta-=l,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=dt(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;"wheel"===this._type&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(0!==this._delta){const b="wheel"===this._type&&Math.abs(this._delta)>Gc?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*b)));this._delta<0&&0!==C&&(C=1/C);const S=l(),z=Math.pow(2,S),H="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):z;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(H*C))),"wheel"===this._type&&(this._startZoom=S,this._easing=this._smoothOutEasing(200)),this._delta=0}const _="number"==typeof this._targetZoom?this._targetZoom:l(),u=this._startZoom,d=this._easing;let f,v=!1;if("wheel"===this._type&&u&&d){const b=Math.min((c.exported.now()-this._lastWheelEventTime)/200,1),C=d(b);f=c.number(u,_,C),b<1?this._frameId||(this._frameId=!0):v=!0}else f=_,v=!0;return this._active=!0,v&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!v,zoomDelta:f-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let l=c.ease;if(this._prevEase){const _=this._prevEase,u=(c.exported.now()-_.start)/_.duration,d=_.easing(u+.01)-_.easing(u),f=.27/Math.sqrt(d*d+1e-4)*.01,v=Math.sqrt(.0729-f*f);l=c.bezier(f,v,.25,1)}return this._prevEase={start:c.exported.now(),duration:r,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=wt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(c.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class nl{constructor(r,l){this._clickZoom=r,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class ko{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,l){return r.preventDefault(),{cameraAnimation:_=>{_.easeTo({duration:300,zoom:_.getZoom()+(r.shiftKey?-1:1),around:_.unproject(l)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class xa{constructor(){this._tap=new ml({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,l,_){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?_.length>0&&(this._swipePoint=l[0],this._swipeTouch=_[0].identifier):this._tap.touchstart(r,l,_))}touchmove(r,l,_){if(this._tapTime){if(this._swipePoint){if(_[0].identifier!==this._swipeTouch)return;const u=l[0],d=u.y-this._swipePoint.y;return this._swipePoint=u,r.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(r,l,_)}touchend(r,l,_){this._tapTime?this._swipePoint&&0===_.length&&this.reset():this._tap.touchend(r,l,_)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wa{constructor(r,l,_){this._el=r,this._mousePan=l,this._touchPan=_}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class yn{constructor(r,l,_){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=l,this._mousePitch=_}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Cc{constructor(r,l,_,u){this._el=r,this._touchZoom=l,this._touchRotate=_,this._tapDragZoom=u,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Cs=p=>p.zoom||p.drag||p.pitch||p.rotate;class Qs extends c.Event{}class Ra{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,l){const _=c.sub([],l,r);this.radius=c.length(_[2]<0?c.div([],_,this.constants):[_[0],_[1],0])}projectRay(r){c.div(r,r,this.constants),c.normalize(r,r),c.mul$1(r,r,this.constants);const l=c.scale$2([],r,this.radius);if(l[2]>0){const _=c.scale$2([],[0,0,1],c.dot(l,[0,0,1])),u=c.scale$2([],c.normalize([],[l[0],l[1],0]),this.radius),d=c.add([],l,c.scale$2([],c.sub([],c.add([],u,_),l),2));l[0]=d[0],l[1]=d[1]}return l}}function $a(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Cu{constructor(r,l){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Pl(r),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ra,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),c.bindAll(["handleEvent","handleWindowEvent"],this);const _=this._el;this._listeners=[[_,"touchstart",{passive:!0}],[_,"touchmove",{passive:!1}],[_,"touchend",void 0],[_,"touchcancel",void 0],[_,"mousedown",void 0],[_,"mousemove",void 0],[_,"mouseup",void 0],[c.window.document,"mousemove",{capture:!0}],[c.window.document,"mouseup",void 0],[_,"mouseover",void 0],[_,"mouseout",void 0],[_,"dblclick",void 0],[_,"click",void 0],[_,"keydown",{capture:!1}],[_,"keyup",void 0],[_,"wheel",{passive:!1}],[_,"contextmenu",void 0],[c.window,"blur",void 0]];for(const[u,d,f]of this._listeners)u.addEventListener(d,u===c.window.document?this.handleWindowEvent:this.handleEvent,f)}destroy(){for(const[r,l,_]of this._listeners)r.removeEventListener(l,r===c.window.document?this.handleWindowEvent:this.handleEvent,_)}_addDefaultHandlers(r){const l=this._map,_=l.getCanvasContainer();this._add("mapEvent",new sc(l,r));const u=l.boxZoom=new kl(l,r);this._add("boxZoom",u);const d=new Tc,f=new ko;l.doubleClickZoom=new nl(f,d),this._add("tapZoom",d),this._add("clickZoom",f);const v=new xa;this._add("tapDragZoom",v);const b=l.touchPitch=new ns(l);this._add("touchPitch",b);const C=new Ll(r),S=new gl(r);l.dragRotate=new yn(r,C,S),this._add("mouseRotate",C,["mousePitch"]),this._add("mousePitch",S,["mouseRotate"]);const z=new Tu(r),H=new _l(l,r);l.dragPan=new wa(_,z,H),this._add("mousePan",z),this._add("touchPan",H,["touchZoom","touchRotate"]);const ee=new Fl,re=new ts;l.touchZoomRotate=new Cc(_,re,ee,v),this._add("touchRotate",ee,["touchPan","touchZoom"]),this._add("touchZoom",re,["touchPan","touchRotate"]),this._add("blockableMapEvent",new tl(l));const ue=l.scrollZoom=new Js(l,this);this._add("scrollZoom",ue,["mousePan"]);const fe=l.keyboard=new vl;this._add("keyboard",fe);for(const ne of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[ne]&&l[ne].enable(r[ne])}_add(r,l,_){this._handlers.push({handlerName:r,handler:l,allowed:_}),this._handlersById[r]=l}stop(r){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Cs(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,l,_){for(const u in r)if(u!==_&&(!l||l.indexOf(u)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const l=[];for(const _ of r)this._el.contains(_.target)&&l.push(_);return l}handleEvent(r,l){this._updatingCamera=!0;const _="renderFrame"===r.type,u=_?void 0:r,d={needsRenderFrame:!1},f={},v={},b=r.touches?this._getMapTouches(r.touches):void 0,C=b?yr(this._el,b):_?void 0:dt(this._el,r);for(const{handlerName:H,handler:ee,allowed:re}of this._handlers){if(!ee.isEnabled())continue;let ue;this._blockedByActive(v,re,H)?ee.reset():ee[l||r.type]&&(ue=ee[l||r.type](r,C,b),this.mergeHandlerResult(d,f,ue,H,u),ue&&ue.needsRenderFrame&&this._triggerRenderFrame()),(ue||ee.isActive())&&(v[H]=ee)}const S={};for(const H in this._previousActiveHandlers)v[H]||(S[H]=u);this._previousActiveHandlers=v,(Object.keys(S).length||$a(d))&&(this._changes.push([d,f,S]),this._triggerRenderFrame()),(Object.keys(v).length||$a(d))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:z}=d;z&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],z(this._map))}mergeHandlerResult(r,l,_,u,d){if(!_)return;c.extend(r,_);const f={handlerName:u,originalEvent:_.originalEvent||d};void 0!==_.zoomDelta&&(l.zoom=f),void 0!==_.panDelta&&(l.drag=f),void 0!==_.pitchDelta&&(l.pitch=f),void 0!==_.bearingDelta&&(l.rotate=f)}_applyChanges(){const r={},l={},_={};for(const[u,d,f]of this._changes)u.panDelta&&(r.panDelta=(r.panDelta||new c.pointGeometry(0,0))._add(u.panDelta)),u.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+u.zoomDelta),u.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+u.bearingDelta),u.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+u.pitchDelta),void 0!==u.around&&(r.around=u.around),void 0!==u.aroundCoord&&(r.aroundCoord=u.aroundCoord),void 0!==u.pinchAround&&(r.pinchAround=u.pinchAround),u.noInertia&&(r.noInertia=u.noInertia),c.extend(l,d),c.extend(_,f);this._updateMapTransform(r,l,_),this._changes=[]}_updateMapTransform(r,l,_){const u=this._map,d=u.transform,f=we=>[we.x,we.y,we.z];if((we=>{const xe=this._eventsInProgress.drag;return xe&&!this._handlersById[xe.handlerName].isActive()})()&&!$a(r)){const we=d.zoom;d.cameraElevationReference="sea",d.recenterOnTerrain(),d.cameraElevationReference="ground",we!==d.zoom&&this._map._update(!0)}if(d._isCameraConstrained&&u._stop(!0),!$a(r))return void this._fireEvents(l,_,!0);let{panDelta:v,zoomDelta:b,bearingDelta:C,pitchDelta:S,around:z,aroundCoord:H,pinchAround:ee}=r;d._isCameraConstrained&&(b>0&&(b=0),d._isCameraConstrained=!1),void 0!==ee&&(z=ee),(b||(we=>l.drag&&!this._eventsInProgress.drag)())&&z&&(this._dragOrigin=f(d.pointCoordinate3D(z)),this._trackingEllipsoid.setup(d._camera.position,this._dragOrigin)),d.cameraElevationReference="sea",u._stop(!0),z=z||u.transform.centerPoint,C&&(d.bearing+=C),S&&(d.pitch+=S),d._updateCameraState();const re=[0,0,0];if(v)if("mercator"===d.projection.name){const we=this._trackingEllipsoid.projectRay(d.screenPointToMercatorRay(z).dir),xe=this._trackingEllipsoid.projectRay(d.screenPointToMercatorRay(z.sub(v)).dir);re[0]=xe[0]-we[0],re[1]=xe[1]-we[1]}else{const we=d.pointCoordinate(z);if("globe"===d.projection.name){v=v.rotate(-d.angle);const xe=d._pixelsPerMercatorPixel/d.worldSize;re[0]=-v.x*c.mercatorScale(c.latFromMercatorY(we.y))*xe,re[1]=-v.y*c.mercatorScale(d.center.lat)*xe}else{const xe=d.pointCoordinate(z.sub(v));we&&xe&&(re[0]=xe.x-we.x,re[1]=xe.y-we.y)}}const ue=d.zoom,fe=[0,0,0];if(b){const we=f(H||d.pointCoordinate3D(z)),xe={dir:c.normalize([],c.sub([],we,d._camera.position))};if(xe.dir[2]<0){const be=d.zoomDeltaToMovement(we,b);c.scale$2(fe,xe.dir,be)}}const ne=c.add(re,re,fe);d._translateCameraConstrained(ne),b&&Math.abs(d.zoom-ue)>1e-4&&d.recenterOnTerrain(),d.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(l,_,!0)}_fireEvents(r,l,_){const u=Cs(this._eventsInProgress),d=Cs(r),f={};for(const S in r){const{originalEvent:z}=r[S];this._eventsInProgress[S]||(f[`${S}start`]=z),this._eventsInProgress[S]=r[S]}!u&&d&&this._fireEvent("movestart",d.originalEvent);for(const S in f)this._fireEvent(S,f[S]);d&&this._fireEvent("move",d.originalEvent);for(const S in r){const{originalEvent:z}=r[S];this._fireEvent(S,z)}const v={};let b;for(const S in this._eventsInProgress){const{handlerName:z,originalEvent:H}=this._eventsInProgress[S];this._handlersById[z].isActive()||(delete this._eventsInProgress[S],b=l[z]||H,v[`${S}end`]=b)}for(const S in v)this._fireEvent(S,v[S]);const C=Cs(this._eventsInProgress);if(_&&(u||d)&&!C){this._updatingCamera=!0;const S=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),z=H=>0!==H&&-this._bearingSnap<H&&H<this._bearingSnap;S?(z(S.bearing||this._map.getBearing())&&(S.bearing=0),this._map.easeTo(S,{originalEvent:b})):(this._map.fire(new c.Event("moveend",{originalEvent:b})),z(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,l){this._map.fire(new c.Event(r,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new Qs("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const zl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class rl extends c.Evented{constructor(r,l){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=l.bearingSnap,c.bindAll(["_renderFrameCallback"],this)}getCenter(){return new c.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,l){return this.jumpTo({center:r},l)}panBy(r,l,_){return r=c.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,c.extend({offset:r},l),_)}panTo(r,l,_){return this.easeTo(c.extend({center:r},l),_)}getZoom(){return this.transform.zoom}setZoom(r,l){return this.jumpTo({zoom:r},l),this}zoomTo(r,l,_){return this.easeTo(c.extend({zoom:r},l),_)}zoomIn(r,l){return this.zoomTo(this.getZoom()+1,r,l),this}zoomOut(r,l){return this.zoomTo(this.getZoom()-1,r,l),this}getBearing(){return this.transform.bearing}setBearing(r,l){return this.jumpTo({bearing:r},l),this}getPadding(){return this.transform.padding}setPadding(r,l){return this.jumpTo({padding:r},l),this}rotateTo(r,l,_){return this.easeTo(c.extend({bearing:r},l),_)}resetNorth(r,l){return this.rotateTo(0,c.extend({duration:1e3},r),l),this}resetNorthPitch(r,l){return this.easeTo(c.extend({bearing:0,pitch:0,duration:1e3},r),l),this}snapToNorth(r,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,l):this}getPitch(){return this.transform.pitch}setPitch(r,l){return this.jumpTo({pitch:r},l),this}cameraForBounds(r,l){r=c.LngLatBounds.convert(r);const _=l&&l.bearing||0,u=l&&l.pitch||0,d=r.getNorthWest(),f=r.getSouthEast();return this._cameraForBounds(this.transform,d,f,_,u,l)}_extendCameraOptions(r){const l={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=c.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const _=r.padding;r.padding={top:_,bottom:_,right:_,left:_}}return r.padding=c.extend(l,r.padding),r}_minimumAABBFrustumDistance(r,l){const _=l.max[0]-l.min[0],u=l.max[1]-l.min[1];return _/u>r.aspect?_/(2*Math.tan(.5*r.fovX)*r.aspect):u/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,l,_,u,d,f){const v=r.clone(),b=this._extendCameraOptions(f);v.bearing=u,v.pitch=d;const C=c.LngLat.convert(l),S=c.LngLat.convert(_),z=.5*(C.lat+S.lat),H=.5*(C.lng+S.lng),ee=c.latLngToECEF(z,H),re=c.normalize([],ee),ue=c.normalize([],c.cross([],re,[0,1,0])),fe=c.cross([],ue,re),ne=[ue[0],ue[1],ue[2],0,fe[0],fe[1],fe[2],0,re[0],re[1],re[2],0,0,0,0,1],we=[ee,c.latLngToECEF(C.lat,C.lng),c.latLngToECEF(S.lat,C.lng),c.latLngToECEF(S.lat,S.lng),c.latLngToECEF(C.lat,S.lng),c.latLngToECEF(z,C.lng),c.latLngToECEF(z,S.lng),c.latLngToECEF(C.lat,H),c.latLngToECEF(S.lat,H)];let xe=c.Aabb.fromPoints(we.map(St=>[c.dot(ue,St),c.dot(fe,St),c.dot(re,St)]));const be=c.transformMat4([],xe.center,ne);0===c.squaredLength(be)&&c.set(be,0,0,1),c.normalize(be,be),c.scale$2(be,be,c.GLOBE_RADIUS),v.center=c.ecefToLatLng(be);const Re=v.getWorldToCameraMatrix(),Ae=c.invert(new Float64Array(16),Re);xe=c.Aabb.applyTransform(xe,c.multiply([],Re,ne)),c.transformMat4(be,be,Re);const ze=.5*(xe.max[2]-xe.min[2]),qe=this._minimumAABBFrustumDistance(v,xe),Ke=c.scale$2([],[0,0,1],ze),Qe=c.add(Ke,be,Ke),Ht=qe+(0===v.pitch?0:c.distance(be,Qe)),Ze=v.globeCenterInViewSpace,bt=c.sub([],be,[Ze[0],Ze[1],Ze[2]]);c.normalize(bt,bt),c.scale$2(bt,bt,Ht);const ut=c.add([],be,bt);c.transformMat4(ut,ut,Ae);const Ct=c.earthRadius/c.GLOBE_RADIUS,Ye=c.length(ut),He=c.mercatorZfromAltitude(Math.max(Ye*Ct-c.earthRadius,Number.EPSILON),0),rt=Math.min(v.zoomFromMercatorZAdjusted(He),b.maxZoom);return rt>.5*(c.GLOBE_ZOOM_THRESHOLD_MIN+c.GLOBE_ZOOM_THRESHOLD_MAX)?(v.setProjection({name:"mercator"}),v.zoom=rt,this._cameraForBounds(v,l,_,u,d,f)):{center:v.center,zoom:rt,bearing:u,pitch:d}}queryTerrainElevation(r,l){const _=this.transform.elevation;return _?(l=c.extend({},{exaggerated:!0},l),_.getAtPoint(c.MercatorCoordinate.fromLngLat(r),null,l.exaggerated)):null}_cameraForBounds(r,l,_,u,d,f){if("globe"===r.projection.name)return this._cameraForBoundsOnGlobe(r,l,_,u,d,f);const v=r.clone(),b=this._extendCameraOptions(f),C=v.padding;v.bearing=u,v.pitch=d;const S=c.LngLat.convert(l),z=c.LngLat.convert(_),H=new c.LngLat(S.lng,z.lat),ee=new c.LngLat(z.lng,S.lat),re=v.project(S),ue=v.project(z),fe=this.queryTerrainElevation(S),ne=this.queryTerrainElevation(z),we=this.queryTerrainElevation(H),xe=this.queryTerrainElevation(ee),be=[[re.x,re.y,Math.min(fe||0,ne||0,we||0,xe||0)],[ue.x,ue.y,Math.max(fe||0,ne||0,we||0,xe||0)]];let Re=c.Aabb.fromPoints(be);const Ae=v.getWorldToCameraMatrix(),ze=c.invert(new Float64Array(16),Ae);Re=c.Aabb.applyTransform(Re,Ae);const qe=c.sub([],Re.max,Re.min),Ke=C.left||0,Qe=C.right||0,Ht=C.bottom||0,Ze=C.top||0,{left:bt,right:ut,top:Ct,bottom:Ye}=b.padding,He=.5*(Ke+Qe),rt=.5*(Ze+Ht),St=Math.min(v.scaleZoom(v.scale*Math.min((v.width-(Ke+Qe+bt+ut))/qe[0],(v.height-(Ht+Ze+Ye+Ct))/qe[1])),b.maxZoom),Nt=v.scale/v.zoomScale(St);Re=new c.Aabb([Re.min[0]-(bt+He)*Nt,Re.min[1]-(Ye+rt)*Nt,Re.min[2]],[Re.max[0]+(ut+He)*Nt,Re.max[1]+(Ct+rt)*Nt,Re.max[2]]);const An=.5*qe[2],_r=this._minimumAABBFrustumDistance(v,Re),wn=[0,0,1,0];c.transformMat4$1(wn,wn,Ae),c.normalize$2(wn,wn);const ln=c.scale$2([],wn,_r+An),Sn=c.add([],Re.center,ln),Mr=("number"==typeof b.offset.x&&"number"==typeof b.offset.y?new c.pointGeometry(b.offset.x,b.offset.y):c.pointGeometry.convert(b.offset)).rotate(-c.degToRad(u));Re.center[0]-=Mr.x*Nt,Re.center[1]+=Mr.y*Nt,c.transformMat4(Re.center,Re.center,ze),c.transformMat4(Sn,Sn,ze);const Fn=[Re.center[0],Re.center[1],Sn[2]*v.pixelsPerMeter];c.scale$2(Fn,Fn,1/v.worldSize);const ei=c.lngFromMercatorX(Fn[0]),ci=c.latFromMercatorY(Fn[1]),bi=Math.min(v._zoomFromMercatorZ(Fn[2]),b.maxZoom),Si=new c.LngLat(ei,ci);return v.mercatorFromTransition&&bi<.5*(c.GLOBE_ZOOM_THRESHOLD_MIN+c.GLOBE_ZOOM_THRESHOLD_MAX)?(v.setProjection({name:"globe"}),v.zoom=bi,this._cameraForBounds(v,l,_,u,d,f)):{center:Si,zoom:bi,bearing:u,pitch:d}}fitBounds(r,l,_){const u=this.cameraForBounds(r,l);return this._fitInternal(u,l,_)}fitScreenCoordinates(r,l,_,u,d){const f=c.pointGeometry.convert(r),v=c.pointGeometry.convert(l),b=new c.pointGeometry(Math.min(f.x,v.x),Math.min(f.y,v.y)),C=new c.pointGeometry(Math.max(f.x,v.x),Math.max(f.y,v.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(f,v))return this;const S=this.transform.pointLocation3D(b),z=this.transform.pointLocation3D(C),H=this.transform.pointLocation3D(new c.pointGeometry(b.x,C.y)),ee=this.transform.pointLocation3D(new c.pointGeometry(C.x,b.y)),re=[Math.min(S.lng,z.lng,H.lng,ee.lng),Math.min(S.lat,z.lat,H.lat,ee.lat)],ue=[Math.max(S.lng,z.lng,H.lng,ee.lng),Math.max(S.lat,z.lat,H.lat,ee.lat)],fe=u&&u.pitch?u.pitch:this.getPitch(),ne=this._cameraForBounds(this.transform,re,ue,_,fe,u);return this._fitInternal(ne,u,d)}_fitInternal(r,l,_){return r?(delete(l=c.extend(r,l)).padding,l.linear?this.easeTo(l,_):this.flyTo(l,_)):this}jumpTo(r,l){this.stop();const _=r.preloadOnly?this.transform.clone():this.transform;let u=!1,d=!1,f=!1;return"zoom"in r&&_.zoom!==+r.zoom&&(u=!0,_.zoom=+r.zoom),void 0!==r.center&&(_.center=c.LngLat.convert(r.center)),"bearing"in r&&_.bearing!==+r.bearing&&(d=!0,_.bearing=+r.bearing),"pitch"in r&&_.pitch!==+r.pitch&&(f=!0,_.pitch=+r.pitch),null==r.padding||_.isPaddingEqual(r.padding)||(_.padding=r.padding),r.preloadOnly?(this._preloadTiles(_),this):(this.fire(new c.Event("movestart",l)).fire(new c.Event("move",l)),u&&this.fire(new c.Event("zoomstart",l)).fire(new c.Event("zoom",l)).fire(new c.Event("zoomend",l)),d&&this.fire(new c.Event("rotatestart",l)).fire(new c.Event("rotate",l)).fire(new c.Event("rotateend",l)),f&&this.fire(new c.Event("pitchstart",l)).fire(new c.Event("pitch",l)).fire(new c.Event("pitchend",l)),this.fire(new c.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||c.warnOnce(zl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,l){const _=this.transform;if(!_.projection.supportsFreeCamera)return c.warnOnce(zl),this;this.stop();const u=_.zoom,d=_.pitch,f=_.bearing;_.setFreeCameraOptions(r);const v=u!==_.zoom,b=d!==_.pitch,C=f!==_.bearing;return this.fire(new c.Event("movestart",l)).fire(new c.Event("move",l)),v&&this.fire(new c.Event("zoomstart",l)).fire(new c.Event("zoom",l)).fire(new c.Event("zoomend",l)),C&&this.fire(new c.Event("rotatestart",l)).fire(new c.Event("rotate",l)).fire(new c.Event("rotateend",l)),b&&this.fire(new c.Event("pitchstart",l)).fire(new c.Event("pitch",l)).fire(new c.Event("pitchend",l)),this.fire(new c.Event("moveend",l)),this}easeTo(r,l){this._stop(!1,r.easeId),(!1===(r=c.extend({offset:[0,0],duration:500,easing:c.ease},r)).animate||!r.essential&&c.exported.prefersReducedMotion)&&(r.duration=0);const _=this.transform,u=this.getZoom(),d=this.getBearing(),f=this.getPitch(),v=this.getPadding(),b="zoom"in r?+r.zoom:u,C="bearing"in r?this._normalizeBearing(r.bearing,d):d,S="pitch"in r?+r.pitch:f,z="padding"in r?r.padding:_.padding,H=c.pointGeometry.convert(r.offset);let ee,re,ue;if("globe"===_.projection.name){const Ke=c.MercatorCoordinate.fromLngLat(_.center),Qe=H.rotate(-_.angle);Ke.x+=Qe.x/_.worldSize,Ke.y+=Qe.y/_.worldSize;const Ht=Ke.toLngLat(),Ze=c.LngLat.convert(r.center||Ht);this._normalizeCenter(Ze),ee=_.centerPoint.add(Qe),re=new c.pointGeometry(Ke.x,Ke.y).mult(_.worldSize),ue=new c.pointGeometry(c.mercatorXfromLng(Ze.lng),c.mercatorYfromLat(Ze.lat)).mult(_.worldSize).sub(re)}else{ee=_.centerPoint.add(H);const Ke=_.pointLocation(ee),Qe=c.LngLat.convert(r.center||Ke);this._normalizeCenter(Qe),re=_.project(Ke),ue=_.project(Qe).sub(re)}const fe=_.zoomScale(b-u);let ne,we;r.around&&(ne=c.LngLat.convert(r.around),we=_.locationPoint(ne));const xe=this._zooming||b!==u,be=this._rotating||d!==C,Re=this._pitching||S!==f,Ae=!_.isPaddingEqual(z),ze=Ke=>Qe=>{if(xe&&(Ke.zoom=c.number(u,b,Qe)),be&&(Ke.bearing=c.number(d,C,Qe)),Re&&(Ke.pitch=c.number(f,S,Qe)),Ae&&(Ke.interpolatePadding(v,z,Qe),ee=Ke.centerPoint.add(H)),ne)Ke.setLocationAtPoint(ne,we);else{const Ht=Ke.zoomScale(Ke.zoom-u),Ze=b>u?Math.min(2,fe):Math.max(.5,fe),bt=Math.pow(Ze,1-Qe),ut=Ke.unproject(re.add(ue.mult(Qe*bt)).mult(Ht));Ke.setLocationAtPoint(Ke.renderWorldCopies?ut.wrap():ut,ee)}return r.preloadOnly||this._fireMoveEvents(l),Ke};if(r.preloadOnly){const Ke=this._emulate(ze,r.duration,_);return this._preloadTiles(Ke),this}const qe={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=xe,this._rotating=be,this._pitching=Re,this._padding=Ae,this._easeId=r.easeId,this._prepareEase(l,r.noMoveStart,qe),this._ease(ze(_),Ke=>{_.recenterOnTerrain(),this._afterEase(l,Ke)},r),this}_prepareEase(r,l,_={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||_.moving||this.fire(new c.Event("movestart",r)),this._zooming&&!_.zooming&&this.fire(new c.Event("zoomstart",r)),this._rotating&&!_.rotating&&this.fire(new c.Event("rotatestart",r)),this._pitching&&!_.pitching&&this.fire(new c.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new c.Event("move",r)),this._zooming&&this.fire(new c.Event("zoom",r)),this._rotating&&this.fire(new c.Event("rotate",r)),this._pitching&&this.fire(new c.Event("pitch",r))}_afterEase(r,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const _=this._zooming,u=this._rotating,d=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,_&&this.fire(new c.Event("zoomend",r)),u&&this.fire(new c.Event("rotateend",r)),d&&this.fire(new c.Event("pitchend",r)),this.fire(new c.Event("moveend",r))}flyTo(r,l){if(!r.essential&&c.exported.prefersReducedMotion){const St=c.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(St,l)}this.stop(),r=c.extend({offset:[0,0],speed:1.2,curve:1.42,easing:c.ease},r);const _=this.transform,u=this.getZoom(),d=this.getBearing(),f=this.getPitch(),v=this.getPadding(),b="zoom"in r?c.clamp(+r.zoom,_.minZoom,_.maxZoom):u,C="bearing"in r?this._normalizeBearing(r.bearing,d):d,S="pitch"in r?+r.pitch:f,z="padding"in r?r.padding:_.padding,H=_.zoomScale(b-u),ee=c.pointGeometry.convert(r.offset);let re=_.centerPoint.add(ee);const ue=_.pointLocation(re),fe=c.LngLat.convert(r.center||ue);this._normalizeCenter(fe);const ne=_.project(ue),we=_.project(fe).sub(ne);let xe=r.curve;const be=Math.max(_.width,_.height),Re=be/H,Ae=we.mag();if("minZoom"in r){const St=c.clamp(Math.min(r.minZoom,u,b),_.minZoom,_.maxZoom),Nt=be/_.zoomScale(St-u);xe=Math.sqrt(Nt/Ae*2)}const ze=xe*xe;function qe(St){const Nt=(Re*Re-be*be+(St?-1:1)*ze*ze*Ae*Ae)/(2*(St?Re:be)*ze*Ae);return Math.log(Math.sqrt(Nt*Nt+1)-Nt)}function Ke(St){return(Math.exp(St)-Math.exp(-St))/2}function Qe(St){return(Math.exp(St)+Math.exp(-St))/2}const Ht=qe(0);let Ze=function(St){return Qe(Ht)/Qe(Ht+xe*St)},bt=function(St){return be*((Qe(Ht)*(Ke(Nt=Ht+xe*St)/Qe(Nt))-Ke(Ht))/ze)/Ae;var Nt},ut=(qe(1)-Ht)/xe;if(Math.abs(Ae)<1e-6||!isFinite(ut)){if(Math.abs(be-Re)<1e-6)return this.easeTo(r,l);const St=Re<be?-1:1;ut=Math.abs(Math.log(Re/be))/xe,bt=function(){return 0},Ze=function(Nt){return Math.exp(St*xe*Nt)}}r.duration="duration"in r?+r.duration:1e3*ut/("screenSpeed"in r?+r.screenSpeed/xe:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const Ct=d!==C,Ye=S!==f,He=!_.isPaddingEqual(z),rt=St=>Nt=>{const An=Nt*ut,_r=1/Ze(An);St.zoom=1===Nt?b:u+St.scaleZoom(_r),Ct&&(St.bearing=c.number(d,C,Nt)),Ye&&(St.pitch=c.number(f,S,Nt)),He&&(St.interpolatePadding(v,z,Nt),re=St.centerPoint.add(ee));const wn=1===Nt?fe:St.unproject(ne.add(we.mult(bt(An))).mult(_r));return St.setLocationAtPoint(St.renderWorldCopies?wn.wrap():wn,re),St._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(l),St};if(r.preloadOnly){const St=this._emulate(rt,r.duration,_);return this._preloadTiles(St),this}return this._zooming=!0,this._rotating=Ct,this._pitching=Ye,this._padding=He,this._prepareEase(l,!1),this._ease(rt(_),()=>this._afterEase(l),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const _=this._onEaseEnd;this._onEaseEnd=void 0,_.call(this,l)}if(!r){const _=this.handlers;_&&_.stop(!1)}return this}_ease(r,l,_){!1===_.animate||0===_.duration?(r(1),l()):(this._easeStart=c.exported.now(),this._easeOptions=_,this._onEaseFrame=r,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((c.exported.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,l){r=c.wrap(r,-180,180);const _=Math.abs(r-l);return Math.abs(r-360-l)<_&&(r-=360),Math.abs(r+360-l)<_&&(r+=360),r}_normalizeCenter(r){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const _=r.lng-l.center.lng;r.lng+=_>180?-360:_<-180?360:0}_emulate(r,l,_){const u=Math.ceil(15*l/1e3),d=[],f=r(_.clone());for(let v=0;v<=u;v++){const b=f(v/u);d.push(b.clone())}return d}}class Sc{constructor(r={}){this.options=r,c.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const l=this.options&&this.options.compact;return this._map=r,this._container=wt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=wt("button","mapboxgl-ctrl-attrib-button",this._container),wt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=wt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===l&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,l){const _=this._map._getUIString(`AttributionControl.${l}`);r.setAttribute("aria-label",_),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",_)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||c.config.ACCESS_TOKEN}];if(r){const _=l.reduce((u,d,f)=>(d.value&&(u+=`${d.key}=${d.value}${f<l.length-1?"&":""}`),u),"?");r.href=`${c.config.FEEDBACK_URL}/${_}#${Ci(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||"metadata"!==r.sourceDataType&&"visibility"!==r.sourceDataType&&"style"!==r.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const u=this._map.style.stylesheet;this.styleOwner=u.owner,this.styleId=u.id}const l=this._map.style._sourceCaches;for(const u in l){const d=l[u];if(d.used){const f=d.getSource();f.attribution&&r.indexOf(f.attribution)<0&&r.push(f.attribution)}}r.sort((u,d)=>u.length-d.length),r=r.filter((u,d)=>{for(let f=d+1;f<r.length;f++)if(r[f].indexOf(u)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const _=r.join(" | ");_!==this._attribHTML&&(this._attribHTML=_,r.length?(this._innerContainer.innerHTML=_,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Hc{constructor(){c.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=wt("div","mapboxgl-ctrl");const l=wt("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&"metadata"!==r.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(0===Object.entries(r).length)return!0;for(const l in r){const _=r[l].getSource();if(_.hasOwnProperty("mapbox_logo")&&!_.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const l=r[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class li{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const l=++this._id;return this._queue.push({callback:r,id:l,cancelled:!1}),l}remove(r){const l=this._currentlyRunning,_=l?this._queue.concat(l):this._queue;for(const u of _)if(u.id===r)return void(u.cancelled=!0)}run(r=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const _ of l)if(!_.cancelled&&(_.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function qc(p,r,l){if(p=new c.LngLat(p.lng,p.lat),r){const _=new c.LngLat(p.lng-360,p.lat),u=new c.LngLat(p.lng+360,p.lat),d=360*Math.ceil(Math.abs(p.lng-l.center.lng)/360),f=l.locationPoint(p).distSqr(r),v=r.x<0||r.y<0||r.x>l.width||r.y>l.height;l.locationPoint(_).distSqr(r)<f&&(v||Math.abs(_.lng-l.center.lng)<d)?p=_:l.locationPoint(u).distSqr(r)<f&&(v||Math.abs(u.lng-l.center.lng)<d)&&(p=u)}for(;Math.abs(p.lng-l.center.lng)>180;){const _=l.locationPoint(p);if(_.x>=0&&_.y>=0&&_.x<=l.width&&_.y<=l.height)break;p.lng>l.center.lng?p.lng-=360:p.lng+=360}return p}const Bl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Wc extends c.Evented{constructor(r,l){if(super(),(r instanceof c.window.HTMLElement||l)&&(r=c.extend({element:r},l)),c.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=c.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=wt("div");const u=41,d=27,f=Et("svg",{display:"block",height:u*this._scale+"px",width:d*this._scale+"px",viewBox:`0 0 ${d} ${u}`},this._element),v=Et("radialGradient",{id:"shadowGradient"},Et("defs",{},f));Et("stop",{offset:"10%","stop-opacity":.4},v),Et("stop",{offset:"100%","stop-opacity":.05},v),Et("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},f),Et("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},f),Et("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},f),Et("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},f),this._offset=c.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",u=>{u.preventDefault()}),this._element.addEventListener("mousedown",u=>{u.preventDefault()});const _=this._element.classList;for(const u in Bl)_.remove(`mapboxgl-marker-anchor-${u}`);_.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=c.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const u=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[u,-1*(24.6+u)],"bottom-right":[-u,-1*(24.6+u)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const l=r.code,_=r.charCode||r.keyCode;"Space"!==l&&"Enter"!==l&&32!==_&&13!==_||this.togglePopup()}_onMapClick(r){const l=r.originalEvent.target,_=this._element;this._popup&&(l===_||_.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,l=this._pos;if(!r||!l)return!1;const _=r.unproject(l),u=r.getFreeCameraOptions();if(!u.position)return!1;const d=u.position.toLngLat();return d.distanceTo(_)<.9*d.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const l=this._pos;if(!l||l.x<0||l.x>r.transform.width||l.y<0||l.y>r.transform.height)return void this._clearFadeTimer();const _=r.unproject(l);let u;r._showingGlobe()&&c.isLngLatBehindGlobe(r.transform,this._lngLat)?u=0:(u=1-r._queryFogOpacity(_),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(u*=this._occludedOpacity)),this._element.style.opacity=`${u}`,this._element.style.pointerEvents=u>0?"auto":"none",this._popup&&this._popup._setOpacity(u),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${r.x}px,${r.y}px)\n            ${Bl[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${l.x}px,${l.y}px)\n        `}_calculateXYTransform(){const r=this._pos,l=this._map,_=this.getPitchAlignment();if(!l||!r||"map"!==_)return"";if(!l._showingGlobe()){const b=l.getPitch();return b?`rotateX(${b}deg)`:""}const u=c.radToDeg(c.globeTiltAtLngLat(l.transform,this._lngLat)),d=r.sub(c.globeCenterToScreenPoint(l.transform)),f=Math.abs(d.x)+Math.abs(d.y);if(0===f)return"";const v=u/f;return`rotateX(${-d.y*v}deg) rotateY(${d.x*v}deg)`}_calculateZTransform(){const r=this._pos,l=this._map;if(!l||!r)return"";let _=0;const u=this.getRotationAlignment();if("map"===u)if(l._showingGlobe()){const d=l.project(new c.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),f=l.project(new c.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(d);_=c.radToDeg(Math.atan2(f.y,f.x))-90}else _=-l.getBearing();else if("horizon"===u){const d=c.smoothstep(4,6,l.getZoom()),f=c.globeCenterToScreenPoint(l.transform);f.y+=d*l.transform.height;const v=r.sub(f),b=c.radToDeg(Math.atan2(v.y,v.x));_=(b>90?b-270:b+90)*(1-d)}return _+=this._rotation,_?`rotateZ(${_}deg)`:""}_update(r){c.window.cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=qc(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),!0===r?this._updateFrameId=c.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=c.pointGeometry.convert(r),this._update(),this}_onMove(r){const l=this._map;if(!l)return;const _=this._pointerdownPos,u=this._positionDelta;if(_&&u){if(!this._isDragging){const d=this._clickTolerance||l._clickTolerance;if(r.point.dist(_)<d)return;this._isDragging=!0}this._pos=r.point.sub(u),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new c.Event("dragstart"))),this.fire(new c.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new c.Event("dragend")),this._state="inactive"}_addDragHandler(r){const l=this._map,_=this._pos;l&&_&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(_),this._pointerdownPos=r.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const l=this._map;return l&&(r?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ed={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},td=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function oh(p=new c.pointGeometry(0,0),r="bottom"){if("number"==typeof p){const l=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(r){case"top":return new c.pointGeometry(0,p);case"top-left":return new c.pointGeometry(l,l);case"top-right":return new c.pointGeometry(-l,l);case"bottom":return new c.pointGeometry(0,-p);case"bottom-left":return new c.pointGeometry(l,-l);case"bottom-right":return new c.pointGeometry(-l,-l);case"left":return new c.pointGeometry(p,0);case"right":return new c.pointGeometry(-p,0)}return new c.pointGeometry(0,0)}return p instanceof c.pointGeometry||Array.isArray(p)?c.pointGeometry.convert(p):c.pointGeometry.convert(p[r]||[0,0])}class cc{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const l=c.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,l,_){this._start=this.getValue(l),this._end=r,this._startTime=l,this._endTime=l+_}}const uc={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Su={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Mu={showCompass:!0,showZoom:!0,visualizePitch:!1};class go{constructor(r,l,_=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Ll({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,_&&(this.mousePitch=new gl({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),c.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(r,l){this.mouseRotate.mousedown(r,l),this.mousePitch&&this.mousePitch.mousedown(r,l),Ut()}move(r,l){const _=this.map,u=this.mouseRotate.mousemoveWindow(r,l),d=u&&u.bearingDelta;if(d&&_.setBearing(_.getBearing()+d),this.mousePitch){const f=this.mousePitch.mousemoveWindow(r,l),v=f&&f.pitchDelta;v&&_.setPitch(_.getPitch()+v)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){cn(),c.window.removeEventListener("mousemove",this.mousemove),c.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(c.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),dt(this.element,r)),c.window.addEventListener("mousemove",this.mousemove),c.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,dt(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){1!==r.targetTouches.length?this.reset():(this._startPos=this._lastPos=yr(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){1!==r.targetTouches.length?this.reset():(this._lastPos=yr(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){0===r.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Mc={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},Nl={maxWidth:100,unit:"metric"};function Iu(p,r,l){const _=_s(r),u=_/r,d={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[l];this._map._requestDomTask(()=>{this._container.style.width=p*u+"px",this._container.innerHTML=`${_}&nbsp;${d}`})}function _s(p){const r=Math.pow(10,`${Math.floor(p)}`.length-1);let l=p/r;return l=l>=10?10:l>=5?5:l>=3?3:l>=2?2:l>=1?1:function(_){const u=Math.pow(10,Math.ceil(-Math.log(_)/Math.LN10));return Math.round(_*u)/u}(l),r*l}const ba={version:c.version,supported:en,setRTLTextPlugin:c.setRTLTextPlugin,getRTLTextPluginStatus:c.getRTLTextPluginStatus,Map:class extends rl{constructor(p){if(c.LivePerformanceUtils.mark(c.PerformanceMarkers.create),null!=(p=c.extend({},Su,p)).minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&c.isSafariWithAntialiasingBug(c.window)&&(p.antialias=!1,c.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new _t(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._useWebGL2=p.useWebGL2,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new li,this._domRenderTaskQueue=new li,this._controls=[],this._markers=[],this._popups=[],this._mapId=c.uniqueId(),this._locale=c.extend({},uc,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new cc(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new c.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,"string"==typeof p.container){if(this._container=c.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof c.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&c.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),c.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==c.window&&(c.window.addEventListener("online",this._onWindowOnline,!1),c.window.addEventListener("resize",this._onWindowResize,!1),c.window.addEventListener("orientationchange",this._onWindowResize,!1),c.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),c.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Cu(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new qo("string"==typeof p.hash&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,c.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new Sc({customAttribution:p.customAttribution})),this._logoControl=new Hc,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update("style"===r.dataType),this.fire(new c.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new c.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(p,r){if(void 0===r&&(r=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=p.onAdd(this);this._controls.push(p);const _=this._controlPositions[r];return-1!==r.indexOf("bottom")?_.insertBefore(l,_.firstChild):_.appendChild(l),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(p);return r>-1&&this._controls.splice(r,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new c.Event("movestart",p)).fire(new c.Event("move",p)),this.fire(new c.Event("resize",p)),r&&this.fire(new c.Event("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(c.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return"auto"===p?c.window.navigator.language:Array.isArray(p)?0===p.length?void 0:p.map(r=>"auto"===r?c.window.navigator.language:r):p}setLanguage(p){const r=this._parseLanguage(p);if(!this.style||r===this._language)return this;this._language=r,this.style._reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(p){return this._lazyInitEmptyStyle(),p?"string"==typeof p&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const p=this.transform,r=p.projection.name;let l;"globe"===r&&p.zoom>=c.GLOBE_ZOOM_THRESHOLD_MAX?(p.setMercatorFromTransition(),l=!0):"mercator"===r&&p.zoom<c.GLOBE_ZOOM_THRESHOLD_MAX&&(p.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(p,r){return this._updateProjection(p||r||{name:"mercator"})}_updateProjection(p){let r;if(r="globe"===p.name&&this.transform.zoom>=c.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const l in this.style._sourceCaches)this.style._sourceCaches[l].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(p){return this.transform.locationPoint3D(c.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(c.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,r,l){if("mouseenter"===p||"mouseover"===p){let _=!1;const u=f=>{const v=r.filter(C=>this.getLayer(C)),b=v.length?this.queryRenderedFeatures(f.point,{layers:v}):[];b.length?_||(_=!0,l.call(this,new Eo(p,this,f.originalEvent,{features:b}))):_=!1},d=()=>{_=!1};return{layers:new Set(r),listener:l,delegates:{mousemove:u,mouseout:d}}}if("mouseleave"===p||"mouseout"===p){let _=!1;const u=f=>{const v=r.filter(b=>this.getLayer(b));(v.length?this.queryRenderedFeatures(f.point,{layers:v}):[]).length?_=!0:_&&(_=!1,l.call(this,new Eo(p,this,f.originalEvent)))},d=f=>{_&&(_=!1,l.call(this,new Eo(p,this,f.originalEvent)))};return{layers:new Set(r),listener:l,delegates:{mousemove:u,mouseout:d}}}{const _=u=>{const d=r.filter(v=>this.getLayer(v)),f=d.length?this.queryRenderedFeatures(u.point,{layers:d}):[];f.length&&(u.features=f,l.call(this,u),delete u.features)};return{layers:new Set(r),listener:l,delegates:{[p]:_}}}}on(p,r,l){if(void 0===l)return super.on(p,r);Array.isArray(r)||(r=[r]);const _=this._createDelegatedListener(p,r,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(_);for(const u in _.delegates)this.on(u,_.delegates[u]);return this}once(p,r,l){if(void 0===l)return super.once(p,r);Array.isArray(r)||(r=[r]);const _=this._createDelegatedListener(p,r,l);for(const u in _.delegates)this.once(u,_.delegates[u]);return this}off(p,r,l){if(void 0===l)return super.off(p,r);r=new Set(Array.isArray(r)?r:[r]);const _=(d,f)=>{if(d.size!==f.size)return!1;for(const v of d)if(!f.has(v))return!1;return!0},u=this._delegatedListeners?this._delegatedListeners[p]:void 0;return u&&(d=>{for(let f=0;f<d.length;f++){const v=d[f];if(v.listener===l&&_(v.layers,r)){for(const b in v.delegates)this.off(b,v.delegates[b]);return d.splice(f,1),this}}})(u),this}queryRenderedFeatures(p,r){return this.style?(void 0!==r||void 0===p||p instanceof c.pointGeometry||Array.isArray(p)||(r=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(p,r){return this.style.querySourceFeatures(p,r)}setStyle(p,r){return!1!==(r=c.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(p,r))}_getUIString(p){const r=this._locale[p];if(null==r)throw new Error(`Missing UI string '${p}'`);return r}_updateStyle(p,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new Mo(this,r||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof p?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Mo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,r){if("string"==typeof p){const l=this._requestManager.normalizeStyleURL(p),_=this._requestManager.transformRequest(l,c.ResourceType.Style);c.getJSON(_,(u,d)=>{u?this.fire(new c.ErrorEvent(u)):d&&this._updateDiff(d,r)})}else"object"==typeof p&&this._updateDiff(p,r)}_updateDiff(p,r){try{this.style.setState(p)&&this._update(!0)}catch(l){c.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(p,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(c.warnOnce("There is no style added to the map."),!1)}addSource(p,r){return this._lazyInitEmptyStyle(),this.style.addSource(p,r),this._update(!0)}isSourceLoaded(p){return!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const r in p){const l=p[r]._tiles;for(const _ in l){const u=l[_];if("loaded"!==u.state&&"errored"!==u.state)return!1}}return!0}addSourceType(p,r,l){this._lazyInitEmptyStyle(),this.style.addSourceType(p,r,l)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,r,{pixelRatio:l=1,sdf:_=!1,stretchX:u,stretchY:d,content:f}={}){if(this._lazyInitEmptyStyle(),r instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&r instanceof c.window.ImageBitmap){const{width:v,height:b,data:C}=c.exported.getImageData(r);this.style.addImage(p,{data:new c.RGBAImage({width:v,height:b},C),pixelRatio:l,stretchX:u,stretchY:d,content:f,sdf:_,version:0})}else if(void 0===r.width||void 0===r.height)this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:v,height:b}=r,C=r;this.style.addImage(p,{data:new c.RGBAImage({width:v,height:b},new Uint8Array(C.data)),pixelRatio:l,stretchX:u,stretchY:d,content:f,sdf:_,version:0,userImage:C}),C.onAdd&&C.onAdd(this,p)}}updateImage(p,r){const l=this.style.getImage(p);if(!l)return void this.fire(new c.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const _=r instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&r instanceof c.window.ImageBitmap?c.exported.getImageData(r):r,{width:u,height:d}=_;void 0!==u&&void 0!==d?u===l.data.width&&d===l.data.height?(l.data.replace(_.data,!(r instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&r instanceof c.window.ImageBitmap)),this.style.updateImage(p,l)):this.fire(new c.ErrorEvent(new Error(`The width and height of the updated image (${u}, ${d})\n                must be that same as the previous version of the image\n                (${l.data.width}, ${l.data.height})`))):this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new c.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,r){c.getImage(this._requestManager.transformRequest(p,c.ResourceType.Image),(l,_)=>{r(l,_ instanceof c.window.HTMLImageElement?c.exported.getImageData(_):_)})}listImages(){return this.style.listImages()}addLayer(p,r){return this._lazyInitEmptyStyle(),this.style.addLayer(p,r),this._update(!0)}moveLayer(p,r){return this.style.moveLayer(p,r),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,r,l){return this.style.setLayerZoomRange(p,r,l),this._update(!0)}setFilter(p,r,l={}){return this.style.setFilter(p,r,l),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,r,l,_={}){return this.style.setPaintProperty(p,r,l,_),this._update(!0)}getPaintProperty(p,r){return this.style.getPaintProperty(p,r)}setLayoutProperty(p,r,l,_={}){return this.style.setLayoutProperty(p,r,l,_),this._update(!0)}getLayoutProperty(p,r){return this.style.getLayoutProperty(p,r)}setLight(p,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(c.LngLat.convert(p),this.transform):0}setFeatureState(p,r){return this.style.setFeatureState(p,r),this._update()}removeFeatureState(p,r){return this.style.removeFeatureState(p,r),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let l,_,u,d=this._container;for(;d&&(!_||!u);){const f=c.window.getComputedStyle(d).transform;f&&"none"!==f&&(l=f.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&"0"!==l[0]&&"1"!==l[0]&&(_=l[0]),l[3]&&"0"!==l[3]&&"1"!==l[3]&&(u=l[3])),d=d.parentElement}this._containerWidth=_?Math.abs(p/_):p,this._containerHeight=u?Math.abs(r/u):r}_detectMissingCSS(){"rgb(250, 128, 114)"!==c.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&c.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=wt("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=wt("div","mapboxgl-canvas-container",p);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=wt("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=wt("div","mapboxgl-control-container",p),_=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(u=>{_[u]=wt("div",`mapboxgl-ctrl-${u}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,r){const l=c.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(p),this._canvas.height=l*Math.ceil(r),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${r}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const r=this._markers.indexOf(p);-1!==r&&this._markers.splice(r,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const r=this._popups.indexOf(p);-1!==r&&this._popups.splice(r,1)}_setupPainter(){const p=c.extend({},en.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._useWebGL2&&this._canvas.getContext("webgl2",p),l=r||this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);l?(this._useWebGL2&&!r&&c.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),c.storeAuthState(l,!0),this.painter=new K(l,this.transform,!!r),this.on("data",_=>{"source"===_.dataType&&this.painter.setTileLoadedFlag(!0)}),c.exported$1.testSupport(l)):this.fire(new c.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new c.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let r;const l=this.painter.context.extTimerQuery,_=c.exported.now();if(this.listens("gpu-timing-frame")&&(r=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],c.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],c.window.performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const u=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const v=this.transform.zoom,b=this.transform.pitch,C=c.exported.now(),S=new c.EvaluationParameters(v,{now:C,fadeDuration:u,pitch:b,transition:this.style.getTransition()});this.style.update(S)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let d=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),d=this._updateAverageElevation(_),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):d=this._updateAverageElevation(_),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,u,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:u,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new c.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new c.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const v=c.exported.now()-_;l.endQueryEXT(l.TIME_ELAPSED_EXT,r),setTimeout(()=>{const b=l.getQueryObjectEXT(r,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(r),this.fire(new c.Event("gpu-timing-frame",{cpuTime:v,gpuTime:b})),c.window.performance.mark("frame-gpu",{startTime:_,detail:{gpuTime:b}})},50)}if(this.listens("gpu-timing-layer")){const v=this.painter.collectGpuTimers();setTimeout(()=>{const b=this.painter.queryGpuTimers(v);this.fire(new c.Event("gpu-timing-layer",{layerTimes:b}))},50)}if(this.listens("gpu-timing-deferred-render")){const v=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const b=this.painter.queryGpuTimeDeferredRender(v);this.fire(new c.Event("gpu-timing-deferred-render",{gpuTime:b}))},50)}const f=this._sourcesDirty||this._styleDirty||this._placementDirty||d;if(f||this._repaint)this.triggerRepaint();else{const v=!this.isMoving()&&this.loaded();if(v&&(d=this._updateAverageElevation(_,!0)),d)this.triggerRepaint();else if(this._triggerFrame(!1),v&&(this.fire(new c.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const b=this._calculateSpeedIndex();this.fire(new c.Event("speedindexcompleted",{speedIndex:b})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0,c.LivePerformanceUtils.mark(c.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&c.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const r of this._markers)p&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!p||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(p,r=!1){const l=_=>(this.transform.averageElevation=_,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&l(0);if((r||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const _=this.transform.averageElevation;let u=this.transform.sampleAverageElevation(),d=!1;this.transform.elevation&&(d=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(u)?u=0:this._averageElevationLastSampledAt=p;const f=Math.abs(_-u);if(f>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(u),l(u);this._averageElevation.easeTo(u,p,300)}else if(f>1e-4)return this._averageElevation.jumpTo(u),l(u)}return!!this._averageElevation.isEasing(p)&&l(this._averageElevation.getValue(p))}_authenticate(){c.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===c.AUTH_ERR_MSG||401===p.status)){const r=this.painter.context.gl;c.storeAuthState(r,!1),this._logoControl instanceof Hc&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new c.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),c.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const l=this.painter.context.gl,_=l.createFramebuffer();function u(d){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,d,0);const f=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,f),f}return l.bindFramebuffer(l.FRAMEBUFFER,_),this._canvasPixelComparison(u(p),r.canvasCopies.map(u),r.timeStamps)}_canvasPixelComparison(p,r,l){let _=l[1]-l[0];const u=p.length/4;for(let d=0;d<r.length;d++){const f=r[d];let v=0;for(let b=0;b<f.length;b+=4)f[b]===p[b]&&f[b+1]===p[b+1]&&f[b+2]===p[b+2]&&f[b+3]===p[b+3]&&(v+=1);_+=(l[d+2]-l[d+1])*(1-v/u)}return _}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==c.window&&(c.window.removeEventListener("resize",this._onWindowResize,!1),c.window.removeEventListener("orientationchange",this._onWindowResize,!1),c.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),c.window.removeEventListener("online",this._onWindowOnline,!1),c.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),c.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new c.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=c.exported.frame(r=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(r)}))}_preloadTiles(p){const r=this.style?Object.values(this.style._sourceCaches):[];return c.asyncAll(r,(l,_)=>l._preloadTiles(p,_),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){"hidden"===c.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,p&&this._update())}_setCacheLimits(p,r){c.setCacheLimits(p,r)}get version(){return c.version}},NavigationControl:class{constructor(p){this.options=c.extend({},Mu,p),this._container=wt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(c.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),wt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),wt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(c.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:r}):l.resetNorth({},{originalEvent:r}))}),this._compassIcon=wt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const r=p.getZoom(),l=r===p.getMaxZoom(),_=r===p.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=_,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",_.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new go(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,r){const l=wt("button",p,this._container);return l.type="button",l.addEventListener("click",r),l}_setButtonTitle(p,r){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${r}`);p.setAttribute("aria-label",l),p.firstElementChild&&p.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends c.Evented{constructor(p){super(),this.options=c.extend({geolocation:c.window.navigator.geolocation},Mc,p),c.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=zi(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=wt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const r=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,p(l)};void 0!==this._supportsGeolocation?p(this._supportsGeolocation):void 0!==c.window.navigator.permissions?c.window.navigator.permissions.query({name:"geolocation"}).then(l=>r("denied"!==l.state)).catch(()=>r()):r()}_isOutOfMapMaxBounds(p){const r=this._map.getMaxBounds(),l=p.coords;return!!r&&(l.longitude<r.getWest()||l.longitude>r.getEast()||l.latitude<r.getSouth()||l.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new c.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(p),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("geolocate",p)),this._finish()}}_updateCamera(p){const r=new c.LngLat(p.coords.longitude,p.coords.latitude),l=p.coords.accuracy,_=this._map.getBearing(),u=c.extend({bearing:_},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(l),u,{geolocateSource:!0})}_updateMarker(p){if(p){const r=new c.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,r=c.mercatorZfromAltitude(1,p._center.lat)*p.worldSize,l=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(1===p.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===p.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=wt("button","mapboxgl-ctrl-geolocate",this._container),wt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===p){c.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=wt("div","mapboxgl-user-location"),this._dotElement.appendChild(wt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(wt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Wc({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=wt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Wc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||"ACTIVE_LOCK"!==this._watchState||r.originalEvent&&"resize"===r.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new c.Event("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:!0===p.absolute&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return c.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new c.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{c.window.addEventListener("ondeviceorientationabsolute"in c.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==c.window.DeviceMotionEvent&&"function"==typeof c.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(r=>{"granted"===r&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),c.window.removeEventListener("deviceorientation",this._onDeviceOrientation),c.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Sc,ScaleControl:class{constructor(p){this.options=c.extend({},Nl,p),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=Iu.bind(this)),c.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,r=this._map,l=r._containerHeight/2,_=r._containerWidth/2-p/2,u=r.unproject([_,l]),d=r.unproject([_+p,l]),f=u.distanceTo(d);if("imperial"===this.options.unit){const v=3.2808*f;v>5280?this._setScale(p,v/5280,"mile"):this._setScale(p,v,"foot")}else"nautical"===this.options.unit?this._setScale(p,f/1852,"nautical-mile"):f>=1e3?this._setScale(p,f/1e3,"kilometer"):this._setScale(p,f,"meter")}_setScale(p,r,l){const _=_s(r),u=_/r;this._map._requestDomTask(()=>{this._container.style.width=p*u+"px",this._container.innerHTML="nautical-mile"!==l?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:l}).format(_):`${_}&nbsp;nm`})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=wt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof c.window.HTMLElement?this._container=p.container:c.warnOnce("Full screen control 'container' must be a DOM element.")),c.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in c.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in c.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=wt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",c.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,c.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!c.window.document.fullscreenEnabled&&!c.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=wt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);wt("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),c.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(c.window.document.fullscreenElement||c.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?c.window.document.exitFullscreen?c.window.document.exitFullscreen():c.window.document.webkitCancelFullScreen&&c.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends c.Evented{constructor(p){super(),this.options=c.extend(Object.create(ed),p),c.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new c.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new c.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=c.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(c.window.document.createTextNode(p))}setHTML(p){const r=c.window.document.createDocumentFragment(),l=c.window.document.createElement("body");let _;for(l.innerHTML=p;_=l.firstChild,_;)r.appendChild(_);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=wt("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(p),this.options.closeButton){const l=this._closeButton=wt("button","mapboxgl-popup-close-button",r);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let r;return this._classList.delete(p)?r=!1:(this._classList.add(p),r=!0),this._updateClassList(),r}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const r=this._map,l=this._container,_=this._pos;if(!r||!l||!_)return"bottom";const u=l.offsetWidth,d=l.offsetHeight,f=_.x<u/2,v=_.x>r.transform.width-u/2;if(_.y+p<d)return f?"top-left":v?"top-right":"top";if(_.y>r.transform.height-d){if(f)return"bottom-left";if(v)return"bottom-right"}return f?"left":v?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),p.className=r.join(" ")}_update(p){const r=this._map,l=this._content;if(!r||!this._lngLat&&!this._trackPointer||!l)return;let _=this._container;if(_||(_=this._container=wt("div","mapboxgl-popup",r.getContainer()),this._tip=wt("div","mapboxgl-popup-tip",_),_.appendChild(l)),this.options.maxWidth&&_.style.maxWidth!==this.options.maxWidth&&(_.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=qc(this._lngLat,this._pos,r.transform)),!this._trackPointer||p){const u=this._pos=this._trackPointer&&p?p:r.project(this._lngLat),d=oh(this.options.offset),f=this._anchor=this._getAnchor(d.y),v=oh(this.options.offset,f),b=u.add(v).round();r._requestDomTask(()=>{this._container&&f&&(this._container.style.transform=`${Bl[f]} translate(${b.x}px,${b.y}px)`)})}if(!this._marker&&r._showingGlobe()){const u=c.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(u)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(td);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:Wc,Style:Mo,LngLat:c.LngLat,LngLatBounds:c.LngLatBounds,Point:c.pointGeometry,MercatorCoordinate:c.MercatorCoordinate,FreeCameraOptions:P,Evented:c.Evented,config:c.config,prewarm:function(){mn().acquire(kt)},clearPrewarmedResources:function(){const p=Lt;p&&(p.isPreloaded()&&1===p.numActive()?(p.release(kt),Lt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return c.config.ACCESS_TOKEN},set accessToken(p){c.config.ACCESS_TOKEN=p},get baseApiUrl(){return c.config.API_URL},set baseApiUrl(p){c.config.API_URL=p},get workerCount(){return hn.workerCount},set workerCount(p){hn.workerCount=p},get maxParallelImageRequests(){return c.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){c.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){c.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:c.exported.setNow,restoreNow:c.exported.restoreNow};return ba}),W}()},1135:(or,Gt,De)=>{"use strict";De.d(Gt,{X:()=>ge});var W=De(7579);class ge extends W.x{constructor(c){super(),this._value=c}get value(){return this.getValue()}_subscribe(c){const Le=super._subscribe(c);return!Le.closed&&c.next(this._value),Le}getValue(){const{hasError:c,thrownError:Le,_value:en}=this;if(c)throw Le;return this._throwIfClosed(),en}next(c){super.next(this._value=c)}}},9751:(or,Gt,De)=>{"use strict";De.d(Gt,{y:()=>zt});var W=De(2961),ge=De(727),Ge=De(8822),c=De(9635),Le=De(2416),en=De(576),qt=De(2806);let zt=(()=>{class Zt{constructor(Ut){Ut&&(this._subscribe=Ut)}lift(Ut){const cn=new Zt;return cn.source=this,cn.operator=Ut,cn}subscribe(Ut,cn,In){const Xn=function mt(Zt){return Zt&&Zt instanceof W.Lv||function Et(Zt){return Zt&&(0,en.m)(Zt.next)&&(0,en.m)(Zt.error)&&(0,en.m)(Zt.complete)}(Zt)&&(0,ge.Nn)(Zt)}(Ut)?Ut:new W.Hp(Ut,cn,In);return(0,qt.x)(()=>{const{operator:dt,source:yr}=this;Xn.add(dt?dt.call(Xn,yr):yr?this._subscribe(Xn):this._trySubscribe(Xn))}),Xn}_trySubscribe(Ut){try{return this._subscribe(Ut)}catch(cn){Ut.error(cn)}}forEach(Ut,cn){return new(cn=wt(cn))((In,Xn)=>{const dt=new W.Hp({next:yr=>{try{Ut(yr)}catch(sn){Xn(sn),dt.unsubscribe()}},error:Xn,complete:In});this.subscribe(dt)})}_subscribe(Ut){var cn;return null===(cn=this.source)||void 0===cn?void 0:cn.subscribe(Ut)}[Ge.L](){return this}pipe(...Ut){return(0,c.U)(Ut)(this)}toPromise(Ut){return new(Ut=wt(Ut))((cn,In)=>{let Xn;this.subscribe(dt=>Xn=dt,dt=>In(dt),()=>cn(Xn))})}}return Zt.create=Pn=>new Zt(Pn),Zt})();function wt(Zt){var Pn;return null!==(Pn=Zt??Le.v.Promise)&&void 0!==Pn?Pn:Promise}},7579:(or,Gt,De)=>{"use strict";De.d(Gt,{x:()=>qt});var W=De(9751),ge=De(727);const c=(0,De(3888).d)(wt=>function(){wt(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Le=De(8737),en=De(2806);let qt=(()=>{class wt extends W.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(mt){const Zt=new zt(this,this);return Zt.operator=mt,Zt}_throwIfClosed(){if(this.closed)throw new c}next(mt){(0,en.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const Zt of this.currentObservers)Zt.next(mt)}})}error(mt){(0,en.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=mt;const{observers:Zt}=this;for(;Zt.length;)Zt.shift().error(mt)}})}complete(){(0,en.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:mt}=this;for(;mt.length;)mt.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var mt;return(null===(mt=this.observers)||void 0===mt?void 0:mt.length)>0}_trySubscribe(mt){return this._throwIfClosed(),super._trySubscribe(mt)}_subscribe(mt){return this._throwIfClosed(),this._checkFinalizedStatuses(mt),this._innerSubscribe(mt)}_innerSubscribe(mt){const{hasError:Zt,isStopped:Pn,observers:Ut}=this;return Zt||Pn?ge.Lc:(this.currentObservers=null,Ut.push(mt),new ge.w0(()=>{this.currentObservers=null,(0,Le.P)(Ut,mt)}))}_checkFinalizedStatuses(mt){const{hasError:Zt,thrownError:Pn,isStopped:Ut}=this;Zt?mt.error(Pn):Ut&&mt.complete()}asObservable(){const mt=new W.y;return mt.source=this,mt}}return wt.create=(Et,mt)=>new zt(Et,mt),wt})();class zt extends qt{constructor(Et,mt){super(),this.destination=Et,this.source=mt}next(Et){var mt,Zt;null===(Zt=null===(mt=this.destination)||void 0===mt?void 0:mt.next)||void 0===Zt||Zt.call(mt,Et)}error(Et){var mt,Zt;null===(Zt=null===(mt=this.destination)||void 0===mt?void 0:mt.error)||void 0===Zt||Zt.call(mt,Et)}complete(){var Et,mt;null===(mt=null===(Et=this.destination)||void 0===Et?void 0:Et.complete)||void 0===mt||mt.call(Et)}_subscribe(Et){var mt,Zt;return null!==(Zt=null===(mt=this.source)||void 0===mt?void 0:mt.subscribe(Et))&&void 0!==Zt?Zt:ge.Lc}}},2961:(or,Gt,De)=>{"use strict";De.d(Gt,{Hp:()=>In,Lv:()=>Zt});var W=De(576),ge=De(727),Ge=De(2416),c=De(7849);function Le(){}const en=wt("C",void 0,void 0);function wt(Bt,je,Kt){return{kind:Bt,value:je,error:Kt}}var Et=De(3410),mt=De(2806);class Zt extends ge.w0{constructor(je){super(),this.isStopped=!1,je?(this.destination=je,(0,ge.Nn)(je)&&je.add(this)):this.destination=sn}static create(je,Kt,Hn){return new In(je,Kt,Hn)}next(je){this.isStopped?yr(function zt(Bt){return wt("N",Bt,void 0)}(je),this):this._next(je)}error(je){this.isStopped?yr(function qt(Bt){return wt("E",void 0,Bt)}(je),this):(this.isStopped=!0,this._error(je))}complete(){this.isStopped?yr(en,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(je){this.destination.next(je)}_error(je){try{this.destination.error(je)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const Pn=Function.prototype.bind;function Ut(Bt,je){return Pn.call(Bt,je)}class cn{constructor(je){this.partialObserver=je}next(je){const{partialObserver:Kt}=this;if(Kt.next)try{Kt.next(je)}catch(Hn){Xn(Hn)}}error(je){const{partialObserver:Kt}=this;if(Kt.error)try{Kt.error(je)}catch(Hn){Xn(Hn)}else Xn(je)}complete(){const{partialObserver:je}=this;if(je.complete)try{je.complete()}catch(Kt){Xn(Kt)}}}class In extends Zt{constructor(je,Kt,Hn){let Me;if(super(),(0,W.m)(je)||!je)Me={next:je??void 0,error:Kt??void 0,complete:Hn??void 0};else{let Wt;this&&Ge.v.useDeprecatedNextContext?(Wt=Object.create(je),Wt.unsubscribe=()=>this.unsubscribe(),Me={next:je.next&&Ut(je.next,Wt),error:je.error&&Ut(je.error,Wt),complete:je.complete&&Ut(je.complete,Wt)}):Me=je}this.destination=new cn(Me)}}function Xn(Bt){Ge.v.useDeprecatedSynchronousErrorHandling?(0,mt.O)(Bt):(0,c.h)(Bt)}function yr(Bt,je){const{onStoppedNotification:Kt}=Ge.v;Kt&&Et.z.setTimeout(()=>Kt(Bt,je))}const sn={closed:!0,next:Le,error:function dt(Bt){throw Bt},complete:Le}},727:(or,Gt,De)=>{"use strict";De.d(Gt,{Lc:()=>en,w0:()=>Le,Nn:()=>qt});var W=De(576);const Ge=(0,De(3888).d)(wt=>function(mt){wt(this),this.message=mt?`${mt.length} errors occurred during unsubscription:\n${mt.map((Zt,Pn)=>`${Pn+1}) ${Zt.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=mt});var c=De(8737);class Le{constructor(Et){this.initialTeardown=Et,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let Et;if(!this.closed){this.closed=!0;const{_parentage:mt}=this;if(mt)if(this._parentage=null,Array.isArray(mt))for(const Ut of mt)Ut.remove(this);else mt.remove(this);const{initialTeardown:Zt}=this;if((0,W.m)(Zt))try{Zt()}catch(Ut){Et=Ut instanceof Ge?Ut.errors:[Ut]}const{_finalizers:Pn}=this;if(Pn){this._finalizers=null;for(const Ut of Pn)try{zt(Ut)}catch(cn){Et=Et??[],cn instanceof Ge?Et=[...Et,...cn.errors]:Et.push(cn)}}if(Et)throw new Ge(Et)}}add(Et){var mt;if(Et&&Et!==this)if(this.closed)zt(Et);else{if(Et instanceof Le){if(Et.closed||Et._hasParent(this))return;Et._addParent(this)}(this._finalizers=null!==(mt=this._finalizers)&&void 0!==mt?mt:[]).push(Et)}}_hasParent(Et){const{_parentage:mt}=this;return mt===Et||Array.isArray(mt)&&mt.includes(Et)}_addParent(Et){const{_parentage:mt}=this;this._parentage=Array.isArray(mt)?(mt.push(Et),mt):mt?[mt,Et]:Et}_removeParent(Et){const{_parentage:mt}=this;mt===Et?this._parentage=null:Array.isArray(mt)&&(0,c.P)(mt,Et)}remove(Et){const{_finalizers:mt}=this;mt&&(0,c.P)(mt,Et),Et instanceof Le&&Et._removeParent(this)}}Le.EMPTY=(()=>{const wt=new Le;return wt.closed=!0,wt})();const en=Le.EMPTY;function qt(wt){return wt instanceof Le||wt&&"closed"in wt&&(0,W.m)(wt.remove)&&(0,W.m)(wt.add)&&(0,W.m)(wt.unsubscribe)}function zt(wt){(0,W.m)(wt)?wt():wt.unsubscribe()}},2416:(or,Gt,De)=>{"use strict";De.d(Gt,{v:()=>W});const W={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},515:(or,Gt,De)=>{"use strict";De.d(Gt,{E:()=>ge});const ge=new(De(9751).y)(Le=>Le.complete())},2076:(or,Gt,De)=>{"use strict";De.d(Gt,{D:()=>Hn});var W=De(8421),ge=De(9672),Ge=De(4482),c=De(5403);function Le(Me,Wt=0){return(0,Ge.e)((gt,ft)=>{gt.subscribe((0,c.x)(ft,fn=>(0,ge.f)(ft,Me,()=>ft.next(fn),Wt),()=>(0,ge.f)(ft,Me,()=>ft.complete(),Wt),fn=>(0,ge.f)(ft,Me,()=>ft.error(fn),Wt)))})}function en(Me,Wt=0){return(0,Ge.e)((gt,ft)=>{ft.add(Me.schedule(()=>gt.subscribe(ft),Wt))})}var wt=De(9751),mt=De(2202),Zt=De(576);function Ut(Me,Wt){if(!Me)throw new Error("Iterable cannot be null");return new wt.y(gt=>{(0,ge.f)(gt,Wt,()=>{const ft=Me[Symbol.asyncIterator]();(0,ge.f)(gt,Wt,()=>{ft.next().then(fn=>{fn.done?gt.complete():gt.next(fn.value)})},0,!0)})})}var cn=De(3670),In=De(8239),Xn=De(1144),dt=De(6495),yr=De(2206),sn=De(4532),Bt=De(3260);function Hn(Me,Wt){return Wt?function Kt(Me,Wt){if(null!=Me){if((0,cn.c)(Me))return function qt(Me,Wt){return(0,W.Xf)(Me).pipe(en(Wt),Le(Wt))}(Me,Wt);if((0,Xn.z)(Me))return function Et(Me,Wt){return new wt.y(gt=>{let ft=0;return Wt.schedule(function(){ft===Me.length?gt.complete():(gt.next(Me[ft++]),gt.closed||this.schedule())})})}(Me,Wt);if((0,In.t)(Me))return function zt(Me,Wt){return(0,W.Xf)(Me).pipe(en(Wt),Le(Wt))}(Me,Wt);if((0,yr.D)(Me))return Ut(Me,Wt);if((0,dt.T)(Me))return function Pn(Me,Wt){return new wt.y(gt=>{let ft;return(0,ge.f)(gt,Wt,()=>{ft=Me[mt.h](),(0,ge.f)(gt,Wt,()=>{let fn,vn;try{({value:fn,done:vn}=ft.next())}catch(dn){return void gt.error(dn)}vn?gt.complete():gt.next(fn)},0,!0)}),()=>(0,Zt.m)(ft?.return)&&ft.return()})}(Me,Wt);if((0,Bt.L)(Me))return function je(Me,Wt){return Ut((0,Bt.Q)(Me),Wt)}(Me,Wt)}throw(0,sn.z)(Me)}(Me,Wt):(0,W.Xf)(Me)}},8421:(or,Gt,De)=>{"use strict";De.d(Gt,{Xf:()=>Pn});var W=De(655),ge=De(1144),Ge=De(8239),c=De(9751),Le=De(3670),en=De(2206),qt=De(4532),zt=De(6495),wt=De(3260),Et=De(576),mt=De(7849),Zt=De(8822);function Pn(Bt){if(Bt instanceof c.y)return Bt;if(null!=Bt){if((0,Le.c)(Bt))return function Ut(Bt){return new c.y(je=>{const Kt=Bt[Zt.L]();if((0,Et.m)(Kt.subscribe))return Kt.subscribe(je);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(Bt);if((0,ge.z)(Bt))return function cn(Bt){return new c.y(je=>{for(let Kt=0;Kt<Bt.length&&!je.closed;Kt++)je.next(Bt[Kt]);je.complete()})}(Bt);if((0,Ge.t)(Bt))return function In(Bt){return new c.y(je=>{Bt.then(Kt=>{je.closed||(je.next(Kt),je.complete())},Kt=>je.error(Kt)).then(null,mt.h)})}(Bt);if((0,en.D)(Bt))return dt(Bt);if((0,zt.T)(Bt))return function Xn(Bt){return new c.y(je=>{for(const Kt of Bt)if(je.next(Kt),je.closed)return;je.complete()})}(Bt);if((0,wt.L)(Bt))return function yr(Bt){return dt((0,wt.Q)(Bt))}(Bt)}throw(0,qt.z)(Bt)}function dt(Bt){return new c.y(je=>{(function sn(Bt,je){var Kt,Hn,Me,Wt;return(0,W.mG)(this,void 0,void 0,function*(){try{for(Kt=(0,W.KL)(Bt);!(Hn=yield Kt.next()).done;)if(je.next(Hn.value),je.closed)return}catch(gt){Me={error:gt}}finally{try{Hn&&!Hn.done&&(Wt=Kt.return)&&(yield Wt.call(Kt))}finally{if(Me)throw Me.error}}je.complete()})})(Bt,je).catch(Kt=>je.error(Kt))})}},9646:(or,Gt,De)=>{"use strict";De.d(Gt,{of:()=>Ge});var W=De(7669),ge=De(2076);function Ge(...c){const Le=(0,W.yG)(c);return(0,ge.D)(c,Le)}},5403:(or,Gt,De)=>{"use strict";De.d(Gt,{x:()=>ge});var W=De(2961);function ge(c,Le,en,qt,zt){return new Ge(c,Le,en,qt,zt)}class Ge extends W.Lv{constructor(Le,en,qt,zt,wt,Et){super(Le),this.onFinalize=wt,this.shouldUnsubscribe=Et,this._next=en?function(mt){try{en(mt)}catch(Zt){Le.error(Zt)}}:super._next,this._error=zt?function(mt){try{zt(mt)}catch(Zt){Le.error(Zt)}finally{this.unsubscribe()}}:super._error,this._complete=qt?function(){try{qt()}catch(mt){Le.error(mt)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var Le;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:en}=this;super.unsubscribe(),!en&&(null===(Le=this.onFinalize)||void 0===Le||Le.call(this))}}}},262:(or,Gt,De)=>{"use strict";De.d(Gt,{K:()=>c});var W=De(8421),ge=De(5403),Ge=De(4482);function c(Le){return(0,Ge.e)((en,qt)=>{let Et,zt=null,wt=!1;zt=en.subscribe((0,ge.x)(qt,void 0,void 0,mt=>{Et=(0,W.Xf)(Le(mt,c(Le)(en))),zt?(zt.unsubscribe(),zt=null,Et.subscribe(qt)):wt=!0})),wt&&(zt.unsubscribe(),zt=null,Et.subscribe(qt))})}},4351:(or,Gt,De)=>{"use strict";De.d(Gt,{b:()=>Ge});var W=De(5577),ge=De(576);function Ge(c,Le){return(0,ge.m)(Le)?(0,W.z)(c,Le,1):(0,W.z)(c,1)}},9300:(or,Gt,De)=>{"use strict";De.d(Gt,{h:()=>Ge});var W=De(4482),ge=De(5403);function Ge(c,Le){return(0,W.e)((en,qt)=>{let zt=0;en.subscribe((0,ge.x)(qt,wt=>c.call(Le,wt,zt++)&&qt.next(wt)))})}},4004:(or,Gt,De)=>{"use strict";De.d(Gt,{U:()=>Ge});var W=De(4482),ge=De(5403);function Ge(c,Le){return(0,W.e)((en,qt)=>{let zt=0;en.subscribe((0,ge.x)(qt,wt=>{qt.next(c.call(Le,wt,zt++))}))})}},8189:(or,Gt,De)=>{"use strict";De.d(Gt,{J:()=>Ge});var W=De(5577),ge=De(4671);function Ge(c=1/0){return(0,W.z)(ge.y,c)}},5577:(or,Gt,De)=>{"use strict";De.d(Gt,{z:()=>zt});var W=De(4004),ge=De(8421),Ge=De(4482),c=De(9672),Le=De(5403),qt=De(576);function zt(wt,Et,mt=1/0){return(0,qt.m)(Et)?zt((Zt,Pn)=>(0,W.U)((Ut,cn)=>Et(Zt,Ut,Pn,cn))((0,ge.Xf)(wt(Zt,Pn))),mt):("number"==typeof Et&&(mt=Et),(0,Ge.e)((Zt,Pn)=>function en(wt,Et,mt,Zt,Pn,Ut,cn,In){const Xn=[];let dt=0,yr=0,sn=!1;const Bt=()=>{sn&&!Xn.length&&!dt&&Et.complete()},je=Hn=>dt<Zt?Kt(Hn):Xn.push(Hn),Kt=Hn=>{Ut&&Et.next(Hn),dt++;let Me=!1;(0,ge.Xf)(mt(Hn,yr++)).subscribe((0,Le.x)(Et,Wt=>{Pn?.(Wt),Ut?je(Wt):Et.next(Wt)},()=>{Me=!0},void 0,()=>{if(Me)try{for(dt--;Xn.length&&dt<Zt;){const Wt=Xn.shift();cn?(0,c.f)(Et,cn,()=>Kt(Wt)):Kt(Wt)}Bt()}catch(Wt){Et.error(Wt)}}))};return wt.subscribe((0,Le.x)(Et,je,()=>{sn=!0,Bt()})),()=>{In?.()}}(Zt,Pn,wt,mt)))}},8505:(or,Gt,De)=>{"use strict";De.d(Gt,{b:()=>Le});var W=De(576),ge=De(4482),Ge=De(5403),c=De(4671);function Le(en,qt,zt){const wt=(0,W.m)(en)||qt||zt?{next:en,error:qt,complete:zt}:en;return wt?(0,ge.e)((Et,mt)=>{var Zt;null===(Zt=wt.subscribe)||void 0===Zt||Zt.call(wt);let Pn=!0;Et.subscribe((0,Ge.x)(mt,Ut=>{var cn;null===(cn=wt.next)||void 0===cn||cn.call(wt,Ut),mt.next(Ut)},()=>{var Ut;Pn=!1,null===(Ut=wt.complete)||void 0===Ut||Ut.call(wt),mt.complete()},Ut=>{var cn;Pn=!1,null===(cn=wt.error)||void 0===cn||cn.call(wt,Ut),mt.error(Ut)},()=>{var Ut,cn;Pn&&(null===(Ut=wt.unsubscribe)||void 0===Ut||Ut.call(wt)),null===(cn=wt.finalize)||void 0===cn||cn.call(wt)}))}):c.y}},3410:(or,Gt,De)=>{"use strict";De.d(Gt,{z:()=>W});const W={setTimeout(ge,Ge,...c){const{delegate:Le}=W;return Le?.setTimeout?Le.setTimeout(ge,Ge,...c):setTimeout(ge,Ge,...c)},clearTimeout(ge){const{delegate:Ge}=W;return(Ge?.clearTimeout||clearTimeout)(ge)},delegate:void 0}},2202:(or,Gt,De)=>{"use strict";De.d(Gt,{h:()=>ge});const ge=function W(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},8822:(or,Gt,De)=>{"use strict";De.d(Gt,{L:()=>W});const W="function"==typeof Symbol&&Symbol.observable||"@@observable"},7669:(or,Gt,De)=>{"use strict";De.d(Gt,{_6:()=>en,jO:()=>c,yG:()=>Le});var W=De(576);function Ge(qt){return qt[qt.length-1]}function c(qt){return(0,W.m)(Ge(qt))?qt.pop():void 0}function Le(qt){return function ge(qt){return qt&&(0,W.m)(qt.schedule)}(Ge(qt))?qt.pop():void 0}function en(qt,zt){return"number"==typeof Ge(qt)?qt.pop():zt}},4742:(or,Gt,De)=>{"use strict";De.d(Gt,{D:()=>Le});const{isArray:W}=Array,{getPrototypeOf:ge,prototype:Ge,keys:c}=Object;function Le(qt){if(1===qt.length){const zt=qt[0];if(W(zt))return{args:zt,keys:null};if(function en(qt){return qt&&"object"==typeof qt&&ge(qt)===Ge}(zt)){const wt=c(zt);return{args:wt.map(Et=>zt[Et]),keys:wt}}}return{args:qt,keys:null}}},8737:(or,Gt,De)=>{"use strict";function W(ge,Ge){if(ge){const c=ge.indexOf(Ge);0<=c&&ge.splice(c,1)}}De.d(Gt,{P:()=>W})},3888:(or,Gt,De)=>{"use strict";function W(ge){const c=ge(Le=>{Error.call(Le),Le.stack=(new Error).stack});return c.prototype=Object.create(Error.prototype),c.prototype.constructor=c,c}De.d(Gt,{d:()=>W})},1810:(or,Gt,De)=>{"use strict";function W(ge,Ge){return ge.reduce((c,Le,en)=>(c[Le]=Ge[en],c),{})}De.d(Gt,{n:()=>W})},2806:(or,Gt,De)=>{"use strict";De.d(Gt,{O:()=>c,x:()=>Ge});var W=De(2416);let ge=null;function Ge(Le){if(W.v.useDeprecatedSynchronousErrorHandling){const en=!ge;if(en&&(ge={errorThrown:!1,error:null}),Le(),en){const{errorThrown:qt,error:zt}=ge;if(ge=null,qt)throw zt}}else Le()}function c(Le){W.v.useDeprecatedSynchronousErrorHandling&&ge&&(ge.errorThrown=!0,ge.error=Le)}},9672:(or,Gt,De)=>{"use strict";function W(ge,Ge,c,Le=0,en=!1){const qt=Ge.schedule(function(){c(),en?ge.add(this.schedule(null,Le)):this.unsubscribe()},Le);if(ge.add(qt),!en)return qt}De.d(Gt,{f:()=>W})},4671:(or,Gt,De)=>{"use strict";function W(ge){return ge}De.d(Gt,{y:()=>W})},1144:(or,Gt,De)=>{"use strict";De.d(Gt,{z:()=>W});const W=ge=>ge&&"number"==typeof ge.length&&"function"!=typeof ge},2206:(or,Gt,De)=>{"use strict";De.d(Gt,{D:()=>ge});var W=De(576);function ge(Ge){return Symbol.asyncIterator&&(0,W.m)(Ge?.[Symbol.asyncIterator])}},576:(or,Gt,De)=>{"use strict";function W(ge){return"function"==typeof ge}De.d(Gt,{m:()=>W})},3670:(or,Gt,De)=>{"use strict";De.d(Gt,{c:()=>Ge});var W=De(8822),ge=De(576);function Ge(c){return(0,ge.m)(c[W.L])}},6495:(or,Gt,De)=>{"use strict";De.d(Gt,{T:()=>Ge});var W=De(2202),ge=De(576);function Ge(c){return(0,ge.m)(c?.[W.h])}},8239:(or,Gt,De)=>{"use strict";De.d(Gt,{t:()=>ge});var W=De(576);function ge(Ge){return(0,W.m)(Ge?.then)}},3260:(or,Gt,De)=>{"use strict";De.d(Gt,{L:()=>c,Q:()=>Ge});var W=De(655),ge=De(576);function Ge(Le){return(0,W.FC)(this,arguments,function*(){const qt=Le.getReader();try{for(;;){const{value:zt,done:wt}=yield(0,W.qq)(qt.read());if(wt)return yield(0,W.qq)(void 0);yield yield(0,W.qq)(zt)}}finally{qt.releaseLock()}})}function c(Le){return(0,ge.m)(Le?.getReader)}},4482:(or,Gt,De)=>{"use strict";De.d(Gt,{A:()=>ge,e:()=>Ge});var W=De(576);function ge(c){return(0,W.m)(c?.lift)}function Ge(c){return Le=>{if(ge(Le))return Le.lift(function(en){try{return c(en,this)}catch(qt){this.error(qt)}});throw new TypeError("Unable to lift unknown Observable type")}}},3268:(or,Gt,De)=>{"use strict";De.d(Gt,{Z:()=>c});var W=De(4004);const{isArray:ge}=Array;function c(Le){return(0,W.U)(en=>function Ge(Le,en){return ge(en)?Le(...en):Le(en)}(Le,en))}},9635:(or,Gt,De)=>{"use strict";De.d(Gt,{U:()=>Ge,z:()=>ge});var W=De(4671);function ge(...c){return Ge(c)}function Ge(c){return 0===c.length?W.y:1===c.length?c[0]:function(en){return c.reduce((qt,zt)=>zt(qt),en)}}},7849:(or,Gt,De)=>{"use strict";De.d(Gt,{h:()=>Ge});var W=De(2416),ge=De(3410);function Ge(c){ge.z.setTimeout(()=>{const{onUnhandledError:Le}=W.v;if(!Le)throw c;Le(c)})}},4532:(or,Gt,De)=>{"use strict";function W(ge){return new TypeError(`You provided ${null!==ge&&"object"==typeof ge?"an invalid object":`'${ge}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}De.d(Gt,{z:()=>W})},5226:function(or){or.exports=function(){"use strict";const Gt="SweetAlert2:",W=A=>A.charAt(0).toUpperCase()+A.slice(1),ge=A=>Array.prototype.slice.call(A),Ge=A=>{console.warn("".concat(Gt," ").concat("object"==typeof A?A.join(" "):A))},c=A=>{console.error("".concat(Gt," ").concat(A))},Le=[],qt=(A,P)=>{(A=>{Le.includes(A)||(Le.push(A),Ge(A))})('"'.concat(A,'" is deprecated and will be removed in the next major release. Please use "').concat(P,'" instead.'))},zt=A=>"function"==typeof A?A():A,wt=A=>A&&"function"==typeof A.toPromise,Et=A=>wt(A)?A.toPromise():Promise.resolve(A),mt=A=>A&&Promise.resolve(A)===A,Zt={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0},Pn=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","willClose"],Ut={},cn=["allowOutsideClick","allowEnterKey","backdrop","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],In=A=>Object.prototype.hasOwnProperty.call(Zt,A),Xn=A=>-1!==Pn.indexOf(A),dt=A=>Ut[A],yr=A=>{In(A)||Ge('Unknown parameter "'.concat(A,'"'))},sn=A=>{cn.includes(A)&&Ge('The parameter "'.concat(A,'" is incompatible with toasts'))},Bt=A=>{dt(A)&&qt(A,dt(A))},Hn=A=>{const P={};for(const $ in A)P[A[$]]="swal2-"+A[$];return P},Me=Hn(["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","default-outline","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error"]),Wt=Hn(["success","warning","info","question","error"]),gt=()=>document.body.querySelector(".".concat(Me.container)),ft=A=>{const P=gt();return P?P.querySelector(A):null},fn=A=>ft(".".concat(A)),vn=()=>fn(Me.popup),dn=()=>fn(Me.icon),ot=()=>fn(Me.title),$e=()=>fn(Me["html-container"]),yt=()=>fn(Me.image),At=()=>fn(Me["progress-steps"]),Yt=()=>fn(Me["validation-message"]),Dt=()=>ft(".".concat(Me.actions," .").concat(Me.confirm)),an=()=>ft(".".concat(Me.actions," .").concat(Me.deny)),vr=()=>ft(".".concat(Me.loader)),Mn=()=>ft(".".concat(Me.actions," .").concat(Me.cancel)),er=()=>fn(Me.actions),Vn=()=>fn(Me.footer),zn=()=>fn(Me["timer-progress-bar"]),cr=()=>fn(Me.close),nn=()=>{const A=ge(vn().querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])')).sort(($,pe)=>{const We=parseInt($.getAttribute("tabindex")),Ot=parseInt(pe.getAttribute("tabindex"));return We>Ot?1:We<Ot?-1:0}),P=ge(vn().querySelectorAll('\n  a[href],\n  area[href],\n  input:not([disabled]),\n  select:not([disabled]),\n  textarea:not([disabled]),\n  button:not([disabled]),\n  iframe,\n  object,\n  embed,\n  [tabindex="0"],\n  [contenteditable],\n  audio[controls],\n  video[controls],\n  summary\n')).filter($=>"-1"!==$.getAttribute("tabindex"));return(A=>{const P=[];for(let $=0;$<A.length;$++)-1===P.indexOf(A[$])&&P.push(A[$]);return P})(A.concat(P)).filter($=>tr($))},Kr=()=>vi(document.body,Me.shown)&&!vi(document.body,Me["toast-shown"])&&!vi(document.body,Me["no-backdrop"]),Pr=()=>vn()&&vi(vn(),Me.toast),Rr={previousBodyPadding:null},Yr=(A,P)=>{if(A.textContent="",P){const pe=(new DOMParser).parseFromString(P,"text/html");ge(pe.querySelector("head").childNodes).forEach(We=>{A.appendChild(We)}),ge(pe.querySelector("body").childNodes).forEach(We=>{A.appendChild(We)})}},vi=(A,P)=>{if(!P)return!1;const $=P.split(/\s+/);for(let pe=0;pe<$.length;pe++)if(!A.classList.contains($[pe]))return!1;return!0},kr=(A,P,$)=>{if(((A,P)=>{ge(A.classList).forEach($=>{!Object.values(Me).includes($)&&!Object.values(Wt).includes($)&&!Object.values(P.showClass).includes($)&&A.classList.remove($)})})(A,P),P.customClass&&P.customClass[$]){if("string"!=typeof P.customClass[$]&&!P.customClass[$].forEach)return Ge("Invalid type of customClass.".concat($,'! Expected string or iterable object, got "').concat(typeof P.customClass[$],'"'));sr(A,P.customClass[$])}},Wi=(A,P)=>{if(!P)return null;switch(P){case"select":case"textarea":case"file":return A.querySelector(".".concat(Me.popup," > .").concat(Me[P]));case"checkbox":return A.querySelector(".".concat(Me.popup," > .").concat(Me.checkbox," input"));case"radio":return A.querySelector(".".concat(Me.popup," > .").concat(Me.radio," input:checked"))||A.querySelector(".".concat(Me.popup," > .").concat(Me.radio," input:first-child"));case"range":return A.querySelector(".".concat(Me.popup," > .").concat(Me.range," input"));default:return A.querySelector(".".concat(Me.popup," > .").concat(Me.input))}},di=A=>{if(A.focus(),"file"!==A.type){const P=A.value;A.value="",A.value=P}},zo=(A,P,$)=>{!A||!P||("string"==typeof P&&(P=P.split(/\s+/).filter(Boolean)),P.forEach(pe=>{Array.isArray(A)?A.forEach(We=>{$?We.classList.add(pe):We.classList.remove(pe)}):$?A.classList.add(pe):A.classList.remove(pe)}))},sr=(A,P)=>{zo(A,P,!0)},br=(A,P)=>{zo(A,P,!1)},Ai=(A,P)=>{const $=ge(A.childNodes);for(let pe=0;pe<$.length;pe++)if(vi($[pe],P))return $[pe]},Er=(A,P,$)=>{$==="".concat(parseInt($))&&($=parseInt($)),$||0===parseInt($)?A.style[P]="number"==typeof $?"".concat($,"px"):$:A.style.removeProperty(P)},un=function(A){A.style.display=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flex"},ht=A=>{A.style.display="none"},Lr=(A,P,$,pe)=>{const We=A.querySelector(P);We&&(We.style[$]=pe)},Jr=(A,P,$)=>{P?un(A,$):ht(A)},tr=A=>!(!A||!(A.offsetWidth||A.offsetHeight||A.getClientRects().length)),Pi=A=>A.scrollHeight>A.clientHeight,$r=A=>{const P=window.getComputedStyle(A),$=parseFloat(P.getPropertyValue("animation-duration")||"0"),pe=parseFloat(P.getPropertyValue("transition-duration")||"0");return $>0||pe>0},jr=function(A){let P=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const $=zn();tr($)&&(P&&($.style.transition="none",$.style.width="100%"),setTimeout(()=>{$.style.transition="width ".concat(A/1e3,"s linear"),$.style.width="0%"},10))},xr=()=>typeof window>"u"||typeof document>"u",Rn={},Zi=A=>new Promise(P=>{if(!A)return P();const $=window.scrollX,pe=window.scrollY;Rn.restoreFocusTimeout=setTimeout(()=>{Rn.previousActiveElement&&Rn.previousActiveElement.focus?(Rn.previousActiveElement.focus(),Rn.previousActiveElement=null):document.body&&document.body.focus(),P()},100),window.scrollTo($,pe)}),Je='\n <div aria-labelledby="'.concat(Me.title,'" aria-describedby="').concat(Me["html-container"],'" class="').concat(Me.popup,'" tabindex="-1">\n   <button type="button" class="').concat(Me.close,'"></button>\n   <ul class="').concat(Me["progress-steps"],'"></ul>\n   <div class="').concat(Me.icon,'"></div>\n   <img class="').concat(Me.image,'" />\n   <h2 class="').concat(Me.title,'" id="').concat(Me.title,'"></h2>\n   <div class="').concat(Me["html-container"],'" id="').concat(Me["html-container"],'"></div>\n   <input class="').concat(Me.input,'" />\n   <input type="file" class="').concat(Me.file,'" />\n   <div class="').concat(Me.range,'">\n     <input type="range" />\n     <output></output>\n   </div>\n   <select class="').concat(Me.select,'"></select>\n   <div class="').concat(Me.radio,'"></div>\n   <label for="').concat(Me.checkbox,'" class="').concat(Me.checkbox,'">\n     <input type="checkbox" />\n     <span class="').concat(Me.label,'"></span>\n   </label>\n   <textarea class="').concat(Me.textarea,'"></textarea>\n   <div class="').concat(Me["validation-message"],'" id="').concat(Me["validation-message"],'"></div>\n   <div class="').concat(Me.actions,'">\n     <div class="').concat(Me.loader,'"></div>\n     <button type="button" class="').concat(Me.confirm,'"></button>\n     <button type="button" class="').concat(Me.deny,'"></button>\n     <button type="button" class="').concat(Me.cancel,'"></button>\n   </div>\n   <div class="').concat(Me.footer,'"></div>\n   <div class="').concat(Me["timer-progress-bar-container"],'">\n     <div class="').concat(Me["timer-progress-bar"],'"></div>\n   </div>\n </div>\n').replace(/(^|\n)\s*/g,""),Ne=()=>{Rn.currentInstance.resetValidationMessage()},q=A=>{const P=(()=>{const A=gt();return!!A&&(A.remove(),br([document.documentElement,document.body],[Me["no-backdrop"],Me["toast-shown"],Me["has-column"]]),!0)})();if(xr())return void c("SweetAlert2 requires document to initialize");const $=document.createElement("div");$.className=Me.container,P&&sr($,Me["no-transition"]),Yr($,Je);const pe=(A=>"string"==typeof A?document.querySelector(A):A)(A.target);pe.appendChild($),(A=>{const P=vn();P.setAttribute("role",A.toast?"alert":"dialog"),P.setAttribute("aria-live",A.toast?"polite":"assertive"),A.toast||P.setAttribute("aria-modal","true")})(A),(A=>{"rtl"===window.getComputedStyle(A).direction&&sr(gt(),Me.rtl)})(pe),(()=>{const A=vn(),P=Ai(A,Me.input),$=Ai(A,Me.file),pe=A.querySelector(".".concat(Me.range," input")),We=A.querySelector(".".concat(Me.range," output")),Ot=Ai(A,Me.select),_n=A.querySelector(".".concat(Me.checkbox," input")),qn=Ai(A,Me.textarea);P.oninput=Ne,$.onchange=Ne,Ot.onchange=Ne,_n.onchange=Ne,qn.oninput=Ne,pe.oninput=()=>{Ne(),We.value=pe.value},pe.onchange=()=>{Ne(),pe.nextSibling.value=pe.value}})()},Y=(A,P)=>{A instanceof HTMLElement?P.appendChild(A):"object"==typeof A?de(A,P):A&&Yr(P,A)},de=(A,P)=>{A.jquery?Ee(P,A):Yr(P,A.toString())},Ee=(A,P)=>{if(A.textContent="",0 in P)for(let $=0;$ in P;$++)A.appendChild(P[$].cloneNode(!0));else A.appendChild(P.cloneNode(!0))},ie=(()=>{if(xr())return!1;const A=document.createElement("div"),P={WebkitAnimation:"webkitAnimationEnd",animation:"animationend"};for(const $ in P)if(Object.prototype.hasOwnProperty.call(P,$)&&typeof A.style[$]<"u")return P[$];return!1})(),X=(A,P)=>{const $=er(),pe=vr();P.showConfirmButton||P.showDenyButton||P.showCancelButton?un($):ht($),kr($,P,"actions"),function oe(A,P,$){const pe=Dt(),We=an(),Ot=Mn();Ue(pe,"confirm",$),Ue(We,"deny",$),Ue(Ot,"cancel",$),function _e(A,P,$,pe){if(!pe.buttonsStyling)return br([A,P,$],Me.styled);sr([A,P,$],Me.styled),pe.confirmButtonColor&&(A.style.backgroundColor=pe.confirmButtonColor,sr(A,Me["default-outline"])),pe.denyButtonColor&&(P.style.backgroundColor=pe.denyButtonColor,sr(P,Me["default-outline"])),pe.cancelButtonColor&&($.style.backgroundColor=pe.cancelButtonColor,sr($,Me["default-outline"]))}(pe,We,Ot,$),$.reverseButtons&&($.toast?(A.insertBefore(Ot,pe),A.insertBefore(We,pe)):(A.insertBefore(Ot,P),A.insertBefore(We,P),A.insertBefore(pe,P)))}($,pe,P),Yr(pe,P.loaderHtml),kr(pe,P,"loader")};function Ue(A,P,$){Jr(A,$["show".concat(W(P),"Button")],"inline-block"),Yr(A,$["".concat(P,"ButtonText")]),A.setAttribute("aria-label",$["".concat(P,"ButtonAriaLabel")]),A.className=Me[P],kr(A,$,"".concat(P,"Button")),sr(A,$["".concat(P,"ButtonClass")])}const hn=(A,P)=>{const $=gt();$&&(function ct(A,P){"string"==typeof P?A.style.background=P:P||sr([document.documentElement,document.body],Me["no-backdrop"])}($,P.backdrop),function lt(A,P){P in Me?sr(A,Me[P]):(Ge('The "position" parameter is not valid, defaulting to "center"'),sr(A,Me.center))}($,P.position),function kt(A,P){if(P&&"string"==typeof P){const $="grow-".concat(P);$ in Me&&sr(A,Me[$])}}($,P.grow),kr($,P,"container"))};var Lt={awaitingPromise:new WeakMap,promise:new WeakMap,innerParams:new WeakMap,domCache:new WeakMap};const mn=["input","file","range","select","radio","checkbox","textarea"],nr=A=>{if(!Qr[A.input])return c('Unexpected type of input! Expected "text", "email", "password", "number", "tel", "select", "radio", "checkbox", "textarea", "file" or "url", got "'.concat(A.input,'"'));const P=st(A.input),$=Qr[A.input](P,A);un($),setTimeout(()=>{di($)})},zr=(A,P)=>{const $=Wi(vn(),A);if($){(A=>{for(let P=0;P<A.attributes.length;P++){const $=A.attributes[P].name;["type","value","style"].includes($)||A.removeAttribute($)}})($);for(const pe in P)$.setAttribute(pe,P[pe])}},Cr=A=>{const P=st(A.input);A.customClass&&sr(P,A.customClass.input)},Xo=(A,P)=>{(!A.placeholder||P.inputPlaceholder)&&(A.placeholder=P.inputPlaceholder)},ki=(A,P,$)=>{if($.inputLabel){A.id=Me.input;const pe=document.createElement("label"),We=Me["input-label"];pe.setAttribute("for",A.id),pe.className=We,sr(pe,$.customClass.inputLabel),pe.innerText=$.inputLabel,P.insertAdjacentElement("beforebegin",pe)}},st=A=>{const P=Me[A]?Me[A]:Me.input;return Ai(vn(),P)},Qr={};Qr.text=Qr.email=Qr.password=Qr.number=Qr.tel=Qr.url=(A,P)=>("string"==typeof P.inputValue||"number"==typeof P.inputValue?A.value=P.inputValue:mt(P.inputValue)||Ge('Unexpected type of inputValue! Expected "string", "number" or "Promise", got "'.concat(typeof P.inputValue,'"')),ki(A,A,P),Xo(A,P),A.type=P.input,A),Qr.file=(A,P)=>(ki(A,A,P),Xo(A,P),A),Qr.range=(A,P)=>{const $=A.querySelector("input"),pe=A.querySelector("output");return $.value=P.inputValue,$.type=P.input,pe.value=P.inputValue,ki($,A,P),A},Qr.select=(A,P)=>{if(A.textContent="",P.inputPlaceholder){const $=document.createElement("option");Yr($,P.inputPlaceholder),$.value="",$.disabled=!0,$.selected=!0,A.appendChild($)}return ki(A,A,P),A},Qr.radio=A=>(A.textContent="",A),Qr.checkbox=(A,P)=>{const $=Wi(vn(),"checkbox");$.value="1",$.id=Me.checkbox,$.checked=Boolean(P.inputValue);const pe=A.querySelector("span");return Yr(pe,P.inputPlaceholder),A},Qr.textarea=(A,P)=>{A.value=P.inputValue,Xo(A,P),ki(A,A,P);return setTimeout(()=>{if("MutationObserver"in window){const pe=parseInt(window.getComputedStyle(vn()).width);new MutationObserver(()=>{const Ot=A.offsetWidth+(pe=>parseInt(window.getComputedStyle(pe).marginLeft)+parseInt(window.getComputedStyle(pe).marginRight))(A);vn().style.width=Ot>pe?"".concat(Ot,"px"):null}).observe(A,{attributes:!0,attributeFilter:["style"]})}}),A};const xi=(A,P)=>{const $=$e();kr($,P,"htmlContainer"),P.html?(Y(P.html,$),un($,"block")):P.text?($.textContent=P.text,un($,"block")):ht($),((A,P)=>{const $=vn(),pe=Lt.innerParams.get(A),We=!pe||P.input!==pe.input;mn.forEach(Ot=>{const _n=Me[Ot],qn=Ai($,_n);zr(Ot,P.inputAttributes),qn.className=_n,We&&ht(qn)}),P.input&&(We&&nr(P),Cr(P))})(A,P)},ar=(A,P)=>{for(const $ in Wt)P.icon!==$&&br(A,Wt[$]);sr(A,Wt[P.icon]),Yn(A,P),oi(),kr(A,P,"icon")},oi=()=>{const A=vn(),P=window.getComputedStyle(A).getPropertyValue("background-color"),$=A.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let pe=0;pe<$.length;pe++)$[pe].style.backgroundColor=P},kn=(A,P)=>{A.textContent="",Yr(A,P.iconHtml?xo(P.iconHtml):"success"===P.icon?'\n  <div class="swal2-success-circular-line-left"></div>\n  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>\n  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>\n  <div class="swal2-success-circular-line-right"></div>\n':"error"===P.icon?'\n  <span class="swal2-x-mark">\n    <span class="swal2-x-mark-line-left"></span>\n    <span class="swal2-x-mark-line-right"></span>\n  </span>\n':xo({question:"?",warning:"!",info:"i"}[P.icon]))},Yn=(A,P)=>{if(P.iconColor){A.style.color=P.iconColor,A.style.borderColor=P.iconColor;for(const $ of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])Lr(A,$,"backgroundColor",P.iconColor);Lr(A,".swal2-success-ring","borderColor",P.iconColor)}},xo=A=>'<div class="'.concat(Me["icon-content"],'">').concat(A,"</div>"),Jn=(A,P)=>{const $=At();if(!P.progressSteps||0===P.progressSteps.length)return ht($);un($),$.textContent="",P.currentProgressStep>=P.progressSteps.length&&Ge("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),P.progressSteps.forEach((pe,We)=>{const Ot=(A=>{const P=document.createElement("li");return sr(P,Me["progress-step"]),Yr(P,A),P})(pe);if($.appendChild(Ot),We===P.currentProgressStep&&sr(Ot,Me["active-progress-step"]),We!==P.progressSteps.length-1){const _n=(A=>{const P=document.createElement("li");return sr(P,Me["progress-step-line"]),A.progressStepsDistance&&(P.style.width=A.progressStepsDistance),P})(P);$.appendChild(_n)}})},dr=(A,P)=>{A.className="".concat(Me.popup," ").concat(tr(A)?P.showClass.popup:""),P.toast?(sr([document.documentElement,document.body],Me["toast-shown"]),sr(A,Me.toast)):sr(A,Me.modal),kr(A,P,"popup"),"string"==typeof P.customClass&&sr(A,P.customClass),P.icon&&sr(A,Me["icon-".concat(P.icon)])},Oi=(A,P)=>{((A,P)=>{const $=gt(),pe=vn();P.toast?(Er($,"width",P.width),pe.style.width="100%",pe.insertBefore(vr(),dn())):Er(pe,"width",P.width),Er(pe,"padding",P.padding),P.color&&(pe.style.color=P.color),P.background&&(pe.style.background=P.background),ht(Yt()),dr(pe,P)})(0,P),hn(0,P),Jn(0,P),((A,P)=>{const $=Lt.innerParams.get(A),pe=dn();$&&P.icon===$.icon?(kn(pe,P),ar(pe,P)):P.icon||P.iconHtml?P.icon&&-1===Object.keys(Wt).indexOf(P.icon)?(c('Unknown icon! Expected "success", "error", "warning", "info" or "question", got "'.concat(P.icon,'"')),ht(pe)):(un(pe),kn(pe,P),ar(pe,P),sr(pe,P.showClass.icon)):ht(pe)})(A,P),((A,P)=>{const $=yt();if(!P.imageUrl)return ht($);un($,""),$.setAttribute("src",P.imageUrl),$.setAttribute("alt",P.imageAlt),Er($,"width",P.imageWidth),Er($,"height",P.imageHeight),$.className=Me.image,kr($,P,"image")})(0,P),((A,P)=>{const $=ot();Jr($,P.title||P.titleText,"block"),P.title&&Y(P.title,$),P.titleText&&($.innerText=P.titleText),kr($,P,"title")})(0,P),((A,P)=>{const $=cr();Yr($,P.closeButtonHtml),kr($,P,"closeButton"),Jr($,P.showCloseButton),$.setAttribute("aria-label",P.closeButtonAriaLabel)})(0,P),xi(A,P),X(0,P),((A,P)=>{const $=Vn();Jr($,P.footer),P.footer&&Y(P.footer,$),kr($,P,"footer")})(0,P),"function"==typeof P.didRender&&P.didRender(vn())},Wr=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),io=()=>{ge(document.body.children).forEach(P=>{P.hasAttribute("data-previous-aria-hidden")?(P.setAttribute("aria-hidden",P.getAttribute("data-previous-aria-hidden")),P.removeAttribute("data-previous-aria-hidden")):P.removeAttribute("aria-hidden")})},oo=["swal-title","swal-html","swal-footer"],mo=A=>{const P={};return ge(A.querySelectorAll("swal-param")).forEach($=>{Ti($,["name","value"]);const pe=$.getAttribute("name"),We=$.getAttribute("value");"boolean"==typeof Zt[pe]&&"false"===We&&(P[pe]=!1),"object"==typeof Zt[pe]&&(P[pe]=JSON.parse(We))}),P},lo=A=>{const P={};return ge(A.querySelectorAll("swal-button")).forEach($=>{Ti($,["type","color","aria-label"]);const pe=$.getAttribute("type");P["".concat(pe,"ButtonText")]=$.innerHTML,P["show".concat(W(pe),"Button")]=!0,$.hasAttribute("color")&&(P["".concat(pe,"ButtonColor")]=$.getAttribute("color")),$.hasAttribute("aria-label")&&(P["".concat(pe,"ButtonAriaLabel")]=$.getAttribute("aria-label"))}),P},Fi=A=>{const P={},$=A.querySelector("swal-image");return $&&(Ti($,["src","width","height","alt"]),$.hasAttribute("src")&&(P.imageUrl=$.getAttribute("src")),$.hasAttribute("width")&&(P.imageWidth=$.getAttribute("width")),$.hasAttribute("height")&&(P.imageHeight=$.getAttribute("height")),$.hasAttribute("alt")&&(P.imageAlt=$.getAttribute("alt"))),P},wo=A=>{const P={},$=A.querySelector("swal-icon");return $&&(Ti($,["type","color"]),$.hasAttribute("type")&&(P.icon=$.getAttribute("type")),$.hasAttribute("color")&&(P.iconColor=$.getAttribute("color")),P.iconHtml=$.innerHTML),P},Vr=A=>{const P={},$=A.querySelector("swal-input");$&&(Ti($,["type","label","placeholder","value"]),P.input=$.getAttribute("type")||"text",$.hasAttribute("label")&&(P.inputLabel=$.getAttribute("label")),$.hasAttribute("placeholder")&&(P.inputPlaceholder=$.getAttribute("placeholder")),$.hasAttribute("value")&&(P.inputValue=$.getAttribute("value")));const pe=A.querySelectorAll("swal-input-option");return pe.length&&(P.inputOptions={},ge(pe).forEach(We=>{Ti(We,["value"]);const Ot=We.getAttribute("value");P.inputOptions[Ot]=We.innerHTML})),P},Hr=(A,P)=>{const $={};for(const pe in P){const We=P[pe],Ot=A.querySelector(We);Ot&&(Ti(Ot,[]),$[We.replace(/^swal-/,"")]=Ot.innerHTML.trim())}return $},cs=A=>{const P=oo.concat(["swal-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);ge(A.children).forEach($=>{const pe=$.tagName.toLowerCase();-1===P.indexOf(pe)&&Ge("Unrecognized element <".concat(pe,">"))})},Ti=(A,P)=>{ge(A.attributes).forEach($=>{-1===P.indexOf($.name)&&Ge(['Unrecognized attribute "'.concat($.name,'" on <').concat(A.tagName.toLowerCase(),">."),"".concat(P.length?"Allowed attributes are: ".concat(P.join(", ")):"To set the value, use HTML within the element.")])})};var ji={email:(A,P)=>/^[a-zA-Z0-9.+_-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]{2,24}$/.test(A)?Promise.resolve():Promise.resolve(P||"Invalid email address"),url:(A,P)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(A)?Promise.resolve():Promise.resolve(P||"Invalid URL")};function Xa(A){(function co(A){A.inputValidator||Object.keys(ji).forEach(P=>{A.input===P&&(A.inputValidator=ji[P])})})(A),A.showLoaderOnConfirm&&!A.preConfirm&&Ge("showLoaderOnConfirm is set to true, but preConfirm is not defined.\nshowLoaderOnConfirm should be used together with preConfirm, see usage example:\nhttps://sweetalert2.github.io/#ajax-request"),function Zr(A){(!A.target||"string"==typeof A.target&&!document.querySelector(A.target)||"string"!=typeof A.target&&!A.target.appendChild)&&(Ge('Target parameter is not valid, defaulting to "body"'),A.target="body")}(A),"string"==typeof A.title&&(A.title=A.title.split("\n").join("<br />")),q(A)}class wi{constructor(P,$){this.callback=P,this.remaining=$,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=(new Date).getTime()-this.started.getTime()),this.remaining}increase(P){const $=this.running;return $&&this.stop(),this.remaining+=P,$&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const Ws=()=>{null===Rr.previousBodyPadding&&document.body.scrollHeight>window.innerHeight&&(Rr.previousBodyPadding=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight="".concat(Rr.previousBodyPadding+(()=>{const A=document.createElement("div");A.className=Me["scrollbar-measure"],document.body.appendChild(A);const P=A.getBoundingClientRect().width-A.clientWidth;return document.body.removeChild(A),P})(),"px"))},As=()=>{null!==Rr.previousBodyPadding&&(document.body.style.paddingRight="".concat(Rr.previousBodyPadding,"px"),Rr.previousBodyPadding=null)},pi=()=>{const A=navigator.userAgent,P=!!A.match(/iPad/i)||!!A.match(/iPhone/i),$=!!A.match(/WebKit/i);P&&$&&!A.match(/CriOS/i)&&vn().scrollHeight>window.innerHeight-44&&(gt().style.paddingBottom="".concat(44,"px"))},Ji=()=>{const A=gt();let P;A.ontouchstart=$=>{P=la($)},A.ontouchmove=$=>{P&&($.preventDefault(),$.stopPropagation())}},la=A=>{const P=A.target,$=gt();return!(Di(A)||uo(A)||P!==$&&(Pi($)||"INPUT"===P.tagName||"TEXTAREA"===P.tagName||Pi($e())&&$e().contains(P)))},Di=A=>A.touches&&A.touches.length&&"stylus"===A.touches[0].touchType,uo=A=>A.touches&&A.touches.length>1,Ps=()=>{if(vi(document.body,Me.iosfix)){const A=parseInt(document.body.style.top,10);br(document.body,Me.iosfix),document.body.style.top="",document.body.scrollTop=-1*A}},hs=A=>{const P=gt(),$=vn();"function"==typeof A.willOpen&&A.willOpen($);const We=window.getComputedStyle(document.body).overflowY;Ko(P,$,A),setTimeout(()=>{Rs(P,$)},10),Kr()&&(ks(P,A.scrollbarPadding,We),ge(document.body.children).forEach(P=>{P===gt()||P.contains(gt())||(P.hasAttribute("aria-hidden")&&P.setAttribute("data-previous-aria-hidden",P.getAttribute("aria-hidden")),P.setAttribute("aria-hidden","true"))})),!Pr()&&!Rn.previousActiveElement&&(Rn.previousActiveElement=document.activeElement),"function"==typeof A.didOpen&&setTimeout(()=>A.didOpen($)),br(P,Me["no-transition"])},ni=A=>{const P=vn();if(A.target!==P)return;const $=gt();P.removeEventListener(ie,ni),$.style.overflowY="auto"},Rs=(A,P)=>{ie&&$r(P)?(A.style.overflowY="hidden",P.addEventListener(ie,ni)):A.style.overflowY="auto"},ks=(A,P,$)=>{(()=>{if((/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!vi(document.body,Me.iosfix)){const P=document.body.scrollTop;document.body.style.top="".concat(-1*P,"px"),sr(document.body,Me.iosfix),Ji(),pi()}})(),P&&"hidden"!==$&&Ws(),setTimeout(()=>{A.scrollTop=0})},Ko=(A,P,$)=>{sr(A,$.showClass.backdrop),P.style.setProperty("opacity","0","important"),un(P,"grid"),setTimeout(()=>{sr(P,$.showClass.popup),P.style.removeProperty("opacity")},10),sr([document.documentElement,document.body],Me.shown),$.heightAuto&&$.backdrop&&!$.toast&&sr([document.documentElement,document.body],Me["height-auto"])},So=A=>{let P=vn();P||new Se,P=vn();const $=vr();Pr()?ht(dn()):ds(P,A),un($),P.setAttribute("data-loading",!0),P.setAttribute("aria-busy",!0),P.focus()},ds=(A,P)=>{const $=er(),pe=vr();!P&&tr(Dt())&&(P=Dt()),un($),P&&(ht(P),pe.setAttribute("data-button-to-replace",P.className)),pe.parentNode.insertBefore(pe,P),sr([A,$],Me.loading)},Ls=A=>A.checked?1:0,Ka=A=>A.checked?A.value:null,Sa=A=>A.files.length?null!==A.getAttribute("multiple")?A.files:A.files[0]:null,Na=(A,P)=>{const $=vn(),pe=We=>ca[P.input]($,Os(We),P);wt(P.inputOptions)||mt(P.inputOptions)?(So(Dt()),Et(P.inputOptions).then(We=>{A.hideLoading(),pe(We)})):"object"==typeof P.inputOptions?pe(P.inputOptions):c("Unexpected type of inputOptions! Expected object, Map or Promise, got ".concat(typeof P.inputOptions))},bo=(A,P)=>{const $=A.getInput();ht($),Et(P.inputValue).then(pe=>{$.value="number"===P.input?parseFloat(pe)||0:"".concat(pe),un($),$.focus(),A.hideLoading()}).catch(pe=>{c("Error in inputValue promise: ".concat(pe)),$.value="",un($),$.focus(),A.hideLoading()})},ca={select:(A,P,$)=>{const pe=Ai(A,Me.select),We=(Ot,_n,qn)=>{const Bn=document.createElement("option");Bn.value=qn,Yr(Bn,_n),Bn.selected=jo(qn,$.inputValue),Ot.appendChild(Bn)};P.forEach(Ot=>{const _n=Ot[0],qn=Ot[1];if(Array.isArray(qn)){const Bn=document.createElement("optgroup");Bn.label=_n,Bn.disabled=!1,pe.appendChild(Bn),qn.forEach(_t=>We(Bn,_t[1],_t[0]))}else We(pe,qn,_n)}),pe.focus()},radio:(A,P,$)=>{const pe=Ai(A,Me.radio);P.forEach(Ot=>{const _n=Ot[0],qn=Ot[1],Bn=document.createElement("input"),_t=document.createElement("label");Bn.type="radio",Bn.name=Me.radio,Bn.value=_n,jo(_n,$.inputValue)&&(Bn.checked=!0);const zi=document.createElement("span");Yr(zi,qn),zi.className=Me.label,_t.appendChild(Bn),_t.appendChild(zi),pe.appendChild(_t)});const We=pe.querySelectorAll("input");We.length&&We[0].focus()}},Os=A=>{const P=[];return typeof Map<"u"&&A instanceof Map?A.forEach(($,pe)=>{let We=$;"object"==typeof We&&(We=Os(We)),P.push([pe,We])}):Object.keys(A).forEach($=>{let pe=A[$];"object"==typeof pe&&(pe=Os(pe)),P.push([$,pe])}),P},jo=(A,P)=>P&&P.toString()===A.toString();function Ya(){const A=Lt.innerParams.get(this);if(!A)return;const P=Lt.domCache.get(this);ht(P.loader),Pr()?A.icon&&un(dn()):ua(P),br([P.popup,P.actions],Me.loading),P.popup.removeAttribute("aria-busy"),P.popup.removeAttribute("data-loading"),P.confirmButton.disabled=!1,P.denyButton.disabled=!1,P.cancelButton.disabled=!1}const ua=A=>{const P=A.popup.getElementsByClassName(A.loader.getAttribute("data-button-to-replace"));P.length?un(P[0],"inline-block"):!tr(Dt())&&!tr(an())&&!tr(Mn())&&ht(A.actions)};var Fs={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};const gr=()=>Dt()&&Dt().click(),Io=A=>{A.keydownTarget&&A.keydownHandlerAdded&&(A.keydownTarget.removeEventListener("keydown",A.keydownHandler,{capture:A.keydownListenerCapture}),A.keydownHandlerAdded=!1)},Vi=(A,P,$)=>{const pe=nn();if(pe.length)return(P+=$)===pe.length?P=0:-1===P&&(P=pe.length-1),pe[P].focus();vn().focus()},Qo=["ArrowRight","ArrowDown"],zs=["ArrowLeft","ArrowUp"],Bs=(A,P,$)=>{const pe=Lt.innerParams.get(A);pe&&(P.isComposing||229===P.keyCode||(pe.stopKeydownPropagation&&P.stopPropagation(),"Enter"===P.key?Ts(A,P,pe):"Tab"===P.key?fs(P,pe):[...Qo,...zs].includes(P.key)?Ns(P.key):"Escape"===P.key&&so(P,pe,$)))},Ts=(A,P,$)=>{if(zt($.allowEnterKey)&&P.target&&A.getInput()&&P.target.outerHTML===A.getInput().outerHTML){if(["textarea","file"].includes($.input))return;gr(),P.preventDefault()}},fs=(A,P)=>{const $=A.target,pe=nn();let We=-1;for(let Ot=0;Ot<pe.length;Ot++)if($===pe[Ot]){We=Ot;break}Vi(0,We,A.shiftKey?-1:1),A.stopPropagation(),A.preventDefault()},Ns=A=>{if(![Dt(),an(),Mn()].includes(document.activeElement))return;const We=Qo.includes(A)?"nextElementSibling":"previousElementSibling";let Ot=document.activeElement;for(let _n=0;_n<er().children.length;_n++){if(Ot=Ot[We],!Ot)return;if(tr(Ot)&&Ot instanceof HTMLButtonElement)break}Ot instanceof HTMLButtonElement&&Ot.focus()},so=(A,P,$)=>{zt(P.allowEscapeKey)&&(A.preventDefault(),$(Wr.esc))};function Ma(A,P,$,pe){Pr()?Ks(A,pe):(Zi($).then(()=>Ks(A,pe)),Io(Rn)),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?(P.setAttribute("style","display:none !important"),P.removeAttribute("class"),P.innerHTML=""):P.remove(),Kr()&&(As(),Ps(),io()),function fr(){br([document.documentElement,document.body],[Me.shown,Me["height-auto"],Me["no-backdrop"],Me["toast-shown"]])}()}function ri(A){A=da(A);const P=Fs.swalPromiseResolve.get(this),$=ha(this);this.isAwaitingPromise()?A.isDismissed||($i(this),P(A)):$&&P(A)}const ha=A=>{const P=vn();if(!P)return!1;const $=Lt.innerParams.get(A);if(!$||vi(P,$.hideClass.popup))return!1;br(P,$.showClass.popup),sr(P,$.hideClass.popup);const pe=gt();return br(pe,$.showClass.backdrop),sr(pe,$.hideClass.backdrop),$o(A,P,$),!0};const $i=A=>{A.isAwaitingPromise()&&(Lt.awaitingPromise.delete(A),Lt.innerParams.get(A)||A._destroy())},da=A=>typeof A>"u"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},A),$o=(A,P,$)=>{const pe=gt(),We=ie&&$r(P);"function"==typeof $.willClose&&$.willClose(P),We?Ao(A,P,pe,$.returnFocus,$.didClose):Ma(A,pe,$.returnFocus,$.didClose)},Ao=(A,P,$,pe,We)=>{Rn.swalCloseEventFinishedCallback=Ma.bind(null,A,$,pe,We),P.addEventListener(ie,function(Ot){Ot.target===P&&(Rn.swalCloseEventFinishedCallback(),delete Rn.swalCloseEventFinishedCallback)})},Ks=(A,P)=>{setTimeout(()=>{"function"==typeof P&&P.bind(A.params)(),A._destroy()})};function Go(A,P,$){const pe=Lt.domCache.get(A);P.forEach(We=>{pe[We].disabled=$})}function ps(A,P){if(!A)return!1;if("radio"===A.type){const pe=A.parentNode.parentNode.querySelectorAll("input");for(let We=0;We<pe.length;We++)pe[We].disabled=P}else A.disabled=P}const Va=A=>{const P={};return Object.keys(A).forEach($=>{Xn($)?P[$]=A[$]:Ge('Invalid parameter to update: "'.concat($,'". Updatable params are listed here: https://github.com/sweetalert2/sweetalert2/blob/master/src/utils/params.js\n\nIf you think this parameter should be updatable, request it here: https://github.com/sweetalert2/sweetalert2/issues/new?template=02_feature_request.md'))}),P};const Ia=A=>{Qa(A),delete A.params,delete Rn.keydownHandler,delete Rn.keydownTarget,delete Rn.currentInstance},Qa=A=>{A.isAwaitingPromise()?(Ft(Lt,A),Lt.awaitingPromise.set(A,!0)):(Ft(Fs,A),Ft(Lt,A))},Ft=(A,P)=>{for(const $ in A)A[$].delete(P)};var Sr=Object.freeze({hideLoading:Ya,disableLoading:Ya,getInput:function Yo(A){const P=Lt.innerParams.get(A||this),$=Lt.domCache.get(A||this);return $?Wi($.popup,P.input):null},close:ri,isAwaitingPromise:function Ja(){return!!Lt.awaitingPromise.get(this)},rejectPromise:function Qi(A){const P=Fs.swalPromiseReject.get(this);$i(this),P&&P(A)},handleAwaitingPromise:$i,closePopup:ri,closeModal:ri,closeToast:ri,enableButtons:function Ho(){Go(this,["confirmButton","denyButton","cancelButton"],!1)},disableButtons:function Ua(){Go(this,["confirmButton","denyButton","cancelButton"],!0)},enableInput:function ms(){return ps(this.getInput(),!1)},disableInput:function Tn(){return ps(this.getInput(),!0)},showValidationMessage:function fa(A){const P=Lt.domCache.get(this),$=Lt.innerParams.get(this);Yr(P.validationMessage,A),P.validationMessage.className=Me["validation-message"],$.customClass&&$.customClass.validationMessage&&sr(P.validationMessage,$.customClass.validationMessage),un(P.validationMessage);const pe=this.getInput();pe&&(pe.setAttribute("aria-invalid",!0),pe.setAttribute("aria-describedby",Me["validation-message"]),di(pe),sr(pe,Me.inputerror))},resetValidationMessage:function ja(){const A=Lt.domCache.get(this);A.validationMessage&&ht(A.validationMessage);const P=this.getInput();P&&(P.removeAttribute("aria-invalid"),P.removeAttribute("aria-describedby"),br(P,Me.inputerror))},getProgressSteps:function pa(){return Lt.domCache.get(this).progressSteps},update:function Ds(A){const P=vn(),$=Lt.innerParams.get(this);if(!P||vi(P,$.hideClass.popup))return Ge("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");const pe=Va(A),We=Object.assign({},$,pe);Oi(this,We),Lt.innerParams.set(this,We),Object.defineProperties(this,{params:{value:Object.assign({},this.params,A),writable:!1,enumerable:!0}})},_destroy:function Po(){const A=Lt.domCache.get(this),P=Lt.innerParams.get(this);P?(A.popup&&Rn.swalCloseEventFinishedCallback&&(Rn.swalCloseEventFinishedCallback(),delete Rn.swalCloseEventFinishedCallback),Rn.deferDisposalTimer&&(clearTimeout(Rn.deferDisposalTimer),delete Rn.deferDisposalTimer),"function"==typeof P.didDestroy&&P.didDestroy(),Ia(this)):Qa(this)}});const gs=(A,P)=>{const $=Lt.innerParams.get(A);if(!$.input)return c('The "input" parameter is needed to be set when using returnInputValueOn'.concat(W(P)));const pe=((A,P)=>{const $=A.getInput();if(!$)return null;switch(P.input){case"checkbox":return Ls($);case"radio":return Ka($);case"file":return Sa($);default:return P.inputAutoTrim?$.value.trim():$.value}})(A,$);$.inputValidator?Xi(A,pe,P):A.getInput().checkValidity()?"deny"===P?Ro(A,pe):Ys(A,pe):(A.enableButtons(),A.showValidationMessage($.validationMessage))},Xi=(A,P,$)=>{const pe=Lt.innerParams.get(A);A.disableInput(),Promise.resolve().then(()=>Et(pe.inputValidator(P,pe.validationMessage))).then(Ot=>{A.enableButtons(),A.enableInput(),Ot?A.showValidationMessage(Ot):"deny"===$?Ro(A,P):Ys(A,P)})},Ro=(A,P)=>{const $=Lt.innerParams.get(A||void 0);$.showLoaderOnDeny&&So(an()),$.preDeny?(Lt.awaitingPromise.set(A||void 0,!0),Promise.resolve().then(()=>Et($.preDeny(P,$.validationMessage))).then(We=>{!1===We?(A.hideLoading(),$i(A)):A.closePopup({isDenied:!0,value:typeof We>"u"?P:We})}).catch(We=>ga(A||void 0,We))):A.closePopup({isDenied:!0,value:P})},ma=(A,P)=>{A.closePopup({isConfirmed:!0,value:P})},ga=(A,P)=>{A.rejectPromise(P)},Ys=(A,P)=>{const $=Lt.innerParams.get(A||void 0);$.showLoaderOnConfirm&&So(),$.preConfirm?(A.resetValidationMessage(),Lt.awaitingPromise.set(A||void 0,!0),Promise.resolve().then(()=>Et($.preConfirm(P,$.validationMessage))).then(We=>{tr(Yt())||!1===We?(A.hideLoading(),$i(A)):ma(A,typeof We>"u"?P:We)}).catch(We=>ga(A||void 0,We))):ma(A,P)},Us=(A,P,$)=>{P.popup.onclick=()=>{const pe=Lt.innerParams.get(A);pe&&(Q(pe)||pe.timer||pe.input)||$(Wr.close)}},Q=A=>A.showConfirmButton||A.showDenyButton||A.showCancelButton||A.showCloseButton;let I=!1;const R=A=>{A.popup.onmousedown=()=>{A.container.onmouseup=function(P){A.container.onmouseup=void 0,P.target===A.container&&(I=!0)}}},j=A=>{A.container.onmousedown=()=>{A.popup.onmouseup=function(P){A.popup.onmouseup=void 0,(P.target===A.popup||A.popup.contains(P.target))&&(I=!0)}}},te=(A,P,$)=>{P.container.onclick=pe=>{const We=Lt.innerParams.get(A);I?I=!1:pe.target===P.container&&zt(We.allowOutsideClick)&&$(Wr.backdrop)}},Oe=A=>A instanceof Element||(A=>"object"==typeof A&&A.jquery)(A);const gn=()=>{if(Rn.timeout)return(()=>{const A=zn(),P=parseInt(window.getComputedStyle(A).width);A.style.removeProperty("transition"),A.style.width="100%";const pe=P/parseInt(window.getComputedStyle(A).width)*100;A.style.removeProperty("transition"),A.style.width="".concat(pe,"%")})(),Rn.timeout.stop()},pr=()=>{if(Rn.timeout){const A=Rn.timeout.start();return jr(A),A}};let mr=!1;const Tr={};const si=A=>{for(let P=A.target;P&&P!==document;P=P.parentNode)for(const $ in Tr){const pe=P.getAttribute($);if(pe)return void Tr[$].fire({template:pe})}};var ai=Object.freeze({isValidParameter:In,isUpdatableParameter:Xn,isDeprecatedParameter:dt,argsToParams:A=>{const P={};return"object"!=typeof A[0]||Oe(A[0])?["title","html","icon"].forEach(($,pe)=>{const We=A[pe];"string"==typeof We||Oe(We)?P[$]=We:void 0!==We&&c("Unexpected type of ".concat($,'! Expected "string" or "Element", got ').concat(typeof We))}):Object.assign(P,A[0]),P},isVisible:()=>tr(vn()),clickConfirm:gr,clickDeny:()=>an()&&an().click(),clickCancel:()=>Mn()&&Mn().click(),getContainer:gt,getPopup:vn,getTitle:ot,getHtmlContainer:$e,getImage:yt,getIcon:dn,getInputLabel:()=>fn(Me["input-label"]),getCloseButton:cr,getActions:er,getConfirmButton:Dt,getDenyButton:an,getCancelButton:Mn,getLoader:vr,getFooter:Vn,getTimerProgressBar:zn,getFocusableElements:nn,getValidationMessage:Yt,isLoading:()=>vn().hasAttribute("data-loading"),fire:function tt(){for(var P=arguments.length,$=new Array(P),pe=0;pe<P;pe++)$[pe]=arguments[pe];return new this(...$)},mixin:function vt(A){return class P extends(this){_main(pe,We){return super._main(pe,Object.assign({},A,We))}}},showLoading:So,enableLoading:So,getTimerLeft:()=>Rn.timeout&&Rn.timeout.getTimerLeft(),stopTimer:gn,resumeTimer:pr,toggleTimer:()=>{const A=Rn.timeout;return A&&(A.running?gn():pr())},increaseTimer:A=>{if(Rn.timeout){const P=Rn.timeout.increase(A);return jr(P,!0),P}},isTimerRunning:()=>Rn.timeout&&Rn.timeout.isRunning(),bindClickHandler:function gi(){Tr[arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data-swal-template"]=this,mr||(document.body.addEventListener("click",si),mr=!0)}});let ho;class eo{constructor(){if(typeof window>"u")return;ho=this;for(var P=arguments.length,$=new Array(P),pe=0;pe<P;pe++)$[pe]=arguments[pe];const We=Object.freeze(this.constructor.argsToParams($));Object.defineProperties(this,{params:{value:We,writable:!1,enumerable:!0,configurable:!0}});const Ot=this._main(this.params);Lt.promise.set(this,Ot)}_main(P){let $=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(A=>{!A.backdrop&&A.allowOutsideClick&&Ge('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`');for(const P in A)yr(P),A.toast&&sn(P),Bt(P)})(Object.assign({},$,P)),Rn.currentInstance&&(Rn.currentInstance._destroy(),Kr()&&io()),Rn.currentInstance=this;const pe=to(P,$);Xa(pe),Object.freeze(pe),Rn.timeout&&(Rn.timeout.stop(),delete Rn.timeout),clearTimeout(Rn.restoreFocusTimeout);const We=Gr(this);return Oi(this,pe),Lt.innerParams.set(this,pe),Cn(this,We,pe)}then(P){return Lt.promise.get(this).then(P)}finally(P){return Lt.promise.get(this).finally(P)}}const Cn=(A,P,$)=>new Promise((pe,We)=>{const Ot=_n=>{A.closePopup({isDismissed:!0,dismiss:_n})};Fs.swalPromiseResolve.set(A,pe),Fs.swalPromiseReject.set(A,We),P.confirmButton.onclick=()=>(A=>{const P=Lt.innerParams.get(A);A.disableButtons(),P.input?gs(A,"confirm"):Ys(A,!0)})(A),P.denyButton.onclick=()=>(A=>{const P=Lt.innerParams.get(A);A.disableButtons(),P.returnInputValueOnDeny?gs(A,"deny"):Ro(A,!1)})(A),P.cancelButton.onclick=()=>((A,P)=>{A.disableButtons(),P(Wr.cancel)})(A,Ot),P.closeButton.onclick=()=>Ot(Wr.close),((A,P,$)=>{Lt.innerParams.get(A).toast?Us(A,P,$):(R(P),j(P),te(A,P,$))})(A,P,Ot),((A,P,$,pe)=>{Io(P),$.toast||(P.keydownHandler=We=>Bs(A,We,pe),P.keydownTarget=$.keydownListenerCapture?window:vn(),P.keydownListenerCapture=$.keydownListenerCapture,P.keydownTarget.addEventListener("keydown",P.keydownHandler,{capture:P.keydownListenerCapture}),P.keydownHandlerAdded=!0)})(A,Rn,$,Ot),((A,P)=>{"select"===P.input||"radio"===P.input?Na(A,P):["text","email","number","tel","textarea"].includes(P.input)&&(wt(P.inputValue)||mt(P.inputValue))&&(So(Dt()),bo(A,P))})(A,$),hs($),F(Rn,$,Ot),K(P,$),setTimeout(()=>{P.container.scrollTop=0})}),to=(A,P)=>{const $=(A=>{const P="string"==typeof A.template?document.querySelector(A.template):A.template;if(!P)return{};const $=P.content;return cs($),Object.assign(mo($),lo($),Fi($),wo($),Vr($),Hr($,oo))})(A),pe=Object.assign({},Zt,P,$,A);return pe.showClass=Object.assign({},Zt.showClass,pe.showClass),pe.hideClass=Object.assign({},Zt.hideClass,pe.hideClass),pe},Gr=A=>{const P={popup:vn(),container:gt(),actions:er(),confirmButton:Dt(),denyButton:an(),cancelButton:Mn(),loader:vr(),closeButton:cr(),validationMessage:Yt(),progressSteps:At()};return Lt.domCache.set(A,P),P},F=(A,P,$)=>{const pe=zn();ht(pe),P.timer&&(A.timeout=new wi(()=>{$("timer"),delete A.timeout},P.timer),P.timerProgressBar&&(un(pe),kr(pe,P,"timerProgressBar"),setTimeout(()=>{A.timeout&&A.timeout.running&&jr(P.timer)})))},K=(A,P)=>{if(!P.toast){if(!zt(P.allowEnterKey))return ae();U(A,P)||Vi(0,-1,1)}},U=(A,P)=>P.focusDeny&&tr(A.denyButton)?(A.denyButton.focus(),!0):P.focusCancel&&tr(A.cancelButton)?(A.cancelButton.focus(),!0):!(!P.focusConfirm||!tr(A.confirmButton)||(A.confirmButton.focus(),0)),ae=()=>{document.activeElement instanceof HTMLElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur()};Object.assign(eo.prototype,Sr),Object.assign(eo,ai),Object.keys(Sr).forEach(A=>{eo[A]=function(){if(ho)return ho[A](...arguments)}}),eo.DismissReason=Wr,eo.version="11.4.8";const Se=eo;return Se.default=Se,Se}(),typeof this<"u"&&this.Sweetalert2&&(this.swal=this.sweetAlert=this.Swal=this.SweetAlert=this.Sweetalert2),typeof document<"u"&&function(Gt,De){var W=Gt.createElement("style");if(Gt.getElementsByTagName("head")[0].appendChild(W),W.styleSheet)W.styleSheet.disabled||(W.styleSheet.cssText=De);else try{W.innerHTML=De}catch{W.innerText=De}}(document,'.swal2-popup.swal2-toast{box-sizing:border-box;grid-column:1/4!important;grid-row:1/4!important;grid-template-columns:1fr 99fr 1fr;padding:1em;overflow-y:hidden;background:#fff;box-shadow:0 0 1px rgba(0,0,0,.075),0 1px 2px rgba(0,0,0,.075),1px 2px 4px rgba(0,0,0,.075),1px 3px 8px rgba(0,0,0,.075),2px 4px 16px rgba(0,0,0,.075);pointer-events:all}.swal2-popup.swal2-toast>*{grid-column:2}.swal2-popup.swal2-toast .swal2-title{margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-loading{justify-content:center}.swal2-popup.swal2-toast .swal2-input{height:2em;margin:.5em;font-size:1em}.swal2-popup.swal2-toast .swal2-validation-message{font-size:1em}.swal2-popup.swal2-toast .swal2-footer{margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-popup.swal2-toast .swal2-close{grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-popup.swal2-toast .swal2-html-container{margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-html-container:empty{padding:0}.swal2-popup.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-popup.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-popup.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:700}.swal2-popup.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-popup.swal2-toast .swal2-actions{justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-popup.swal2-toast .swal2-styled{margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-popup.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;transform:rotate(45deg);border-radius:50%}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-.8em;left:-.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-popup.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{-webkit-animation:swal2-toast-animate-success-line-tip .75s;animation:swal2-toast-animate-success-line-tip .75s}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{-webkit-animation:swal2-toast-animate-success-line-long .75s;animation:swal2-toast-animate-success-line-long .75s}.swal2-popup.swal2-toast.swal2-show{-webkit-animation:swal2-toast-show .5s;animation:swal2-toast-show .5s}.swal2-popup.swal2-toast.swal2-hide{-webkit-animation:swal2-toast-hide .1s forwards;animation:swal2-toast-hide .1s forwards}.swal2-container{display:grid;position:fixed;z-index:1060;top:0;right:0;bottom:0;left:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(-webkit-min-content,auto) minmax(-webkit-min-content,auto) minmax(-webkit-min-content,auto);grid-template-rows:minmax(min-content,auto) minmax(min-content,auto) minmax(min-content,auto);height:100%;padding:.625em;overflow-x:hidden;transition:background-color .1s;-webkit-overflow-scrolling:touch}.swal2-container.swal2-backdrop-show,.swal2-container.swal2-noanimation{background:rgba(0,0,0,.4)}.swal2-container.swal2-backdrop-hide{background:0 0!important}.swal2-container.swal2-bottom-start,.swal2-container.swal2-center-start,.swal2-container.swal2-top-start{grid-template-columns:minmax(0,1fr) auto auto}.swal2-container.swal2-bottom,.swal2-container.swal2-center,.swal2-container.swal2-top{grid-template-columns:auto minmax(0,1fr) auto}.swal2-container.swal2-bottom-end,.swal2-container.swal2-center-end,.swal2-container.swal2-top-end{grid-template-columns:auto auto minmax(0,1fr)}.swal2-container.swal2-top-start>.swal2-popup{align-self:start}.swal2-container.swal2-top>.swal2-popup{grid-column:2;align-self:start;justify-self:center}.swal2-container.swal2-top-end>.swal2-popup,.swal2-container.swal2-top-right>.swal2-popup{grid-column:3;align-self:start;justify-self:end}.swal2-container.swal2-center-left>.swal2-popup,.swal2-container.swal2-center-start>.swal2-popup{grid-row:2;align-self:center}.swal2-container.swal2-center>.swal2-popup{grid-column:2;grid-row:2;align-self:center;justify-self:center}.swal2-container.swal2-center-end>.swal2-popup,.swal2-container.swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;align-self:center;justify-self:end}.swal2-container.swal2-bottom-left>.swal2-popup,.swal2-container.swal2-bottom-start>.swal2-popup{grid-column:1;grid-row:3;align-self:end}.swal2-container.swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;justify-self:center;align-self:end}.swal2-container.swal2-bottom-end>.swal2-popup,.swal2-container.swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;align-self:end;justify-self:end}.swal2-container.swal2-grow-fullscreen>.swal2-popup,.swal2-container.swal2-grow-row>.swal2-popup{grid-column:1/4;width:100%}.swal2-container.swal2-grow-column>.swal2-popup,.swal2-container.swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}.swal2-container.swal2-no-transition{transition:none!important}.swal2-popup{display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0,100%);width:32em;max-width:100%;padding:0 0 1.25em;border:none;border-radius:5px;background:#fff;color:#545454;font-family:inherit;font-size:1rem}.swal2-popup:focus{outline:0}.swal2-popup.swal2-loading{overflow-y:hidden}.swal2-title{position:relative;max-width:100%;margin:0;padding:.8em 1em 0;color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word}.swal2-actions{display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:center;width:auto;margin:1.25em auto 0;padding:0}.swal2-actions:not(.swal2-loading) .swal2-styled[disabled]{opacity:.4}.swal2-actions:not(.swal2-loading) .swal2-styled:hover{background-image:linear-gradient(rgba(0,0,0,.1),rgba(0,0,0,.1))}.swal2-actions:not(.swal2-loading) .swal2-styled:active{background-image:linear-gradient(rgba(0,0,0,.2),rgba(0,0,0,.2))}.swal2-loader{display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;-webkit-animation:swal2-rotate-loading 1.5s linear 0s infinite normal;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 transparent #2778c4 transparent}.swal2-styled{margin:.3125em;padding:.625em 1.1em;transition:box-shadow .1s;box-shadow:0 0 0 3px transparent;font-weight:500}.swal2-styled:not([disabled]){cursor:pointer}.swal2-styled.swal2-confirm{border:0;border-radius:.25em;background:initial;background-color:#7066e0;color:#fff;font-size:1em}.swal2-styled.swal2-confirm:focus{box-shadow:0 0 0 3px rgba(112,102,224,.5)}.swal2-styled.swal2-deny{border:0;border-radius:.25em;background:initial;background-color:#dc3741;color:#fff;font-size:1em}.swal2-styled.swal2-deny:focus{box-shadow:0 0 0 3px rgba(220,55,65,.5)}.swal2-styled.swal2-cancel{border:0;border-radius:.25em;background:initial;background-color:#6e7881;color:#fff;font-size:1em}.swal2-styled.swal2-cancel:focus{box-shadow:0 0 0 3px rgba(110,120,129,.5)}.swal2-styled.swal2-default-outline:focus{box-shadow:0 0 0 3px rgba(100,150,200,.5)}.swal2-styled:focus{outline:0}.swal2-styled::-moz-focus-inner{border:0}.swal2-footer{justify-content:center;margin:1em 0 0;padding:1em 1em 0;border-top:1px solid #eee;color:inherit;font-size:1em}.swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto!important;overflow:hidden;border-bottom-right-radius:5px;border-bottom-left-radius:5px}.swal2-timer-progress-bar{width:100%;height:.25em;background:rgba(0,0,0,.2)}.swal2-image{max-width:100%;margin:2em auto 1em}.swal2-close{z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:color .1s,box-shadow .1s;border:none;border-radius:5px;background:0 0;color:#ccc;font-family:serif;font-family:monospace;font-size:2.5em;cursor:pointer;justify-self:end}.swal2-close:hover{transform:none;background:0 0;color:#f27474}.swal2-close:focus{outline:0;box-shadow:inset 0 0 0 3px rgba(100,150,200,.5)}.swal2-close::-moz-focus-inner{border:0}.swal2-html-container{z-index:1;justify-content:center;margin:1em 1.6em .3em;padding:0;overflow:auto;color:inherit;font-size:1.125em;font-weight:400;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word}.swal2-checkbox,.swal2-file,.swal2-input,.swal2-radio,.swal2-select,.swal2-textarea{margin:1em 2em 3px}.swal2-file,.swal2-input,.swal2-textarea{box-sizing:border-box;width:auto;transition:border-color .1s,box-shadow .1s;border:1px solid #d9d9d9;border-radius:.1875em;background:inherit;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px transparent;color:inherit;font-size:1.125em}.swal2-file.swal2-inputerror,.swal2-input.swal2-inputerror,.swal2-textarea.swal2-inputerror{border-color:#f27474!important;box-shadow:0 0 2px #f27474!important}.swal2-file:focus,.swal2-input:focus,.swal2-textarea:focus{border:1px solid #b4dbed;outline:0;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(100,150,200,.5)}.swal2-file::-moz-placeholder,.swal2-input::-moz-placeholder,.swal2-textarea::-moz-placeholder{color:#ccc}.swal2-file:-ms-input-placeholder,.swal2-input:-ms-input-placeholder,.swal2-textarea:-ms-input-placeholder{color:#ccc}.swal2-file::placeholder,.swal2-input::placeholder,.swal2-textarea::placeholder{color:#ccc}.swal2-range{margin:1em 2em 3px;background:#fff}.swal2-range input{width:80%}.swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}.swal2-range input,.swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}.swal2-input{height:2.625em;padding:0 .75em}.swal2-file{width:75%;margin-right:auto;margin-left:auto;background:inherit;font-size:1.125em}.swal2-textarea{height:6.75em;padding:.75em}.swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:inherit;color:inherit;font-size:1.125em}.swal2-checkbox,.swal2-radio{align-items:center;justify-content:center;background:#fff;color:inherit}.swal2-checkbox label,.swal2-radio label{margin:0 .6em;font-size:1.125em}.swal2-checkbox input,.swal2-radio input{flex-shrink:0;margin:0 .4em}.swal2-input-label{display:flex;justify-content:center;margin:1em auto 0}.swal2-validation-message{align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:#f0f0f0;color:#666;font-size:1em;font-weight:300}.swal2-validation-message::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}.swal2-icon{position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;border:.25em solid transparent;border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}.swal2-icon.swal2-error{border-color:#f27474;color:#f27474}.swal2-icon.swal2-error .swal2-x-mark{position:relative;flex-grow:1}.swal2-icon.swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}.swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}.swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}.swal2-icon.swal2-error.swal2-icon-show{-webkit-animation:swal2-animate-error-icon .5s;animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-error.swal2-icon-show .swal2-x-mark{-webkit-animation:swal2-animate-error-x-mark .5s;animation:swal2-animate-error-x-mark .5s}.swal2-icon.swal2-warning{border-color:#facea8;color:#f8bb86}.swal2-icon.swal2-warning.swal2-icon-show{-webkit-animation:swal2-animate-error-icon .5s;animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-warning.swal2-icon-show .swal2-icon-content{-webkit-animation:swal2-animate-i-mark .5s;animation:swal2-animate-i-mark .5s}.swal2-icon.swal2-info{border-color:#9de0f6;color:#3fc3ee}.swal2-icon.swal2-info.swal2-icon-show{-webkit-animation:swal2-animate-error-icon .5s;animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-info.swal2-icon-show .swal2-icon-content{-webkit-animation:swal2-animate-i-mark .8s;animation:swal2-animate-i-mark .8s}.swal2-icon.swal2-question{border-color:#c9dae1;color:#87adbd}.swal2-icon.swal2-question.swal2-icon-show{-webkit-animation:swal2-animate-error-icon .5s;animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-question.swal2-icon-show .swal2-icon-content{-webkit-animation:swal2-animate-question-mark .8s;animation:swal2-animate-question-mark .8s}.swal2-icon.swal2-success{border-color:#a5dc86;color:#a5dc86}.swal2-icon.swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;transform:rotate(45deg);border-radius:50%}.swal2-icon.swal2-success [class^=swal2-success-circular-line][class$=left]{top:-.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}.swal2-icon.swal2-success [class^=swal2-success-circular-line][class$=right]{top:-.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}.swal2-icon.swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-.25em;left:-.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}.swal2-icon.swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}.swal2-icon.swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}.swal2-icon.swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}.swal2-icon.swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-line-tip{-webkit-animation:swal2-animate-success-line-tip .75s;animation:swal2-animate-success-line-tip .75s}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-line-long{-webkit-animation:swal2-animate-success-line-long .75s;animation:swal2-animate-success-line-long .75s}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-circular-line-right{-webkit-animation:swal2-rotate-success-circular-line 4.25s ease-in;animation:swal2-rotate-success-circular-line 4.25s ease-in}.swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:inherit;font-weight:600}.swal2-progress-steps li{display:inline-block;position:relative}.swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:#add8e6;color:#fff}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:#add8e6}.swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}[class^=swal2]{-webkit-tap-highlight-color:transparent}.swal2-show{-webkit-animation:swal2-show .3s;animation:swal2-show .3s}.swal2-hide{-webkit-animation:swal2-hide .15s forwards;animation:swal2-hide .15s forwards}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}@-webkit-keyframes swal2-toast-show{0%{transform:translateY(-.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0)}}@keyframes swal2-toast-show{0%{transform:translateY(-.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0)}}@-webkit-keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@-webkit-keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@-webkit-keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}@-webkit-keyframes swal2-show{0%{transform:scale(.7)}45%{transform:scale(1.05)}80%{transform:scale(.95)}100%{transform:scale(1)}}@keyframes swal2-show{0%{transform:scale(.7)}45%{transform:scale(1.05)}80%{transform:scale(.95)}100%{transform:scale(1)}}@-webkit-keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(.5);opacity:0}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(.5);opacity:0}}@-webkit-keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@-webkit-keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@-webkit-keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@-webkit-keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(.4);opacity:0}50%{margin-top:1.625em;transform:scale(.4);opacity:0}80%{margin-top:-.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(.4);opacity:0}50%{margin-top:1.625em;transform:scale(.4);opacity:0}80%{margin-top:-.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@-webkit-keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0);opacity:1}}@-webkit-keyframes swal2-rotate-loading{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}@keyframes swal2-rotate-loading{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}@-webkit-keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@-webkit-keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto!important}body.swal2-no-backdrop .swal2-container{background-color:transparent!important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px rgba(0,0,0,.4)}@media print{body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow-y:scroll!important}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown) .swal2-container{position:static!important}}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:transparent;pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{top:0;right:auto;bottom:auto;left:50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{top:0;right:0;bottom:auto;left:auto}body.swal2-toast-shown .swal2-container.swal2-top-left,body.swal2-toast-shown .swal2-container.swal2-top-start{top:0;right:auto;bottom:auto;left:0}body.swal2-toast-shown .swal2-container.swal2-center-left,body.swal2-toast-shown .swal2-container.swal2-center-start{top:50%;right:auto;bottom:auto;left:0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{top:50%;right:auto;bottom:auto;left:50%;transform:translate(-50%,-50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{top:50%;right:0;bottom:auto;left:auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-left,body.swal2-toast-shown .swal2-container.swal2-bottom-start{top:auto;right:auto;bottom:0;left:0}body.swal2-toast-shown .swal2-container.swal2-bottom{top:auto;right:auto;bottom:0;left:50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{top:auto;right:0;bottom:0;left:auto}')},655:(or,Gt,De)=>{"use strict";function Zt(ot,$e,yt,At){return new(yt||(yt=Promise))(function(Dt,an){function hr(er){try{Mn(At.next(er))}catch(Vn){an(Vn)}}function vr(er){try{Mn(At.throw(er))}catch(Vn){an(Vn)}}function Mn(er){er.done?Dt(er.value):function Yt(Dt){return Dt instanceof yt?Dt:new yt(function(an){an(Dt)})}(er.value).then(hr,vr)}Mn((At=At.apply(ot,$e||[])).next())})}function Bt(ot){return this instanceof Bt?(this.v=ot,this):new Bt(ot)}function je(ot,$e,yt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Yt,At=yt.apply(ot,$e||[]),Dt=[];return Yt={},an("next"),an("throw"),an("return"),Yt[Symbol.asyncIterator]=function(){return this},Yt;function an(zn){At[zn]&&(Yt[zn]=function(cr){return new Promise(function(Ar,nn){Dt.push([zn,cr,Ar,nn])>1||hr(zn,cr)})})}function hr(zn,cr){try{!function vr(zn){zn.value instanceof Bt?Promise.resolve(zn.value.v).then(Mn,er):Vn(Dt[0][2],zn)}(At[zn](cr))}catch(Ar){Vn(Dt[0][3],Ar)}}function Mn(zn){hr("next",zn)}function er(zn){hr("throw",zn)}function Vn(zn,cr){zn(cr),Dt.shift(),Dt.length&&hr(Dt[0][0],Dt[0][1])}}function Hn(ot){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var yt,$e=ot[Symbol.asyncIterator];return $e?$e.call(ot):(ot=function In(ot){var $e="function"==typeof Symbol&&Symbol.iterator,yt=$e&&ot[$e],At=0;if(yt)return yt.call(ot);if(ot&&"number"==typeof ot.length)return{next:function(){return ot&&At>=ot.length&&(ot=void 0),{value:ot&&ot[At++],done:!ot}}};throw new TypeError($e?"Object is not iterable.":"Symbol.iterator is not defined.")}(ot),yt={},At("next"),At("throw"),At("return"),yt[Symbol.asyncIterator]=function(){return this},yt);function At(Dt){yt[Dt]=ot[Dt]&&function(an){return new Promise(function(hr,vr){!function Yt(Dt,an,hr,vr){Promise.resolve(vr).then(function(Mn){Dt({value:Mn,done:hr})},an)}(hr,vr,(an=ot[Dt](an)).done,an.value)})}}}De.d(Gt,{FC:()=>je,KL:()=>Hn,mG:()=>Zt,qq:()=>Bt})},7340:(or,Gt,De)=>{"use strict";De.d(Gt,{LC:()=>ge,X$:()=>c,ZE:()=>yr,ZN:()=>dt,_7:()=>Ut,_j:()=>W,eR:()=>mt,jt:()=>Le,k1:()=>sn,l3:()=>Ge,oB:()=>zt,oQ:()=>Zt,vP:()=>qt});class W{}class ge{}const Ge="*";function c(Bt,je){return{type:7,name:Bt,definitions:je,options:{}}}function Le(Bt,je=null){return{type:4,styles:je,timings:Bt}}function qt(Bt,je=null){return{type:2,steps:Bt,options:je}}function zt(Bt){return{type:6,styles:Bt,offset:null}}function mt(Bt,je,Kt=null){return{type:1,expr:Bt,animation:je,options:Kt}}function Zt(Bt,je=null){return{type:8,animation:Bt,options:je}}function Ut(Bt,je=null){return{type:10,animation:Bt,options:je}}function Xn(Bt){Promise.resolve().then(Bt)}class dt{constructor(je=0,Kt=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=je+Kt}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(je=>je()),this._onDoneFns=[])}onStart(je){this._originalOnStartFns.push(je),this._onStartFns.push(je)}onDone(je){this._originalOnDoneFns.push(je),this._onDoneFns.push(je)}onDestroy(je){this._onDestroyFns.push(je)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){Xn(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(je=>je()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(je=>je()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(je){this._position=this.totalTime?je*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(je){const Kt="start"==je?this._onStartFns:this._onDoneFns;Kt.forEach(Hn=>Hn()),Kt.length=0}}class yr{constructor(je){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=je;let Kt=0,Hn=0,Me=0;const Wt=this.players.length;0==Wt?Xn(()=>this._onFinish()):this.players.forEach(gt=>{gt.onDone(()=>{++Kt==Wt&&this._onFinish()}),gt.onDestroy(()=>{++Hn==Wt&&this._onDestroy()}),gt.onStart(()=>{++Me==Wt&&this._onStart()})}),this.totalTime=this.players.reduce((gt,ft)=>Math.max(gt,ft.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(je=>je()),this._onDoneFns=[])}init(){this.players.forEach(je=>je.init())}onStart(je){this._onStartFns.push(je)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(je=>je()),this._onStartFns=[])}onDone(je){this._onDoneFns.push(je)}onDestroy(je){this._onDestroyFns.push(je)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(je=>je.play())}pause(){this.players.forEach(je=>je.pause())}restart(){this.players.forEach(je=>je.restart())}finish(){this._onFinish(),this.players.forEach(je=>je.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(je=>je.destroy()),this._onDestroyFns.forEach(je=>je()),this._onDestroyFns=[])}reset(){this.players.forEach(je=>je.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(je){const Kt=je*this.totalTime;this.players.forEach(Hn=>{const Me=Hn.totalTime?Math.min(1,Kt/Hn.totalTime):1;Hn.setPosition(Me)})}getPosition(){const je=this.players.reduce((Kt,Hn)=>null===Kt||Hn.totalTime>Kt.totalTime?Hn:Kt,null);return null!=je?je.getPosition():0}beforeDestroy(){this.players.forEach(je=>{je.beforeDestroy&&je.beforeDestroy()})}triggerCallback(je){const Kt="start"==je?this._onStartFns:this._onDoneFns;Kt.forEach(Hn=>Hn()),Kt.length=0}}const sn="!"},6895:(or,Gt,De)=>{"use strict";De.d(Gt,{Do:()=>yr,EM:()=>Ya,HT:()=>c,JF:()=>gr,JJ:()=>hs,K0:()=>en,Mx:()=>Ba,O5:()=>pn,PC:()=>rr,S$:()=>In,V_:()=>wt,Ye:()=>sn,b0:()=>dt,bD:()=>Mo,ez:()=>Es,mk:()=>oi,q:()=>Ge,sg:()=>xo,tP:()=>mo,w_:()=>Le});var W=De(8256);let ge=null;function Ge(){return ge}function c(F){ge||(ge=F)}class Le{}const en=new W.OlP("DocumentToken");let qt=(()=>{class F{historyGo(U){throw new Error("Not implemented")}}return F.\u0275fac=function(U){return new(U||F)},F.\u0275prov=W.Yz7({token:F,factory:function(){return function zt(){return(0,W.LFG)(Et)}()},providedIn:"platform"}),F})();const wt=new W.OlP("Location Initialized");let Et=(()=>{class F extends qt{constructor(U){super(),this._doc=U,this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Ge().getBaseHref(this._doc)}onPopState(U){const ae=Ge().getGlobalEventTarget(this._doc,"window");return ae.addEventListener("popstate",U,!1),()=>ae.removeEventListener("popstate",U)}onHashChange(U){const ae=Ge().getGlobalEventTarget(this._doc,"window");return ae.addEventListener("hashchange",U,!1),()=>ae.removeEventListener("hashchange",U)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(U){this._location.pathname=U}pushState(U,ae,Se){mt()?this._history.pushState(U,ae,Se):this._location.hash=Se}replaceState(U,ae,Se){mt()?this._history.replaceState(U,ae,Se):this._location.hash=Se}forward(){this._history.forward()}back(){this._history.back()}historyGo(U=0){this._history.go(U)}getState(){return this._history.state}}return F.\u0275fac=function(U){return new(U||F)(W.LFG(en))},F.\u0275prov=W.Yz7({token:F,factory:function(){return function Zt(){return new Et((0,W.LFG)(en))}()},providedIn:"platform"}),F})();function mt(){return!!window.history.pushState}function Pn(F,K){if(0==F.length)return K;if(0==K.length)return F;let U=0;return F.endsWith("/")&&U++,K.startsWith("/")&&U++,2==U?F+K.substring(1):1==U?F+K:F+"/"+K}function Ut(F){const K=F.match(/#|\?|$/),U=K&&K.index||F.length;return F.slice(0,U-("/"===F[U-1]?1:0))+F.slice(U)}function cn(F){return F&&"?"!==F[0]?"?"+F:F}let In=(()=>{class F{historyGo(U){throw new Error("Not implemented")}}return F.\u0275fac=function(U){return new(U||F)},F.\u0275prov=W.Yz7({token:F,factory:function(){return(0,W.f3M)(dt)},providedIn:"root"}),F})();const Xn=new W.OlP("appBaseHref");let dt=(()=>{class F extends In{constructor(U,ae){super(),this._platformLocation=U,this._removeListenerFns=[],this._baseHref=ae??this._platformLocation.getBaseHrefFromDOM()??(0,W.f3M)(en).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(U){this._removeListenerFns.push(this._platformLocation.onPopState(U),this._platformLocation.onHashChange(U))}getBaseHref(){return this._baseHref}prepareExternalUrl(U){return Pn(this._baseHref,U)}path(U=!1){const ae=this._platformLocation.pathname+cn(this._platformLocation.search),Se=this._platformLocation.hash;return Se&&U?`${ae}${Se}`:ae}pushState(U,ae,Se,A){const P=this.prepareExternalUrl(Se+cn(A));this._platformLocation.pushState(U,ae,P)}replaceState(U,ae,Se,A){const P=this.prepareExternalUrl(Se+cn(A));this._platformLocation.replaceState(U,ae,P)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(U=0){this._platformLocation.historyGo?.(U)}}return F.\u0275fac=function(U){return new(U||F)(W.LFG(qt),W.LFG(Xn,8))},F.\u0275prov=W.Yz7({token:F,factory:F.\u0275fac,providedIn:"root"}),F})(),yr=(()=>{class F extends In{constructor(U,ae){super(),this._platformLocation=U,this._baseHref="",this._removeListenerFns=[],null!=ae&&(this._baseHref=ae)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(U){this._removeListenerFns.push(this._platformLocation.onPopState(U),this._platformLocation.onHashChange(U))}getBaseHref(){return this._baseHref}path(U=!1){let ae=this._platformLocation.hash;return null==ae&&(ae="#"),ae.length>0?ae.substring(1):ae}prepareExternalUrl(U){const ae=Pn(this._baseHref,U);return ae.length>0?"#"+ae:ae}pushState(U,ae,Se,A){let P=this.prepareExternalUrl(Se+cn(A));0==P.length&&(P=this._platformLocation.pathname),this._platformLocation.pushState(U,ae,P)}replaceState(U,ae,Se,A){let P=this.prepareExternalUrl(Se+cn(A));0==P.length&&(P=this._platformLocation.pathname),this._platformLocation.replaceState(U,ae,P)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(U=0){this._platformLocation.historyGo?.(U)}}return F.\u0275fac=function(U){return new(U||F)(W.LFG(qt),W.LFG(Xn,8))},F.\u0275prov=W.Yz7({token:F,factory:F.\u0275fac}),F})(),sn=(()=>{class F{constructor(U){this._subject=new W.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=U;const ae=this._locationStrategy.getBaseHref();this._basePath=function Hn(F){if(new RegExp("^(https?:)?//").test(F)){const[,U]=F.split(/\/\/[^\/]+/);return U}return F}(Ut(Kt(ae))),this._locationStrategy.onPopState(Se=>{this._subject.emit({url:this.path(!0),pop:!0,state:Se.state,type:Se.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(U=!1){return this.normalize(this._locationStrategy.path(U))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(U,ae=""){return this.path()==this.normalize(U+cn(ae))}normalize(U){return F.stripTrailingSlash(function je(F,K){if(!F||!K.startsWith(F))return K;const U=K.substring(F.length);return""===U||["/",";","?","#"].includes(U[0])?U:K}(this._basePath,Kt(U)))}prepareExternalUrl(U){return U&&"/"!==U[0]&&(U="/"+U),this._locationStrategy.prepareExternalUrl(U)}go(U,ae="",Se=null){this._locationStrategy.pushState(Se,"",U,ae),this._notifyUrlChangeListeners(this.prepareExternalUrl(U+cn(ae)),Se)}replaceState(U,ae="",Se=null){this._locationStrategy.replaceState(Se,"",U,ae),this._notifyUrlChangeListeners(this.prepareExternalUrl(U+cn(ae)),Se)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(U=0){this._locationStrategy.historyGo?.(U)}onUrlChange(U){return this._urlChangeListeners.push(U),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(ae=>{this._notifyUrlChangeListeners(ae.url,ae.state)})),()=>{const ae=this._urlChangeListeners.indexOf(U);this._urlChangeListeners.splice(ae,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(U="",ae){this._urlChangeListeners.forEach(Se=>Se(U,ae))}subscribe(U,ae,Se){return this._subject.subscribe({next:U,error:ae,complete:Se})}}return F.normalizeQueryParams=cn,F.joinWithSlash=Pn,F.stripTrailingSlash=Ut,F.\u0275fac=function(U){return new(U||F)(W.LFG(In))},F.\u0275prov=W.Yz7({token:F,factory:function(){return function Bt(){return new sn((0,W.LFG)(In))}()},providedIn:"root"}),F})();function Kt(F){return F.replace(/\/index.html$/,"")}var Wt=(()=>((Wt=Wt||{})[Wt.Decimal=0]="Decimal",Wt[Wt.Percent=1]="Percent",Wt[Wt.Currency=2]="Currency",Wt[Wt.Scientific=3]="Scientific",Wt))(),dn=(()=>((dn=dn||{})[dn.Decimal=0]="Decimal",dn[dn.Group=1]="Group",dn[dn.List=2]="List",dn[dn.PercentSign=3]="PercentSign",dn[dn.PlusSign=4]="PlusSign",dn[dn.MinusSign=5]="MinusSign",dn[dn.Exponential=6]="Exponential",dn[dn.SuperscriptingExponent=7]="SuperscriptingExponent",dn[dn.PerMille=8]="PerMille",dn[dn.Infinity=9]="Infinity",dn[dn.NaN=10]="NaN",dn[dn.TimeSeparator=11]="TimeSeparator",dn[dn.CurrencyDecimal=12]="CurrencyDecimal",dn[dn.CurrencyGroup=13]="CurrencyGroup",dn))();function Vn(F,K){const U=(0,W.cg1)(F),ae=U[W.wAp.NumberSymbols][K];if(typeof ae>"u"){if(K===dn.CurrencyDecimal)return U[W.wAp.NumberSymbols][dn.Decimal];if(K===dn.CurrencyGroup)return U[W.wAp.NumberSymbols][dn.Group]}return ae}const se=/^(\d+)?\.((\d+)(-(\d+))?)?$/,X=22,oe=".",_e="0",Ue=";",ct=",",lt="#";function ki(F){const K=parseInt(F);if(isNaN(K))throw new Error("Invalid integer literal when parsing "+F);return K}function Ba(F,K){K=encodeURIComponent(K);for(const U of F.split(";")){const ae=U.indexOf("="),[Se,A]=-1==ae?[U,""]:[U.slice(0,ae),U.slice(ae+1)];if(Se.trim()===K)return decodeURIComponent(A)}return null}const Li=/\s+/,ar=[];let oi=(()=>{class F{constructor(U,ae,Se,A){this._iterableDiffers=U,this._keyValueDiffers=ae,this._ngEl=Se,this._renderer=A,this.initialClasses=ar,this.stateMap=new Map}set klass(U){this.initialClasses=null!=U?U.trim().split(Li):ar}set ngClass(U){this.rawClass="string"==typeof U?U.trim().split(Li):U}ngDoCheck(){for(const ae of this.initialClasses)this._updateState(ae,!0);const U=this.rawClass;if(Array.isArray(U)||U instanceof Set)for(const ae of U)this._updateState(ae,!0);else if(null!=U)for(const ae of Object.keys(U))this._updateState(ae,Boolean(U[ae]));this._applyStateDiff()}_updateState(U,ae){const Se=this.stateMap.get(U);void 0!==Se?(Se.enabled!==ae&&(Se.changed=!0,Se.enabled=ae),Se.touched=!0):this.stateMap.set(U,{enabled:ae,changed:!0,touched:!0})}_applyStateDiff(){for(const U of this.stateMap){const ae=U[0],Se=U[1];Se.changed?(this._toggleClass(ae,Se.enabled),Se.changed=!1):Se.touched||(Se.enabled&&this._toggleClass(ae,!1),this.stateMap.delete(ae)),Se.touched=!1}}_toggleClass(U,ae){(U=U.trim()).length>0&&U.split(Li).forEach(Se=>{ae?this._renderer.addClass(this._ngEl.nativeElement,Se):this._renderer.removeClass(this._ngEl.nativeElement,Se)})}}return F.\u0275fac=function(U){return new(U||F)(W.Y36(W.ZZ4),W.Y36(W.aQg),W.Y36(W.SBq),W.Y36(W.Qsj))},F.\u0275dir=W.lG2({type:F,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),F})();class Yn{constructor(K,U,ae,Se){this.$implicit=K,this.ngForOf=U,this.index=ae,this.count=Se}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let xo=(()=>{class F{set ngForOf(U){this._ngForOf=U,this._ngForOfDirty=!0}set ngForTrackBy(U){this._trackByFn=U}get ngForTrackBy(){return this._trackByFn}constructor(U,ae,Se){this._viewContainer=U,this._template=ae,this._differs=Se,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(U){U&&(this._template=U)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const U=this._ngForOf;!this._differ&&U&&(this._differ=this._differs.find(U).create(this.ngForTrackBy))}if(this._differ){const U=this._differ.diff(this._ngForOf);U&&this._applyChanges(U)}}_applyChanges(U){const ae=this._viewContainer;U.forEachOperation((Se,A,P)=>{if(null==Se.previousIndex)ae.createEmbeddedView(this._template,new Yn(Se.item,this._ngForOf,-1,-1),null===P?void 0:P);else if(null==P)ae.remove(null===A?void 0:A);else if(null!==A){const $=ae.get(A);ae.move($,P),No($,Se)}});for(let Se=0,A=ae.length;Se<A;Se++){const $=ae.get(Se).context;$.index=Se,$.count=A,$.ngForOf=this._ngForOf}U.forEachIdentityChange(Se=>{No(ae.get(Se.currentIndex),Se)})}static ngTemplateContextGuard(U,ae){return!0}}return F.\u0275fac=function(U){return new(U||F)(W.Y36(W.s_b),W.Y36(W.Rgc),W.Y36(W.ZZ4))},F.\u0275dir=W.lG2({type:F,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),F})();function No(F,K){F.context.$implicit=K.item}let pn=(()=>{class F{constructor(U,ae){this._viewContainer=U,this._context=new Jn,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=ae}set ngIf(U){this._context.$implicit=this._context.ngIf=U,this._updateView()}set ngIfThen(U){Br("ngIfThen",U),this._thenTemplateRef=U,this._thenViewRef=null,this._updateView()}set ngIfElse(U){Br("ngIfElse",U),this._elseTemplateRef=U,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(U,ae){return!0}}return F.\u0275fac=function(U){return new(U||F)(W.Y36(W.s_b),W.Y36(W.Rgc))},F.\u0275dir=W.lG2({type:F,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),F})();class Jn{constructor(){this.$implicit=null,this.ngIf=null}}function Br(F,K){if(K&&!K.createEmbeddedView)throw new Error(`${F} must be a TemplateRef, but received '${(0,W.AaK)(K)}'.`)}let rr=(()=>{class F{constructor(U,ae,Se){this._ngEl=U,this._differs=ae,this._renderer=Se,this._ngStyle=null,this._differ=null}set ngStyle(U){this._ngStyle=U,!this._differ&&U&&(this._differ=this._differs.find(U).create())}ngDoCheck(){if(this._differ){const U=this._differ.diff(this._ngStyle);U&&this._applyChanges(U)}}_setStyle(U,ae){const[Se,A]=U.split("."),P=-1===Se.indexOf("-")?void 0:W.JOm.DashCase;null!=ae?this._renderer.setStyle(this._ngEl.nativeElement,Se,A?`${ae}${A}`:ae,P):this._renderer.removeStyle(this._ngEl.nativeElement,Se,P)}_applyChanges(U){U.forEachRemovedItem(ae=>this._setStyle(ae.key,null)),U.forEachAddedItem(ae=>this._setStyle(ae.key,ae.currentValue)),U.forEachChangedItem(ae=>this._setStyle(ae.key,ae.currentValue))}}return F.\u0275fac=function(U){return new(U||F)(W.Y36(W.SBq),W.Y36(W.aQg),W.Y36(W.Qsj))},F.\u0275dir=W.lG2({type:F,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),F})(),mo=(()=>{class F{constructor(U){this._viewContainerRef=U,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(U){if(U.ngTemplateOutlet||U.ngTemplateOutletInjector){const ae=this._viewContainerRef;if(this._viewRef&&ae.remove(ae.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:Se,ngTemplateOutletContext:A,ngTemplateOutletInjector:P}=this;this._viewRef=ae.createEmbeddedView(Se,A,P?{injector:P}:void 0)}else this._viewRef=null}else this._viewRef&&U.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return F.\u0275fac=function(U){return new(U||F)(W.Y36(W.s_b))},F.\u0275dir=W.lG2({type:F,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[W.TTD]}),F})();let hs=(()=>{class F{constructor(U){this._locale=U}transform(U,ae,Se){if(!function ks(F){return!(null==F||""===F||F!=F)}(U))return null;Se=Se||this._locale;try{return function nr(F,K,U){return function Lt(F,K,U,ae,Se,A,P=!1){let $="",pe=!1;if(isFinite(F)){let We=function Cr(F){let ae,Se,A,P,$,K=Math.abs(F)+"",U=0;for((Se=K.indexOf(oe))>-1&&(K=K.replace(oe,"")),(A=K.search(/e/i))>0?(Se<0&&(Se=A),Se+=+K.slice(A+1),K=K.substring(0,A)):Se<0&&(Se=K.length),A=0;K.charAt(A)===_e;A++);if(A===($=K.length))ae=[0],Se=1;else{for($--;K.charAt($)===_e;)$--;for(Se-=A,ae=[],P=0;A<=$;A++,P++)ae[P]=Number(K.charAt(A))}return Se>X&&(ae=ae.splice(0,X-1),U=Se-1,Se=1),{digits:ae,exponent:U,integerLen:Se}}(F);P&&(We=function zr(F){if(0===F.digits[0])return F;const K=F.digits.length-F.integerLen;return F.exponent?F.exponent+=2:(0===K?F.digits.push(0,0):1===K&&F.digits.push(0),F.integerLen+=2),F}(We));let Ot=K.minInt,_n=K.minFrac,qn=K.maxFrac;if(A){const ao=A.match(se);if(null===ao)throw new Error(`${A} is not a valid digit info`);const Ki=ao[1],Pa=ao[3],_a=ao[5];null!=Ki&&(Ot=ki(Ki)),null!=Pa&&(_n=ki(Pa)),null!=_a?qn=ki(_a):null!=Pa&&_n>qn&&(qn=_n)}!function Xo(F,K,U){if(K>U)throw new Error(`The minimum number of digits after fraction (${K}) is higher than the maximum (${U}).`);let ae=F.digits,Se=ae.length-F.integerLen;const A=Math.min(Math.max(K,Se),U);let P=A+F.integerLen,$=ae[P];if(P>0){ae.splice(Math.max(F.integerLen,P));for(let _n=P;_n<ae.length;_n++)ae[_n]=0}else{Se=Math.max(0,Se),F.integerLen=1,ae.length=Math.max(1,P=A+1),ae[0]=0;for(let _n=1;_n<P;_n++)ae[_n]=0}if($>=5)if(P-1<0){for(let _n=0;_n>P;_n--)ae.unshift(0),F.integerLen++;ae.unshift(1),F.integerLen++}else ae[P-1]++;for(;Se<Math.max(0,A);Se++)ae.push(0);let pe=0!==A;const We=K+F.integerLen,Ot=ae.reduceRight(function(_n,qn,Bn,_t){return _t[Bn]=(qn+=_n)<10?qn:qn-10,pe&&(0===_t[Bn]&&Bn>=We?_t.pop():pe=!1),qn>=10?1:0},0);Ot&&(ae.unshift(Ot),F.integerLen++)}(We,_n,qn);let Bn=We.digits,_t=We.integerLen;const zi=We.exponent;let qo=[];for(pe=Bn.every(ao=>!ao);_t<Ot;_t++)Bn.unshift(0);for(;_t<0;_t++)Bn.unshift(0);_t>0?qo=Bn.splice(_t,Bn.length):(qo=Bn,Bn=[0]);const Ci=[];for(Bn.length>=K.lgSize&&Ci.unshift(Bn.splice(-K.lgSize,Bn.length).join(""));Bn.length>K.gSize;)Ci.unshift(Bn.splice(-K.gSize,Bn.length).join(""));Bn.length&&Ci.unshift(Bn.join("")),$=Ci.join(Vn(U,ae)),qo.length&&($+=Vn(U,Se)+qo.join("")),zi&&($+=Vn(U,dn.Exponential)+"+"+zi)}else $=Vn(U,dn.Infinity);return $=F<0&&!pe?K.negPre+$+K.negSuf:K.posPre+$+K.posSuf,$}(F,function En(F,K="-"){const U={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},ae=F.split(Ue),Se=ae[0],A=ae[1],P=-1!==Se.indexOf(oe)?Se.split(oe):[Se.substring(0,Se.lastIndexOf(_e)+1),Se.substring(Se.lastIndexOf(_e)+1)],$=P[0],pe=P[1]||"";U.posPre=$.substring(0,$.indexOf(lt));for(let Ot=0;Ot<pe.length;Ot++){const _n=pe.charAt(Ot);_n===_e?U.minFrac=U.maxFrac=Ot+1:_n===lt?U.maxFrac=Ot+1:U.posSuf+=_n}const We=$.split(ct);if(U.gSize=We[1]?We[1].length:0,U.lgSize=We[2]||We[1]?(We[2]||We[1]).length:0,A){const Ot=Se.length-U.posPre.length-U.posSuf.length,_n=A.indexOf(lt);U.negPre=A.substring(0,_n).replace(/'/g,""),U.negSuf=A.slice(_n+Ot).replace(/'/g,"")}else U.negPre=K+U.posPre,U.negSuf=U.posSuf;return U}(function zn(F,K){return(0,W.cg1)(F)[W.wAp.NumberFormats][K]}(K,Wt.Decimal),Vn(K,dn.MinusSign)),K,dn.Group,dn.Decimal,U)}(function Ko(F){if("string"==typeof F&&!isNaN(Number(F)-parseFloat(F)))return Number(F);if("number"!=typeof F)throw new Error(`${F} is not a number`);return F}(U),Se,ae)}catch(A){throw function Fi(F,K){return new W.vHH(2100,!1)}()}}}return F.\u0275fac=function(U){return new(U||F)(W.Y36(W.soG,16))},F.\u0275pipe=W.Yjl({name:"number",type:F,pure:!0,standalone:!0}),F})();let Es=(()=>{class F{}return F.\u0275fac=function(U){return new(U||F)},F.\u0275mod=W.oAB({type:F}),F.\u0275inj=W.cJS({}),F})();const Mo="browser";let Ya=(()=>{class F{}return F.\u0275prov=(0,W.Yz7)({token:F,providedIn:"root",factory:()=>new ua((0,W.LFG)(en),window)}),F})();class ua{constructor(K,U){this.document=K,this.window=U,this.offset=()=>[0,0]}setOffset(K){this.offset=Array.isArray(K)?()=>K:K}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(K){this.supportsScrolling()&&this.window.scrollTo(K[0],K[1])}scrollToAnchor(K){if(!this.supportsScrolling())return;const U=function Fs(F,K){const U=F.getElementById(K)||F.getElementsByName(K)[0];if(U)return U;if("function"==typeof F.createTreeWalker&&F.body&&(F.body.createShadowRoot||F.body.attachShadow)){const ae=F.createTreeWalker(F.body,NodeFilter.SHOW_ELEMENT);let Se=ae.currentNode;for(;Se;){const A=Se.shadowRoot;if(A){const P=A.getElementById(K)||A.querySelector(`[name="${K}"]`);if(P)return P}Se=ae.nextNode()}}return null}(this.document,K);U&&(this.scrollToElement(U),U.focus())}setHistoryScrollRestoration(K){if(this.supportScrollRestoration()){const U=this.window.history;U&&U.scrollRestoration&&(U.scrollRestoration=K)}}scrollToElement(K){const U=K.getBoundingClientRect(),ae=U.left+this.window.pageXOffset,Se=U.top+this.window.pageYOffset,A=this.offset();this.window.scrollTo(ae-A[0],Se-A[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const K=Yo(this.window.history)||Yo(Object.getPrototypeOf(this.window.history));return!(!K||!K.writable&&!K.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function Yo(F){return Object.getOwnPropertyDescriptor(F,"scrollRestoration")}class gr{}},529:(or,Gt,De)=>{"use strict";De.d(Gt,{JF:()=>Rn,PG:()=>zt,WM:()=>Et,eN:()=>$e});var W=De(6895),ge=De(8256),Ge=De(9646),c=De(9751),Le=De(4351),en=De(9300),qt=De(4004);class zt{}class wt{}class Et{constructor(Fe){this.normalizedNames=new Map,this.lazyUpdate=null,Fe?this.lazyInit="string"==typeof Fe?()=>{this.headers=new Map,Fe.split("\n").forEach(Ne=>{const Rt=Ne.indexOf(":");if(Rt>0){const It=Ne.slice(0,Rt),On=It.toLowerCase(),ce=Ne.slice(Rt+1).trim();this.maybeSetNormalizedName(It,On),this.headers.has(On)?this.headers.get(On).push(ce):this.headers.set(On,[ce])}})}:()=>{this.headers=new Map,Object.keys(Fe).forEach(Ne=>{let Rt=Fe[Ne];const It=Ne.toLowerCase();"string"==typeof Rt&&(Rt=[Rt]),Rt.length>0&&(this.headers.set(It,Rt),this.maybeSetNormalizedName(Ne,It))})}:this.headers=new Map}has(Fe){return this.init(),this.headers.has(Fe.toLowerCase())}get(Fe){this.init();const Ne=this.headers.get(Fe.toLowerCase());return Ne&&Ne.length>0?Ne[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(Fe){return this.init(),this.headers.get(Fe.toLowerCase())||null}append(Fe,Ne){return this.clone({name:Fe,value:Ne,op:"a"})}set(Fe,Ne){return this.clone({name:Fe,value:Ne,op:"s"})}delete(Fe,Ne){return this.clone({name:Fe,value:Ne,op:"d"})}maybeSetNormalizedName(Fe,Ne){this.normalizedNames.has(Ne)||this.normalizedNames.set(Ne,Fe)}init(){this.lazyInit&&(this.lazyInit instanceof Et?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(Fe=>this.applyUpdate(Fe)),this.lazyUpdate=null))}copyFrom(Fe){Fe.init(),Array.from(Fe.headers.keys()).forEach(Ne=>{this.headers.set(Ne,Fe.headers.get(Ne)),this.normalizedNames.set(Ne,Fe.normalizedNames.get(Ne))})}clone(Fe){const Ne=new Et;return Ne.lazyInit=this.lazyInit&&this.lazyInit instanceof Et?this.lazyInit:this,Ne.lazyUpdate=(this.lazyUpdate||[]).concat([Fe]),Ne}applyUpdate(Fe){const Ne=Fe.name.toLowerCase();switch(Fe.op){case"a":case"s":let Rt=Fe.value;if("string"==typeof Rt&&(Rt=[Rt]),0===Rt.length)return;this.maybeSetNormalizedName(Fe.name,Ne);const It=("a"===Fe.op?this.headers.get(Ne):void 0)||[];It.push(...Rt),this.headers.set(Ne,It);break;case"d":const On=Fe.value;if(On){let ce=this.headers.get(Ne);if(!ce)return;ce=ce.filter(q=>-1===On.indexOf(q)),0===ce.length?(this.headers.delete(Ne),this.normalizedNames.delete(Ne)):this.headers.set(Ne,ce)}else this.headers.delete(Ne),this.normalizedNames.delete(Ne)}}forEach(Fe){this.init(),Array.from(this.normalizedNames.keys()).forEach(Ne=>Fe(this.normalizedNames.get(Ne),this.headers.get(Ne)))}}class Zt{encodeKey(Fe){return In(Fe)}encodeValue(Fe){return In(Fe)}decodeKey(Fe){return decodeURIComponent(Fe)}decodeValue(Fe){return decodeURIComponent(Fe)}}const Ut=/%(\d[a-f0-9])/gi,cn={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function In(Je){return encodeURIComponent(Je).replace(Ut,(Fe,Ne)=>cn[Ne]??Fe)}function Xn(Je){return`${Je}`}class dt{constructor(Fe={}){if(this.updates=null,this.cloneFrom=null,this.encoder=Fe.encoder||new Zt,Fe.fromString){if(Fe.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function Pn(Je,Fe){const Ne=new Map;return Je.length>0&&Je.replace(/^\?/,"").split("&").forEach(It=>{const On=It.indexOf("="),[ce,q]=-1==On?[Fe.decodeKey(It),""]:[Fe.decodeKey(It.slice(0,On)),Fe.decodeValue(It.slice(On+1))],Y=Ne.get(ce)||[];Y.push(q),Ne.set(ce,Y)}),Ne}(Fe.fromString,this.encoder)}else Fe.fromObject?(this.map=new Map,Object.keys(Fe.fromObject).forEach(Ne=>{const Rt=Fe.fromObject[Ne],It=Array.isArray(Rt)?Rt.map(Xn):[Xn(Rt)];this.map.set(Ne,It)})):this.map=null}has(Fe){return this.init(),this.map.has(Fe)}get(Fe){this.init();const Ne=this.map.get(Fe);return Ne?Ne[0]:null}getAll(Fe){return this.init(),this.map.get(Fe)||null}keys(){return this.init(),Array.from(this.map.keys())}append(Fe,Ne){return this.clone({param:Fe,value:Ne,op:"a"})}appendAll(Fe){const Ne=[];return Object.keys(Fe).forEach(Rt=>{const It=Fe[Rt];Array.isArray(It)?It.forEach(On=>{Ne.push({param:Rt,value:On,op:"a"})}):Ne.push({param:Rt,value:It,op:"a"})}),this.clone(Ne)}set(Fe,Ne){return this.clone({param:Fe,value:Ne,op:"s"})}delete(Fe,Ne){return this.clone({param:Fe,value:Ne,op:"d"})}toString(){return this.init(),this.keys().map(Fe=>{const Ne=this.encoder.encodeKey(Fe);return this.map.get(Fe).map(Rt=>Ne+"="+this.encoder.encodeValue(Rt)).join("&")}).filter(Fe=>""!==Fe).join("&")}clone(Fe){const Ne=new dt({encoder:this.encoder});return Ne.cloneFrom=this.cloneFrom||this,Ne.updates=(this.updates||[]).concat(Fe),Ne}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(Fe=>this.map.set(Fe,this.cloneFrom.map.get(Fe))),this.updates.forEach(Fe=>{switch(Fe.op){case"a":case"s":const Ne=("a"===Fe.op?this.map.get(Fe.param):void 0)||[];Ne.push(Xn(Fe.value)),this.map.set(Fe.param,Ne);break;case"d":if(void 0===Fe.value){this.map.delete(Fe.param);break}{let Rt=this.map.get(Fe.param)||[];const It=Rt.indexOf(Xn(Fe.value));-1!==It&&Rt.splice(It,1),Rt.length>0?this.map.set(Fe.param,Rt):this.map.delete(Fe.param)}}}),this.cloneFrom=this.updates=null)}}class sn{constructor(){this.map=new Map}set(Fe,Ne){return this.map.set(Fe,Ne),this}get(Fe){return this.map.has(Fe)||this.map.set(Fe,Fe.defaultValue()),this.map.get(Fe)}delete(Fe){return this.map.delete(Fe),this}has(Fe){return this.map.has(Fe)}keys(){return this.map.keys()}}function je(Je){return typeof ArrayBuffer<"u"&&Je instanceof ArrayBuffer}function Kt(Je){return typeof Blob<"u"&&Je instanceof Blob}function Hn(Je){return typeof FormData<"u"&&Je instanceof FormData}class Wt{constructor(Fe,Ne,Rt,It){let On;if(this.url=Ne,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=Fe.toUpperCase(),function Bt(Je){switch(Je){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||It?(this.body=void 0!==Rt?Rt:null,On=It):On=Rt,On&&(this.reportProgress=!!On.reportProgress,this.withCredentials=!!On.withCredentials,On.responseType&&(this.responseType=On.responseType),On.headers&&(this.headers=On.headers),On.context&&(this.context=On.context),On.params&&(this.params=On.params)),this.headers||(this.headers=new Et),this.context||(this.context=new sn),this.params){const ce=this.params.toString();if(0===ce.length)this.urlWithParams=Ne;else{const q=Ne.indexOf("?");this.urlWithParams=Ne+(-1===q?"?":q<Ne.length-1?"&":"")+ce}}else this.params=new dt,this.urlWithParams=Ne}serializeBody(){return null===this.body?null:je(this.body)||Kt(this.body)||Hn(this.body)||function Me(Je){return typeof URLSearchParams<"u"&&Je instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof dt?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Hn(this.body)?null:Kt(this.body)?this.body.type||null:je(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof dt?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(Fe={}){const Ne=Fe.method||this.method,Rt=Fe.url||this.url,It=Fe.responseType||this.responseType,On=void 0!==Fe.body?Fe.body:this.body,ce=void 0!==Fe.withCredentials?Fe.withCredentials:this.withCredentials,q=void 0!==Fe.reportProgress?Fe.reportProgress:this.reportProgress;let Y=Fe.headers||this.headers,de=Fe.params||this.params;const Ee=Fe.context??this.context;return void 0!==Fe.setHeaders&&(Y=Object.keys(Fe.setHeaders).reduce((ie,se)=>ie.set(se,Fe.setHeaders[se]),Y)),Fe.setParams&&(de=Object.keys(Fe.setParams).reduce((ie,se)=>ie.set(se,Fe.setParams[se]),de)),new Wt(Ne,Rt,On,{params:de,headers:Y,context:Ee,reportProgress:q,responseType:It,withCredentials:ce})}}var gt=(()=>((gt=gt||{})[gt.Sent=0]="Sent",gt[gt.UploadProgress=1]="UploadProgress",gt[gt.ResponseHeader=2]="ResponseHeader",gt[gt.DownloadProgress=3]="DownloadProgress",gt[gt.Response=4]="Response",gt[gt.User=5]="User",gt))();class ft{constructor(Fe,Ne=200,Rt="OK"){this.headers=Fe.headers||new Et,this.status=void 0!==Fe.status?Fe.status:Ne,this.statusText=Fe.statusText||Rt,this.url=Fe.url||null,this.ok=this.status>=200&&this.status<300}}class fn extends ft{constructor(Fe={}){super(Fe),this.type=gt.ResponseHeader}clone(Fe={}){return new fn({headers:Fe.headers||this.headers,status:void 0!==Fe.status?Fe.status:this.status,statusText:Fe.statusText||this.statusText,url:Fe.url||this.url||void 0})}}class vn extends ft{constructor(Fe={}){super(Fe),this.type=gt.Response,this.body=void 0!==Fe.body?Fe.body:null}clone(Fe={}){return new vn({body:void 0!==Fe.body?Fe.body:this.body,headers:Fe.headers||this.headers,status:void 0!==Fe.status?Fe.status:this.status,statusText:Fe.statusText||this.statusText,url:Fe.url||this.url||void 0})}}class dn extends ft{constructor(Fe){super(Fe,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${Fe.url||"(unknown url)"}`:`Http failure response for ${Fe.url||"(unknown url)"}: ${Fe.status} ${Fe.statusText}`,this.error=Fe.error||null}}function ot(Je,Fe){return{body:Fe,headers:Je.headers,context:Je.context,observe:Je.observe,params:Je.params,reportProgress:Je.reportProgress,responseType:Je.responseType,withCredentials:Je.withCredentials}}let $e=(()=>{class Je{constructor(Ne){this.handler=Ne}request(Ne,Rt,It={}){let On;if(Ne instanceof Wt)On=Ne;else{let Y,de;Y=It.headers instanceof Et?It.headers:new Et(It.headers),It.params&&(de=It.params instanceof dt?It.params:new dt({fromObject:It.params})),On=new Wt(Ne,Rt,void 0!==It.body?It.body:null,{headers:Y,context:It.context,params:de,reportProgress:It.reportProgress,responseType:It.responseType||"json",withCredentials:It.withCredentials})}const ce=(0,Ge.of)(On).pipe((0,Le.b)(Y=>this.handler.handle(Y)));if(Ne instanceof Wt||"events"===It.observe)return ce;const q=ce.pipe((0,en.h)(Y=>Y instanceof vn));switch(It.observe||"body"){case"body":switch(On.responseType){case"arraybuffer":return q.pipe((0,qt.U)(Y=>{if(null!==Y.body&&!(Y.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return Y.body}));case"blob":return q.pipe((0,qt.U)(Y=>{if(null!==Y.body&&!(Y.body instanceof Blob))throw new Error("Response is not a Blob.");return Y.body}));case"text":return q.pipe((0,qt.U)(Y=>{if(null!==Y.body&&"string"!=typeof Y.body)throw new Error("Response is not a string.");return Y.body}));default:return q.pipe((0,qt.U)(Y=>Y.body))}case"response":return q;default:throw new Error(`Unreachable: unhandled observe type ${It.observe}}`)}}delete(Ne,Rt={}){return this.request("DELETE",Ne,Rt)}get(Ne,Rt={}){return this.request("GET",Ne,Rt)}head(Ne,Rt={}){return this.request("HEAD",Ne,Rt)}jsonp(Ne,Rt){return this.request("JSONP",Ne,{params:(new dt).append(Rt,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(Ne,Rt={}){return this.request("OPTIONS",Ne,Rt)}patch(Ne,Rt,It={}){return this.request("PATCH",Ne,ot(It,Rt))}post(Ne,Rt,It={}){return this.request("POST",Ne,ot(It,Rt))}put(Ne,Rt,It={}){return this.request("PUT",Ne,ot(It,Rt))}}return Je.\u0275fac=function(Ne){return new(Ne||Je)(ge.LFG(zt))},Je.\u0275prov=ge.Yz7({token:Je,factory:Je.\u0275fac}),Je})();function yt(Je,Fe){return Fe(Je)}function At(Je,Fe){return(Ne,Rt)=>Fe.intercept(Ne,{handle:It=>Je(It,Rt)})}const Dt=new ge.OlP("HTTP_INTERCEPTORS"),an=new ge.OlP("HTTP_INTERCEPTOR_FNS");function hr(){let Je=null;return(Fe,Ne)=>(null===Je&&(Je=((0,ge.f3M)(Dt,{optional:!0})??[]).reduceRight(At,yt)),Je(Fe,Ne))}let vr=(()=>{class Je extends zt{constructor(Ne,Rt){super(),this.backend=Ne,this.injector=Rt,this.chain=null}handle(Ne){if(null===this.chain){const Rt=Array.from(new Set(this.injector.get(an)));this.chain=Rt.reduceRight((It,On)=>function Yt(Je,Fe,Ne){return(Rt,It)=>Ne.runInContext(()=>Fe(Rt,On=>Je(On,It)))}(It,On,this.injector),yt)}return this.chain(Ne,Rt=>this.backend.handle(Rt))}}return Je.\u0275fac=function(Ne){return new(Ne||Je)(ge.LFG(wt),ge.LFG(ge.lqb))},Je.\u0275prov=ge.Yz7({token:Je,factory:Je.\u0275fac}),Je})();const Yr=/^\)\]\}',?\n/;let xn=(()=>{class Je{constructor(Ne){this.xhrFactory=Ne}handle(Ne){if("JSONP"===Ne.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new c.y(Rt=>{const It=this.xhrFactory.build();if(It.open(Ne.method,Ne.urlWithParams),Ne.withCredentials&&(It.withCredentials=!0),Ne.headers.forEach((X,oe)=>It.setRequestHeader(X,oe.join(","))),Ne.headers.has("Accept")||It.setRequestHeader("Accept","application/json, text/plain, */*"),!Ne.headers.has("Content-Type")){const X=Ne.detectContentTypeHeader();null!==X&&It.setRequestHeader("Content-Type",X)}if(Ne.responseType){const X=Ne.responseType.toLowerCase();It.responseType="json"!==X?X:"text"}const On=Ne.serializeBody();let ce=null;const q=()=>{if(null!==ce)return ce;const X=It.statusText||"OK",oe=new Et(It.getAllResponseHeaders()),_e=function vi(Je){return"responseURL"in Je&&Je.responseURL?Je.responseURL:/^X-Request-URL:/m.test(Je.getAllResponseHeaders())?Je.getResponseHeader("X-Request-URL"):null}(It)||Ne.url;return ce=new fn({headers:oe,status:It.status,statusText:X,url:_e}),ce},Y=()=>{let{headers:X,status:oe,statusText:_e,url:Ue}=q(),ct=null;204!==oe&&(ct=typeof It.response>"u"?It.responseText:It.response),0===oe&&(oe=ct?200:0);let lt=oe>=200&&oe<300;if("json"===Ne.responseType&&"string"==typeof ct){const kt=ct;ct=ct.replace(Yr,"");try{ct=""!==ct?JSON.parse(ct):null}catch(hn){ct=kt,lt&&(lt=!1,ct={error:hn,text:ct})}}lt?(Rt.next(new vn({body:ct,headers:X,status:oe,statusText:_e,url:Ue||void 0})),Rt.complete()):Rt.error(new dn({error:ct,headers:X,status:oe,statusText:_e,url:Ue||void 0}))},de=X=>{const{url:oe}=q(),_e=new dn({error:X,status:It.status||0,statusText:It.statusText||"Unknown Error",url:oe||void 0});Rt.error(_e)};let Ee=!1;const ie=X=>{Ee||(Rt.next(q()),Ee=!0);let oe={type:gt.DownloadProgress,loaded:X.loaded};X.lengthComputable&&(oe.total=X.total),"text"===Ne.responseType&&It.responseText&&(oe.partialText=It.responseText),Rt.next(oe)},se=X=>{let oe={type:gt.UploadProgress,loaded:X.loaded};X.lengthComputable&&(oe.total=X.total),Rt.next(oe)};return It.addEventListener("load",Y),It.addEventListener("error",de),It.addEventListener("timeout",de),It.addEventListener("abort",de),Ne.reportProgress&&(It.addEventListener("progress",ie),null!==On&&It.upload&&It.upload.addEventListener("progress",se)),It.send(On),Rt.next({type:gt.Sent}),()=>{It.removeEventListener("error",de),It.removeEventListener("abort",de),It.removeEventListener("load",Y),It.removeEventListener("timeout",de),Ne.reportProgress&&(It.removeEventListener("progress",ie),null!==On&&It.upload&&It.upload.removeEventListener("progress",se)),It.readyState!==It.DONE&&It.abort()}})}}return Je.\u0275fac=function(Ne){return new(Ne||Je)(ge.LFG(W.JF))},Je.\u0275prov=ge.Yz7({token:Je,factory:Je.\u0275fac}),Je})();const kr=new ge.OlP("XSRF_ENABLED"),di=new ge.OlP("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),sr=new ge.OlP("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class br{}let Ai=(()=>{class Je{constructor(Ne,Rt,It){this.doc=Ne,this.platform=Rt,this.cookieName=It,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const Ne=this.doc.cookie||"";return Ne!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,W.Mx)(Ne,this.cookieName),this.lastCookieString=Ne),this.lastToken}}return Je.\u0275fac=function(Ne){return new(Ne||Je)(ge.LFG(W.K0),ge.LFG(ge.Lbi),ge.LFG(di))},Je.\u0275prov=ge.Yz7({token:Je,factory:Je.\u0275fac}),Je})();function Er(Je,Fe){const Ne=Je.url.toLowerCase();if(!(0,ge.f3M)(kr)||"GET"===Je.method||"HEAD"===Je.method||Ne.startsWith("http://")||Ne.startsWith("https://"))return Fe(Je);const Rt=(0,ge.f3M)(br).getToken(),It=(0,ge.f3M)(sr);return null!=Rt&&!Je.headers.has(It)&&(Je=Je.clone({headers:Je.headers.set(It,Rt)})),Fe(Je)}var ht=(()=>((ht=ht||{})[ht.Interceptors=0]="Interceptors",ht[ht.LegacyInterceptors=1]="LegacyInterceptors",ht[ht.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",ht[ht.NoXsrfProtection=3]="NoXsrfProtection",ht[ht.JsonpSupport=4]="JsonpSupport",ht[ht.RequestsMadeViaParent=5]="RequestsMadeViaParent",ht))();function Lr(Je,Fe){return{\u0275kind:Je,\u0275providers:Fe}}function Jr(...Je){const Fe=[$e,xn,vr,{provide:zt,useExisting:vr},{provide:wt,useExisting:xn},{provide:an,useValue:Er,multi:!0},{provide:kr,useValue:!0},{provide:br,useClass:Ai}];for(const Ne of Je)Fe.push(...Ne.\u0275providers);return(0,ge.MR2)(Fe)}const ro=new ge.OlP("LEGACY_INTERCEPTOR_FN");let Rn=(()=>{class Je{}return Je.\u0275fac=function(Ne){return new(Ne||Je)},Je.\u0275mod=ge.oAB({type:Je}),Je.\u0275inj=ge.cJS({providers:[Jr(Lr(ht.LegacyInterceptors,[{provide:ro,useFactory:hr},{provide:an,useExisting:ro,multi:!0}]))]}),Je})()},8256:(or,Gt,De)=>{"use strict";De.d(Gt,{QbO:()=>$w,tb:()=>I0,AFp:()=>y0,ip1:()=>_0,CZH:()=>jg,hGG:()=>Mb,z2F:()=>$g,sBO:()=>db,Sil:()=>Zw,_Vd:()=>Eh,EJc:()=>qw,Xts:()=>bd,SBq:()=>Bc,lqb:()=>zc,qLn:()=>Ch,vpe:()=>$c,XFs:()=>ht,OlP:()=>li,zs3:()=>Ml,ZZ4:()=>Ny,aQg:()=>Uy,soG:()=>Vg,YKP:()=>yv,h0i:()=>pf,PXZ:()=>ab,R0b:()=>ic,FiY:()=>Re,Lbi:()=>Vw,g9A:()=>x0,Qsj:()=>Th,FYo:()=>Nc,JOm:()=>ys,tp0:()=>ze,Rgc:()=>Kp,dDg:()=>rb,eoX:()=>S0,GfV:()=>Cm,s_b:()=>Bg,ifc:()=>ct,MMx:()=>fy,Lck:()=>Gx,eFA:()=>P0,Gpc:()=>yr,f3M:()=>Y,$WT:()=>$t,MR2:()=>Ed,_c5:()=>Sb,c2e:()=>Gw,zSh:()=>Sd,wAp:()=>Nn,vHH:()=>Me,lri:()=>D0,rWj:()=>C0,D6c:()=>Ib,cg1:()=>Kh,kL8:()=>ff,dqk:()=>$r,Z0I:()=>kr,eJc:()=>Ey,CqO:()=>vc,QGY:()=>Ql,F4k:()=>Al,RDi:()=>um,AaK:()=>In,qOj:()=>Nh,TTD:()=>Io,_Bn:()=>_v,jDz:()=>xv,xp6:()=>Fm,uIk:()=>Jd,Tol:()=>G,ekj:()=>O,Suo:()=>Wv,Xpm:()=>Cr,lG2:()=>Ba,Yz7:()=>Rr,cJS:()=>vi,oAB:()=>Qr,Yjl:()=>Li,Y36:()=>su,_UZ:()=>Cp,GkF:()=>za,qZA:()=>rf,TgZ:()=>Vc,EpF:()=>Il,n5z:()=>xa,LFG:()=>ce,$8M:()=>Cs,$Z:()=>Km,NdJ:()=>Qu,CRH:()=>Zv,oxw:()=>Ap,ALo:()=>Bv,lcZ:()=>Nv,Hsn:()=>Rp,F$t:()=>Pp,Q6J:()=>Dp,s9C:()=>lf,DdM:()=>Sv,VKq:()=>Mv,WLB:()=>Iv,l5B:()=>Av,qbA:()=>Pv,HTZ:()=>Rv,iGM:()=>Hv,MAs:()=>pg,KtG:()=>el,CHM:()=>Aa,P3R:()=>Vf,Akn:()=>B,YNc:()=>fg,W1O:()=>Jv,_uU:()=>Un,Oqu:()=>rn,hij:()=>bn,AsE:()=>Qt,Gf:()=>qv});var W=De(7579),ge=De(727),Ge=De(9751),c=De(8189),Le=De(8421),en=De(515),qt=De(7669),zt=De(2076),Et=De(2961),mt=De(4482);function Pn(i,o,...a){if(!0===o)return void i();if(!1===o)return;const m=new Et.Hp({next:()=>{m.unsubscribe(),i()}});return(0,Le.Xf)(o(...a)).subscribe(m)}function Ut(i){for(let o in i)if(i[o]===Ut)return o;throw Error("Could not find renamed property on target object.")}function cn(i,o){for(const a in o)o.hasOwnProperty(a)&&!i.hasOwnProperty(a)&&(i[a]=o[a])}function In(i){if("string"==typeof i)return i;if(Array.isArray(i))return"["+i.map(In).join(", ")+"]";if(null==i)return""+i;if(i.overriddenName)return`${i.overriddenName}`;if(i.name)return`${i.name}`;const o=i.toString();if(null==o)return""+o;const a=o.indexOf("\n");return-1===a?o:o.substring(0,a)}function Xn(i,o){return null==i||""===i?null===o?"":o:null==o||""===o?i:i+" "+o}const dt=Ut({__forward_ref__:Ut});function yr(i){return i.__forward_ref__=yr,i.toString=function(){return In(this())},i}function sn(i){return Bt(i)?i():i}function Bt(i){return"function"==typeof i&&i.hasOwnProperty(dt)&&i.__forward_ref__===yr}function je(i){return i&&!!i.\u0275providers}const Hn="https://g.co/ng/security#xss";class Me extends Error{constructor(o,a){super(Wt(o,a)),this.code=o}}function Wt(i,o){return`NG0${Math.abs(i)}${o?": "+o.trim():""}`}function gt(i){return"string"==typeof i?i:null==i?"":String(i)}function ot(i,o){throw new Me(-201,!1)}function Ar(i,o){null==i&&function nn(i,o,a,m){throw new Error(`ASSERTION ERROR: ${i}`+(null==m?"":` [Expected=> ${a} ${m} ${o} <=Actual]`))}(o,i,null,"!=")}function Rr(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function vi(i){return{providers:i.providers||[],imports:i.imports||[]}}function xn(i){return Wi(i,br)||Wi(i,Er)}function kr(i){return null!==xn(i)}function Wi(i,o){return i.hasOwnProperty(o)?i[o]:null}function sr(i){return i&&(i.hasOwnProperty(Ai)||i.hasOwnProperty(un))?i[Ai]:null}const br=Ut({\u0275prov:Ut}),Ai=Ut({\u0275inj:Ut}),Er=Ut({ngInjectableDef:Ut}),un=Ut({ngInjectorDef:Ut});var ht=(()=>((ht=ht||{})[ht.Default=0]="Default",ht[ht.Host=1]="Host",ht[ht.Self=2]="Self",ht[ht.SkipSelf=4]="SkipSelf",ht[ht.Optional=8]="Optional",ht))();let Lr;function tr(i){const o=Lr;return Lr=i,o}function ro(i,o,a){const m=xn(i);return m&&"root"==m.providedIn?void 0===m.value?m.value=m.factory():m.value:a&ht.Optional?null:void 0!==o?o:void ot(In(i))}const $r=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),Ui={},Rn="__NG_DI_FLAG__",Ri="ngTempTokenPath",Zi="ngTokenPath",Je=/\n/gm,Fe="\u0275",Ne="__source";let Rt;function It(i){const o=Rt;return Rt=i,o}function On(i,o=ht.Default){if(void 0===Rt)throw new Me(-203,!1);return null===Rt?ro(i,void 0,o):Rt.get(i,o&ht.Optional?null:void 0,o)}function ce(i,o=ht.Default){return(function Jr(){return Lr}()||On)(sn(i),o)}function Y(i,o=ht.Default){return ce(i,de(o))}function de(i){return typeof i>"u"||"number"==typeof i?i:0|(i.optional&&8)|(i.host&&1)|(i.self&&2)|(i.skipSelf&&4)}function Ee(i){const o=[];for(let a=0;a<i.length;a++){const m=sn(i[a]);if(Array.isArray(m)){if(0===m.length)throw new Me(900,!1);let x,E=ht.Default;for(let M=0;M<m.length;M++){const L=m[M],N=se(L);"number"==typeof N?-1===N?x=L.token:E|=N:x=L}o.push(ce(x,E))}else o.push(ce(m))}return o}function ie(i,o){return i[Rn]=o,i.prototype[Rn]=o,i}function se(i){return i[Rn]}function _e(i){return{toString:i}.toString()}var Ue=(()=>((Ue=Ue||{})[Ue.OnPush=0]="OnPush",Ue[Ue.Default=1]="Default",Ue))(),ct=(()=>{return(i=ct||(ct={}))[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom",ct;var i})();const lt={},kt=[],hn=Ut({\u0275cmp:Ut}),Lt=Ut({\u0275dir:Ut}),mn=Ut({\u0275pipe:Ut}),Qn=Ut({\u0275mod:Ut}),nr=Ut({\u0275fac:Ut}),En=Ut({__NG_ELEMENT_ID__:Ut});let zr=0;function Cr(i){return _e(()=>{const o=Yn(i),a={...o,decls:i.decls,vars:i.vars,template:i.template,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,onPush:i.changeDetection===Ue.OnPush,directiveDefs:null,pipeDefs:null,dependencies:o.standalone&&i.dependencies||null,getStandaloneInjector:null,data:i.data||{},encapsulation:i.encapsulation||ct.Emulated,id:"c"+zr++,styles:i.styles||kt,_:null,schemas:i.schemas||null,tView:null};xo(a);const m=i.dependencies;return a.directiveDefs=No(m,!1),a.pipeDefs=No(m,!0),a})}function ki(i){return ar(i)||oi(i)}function st(i){return null!==i}function Qr(i){return _e(()=>({type:i.type,bootstrap:i.bootstrap||kt,declarations:i.declarations||kt,imports:i.imports||kt,exports:i.exports||kt,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null}))}function ls(i,o){if(null==i)return lt;const a={};for(const m in i)if(i.hasOwnProperty(m)){let x=i[m],E=x;Array.isArray(x)&&(E=x[1],x=x[0]),a[x]=m,o&&(o[x]=E)}return a}function Ba(i){return _e(()=>{const o=Yn(i);return xo(o),o})}function Li(i){return{type:i.type,name:i.name,factory:null,pure:!1!==i.pure,standalone:!0===i.standalone,onDestroy:i.type.prototype.ngOnDestroy||null}}function ar(i){return i[hn]||null}function oi(i){return i[Lt]||null}function Ei(i){return i[mn]||null}function $t(i){const o=ar(i)||oi(i)||Ei(i);return null!==o&&o.standalone}function kn(i,o){const a=i[Qn]||null;if(!a&&!0===o)throw new Error(`Type ${In(i)} does not have '\u0275mod' property.`);return a}function Yn(i){const o={};return{type:i.type,providersResolver:null,factory:null,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:o,exportAs:i.exportAs||null,standalone:!0===i.standalone,selectors:i.selectors||kt,viewQuery:i.viewQuery||null,features:i.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:ls(i.inputs,o),outputs:ls(i.outputs)}}function xo(i){i.features?.forEach(o=>o(i))}function No(i,o){if(!i)return null;const a=o?Ei:ki;return()=>("function"==typeof i?i():i).map(m=>a(m)).filter(st)}const $n=0,pn=1,Jn=2,Br=3,Nr=4,dr=5,Oi=6,Wr=7,fi=8,io=9,oo=10,rr=11,mo=12,lo=13,Fi=14,wo=15,Vr=16,Hr=17,cs=18,Ti=19,ji=20,co=21,Zr=22,wi=1,Ws=2,As=7,Uo=8,pi=9,Ji=10;function Di(i){return Array.isArray(i)&&"object"==typeof i[wi]}function uo(i){return Array.isArray(i)&&!0===i[wi]}function Ps(i){return 0!=(4&i.flags)}function us(i){return i.componentOffset>-1}function hs(i){return 1==(1&i.flags)}function ni(i){return!!i.template}function Rs(i){return 0!=(256&i[Jn])}function Vo(i,o){return i.hasOwnProperty(nr)?i[nr]:null}class Xs{constructor(o,a,m){this.previousValue=o,this.currentValue=a,this.firstChange=m}isFirstChange(){return this.firstChange}}function Io(){return Jo}function Jo(i){return i.type.prototype.ngOnChanges&&(i.setInput=Qo),Vi}function Vi(){const i=Bs(this),o=i?.current;if(o){const a=i.previous;if(a===lt)i.previous=o;else for(let m in o)a[m]=o[m];i.current=null,this.ngOnChanges(o)}}function Qo(i,o,a,m){const x=this.declaredInputs[a],E=Bs(i)||function Ts(i,o){return i[zs]=o}(i,{previous:lt,current:null}),M=E.current||(E.current={}),L=E.previous,N=L[x];M[x]=new Xs(N&&N.currentValue,o,L===lt),i[m]=o}Io.ngInherit=!0;const zs="__ngSimpleChanges__";function Bs(i){return i[zs]||null}const so=function(i,o,a){};function ri(i){for(;Array.isArray(i);)i=i[$n];return i}function ha(i,o){return ri(o[i])}function Qi(i,o){return ri(o[i.index])}function da(i,o){return i.data[o]}function $o(i,o){return i[o]}function Ao(i,o){const a=o[i];return Di(a)?a:a[$n]}function Go(i){return 64==(64&i[Jn])}function Ho(i,o){return null==o?null:i[o]}function Ua(i){i[cs]=0}function ms(i,o){i[dr]+=o;let a=i,m=i[Br];for(;null!==m&&(1===o&&1===a[dr]||-1===o&&0===a[dr]);)m[dr]+=o,a=m,m=m[Br]}const Tn={lFrame:Tr(null),bindingsEnabled:!0};function Po(){return Tn.bindingsEnabled}function Ft(){return Tn.lFrame.lView}function Sr(){return Tn.lFrame.tView}function Aa(i){return Tn.lFrame.contextLView=i,i[fi]}function el(i){return Tn.lFrame.contextLView=null,i}function mi(){let i=gs();for(;null!==i&&64===i.type;)i=i.parent;return i}function gs(){return Tn.lFrame.currentTNode}function Ro(i,o){const a=Tn.lFrame;a.currentTNode=i,a.isParent=o}function ma(){return Tn.lFrame.isParent}function ga(){Tn.lFrame.isParent=!1}function Q(){const i=Tn.lFrame;let o=i.bindingRootIndex;return-1===o&&(o=i.bindingRootIndex=i.tView.bindingStartIndex),o}function j(){return Tn.lFrame.bindingIndex++}function te(i){const o=Tn.lFrame,a=o.bindingIndex;return o.bindingIndex=o.bindingIndex+i,a}function Be(i,o){const a=Tn.lFrame;a.bindingIndex=a.bindingRootIndex=i,vt(o)}function vt(i){Tn.lFrame.currentDirectiveIndex=i}function gn(){return Tn.lFrame.currentQueryIndex}function pr(i){Tn.lFrame.currentQueryIndex=i}function ur(i){const o=i[pn];return 2===o.type?o.declTNode:1===o.type?i[Oi]:null}function jn(i,o,a){if(a&ht.SkipSelf){let x=o,E=i;for(;!(x=x.parent,null!==x||a&ht.Host||(x=ur(E),null===x||(E=E[wo],10&x.type))););if(null===x)return!1;o=x,i=E}const m=Tn.lFrame=mr();return m.currentTNode=o,m.lView=i,!0}function Kn(i){const o=mr(),a=i[pn];Tn.lFrame=o,o.currentTNode=a.firstChild,o.lView=i,o.tView=a,o.contextLView=i,o.bindingIndex=a.bindingStartIndex,o.inI18n=!1}function mr(){const i=Tn.lFrame,o=null===i?null:i.child;return null===o?Tr(i):o}function Tr(i){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return null!==i&&(i.child=o),o}function gi(){const i=Tn.lFrame;return Tn.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}const si=gi;function ai(){const i=gi();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function Cn(){return Tn.lFrame.selectedIndex}function to(i){Tn.lFrame.selectedIndex=i}function Gr(){const i=Tn.lFrame;return da(i.tView,i.selectedIndex)}function P(i,o){for(let a=o.directiveStart,m=o.directiveEnd;a<m;a++){const E=i.data[a].type.prototype,{ngAfterContentInit:M,ngAfterContentChecked:L,ngAfterViewInit:N,ngAfterViewChecked:Z,ngOnDestroy:le}=E;M&&(i.contentHooks||(i.contentHooks=[])).push(-a,M),L&&((i.contentHooks||(i.contentHooks=[])).push(a,L),(i.contentCheckHooks||(i.contentCheckHooks=[])).push(a,L)),N&&(i.viewHooks||(i.viewHooks=[])).push(-a,N),Z&&((i.viewHooks||(i.viewHooks=[])).push(a,Z),(i.viewCheckHooks||(i.viewCheckHooks=[])).push(a,Z)),null!=le&&(i.destroyHooks||(i.destroyHooks=[])).push(a,le)}}function $(i,o,a){Ot(i,o,3,a)}function pe(i,o,a,m){(3&i[Jn])===a&&Ot(i,o,a,m)}function We(i,o){let a=i[Jn];(3&a)===o&&(a&=2047,a+=1,i[Jn]=a)}function Ot(i,o,a,m){const E=m??-1,M=o.length-1;let L=0;for(let N=void 0!==m?65535&i[cs]:0;N<M;N++)if("number"==typeof o[N+1]){if(L=o[N],null!=m&&L>=m)break}else o[N]<0&&(i[cs]+=65536),(L<E||-1==E)&&(_n(i,a,o,N),i[cs]=(4294901760&i[cs])+N+2),N++}function _n(i,o,a,m){const x=a[m]<0,E=a[m+1],L=i[x?-a[m]:a[m]];if(x){if(i[Jn]>>11<i[cs]>>16&&(3&i[Jn])===o){i[Jn]+=2048,so(4,L,E);try{E.call(L)}finally{so(5,L,E)}}}else{so(4,L,E);try{E.call(L)}finally{so(5,L,E)}}}const qn=-1;class Bn{constructor(o,a,m){this.factory=o,this.resolving=!1,this.canSeeViewProviders=a,this.injectImpl=m}}function dl(i,o,a){let m=0;for(;m<a.length;){const x=a[m];if("number"==typeof x){if(0!==x)break;m++;const E=a[m++],M=a[m++],L=a[m++];i.setAttribute(o,M,L,E)}else{const E=x,M=a[++m];ya(E)?i.setProperty(o,E,M):i.setAttribute(o,E,M),m++}}return m}function Pl(i){return 3===i||4===i||6===i}function ya(i){return 64===i.charCodeAt(0)}function va(i,o){if(null!==o&&0!==o.length)if(null===i||0===i.length)i=o.slice();else{let a=-1;for(let m=0;m<o.length;m++){const x=o[m];"number"==typeof x?a=x:0===a||Eo(i,a,x,null,-1===a||2===a?o[++m]:null)}}return i}function Eo(i,o,a,m,x){let E=0,M=i.length;if(-1===o)M=-1;else for(;E<i.length;){const L=i[E++];if("number"==typeof L){if(L===o){M=-1;break}if(L>o){M=E-1;break}}}for(;E<i.length;){const L=i[E];if("number"==typeof L)break;if(L===a){if(null===m)return void(null!==x&&(i[E+1]=x));if(m===i[E+1])return void(i[E+2]=x)}E++,null!==m&&E++,null!==x&&E++}-1!==M&&(i.splice(M,0,o),E=M+1),i.splice(E++,0,a),null!==m&&i.splice(E++,0,m),null!==x&&i.splice(E++,0,x)}function Rl(i){return i!==qn}function fl(i){return 32767&i}function tl(i,o){let a=function sc(i){return i>>16}(i),m=o;for(;a>0;)m=m[wo],a--;return m}let kl=!0;function pl(i){const o=kl;return kl=i,o}const ml=255,Tc=5;let Eu=0;const es={};function Ll(i,o){const a=_l(i,o);if(-1!==a)return a;const m=o[pn];m.firstCreatePass&&(i.injectorIndex=o.length,gl(m.data,i),gl(o,null),gl(m.blueprint,null));const x=Ol(i,o),E=i.injectorIndex;if(Rl(x)){const M=fl(x),L=tl(x,o),N=L[pn].data;for(let Z=0;Z<8;Z++)o[E+Z]=L[M+Z]|N[M+Z]}return o[E+8]=x,E}function gl(i,o){i.push(0,0,0,0,0,0,0,0,o)}function _l(i,o){return-1===i.injectorIndex||i.parent&&i.parent.injectorIndex===i.injectorIndex||null===o[i.injectorIndex+8]?-1:i.injectorIndex}function Ol(i,o){if(i.parent&&-1!==i.parent.injectorIndex)return i.parent.injectorIndex;let a=0,m=null,x=o;for(;null!==x;){if(m=Cc(x),null===m)return qn;if(a++,x=x[wo],-1!==m.injectorIndex)return m.injectorIndex|a<<16}return qn}function yl(i,o,a){!function Tu(i,o,a){let m;"string"==typeof a?m=a.charCodeAt(0)||0:a.hasOwnProperty(En)&&(m=a[En]),null==m&&(m=a[En]=Eu++);const x=m&ml;o.data[i+(x>>Tc)]|=1<<x}(i,o,a)}function ts(i,o,a){if(a&ht.Optional||void 0!==i)return i;ot()}function Dc(i,o,a,m){if(a&ht.Optional&&void 0===m&&(m=null),!(a&(ht.Self|ht.Host))){const x=i[io],E=tr(void 0);try{return x?x.get(o,m,a&ht.Optional):ro(o,m,a&ht.Optional)}finally{tr(E)}}return ts(m,0,a)}function Fl(i,o,a,m=ht.Default,x){if(null!==i){if(1024&o[Jn]){const M=function yn(i,o,a,m,x){let E=i,M=o;for(;null!==E&&null!==M&&1024&M[Jn]&&!(256&M[Jn]);){const L=ac(E,M,a,m|ht.Self,es);if(L!==es)return L;let N=E.parent;if(!N){const Z=M[co];if(Z){const le=Z.get(a,es,m);if(le!==es)return le}N=Cc(M),M=M[wo]}E=N}return x}(i,o,a,m,es);if(M!==es)return M}const E=ac(i,o,a,m,es);if(E!==es)return E}return Dc(o,a,m,x)}function ac(i,o,a,m,x){const E=function Qh(i){if("string"==typeof i)return i.charCodeAt(0)||0;const o=i.hasOwnProperty(En)?i[En]:void 0;return"number"==typeof o?o>=0?o&ml:ko:o}(a);if("function"==typeof E){if(!jn(o,i,m))return m&ht.Host?ts(x,0,m):Dc(o,a,m,x);try{const M=E(m);if(null!=M||m&ht.Optional)return M;ot()}finally{si()}}else if("number"==typeof E){let M=null,L=_l(i,o),N=qn,Z=m&ht.Host?o[Vr][Oi]:null;for((-1===L||m&ht.SkipSelf)&&(N=-1===L?Ol(i,o):o[L+8],N!==qn&&Js(m,!1)?(M=o[pn],L=fl(N),o=tl(N,o)):L=-1);-1!==L;){const le=o[pn];if(Gc(E,L,le.data)){const Te=ns(L,o,a,M,m,Z);if(Te!==es)return Te}N=o[L+8],N!==qn&&Js(m,o[pn].data[L+8]===Z)&&Gc(E,L,o)?(M=le,L=fl(N),o=tl(N,o)):L=-1}}return x}function ns(i,o,a,m,x,E){const M=o[pn],L=M.data[i+8],le=lc(L,M,a,null==m?us(L)&&kl:m!=M&&0!=(3&L.type),x&ht.Host&&E===L);return null!==le?vl(o,M,le,L):es}function lc(i,o,a,m,x){const E=i.providerIndexes,M=o.data,L=1048575&E,N=i.directiveStart,le=E>>20,Ve=x?L+le:i.directiveEnd;for(let nt=m?L:L+le;nt<Ve;nt++){const Mt=M[nt];if(nt<N&&a===Mt||nt>=N&&Mt.type===a)return nt}if(x){const nt=M[N];if(nt&&ni(nt)&&nt.type===a)return N}return null}function vl(i,o,a,m){let x=i[a];const E=o.data;if(function _t(i){return i instanceof Bn}(x)){const M=x;M.resolving&&function fn(i,o){const a=o?`. Dependency path: ${o.join(" > ")} > ${i}`:"";throw new Me(-200,`Circular dependency in DI detected for ${i}${a}`)}(function ft(i){return"function"==typeof i?i.name||i.toString():"object"==typeof i&&null!=i&&"function"==typeof i.type?i.type.name||i.type.toString():gt(i)}(E[a]));const L=pl(M.canSeeViewProviders);M.resolving=!0;const N=M.injectImpl?tr(M.injectImpl):null;jn(i,m,ht.Default);try{x=i[a]=M.factory(void 0,E,i,m),o.firstCreatePass&&a>=m.directiveStart&&function A(i,o,a){const{ngOnChanges:m,ngOnInit:x,ngDoCheck:E}=o.type.prototype;if(m){const M=Jo(o);(a.preOrderHooks||(a.preOrderHooks=[])).push(i,M),(a.preOrderCheckHooks||(a.preOrderCheckHooks=[])).push(i,M)}x&&(a.preOrderHooks||(a.preOrderHooks=[])).push(0-i,x),E&&((a.preOrderHooks||(a.preOrderHooks=[])).push(i,E),(a.preOrderCheckHooks||(a.preOrderCheckHooks=[])).push(i,E))}(a,E[a],o)}finally{null!==N&&tr(N),pl(L),M.resolving=!1,si()}}return x}function Gc(i,o,a){return!!(a[o+(i>>Tc)]&1<<i)}function Js(i,o){return!(i&ht.Self||i&ht.Host&&o)}class nl{constructor(o,a){this._tNode=o,this._lView=a}get(o,a,m){return Fl(this._tNode,this._lView,o,de(m),a)}}function ko(){return new nl(mi(),Ft())}function xa(i){return _e(()=>{const o=i.prototype.constructor,a=o[nr]||wa(o),m=Object.prototype;let x=Object.getPrototypeOf(i.prototype).constructor;for(;x&&x!==m;){const E=x[nr]||wa(x);if(E&&E!==a)return E;x=Object.getPrototypeOf(x)}return E=>new E})}function wa(i){return Bt(i)?()=>{const o=wa(sn(i));return o&&o()}:Vo(i)}function Cc(i){const o=i[pn],a=o.type;return 2===a?o.declTNode:1===a?i[Oi]:null}function Cs(i){return function Du(i,o){if("class"===o)return i.classes;if("style"===o)return i.styles;const a=i.attrs;if(a){const m=a.length;let x=0;for(;x<m;){const E=a[x];if(Pl(E))break;if(0===E)x+=2;else if("number"==typeof E)for(x++;x<m&&"string"==typeof a[x];)x++;else{if(E===o)return a[x+1];x+=2}}}return null}(mi(),i)}const Ra="__parameters__";function rl(i,o,a){return _e(()=>{const m=function zl(i){return function(...a){if(i){const m=i(...a);for(const x in m)this[x]=m[x]}}}(o);function x(...E){if(this instanceof x)return m.apply(this,E),this;const M=new x(...E);return L.annotation=M,L;function L(N,Z,le){const Te=N.hasOwnProperty(Ra)?N[Ra]:Object.defineProperty(N,Ra,{value:[]})[Ra];for(;Te.length<=le;)Te.push(null);return(Te[le]=Te[le]||[]).push(M),N}}return a&&(x.prototype=Object.create(a.prototype)),x.prototype.ngMetadataName=i,x.annotationCls=x,x})}class li{constructor(o,a){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof a?this.__NG_ELEMENT_ID__=a:void 0!==a&&(this.\u0275prov=Rr({token:this,providedIn:a.providedIn||"root",factory:a.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function ba(i,o){i.forEach(a=>Array.isArray(a)?ba(a,o):o(a))}function p(i,o,a){o>=i.length?i.push(a):i.splice(o,0,a)}function r(i,o){return o>=i.length-1?i.pop():i.splice(o,1)[0]}function l(i,o){const a=[];for(let m=0;m<i;m++)a.push(o);return a}function v(i,o,a){let m=C(i,o);return m>=0?i[1|m]=a:(m=~m,function d(i,o,a,m){let x=i.length;if(x==o)i.push(a,m);else if(1===x)i.push(m,i[0]),i[0]=a;else{for(x--,i.push(i[x-1],i[x]);x>o;)i[x]=i[x-2],x--;i[o]=a,i[o+1]=m}}(i,m,o,a)),m}function b(i,o){const a=C(i,o);if(a>=0)return i[1|a]}function C(i,o){return function z(i,o,a){let m=0,x=i.length>>a;for(;x!==m;){const E=m+(x-m>>1),M=i[E<<a];if(o===M)return E<<a;M>o?x=E:m=E+1}return~(x<<a)}(i,o,1)}const Re=ie(rl("Optional"),8),ze=ie(rl("SkipSelf"),4);var ys=(()=>((ys=ys||{})[ys.Important=1]="Important",ys[ys.DashCase=2]="DashCase",ys))();const rd=new Map;let Qp=0;const yf="__ngContext__";function Lo(i,o){Di(o)?(i[yf]=o[ji],function tm(i){rd.set(i[ji],i)}(o)):i[yf]=o}let cd;function ud(i,o){return cd(i,o)}function lh(i){const o=i[Br];return uo(o)?o[Br]:o}function Zc(i){return $l(i[lo])}function Ac(i){return $l(i[Nr])}function $l(i){for(;null!==i&&!uo(i);)i=i[Nr];return i}function na(i,o,a,m,x){if(null!=m){let E,M=!1;uo(m)?E=m:Di(m)&&(M=!0,m=m[$n]);const L=ri(m);0===i&&null!==a?null==x?ol(o,a,L):Rc(o,a,L,x||null,!0):1===i&&null!==a?Rc(o,a,L,x||null,!0):2===i?function hh(i,o,a){const m=Hl(i,o);m&&function Kc(i,o,a,m){i.removeChild(o,a,m)}(i,m,o,a)}(o,L,M):3===i&&o.destroyNode(L),null!=E&&function fh(i,o,a,m,x){const E=a[As];E!==ri(a)&&na(o,i,m,E,x);for(let L=Ji;L<a.length;L++){const N=a[L];fc(N[pn],N,i,o,m,E)}}(o,i,E,a,x)}}function bf(i,o,a){return i.createElement(o,a)}function lm(i,o){const a=i[pi],m=a.indexOf(o),x=o[Br];512&o[Jn]&&(o[Jn]&=-513,ms(x,-1)),a.splice(m,1)}function Ef(i,o){if(i.length<=Ji)return;const a=Ji+o,m=i[a];if(m){const x=m[Hr];null!==x&&x!==i&&lm(x,m),o>0&&(i[a-1][Nr]=m[Nr]);const E=r(i,Ji+o);!function Xg(i,o){fc(i,o,o[rr],2,null,null),o[$n]=null,o[Oi]=null}(m[pn],m);const M=E[Ti];null!==M&&M.detachView(E[pn]),m[Br]=null,m[Nr]=null,m[Jn]&=-65}return m}function yo(i,o){if(!(128&o[Jn])){const a=o[rr];a.destroyNode&&fc(i,o,a,3,null,null),function am(i){let o=i[lo];if(!o)return Wn(i[pn],i);for(;o;){let a=null;if(Di(o))a=o[lo];else{const m=o[Ji];m&&(a=m)}if(!a){for(;o&&!o[Nr]&&o!==i;)Di(o)&&Wn(o[pn],o),o=o[Br];null===o&&(o=i),Di(o)&&Wn(o[pn],o),a=o&&o[Nr]}o=a}}(o)}}function Wn(i,o){if(!(128&o[Jn])){o[Jn]&=-65,o[Jn]|=128,function dd(i,o){let a;if(null!=i&&null!=(a=i.destroyHooks))for(let m=0;m<a.length;m+=2){const x=o[a[m]];if(!(x instanceof Bn)){const E=a[m+1];if(Array.isArray(E))for(let M=0;M<E.length;M+=2){const L=x[E[M]],N=E[M+1];so(4,L,N);try{N.call(L)}finally{so(5,L,N)}}else{so(4,x,E);try{E.call(x)}finally{so(5,x,E)}}}}}(i,o),function Pc(i,o){const a=i.cleanup,m=o[Wr];let x=-1;if(null!==a)for(let E=0;E<a.length-1;E+=2)if("string"==typeof a[E]){const M=a[E+3];M>=0?m[x=M]():m[x=-M].unsubscribe(),E+=2}else{const M=m[x=a[E+1]];a[E].call(M)}if(null!==m){for(let E=x+1;E<m.length;E++)(0,m[E])();o[Wr]=null}}(i,o),1===o[pn].type&&o[rr].destroy();const a=o[Hr];if(null!==a&&uo(o[Br])){a!==o[Br]&&lm(a,o);const m=o[Ti];null!==m&&m.detachView(i)}!function nm(i){rd.delete(i[ji])}(o)}}function Ca(i,o,a){return function Tf(i,o,a){let m=o;for(;null!==m&&40&m.type;)m=(o=m).parent;if(null===m)return a[$n];{const{componentOffset:x}=m;if(x>-1){const{encapsulation:E}=i.data[m.directiveStart+x];if(E===ct.None||E===ct.Emulated)return null}return Qi(m,a)}}(i,o.parent,a)}function Rc(i,o,a,m,x){i.insertBefore(o,a,m,x)}function ol(i,o,a){i.appendChild(o,a)}function fd(i,o,a,m,x){null!==m?Rc(i,o,a,m,x):ol(i,o,a)}function Hl(i,o){return i.parentNode(o)}function ch(i,o,a){return Sf(i,o,a)}let Mf,pc,mh,Sf=function Cf(i,o,a){return 40&i.type?Qi(i,a):null};function uh(i,o,a,m){const x=Ca(i,m,o),E=o[rr],L=ch(m.parent||o[Oi],m,o);if(null!=x)if(Array.isArray(a))for(let N=0;N<a.length;N++)fd(E,x,a[N],L,!1);else fd(E,x,a,L,!1);void 0!==Mf&&Mf(E,m,o,a,x)}function kc(i,o){if(null!==o){const a=o.type;if(3&a)return Qi(o,i);if(4&a)return bl(-1,i[o.index]);if(8&a){const m=o.child;if(null!==m)return kc(i,m);{const x=i[o.index];return uo(x)?bl(-1,x):ri(x)}}if(32&a)return ud(o,i)()||ri(i[o.index]);{const m=Yc(i,o);return null!==m?Array.isArray(m)?m[0]:kc(lh(i[Vr]),m):kc(i,o.next)}}return null}function Yc(i,o){return null!==o?i[Vr][Oi].projection[o.projection]:null}function bl(i,o){const a=Ji+i+1;if(a<o.length){const m=o[a],x=m[pn].firstChild;if(null!==x)return kc(m,x)}return o[As]}function gd(i,o,a,m,x,E,M){for(;null!=a;){const L=m[a.index],N=a.type;if(M&&0===o&&(L&&Lo(ri(L),m),a.flags|=2),32!=(32&a.flags))if(8&N)gd(i,o,a.child,m,x,E,!1),na(o,i,x,L,E);else if(32&N){const Z=ud(a,m);let le;for(;le=Z();)na(o,i,x,le,E);na(o,i,x,L,E)}else 16&N?ka(i,o,m,a,x,E):na(o,i,x,L,E);a=M?a.projectionNext:a.next}}function fc(i,o,a,m,x,E){gd(a,m,i.firstChild,o,x,E,!1)}function ka(i,o,a,m,x,E){const M=a[Vr],N=M[Oi].projection[m.projection];if(Array.isArray(N))for(let Z=0;Z<N.length;Z++)na(o,i,x,N[Z],E);else gd(i,o,N,M[Br],x,E,!0)}function _d(i,o,a){""===a?i.removeAttribute(o,"class"):i.setAttribute(o,"class",a)}function fo(i,o,a){const{mergedAttrs:m,classes:x,styles:E}=a;null!==m&&dl(i,o,m),null!==x&&_d(i,o,x),null!==E&&function sl(i,o,a){i.setAttribute(o,"style",a)}(i,o,E)}function um(i){pc=i}function Af(i){return function yd(){if(void 0===mh&&(mh=null,$r.trustedTypes))try{mh=$r.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:i=>i,createScript:i=>i,createScriptURL:i=>i})}catch{}return mh}()?.createScriptURL(i)||i}class Pf{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Hn})`}}function $s(i){return i instanceof Pf?i.changingThisBreaksApplicationSecurity:i}function El(i,o){const a=function _h(i){return i instanceof Pf&&i.getTypeName()||null}(i);if(null!=a&&a!==o){if("ResourceURL"===a&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${a} (see ${Hn})`)}return a===o}const pm=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;var Hi=(()=>((Hi=Hi||{})[Hi.NONE=0]="NONE",Hi[Hi.HTML=1]="HTML",Hi[Hi.STYLE=2]="STYLE",Hi[Hi.SCRIPT=3]="SCRIPT",Hi[Hi.URL=4]="URL",Hi[Hi.RESOURCE_URL=5]="RESOURCE_URL",Hi))();function vs(i){const o=ru();return o?o.sanitize(Hi.URL,i)||"":El(i,"URL")?$s(i):function vd(i){return(i=String(i)).match(pm)?i:"unsafe:"+i}(gt(i))}function Uf(i){const o=ru();if(o)return Af(o.sanitize(Hi.RESOURCE_URL,i)||"");if(El(i,"ResourceURL"))return Af($s(i));throw new Me(904,!1)}function Vf(i,o,a){return function jf(i,o){return"src"===o&&("embed"===i||"frame"===i||"iframe"===i||"media"===i||"script"===i)||"href"===o&&("base"===i||"link"===i)?Uf:vs}(o,a)(i)}function ru(){const i=Ft();return i&&i[mo]}const bd=new li("ENVIRONMENT_INITIALIZER"),ym=new li("INJECTOR",-1),Zl=new li("INJECTOR_DEF_TYPES");class Oc{get(o,a=Ui){if(a===Ui){const m=new Error(`NullInjectorError: No provider for ${In(o)}!`);throw m.name="NullInjectorError",m}return a}}function Ed(i){return{\u0275providers:i}}function Td(...i){return{\u0275providers:Dd(0,i),\u0275fromNgModule:!0}}function Dd(i,...o){const a=[],m=new Set;let x;return ba(o,E=>{const M=E;Gf(M,a,[],m)&&(x||(x=[]),x.push(M))}),void 0!==x&&$f(x,a),a}function $f(i,o){for(let a=0;a<i.length;a++){const{providers:x}=i[a];Hf(x,E=>{o.push(E)})}}function Gf(i,o,a,m){if(!(i=sn(i)))return!1;let x=null,E=sr(i);const M=!E&&ar(i);if(E||M){if(M&&!M.standalone)return!1;x=i}else{const N=i.ngModule;if(E=sr(N),!E)return!1;x=N}const L=m.has(x);if(M){if(L)return!1;if(m.add(x),M.dependencies){const N="function"==typeof M.dependencies?M.dependencies():M.dependencies;for(const Z of N)Gf(Z,o,a,m)}}else{if(!E)return!1;{if(null!=E.imports&&!L){let Z;m.add(x);try{ba(E.imports,le=>{Gf(le,o,a,m)&&(Z||(Z=[]),Z.push(le))})}finally{}void 0!==Z&&$f(Z,o)}if(!L){const Z=Vo(x)||(()=>new x);o.push({provide:x,useFactory:Z,deps:kt},{provide:Zl,useValue:x,multi:!0},{provide:bd,useValue:()=>ce(x),multi:!0})}const N=E.providers;null==N||L||Hf(N,le=>{o.push(le)})}}return x!==i&&void 0!==i.providers}function Hf(i,o){for(let a of i)je(a)&&(a=a.\u0275providers),Array.isArray(a)?Hf(a,o):o(a)}const qf=Ut({provide:String,useValue:Ut});function Wf(i){return null!==i&&"object"==typeof i&&qf in i}function Fc(i){return"function"==typeof i}const Sd=new li("Set Injector scope."),Md={},Ru={};let ku;function bh(){return void 0===ku&&(ku=new Oc),ku}class zc{}class vm extends zc{get destroyed(){return this._destroyed}constructor(o,a,m,x){super(),this.parent=a,this.source=m,this.scopes=x,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,Id(o,M=>this.processProvider(M)),this.records.set(ym,Lu(void 0,this)),x.has("environment")&&this.records.set(zc,Lu(void 0,this));const E=this.records.get(Sd);null!=E&&"string"==typeof E.value&&this.scopes.add(E.value),this.injectorDefTypes=new Set(this.get(Zl.multi,kt,ht.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const o of this._ngOnDestroyHooks)o.ngOnDestroy();for(const o of this._onDestroyHooks)o()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(o){this._onDestroyHooks.push(o)}runInContext(o){this.assertNotDestroyed();const a=It(this),m=tr(void 0);try{return o()}finally{It(a),tr(m)}}get(o,a=Ui,m=ht.Default){this.assertNotDestroyed(),m=de(m);const x=It(this),E=tr(void 0);try{if(!(m&ht.SkipSelf)){let L=this.records.get(o);if(void 0===L){const N=function bm(i){return"function"==typeof i||"object"==typeof i&&i instanceof li}(o)&&xn(o);L=N&&this.injectableDefInScope(N)?Lu(Xf(o),Md):null,this.records.set(o,L)}if(null!=L)return this.hydrate(o,L)}return(m&ht.Self?bh():this.parent).get(o,a=m&ht.Optional&&a===Ui?null:a)}catch(M){if("NullInjectorError"===M.name){if((M[Ri]=M[Ri]||[]).unshift(In(o)),x)throw M;return function X(i,o,a,m){const x=i[Ri];throw o[Ne]&&x.unshift(o[Ne]),i.message=function oe(i,o,a,m=null){i=i&&"\n"===i.charAt(0)&&i.charAt(1)==Fe?i.slice(2):i;let x=In(o);if(Array.isArray(o))x=o.map(In).join(" -> ");else if("object"==typeof o){let E=[];for(let M in o)if(o.hasOwnProperty(M)){let L=o[M];E.push(M+":"+("string"==typeof L?JSON.stringify(L):In(L)))}x=`{${E.join(", ")}}`}return`${a}${m?"("+m+")":""}[${x}]: ${i.replace(Je,"\n  ")}`}("\n"+i.message,x,a,m),i[Zi]=x,i[Ri]=null,i}(M,o,"R3InjectorError",this.source)}throw M}finally{tr(E),It(x)}}resolveInjectorInitializers(){const o=It(this),a=tr(void 0);try{const m=this.get(bd.multi,kt,ht.Self);for(const x of m)x()}finally{It(o),tr(a)}}toString(){const o=[],a=this.records;for(const m of a.keys())o.push(In(m));return`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Me(205,!1)}processProvider(o){let a=Fc(o=sn(o))?o:sn(o&&o.provide);const m=function a_(i){return Wf(i)?Lu(void 0,i.useValue):Lu(Kf(i),Md)}(o);if(Fc(o)||!0!==o.multi)this.records.get(a);else{let x=this.records.get(a);x||(x=Lu(void 0,Md,!0),x.factory=()=>Ee(x.multi),this.records.set(a,x)),a=o,x.multi.push(o)}this.records.set(a,m)}hydrate(o,a){return a.value===Md&&(a.value=Ru,a.value=a.factory()),"object"==typeof a.value&&a.value&&function wm(i){return null!==i&&"object"==typeof i&&"function"==typeof i.ngOnDestroy}(a.value)&&this._ngOnDestroyHooks.add(a.value),a.value}injectableDefInScope(o){if(!o.providedIn)return!1;const a=sn(o.providedIn);return"string"==typeof a?"any"===a||this.scopes.has(a):this.injectorDefTypes.has(a)}}function Xf(i){const o=xn(i),a=null!==o?o.factory:Vo(i);if(null!==a)return a;if(i instanceof li)throw new Me(204,!1);if(i instanceof Function)return function xm(i){const o=i.length;if(o>0)throw l(o,"?"),new Me(204,!1);const a=function di(i){const o=i&&(i[br]||i[Er]);return o?(function zo(i){if(i.hasOwnProperty("name"))return i.name;(""+i).match(/^function\s*([^\s(]+)/)}(i),o):null}(i);return null!==a?()=>a.factory(i):()=>new i}(i);throw new Me(204,!1)}function Kf(i,o,a){let m;if(Fc(i)){const x=sn(i);return Vo(x)||Xf(x)}if(Wf(i))m=()=>sn(i.useValue);else if(function Zf(i){return!(!i||!i.useFactory)}(i))m=()=>i.useFactory(...Ee(i.deps||[]));else if(function Cd(i){return!(!i||!i.useExisting)}(i))m=()=>ce(sn(i.useExisting));else{const x=sn(i&&(i.useClass||i.provide));if(!function l_(i){return!!i.deps}(i))return Vo(x)||Xf(x);m=()=>new x(...Ee(i.deps))}return m}function Lu(i,o,a=!1){return{factory:i,value:o,multi:a?[]:void 0}}function Id(i,o){for(const a of i)Array.isArray(a)?Id(a,o):a&&je(a)?Id(a.\u0275providers,o):o(a)}class Yf{}class Xl{}class c_{resolveComponentFactory(o){throw function La(i){const o=Error(`No component factory found for ${In(i)}. Did you add it to @NgModule.entryComponents?`);return o.ngComponent=i,o}(o)}}let Eh=(()=>{class i{}return i.NULL=new c_,i})();function u_(){return Sl(mi(),Ft())}function Sl(i,o){return new Bc(Qi(i,o))}let Bc=(()=>{class i{constructor(a){this.nativeElement=a}}return i.__NG_ELEMENT_ID__=u_,i})();function Dm(i){return i instanceof Bc?i.nativeElement:i}class Nc{}let Th=(()=>{class i{}return i.__NG_ELEMENT_ID__=()=>function h_(){const i=Ft(),a=Ao(mi().index,i);return(Di(a)?a:i)[rr]}(),i})(),d_=(()=>{class i{}return i.\u0275prov=Rr({token:i,providedIn:"root",factory:()=>null}),i})();class Cm{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const f_=new Cm("15.2.5"),Jf={},Qf="ngOriginalError";function Dh(i){return i[Qf]}class Ch{constructor(){this._console=console}handleError(o){const a=this._findOriginalError(o);this._console.error("ERROR",o),a&&this._console.error("ORIGINAL ERROR",a)}_findOriginalError(o){let a=o&&Dh(o);for(;a&&Dh(a);)a=Dh(a);return a||null}}function Yl(i){return i instanceof Function?i():i}function Fu(i,o,a){let m=i.length;for(;;){const x=i.indexOf(o,a);if(-1===x)return x;if(0===x||i.charCodeAt(x-1)<=32){const E=o.length;if(x+E===m||i.charCodeAt(x+E)<=32)return x}a=x+1}}const Rm="ng-template";function ep(i,o,a){let m=0,x=!0;for(;m<i.length;){let E=i[m++];if("string"==typeof E&&x){const M=i[m++];if(a&&"class"===E&&-1!==Fu(M.toLowerCase(),o,0))return!0}else{if(1===E){for(;m<i.length&&"string"==typeof(E=i[m++]);)if(E.toLowerCase()===o)return!0;return!1}"number"==typeof E&&(x=!1)}}return!1}function km(i){return 4===i.type&&i.value!==Rm}function tp(i,o,a){return o===(4!==i.type||a?i.value:Rm)}function np(i,o,a){let m=4;const x=i.attrs||[],E=function v_(i){for(let o=0;o<i.length;o++)if(Pl(i[o]))return o;return i.length}(x);let M=!1;for(let L=0;L<o.length;L++){const N=o[L];if("number"!=typeof N){if(!M)if(4&m){if(m=2|1&m,""!==N&&!tp(i,N,a)||""===N&&1===o.length){if(Oa(m))return!1;M=!0}}else{const Z=8&m?N:o[++L];if(8&m&&null!==i.attrs){if(!ep(i.attrs,Z,a)){if(Oa(m))return!1;M=!0}continue}const Te=__(8&m?"class":N,x,km(i),a);if(-1===Te){if(Oa(m))return!1;M=!0;continue}if(""!==Z){let Ve;Ve=Te>E?"":x[Te+1].toLowerCase();const nt=8&m?Ve:null;if(nt&&-1!==Fu(nt,Z,0)||2&m&&Z!==Ve){if(Oa(m))return!1;M=!0}}}}else{if(!M&&!Oa(m)&&!Oa(N))return!1;if(M&&Oa(N))continue;M=!1,m=N|1&m}}return Oa(m)||M}function Oa(i){return 0==(1&i)}function __(i,o,a,m){if(null===o)return-1;let x=0;if(m||!a){let E=!1;for(;x<o.length;){const M=o[x];if(M===i)return x;if(3===M||6===M)E=!0;else{if(1===M||2===M){let L=o[++x];for(;"string"==typeof L;)L=o[++x];continue}if(4===M)break;if(0===M){x+=4;continue}}x+=E?1:2}return-1}return function x_(i,o){let a=i.indexOf(4);if(a>-1)for(a++;a<i.length;){const m=i[a];if("number"==typeof m)return-1;if(m===o)return a;a++}return-1}(o,i)}function Lm(i,o,a=!1){for(let m=0;m<o.length;m++)if(np(i,o[m],a))return!0;return!1}function w_(i,o){e:for(let a=0;a<o.length;a++){const m=o[a];if(i.length===m.length){for(let x=0;x<i.length;x++)if(i[x]!==m[x])continue e;return!0}}return!1}function Mh(i,o){return i?":not("+o.trim()+")":o}function b_(i){let o=i[0],a=1,m=2,x="",E=!1;for(;a<i.length;){let M=i[a];if("string"==typeof M)if(2&m){const L=i[++a];x+="["+M+(L.length>0?'="'+L+'"':"")+"]"}else 8&m?x+="."+M:4&m&&(x+=" "+M);else""!==x&&!Oa(M)&&(o+=Mh(E,x),x=""),m=M,E=E||!Oa(m);a++}return""!==x&&(o+=Mh(E,x)),o}const Or={};function Fm(i){zm(Sr(),Ft(),Cn()+i,!1)}function zm(i,o,a,m){if(!m)if(3==(3&o[Jn])){const E=i.preOrderCheckHooks;null!==E&&$(o,E,a)}else{const E=i.preOrderHooks;null!==E&&pe(o,E,0,a)}to(a)}function Um(i,o=null,a=null,m){const x=Bu(i,o,a,m);return x.resolveInjectorInitializers(),x}function Bu(i,o=null,a=null,m,x=new Set){const E=[a||kt,Td(i)];return m=m||("object"==typeof i?void 0:In(i)),new vm(E,o||bh(),m||null,x)}let Ml=(()=>{class i{static create(a,m){if(Array.isArray(a))return Um({name:""},m,a,"");{const x=a.name??"";return Um({name:x},a.parent,a.providers,x)}}}return i.THROW_IF_NOT_FOUND=Ui,i.NULL=new Oc,i.\u0275prov=Rr({token:i,providedIn:"any",factory:()=>ce(ym)}),i.__NG_ELEMENT_ID__=-1,i})();function su(i,o=ht.Default){const a=Ft();return null===a?ce(i,o):Fl(mi(),a,sn(i),o)}function Km(){throw new Error("invalid")}function Ym(i,o){const a=i.contentQueries;if(null!==a)for(let m=0;m<a.length;m+=2){const E=a[m+1];if(-1!==E){const M=i.data[E];pr(a[m]),M.contentQueries(2,o[E],E)}}}function Rh(i,o,a,m,x,E,M,L,N,Z,le){const Te=o.blueprint.slice();return Te[$n]=x,Te[Jn]=76|m,(null!==le||i&&1024&i[Jn])&&(Te[Jn]|=1024),Ua(Te),Te[Br]=Te[wo]=i,Te[fi]=a,Te[oo]=M||i&&i[oo],Te[rr]=L||i&&i[rr],Te[mo]=N||i&&i[mo]||null,Te[io]=Z||i&&i[io]||null,Te[Oi]=E,Te[ji]=function em(){return Qp++}(),Te[co]=le,Te[Vr]=2==o.type?i[Vr]:Te,Te}function Vu(i,o,a,m,x){let E=i.data[o];if(null===E)E=function rs(i,o,a,m,x){const E=gs(),M=ma(),N=i.data[o]=function Mi(i,o,a,m,x,E){return{type:a,index:m,insertBeforeIndex:null,injectorIndex:o?o.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:x,attrs:E,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,M?E:E&&E.parent,a,o,m,x);return null===i.firstChild&&(i.firstChild=N),null!==E&&(M?null==E.child&&null!==N.parent&&(E.child=N):null===E.next&&(E.next=N,N.prev=E)),N}(i,o,a,m,x),function me(){return Tn.lFrame.inI18n}()&&(E.flags|=32);else if(64&E.type){E.type=a,E.value=m,E.attrs=x;const M=function Xi(){const i=Tn.lFrame,o=i.currentTNode;return i.isParent?o:o.parent}();E.injectorIndex=null===M?-1:M.injectorIndex}return Ro(E,!0),E}function Fa(i,o,a,m){if(0===a)return-1;const x=o.length;for(let E=0;E<a;E++)o.push(m),i.blueprint.push(m),i.data.push(null);return x}function kh(i,o,a){Kn(o);try{const m=i.viewQuery;null!==m&&_p(1,m,a);const x=i.template;null!==x&&lu(i,o,x,1,a),i.firstCreatePass&&(i.firstCreatePass=!1),i.staticContentQueries&&Ym(i,o),i.staticViewQueries&&_p(2,i.viewQuery,a);const E=i.components;null!==E&&function F_(i,o){for(let a=0;a<o.length;a++)ig(i,o[a])}(o,E)}catch(m){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),m}finally{o[Jn]&=-5,ai()}}function au(i,o,a,m){const x=o[Jn];if(128!=(128&x)){Kn(o);try{Ua(o),function R(i){return Tn.lFrame.bindingIndex=i}(i.bindingStartIndex),null!==a&&lu(i,o,a,2,m);const M=3==(3&x);if(M){const Z=i.preOrderCheckHooks;null!==Z&&$(o,Z,null)}else{const Z=i.preOrderHooks;null!==Z&&pe(o,Z,0,null),We(o,0)}if(function Ud(i){for(let o=Zc(i);null!==o;o=Ac(o)){if(!o[Ws])continue;const a=o[pi];for(let m=0;m<a.length;m++){const x=a[m];512&x[Jn]||ms(x[Br],1),x[Jn]|=512}}}(o),function gp(i){for(let o=Zc(i);null!==o;o=Ac(o))for(let a=Ji;a<o.length;a++){const m=o[a],x=m[pn];Go(m)&&au(x,m,x.template,m[fi])}}(o),null!==i.contentQueries&&Ym(i,o),M){const Z=i.contentCheckHooks;null!==Z&&$(o,Z)}else{const Z=i.contentHooks;null!==Z&&pe(o,Z,1),We(o,1)}!function L_(i,o){const a=i.hostBindingOpCodes;if(null!==a)try{for(let m=0;m<a.length;m++){const x=a[m];if(x<0)to(~x);else{const E=x,M=a[++m],L=a[++m];Be(M,E),L(2,o[E])}}}finally{to(-1)}}(i,o);const L=i.components;null!==L&&function O_(i,o){for(let a=0;a<o.length;a++)H_(i,o[a])}(o,L);const N=i.viewQuery;if(null!==N&&_p(2,N,m),M){const Z=i.viewCheckHooks;null!==Z&&$(o,Z)}else{const Z=i.viewHooks;null!==Z&&pe(o,Z,2),We(o,2)}!0===i.firstUpdatePass&&(i.firstUpdatePass=!1),o[Jn]&=-41,512&o[Jn]&&(o[Jn]&=-513,ms(o[Br],-1))}finally{ai()}}}function lu(i,o,a,m,x){const E=Cn(),M=2&m;try{to(-1),M&&o.length>Zr&&zm(i,o,Zr,!1),so(M?2:0,x),a(m,x)}finally{to(E),so(M?3:1,x)}}function lp(i,o,a){if(Ps(o)){const x=o.directiveEnd;for(let E=o.directiveStart;E<x;E++){const M=i.data[E];M.contentQueries&&M.contentQueries(1,a[E],E)}}}function cp(i,o,a){Po()&&(function U_(i,o,a,m){const x=a.directiveStart,E=a.directiveEnd;us(a)&&function mp(i,o,a){const m=Qi(o,i),x=Jm(a),E=i[oo],M=Fh(i,Rh(i,x,null,a.onPush?32:16,m,o,E,E.createRenderer(m,a),null,null,null));i[o.index]=M}(o,a,i.data[x+a.componentOffset]),i.firstCreatePass||Ll(a,o),Lo(m,o);const M=a.initialInputs;for(let L=x;L<E;L++){const N=i.data[L],Z=vl(o,i,L,a);Lo(Z,o),null!==M&&Ha(0,L-x,Z,N,0,M),ni(N)&&(Ao(a.index,o)[fi]=vl(o,i,L,a))}}(i,o,a,Qi(a,o)),64==(64&a.flags)&&ng(i,o,a))}function cu(i,o,a=Qi){const m=o.localNames;if(null!==m){let x=o.index+1;for(let E=0;E<m.length;E+=2){const M=m[E+1],L=-1===M?a(o,i):i[M];i[x++]=L}}}function Jm(i){const o=i.tView;return null===o||o.incompleteFirstPass?i.tView=up(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts):o}function up(i,o,a,m,x,E,M,L,N,Z){const le=Zr+m,Te=le+x,Ve=function Lh(i,o){const a=[];for(let m=0;m<o;m++)a.push(m<i?null:Or);return a}(le,Te),nt="function"==typeof Z?Z():Z;return Ve[pn]={type:i,blueprint:Ve,template:a,queries:null,viewQuery:L,declTNode:o,data:Ve.slice().fill(null,le),bindingStartIndex:le,expandoStartIndex:Te,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof E?E():E,pipeRegistry:"function"==typeof M?M():M,firstChild:null,schemas:N,consts:nt,incompleteFirstPass:!1}}function hp(i,o,a,m){const x=Jl(o);null===a?x.push(m):(x.push(a),i.firstCreatePass&&yp(i).push(m,x.length-1))}function zd(i,o,a,m){for(let x in i)if(i.hasOwnProperty(x)){a=null===a?{}:a;const E=i[x];null===m?dp(a,o,x,E):m.hasOwnProperty(x)&&dp(a,o,m[x],E)}return a}function dp(i,o,a,m){i.hasOwnProperty(a)?i[a].push(o,m):i[a]=[o,m]}function Is(i,o,a,m,x,E,M,L){const N=Qi(o,a);let le,Z=o.inputs;!L&&null!=Z&&(le=Z[m])?($d(i,a,le,m,x),us(o)&&fp(a,o.index)):3&o.type&&(m=function gc(i){return"class"===i?"className":"for"===i?"htmlFor":"formaction"===i?"formAction":"innerHtml"===i?"innerHTML":"readonly"===i?"readOnly":"tabindex"===i?"tabIndex":i}(m),x=null!=M?M(x,o.value||"",m):x,E.setProperty(N,m,x))}function fp(i,o){const a=Ao(o,i);16&a[Jn]||(a[Jn]|=32)}function pp(i,o,a,m){if(Po()){const x=null===m?null:{"":-1},E=function Bd(i,o){const a=i.directiveRegistry;let m=null,x=null;if(a)for(let E=0;E<a.length;E++){const M=a[E];if(Lm(o,M.selectors,!1))if(m||(m=[]),ni(M))if(null!==M.findHostDirectiveDefs){const L=[];x=x||new Map,M.findHostDirectiveDefs(M,L,x),m.unshift(...L,M),Uc(i,o,L.length)}else m.unshift(M),Uc(i,o,0);else x=x||new Map,M.findHostDirectiveDefs?.(M,m,x),m.push(M)}return null===m?null:[m,x]}(i,a);let M,L;null===E?M=L=null:[M,L]=E,null!==M&&tg(i,o,a,M,x,L),x&&function rg(i,o,a){if(o){const m=i.localNames=[];for(let x=0;x<o.length;x+=2){const E=a[o[x+1]];if(null==E)throw new Me(-301,!1);m.push(o[x],E)}}}(a,m,x)}a.mergedAttrs=va(a.mergedAttrs,a.attrs)}function tg(i,o,a,m,x,E){for(let Z=0;Z<m.length;Z++)yl(Ll(a,o),i,m[Z].type);!function $_(i,o,a){i.flags|=1,i.directiveStart=o,i.directiveEnd=o+a,i.providerIndexes=o}(a,i.data.length,m.length);for(let Z=0;Z<m.length;Z++){const le=m[Z];le.providersResolver&&le.providersResolver(le)}let M=!1,L=!1,N=Fa(i,o,m.length,null);for(let Z=0;Z<m.length;Z++){const le=m[Z];a.mergedAttrs=va(a.mergedAttrs,le.hostAttrs),G_(i,a,o,N,le),V_(N,le,x),null!==le.contentQueries&&(a.flags|=4),(null!==le.hostBindings||null!==le.hostAttrs||0!==le.hostVars)&&(a.flags|=64);const Te=le.type.prototype;!M&&(Te.ngOnChanges||Te.ngOnInit||Te.ngDoCheck)&&((i.preOrderHooks||(i.preOrderHooks=[])).push(a.index),M=!0),!L&&(Te.ngOnChanges||Te.ngDoCheck)&&((i.preOrderCheckHooks||(i.preOrderCheckHooks=[])).push(a.index),L=!0),N++}!function eg(i,o,a){const x=o.directiveEnd,E=i.data,M=o.attrs,L=[];let N=null,Z=null;for(let le=o.directiveStart;le<x;le++){const Te=E[le],Ve=a?a.get(Te):null,Mt=Ve?Ve.outputs:null;N=zd(Te.inputs,le,N,Ve?Ve.inputs:null),Z=zd(Te.outputs,le,Z,Mt);const tn=null===N||null===M||km(o)?null:Oh(N,le,M);L.push(tn)}null!==N&&(N.hasOwnProperty("class")&&(o.flags|=8),N.hasOwnProperty("style")&&(o.flags|=16)),o.initialInputs=L,o.inputs=N,o.outputs=Z}(i,a,E)}function ng(i,o,a){const m=a.directiveStart,x=a.directiveEnd,E=a.index,M=function tt(){return Tn.lFrame.currentDirectiveIndex}();try{to(E);for(let L=m;L<x;L++){const N=i.data[L],Z=o[L];vt(L),(null!==N.hostBindings||0!==N.hostVars||null!==N.hostAttrs)&&j_(N,Z)}}finally{to(-1),vt(M)}}function j_(i,o){null!==i.hostBindings&&i.hostBindings(1,o)}function Uc(i,o,a){o.componentOffset=a,(i.components||(i.components=[])).push(o.index)}function V_(i,o,a){if(a){if(o.exportAs)for(let m=0;m<o.exportAs.length;m++)a[o.exportAs[m]]=i;ni(o)&&(a[""]=i)}}function G_(i,o,a,m,x){i.data[m]=x;const E=x.factory||(x.factory=Vo(x.type)),M=new Bn(E,ni(x),su);i.blueprint[m]=M,a[m]=M,function B_(i,o,a,m,x){const E=x.hostBindings;if(E){let M=i.hostBindingOpCodes;null===M&&(M=i.hostBindingOpCodes=[]);const L=~o.index;(function N_(i){let o=i.length;for(;o>0;){const a=i[--o];if("number"==typeof a&&a<0)return a}return 0})(M)!=L&&M.push(L),M.push(a,m,E)}}(i,o,m,Fa(i,a,x.hostVars,Or),x)}function al(i,o,a,m,x,E){const M=Qi(i,o);!function Nd(i,o,a,m,x,E,M){if(null==E)i.removeAttribute(o,x,a);else{const L=null==M?gt(E):M(E,m||"",x);i.setAttribute(o,x,L,a)}}(o[rr],M,E,i.value,a,m,x)}function Ha(i,o,a,m,x,E){const M=E[o];if(null!==M){const L=m.setInput;for(let N=0;N<M.length;){const Z=M[N++],le=M[N++],Te=M[N++];null!==L?m.setInput(a,Te,Z,le):a[le]=Te}}}function Oh(i,o,a){let m=null,x=0;for(;x<a.length;){const E=a[x];if(0!==E)if(5!==E){if("number"==typeof E)break;if(i.hasOwnProperty(E)){null===m&&(m=[]);const M=i[E];for(let L=0;L<M.length;L+=2)if(M[L]===o){m.push(E,M[L+1],a[x+1]);break}}x+=2}else x+=2;else x+=4}return m}function uu(i,o,a,m){return[i,!0,!1,o,null,0,m,a,null,null]}function H_(i,o){const a=Ao(o,i);if(Go(a)){const m=a[pn];48&a[Jn]?au(m,a,m.template,a[fi]):a[dr]>0&&jd(a)}}function jd(i){for(let m=Zc(i);null!==m;m=Ac(m))for(let x=Ji;x<m.length;x++){const E=m[x];if(Go(E))if(512&E[Jn]){const M=E[pn];au(M,E,M.template,E[fi])}else E[dr]>0&&jd(E)}const a=i[pn].components;if(null!==a)for(let m=0;m<a.length;m++){const x=Ao(a[m],i);Go(x)&&x[dr]>0&&jd(x)}}function ig(i,o){const a=Ao(o,i),m=a[pn];(function q_(i,o){for(let a=o.length;a<i.blueprint.length;a++)o.push(i.blueprint[a])})(m,a),kh(m,a,a[fi])}function Fh(i,o){return i[lo]?i[Fi][Nr]=o:i[lo]=o,i[Fi]=o,o}function Vd(i){for(;i;){i[Jn]|=32;const o=lh(i);if(Rs(i)&&!o)return i;i=o}return null}function $u(i,o,a,m=!0){const x=o[oo];x.begin&&x.begin();try{au(i,o,i.template,a)}catch(M){throw m&&xp(o,M),M}finally{x.end&&x.end()}}function _p(i,o,a){pr(0),o(i,a)}function Jl(i){return i[Wr]||(i[Wr]=[])}function yp(i){return i.cleanup||(i.cleanup=[])}function xp(i,o){const a=i[io],m=a?a.get(Ch,null):null;m&&m.handleError(o)}function $d(i,o,a,m,x){for(let E=0;E<a.length;){const M=a[E++],L=a[E++],N=o[M],Z=i.data[M];null!==Z.setInput?Z.setInput(N,x,m,L):N[L]=x}}function _c(i,o,a){const m=ha(o,i);!function dc(i,o,a){i.setValue(o,a)}(i[rr],m,a)}function Gd(i,o,a){let m=a?i.styles:null,x=a?i.classes:null,E=0;if(null!==o)for(let M=0;M<o.length;M++){const L=o[M];"number"==typeof L?E=L:1==E?x=Xn(x,L):2==E&&(m=Xn(m,L+": "+o[++M]+";"))}a?i.styles=m:i.stylesWithoutHost=m,a?i.classes=x:i.classesWithoutHost=x}function zh(i,o,a,m,x=!1){for(;null!==a;){const E=o[a.index];if(null!==E&&m.push(ri(E)),uo(E))for(let L=Ji;L<E.length;L++){const N=E[L],Z=N[pn].firstChild;null!==Z&&zh(N[pn],N,Z,m)}const M=a.type;if(8&M)zh(i,o,a.child,m);else if(32&M){const L=ud(a,o);let N;for(;N=L();)m.push(N)}else if(16&M){const L=Yc(o,a);if(Array.isArray(L))m.push(...L);else{const N=lh(o[Vr]);zh(N[pn],N,L,m,!0)}}a=x?a.projectionNext:a.next}return m}class Gu{get rootNodes(){const o=this._lView,a=o[pn];return zh(a,o,a.firstChild,[])}constructor(o,a){this._lView=o,this._cdRefInjectingView=a,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[fi]}set context(o){this._lView[fi]=o}get destroyed(){return 128==(128&this._lView[Jn])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[Br];if(uo(o)){const a=o[Uo],m=a?a.indexOf(this):-1;m>-1&&(Ef(o,m),r(a,m))}this._attachedToViewContainer=!1}yo(this._lView[pn],this._lView)}onDestroy(o){hp(this._lView[pn],this._lView,null,o)}markForCheck(){Vd(this._cdRefInjectingView||this._lView)}detach(){this._lView[Jn]&=-65}reattach(){this._lView[Jn]|=64}detectChanges(){$u(this._lView[pn],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Me(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Yg(i,o){fc(i,o,o[rr],2,null,null)}(this._lView[pn],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new Me(902,!1);this._appRef=o}}class Bh extends Gu{constructor(o){super(o),this._view=o}detectChanges(){const o=this._view;$u(o[pn],o,o[fi],!1)}checkNoChanges(){}get context(){return null}}class wp extends Eh{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const a=ar(o);return new qu(a,this.ngModule)}}function bp(i){const o=[];for(let a in i)i.hasOwnProperty(a)&&o.push({propName:i[a],templateName:a});return o}class Hu{constructor(o,a){this.injector=o,this.parentInjector=a}get(o,a,m){m=de(m);const x=this.injector.get(o,Jf,m);return x!==Jf||a===Jf?x:this.parentInjector.get(o,a,m)}}class qu extends Xl{get inputs(){return bp(this.componentDef.inputs)}get outputs(){return bp(this.componentDef.outputs)}constructor(o,a){super(),this.componentDef=o,this.ngModule=a,this.componentType=o.type,this.selector=function Om(i){return i.map(b_).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!a}create(o,a,m,x){let E=(x=x||this.ngModule)instanceof zc?x:x?.injector;E&&null!==this.componentDef.getStandaloneInjector&&(E=this.componentDef.getStandaloneInjector(E)||E);const M=E?new Hu(o,E):o,L=M.get(Nc,null);if(null===L)throw new Me(407,!1);const N=M.get(d_,null),Z=L.createRenderer(null,this.componentDef),le=this.componentDef.selectors[0][0]||"div",Te=m?function Qm(i,o,a){return i.selectRootElement(o,a===ct.ShadowDom)}(Z,m,this.componentDef.encapsulation):bf(Z,le,function Ep(i){const o=i.toLowerCase();return"svg"===o?"svg":"math"===o?"math":null}(le)),Ve=this.componentDef.onPush?288:272,nt=up(0,null,null,1,0,null,null,null,null,null),Mt=Rh(null,nt,null,Ve,null,null,L,Z,N,M,null);let tn,Dn;Kn(Mt);try{const Ln=this.componentDef;let lr,Xt=null;Ln.findHostDirectiveDefs?(lr=[],Xt=new Map,Ln.findHostDirectiveDefs(Ln,lr,Xt),lr.push(Ln)):lr=[Ln];const Ur=function qd(i,o){const a=i[pn],m=Zr;return i[m]=o,Vu(a,m,2,"#host",null)}(Mt,Te),Fo=function Wd(i,o,a,m,x,E,M,L){const N=x[pn];!function K_(i,o,a,m){for(const x of i)o.mergedAttrs=va(o.mergedAttrs,x.hostAttrs);null!==o.mergedAttrs&&(Gd(o,o.mergedAttrs,!0),null!==a&&fo(m,a,o))}(m,i,o,M);const Z=E.createRenderer(o,a),le=Rh(x,Jm(a),null,a.onPush?32:16,x[i.index],i,E,Z,L||null,null,null);return N.firstCreatePass&&Uc(N,i,m.length-1),Fh(x,le),x[i.index]=le}(Ur,Te,Ln,lr,Mt,L,Z);Dn=da(nt,Zr),Te&&function J_(i,o,a,m){if(m)dl(i,a,["ng-version",f_.full]);else{const{attrs:x,classes:E}=function zu(i){const o=[],a=[];let m=1,x=2;for(;m<i.length;){let E=i[m];if("string"==typeof E)2===x?""!==E&&o.push(E,i[++m]):8===x&&a.push(E);else{if(!Oa(x))break;x=E}m++}return{attrs:o,classes:a}}(o.selectors[0]);x&&dl(i,a,x),E&&E.length>0&&_d(i,a,E.join(" "))}}(Z,Ln,Te,m),void 0!==a&&function Q_(i,o,a){const m=i.projection=[];for(let x=0;x<o.length;x++){const E=a[x];m.push(null!=E?Array.from(E):null)}}(Dn,this.ngContentSelectors,a),tn=function Y_(i,o,a,m,x,E){const M=mi(),L=x[pn],N=Qi(M,x);tg(L,x,M,a,null,m);for(let le=0;le<a.length;le++)Lo(vl(x,L,M.directiveStart+le,M),x);ng(L,x,M),N&&Lo(N,x);const Z=vl(x,L,M.directiveStart+M.componentOffset,M);if(i[fi]=x[fi]=Z,null!==E)for(const le of E)le(Z,o);return lp(L,M,i),Z}(Fo,Ln,lr,Xt,Mt,[ey]),kh(nt,Mt,null)}finally{ai()}return new Hd(this.componentType,tn,Sl(Dn,Mt),Mt,Dn)}}class Hd extends Yf{constructor(o,a,m,x,E){super(),this.location=m,this._rootLView=x,this._tNode=E,this.instance=a,this.hostView=this.changeDetectorRef=new Bh(x),this.componentType=o}setInput(o,a){const m=this._tNode.inputs;let x;if(null!==m&&(x=m[o])){const E=this._rootLView;$d(E[pn],E,x,o,a),fp(E,this._tNode.index)}}get injector(){return new nl(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}function ey(){const i=mi();P(Ft()[pn],i)}function Nh(i){let o=function hu(i){return Object.getPrototypeOf(i.prototype).constructor}(i.type),a=!0;const m=[i];for(;o;){let x;if(ni(i))x=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new Me(903,!1);x=o.\u0275dir}if(x){if(a){m.push(x);const M=i;M.inputs=Zd(i.inputs),M.declaredInputs=Zd(i.declaredInputs),M.outputs=Zd(i.outputs);const L=x.hostBindings;L&&ry(i,L);const N=x.viewQuery,Z=x.contentQueries;if(N&&ny(i,N),Z&&Tp(i,Z),cn(i.inputs,x.inputs),cn(i.declaredInputs,x.declaredInputs),cn(i.outputs,x.outputs),ni(x)&&x.data.animation){const le=i.data;le.animation=(le.animation||[]).concat(x.data.animation)}}const E=x.features;if(E)for(let M=0;M<E.length;M++){const L=E[M];L&&L.ngInherit&&L(i),L===Nh&&(a=!1)}}o=Object.getPrototypeOf(o)}!function ty(i){let o=0,a=null;for(let m=i.length-1;m>=0;m--){const x=i[m];x.hostVars=o+=x.hostVars,x.hostAttrs=va(x.hostAttrs,a=va(a,x.hostAttrs))}}(m)}function Zd(i){return i===lt?{}:i===kt?[]:i}function ny(i,o){const a=i.viewQuery;i.viewQuery=a?(m,x)=>{o(m,x),a(m,x)}:o}function Tp(i,o){const a=i.contentQueries;i.contentQueries=a?(m,x,E)=>{o(m,x,E),a(m,x,E)}:o}function ry(i,o){const a=i.hostBindings;i.hostBindings=a?(m,x)=>{o(m,x),a(m,x)}:o}function Yd(i){return!!fu(i)&&(Array.isArray(i)||!(i instanceof Map)&&Symbol.iterator in i)}function fu(i){return null!==i&&("function"==typeof i||"object"==typeof i)}function qa(i,o,a){return i[o]=a}function $h(i,o){return i[o]}function aa(i,o,a){return!Object.is(i[o],a)&&(i[o]=a,!0)}function ll(i,o,a,m){const x=aa(i,o,a);return aa(i,o+1,m)||x}function cl(i,o,a,m,x,E){const M=ll(i,o,a,m);return ll(i,o+2,x,E)||M}function Jd(i,o,a,m){const x=Ft();return aa(x,j(),o)&&(Sr(),al(Gr(),x,i,o,a,m)),Jd}function Zu(i,o,a,m){return aa(i,j(),a)?o+gt(a)+m:Or}function gu(i,o,a,m,x,E){const L=ll(i,function I(){return Tn.lFrame.bindingIndex}(),a,x);return te(2),L?o+gt(a)+m+gt(x)+E:Or}function fg(i,o,a,m,x,E,M,L){const N=Ft(),Z=Sr(),le=i+Zr,Te=Z.firstCreatePass?function nf(i,o,a,m,x,E,M,L,N){const Z=o.consts,le=Vu(o,i,4,M||null,Ho(Z,L));pp(o,a,le,Ho(Z,N)),P(o,le);const Te=le.tView=up(2,le,m,x,E,o.directiveRegistry,o.pipeRegistry,null,o.schemas,Z);return null!==o.queries&&(o.queries.template(o,le),Te.queries=o.queries.embeddedTView(le)),le}(le,Z,N,o,a,m,x,E,M):Z.data[le];Ro(Te,!1);const Ve=N[rr].createComment("");uh(Z,N,Ve,Te),Lo(Ve,N),Fh(N,N[le]=uu(Ve,N,Ve,Te)),hs(Te)&&cp(Z,N,Te),null!=M&&cu(N,Te,L)}function pg(i){return $o(function Ys(){return Tn.lFrame.contextLView}(),Zr+i)}function Dp(i,o,a){const m=Ft();return aa(m,j(),o)&&Is(Sr(),Gr(),m,i,o,m[rr],a,!1),Dp}function Wh(i,o,a,m,x){const M=x?"class":"style";$d(i,a,o.inputs[M],M,m)}function Vc(i,o,a,m){const x=Ft(),E=Sr(),M=Zr+i,L=x[rr],N=E.firstCreatePass?function oy(i,o,a,m,x,E){const M=o.consts,N=Vu(o,i,2,m,Ho(M,x));return pp(o,a,N,Ho(M,E)),null!==N.attrs&&Gd(N,N.attrs,!1),null!==N.mergedAttrs&&Gd(N,N.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,N),N}(M,E,x,o,a,m):E.data[M],Z=x[M]=bf(L,o,function Se(){return Tn.lFrame.currentNamespace}()),le=hs(N);return Ro(N,!0),fo(L,Z,N),32!=(32&N.flags)&&uh(E,x,Z,N),0===function pa(){return Tn.lFrame.elementDepthCount}()&&Lo(Z,x),function Ds(){Tn.lFrame.elementDepthCount++}(),le&&(cp(E,x,N),lp(E,N,x)),null!==m&&cu(x,N),Vc}function rf(){let i=mi();ma()?ga():(i=i.parent,Ro(i,!1));const o=i;!function Va(){Tn.lFrame.elementDepthCount--}();const a=Sr();return a.firstCreatePass&&(P(a,i),Ps(i)&&a.queries.elementEnd(i)),null!=o.classesWithoutHost&&function ao(i){return 0!=(8&i.flags)}(o)&&Wh(a,o,Ft(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function Ki(i){return 0!=(16&i.flags)}(o)&&Wh(a,o,Ft(),o.stylesWithoutHost,!1),rf}function Cp(i,o,a,m){return Vc(i,o,a,m),rf(),Cp}function Sp(i,o,a){const m=Ft(),x=Sr(),E=i+Zr,M=x.firstCreatePass?function mg(i,o,a,m,x){const E=o.consts,M=Ho(E,m),L=Vu(o,i,8,"ng-container",M);return null!==M&&Gd(L,M,!0),pp(o,a,L,Ho(E,x)),null!==o.queries&&o.queries.elementStart(o,L),L}(E,x,m,o,a):x.data[E];Ro(M,!0);const L=m[E]=m[rr].createComment("");return uh(x,m,L,M),Lo(L,m),hs(M)&&(cp(x,m,M),lp(x,M,m)),null!=a&&cu(m,M),Sp}function sf(){let i=mi();const o=Sr();return ma()?ga():(i=i.parent,Ro(i,!1)),o.firstCreatePass&&(P(o,i),Ps(i)&&o.queries.elementEnd(i)),sf}function za(i,o,a){return Sp(i,o,a),sf(),za}function Il(){return Ft()}function Ql(i){return!!i&&"function"==typeof i.then}function Al(i){return!!i&&"function"==typeof i.subscribe}const vc=Al;function Qu(i,o,a,m){const x=Ft(),E=Sr(),M=mi();return function Ip(i,o,a,m,x,E,M){const L=hs(m),Z=i.firstCreatePass&&yp(i),le=o[fi],Te=Jl(o);let Ve=!0;if(3&m.type||M){const tn=Qi(m,o),Dn=M?M(tn):tn,Ln=Te.length,lr=M?Ur=>M(ri(Ur[m.index])):m.index;let Xt=null;if(!M&&L&&(Xt=function gg(i,o,a,m){const x=i.cleanup;if(null!=x)for(let E=0;E<x.length-1;E+=2){const M=x[E];if(M===a&&x[E+1]===m){const L=o[Wr],N=x[E+2];return L.length>N?L[N]:null}"string"==typeof M&&(E+=2)}return null}(i,o,x,m.index)),null!==Xt)(Xt.__ngLastListenerFn__||Xt).__ngNextListenerFn__=E,Xt.__ngLastListenerFn__=E,Ve=!1;else{E=_g(m,o,le,E,!1);const Ur=a.listen(Dn,x,E);Te.push(E,Ur),Z&&Z.push(x,lr,Ln,Ln+1)}}else E=_g(m,o,le,E,!1);const nt=m.outputs;let Mt;if(Ve&&null!==nt&&(Mt=nt[x])){const tn=Mt.length;if(tn)for(let Dn=0;Dn<tn;Dn+=2){const Fo=o[Mt[Dn]][Mt[Dn+1]].subscribe(E),bs=Te.length;Te.push(E,Fo),Z&&Z.push(x,m.index,bs,-(bs+1))}}}(E,x,x[rr],M,i,o,m),Qu}function af(i,o,a,m){try{return so(6,o,a),!1!==a(m)}catch(x){return xp(i,x),!1}finally{so(7,o,a)}}function _g(i,o,a,m,x){return function E(M){if(M===Function)return m;Vd(i.componentOffset>-1?Ao(i.index,o):o);let N=af(o,a,m,M),Z=E.__ngNextListenerFn__;for(;Z;)N=af(o,a,Z,M)&&N,Z=Z.__ngNextListenerFn__;return x&&!1===N&&(M.preventDefault(),M.returnValue=!1),N}}function Ap(i=1){return function ho(i){return(Tn.lFrame.contextLView=function eo(i,o){for(;i>0;)o=o[wo],i--;return o}(i,Tn.lFrame.contextLView))[fi]}(i)}function yg(i,o){let a=null;const m=function y_(i){const o=i.attrs;if(null!=o){const a=o.indexOf(5);if(!(1&a))return o[a+1]}return null}(i);for(let x=0;x<o.length;x++){const E=o[x];if("*"!==E){if(null===m?Lm(i,E,!0):w_(m,E))return x}else a=x}return a}function Pp(i){const o=Ft()[Vr][Oi];if(!o.projection){const m=o.projection=l(i?i.length:1,null),x=m.slice();let E=o.child;for(;null!==E;){const M=i?yg(E,i):0;null!==M&&(x[M]?x[M].projectionNext=E:m[M]=E,x[M]=E),E=E.next}}}function Rp(i,o=0,a){const m=Ft(),x=Sr(),E=Vu(x,Zr+i,16,null,a||null);null===E.projection&&(E.projection=o),ga(),32!=(32&E.flags)&&function dh(i,o,a){ka(o[rr],0,o,a,Ca(i,a,o),ch(a.parent||o[Oi],a,o))}(x,m,E)}function lf(i,o,a){return cf(i,"",o,"",a),lf}function cf(i,o,a,m,x){const E=Ft(),M=Zu(E,o,a,m);return M!==Or&&Is(Sr(),Gr(),E,i,M,E[rr],x,!1),cf}function eh(i,o){return i<<17|o<<2}function ec(i){return i>>17&32767}function Xh(i){return 2|i}function Gs(i){return(131068&i)>>2}function wc(i,o){return-131069&i|o<<2}function uf(i){return 1|i}function Dg(i,o,a,m,x){const E=i[a+1],M=null===o;let L=m?ec(E):Gs(E),N=!1;for(;0!==L&&(!1===N||M);){const le=i[L+1];Cg(i[L],o)&&(N=!0,i[L+1]=m?uf(le):Xh(le)),L=m?ec(le):Gs(le)}N&&(i[a+1]=m?Xh(E):uf(E))}function Cg(i,o){return null===i||null==o||(Array.isArray(i)?i[1]:i)===o||!(!Array.isArray(i)||"string"!=typeof o)&&C(i,o)>=0}const is={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function Sg(i){return i.substring(is.key,is.keyEnd)}function zp(i){return i.substring(is.value,is.valueEnd)}function Bp(i,o){const a=is.textEnd;return a===o?-1:(o=is.keyEnd=function h(i,o,a){for(;o<a&&i.charCodeAt(o)>32;)o++;return o}(i,is.key=o,a),s(i,o,a))}function e(i,o){const a=is.textEnd;let m=is.key=s(i,o,a);return a===m?-1:(m=is.keyEnd=function g(i,o,a){let m;for(;o<a&&(45===(m=i.charCodeAt(o))||95===m||(-33&m)>=65&&(-33&m)<=90||m>=48&&m<=57);)o++;return o}(i,m,a),m=y(i,m,a),m=is.value=s(i,m,a),m=is.valueEnd=function w(i,o,a){let m=-1,x=-1,E=-1,M=o,L=M;for(;M<a;){const N=i.charCodeAt(M++);if(59===N)return L;34===N||39===N?L=M=T(i,N,M,a):o===M-4&&85===E&&82===x&&76===m&&40===N?L=M=T(i,41,M,a):N>32&&(L=M),E=x,x=m,m=-33&N}return L}(i,m,a),y(i,m,a))}function n(i){is.key=0,is.keyEnd=0,is.value=0,is.valueEnd=0,is.textEnd=i.length}function s(i,o,a){for(;o<a&&i.charCodeAt(o)<=32;)o++;return o}function y(i,o,a,m){return(o=s(i,o,a))<a&&o++,o}function T(i,o,a,m){let x=-1,E=a;for(;E<m;){const M=i.charCodeAt(E++);if(M==o&&92!==x)return E;x=92==M&&92===x?0:M}throw new Error}function O(i,o){return function he(i,o,a,m){const x=Ft(),E=Sr(),M=te(2);E.firstUpdatePass&&ye(E,i,M,m),o!==Or&&aa(x,M,o)&&Tt(E,E.data[Cn()],x,x[rr],i,x[M+1]=function at(i,o){return null==i||""===i||("string"==typeof o?i+=o:"object"==typeof i&&(i=In($s(i)))),i}(o,a),m,M)}(i,o,null,!0),O}function B(i){ve(it,V,i,!1)}function V(i,o){for(let a=function t(i){return n(i),e(i,s(i,0,is.textEnd))}(o);a>=0;a=e(o,a))it(i,Sg(o),zp(o))}function G(i){ve(v,J,i,!0)}function J(i,o){for(let a=function Mg(i){return n(i),Bp(i,s(i,0,is.textEnd))}(o);a>=0;a=Bp(o,a))v(i,Sg(o),!0)}function ve(i,o,a,m){const x=Sr(),E=te(2);x.firstUpdatePass&&ye(x,null,E,m);const M=Ft();if(a!==Or&&aa(M,E,a)){const L=x.data[Cn()];if(Jt(L,m)&&!Ie(x,E)){let N=m?L.classesWithoutHost:L.stylesWithoutHost;null!==N&&(a=Xn(N,a||"")),Wh(x,L,M,a,m)}else!function xt(i,o,a,m,x,E,M,L){x===Or&&(x=kt);let N=0,Z=0,le=0<x.length?x[0]:null,Te=0<E.length?E[0]:null;for(;null!==le||null!==Te;){const Ve=N<x.length?x[N+1]:void 0,nt=Z<E.length?E[Z+1]:void 0;let tn,Mt=null;le===Te?(N+=2,Z+=2,Ve!==nt&&(Mt=Te,tn=nt)):null===Te||null!==le&&le<Te?(N+=2,Mt=le):(Z+=2,Mt=Te,tn=nt),null!==Mt&&Tt(i,o,a,m,Mt,tn,M,L),le=N<x.length?x[N]:null,Te=Z<E.length?E[Z]:null}}(x,L,M,M[rr],M[E+1],M[E+1]=function Vt(i,o,a){if(null==a||""===a)return kt;const m=[],x=$s(a);if(Array.isArray(x))for(let E=0;E<x.length;E++)i(m,x[E],!0);else if("object"==typeof x)for(const E in x)x.hasOwnProperty(E)&&i(m,E,x[E]);else"string"==typeof x&&o(m,x);return m}(i,o,a),m,E)}}function Ie(i,o){return o>=i.expandoStartIndex}function ye(i,o,a,m){const x=i.data;if(null===x[a+1]){const E=x[Cn()],M=Ie(i,a);Jt(E,m)&&null===o&&!M&&(o=!1),o=function Ce(i,o,a,m){const x=function on(i){const o=Tn.lFrame.currentDirectiveIndex;return-1===o?null:i[o]}(i);let E=m?o.residualClasses:o.residualStyles;if(null===x)0===(m?o.classBindings:o.styleBindings)&&(a=pt(a=Xe(null,i,o,a,m),o.attrs,m),E=null);else{const M=o.directiveStylingLast;if(-1===M||i[M]!==x)if(a=Xe(x,i,o,a,m),null===E){let N=function ke(i,o,a){const m=a?o.classBindings:o.styleBindings;if(0!==Gs(m))return i[ec(m)]}(i,o,m);void 0!==N&&Array.isArray(N)&&(N=Xe(null,i,o,N[1],m),N=pt(N,o.attrs,m),function Pe(i,o,a,m){i[ec(a?o.classBindings:o.styleBindings)]=m}(i,o,m,N))}else E=function et(i,o,a){let m;const x=o.directiveEnd;for(let E=1+o.directiveStylingLast;E<x;E++)m=pt(m,i[E].hostAttrs,a);return pt(m,o.attrs,a)}(i,o,m)}return void 0!==E&&(m?o.residualClasses=E:o.residualStyles=E),a}(x,E,o,m),function Eg(i,o,a,m,x,E){let M=E?o.classBindings:o.styleBindings,L=ec(M),N=Gs(M);i[m]=a;let le,Z=!1;if(Array.isArray(a)?(le=a[1],(null===le||C(a,le)>0)&&(Z=!0)):le=a,x)if(0!==N){const Ve=ec(i[L+1]);i[m+1]=eh(Ve,L),0!==Ve&&(i[Ve+1]=wc(i[Ve+1],m)),i[L+1]=function Op(i,o){return 131071&i|o<<17}(i[L+1],m)}else i[m+1]=eh(L,0),0!==L&&(i[L+1]=wc(i[L+1],m)),L=m;else i[m+1]=eh(N,0),0===L?L=m:i[N+1]=wc(i[N+1],m),N=m;Z&&(i[m+1]=Xh(i[m+1])),Dg(i,le,m,!0),Dg(i,le,m,!1),function Tg(i,o,a,m,x){const E=x?i.residualClasses:i.residualStyles;null!=E&&"string"==typeof o&&C(E,o)>=0&&(a[m+1]=uf(a[m+1]))}(o,le,i,m,E),M=eh(L,N),E?o.classBindings=M:o.styleBindings=M}(x,E,o,a,M,m)}}function Xe(i,o,a,m,x){let E=null;const M=a.directiveEnd;let L=a.directiveStylingLast;for(-1===L?L=a.directiveStart:L++;L<M&&(E=o[L],m=pt(m,E.hostAttrs,x),E!==i);)L++;return null!==i&&(a.directiveStylingLast=L),m}function pt(i,o,a){const m=a?1:2;let x=-1;if(null!==o)for(let E=0;E<o.length;E++){const M=o[E];"number"==typeof M?x=M:x===m&&(Array.isArray(i)||(i=void 0===i?[]:["",i]),v(i,M,!!a||o[++E]))}return void 0===i?null:i}function it(i,o,a){v(i,o,$s(a))}function Tt(i,o,a,m,x,E,M,L){if(!(3&o.type))return;const N=i.data,Z=N[L+1],le=function bg(i){return 1==(1&i)}(Z)?Pt(N,o,a,x,Gs(Z),M):void 0;jt(le)||(jt(E)||function tc(i){return 2==(2&i)}(Z)&&(E=Pt(N,null,a,x,L,M)),function ra(i,o,a,m,x){if(o)x?i.addClass(a,m):i.removeClass(a,m);else{let E=-1===m.indexOf("-")?void 0:ys.DashCase;null==x?i.removeStyle(a,m,E):("string"==typeof x&&x.endsWith("!important")&&(x=x.slice(0,-10),E|=ys.Important),i.setStyle(a,m,x,E))}}(m,M,ha(Cn(),a),x,E))}function Pt(i,o,a,m,x,E){const M=null===o;let L;for(;x>0;){const N=i[x],Z=Array.isArray(N),le=Z?N[1]:N,Te=null===le;let Ve=a[x+1];Ve===Or&&(Ve=Te?kt:void 0);let nt=Te?b(Ve,m):le===m?Ve:void 0;if(Z&&!jt(nt)&&(nt=b(N,m)),jt(nt)&&(L=nt,M))return L;const Mt=i[x+1];x=M?ec(Mt):Gs(Mt)}if(null!==o){let N=E?o.residualClasses:o.residualStyles;null!=N&&(L=b(N,m))}return L}function jt(i){return void 0!==i}function Jt(i,o){return 0!=(i.flags&(o?8:16))}function Un(i,o=""){const a=Ft(),m=Sr(),x=i+Zr,E=m.firstCreatePass?Vu(m,x,1,o,null):m.data[x],M=a[x]=function Gl(i,o){return i.createText(o)}(a[rr],o);uh(m,a,M,E),Ro(E,!1)}function rn(i){return bn("",i,""),rn}function bn(i,o,a){const m=Ft(),x=Zu(m,i,o,a);return x!==Or&&_c(m,Cn(),x),bn}function Qt(i,o,a,m,x){const E=Ft(),M=gu(E,i,o,a,m,x);return M!==Or&&_c(E,Cn(),M),Qt}const bc=void 0;var Ig=["en",[["a","p"],["AM","PM"],bc],[["AM","PM"],bc,bc],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],bc,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],bc,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",bc,"{1} 'at' {0}",bc],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function rc(i){const a=Math.floor(Math.abs(i)),m=i.toString().replace(/^[^.]*\.?/,"").length;return 1===a&&0===m?1:5}];let ul={};function Kh(i){const o=function Yh(i){return i.toLowerCase().replace(/_/g,"-")}(i);let a=Pg(o);if(a)return a;const m=o.split("-")[0];if(a=Pg(m),a)return a;if("en"===m)return Ig;throw new Me(701,!1)}function ff(i){return Kh(i)[Nn.PluralCase]}function Pg(i){return i in ul||(ul[i]=$r.ng&&$r.ng.common&&$r.ng.common.locales&&$r.ng.common.locales[i]),ul[i]}var Nn=(()=>((Nn=Nn||{})[Nn.LocaleId=0]="LocaleId",Nn[Nn.DayPeriodsFormat=1]="DayPeriodsFormat",Nn[Nn.DayPeriodsStandalone=2]="DayPeriodsStandalone",Nn[Nn.DaysFormat=3]="DaysFormat",Nn[Nn.DaysStandalone=4]="DaysStandalone",Nn[Nn.MonthsFormat=5]="MonthsFormat",Nn[Nn.MonthsStandalone=6]="MonthsStandalone",Nn[Nn.Eras=7]="Eras",Nn[Nn.FirstDayOfWeek=8]="FirstDayOfWeek",Nn[Nn.WeekendRange=9]="WeekendRange",Nn[Nn.DateFormat=10]="DateFormat",Nn[Nn.TimeFormat=11]="TimeFormat",Nn[Nn.DateTimeFormat=12]="DateTimeFormat",Nn[Nn.NumberSymbols=13]="NumberSymbols",Nn[Nn.NumberFormats=14]="NumberFormats",Nn[Nn.CurrencyCode=15]="CurrencyCode",Nn[Nn.CurrencySymbol=16]="CurrencySymbol",Nn[Nn.CurrencyName=17]="CurrencyName",Nn[Nn.Currencies=18]="Currencies",Nn[Nn.Directionality=19]="Directionality",Nn[Nn.PluralCase=20]="PluralCase",Nn[Nn.ExtraData=21]="ExtraData",Nn))();const hl="en-US";let Hy=hl;function ly(i,o,a,m,x){if(i=sn(i),Array.isArray(i))for(let E=0;E<i.length;E++)ly(i[E],o,a,m,x);else{const E=Sr(),M=Ft();let L=Fc(i)?i:sn(i.provide),N=Kf(i);const Z=mi(),le=1048575&Z.providerIndexes,Te=Z.directiveStart,Ve=Z.providerIndexes>>20;if(Fc(i)||!i.multi){const nt=new Bn(N,x,su),Mt=uy(L,o,x?le:le+Ve,Te);-1===Mt?(yl(Ll(Z,M),E,L),cy(E,i,o.length),o.push(L),Z.directiveStart++,Z.directiveEnd++,x&&(Z.providerIndexes+=1048576),a.push(nt),M.push(nt)):(a[Mt]=nt,M[Mt]=nt)}else{const nt=uy(L,o,le+Ve,Te),Mt=uy(L,o,le,le+Ve),Dn=Mt>=0&&a[Mt];if(x&&!Dn||!x&&!(nt>=0&&a[nt])){yl(Ll(Z,M),E,L);const Ln=function $x(i,o,a,m,x){const E=new Bn(i,a,su);return E.multi=[],E.index=o,E.componentProviders=0,gv(E,x,m&&!a),E}(x?Vx:jx,a.length,x,m,N);!x&&Dn&&(a[Mt].providerFactory=Ln),cy(E,i,o.length,0),o.push(L),Z.directiveStart++,Z.directiveEnd++,x&&(Z.providerIndexes+=1048576),a.push(Ln),M.push(Ln)}else cy(E,i,nt>-1?nt:Mt,gv(a[x?Mt:nt],N,!x&&m));!x&&m&&Dn&&a[Mt].componentProviders++}}}function cy(i,o,a,m){const x=Fc(o),E=function iu(i){return!!i.useClass}(o);if(x||E){const N=(E?sn(o.useClass):o).prototype.ngOnDestroy;if(N){const Z=i.destroyHooks||(i.destroyHooks=[]);if(!x&&o.multi){const le=Z.indexOf(a);-1===le?Z.push(a,[m,N]):Z[le+1].push(m,N)}else Z.push(a,N)}}}function gv(i,o,a){return a&&i.componentProviders++,i.multi.push(o)-1}function uy(i,o,a,m){for(let x=a;x<m;x++)if(o[x]===i)return x;return-1}function jx(i,o,a,m){return hy(this.multi,[])}function Vx(i,o,a,m){const x=this.multi;let E;if(this.providerFactory){const M=this.providerFactory.componentProviders,L=vl(a,a[pn],this.providerFactory.index,m);E=L.slice(0,M),hy(x,E);for(let N=M;N<L.length;N++)E.push(L[N])}else E=[],hy(x,E);return E}function hy(i,o){for(let a=0;a<i.length;a++)o.push((0,i[a])());return o}function _v(i,o=[]){return a=>{a.providersResolver=(m,x)=>function Ux(i,o,a){const m=Sr();if(m.firstCreatePass){const x=ni(i);ly(a,m.data,m.blueprint,x,!0),ly(o,m.data,m.blueprint,x,!1)}}(m,x?x(i):i,o)}}class pf{}class yv{}function Gx(i,o){return new vv(i,o??null)}class vv extends pf{constructor(o,a){super(),this._parent=a,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new wp(this);const m=kn(o);this._bootstrapComponents=Yl(m.bootstrap),this._r3Injector=Bu(o,a,[{provide:pf,useValue:this},{provide:Eh,useValue:this.componentFactoryResolver}],In(o),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(o)}get injector(){return this._r3Injector}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(a=>a()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class dy extends yv{constructor(o){super(),this.moduleType=o}create(o){return new vv(this.moduleType,o)}}class Hx extends pf{constructor(o,a,m){super(),this.componentFactoryResolver=new wp(this),this.instance=null;const x=new vm([...o,{provide:pf,useValue:this},{provide:Eh,useValue:this.componentFactoryResolver}],a||bh(),m,new Set(["environment"]));this.injector=x,x.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(o){this.injector.onDestroy(o)}}function fy(i,o,a=null){return new Hx(i,o,a).injector}let qx=(()=>{class i{constructor(a){this._injector=a,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(a){if(!a.standalone)return null;if(!this.cachedInjectors.has(a.id)){const m=Dd(0,a.type),x=m.length>0?fy([m],this._injector,`Standalone[${a.type.name}]`):null;this.cachedInjectors.set(a.id,x)}return this.cachedInjectors.get(a.id)}ngOnDestroy(){try{for(const a of this.cachedInjectors.values())null!==a&&a.destroy()}finally{this.cachedInjectors.clear()}}}return i.\u0275prov=Rr({token:i,providedIn:"environment",factory:()=>new i(ce(zc))}),i})();function xv(i){i.getStandaloneInjector=o=>o.get(qx).getOrCreateStandaloneInjector(i)}function Sv(i,o,a){const m=Q()+i,x=Ft();return x[m]===Or?qa(x,m,a?o.call(a):o()):$h(x,m)}function Mv(i,o,a,m){return kv(Ft(),Q(),i,o,a,m)}function Iv(i,o,a,m,x){return function Lv(i,o,a,m,x,E,M){const L=o+a;return ll(i,L,x,E)?qa(i,L+2,M?m.call(M,x,E):m(x,E)):Zp(i,L+2)}(Ft(),Q(),i,o,a,m,x)}function Av(i,o,a,m,x,E,M){return function Fv(i,o,a,m,x,E,M,L,N){const Z=o+a;return cl(i,Z,x,E,M,L)?qa(i,Z+4,N?m.call(N,x,E,M,L):m(x,E,M,L)):Zp(i,Z+4)}(Ft(),Q(),i,o,a,m,x,E,M)}function Pv(i,o,a,m,x,E,M,L){const N=Q()+i,Z=Ft(),le=cl(Z,N,a,m,x,E);return aa(Z,N+4,M)||le?qa(Z,N+5,L?o.call(L,a,m,x,E,M):o(a,m,x,E,M)):$h(Z,N+5)}function Rv(i,o,a,m,x,E,M,L,N){const Z=Q()+i,le=Ft(),Te=cl(le,Z,a,m,x,E);return ll(le,Z+4,M,L)||Te?qa(le,Z+6,N?o.call(N,a,m,x,E,M,L):o(a,m,x,E,M,L)):$h(le,Z+6)}function Zp(i,o){const a=i[o];return a===Or?void 0:a}function kv(i,o,a,m,x,E){const M=o+a;return aa(i,M,x)?qa(i,M+1,E?m.call(E,x):m(x)):Zp(i,M+1)}function Bv(i,o){const a=Sr();let m;const x=i+Zr;a.firstCreatePass?(m=function ow(i,o){if(o)for(let a=o.length-1;a>=0;a--){const m=o[a];if(i===m.name)return m}}(o,a.pipeRegistry),a.data[x]=m,m.onDestroy&&(a.destroyHooks||(a.destroyHooks=[])).push(x,m.onDestroy)):m=a.data[x];const E=m.factory||(m.factory=Vo(m.type)),M=tr(su);try{const L=pl(!1),N=E();return pl(L),function iy(i,o,a,m){a>=i.data.length&&(i.data[a]=null,i.blueprint[a]=null),o[a]=m}(a,Ft(),x,N),N}finally{tr(M)}}function Nv(i,o,a){const m=i+Zr,x=Ft(),E=$o(x,m);return function Xp(i,o){return i[pn].data[o].pure}(x,m)?kv(x,Q(),o,E.transform,a,E):E.transform(a)}function my(i){return o=>{setTimeout(i,void 0,o)}}const $c=class uw extends W.x{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,a,m){let x=o,E=a||(()=>null),M=m;if(o&&"object"==typeof o){const N=o;x=N.next?.bind(N),E=N.error?.bind(N),M=N.complete?.bind(N)}this.__isAsync&&(E=my(E),x&&(x=my(x)),M&&(M=my(M)));const L=super.subscribe({next:x,error:E,complete:M});return o instanceof ge.w0&&o.add(L),L}};function hw(){return this._results[Symbol.iterator]()}class gy{get changes(){return this._changes||(this._changes=new $c)}constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const a=gy.prototype;a[Symbol.iterator]||(a[Symbol.iterator]=hw)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,a){return this._results.reduce(o,a)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,a){const m=this;m.dirty=!1;const x=function _s(i){return i.flat(Number.POSITIVE_INFINITY)}(o);(this._changesDetected=!function Iu(i,o,a){if(i.length!==o.length)return!1;for(let m=0;m<i.length;m++){let x=i[m],E=o[m];if(a&&(x=a(x),E=a(E)),E!==x)return!1}return!0}(m._results,x,a))&&(m._results=x,m.length=x.length,m.last=x[this.length-1],m.first=x[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Kp=(()=>{class i{}return i.__NG_ELEMENT_ID__=pw,i})();const dw=Kp,fw=class extends dw{constructor(o,a,m){super(),this._declarationLView=o,this._declarationTContainer=a,this.elementRef=m}createEmbeddedView(o,a){const m=this._declarationTContainer.tView,x=Rh(this._declarationLView,m,o,16,null,m.declTNode,null,null,null,null,a||null);x[Hr]=this._declarationLView[this._declarationTContainer.index];const M=this._declarationLView[Ti];return null!==M&&(x[Ti]=M.createEmbeddedView(m)),kh(m,x,o),new Gu(x)}};function pw(){return zg(mi(),Ft())}function zg(i,o){return 4&i.type?new fw(o,i,Sl(i,o)):null}let Bg=(()=>{class i{}return i.__NG_ELEMENT_ID__=mw,i})();function mw(){return Vv(mi(),Ft())}const gw=Bg,Uv=class extends gw{constructor(o,a,m){super(),this._lContainer=o,this._hostTNode=a,this._hostLView=m}get element(){return Sl(this._hostTNode,this._hostLView)}get injector(){return new nl(this._hostTNode,this._hostLView)}get parentInjector(){const o=Ol(this._hostTNode,this._hostLView);if(Rl(o)){const a=tl(o,this._hostLView),m=fl(o);return new nl(a[pn].data[m+8],a)}return new nl(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const a=jv(this._lContainer);return null!==a&&a[o]||null}get length(){return this._lContainer.length-Ji}createEmbeddedView(o,a,m){let x,E;"number"==typeof m?x=m:null!=m&&(x=m.index,E=m.injector);const M=o.createEmbeddedView(a||{},E);return this.insert(M,x),M}createComponent(o,a,m,x,E){const M=o&&!function Nl(i){return"function"==typeof i}(o);let L;if(M)L=a;else{const Te=a||{};L=Te.index,m=Te.injector,x=Te.projectableNodes,E=Te.environmentInjector||Te.ngModuleRef}const N=M?o:new qu(ar(o)),Z=m||this.parentInjector;if(!E&&null==N.ngModule){const Ve=(M?Z:this.parentInjector).get(zc,null);Ve&&(E=Ve)}const le=N.create(Z,x,void 0,E);return this.insert(le.hostView,L),le}insert(o,a){const m=o._lView,x=m[pn];if(function ps(i){return uo(i[Br])}(m)){const le=this.indexOf(o);if(-1!==le)this.detach(le);else{const Te=m[Br],Ve=new Uv(Te,Te[Oi],Te[Br]);Ve.detach(Ve.indexOf(o))}}const E=this._adjustIndex(a),M=this._lContainer;!function hd(i,o,a,m){const x=Ji+m,E=a.length;m>0&&(a[x-1][Nr]=o),m<E-Ji?(o[Nr]=a[x],p(a,Ji+m,o)):(a.push(o),o[Nr]=null),o[Br]=a;const M=o[Hr];null!==M&&a!==M&&function wl(i,o){const a=i[pi];o[Vr]!==o[Br][Br][Vr]&&(i[Ws]=!0),null===a?i[pi]=[o]:a.push(o)}(M,o);const L=o[Ti];null!==L&&L.insertView(i),o[Jn]|=64}(x,m,M,E);const L=bl(E,M),N=m[rr],Z=Hl(N,M[As]);return null!==Z&&function Kg(i,o,a,m,x,E){m[$n]=x,m[Oi]=o,fc(i,m,a,1,x,E)}(x,M[Oi],N,m,Z,L),o.attachToViewContainerRef(),p(_y(M),E,o),o}move(o,a){return this.insert(o,a)}indexOf(o){const a=jv(this._lContainer);return null!==a?a.indexOf(o):-1}remove(o){const a=this._adjustIndex(o,-1),m=Ef(this._lContainer,a);m&&(r(_y(this._lContainer),a),yo(m[pn],m))}detach(o){const a=this._adjustIndex(o,-1),m=Ef(this._lContainer,a);return m&&null!=r(_y(this._lContainer),a)?new Gu(m):null}_adjustIndex(o,a=0){return o??this.length+a}};function jv(i){return i[Uo]}function _y(i){return i[Uo]||(i[Uo]=[])}function Vv(i,o){let a;const m=o[i.index];if(uo(m))a=m;else{let x;if(8&i.type)x=ri(m);else{const E=o[rr];x=E.createComment("");const M=Qi(i,o);Rc(E,Hl(E,M),x,function Df(i,o){return i.nextSibling(o)}(E,M),!1)}o[i.index]=a=uu(m,o,x,i),Fh(o,a)}return new Uv(a,i,o)}class yy{constructor(o){this.queryList=o,this.matches=null}clone(){return new yy(this.queryList)}setDirty(){this.queryList.setDirty()}}class vy{constructor(o=[]){this.queries=o}createEmbeddedView(o){const a=o.queries;if(null!==a){const m=null!==o.contentQueries?o.contentQueries[0]:a.length,x=[];for(let E=0;E<m;E++){const M=a.getByIndex(E);x.push(this.queries[M.indexInDeclarationView].clone())}return new vy(x)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let a=0;a<this.queries.length;a++)null!==Yv(o,a).matches&&this.queries[a].setDirty()}}class $v{constructor(o,a,m=null){this.predicate=o,this.flags=a,this.read=m}}class xy{constructor(o=[]){this.queries=o}elementStart(o,a){for(let m=0;m<this.queries.length;m++)this.queries[m].elementStart(o,a)}elementEnd(o){for(let a=0;a<this.queries.length;a++)this.queries[a].elementEnd(o)}embeddedTView(o){let a=null;for(let m=0;m<this.length;m++){const x=null!==a?a.length:0,E=this.getByIndex(m).embeddedTView(o,x);E&&(E.indexInDeclarationView=m,null!==a?a.push(E):a=[E])}return null!==a?new xy(a):null}template(o,a){for(let m=0;m<this.queries.length;m++)this.queries[m].template(o,a)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class wy{constructor(o,a=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=a}elementStart(o,a){this.isApplyingToNode(a)&&this.matchTNode(o,a)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,a){this.elementStart(o,a)}embeddedTView(o,a){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,a),new wy(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const a=this._declarationNodeIndex;let m=o.parent;for(;null!==m&&8&m.type&&m.index!==a;)m=m.parent;return a===(null!==m?m.index:-1)}return this._appliesToNextNode}matchTNode(o,a){const m=this.metadata.predicate;if(Array.isArray(m))for(let x=0;x<m.length;x++){const E=m[x];this.matchTNodeWithReadOption(o,a,_w(a,E)),this.matchTNodeWithReadOption(o,a,lc(a,o,E,!1,!1))}else m===Kp?4&a.type&&this.matchTNodeWithReadOption(o,a,-1):this.matchTNodeWithReadOption(o,a,lc(a,o,m,!1,!1))}matchTNodeWithReadOption(o,a,m){if(null!==m){const x=this.metadata.read;if(null!==x)if(x===Bc||x===Bg||x===Kp&&4&a.type)this.addMatch(a.index,-2);else{const E=lc(a,o,x,!1,!1);null!==E&&this.addMatch(a.index,E)}else this.addMatch(a.index,m)}}addMatch(o,a){null===this.matches?this.matches=[o,a]:this.matches.push(o,a)}}function _w(i,o){const a=i.localNames;if(null!==a)for(let m=0;m<a.length;m+=2)if(a[m]===o)return a[m+1];return null}function vw(i,o,a,m){return-1===a?function yw(i,o){return 11&i.type?Sl(i,o):4&i.type?zg(i,o):null}(o,i):-2===a?function xw(i,o,a){return a===Bc?Sl(o,i):a===Kp?zg(o,i):a===Bg?Vv(o,i):void 0}(i,o,m):vl(i,i[pn],a,o)}function Gv(i,o,a,m){const x=o[Ti].queries[m];if(null===x.matches){const E=i.data,M=a.matches,L=[];for(let N=0;N<M.length;N+=2){const Z=M[N];L.push(Z<0?null:vw(o,E[Z],M[N+1],a.metadata.read))}x.matches=L}return x.matches}function by(i,o,a,m){const x=i.queries.getByIndex(a),E=x.matches;if(null!==E){const M=Gv(i,o,x,a);for(let L=0;L<E.length;L+=2){const N=E[L];if(N>0)m.push(M[L/2]);else{const Z=E[L+1],le=o[-N];for(let Te=Ji;Te<le.length;Te++){const Ve=le[Te];Ve[Hr]===Ve[Br]&&by(Ve[pn],Ve,Z,m)}if(null!==le[pi]){const Te=le[pi];for(let Ve=0;Ve<Te.length;Ve++){const nt=Te[Ve];by(nt[pn],nt,Z,m)}}}}}return m}function Hv(i){const o=Ft(),a=Sr(),m=gn();pr(m+1);const x=Yv(a,m);if(i.dirty&&function Ks(i){return 4==(4&i[Jn])}(o)===(2==(2&x.metadata.flags))){if(null===x.matches)i.reset([]);else{const E=x.crossesNgTemplate?by(a,o,m,[]):Gv(a,o,x,m);i.reset(E,Dm),i.notifyOnChanges()}return!0}return!1}function qv(i,o,a){const m=Sr();m.firstCreatePass&&(Kv(m,new $v(i,o,a),-1),2==(2&o)&&(m.staticViewQueries=!0)),Xv(m,Ft(),o)}function Wv(i,o,a,m){const x=Sr();if(x.firstCreatePass){const E=mi();Kv(x,new $v(o,a,m),E.index),function bw(i,o){const a=i.contentQueries||(i.contentQueries=[]);o!==(a.length?a[a.length-1]:-1)&&a.push(i.queries.length-1,o)}(x,i),2==(2&a)&&(x.staticContentQueries=!0)}Xv(x,Ft(),a)}function Zv(){return function ww(i,o){return i[Ti].queries[o].queryList}(Ft(),gn())}function Xv(i,o,a){const m=new gy(4==(4&a));hp(i,o,m,m.destroy),null===o[Ti]&&(o[Ti]=new vy),o[Ti].queries.push(new yy(m))}function Kv(i,o,a){null===i.queries&&(i.queries=new xy),i.queries.track(new wy(o,a))}function Yv(i,o){return i.queries.getByIndex(o)}function Jv(i,o){return zg(i,o)}function Ey(i){return!!kn(i)}function Ug(...i){}const _0=new li("Application Initializer");let jg=(()=>{class i{constructor(a){this.appInits=a,this.resolve=Ug,this.reject=Ug,this.initialized=!1,this.done=!1,this.donePromise=new Promise((m,x)=>{this.resolve=m,this.reject=x})}runInitializers(){if(this.initialized)return;const a=[],m=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let x=0;x<this.appInits.length;x++){const E=this.appInits[x]();if(Ql(E))a.push(E);else if(vc(E)){const M=new Promise((L,N)=>{E.subscribe({complete:L,error:N})});a.push(M)}}Promise.all(a).then(()=>{m()}).catch(x=>{this.reject(x)}),0===a.length&&m(),this.initialized=!0}}return i.\u0275fac=function(a){return new(a||i)(ce(_0,8))},i.\u0275prov=Rr({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const y0=new li("AppId",{providedIn:"root",factory:function v0(){return`${My()}${My()}${My()}`}});function My(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const x0=new li("Platform Initializer"),Vw=new li("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),$w=new li("AnimationModuleType");let Gw=(()=>{class i{log(a){console.log(a)}warn(a){console.warn(a)}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=Rr({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();const Vg=new li("LocaleId",{providedIn:"root",factory:()=>Y(Vg,ht.Optional|ht.SkipSelf)||function Hw(){return typeof $localize<"u"&&$localize.locale||hl}()}),qw=new li("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});class Ww{constructor(o,a){this.ngModuleFactory=o,this.componentFactories=a}}let Zw=(()=>{class i{compileModuleSync(a){return new dy(a)}compileModuleAsync(a){return Promise.resolve(this.compileModuleSync(a))}compileModuleAndAllComponentsSync(a){const m=this.compileModuleSync(a),E=Yl(kn(a).declarations).reduce((M,L)=>{const N=ar(L);return N&&M.push(new qu(N)),M},[]);return new Ww(m,E)}compileModuleAndAllComponentsAsync(a){return Promise.resolve(this.compileModuleAndAllComponentsSync(a))}clearCache(){}clearCacheFor(a){}getModuleId(a){}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=Rr({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const Yw=(()=>Promise.resolve(0))();function Iy(i){typeof Zone>"u"?Yw.then(()=>{i&&i.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",i)}class ic{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:a=!1,shouldCoalesceRunChangeDetection:m=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new $c(!1),this.onMicrotaskEmpty=new $c(!1),this.onStable=new $c(!1),this.onError=new $c(!1),typeof Zone>"u")throw new Me(908,!1);Zone.assertZonePatched();const x=this;x._nesting=0,x._outer=x._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(x._inner=x._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(x._inner=x._inner.fork(Zone.longStackTraceZoneSpec)),x.shouldCoalesceEventChangeDetection=!m&&a,x.shouldCoalesceRunChangeDetection=m,x.lastRequestAnimationFrameId=-1,x.nativeRequestAnimationFrame=function Jw(){let i=$r.requestAnimationFrame,o=$r.cancelAnimationFrame;if(typeof Zone<"u"&&i&&o){const a=i[Zone.__symbol__("OriginalDelegate")];a&&(i=a);const m=o[Zone.__symbol__("OriginalDelegate")];m&&(o=m)}return{nativeRequestAnimationFrame:i,nativeCancelAnimationFrame:o}}().nativeRequestAnimationFrame,function tb(i){const o=()=>{!function eb(i){i.isCheckStableRunning||-1!==i.lastRequestAnimationFrameId||(i.lastRequestAnimationFrameId=i.nativeRequestAnimationFrame.call($r,()=>{i.fakeTopEventTask||(i.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{i.lastRequestAnimationFrameId=-1,Py(i),i.isCheckStableRunning=!0,Ay(i),i.isCheckStableRunning=!1},void 0,()=>{},()=>{})),i.fakeTopEventTask.invoke()}),Py(i))}(i)};i._inner=i._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(a,m,x,E,M,L)=>{try{return E0(i),a.invokeTask(x,E,M,L)}finally{(i.shouldCoalesceEventChangeDetection&&"eventTask"===E.type||i.shouldCoalesceRunChangeDetection)&&o(),T0(i)}},onInvoke:(a,m,x,E,M,L,N)=>{try{return E0(i),a.invoke(x,E,M,L,N)}finally{i.shouldCoalesceRunChangeDetection&&o(),T0(i)}},onHasTask:(a,m,x,E)=>{a.hasTask(x,E),m===x&&("microTask"==E.change?(i._hasPendingMicrotasks=E.microTask,Py(i),Ay(i)):"macroTask"==E.change&&(i.hasPendingMacrotasks=E.macroTask))},onHandleError:(a,m,x,E)=>(a.handleError(x,E),i.runOutsideAngular(()=>i.onError.emit(E)),!1)})}(x)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!ic.isInAngularZone())throw new Me(909,!1)}static assertNotInAngularZone(){if(ic.isInAngularZone())throw new Me(909,!1)}run(o,a,m){return this._inner.run(o,a,m)}runTask(o,a,m,x){const E=this._inner,M=E.scheduleEventTask("NgZoneEvent: "+x,o,Qw,Ug,Ug);try{return E.runTask(M,a,m)}finally{E.cancelTask(M)}}runGuarded(o,a,m){return this._inner.runGuarded(o,a,m)}runOutsideAngular(o){return this._outer.run(o)}}const Qw={};function Ay(i){if(0==i._nesting&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function Py(i){i.hasPendingMicrotasks=!!(i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&-1!==i.lastRequestAnimationFrameId)}function E0(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function T0(i){i._nesting--,Ay(i)}class nb{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new $c,this.onMicrotaskEmpty=new $c,this.onStable=new $c,this.onError=new $c}run(o,a,m){return o.apply(a,m)}runGuarded(o,a,m){return o.apply(a,m)}runOutsideAngular(o){return o()}runTask(o,a,m,x){return o.apply(a,m)}}const D0=new li(""),C0=new li("");let Ry,rb=(()=>{class i{constructor(a,m,x){this._ngZone=a,this.registry=m,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Ry||(function ib(i){Ry=i}(x),x.addToWindow(m)),this._watchAngularEvents(),a.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{ic.assertNotInAngularZone(),Iy(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Iy(()=>{for(;0!==this._callbacks.length;){let a=this._callbacks.pop();clearTimeout(a.timeoutId),a.doneCb(this._didWork)}this._didWork=!1});else{let a=this.getPendingTasks();this._callbacks=this._callbacks.filter(m=>!m.updateCb||!m.updateCb(a)||(clearTimeout(m.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(a=>({source:a.source,creationLocation:a.creationLocation,data:a.data})):[]}addCallback(a,m,x){let E=-1;m&&m>0&&(E=setTimeout(()=>{this._callbacks=this._callbacks.filter(M=>M.timeoutId!==E),a(this._didWork,this.getPendingTasks())},m)),this._callbacks.push({doneCb:a,timeoutId:E,updateCb:x})}whenStable(a,m,x){if(x&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(a,m,x),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(a){this.registry.registerApplication(a,this)}unregisterApplication(a){this.registry.unregisterApplication(a)}findProviders(a,m,x){return[]}}return i.\u0275fac=function(a){return new(a||i)(ce(ic),ce(S0),ce(C0))},i.\u0275prov=Rr({token:i,factory:i.\u0275fac}),i})(),S0=(()=>{class i{constructor(){this._applications=new Map}registerApplication(a,m){this._applications.set(a,m)}unregisterApplication(a){this._applications.delete(a)}unregisterAllApplications(){this._applications.clear()}getTestability(a){return this._applications.get(a)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(a,m=!0){return Ry?.findTestabilityInTree(this,a,m)??null}}return i.\u0275fac=function(a){return new(a||i)},i.\u0275prov=Rr({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();const bu=!1;let rh=null;const M0=new li("AllowMultipleToken"),ky=new li("PlatformDestroyListeners"),I0=new li("appBootstrapListener");class ab{constructor(o,a){this.name=o,this.token=a}}function P0(i,o,a=[]){const m=`Platform: ${o}`,x=new li(m);return(E=[])=>{let M=Ly();if(!M||M.injector.get(M0,!1)){const L=[...a,...E,{provide:x,useValue:!0}];i?i(L):function lb(i){if(rh&&!rh.get(M0,!1))throw new Me(400,!1);rh=i;const o=i.get(k0);(function A0(i){const o=i.get(x0,null);o&&o.forEach(a=>a())})(i)}(function R0(i=[],o){return Ml.create({name:o,providers:[{provide:Sd,useValue:"platform"},{provide:ky,useValue:new Set([()=>rh=null])},...i]})}(L,m))}return function ub(i){const o=Ly();if(!o)throw new Me(401,!1);return o}()}}function Ly(){return rh?.get(k0)??null}let k0=(()=>{class i{constructor(a){this._injector=a,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(a,m){const x=function O0(i,o){let a;return a="noop"===i?new nb:("zone.js"===i?void 0:i)||new ic(o),a}(m?.ngZone,function L0(i){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!i||!i.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!i||!i.ngZoneRunCoalescing)||!1}}(m)),E=[{provide:ic,useValue:x}];return x.run(()=>{const M=Ml.create({providers:E,parent:this.injector,name:a.moduleType.name}),L=a.create(M),N=L.injector.get(Ch,null);if(!N)throw new Me(402,!1);return x.runOutsideAngular(()=>{const Z=x.onError.subscribe({next:le=>{N.handleError(le)}});L.onDestroy(()=>{Gg(this._modules,L),Z.unsubscribe()})}),function F0(i,o,a){try{const m=a();return Ql(m)?m.catch(x=>{throw o.runOutsideAngular(()=>i.handleError(x)),x}):m}catch(m){throw o.runOutsideAngular(()=>i.handleError(m)),m}}(N,x,()=>{const Z=L.injector.get(jg);return Z.runInitializers(),Z.donePromise.then(()=>(function qy(i){Ar(i,"Expected localeId to be defined"),"string"==typeof i&&(Hy=i.toLowerCase().replace(/_/g,"-"))}(L.injector.get(Vg,hl)||hl),this._moduleDoBootstrap(L),L))})})}bootstrapModule(a,m=[]){const x=z0({},m);return function ob(i,o,a){const m=new dy(a);return Promise.resolve(m)}(0,0,a).then(E=>this.bootstrapModuleFactory(E,x))}_moduleDoBootstrap(a){const m=a.injector.get($g);if(a._bootstrapComponents.length>0)a._bootstrapComponents.forEach(x=>m.bootstrap(x));else{if(!a.instance.ngDoBootstrap)throw new Me(-403,!1);a.instance.ngDoBootstrap(m)}this._modules.push(a)}onDestroy(a){this._destroyListeners.push(a)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Me(404,!1);this._modules.slice().forEach(m=>m.destroy()),this._destroyListeners.forEach(m=>m());const a=this._injector.get(ky,null);a&&(a.forEach(m=>m()),a.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return i.\u0275fac=function(a){return new(a||i)(ce(Ml))},i.\u0275prov=Rr({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();function z0(i,o){return Array.isArray(o)?o.reduce(z0,i):{...i,...o}}let $g=(()=>{class i{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(a,m,x){this._zone=a,this._injector=m,this._exceptionHandler=x,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const E=new Ge.y(L=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{L.next(this._stable),L.complete()})}),M=new Ge.y(L=>{let N;this._zone.runOutsideAngular(()=>{N=this._zone.onStable.subscribe(()=>{ic.assertNotInAngularZone(),Iy(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,L.next(!0))})})});const Z=this._zone.onUnstable.subscribe(()=>{ic.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{L.next(!1)}))});return()=>{N.unsubscribe(),Z.unsubscribe()}});this.isStable=function wt(...i){const o=(0,qt.yG)(i),a=(0,qt._6)(i,1/0),m=i;return m.length?1===m.length?(0,Le.Xf)(m[0]):(0,c.J)(a)((0,zt.D)(m,o)):en.E}(E,M.pipe(function Zt(i={}){const{connector:o=(()=>new W.x),resetOnError:a=!0,resetOnComplete:m=!0,resetOnRefCountZero:x=!0}=i;return E=>{let M,L,N,Z=0,le=!1,Te=!1;const Ve=()=>{L?.unsubscribe(),L=void 0},nt=()=>{Ve(),M=N=void 0,le=Te=!1},Mt=()=>{const tn=M;nt(),tn?.unsubscribe()};return(0,mt.e)((tn,Dn)=>{Z++,!Te&&!le&&Ve();const Ln=N=N??o();Dn.add(()=>{Z--,0===Z&&!Te&&!le&&(L=Pn(Mt,x))}),Ln.subscribe(Dn),!M&&Z>0&&(M=new Et.Hp({next:lr=>Ln.next(lr),error:lr=>{Te=!0,Ve(),L=Pn(nt,a,lr),Ln.error(lr)},complete:()=>{le=!0,Ve(),L=Pn(nt,m),Ln.complete()}}),(0,Le.Xf)(tn).subscribe(M))})(E)}}()))}bootstrap(a,m){const x=a instanceof Xl;if(!this._injector.get(jg).done){!x&&$t(a);throw new Me(405,bu)}let M;M=x?a:this._injector.get(Eh).resolveComponentFactory(a),this.componentTypes.push(M.componentType);const L=function sb(i){return i.isBoundToModule}(M)?void 0:this._injector.get(pf),Z=M.create(Ml.NULL,[],m||M.selector,L),le=Z.location.nativeElement,Te=Z.injector.get(D0,null);return Te?.registerApplication(le),Z.onDestroy(()=>{this.detachView(Z.hostView),Gg(this.components,Z),Te?.unregisterApplication(le)}),this._loadComponent(Z),Z}tick(){if(this._runningTick)throw new Me(101,!1);try{this._runningTick=!0;for(let a of this._views)a.detectChanges()}catch(a){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(a))}finally{this._runningTick=!1}}attachView(a){const m=a;this._views.push(m),m.attachToAppRef(this)}detachView(a){const m=a;Gg(this._views,m),m.detachFromAppRef()}_loadComponent(a){this.attachView(a.hostView),this.tick(),this.components.push(a);const m=this._injector.get(I0,[]);m.push(...this._bootstrapListeners),m.forEach(x=>x(a))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(a=>a()),this._views.slice().forEach(a=>a.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(a){return this._destroyListeners.push(a),()=>Gg(this._destroyListeners,a)}destroy(){if(this._destroyed)throw new Me(406,!1);const a=this._injector;a.destroy&&!a.destroyed&&a.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return i.\u0275fac=function(a){return new(a||i)(ce(ic),ce(zc),ce(Ch))},i.\u0275prov=Rr({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function Gg(i,o){const a=i.indexOf(o);a>-1&&i.splice(a,1)}let db=(()=>{class i{}return i.__NG_ELEMENT_ID__=fb,i})();function fb(i){return function pb(i,o,a){if(us(i)&&!a){const m=Ao(i.index,o);return new Gu(m,m)}return 47&i.type?new Gu(o[Vr],o):null}(mi(),Ft(),16==(16&i))}class V0{constructor(){}supports(o){return Yd(o)}create(o){return new xb(o)}}const vb=(i,o)=>o;class xb{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||vb}forEachItem(o){let a;for(a=this._itHead;null!==a;a=a._next)o(a)}forEachOperation(o){let a=this._itHead,m=this._removalsHead,x=0,E=null;for(;a||m;){const M=!m||a&&a.currentIndex<G0(m,x,E)?a:m,L=G0(M,x,E),N=M.currentIndex;if(M===m)x--,m=m._nextRemoved;else if(a=a._next,null==M.previousIndex)x++;else{E||(E=[]);const Z=L-x,le=N-x;if(Z!=le){for(let Ve=0;Ve<Z;Ve++){const nt=Ve<E.length?E[Ve]:E[Ve]=0,Mt=nt+Ve;le<=Mt&&Mt<Z&&(E[Ve]=nt+1)}E[M.previousIndex]=le-Z}}L!==N&&o(M,L,N)}}forEachPreviousItem(o){let a;for(a=this._previousItHead;null!==a;a=a._nextPrevious)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachMovedItem(o){let a;for(a=this._movesHead;null!==a;a=a._nextMoved)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}forEachIdentityChange(o){let a;for(a=this._identityChangesHead;null!==a;a=a._nextIdentityChange)o(a)}diff(o){if(null==o&&(o=[]),!Yd(o))throw new Me(900,!1);return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let x,E,M,a=this._itHead,m=!1;if(Array.isArray(o)){this.length=o.length;for(let L=0;L<this.length;L++)E=o[L],M=this._trackByFn(L,E),null!==a&&Object.is(a.trackById,M)?(m&&(a=this._verifyReinsertion(a,E,M,L)),Object.is(a.item,E)||this._addIdentityChange(a,E)):(a=this._mismatch(a,E,M,L),m=!0),a=a._next}else x=0,function jh(i,o){if(Array.isArray(i))for(let a=0;a<i.length;a++)o(i[a]);else{const a=i[Symbol.iterator]();let m;for(;!(m=a.next()).done;)o(m.value)}}(o,L=>{M=this._trackByFn(x,L),null!==a&&Object.is(a.trackById,M)?(m&&(a=this._verifyReinsertion(a,L,M,x)),Object.is(a.item,L)||this._addIdentityChange(a,L)):(a=this._mismatch(a,L,M,x),m=!0),a=a._next,x++}),this.length=x;return this._truncate(a),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,a,m,x){let E;return null===o?E=this._itTail:(E=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(m,null))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._reinsertAfter(o,E,x)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(m,x))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._moveAfter(o,E,x)):o=this._addAfter(new wb(a,m),E,x),o}_verifyReinsertion(o,a,m,x){let E=null===this._unlinkedRecords?null:this._unlinkedRecords.get(m,null);return null!==E?o=this._reinsertAfter(E,o._prev,x):o.currentIndex!=x&&(o.currentIndex=x,this._addToMoves(o,x)),o}_truncate(o){for(;null!==o;){const a=o._next;this._addToRemovals(this._unlink(o)),o=a}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,a,m){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const x=o._prevRemoved,E=o._nextRemoved;return null===x?this._removalsHead=E:x._nextRemoved=E,null===E?this._removalsTail=x:E._prevRemoved=x,this._insertAfter(o,a,m),this._addToMoves(o,m),o}_moveAfter(o,a,m){return this._unlink(o),this._insertAfter(o,a,m),this._addToMoves(o,m),o}_addAfter(o,a,m){return this._insertAfter(o,a,m),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,a,m){const x=null===a?this._itHead:a._next;return o._next=x,o._prev=a,null===x?this._itTail=o:x._prev=o,null===a?this._itHead=o:a._next=o,null===this._linkedRecords&&(this._linkedRecords=new $0),this._linkedRecords.put(o),o.currentIndex=m,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const a=o._prev,m=o._next;return null===a?this._itHead=m:a._next=m,null===m?this._itTail=a:m._prev=a,o}_addToMoves(o,a){return o.previousIndex===a||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new $0),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,a){return o.item=a,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class wb{constructor(o,a){this.item=o,this.trackById=a,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class bb{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,a){let m;for(m=this._head;null!==m;m=m._nextDup)if((null===a||a<=m.currentIndex)&&Object.is(m.trackById,o))return m;return null}remove(o){const a=o._prevDup,m=o._nextDup;return null===a?this._head=m:a._nextDup=m,null===m?this._tail=a:m._prevDup=a,null===this._head}}class $0{constructor(){this.map=new Map}put(o){const a=o.trackById;let m=this.map.get(a);m||(m=new bb,this.map.set(a,m)),m.add(o)}get(o,a){const x=this.map.get(o);return x?x.get(o,a):null}remove(o){const a=o.trackById;return this.map.get(a).remove(o)&&this.map.delete(a),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function G0(i,o,a){const m=i.previousIndex;if(null===m)return m;let x=0;return a&&m<a.length&&(x=a[m]),m+o+x}class H0{constructor(){}supports(o){return o instanceof Map||fu(o)}create(){return new Eb}}class Eb{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let a;for(a=this._mapHead;null!==a;a=a._next)o(a)}forEachPreviousItem(o){let a;for(a=this._previousMapHead;null!==a;a=a._nextPrevious)o(a)}forEachChangedItem(o){let a;for(a=this._changesHead;null!==a;a=a._nextChanged)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}diff(o){if(o){if(!(o instanceof Map||fu(o)))throw new Me(900,!1)}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let a=this._mapHead;if(this._appendAfter=null,this._forEach(o,(m,x)=>{if(a&&a.key===x)this._maybeAddToChanges(a,m),this._appendAfter=a,a=a._next;else{const E=this._getOrCreateRecordForKey(x,m);a=this._insertBeforeOrAppend(a,E)}}),a){a._prev&&(a._prev._next=null),this._removalsHead=a;for(let m=a;null!==m;m=m._nextRemoved)m===this._mapHead&&(this._mapHead=null),this._records.delete(m.key),m._nextRemoved=m._next,m.previousValue=m.currentValue,m.currentValue=null,m._prev=null,m._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,a){if(o){const m=o._prev;return a._next=o,a._prev=m,o._prev=a,m&&(m._next=a),o===this._mapHead&&(this._mapHead=a),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=a,a._prev=this._appendAfter):this._mapHead=a,this._appendAfter=a,null}_getOrCreateRecordForKey(o,a){if(this._records.has(o)){const x=this._records.get(o);this._maybeAddToChanges(x,a);const E=x._prev,M=x._next;return E&&(E._next=M),M&&(M._prev=E),x._next=null,x._prev=null,x}const m=new Tb(o);return this._records.set(o,m),m.currentValue=a,this._addToAdditions(m),m}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,a){Object.is(a,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=a,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,a){o instanceof Map?o.forEach(a):Object.keys(o).forEach(m=>a(o[m],m))}}class Tb{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function q0(){return new Ny([new V0])}let Ny=(()=>{class i{constructor(a){this.factories=a}static create(a,m){if(null!=m){const x=m.factories.slice();a=a.concat(x)}return new i(a)}static extend(a){return{provide:i,useFactory:m=>i.create(a,m||q0()),deps:[[i,new ze,new Re]]}}find(a){const m=this.factories.find(x=>x.supports(a));if(null!=m)return m;throw new Me(901,!1)}}return i.\u0275prov=Rr({token:i,providedIn:"root",factory:q0}),i})();function W0(){return new Uy([new H0])}let Uy=(()=>{class i{constructor(a){this.factories=a}static create(a,m){if(m){const x=m.factories.slice();a=a.concat(x)}return new i(a)}static extend(a){return{provide:i,useFactory:m=>i.create(a,m||W0()),deps:[[i,new ze,new Re]]}}find(a){const m=this.factories.find(x=>x.supports(a));if(m)return m;throw new Me(901,!1)}}return i.\u0275prov=Rr({token:i,providedIn:"root",factory:W0}),i})();const Sb=P0(null,"core",[]);let Mb=(()=>{class i{constructor(a){}}return i.\u0275fac=function(a){return new(a||i)(ce($g))},i.\u0275mod=Qr({type:i}),i.\u0275inj=vi({}),i})();function Ib(i){return"boolean"==typeof i?i:null!=i&&"false"!==i}},1481:(or,Gt,De)=>{"use strict";De.d(Gt,{Dx:()=>Er,b2:()=>di,q6:()=>vi,se:()=>dn});var W=De(6895),ge=De(8256);class Ge extends W.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class c extends Ge{static makeCurrent(){(0,W.HT)(new c)}onAndCancel(se,X,oe){return se.addEventListener(X,oe,!1),()=>{se.removeEventListener(X,oe,!1)}}dispatchEvent(se,X){se.dispatchEvent(X)}remove(se){se.parentNode&&se.parentNode.removeChild(se)}createElement(se,X){return(X=X||this.getDefaultDocument()).createElement(se)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(se){return se.nodeType===Node.ELEMENT_NODE}isShadowRoot(se){return se instanceof DocumentFragment}getGlobalEventTarget(se,X){return"window"===X?window:"document"===X?se:"body"===X?se.body:null}getBaseHref(se){const X=function en(){return Le=Le||document.querySelector("base"),Le?Le.getAttribute("href"):null}();return null==X?null:function zt(ie){qt=qt||document.createElement("a"),qt.setAttribute("href",ie);const se=qt.pathname;return"/"===se.charAt(0)?se:`/${se}`}(X)}resetBaseElement(){Le=null}getUserAgent(){return window.navigator.userAgent}getCookie(se){return(0,W.Mx)(document.cookie,se)}}let qt,Le=null;const wt=new ge.OlP("TRANSITION_ID"),mt=[{provide:ge.ip1,useFactory:function Et(ie,se,X){return()=>{X.get(ge.CZH).donePromise.then(()=>{const oe=(0,W.q)(),_e=se.querySelectorAll(`style[ng-transition="${ie}"]`);for(let Ue=0;Ue<_e.length;Ue++)oe.remove(_e[Ue])})}},deps:[wt,W.K0,ge.zs3],multi:!0}];let Pn=(()=>{class ie{build(){return new XMLHttpRequest}}return ie.\u0275fac=function(X){return new(X||ie)},ie.\u0275prov=ge.Yz7({token:ie,factory:ie.\u0275fac}),ie})();const Ut=new ge.OlP("EventManagerPlugins");let cn=(()=>{class ie{constructor(X,oe){this._zone=oe,this._eventNameToPlugin=new Map,X.forEach(_e=>{_e.manager=this}),this._plugins=X.slice().reverse()}addEventListener(X,oe,_e){return this._findPluginFor(oe).addEventListener(X,oe,_e)}addGlobalEventListener(X,oe,_e){return this._findPluginFor(oe).addGlobalEventListener(X,oe,_e)}getZone(){return this._zone}_findPluginFor(X){const oe=this._eventNameToPlugin.get(X);if(oe)return oe;const _e=this._plugins;for(let Ue=0;Ue<_e.length;Ue++){const ct=_e[Ue];if(ct.supports(X))return this._eventNameToPlugin.set(X,ct),ct}throw new Error(`No event manager plugin found for event ${X}`)}}return ie.\u0275fac=function(X){return new(X||ie)(ge.LFG(Ut),ge.LFG(ge.R0b))},ie.\u0275prov=ge.Yz7({token:ie,factory:ie.\u0275fac}),ie})();class In{constructor(se){this._doc=se}addGlobalEventListener(se,X,oe){const _e=(0,W.q)().getGlobalEventTarget(this._doc,se);if(!_e)throw new Error(`Unsupported event target ${_e} for event ${X}`);return this.addEventListener(_e,X,oe)}}let Xn=(()=>{class ie{constructor(){this.usageCount=new Map}addStyles(X){for(const oe of X)1===this.changeUsageCount(oe,1)&&this.onStyleAdded(oe)}removeStyles(X){for(const oe of X)0===this.changeUsageCount(oe,-1)&&this.onStyleRemoved(oe)}onStyleRemoved(X){}onStyleAdded(X){}getAllStyles(){return this.usageCount.keys()}changeUsageCount(X,oe){const _e=this.usageCount;let Ue=_e.get(X)??0;return Ue+=oe,Ue>0?_e.set(X,Ue):_e.delete(X),Ue}ngOnDestroy(){for(const X of this.getAllStyles())this.onStyleRemoved(X);this.usageCount.clear()}}return ie.\u0275fac=function(X){return new(X||ie)},ie.\u0275prov=ge.Yz7({token:ie,factory:ie.\u0275fac}),ie})(),dt=(()=>{class ie extends Xn{constructor(X){super(),this.doc=X,this.styleRef=new Map,this.hostNodes=new Set,this.resetHostNodes()}onStyleAdded(X){for(const oe of this.hostNodes)this.addStyleToHost(oe,X)}onStyleRemoved(X){const oe=this.styleRef;oe.get(X)?.forEach(Ue=>Ue.remove()),oe.delete(X)}ngOnDestroy(){super.ngOnDestroy(),this.styleRef.clear(),this.resetHostNodes()}addHost(X){this.hostNodes.add(X);for(const oe of this.getAllStyles())this.addStyleToHost(X,oe)}removeHost(X){this.hostNodes.delete(X)}addStyleToHost(X,oe){const _e=this.doc.createElement("style");_e.textContent=oe,X.appendChild(_e);const Ue=this.styleRef.get(oe);Ue?Ue.push(_e):this.styleRef.set(oe,[_e])}resetHostNodes(){const X=this.hostNodes;X.clear(),X.add(this.doc.head)}}return ie.\u0275fac=function(X){return new(X||ie)(ge.LFG(W.K0))},ie.\u0275prov=ge.Yz7({token:ie,factory:ie.\u0275fac}),ie})();const yr={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},sn=/%COMP%/g,Wt=new ge.OlP("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function fn(ie,se){return se.flat(100).map(X=>X.replace(sn,ie))}function vn(ie){return se=>{if("__ngUnwrap__"===se)return ie;!1===ie(se)&&(se.preventDefault(),se.returnValue=!1)}}let dn=(()=>{class ie{constructor(X,oe,_e,Ue){this.eventManager=X,this.sharedStylesHost=oe,this.appId=_e,this.removeStylesOnCompDestory=Ue,this.rendererByCompId=new Map,this.defaultRenderer=new ot(X)}createRenderer(X,oe){if(!X||!oe)return this.defaultRenderer;const _e=this.getOrCreateRenderer(X,oe);return _e instanceof an?_e.applyToHost(X):_e instanceof Dt&&_e.applyStyles(),_e}getOrCreateRenderer(X,oe){const _e=this.rendererByCompId;let Ue=_e.get(oe.id);if(!Ue){const ct=this.eventManager,lt=this.sharedStylesHost,kt=this.removeStylesOnCompDestory;switch(oe.encapsulation){case ge.ifc.Emulated:Ue=new an(ct,lt,oe,this.appId,kt);break;case ge.ifc.ShadowDom:return new Yt(ct,lt,X,oe);default:Ue=new Dt(ct,lt,oe,kt)}Ue.onDestroy=()=>_e.delete(oe.id),_e.set(oe.id,Ue)}return Ue}ngOnDestroy(){this.rendererByCompId.clear()}begin(){}end(){}}return ie.\u0275fac=function(X){return new(X||ie)(ge.LFG(cn),ge.LFG(dt),ge.LFG(ge.AFp),ge.LFG(Wt))},ie.\u0275prov=ge.Yz7({token:ie,factory:ie.\u0275fac}),ie})();class ot{constructor(se){this.eventManager=se,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(se,X){return X?document.createElementNS(yr[X]||X,se):document.createElement(se)}createComment(se){return document.createComment(se)}createText(se){return document.createTextNode(se)}appendChild(se,X){(At(se)?se.content:se).appendChild(X)}insertBefore(se,X,oe){se&&(At(se)?se.content:se).insertBefore(X,oe)}removeChild(se,X){se&&se.removeChild(X)}selectRootElement(se,X){let oe="string"==typeof se?document.querySelector(se):se;if(!oe)throw new Error(`The selector "${se}" did not match any elements`);return X||(oe.textContent=""),oe}parentNode(se){return se.parentNode}nextSibling(se){return se.nextSibling}setAttribute(se,X,oe,_e){if(_e){X=_e+":"+X;const Ue=yr[_e];Ue?se.setAttributeNS(Ue,X,oe):se.setAttribute(X,oe)}else se.setAttribute(X,oe)}removeAttribute(se,X,oe){if(oe){const _e=yr[oe];_e?se.removeAttributeNS(_e,X):se.removeAttribute(`${oe}:${X}`)}else se.removeAttribute(X)}addClass(se,X){se.classList.add(X)}removeClass(se,X){se.classList.remove(X)}setStyle(se,X,oe,_e){_e&(ge.JOm.DashCase|ge.JOm.Important)?se.style.setProperty(X,oe,_e&ge.JOm.Important?"important":""):se.style[X]=oe}removeStyle(se,X,oe){oe&ge.JOm.DashCase?se.style.removeProperty(X):se.style[X]=""}setProperty(se,X,oe){se[X]=oe}setValue(se,X){se.nodeValue=X}listen(se,X,oe){return"string"==typeof se?this.eventManager.addGlobalEventListener(se,X,vn(oe)):this.eventManager.addEventListener(se,X,vn(oe))}}function At(ie){return"TEMPLATE"===ie.tagName&&void 0!==ie.content}class Yt extends ot{constructor(se,X,oe,_e){super(se),this.sharedStylesHost=X,this.hostEl=oe,this.shadowRoot=oe.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const Ue=fn(_e.id,_e.styles);for(const ct of Ue){const lt=document.createElement("style");lt.textContent=ct,this.shadowRoot.appendChild(lt)}}nodeOrShadowRoot(se){return se===this.hostEl?this.shadowRoot:se}appendChild(se,X){return super.appendChild(this.nodeOrShadowRoot(se),X)}insertBefore(se,X,oe){return super.insertBefore(this.nodeOrShadowRoot(se),X,oe)}removeChild(se,X){return super.removeChild(this.nodeOrShadowRoot(se),X)}parentNode(se){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(se)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Dt extends ot{constructor(se,X,oe,_e,Ue=oe.id){super(se),this.sharedStylesHost=X,this.removeStylesOnCompDestory=_e,this.rendererUsageCount=0,this.styles=fn(Ue,oe.styles)}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class an extends Dt{constructor(se,X,oe,_e,Ue){const ct=_e+"-"+oe.id;super(se,X,oe,Ue,ct),this.contentAttr=function gt(ie){return"_ngcontent-%COMP%".replace(sn,ie)}(ct),this.hostAttr=function ft(ie){return"_nghost-%COMP%".replace(sn,ie)}(ct)}applyToHost(se){this.applyStyles(),this.setAttribute(se,this.hostAttr,"")}createElement(se,X){const oe=super.createElement(se,X);return super.setAttribute(oe,this.contentAttr,""),oe}}let hr=(()=>{class ie extends In{constructor(X){super(X)}supports(X){return!0}addEventListener(X,oe,_e){return X.addEventListener(oe,_e,!1),()=>this.removeEventListener(X,oe,_e)}removeEventListener(X,oe,_e){return X.removeEventListener(oe,_e)}}return ie.\u0275fac=function(X){return new(X||ie)(ge.LFG(W.K0))},ie.\u0275prov=ge.Yz7({token:ie,factory:ie.\u0275fac}),ie})();const vr=["alt","control","meta","shift"],Mn={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},er={alt:ie=>ie.altKey,control:ie=>ie.ctrlKey,meta:ie=>ie.metaKey,shift:ie=>ie.shiftKey};let Vn=(()=>{class ie extends In{constructor(X){super(X)}supports(X){return null!=ie.parseEventName(X)}addEventListener(X,oe,_e){const Ue=ie.parseEventName(oe),ct=ie.eventCallback(Ue.fullKey,_e,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,W.q)().onAndCancel(X,Ue.domEventName,ct))}static parseEventName(X){const oe=X.toLowerCase().split("."),_e=oe.shift();if(0===oe.length||"keydown"!==_e&&"keyup"!==_e)return null;const Ue=ie._normalizeKey(oe.pop());let ct="",lt=oe.indexOf("code");if(lt>-1&&(oe.splice(lt,1),ct="code."),vr.forEach(hn=>{const Lt=oe.indexOf(hn);Lt>-1&&(oe.splice(Lt,1),ct+=hn+".")}),ct+=Ue,0!=oe.length||0===Ue.length)return null;const kt={};return kt.domEventName=_e,kt.fullKey=ct,kt}static matchEventFullKeyCode(X,oe){let _e=Mn[X.key]||X.key,Ue="";return oe.indexOf("code.")>-1&&(_e=X.code,Ue="code."),!(null==_e||!_e)&&(_e=_e.toLowerCase()," "===_e?_e="space":"."===_e&&(_e="dot"),vr.forEach(ct=>{ct!==_e&&(0,er[ct])(X)&&(Ue+=ct+".")}),Ue+=_e,Ue===oe)}static eventCallback(X,oe,_e){return Ue=>{ie.matchEventFullKeyCode(Ue,X)&&_e.runGuarded(()=>oe(Ue))}}static _normalizeKey(X){return"esc"===X?"escape":X}}return ie.\u0275fac=function(X){return new(X||ie)(ge.LFG(W.K0))},ie.\u0275prov=ge.Yz7({token:ie,factory:ie.\u0275fac}),ie})();const vi=(0,ge.eFA)(ge._c5,"browser",[{provide:ge.Lbi,useValue:W.bD},{provide:ge.g9A,useValue:function Pr(){c.makeCurrent()},multi:!0},{provide:W.K0,useFactory:function Rr(){return(0,ge.RDi)(document),document},deps:[]}]),xn=new ge.OlP(""),kr=[{provide:ge.rWj,useClass:class Zt{addToWindow(se){ge.dqk.getAngularTestability=(oe,_e=!0)=>{const Ue=se.findTestabilityInTree(oe,_e);if(null==Ue)throw new Error("Could not find testability for element.");return Ue},ge.dqk.getAllAngularTestabilities=()=>se.getAllTestabilities(),ge.dqk.getAllAngularRootElements=()=>se.getAllRootElements(),ge.dqk.frameworkStabilizers||(ge.dqk.frameworkStabilizers=[]),ge.dqk.frameworkStabilizers.push(oe=>{const _e=ge.dqk.getAllAngularTestabilities();let Ue=_e.length,ct=!1;const lt=function(kt){ct=ct||kt,Ue--,0==Ue&&oe(ct)};_e.forEach(function(kt){kt.whenStable(lt)})})}findTestabilityInTree(se,X,oe){return null==X?null:se.getTestability(X)??(oe?(0,W.q)().isShadowRoot(X)?this.findTestabilityInTree(se,X.host,!0):this.findTestabilityInTree(se,X.parentElement,!0):null)}},deps:[]},{provide:ge.lri,useClass:ge.dDg,deps:[ge.R0b,ge.eoX,ge.rWj]},{provide:ge.dDg,useClass:ge.dDg,deps:[ge.R0b,ge.eoX,ge.rWj]}],Wi=[{provide:ge.zSh,useValue:"root"},{provide:ge.qLn,useFactory:function Zo(){return new ge.qLn},deps:[]},{provide:Ut,useClass:hr,multi:!0,deps:[W.K0,ge.R0b,ge.Lbi]},{provide:Ut,useClass:Vn,multi:!0,deps:[W.K0]},{provide:dn,useClass:dn,deps:[cn,dt,ge.AFp,Wt]},{provide:ge.FYo,useExisting:dn},{provide:Xn,useExisting:dt},{provide:dt,useClass:dt,deps:[W.K0]},{provide:cn,useClass:cn,deps:[Ut,ge.R0b]},{provide:W.JF,useClass:Pn,deps:[]},[]];let di=(()=>{class ie{constructor(X){}static withServerTransition(X){return{ngModule:ie,providers:[{provide:ge.AFp,useValue:X.appId},{provide:wt,useExisting:ge.AFp},mt]}}}return ie.\u0275fac=function(X){return new(X||ie)(ge.LFG(xn,12))},ie.\u0275mod=ge.oAB({type:ie}),ie.\u0275inj=ge.cJS({providers:[...Wi,...kr],imports:[W.ez,ge.hGG]}),ie})(),Er=(()=>{class ie{constructor(X){this._doc=X}getTitle(){return this._doc.title}setTitle(X){this._doc.title=X||""}}return ie.\u0275fac=function(X){return new(X||ie)(ge.LFG(W.K0))},ie.\u0275prov=ge.Yz7({token:ie,factory:function(X){let oe=null;return oe=X?new X:function Ai(){return new Er((0,ge.LFG)(W.K0))}(),oe},providedIn:"root"}),ie})();typeof window<"u"&&window},346:(or,Gt,De)=>{"use strict";De.d(Gt,{F0:()=>ts,rH:()=>Fl,Bz:()=>Mc,lC:()=>Vi});var W=De(8256),ge=De(2076),Ge=De(9646),c=De(1135);const en=(0,De(3888).d)(u=>function(){u(this),this.name="EmptyError",this.message="no elements in sequence"});var qt=De(9751),zt=De(4742),wt=De(4671),Et=De(3268),mt=De(7669),Zt=De(1810),Pn=De(5403),Ut=De(9672);function cn(...u){const d=(0,mt.yG)(u),f=(0,mt.jO)(u),{args:v,keys:b}=(0,zt.D)(u);if(0===v.length)return(0,ge.D)([],d);const C=new qt.y(function In(u,d,f=wt.y){return v=>{Xn(d,()=>{const{length:b}=u,C=new Array(b);let S=b,z=b;for(let H=0;H<b;H++)Xn(d,()=>{const ee=(0,ge.D)(u[H],d);let re=!1;ee.subscribe((0,Pn.x)(v,ue=>{C[H]=ue,re||(re=!0,z--),z||v.next(f(C.slice()))},()=>{--S||v.complete()}))},v)},v)}}(v,d,b?S=>(0,Zt.n)(b,S):wt.y));return f?C.pipe((0,Et.Z)(f)):C}function Xn(u,d,f){u?(0,Ut.f)(f,u,d):d()}var dt=De(8189);function sn(...u){return function yr(){return(0,dt.J)(1)}()((0,ge.D)(u,(0,mt.yG)(u)))}var Bt=De(8421);function je(u){return new qt.y(d=>{(0,Bt.Xf)(u()).subscribe(d)})}var Kt=De(9635),Hn=De(576);function Me(u,d){const f=(0,Hn.m)(u)?u:()=>u,v=b=>b.error(f());return new qt.y(d?b=>d.schedule(v,0,b):v)}var Wt=De(515),gt=De(727),ft=De(4482);function fn(){return(0,ft.e)((u,d)=>{let f=null;u._refCount++;const v=(0,Pn.x)(d,void 0,void 0,void 0,()=>{if(!u||u._refCount<=0||0<--u._refCount)return void(f=null);const b=u._connection,C=f;f=null,b&&(!C||b===C)&&b.unsubscribe(),d.unsubscribe()});u.subscribe(v),v.closed||(f=u.connect())})}class vn extends qt.y{constructor(d,f){super(),this.source=d,this.subjectFactory=f,this._subject=null,this._refCount=0,this._connection=null,(0,ft.A)(d)&&(this.lift=d.lift)}_subscribe(d){return this.getSubject().subscribe(d)}getSubject(){const d=this._subject;return(!d||d.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:d}=this;this._subject=this._connection=null,d?.unsubscribe()}connect(){let d=this._connection;if(!d){d=this._connection=new gt.w0;const f=this.getSubject();d.add(this.source.subscribe((0,Pn.x)(f,void 0,()=>{this._teardown(),f.complete()},v=>{this._teardown(),f.error(v)},()=>this._teardown()))),d.closed&&(this._connection=null,d=gt.w0.EMPTY)}return d}refCount(){return fn()(this)}}var dn=De(7579),ot=De(6895),$e=De(4004);function yt(u,d){return(0,ft.e)((f,v)=>{let b=null,C=0,S=!1;const z=()=>S&&!b&&v.complete();f.subscribe((0,Pn.x)(v,H=>{b?.unsubscribe();let ee=0;const re=C++;(0,Bt.Xf)(u(H,re)).subscribe(b=(0,Pn.x)(v,ue=>v.next(d?d(H,ue,re,ee++):ue),()=>{b=null,z()}))},()=>{S=!0,z()}))})}function At(u){return u<=0?()=>Wt.E:(0,ft.e)((d,f)=>{let v=0;d.subscribe((0,Pn.x)(f,b=>{++v<=u&&(f.next(b),u<=v&&f.complete())}))})}var Dt=De(9300),an=De(5577);function hr(u){return(0,ft.e)((d,f)=>{let v=!1;d.subscribe((0,Pn.x)(f,b=>{v=!0,f.next(b)},()=>{v||f.next(u),f.complete()}))})}function vr(u=Mn){return(0,ft.e)((d,f)=>{let v=!1;d.subscribe((0,Pn.x)(f,b=>{v=!0,f.next(b)},()=>v?f.complete():f.error(u())))})}function Mn(){return new en}function er(u,d){const f=arguments.length>=2;return v=>v.pipe(u?(0,Dt.h)((b,C)=>u(b,C,v)):wt.y,At(1),f?hr(d):vr(()=>new en))}var Vn=De(4351),zn=De(8505),cr=De(262);function nn(u,d){return(0,ft.e)(function Ar(u,d,f,v,b){return(C,S)=>{let z=f,H=d,ee=0;C.subscribe((0,Pn.x)(S,re=>{const ue=ee++;H=z?u(H,re,ue):(z=!0,re),v&&S.next(H)},b&&(()=>{z&&S.next(H),S.complete()})))}}(u,d,arguments.length>=2,!0))}function Kr(u){return u<=0?()=>Wt.E:(0,ft.e)((d,f)=>{let v=[];d.subscribe((0,Pn.x)(f,b=>{v.push(b),u<v.length&&v.shift()},()=>{for(const b of v)f.next(b);f.complete()},void 0,()=>{v=null}))})}function Pr(u,d){const f=arguments.length>=2;return v=>v.pipe(u?(0,Dt.h)((b,C)=>u(b,C,v)):wt.y,Kr(1),f?hr(d):vr(()=>new en))}function Yr(u){return(0,ft.e)((d,f)=>{try{d.subscribe(f)}finally{f.add(u)}})}var vi=De(1481);const xn="primary",kr=Symbol("RouteTitle");class Wi{constructor(d){this.params=d||{}}has(d){return Object.prototype.hasOwnProperty.call(this.params,d)}get(d){if(this.has(d)){const f=this.params[d];return Array.isArray(f)?f[0]:f}return null}getAll(d){if(this.has(d)){const f=this.params[d];return Array.isArray(f)?f:[f]}return[]}get keys(){return Object.keys(this.params)}}function di(u){return new Wi(u)}function zo(u,d,f){const v=f.path.split("/");if(v.length>u.length||"full"===f.pathMatch&&(d.hasChildren()||v.length<u.length))return null;const b={};for(let C=0;C<v.length;C++){const S=v[C],z=u[C];if(S.startsWith(":"))b[S.substring(1)]=z;else if(S!==z.path)return null}return{consumed:u.slice(0,v.length),posParams:b}}function br(u,d){const f=u?Object.keys(u):void 0,v=d?Object.keys(d):void 0;if(!f||!v||f.length!=v.length)return!1;let b;for(let C=0;C<f.length;C++)if(b=f[C],!Ai(u[b],d[b]))return!1;return!0}function Ai(u,d){if(Array.isArray(u)&&Array.isArray(d)){if(u.length!==d.length)return!1;const f=[...u].sort(),v=[...d].sort();return f.every((b,C)=>v[C]===b)}return u===d}function Er(u){return Array.prototype.concat.apply([],u)}function un(u){return u.length>0?u[u.length-1]:null}function Lr(u,d){for(const f in u)u.hasOwnProperty(f)&&d(u[f],f)}function Jr(u){return(0,W.CqO)(u)?u:(0,W.QGY)(u)?(0,ge.D)(Promise.resolve(u)):(0,Ge.of)(u)}const tr=!1,ro={exact:function Bo(u,d,f){if(!Rt(u.segments,d.segments)||!Ri(u.segments,d.segments,f)||u.numberOfChildren!==d.numberOfChildren)return!1;for(const v in d.children)if(!u.children[v]||!Bo(u.children[v],d.children[v],f))return!1;return!0},subset:Ui},Pi={exact:function jr(u,d){return br(u,d)},subset:function xr(u,d){return Object.keys(d).length<=Object.keys(u).length&&Object.keys(d).every(f=>Ai(u[f],d[f]))},ignored:()=>!0};function $r(u,d,f){return ro[f.paths](u.root,d.root,f.matrixParams)&&Pi[f.queryParams](u.queryParams,d.queryParams)&&!("exact"===f.fragment&&u.fragment!==d.fragment)}function Ui(u,d,f){return Rn(u,d,d.segments,f)}function Rn(u,d,f,v){if(u.segments.length>f.length){const b=u.segments.slice(0,f.length);return!(!Rt(b,f)||d.hasChildren()||!Ri(b,f,v))}if(u.segments.length===f.length){if(!Rt(u.segments,f)||!Ri(u.segments,f,v))return!1;for(const b in d.children)if(!u.children[b]||!Ui(u.children[b],d.children[b],v))return!1;return!0}{const b=f.slice(0,u.segments.length),C=f.slice(u.segments.length);return!!(Rt(u.segments,b)&&Ri(u.segments,b,v)&&u.children[xn])&&Rn(u.children[xn],d,C,v)}}function Ri(u,d,f){return d.every((v,b)=>Pi[f](u[b].parameters,v.parameters))}class Zi{constructor(d=new Je([],{}),f={},v=null){this.root=d,this.queryParams=f,this.fragment=v}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=di(this.queryParams)),this._queryParamMap}toString(){return q.serialize(this)}}class Je{constructor(d,f){this.segments=d,this.children=f,this.parent=null,Lr(f,(v,b)=>v.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Y(this)}}class Fe{constructor(d,f){this.path=d,this.parameters=f}get parameterMap(){return this._parameterMap||(this._parameterMap=di(this.parameters)),this._parameterMap}toString(){return Ue(this)}}function Rt(u,d){return u.length===d.length&&u.every((f,v)=>f.path===d[v].path)}let On=(()=>{class u{}return u.\u0275fac=function(f){return new(f||u)},u.\u0275prov=W.Yz7({token:u,factory:function(){return new ce},providedIn:"root"}),u})();class ce{parse(d){const f=new En(d);return new Zi(f.parseRootSegment(),f.parseQueryParams(),f.parseFragment())}serialize(d){const f=`/${de(d.root,!0)}`,v=function lt(u){const d=Object.keys(u).map(f=>{const v=u[f];return Array.isArray(v)?v.map(b=>`${ie(f)}=${ie(b)}`).join("&"):`${ie(f)}=${ie(v)}`}).filter(f=>!!f);return d.length?`?${d.join("&")}`:""}(d.queryParams);return`${f}${v}${"string"==typeof d.fragment?`#${function se(u){return encodeURI(u)}(d.fragment)}`:""}`}}const q=new ce;function Y(u){return u.segments.map(d=>Ue(d)).join("/")}function de(u,d){if(!u.hasChildren())return Y(u);if(d){const f=u.children[xn]?de(u.children[xn],!1):"",v=[];return Lr(u.children,(b,C)=>{C!==xn&&v.push(`${C}:${de(b,!1)}`)}),v.length>0?`${f}(${v.join("//")})`:f}{const f=function It(u,d){let f=[];return Lr(u.children,(v,b)=>{b===xn&&(f=f.concat(d(v,b)))}),Lr(u.children,(v,b)=>{b!==xn&&(f=f.concat(d(v,b)))}),f}(u,(v,b)=>b===xn?[de(u.children[xn],!1)]:[`${b}:${de(v,!1)}`]);return 1===Object.keys(u.children).length&&null!=u.children[xn]?`${Y(u)}/${f[0]}`:`${Y(u)}/(${f.join("//")})`}}function Ee(u){return encodeURIComponent(u).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function ie(u){return Ee(u).replace(/%3B/gi,";")}function X(u){return Ee(u).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function oe(u){return decodeURIComponent(u)}function _e(u){return oe(u.replace(/\+/g,"%20"))}function Ue(u){return`${X(u.path)}${function ct(u){return Object.keys(u).map(d=>`;${X(d)}=${X(u[d])}`).join("")}(u.parameters)}`}const kt=/^[^\/()?;=#]+/;function hn(u){const d=u.match(kt);return d?d[0]:""}const Lt=/^[^=?&#]+/,Qn=/^[^&#]+/;class En{constructor(d){this.url=d,this.remaining=d}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new Je([],{}):new Je([],this.parseChildren())}parseQueryParams(){const d={};if(this.consumeOptional("?"))do{this.parseQueryParam(d)}while(this.consumeOptional("&"));return d}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const d=[];for(this.peekStartsWith("(")||d.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),d.push(this.parseSegment());let f={};this.peekStartsWith("/(")&&(this.capture("/"),f=this.parseParens(!0));let v={};return this.peekStartsWith("(")&&(v=this.parseParens(!1)),(d.length>0||Object.keys(f).length>0)&&(v[xn]=new Je(d,f)),v}parseSegment(){const d=hn(this.remaining);if(""===d&&this.peekStartsWith(";"))throw new W.vHH(4009,tr);return this.capture(d),new Fe(oe(d),this.parseMatrixParams())}parseMatrixParams(){const d={};for(;this.consumeOptional(";");)this.parseParam(d);return d}parseParam(d){const f=hn(this.remaining);if(!f)return;this.capture(f);let v="";if(this.consumeOptional("=")){const b=hn(this.remaining);b&&(v=b,this.capture(v))}d[oe(f)]=oe(v)}parseQueryParam(d){const f=function mn(u){const d=u.match(Lt);return d?d[0]:""}(this.remaining);if(!f)return;this.capture(f);let v="";if(this.consumeOptional("=")){const S=function nr(u){const d=u.match(Qn);return d?d[0]:""}(this.remaining);S&&(v=S,this.capture(v))}const b=_e(f),C=_e(v);if(d.hasOwnProperty(b)){let S=d[b];Array.isArray(S)||(S=[S],d[b]=S),S.push(C)}else d[b]=C}parseParens(d){const f={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const v=hn(this.remaining),b=this.remaining[v.length];if("/"!==b&&")"!==b&&";"!==b)throw new W.vHH(4010,tr);let C;v.indexOf(":")>-1?(C=v.slice(0,v.indexOf(":")),this.capture(C),this.capture(":")):d&&(C=xn);const S=this.parseChildren();f[C]=1===Object.keys(S).length?S[xn]:new Je([],S),this.consumeOptional("//")}return f}peekStartsWith(d){return this.remaining.startsWith(d)}consumeOptional(d){return!!this.peekStartsWith(d)&&(this.remaining=this.remaining.substring(d.length),!0)}capture(d){if(!this.consumeOptional(d))throw new W.vHH(4011,tr)}}function zr(u){return u.segments.length>0?new Je([],{[xn]:u}):u}function Cr(u){const d={};for(const v of Object.keys(u.children)){const C=Cr(u.children[v]);(C.segments.length>0||C.hasChildren())&&(d[v]=C)}return function Xo(u){if(1===u.numberOfChildren&&u.children[xn]){const d=u.children[xn];return new Je(u.segments.concat(d.segments),d.children)}return u}(new Je(u.segments,d))}function ki(u){return u instanceof Zi}const st=!1;function Ba(u,d,f,v,b){if(0===f.length)return oi(d.root,d.root,d.root,v,b);const C=function kn(u){if("string"==typeof u[0]&&1===u.length&&"/"===u[0])return new $t(!0,0,u);let d=0,f=!1;const v=u.reduce((b,C,S)=>{if("object"==typeof C&&null!=C){if(C.outlets){const z={};return Lr(C.outlets,(H,ee)=>{z[ee]="string"==typeof H?H.split("/"):H}),[...b,{outlets:z}]}if(C.segmentPath)return[...b,C.segmentPath]}return"string"!=typeof C?[...b,C]:0===S?(C.split("/").forEach((z,H)=>{0==H&&"."===z||(0==H&&""===z?f=!0:".."===z?d++:""!=z&&b.push(z))}),b):[...b,C]},[]);return new $t(f,d,v)}(f);return C.toRoot()?oi(d.root,d.root,new Je([],{}),v,b):function S(H){const ee=function No(u,d,f,v){if(u.isAbsolute)return new Yn(d.root,!0,0);if(-1===v)return new Yn(f,f===d.root,0);return function $n(u,d,f){let v=u,b=d,C=f;for(;C>b;){if(C-=b,v=v.parent,!v)throw new W.vHH(4005,st&&"Invalid number of '../'");b=v.segments.length}return new Yn(v,!1,b-C)}(f,v+(Li(u.commands[0])?0:1),u.numberOfDoubleDots)}(C,d,u.snapshot?._urlSegment,H),re=ee.processChildren?Br(ee.segmentGroup,ee.index,C.commands):Jn(ee.segmentGroup,ee.index,C.commands);return oi(d.root,ee.segmentGroup,re,v,b)}(u.snapshot?._lastPathIndex)}function Li(u){return"object"==typeof u&&null!=u&&!u.outlets&&!u.segmentPath}function ar(u){return"object"==typeof u&&null!=u&&u.outlets}function oi(u,d,f,v,b){let S,C={};v&&Lr(v,(H,ee)=>{C[ee]=Array.isArray(H)?H.map(re=>`${re}`):`${H}`}),S=u===d?f:Ei(u,d,f);const z=zr(Cr(S));return new Zi(z,C,b)}function Ei(u,d,f){const v={};return Lr(u.children,(b,C)=>{v[C]=b===d?f:Ei(b,d,f)}),new Je(u.segments,v)}class $t{constructor(d,f,v){if(this.isAbsolute=d,this.numberOfDoubleDots=f,this.commands=v,d&&v.length>0&&Li(v[0]))throw new W.vHH(4003,st&&"Root segment cannot have matrix parameters");const b=v.find(ar);if(b&&b!==un(v))throw new W.vHH(4004,st&&"{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Yn{constructor(d,f,v){this.segmentGroup=d,this.processChildren=f,this.index=v}}function Jn(u,d,f){if(u||(u=new Je([],{})),0===u.segments.length&&u.hasChildren())return Br(u,d,f);const v=function Nr(u,d,f){let v=0,b=d;const C={match:!1,pathIndex:0,commandIndex:0};for(;b<u.segments.length;){if(v>=f.length)return C;const S=u.segments[b],z=f[v];if(ar(z))break;const H=`${z}`,ee=v<f.length-1?f[v+1]:null;if(b>0&&void 0===H)break;if(H&&ee&&"object"==typeof ee&&void 0===ee.outlets){if(!fi(H,ee,S))return C;v+=2}else{if(!fi(H,{},S))return C;v++}b++}return{match:!0,pathIndex:b,commandIndex:v}}(u,d,f),b=f.slice(v.commandIndex);if(v.match&&v.pathIndex<u.segments.length){const C=new Je(u.segments.slice(0,v.pathIndex),{});return C.children[xn]=new Je(u.segments.slice(v.pathIndex),u.children),Br(C,0,b)}return v.match&&0===b.length?new Je(u.segments,{}):v.match&&!u.hasChildren()?dr(u,d,f):v.match?Br(u,0,b):dr(u,d,f)}function Br(u,d,f){if(0===f.length)return new Je(u.segments,{});{const v=function pn(u){return ar(u[0])?u[0].outlets:{[xn]:u}}(f),b={};return!v[xn]&&u.children[xn]&&1===u.numberOfChildren&&0===u.children[xn].segments.length?Br(u.children[xn],d,f):(Lr(v,(C,S)=>{"string"==typeof C&&(C=[C]),null!==C&&(b[S]=Jn(u.children[S],d,C))}),Lr(u.children,(C,S)=>{void 0===v[S]&&(b[S]=C)}),new Je(u.segments,b))}}function dr(u,d,f){const v=u.segments.slice(0,d);let b=0;for(;b<f.length;){const C=f[b];if(ar(C)){const H=Oi(C.outlets);return new Je(v,H)}if(0===b&&Li(f[0])){v.push(new Fe(u.segments[d].path,Wr(f[0]))),b++;continue}const S=ar(C)?C.outlets[xn]:`${C}`,z=b<f.length-1?f[b+1]:null;S&&z&&Li(z)?(v.push(new Fe(S,Wr(z))),b+=2):(v.push(new Fe(S,{})),b++)}return new Je(v,{})}function Oi(u){const d={};return Lr(u,(f,v)=>{"string"==typeof f&&(f=[f]),null!==f&&(d[v]=dr(new Je([],{}),0,f))}),d}function Wr(u){const d={};return Lr(u,(f,v)=>d[v]=`${f}`),d}function fi(u,d,f){return u==f.path&&br(d,f.parameters)}const io="imperative";class oo{constructor(d,f){this.id=d,this.url=f}}class rr extends oo{constructor(d,f,v="imperative",b=null){super(d,f),this.type=0,this.navigationTrigger=v,this.restoredState=b}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class mo extends oo{constructor(d,f,v){super(d,f),this.urlAfterRedirects=v,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class lo extends oo{constructor(d,f,v,b){super(d,f),this.reason=v,this.code=b,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class Fi extends oo{constructor(d,f,v,b){super(d,f),this.reason=v,this.code=b,this.type=16}}class wo extends oo{constructor(d,f,v,b){super(d,f),this.error=v,this.target=b,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Vr extends oo{constructor(d,f,v,b){super(d,f),this.urlAfterRedirects=v,this.state=b,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Hr extends oo{constructor(d,f,v,b){super(d,f),this.urlAfterRedirects=v,this.state=b,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class cs extends oo{constructor(d,f,v,b,C){super(d,f),this.urlAfterRedirects=v,this.state=b,this.shouldActivate=C,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Ti extends oo{constructor(d,f,v,b){super(d,f),this.urlAfterRedirects=v,this.state=b,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ji extends oo{constructor(d,f,v,b){super(d,f),this.urlAfterRedirects=v,this.state=b,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class co{constructor(d){this.route=d,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Zr{constructor(d){this.route=d,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Xa{constructor(d){this.snapshot=d,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class wi{constructor(d){this.snapshot=d,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ws{constructor(d){this.snapshot=d,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class As{constructor(d){this.snapshot=d,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Uo{constructor(d,f,v){this.routerEvent=d,this.position=f,this.anchor=v,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let la=(()=>{class u{createUrlTree(f,v,b,C,S,z){return Ba(f||v.root,b,C,S,z)}}return u.\u0275fac=function(f){return new(f||u)},u.\u0275prov=W.Yz7({token:u,factory:u.\u0275fac}),u})(),uo=(()=>{class u{}return u.\u0275fac=function(f){return new(f||u)},u.\u0275prov=W.Yz7({token:u,factory:function(d){return la.\u0275fac(d)},providedIn:"root"}),u})();class Ps{constructor(d){this._root=d}get root(){return this._root.value}parent(d){const f=this.pathFromRoot(d);return f.length>1?f[f.length-2]:null}children(d){const f=us(d,this._root);return f?f.children.map(v=>v.value):[]}firstChild(d){const f=us(d,this._root);return f&&f.children.length>0?f.children[0].value:null}siblings(d){const f=hs(d,this._root);return f.length<2?[]:f[f.length-2].children.map(b=>b.value).filter(b=>b!==d)}pathFromRoot(d){return hs(d,this._root).map(f=>f.value)}}function us(u,d){if(u===d.value)return d;for(const f of d.children){const v=us(u,f);if(v)return v}return null}function hs(u,d){if(u===d.value)return[d];for(const f of d.children){const v=hs(u,f);if(v.length)return v.unshift(d),v}return[]}class ni{constructor(d,f){this.value=d,this.children=f}toString(){return`TreeNode(${this.value})`}}function Rs(u){const d={};return u&&u.children.forEach(f=>d[f.value.outlet]=f),d}class ks extends Ps{constructor(d,f){super(d),this.snapshot=f,Sa(this,d)}toString(){return this.snapshot.toString()}}function Ko(u,d){const f=function So(u,d){const S=new Ls([],{},{},"",{},xn,d,null,u.root,-1,{});return new Ka("",new ni(S,[]))}(u,d),v=new c.X([new Fe("",{})]),b=new c.X({}),C=new c.X({}),S=new c.X({}),z=new c.X(""),H=new ds(v,b,S,z,C,xn,d,f.root);return H.snapshot=f.root,new ks(new ni(H,[]),f)}class ds{constructor(d,f,v,b,C,S,z,H){this.url=d,this.params=f,this.queryParams=v,this.fragment=b,this.data=C,this.outlet=S,this.component=z,this.title=this.data?.pipe((0,$e.U)(ee=>ee[kr]))??(0,Ge.of)(void 0),this._futureSnapshot=H}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,$e.U)(d=>di(d)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,$e.U)(d=>di(d)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Es(u,d="emptyOnly"){const f=u.pathFromRoot;let v=0;if("always"!==d)for(v=f.length-1;v>=1;){const b=f[v],C=f[v-1];if(b.routeConfig&&""===b.routeConfig.path)v--;else{if(C.component)break;v--}}return function Mo(u){return u.reduce((d,f)=>({params:{...d.params,...f.params},data:{...d.data,...f.data},resolve:{...f.data,...d.resolve,...f.routeConfig?.data,...f._resolvedData}}),{params:{},data:{},resolve:{}})}(f.slice(v))}class Ls{get title(){return this.data?.[kr]}constructor(d,f,v,b,C,S,z,H,ee,re,ue){this.url=d,this.params=f,this.queryParams=v,this.fragment=b,this.data=C,this.outlet=S,this.component=z,this.routeConfig=H,this._urlSegment=ee,this._lastPathIndex=re,this._resolve=ue}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=di(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=di(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(v=>v.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Ka extends Ps{constructor(d,f){super(f),this.url=d,Sa(this,f)}toString(){return Na(this._root)}}function Sa(u,d){d.value._routerState=u,d.children.forEach(f=>Sa(u,f))}function Na(u){const d=u.children.length>0?` { ${u.children.map(Na).join(", ")} } `:"";return`${u.value}${d}`}function bo(u){if(u.snapshot){const d=u.snapshot,f=u._futureSnapshot;u.snapshot=f,br(d.queryParams,f.queryParams)||u.queryParams.next(f.queryParams),d.fragment!==f.fragment&&u.fragment.next(f.fragment),br(d.params,f.params)||u.params.next(f.params),function sr(u,d){if(u.length!==d.length)return!1;for(let f=0;f<u.length;++f)if(!br(u[f],d[f]))return!1;return!0}(d.url,f.url)||u.url.next(f.url),br(d.data,f.data)||u.data.next(f.data)}else u.snapshot=u._futureSnapshot,u.data.next(u._futureSnapshot.data)}function ca(u,d){const f=br(u.params,d.params)&&function Ne(u,d){return Rt(u,d)&&u.every((f,v)=>br(f.parameters,d[v].parameters))}(u.url,d.url);return f&&!(!u.parent!=!d.parent)&&(!u.parent||ca(u.parent,d.parent))}function jo(u,d,f){if(f&&u.shouldReuseRoute(d.value,f.value.snapshot)){const v=f.value;v._futureSnapshot=d.value;const b=function Ya(u,d,f){return d.children.map(v=>{for(const b of f.children)if(u.shouldReuseRoute(v.value,b.value.snapshot))return jo(u,v,b);return jo(u,v)})}(u,d,f);return new ni(v,b)}{if(u.shouldAttach(d.value)){const C=u.retrieve(d.value);if(null!==C){const S=C.route;return S.value._futureSnapshot=d.value,S.children=d.children.map(z=>jo(u,z)),S}}const v=function ua(u){return new ds(new c.X(u.url),new c.X(u.params),new c.X(u.queryParams),new c.X(u.fragment),new c.X(u.data),u.outlet,u.component,u)}(d.value),b=d.children.map(C=>jo(u,C));return new ni(v,b)}}const Yo="ngNavigationCancelingError";function Fs(u,d){const{redirectTo:f,navigationBehaviorOptions:v}=ki(d)?{redirectTo:d,navigationBehaviorOptions:void 0}:d,b=Zs(!1,0,d);return b.url=f,b.navigationBehaviorOptions=v,b}function Zs(u,d,f){const v=new Error("NavigationCancelingError: "+(u||""));return v[Yo]=!0,v.cancellationCode=d,f&&(v.url=f),v}function gr(u){return Vo(u)&&ki(u.url)}function Vo(u){return u&&u[Yo]}class Xs{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Io,this.attachRef=null}}let Io=(()=>{class u{constructor(){this.contexts=new Map}onChildOutletCreated(f,v){const b=this.getOrCreateContext(f);b.outlet=v,this.contexts.set(f,b)}onChildOutletDestroyed(f){const v=this.getContext(f);v&&(v.outlet=null,v.attachRef=null)}onOutletDeactivated(){const f=this.contexts;return this.contexts=new Map,f}onOutletReAttached(f){this.contexts=f}getOrCreateContext(f){let v=this.getContext(f);return v||(v=new Xs,this.contexts.set(f,v)),v}getContext(f){return this.contexts.get(f)||null}}return u.\u0275fac=function(f){return new(f||u)},u.\u0275prov=W.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})();const Jo=!1;let Vi=(()=>{class u{constructor(){this.activated=null,this._activatedRoute=null,this.name=xn,this.activateEvents=new W.vpe,this.deactivateEvents=new W.vpe,this.attachEvents=new W.vpe,this.detachEvents=new W.vpe,this.parentContexts=(0,W.f3M)(Io),this.location=(0,W.f3M)(W.s_b),this.changeDetector=(0,W.f3M)(W.sBO),this.environmentInjector=(0,W.f3M)(W.lqb)}ngOnChanges(f){if(f.name){const{firstChange:v,previousValue:b}=f.name;if(v)return;this.isTrackedInParentContexts(b)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(b)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(f){return this.parentContexts.getContext(f)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const f=this.parentContexts.getContext(this.name);f?.route&&(f.attachRef?this.attach(f.attachRef,f.route):this.activateWith(f.route,f.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new W.vHH(4012,Jo);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new W.vHH(4012,Jo);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new W.vHH(4012,Jo);this.location.detach();const f=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(f.instance),f}attach(f,v){this.activated=f,this._activatedRoute=v,this.location.insert(f.hostView),this.attachEvents.emit(f.instance)}deactivate(){if(this.activated){const f=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(f)}}activateWith(f,v){if(this.isActivated)throw new W.vHH(4013,Jo);this._activatedRoute=f;const b=this.location,S=f.snapshot.component,z=this.parentContexts.getOrCreateContext(this.name).children,H=new Qo(f,z,b.injector);if(v&&function zs(u){return!!u.resolveComponentFactory}(v)){const ee=v.resolveComponentFactory(S);this.activated=b.createComponent(ee,b.length,H)}else this.activated=b.createComponent(S,{index:b.length,injector:H,environmentInjector:v??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return u.\u0275fac=function(f){return new(f||u)},u.\u0275dir=W.lG2({type:u,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[W.TTD]}),u})();class Qo{constructor(d,f,v){this.route=d,this.childContexts=f,this.parent=v}get(d,f){return d===ds?this.route:d===Io?this.childContexts:this.parent.get(d,f)}}let Bs=(()=>{class u{}return u.\u0275fac=function(f){return new(f||u)},u.\u0275cmp=W.Xpm({type:u,selectors:[["ng-component"]],standalone:!0,features:[W.jDz],decls:1,vars:0,template:function(f,v){1&f&&W._UZ(0,"router-outlet")},dependencies:[Vi],encapsulation:2}),u})();function Ts(u,d){return u.providers&&!u._injector&&(u._injector=(0,W.MMx)(u.providers,d,`Route: ${u.path}`)),u._injector??d}function Qi(u){const d=u.children&&u.children.map(Qi),f=d?{...u,children:d}:{...u};return!f.component&&!f.loadComponent&&(d||f.loadChildren)&&f.outlet&&f.outlet!==xn&&(f.component=Bs),f}function $i(u){return u.outlet||xn}function da(u,d){const f=u.filter(v=>$i(v)===d);return f.push(...u.filter(v=>$i(v)!==d)),f}function $o(u){if(!u)return null;if(u.routeConfig?._injector)return u.routeConfig._injector;for(let d=u.parent;d;d=d.parent){const f=d.routeConfig;if(f?._loadedInjector)return f._loadedInjector;if(f?._injector)return f._injector}return null}class Ks{constructor(d,f,v,b){this.routeReuseStrategy=d,this.futureState=f,this.currState=v,this.forwardEvent=b}activate(d){const f=this.futureState._root,v=this.currState?this.currState._root:null;this.deactivateChildRoutes(f,v,d),bo(this.futureState.root),this.activateChildRoutes(f,v,d)}deactivateChildRoutes(d,f,v){const b=Rs(f);d.children.forEach(C=>{const S=C.value.outlet;this.deactivateRoutes(C,b[S],v),delete b[S]}),Lr(b,(C,S)=>{this.deactivateRouteAndItsChildren(C,v)})}deactivateRoutes(d,f,v){const b=d.value,C=f?f.value:null;if(b===C)if(b.component){const S=v.getContext(b.outlet);S&&this.deactivateChildRoutes(d,f,S.children)}else this.deactivateChildRoutes(d,f,v);else C&&this.deactivateRouteAndItsChildren(f,v)}deactivateRouteAndItsChildren(d,f){d.value.component&&this.routeReuseStrategy.shouldDetach(d.value.snapshot)?this.detachAndStoreRouteSubtree(d,f):this.deactivateRouteAndOutlet(d,f)}detachAndStoreRouteSubtree(d,f){const v=f.getContext(d.value.outlet),b=v&&d.value.component?v.children:f,C=Rs(d);for(const S of Object.keys(C))this.deactivateRouteAndItsChildren(C[S],b);if(v&&v.outlet){const S=v.outlet.detach(),z=v.children.onOutletDeactivated();this.routeReuseStrategy.store(d.value.snapshot,{componentRef:S,route:d,contexts:z})}}deactivateRouteAndOutlet(d,f){const v=f.getContext(d.value.outlet),b=v&&d.value.component?v.children:f,C=Rs(d);for(const S of Object.keys(C))this.deactivateRouteAndItsChildren(C[S],b);v&&(v.outlet&&(v.outlet.deactivate(),v.children.onOutletDeactivated()),v.attachRef=null,v.resolver=null,v.route=null)}activateChildRoutes(d,f,v){const b=Rs(f);d.children.forEach(C=>{this.activateRoutes(C,b[C.value.outlet],v),this.forwardEvent(new As(C.value.snapshot))}),d.children.length&&this.forwardEvent(new wi(d.value.snapshot))}activateRoutes(d,f,v){const b=d.value,C=f?f.value:null;if(bo(b),b===C)if(b.component){const S=v.getOrCreateContext(b.outlet);this.activateChildRoutes(d,f,S.children)}else this.activateChildRoutes(d,f,v);else if(b.component){const S=v.getOrCreateContext(b.outlet);if(this.routeReuseStrategy.shouldAttach(b.snapshot)){const z=this.routeReuseStrategy.retrieve(b.snapshot);this.routeReuseStrategy.store(b.snapshot,null),S.children.onOutletReAttached(z.contexts),S.attachRef=z.componentRef,S.route=z.route.value,S.outlet&&S.outlet.attach(z.componentRef,z.route.value),bo(z.route.value),this.activateChildRoutes(d,null,S.children)}else{const z=$o(b.snapshot),H=z?.get(W._Vd)??null;S.attachRef=null,S.route=b,S.resolver=H,S.injector=z,S.outlet&&S.outlet.activateWith(b,S.injector),this.activateChildRoutes(d,null,S.children)}}else this.activateChildRoutes(d,null,v)}}class Go{constructor(d){this.path=d,this.route=this.path[this.path.length-1]}}class ps{constructor(d,f){this.component=d,this.route=f}}function Ho(u,d,f){const v=u._root;return Tn(v,d?d._root:null,f,[v.value])}function ms(u,d){const f=Symbol(),v=d.get(u,f);return v===f?"function"!=typeof u||(0,W.Z0I)(u)?d.get(u):u:v}function Tn(u,d,f,v,b={canDeactivateChecks:[],canActivateChecks:[]}){const C=Rs(d);return u.children.forEach(S=>{(function fa(u,d,f,v,b={canDeactivateChecks:[],canActivateChecks:[]}){const C=u.value,S=d?d.value:null,z=f?f.getContext(u.value.outlet):null;if(S&&C.routeConfig===S.routeConfig){const H=function ja(u,d,f){if("function"==typeof f)return f(u,d);switch(f){case"pathParamsChange":return!Rt(u.url,d.url);case"pathParamsOrQueryParamsChange":return!Rt(u.url,d.url)||!br(u.queryParams,d.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!ca(u,d)||!br(u.queryParams,d.queryParams);default:return!ca(u,d)}}(S,C,C.routeConfig.runGuardsAndResolvers);H?b.canActivateChecks.push(new Go(v)):(C.data=S.data,C._resolvedData=S._resolvedData),Tn(u,d,C.component?z?z.children:null:f,v,b),H&&z&&z.outlet&&z.outlet.isActivated&&b.canDeactivateChecks.push(new ps(z.outlet.component,S))}else S&&pa(d,z,b),b.canActivateChecks.push(new Go(v)),Tn(u,null,C.component?z?z.children:null:f,v,b)})(S,C[S.value.outlet],f,v.concat([S.value]),b),delete C[S.value.outlet]}),Lr(C,(S,z)=>pa(S,f.getContext(z),b)),b}function pa(u,d,f){const v=Rs(u),b=u.value;Lr(v,(C,S)=>{pa(C,b.component?d?d.children.getContext(S):null:d,f)}),f.canDeactivateChecks.push(new ps(b.component&&d&&d.outlet&&d.outlet.isActivated?d.outlet.component:null,b))}function Ds(u){return"function"==typeof u}function mi(u){return u instanceof en||"EmptyError"===u?.name}const gs=Symbol("INITIAL_VALUE");function Xi(){return yt(u=>cn(u.map(d=>d.pipe(At(1),function Yt(...u){const d=(0,mt.yG)(u);return(0,ft.e)((f,v)=>{(d?sn(u,f,d):sn(u,f)).subscribe(v)})}(gs)))).pipe((0,$e.U)(d=>{for(const f of d)if(!0!==f){if(f===gs)return gs;if(!1===f||f instanceof Zi)return f}return!0}),(0,Dt.h)(d=>d!==gs),At(1)))}function j(u){return(0,Kt.z)((0,zn.b)(d=>{if(ki(d))throw Fs(0,d)}),(0,$e.U)(d=>!0===d))}const me={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Oe(u,d,f,v,b){const C=Be(u,d,f);return C.matched?function te(u,d,f,v){const b=d.canMatch;if(!b||0===b.length)return(0,Ge.of)(!0);const C=b.map(S=>{const z=ms(S,u);return Jr(function Sr(u){return u&&Ds(u.canMatch)}(z)?z.canMatch(d,f):u.runInContext(()=>z(d,f)))});return(0,Ge.of)(C).pipe(Xi(),j())}(v=Ts(d,v),d,f).pipe((0,$e.U)(S=>!0===S?C:{...me})):(0,Ge.of)(C)}function Be(u,d,f){if(""===d.path)return"full"===d.pathMatch&&(u.hasChildren()||f.length>0)?{...me}:{matched:!0,consumedSegments:[],remainingSegments:f,parameters:{},positionalParamSegments:{}};const b=(d.matcher||zo)(f,u,d);if(!b)return{...me};const C={};Lr(b.posParams,(z,H)=>{C[H]=z.path});const S=b.consumed.length>0?{...C,...b.consumed[b.consumed.length-1].parameters}:C;return{matched:!0,consumedSegments:b.consumed,remainingSegments:f.slice(b.consumed.length),parameters:S,positionalParamSegments:b.posParams??{}}}function tt(u,d,f,v){if(f.length>0&&function gn(u,d,f){return f.some(v=>ur(u,d,v)&&$i(v)!==xn)}(u,f,v)){const C=new Je(d,function on(u,d,f,v){const b={};b[xn]=v,v._sourceSegment=u,v._segmentIndexShift=d.length;for(const C of f)if(""===C.path&&$i(C)!==xn){const S=new Je([],{});S._sourceSegment=u,S._segmentIndexShift=d.length,b[$i(C)]=S}return b}(u,d,v,new Je(f,u.children)));return C._sourceSegment=u,C._segmentIndexShift=d.length,{segmentGroup:C,slicedSegments:[]}}if(0===f.length&&function pr(u,d,f){return f.some(v=>ur(u,d,v))}(u,f,v)){const C=new Je(u.segments,function vt(u,d,f,v,b){const C={};for(const S of v)if(ur(u,f,S)&&!b[$i(S)]){const z=new Je([],{});z._sourceSegment=u,z._segmentIndexShift=d.length,C[$i(S)]=z}return{...b,...C}}(u,d,f,v,u.children));return C._sourceSegment=u,C._segmentIndexShift=d.length,{segmentGroup:C,slicedSegments:f}}const b=new Je(u.segments,u.children);return b._sourceSegment=u,b._segmentIndexShift=d.length,{segmentGroup:b,slicedSegments:f}}function ur(u,d,f){return(!(u.hasChildren()||d.length>0)||"full"!==f.pathMatch)&&""===f.path}function jn(u,d,f,v){return!!($i(u)===v||v!==xn&&ur(d,f,u))&&("**"===u.path||Be(d,u,f).matched)}function Kn(u,d,f){return 0===d.length&&!u.children[f]}const mr=!1;class Tr{constructor(d){this.segmentGroup=d||null}}class gi{constructor(d){this.urlTree=d}}function si(u){return Me(new Tr(u))}function ai(u){return Me(new gi(u))}class to{constructor(d,f,v,b,C){this.injector=d,this.configLoader=f,this.urlSerializer=v,this.urlTree=b,this.config=C,this.allowRedirects=!0}apply(){const d=tt(this.urlTree.root,[],[],this.config).segmentGroup,f=new Je(d.segments,d.children);return this.expandSegmentGroup(this.injector,this.config,f,xn).pipe((0,$e.U)(C=>this.createUrlTree(Cr(C),this.urlTree.queryParams,this.urlTree.fragment))).pipe((0,cr.K)(C=>{if(C instanceof gi)return this.allowRedirects=!1,this.match(C.urlTree);throw C instanceof Tr?this.noMatchError(C):C}))}match(d){return this.expandSegmentGroup(this.injector,this.config,d.root,xn).pipe((0,$e.U)(b=>this.createUrlTree(Cr(b),d.queryParams,d.fragment))).pipe((0,cr.K)(b=>{throw b instanceof Tr?this.noMatchError(b):b}))}noMatchError(d){return new W.vHH(4002,mr)}createUrlTree(d,f,v){const b=zr(d);return new Zi(b,f,v)}expandSegmentGroup(d,f,v,b){return 0===v.segments.length&&v.hasChildren()?this.expandChildren(d,f,v).pipe((0,$e.U)(C=>new Je([],C))):this.expandSegment(d,v,f,v.segments,b,!0)}expandChildren(d,f,v){const b=[];for(const C of Object.keys(v.children))"primary"===C?b.unshift(C):b.push(C);return(0,ge.D)(b).pipe((0,Vn.b)(C=>{const S=v.children[C],z=da(f,C);return this.expandSegmentGroup(d,z,S,C).pipe((0,$e.U)(H=>({segment:H,outlet:C})))}),nn((C,S)=>(C[S.outlet]=S.segment,C),{}),Pr())}expandSegment(d,f,v,b,C,S){return(0,ge.D)(v).pipe((0,Vn.b)(z=>this.expandSegmentAgainstRoute(d,f,v,z,b,C,S).pipe((0,cr.K)(ee=>{if(ee instanceof Tr)return(0,Ge.of)(null);throw ee}))),er(z=>!!z),(0,cr.K)((z,H)=>{if(mi(z))return Kn(f,b,C)?(0,Ge.of)(new Je([],{})):si(f);throw z}))}expandSegmentAgainstRoute(d,f,v,b,C,S,z){return jn(b,f,C,S)?void 0===b.redirectTo?this.matchSegmentAgainstRoute(d,f,b,C,S):z&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(d,f,v,b,C,S):si(f):si(f)}expandSegmentAgainstRouteUsingRedirect(d,f,v,b,C,S){return"**"===b.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(d,v,b,S):this.expandRegularSegmentAgainstRouteUsingRedirect(d,f,v,b,C,S)}expandWildCardWithParamsAgainstRouteUsingRedirect(d,f,v,b){const C=this.applyRedirectCommands([],v.redirectTo,{});return v.redirectTo.startsWith("/")?ai(C):this.lineralizeSegments(v,C).pipe((0,an.z)(S=>{const z=new Je(S,{});return this.expandSegment(d,z,f,S,b,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(d,f,v,b,C,S){const{matched:z,consumedSegments:H,remainingSegments:ee,positionalParamSegments:re}=Be(f,b,C);if(!z)return si(f);const ue=this.applyRedirectCommands(H,b.redirectTo,re);return b.redirectTo.startsWith("/")?ai(ue):this.lineralizeSegments(b,ue).pipe((0,an.z)(fe=>this.expandSegment(d,f,v,fe.concat(ee),S,!1)))}matchSegmentAgainstRoute(d,f,v,b,C){return"**"===v.path?(d=Ts(v,d),v.loadChildren?(v._loadedRoutes?(0,Ge.of)({routes:v._loadedRoutes,injector:v._loadedInjector}):this.configLoader.loadChildren(d,v)).pipe((0,$e.U)(z=>(v._loadedRoutes=z.routes,v._loadedInjector=z.injector,new Je(b,{})))):(0,Ge.of)(new Je(b,{}))):Oe(f,v,b,d).pipe(yt(({matched:S,consumedSegments:z,remainingSegments:H})=>S?this.getChildConfig(d=v._injector??d,v,b).pipe((0,an.z)(re=>{const ue=re.injector??d,fe=re.routes,{segmentGroup:ne,slicedSegments:we}=tt(f,z,H,fe),xe=new Je(ne.segments,ne.children);if(0===we.length&&xe.hasChildren())return this.expandChildren(ue,fe,xe).pipe((0,$e.U)(ze=>new Je(z,ze)));if(0===fe.length&&0===we.length)return(0,Ge.of)(new Je(z,{}));const be=$i(v)===C;return this.expandSegment(ue,xe,fe,we,be?xn:C,!0).pipe((0,$e.U)(Ae=>new Je(z.concat(Ae.segments),Ae.children)))})):si(f)))}getChildConfig(d,f,v){return f.children?(0,Ge.of)({routes:f.children,injector:d}):f.loadChildren?void 0!==f._loadedRoutes?(0,Ge.of)({routes:f._loadedRoutes,injector:f._loadedInjector}):function R(u,d,f,v){const b=d.canLoad;if(void 0===b||0===b.length)return(0,Ge.of)(!0);const C=b.map(S=>{const z=ms(S,u);return Jr(function Po(u){return u&&Ds(u.canLoad)}(z)?z.canLoad(d,f):u.runInContext(()=>z(d,f)))});return(0,Ge.of)(C).pipe(Xi(),j())}(d,f,v).pipe((0,an.z)(b=>b?this.configLoader.loadChildren(d,f).pipe((0,zn.b)(C=>{f._loadedRoutes=C.routes,f._loadedInjector=C.injector})):function eo(u){return Me(Zs(mr,3))}())):(0,Ge.of)({routes:[],injector:d})}lineralizeSegments(d,f){let v=[],b=f.root;for(;;){if(v=v.concat(b.segments),0===b.numberOfChildren)return(0,Ge.of)(v);if(b.numberOfChildren>1||!b.children[xn])return d.redirectTo,Me(new W.vHH(4e3,mr));b=b.children[xn]}}applyRedirectCommands(d,f,v){return this.applyRedirectCreateUrlTree(f,this.urlSerializer.parse(f),d,v)}applyRedirectCreateUrlTree(d,f,v,b){const C=this.createSegmentGroup(d,f.root,v,b);return new Zi(C,this.createQueryParams(f.queryParams,this.urlTree.queryParams),f.fragment)}createQueryParams(d,f){const v={};return Lr(d,(b,C)=>{if("string"==typeof b&&b.startsWith(":")){const z=b.substring(1);v[C]=f[z]}else v[C]=b}),v}createSegmentGroup(d,f,v,b){const C=this.createSegments(d,f.segments,v,b);let S={};return Lr(f.children,(z,H)=>{S[H]=this.createSegmentGroup(d,z,v,b)}),new Je(C,S)}createSegments(d,f,v,b){return f.map(C=>C.path.startsWith(":")?this.findPosParam(d,C,b):this.findOrReturn(C,v))}findPosParam(d,f,v){const b=v[f.path.substring(1)];if(!b)throw new W.vHH(4001,mr);return b}findOrReturn(d,f){let v=0;for(const b of f){if(b.path===d.path)return f.splice(v),b;v++}return d}}class K{}class Se{constructor(d,f,v,b,C,S,z){this.injector=d,this.rootComponentType=f,this.config=v,this.urlTree=b,this.url=C,this.paramsInheritanceStrategy=S,this.urlSerializer=z}recognize(){const d=tt(this.urlTree.root,[],[],this.config.filter(f=>void 0===f.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,d,xn).pipe((0,$e.U)(f=>{if(null===f)return null;const v=new Ls([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},xn,this.rootComponentType,null,this.urlTree.root,-1,{}),b=new ni(v,f),C=new Ka(this.url,b);return this.inheritParamsAndData(C._root),C}))}inheritParamsAndData(d){const f=d.value,v=Es(f,this.paramsInheritanceStrategy);f.params=Object.freeze(v.params),f.data=Object.freeze(v.data),d.children.forEach(b=>this.inheritParamsAndData(b))}processSegmentGroup(d,f,v,b){return 0===v.segments.length&&v.hasChildren()?this.processChildren(d,f,v):this.processSegment(d,f,v,v.segments,b)}processChildren(d,f,v){return(0,ge.D)(Object.keys(v.children)).pipe((0,Vn.b)(b=>{const C=v.children[b],S=da(f,b);return this.processSegmentGroup(d,S,C,b)}),nn((b,C)=>b&&C?(b.push(...C),b):null),function Zo(u,d=!1){return(0,ft.e)((f,v)=>{let b=0;f.subscribe((0,Pn.x)(v,C=>{const S=u(C,b++);(S||d)&&v.next(C),!S&&v.complete()}))})}(b=>null!==b),hr(null),Pr(),(0,$e.U)(b=>{if(null===b)return null;const C=pe(b);return function A(u){u.sort((d,f)=>d.value.outlet===xn?-1:f.value.outlet===xn?1:d.value.outlet.localeCompare(f.value.outlet))}(C),C}))}processSegment(d,f,v,b,C){return(0,ge.D)(f).pipe((0,Vn.b)(S=>this.processSegmentAgainstRoute(S._injector??d,S,v,b,C)),er(S=>!!S),(0,cr.K)(S=>{if(mi(S))return Kn(v,b,C)?(0,Ge.of)([]):(0,Ge.of)(null);throw S}))}processSegmentAgainstRoute(d,f,v,b,C){if(f.redirectTo||!jn(f,v,b,C))return(0,Ge.of)(null);let S;if("**"===f.path){const z=b.length>0?un(b).parameters:{},H=_n(v)+b.length,ee=new Ls(b,z,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Bn(f),$i(f),f.component??f._loadedComponent??null,f,Ot(v),H,_t(f));S=(0,Ge.of)({snapshot:ee,consumedSegments:[],remainingSegments:[]})}else S=Oe(v,f,b,d).pipe((0,$e.U)(({matched:z,consumedSegments:H,remainingSegments:ee,parameters:re})=>{if(!z)return null;const ue=_n(v)+H.length;return{snapshot:new Ls(H,re,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Bn(f),$i(f),f.component??f._loadedComponent??null,f,Ot(v),ue,_t(f)),consumedSegments:H,remainingSegments:ee}}));return S.pipe(yt(z=>{if(null===z)return(0,Ge.of)(null);const{snapshot:H,consumedSegments:ee,remainingSegments:re}=z;d=f._injector??d;const ue=f._loadedInjector??d,fe=function P(u){return u.children?u.children:u.loadChildren?u._loadedRoutes:[]}(f),{segmentGroup:ne,slicedSegments:we}=tt(v,ee,re,fe.filter(be=>void 0===be.redirectTo));if(0===we.length&&ne.hasChildren())return this.processChildren(ue,fe,ne).pipe((0,$e.U)(be=>null===be?null:[new ni(H,be)]));if(0===fe.length&&0===we.length)return(0,Ge.of)([new ni(H,[])]);const xe=$i(f)===C;return this.processSegment(ue,fe,ne,we,xe?xn:C).pipe((0,$e.U)(be=>null===be?null:[new ni(H,be)]))}))}}function $(u){const d=u.value.routeConfig;return d&&""===d.path&&void 0===d.redirectTo}function pe(u){const d=[],f=new Set;for(const v of u){if(!$(v)){d.push(v);continue}const b=d.find(C=>v.value.routeConfig===C.value.routeConfig);void 0!==b?(b.children.push(...v.children),f.add(b)):d.push(v)}for(const v of f){const b=pe(v.children);d.push(new ni(v.value,b))}return d.filter(v=>!f.has(v))}function Ot(u){let d=u;for(;d._sourceSegment;)d=d._sourceSegment;return d}function _n(u){let d=u,f=d._segmentIndexShift??0;for(;d._sourceSegment;)d=d._sourceSegment,f+=d._segmentIndexShift??0;return f-1}function Bn(u){return u.data||{}}function _t(u){return u.resolve||{}}function _a(u){return"string"==typeof u.title||null===u.title}function dl(u){return yt(d=>{const f=u(d);return f?(0,ge.D)(f).pipe((0,$e.U)(()=>d)):(0,Ge.of)(d)})}const ya=new W.OlP("ROUTES");let va=(()=>{class u{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=(0,W.f3M)(W.Sil)}loadComponent(f){if(this.componentLoaders.get(f))return this.componentLoaders.get(f);if(f._loadedComponent)return(0,Ge.of)(f._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(f);const v=Jr(f.loadComponent()).pipe((0,$e.U)(Rl),(0,zn.b)(C=>{this.onLoadEndListener&&this.onLoadEndListener(f),f._loadedComponent=C}),Yr(()=>{this.componentLoaders.delete(f)})),b=new vn(v,()=>new dn.x).pipe(fn());return this.componentLoaders.set(f,b),b}loadChildren(f,v){if(this.childrenLoaders.get(v))return this.childrenLoaders.get(v);if(v._loadedRoutes)return(0,Ge.of)({routes:v._loadedRoutes,injector:v._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(v);const C=this.loadModuleFactoryOrRoutes(v.loadChildren).pipe((0,$e.U)(z=>{this.onLoadEndListener&&this.onLoadEndListener(v);let H,ee,re=!1;Array.isArray(z)?ee=z:(H=z.create(f).injector,ee=Er(H.get(ya,[],W.XFs.Self|W.XFs.Optional)));return{routes:ee.map(Qi),injector:H}}),Yr(()=>{this.childrenLoaders.delete(v)})),S=new vn(C,()=>new dn.x).pipe(fn());return this.childrenLoaders.set(v,S),S}loadModuleFactoryOrRoutes(f){return Jr(f()).pipe((0,$e.U)(Rl),(0,an.z)(v=>v instanceof W.YKP||Array.isArray(v)?(0,Ge.of)(v):(0,ge.D)(this.compiler.compileModuleAsync(v))))}}return u.\u0275fac=function(f){return new(f||u)},u.\u0275prov=W.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})();function Rl(u){return function Eo(u){return u&&"object"==typeof u&&"default"in u}(u)?u.default:u}let sc=(()=>{class u{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new dn.x,this.configLoader=(0,W.f3M)(va),this.environmentInjector=(0,W.f3M)(W.lqb),this.urlSerializer=(0,W.f3M)(On),this.rootContexts=(0,W.f3M)(Io),this.navigationId=0,this.afterPreactivation=()=>(0,Ge.of)(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=b=>this.events.next(new Zr(b)),this.configLoader.onLoadStartListener=b=>this.events.next(new co(b))}complete(){this.transitions?.complete()}handleNavigationRequest(f){const v=++this.navigationId;this.transitions?.next({...this.transitions.value,...f,id:v})}setupNavigations(f){return this.transitions=new c.X({id:0,targetPageId:0,currentUrlTree:f.currentUrlTree,currentRawUrl:f.currentUrlTree,extractedUrl:f.urlHandlingStrategy.extract(f.currentUrlTree),urlAfterRedirects:f.urlHandlingStrategy.extract(f.currentUrlTree),rawUrl:f.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:io,restoredState:null,currentSnapshot:f.routerState.snapshot,targetSnapshot:null,currentRouterState:f.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe((0,Dt.h)(v=>0!==v.id),(0,$e.U)(v=>({...v,extractedUrl:f.urlHandlingStrategy.extract(v.rawUrl)})),yt(v=>{let b=!1,C=!1;return(0,Ge.of)(v).pipe((0,zn.b)(S=>{this.currentNavigation={id:S.id,initialUrl:S.rawUrl,extractedUrl:S.extractedUrl,trigger:S.source,extras:S.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),yt(S=>{const z=f.browserUrlTree.toString(),H=!f.navigated||S.extractedUrl.toString()!==z||z!==f.currentUrlTree.toString();if(!H&&"reload"!==(S.extras.onSameUrlNavigation??f.onSameUrlNavigation)){const re="";return this.events.next(new Fi(S.id,f.serializeUrl(v.rawUrl),re,0)),f.rawUrlTree=S.rawUrl,S.resolve(null),Wt.E}if(f.urlHandlingStrategy.shouldProcessUrl(S.rawUrl))return tl(S.source)&&(f.browserUrlTree=S.extractedUrl),(0,Ge.of)(S).pipe(yt(re=>{const ue=this.transitions?.getValue();return this.events.next(new rr(re.id,this.urlSerializer.serialize(re.extractedUrl),re.source,re.restoredState)),ue!==this.transitions?.getValue()?Wt.E:Promise.resolve(re)}),function Gr(u,d,f,v){return yt(b=>function Cn(u,d,f,v,b){return new to(u,d,f,v,b).apply()}(u,d,f,b.extractedUrl,v).pipe((0,$e.U)(C=>({...b,urlAfterRedirects:C}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,f.config),(0,zn.b)(re=>{this.currentNavigation={...this.currentNavigation,finalUrl:re.urlAfterRedirects},v.urlAfterRedirects=re.urlAfterRedirects}),function zi(u,d,f,v,b){return(0,an.z)(C=>function ae(u,d,f,v,b,C,S="emptyOnly"){return new Se(u,d,f,v,b,S,C).recognize().pipe(yt(z=>null===z?function U(u){return new qt.y(d=>d.error(u))}(new K):(0,Ge.of)(z)))}(u,d,f,C.urlAfterRedirects,v.serialize(C.urlAfterRedirects),v,b).pipe((0,$e.U)(S=>({...C,targetSnapshot:S}))))}(this.environmentInjector,this.rootComponentType,f.config,this.urlSerializer,f.paramsInheritanceStrategy),(0,zn.b)(re=>{if(v.targetSnapshot=re.targetSnapshot,"eager"===f.urlUpdateStrategy){if(!re.extras.skipLocationChange){const fe=f.urlHandlingStrategy.merge(re.urlAfterRedirects,re.rawUrl);f.setBrowserUrl(fe,re)}f.browserUrlTree=re.urlAfterRedirects}const ue=new Vr(re.id,this.urlSerializer.serialize(re.extractedUrl),this.urlSerializer.serialize(re.urlAfterRedirects),re.targetSnapshot);this.events.next(ue)}));if(H&&f.urlHandlingStrategy.shouldProcessUrl(f.rawUrlTree)){const{id:re,extractedUrl:ue,source:fe,restoredState:ne,extras:we}=S,xe=new rr(re,this.urlSerializer.serialize(ue),fe,ne);this.events.next(xe);const be=Ko(ue,this.rootComponentType).snapshot;return v={...S,targetSnapshot:be,urlAfterRedirects:ue,extras:{...we,skipLocationChange:!1,replaceUrl:!1}},(0,Ge.of)(v)}{const re="";return this.events.next(new Fi(S.id,f.serializeUrl(v.extractedUrl),re,1)),f.rawUrlTree=S.rawUrl,S.resolve(null),Wt.E}}),(0,zn.b)(S=>{const z=new Hr(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot);this.events.next(z)}),(0,$e.U)(S=>v={...S,guards:Ho(S.targetSnapshot,S.currentSnapshot,this.rootContexts)}),function Ro(u,d){return(0,an.z)(f=>{const{targetSnapshot:v,currentSnapshot:b,guards:{canActivateChecks:C,canDeactivateChecks:S}}=f;return 0===S.length&&0===C.length?(0,Ge.of)({...f,guardsResult:!0}):function ma(u,d,f,v){return(0,ge.D)(u).pipe((0,an.z)(b=>function I(u,d,f,v,b){const C=d&&d.routeConfig?d.routeConfig.canDeactivate:null;if(!C||0===C.length)return(0,Ge.of)(!0);const S=C.map(z=>{const H=$o(d)??b,ee=ms(z,H);return Jr(function Ft(u){return u&&Ds(u.canDeactivate)}(ee)?ee.canDeactivate(u,d,f,v):H.runInContext(()=>ee(u,d,f,v))).pipe(er())});return(0,Ge.of)(S).pipe(Xi())}(b.component,b.route,f,d,v)),er(b=>!0!==b,!0))}(S,v,b,u).pipe((0,an.z)(z=>z&&function Va(u){return"boolean"==typeof u}(z)?function ga(u,d,f,v){return(0,ge.D)(d).pipe((0,Vn.b)(b=>sn(function oc(u,d){return null!==u&&d&&d(new Xa(u)),(0,Ge.of)(!0)}(b.route.parent,v),function Ys(u,d){return null!==u&&d&&d(new Ws(u)),(0,Ge.of)(!0)}(b.route,v),function Q(u,d,f){const v=d[d.length-1],C=d.slice(0,d.length-1).reverse().map(S=>function Ua(u){const d=u.routeConfig?u.routeConfig.canActivateChild:null;return d&&0!==d.length?{node:u,guards:d}:null}(S)).filter(S=>null!==S).map(S=>je(()=>{const z=S.guards.map(H=>{const ee=$o(S.node)??f,re=ms(H,ee);return Jr(function Qa(u){return u&&Ds(u.canActivateChild)}(re)?re.canActivateChild(v,u):ee.runInContext(()=>re(v,u))).pipe(er())});return(0,Ge.of)(z).pipe(Xi())}));return(0,Ge.of)(C).pipe(Xi())}(u,b.path,f),function Us(u,d,f){const v=d.routeConfig?d.routeConfig.canActivate:null;if(!v||0===v.length)return(0,Ge.of)(!0);const b=v.map(C=>je(()=>{const S=$o(d)??f,z=ms(C,S);return Jr(function Ia(u){return u&&Ds(u.canActivate)}(z)?z.canActivate(d,u):S.runInContext(()=>z(d,u))).pipe(er())}));return(0,Ge.of)(b).pipe(Xi())}(u,b.route,f))),er(b=>!0!==b,!0))}(v,C,u,d):(0,Ge.of)(z)),(0,$e.U)(z=>({...f,guardsResult:z})))})}(this.environmentInjector,S=>this.events.next(S)),(0,zn.b)(S=>{if(v.guardsResult=S.guardsResult,ki(S.guardsResult))throw Fs(0,S.guardsResult);const z=new cs(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(S.urlAfterRedirects),S.targetSnapshot,!!S.guardsResult);this.events.next(z)}),(0,Dt.h)(S=>!!S.guardsResult||(f.restoreHistory(S),this.cancelNavigationTransition(S,"",3),!1)),dl(S=>{if(S.guards.canActivateChecks.length)return(0,Ge.of)(S).pipe((0,zn.b)(z=>{const H=new Ti(z.id,this.urlSerializer.serialize(z.extractedUrl),this.urlSerializer.serialize(z.urlAfterRedirects),z.targetSnapshot);this.events.next(H)}),yt(z=>{let H=!1;return(0,Ge.of)(z).pipe(function qo(u,d){return(0,an.z)(f=>{const{targetSnapshot:v,guards:{canActivateChecks:b}}=f;if(!b.length)return(0,Ge.of)(f);let C=0;return(0,ge.D)(b).pipe((0,Vn.b)(S=>function Ci(u,d,f,v){const b=u.routeConfig,C=u._resolve;return void 0!==b?.title&&!_a(b)&&(C[kr]=b.title),function ao(u,d,f,v){const b=function Ki(u){return[...Object.keys(u),...Object.getOwnPropertySymbols(u)]}(u);if(0===b.length)return(0,Ge.of)({});const C={};return(0,ge.D)(b).pipe((0,an.z)(S=>function Pa(u,d,f,v){const b=$o(d)??v,C=ms(u,b);return Jr(C.resolve?C.resolve(d,f):b.runInContext(()=>C(d,f)))}(u[S],d,f,v).pipe(er(),(0,zn.b)(z=>{C[S]=z}))),Kr(1),function Rr(u){return(0,$e.U)(()=>u)}(C),(0,cr.K)(S=>mi(S)?Wt.E:Me(S)))}(C,u,d,v).pipe((0,$e.U)(S=>(u._resolvedData=S,u.data=Es(u,f).resolve,b&&_a(b)&&(u.data[kr]=b.title),null)))}(S.route,v,u,d)),(0,zn.b)(()=>C++),Kr(1),(0,an.z)(S=>C===b.length?(0,Ge.of)(f):Wt.E))})}(f.paramsInheritanceStrategy,this.environmentInjector),(0,zn.b)({next:()=>H=!0,complete:()=>{H||(f.restoreHistory(z),this.cancelNavigationTransition(z,"",2))}}))}),(0,zn.b)(z=>{const H=new ji(z.id,this.urlSerializer.serialize(z.extractedUrl),this.urlSerializer.serialize(z.urlAfterRedirects),z.targetSnapshot);this.events.next(H)}))}),dl(S=>{const z=H=>{const ee=[];H.routeConfig?.loadComponent&&!H.routeConfig._loadedComponent&&ee.push(this.configLoader.loadComponent(H.routeConfig).pipe((0,zn.b)(re=>{H.component=re}),(0,$e.U)(()=>{})));for(const re of H.children)ee.push(...z(re));return ee};return cn(z(S.targetSnapshot.root)).pipe(hr(),At(1))}),dl(()=>this.afterPreactivation()),(0,$e.U)(S=>{const z=function Os(u,d,f){const v=jo(u,d._root,f?f._root:void 0);return new ks(v,d)}(f.routeReuseStrategy,S.targetSnapshot,S.currentRouterState);return v={...S,targetRouterState:z}}),(0,zn.b)(S=>{f.currentUrlTree=S.urlAfterRedirects,f.rawUrlTree=f.urlHandlingStrategy.merge(S.urlAfterRedirects,S.rawUrl),f.routerState=S.targetRouterState,"deferred"===f.urlUpdateStrategy&&(S.extras.skipLocationChange||f.setBrowserUrl(f.rawUrlTree,S),f.browserUrlTree=S.urlAfterRedirects)}),((u,d,f)=>(0,$e.U)(v=>(new Ks(d,v.targetRouterState,v.currentRouterState,f).activate(u),v)))(this.rootContexts,f.routeReuseStrategy,S=>this.events.next(S)),(0,zn.b)({next:S=>{b=!0,this.lastSuccessfulNavigation=this.currentNavigation,f.navigated=!0,this.events.next(new mo(S.id,this.urlSerializer.serialize(S.extractedUrl),this.urlSerializer.serialize(f.currentUrlTree))),f.titleStrategy?.updateTitle(S.targetRouterState.snapshot),S.resolve(!0)},complete:()=>{b=!0}}),Yr(()=>{b||C||this.cancelNavigationTransition(v,"",1),this.currentNavigation?.id===v.id&&(this.currentNavigation=null)}),(0,cr.K)(S=>{if(C=!0,Vo(S)){gr(S)||(f.navigated=!0,f.restoreHistory(v,!0));const z=new lo(v.id,this.urlSerializer.serialize(v.extractedUrl),S.message,S.cancellationCode);if(this.events.next(z),gr(S)){const H=f.urlHandlingStrategy.merge(S.url,f.rawUrlTree),ee={skipLocationChange:v.extras.skipLocationChange,replaceUrl:"eager"===f.urlUpdateStrategy||tl(v.source)};f.scheduleNavigation(H,io,null,ee,{resolve:v.resolve,reject:v.reject,promise:v.promise})}else v.resolve(!1)}else{f.restoreHistory(v,!0);const z=new wo(v.id,this.urlSerializer.serialize(v.extractedUrl),S,v.targetSnapshot??void 0);this.events.next(z);try{v.resolve(f.errorHandler(S))}catch(H){v.reject(H)}}return Wt.E}))}))}cancelNavigationTransition(f,v,b){const C=new lo(f.id,this.urlSerializer.serialize(f.extractedUrl),v,b);this.events.next(C),f.resolve(!1)}}return u.\u0275fac=function(f){return new(f||u)},u.\u0275prov=W.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})();function tl(u){return u!==io}let kl=(()=>{class u{buildTitle(f){let v,b=f.root;for(;void 0!==b;)v=this.getResolvedTitleForRoute(b)??v,b=b.children.find(C=>C.outlet===xn);return v}getResolvedTitleForRoute(f){return f.data[kr]}}return u.\u0275fac=function(f){return new(f||u)},u.\u0275prov=W.Yz7({token:u,factory:function(){return(0,W.f3M)(pl)},providedIn:"root"}),u})(),pl=(()=>{class u extends kl{constructor(f){super(),this.title=f}updateTitle(f){const v=this.buildTitle(f);void 0!==v&&this.title.setTitle(v)}}return u.\u0275fac=function(f){return new(f||u)(W.LFG(vi.Dx))},u.\u0275prov=W.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})(),ih=(()=>{class u{}return u.\u0275fac=function(f){return new(f||u)},u.\u0275prov=W.Yz7({token:u,factory:function(){return(0,W.f3M)(Tc)},providedIn:"root"}),u})();class ml{shouldDetach(d){return!1}store(d,f){}shouldAttach(d){return!1}retrieve(d){return null}shouldReuseRoute(d,f){return d.routeConfig===f.routeConfig}}let Tc=(()=>{class u extends ml{}return u.\u0275fac=function(){let d;return function(v){return(d||(d=W.n5z(u)))(v||u)}}(),u.\u0275prov=W.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})();const es=new W.OlP("",{providedIn:"root",factory:()=>({})});let Tu=(()=>{class u{}return u.\u0275fac=function(f){return new(f||u)},u.\u0275prov=W.Yz7({token:u,factory:function(){return(0,W.f3M)(Ll)},providedIn:"root"}),u})(),Ll=(()=>{class u{shouldProcessUrl(f){return!0}extract(f){return f}merge(f,v){return f}}return u.\u0275fac=function(f){return new(f||u)},u.\u0275prov=W.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})();function _l(u){throw u}function Ol(u,d,f){return d.parse("/")}const yl={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},Du={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let ts=(()=>{class u{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=(0,W.f3M)(W.c2e),this.isNgZoneEnabled=!1,this.options=(0,W.f3M)(es,{optional:!0})||{},this.errorHandler=this.options.errorHandler||_l,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||Ol,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=(0,W.f3M)(Tu),this.routeReuseStrategy=(0,W.f3M)(ih),this.urlCreationStrategy=(0,W.f3M)(uo),this.titleStrategy=(0,W.f3M)(kl),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=Er((0,W.f3M)(ya,{optional:!0})??[]),this.navigationTransitions=(0,W.f3M)(sc),this.urlSerializer=(0,W.f3M)(On),this.location=(0,W.f3M)(ot.Ye),this.isNgZoneEnabled=(0,W.f3M)(W.R0b)instanceof W.R0b&&W.R0b.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new Zi,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=Ko(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe(f=>{this.lastSuccessfulId=f.id,this.currentPageId=f.targetPageId},f=>{this.console.warn(`Unhandled Navigation Error: ${f}`)})}resetRootComponentType(f){this.routerState.root.component=f,this.navigationTransitions.rootComponentType=f}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const f=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),io,f)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(f=>{const v="popstate"===f.type?"popstate":"hashchange";"popstate"===v&&setTimeout(()=>{this.navigateToSyncWithBrowser(f.url,v,f.state)},0)}))}navigateToSyncWithBrowser(f,v,b){const C={replaceUrl:!0},S=b?.navigationId?b:null;if(b){const H={...b};delete H.navigationId,delete H.\u0275routerPageId,0!==Object.keys(H).length&&(C.state=H)}const z=this.parseUrl(f);this.scheduleNavigation(z,v,S,C)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(f){this.config=f.map(Qi),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(f,v={}){const{relativeTo:b,queryParams:C,fragment:S,queryParamsHandling:z,preserveFragment:H}=v,ee=H?this.currentUrlTree.fragment:S;let re=null;switch(z){case"merge":re={...this.currentUrlTree.queryParams,...C};break;case"preserve":re=this.currentUrlTree.queryParams;break;default:re=C||null}return null!==re&&(re=this.removeEmptyProps(re)),this.urlCreationStrategy.createUrlTree(b,this.routerState,this.currentUrlTree,f,re,ee??null)}navigateByUrl(f,v={skipLocationChange:!1}){const b=ki(f)?f:this.parseUrl(f),C=this.urlHandlingStrategy.merge(b,this.rawUrlTree);return this.scheduleNavigation(C,io,null,v)}navigate(f,v={skipLocationChange:!1}){return function Dc(u){for(let d=0;d<u.length;d++){const f=u[d];if(null==f)throw new W.vHH(4008,false)}}(f),this.navigateByUrl(this.createUrlTree(f,v),v)}serializeUrl(f){return this.urlSerializer.serialize(f)}parseUrl(f){let v;try{v=this.urlSerializer.parse(f)}catch(b){v=this.malformedUriErrorHandler(b,this.urlSerializer,f)}return v}isActive(f,v){let b;if(b=!0===v?{...yl}:!1===v?{...Du}:v,ki(f))return $r(this.currentUrlTree,f,b);const C=this.parseUrl(f);return $r(this.currentUrlTree,C,b)}removeEmptyProps(f){return Object.keys(f).reduce((v,b)=>{const C=f[b];return null!=C&&(v[b]=C),v},{})}scheduleNavigation(f,v,b,C,S){if(this.disposed)return Promise.resolve(!1);let z,H,ee,re;return S?(z=S.resolve,H=S.reject,ee=S.promise):ee=new Promise((ue,fe)=>{z=ue,H=fe}),re="computed"===this.canceledNavigationResolution?b&&b.\u0275routerPageId?b.\u0275routerPageId:C.replaceUrl||C.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1:0,this.navigationTransitions.handleNavigationRequest({targetPageId:re,source:v,restoredState:b,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:f,extras:C,resolve:z,reject:H,promise:ee,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),ee.catch(ue=>Promise.reject(ue))}setBrowserUrl(f,v){const b=this.urlSerializer.serialize(f),C={...v.extras.state,...this.generateNgRouterState(v.id,v.targetPageId)};this.location.isCurrentPathEqualTo(b)||v.extras.replaceUrl?this.location.replaceState(b,"",C):this.location.go(b,"",C)}restoreHistory(f,v=!1){if("computed"===this.canceledNavigationResolution){const b=this.currentPageId-f.targetPageId;"popstate"!==f.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.getCurrentNavigation()?.finalUrl||0===b?this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===b&&(this.resetState(f),this.browserUrlTree=f.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(b)}else"replace"===this.canceledNavigationResolution&&(v&&this.resetState(f),this.resetUrlToCurrentUrlTree())}resetState(f){this.routerState=f.currentRouterState,this.currentUrlTree=f.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,f.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(f,v){return"computed"===this.canceledNavigationResolution?{navigationId:f,\u0275routerPageId:v}:{navigationId:f}}}return u.\u0275fac=function(f){return new(f||u)},u.\u0275prov=W.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})(),Fl=(()=>{class u{constructor(f,v,b,C,S,z){this.router=f,this.route=v,this.tabIndexAttribute=b,this.renderer=C,this.el=S,this.locationStrategy=z,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.href=null,this.commands=null,this.onChanges=new dn.x;const H=S.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===H||"area"===H,this.isAnchorElement?this.subscription=f.events.subscribe(ee=>{ee instanceof mo&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(f){this._preserveFragment=(0,W.D6c)(f)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(f){this._skipLocationChange=(0,W.D6c)(f)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(f){this._replaceUrl=(0,W.D6c)(f)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(f){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",f)}ngOnChanges(f){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(f){null!=f?(this.commands=Array.isArray(f)?f:[f],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(f,v,b,C,S){return!!(null===this.urlTree||this.isAnchorElement&&(0!==f||v||b||C||S||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const f=null===this.href?null:(0,W.P3R)(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",f)}applyAttributeValue(f,v){const b=this.renderer,C=this.el.nativeElement;null!==v?b.setAttribute(C,f,v):b.removeAttribute(C,f)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return u.\u0275fac=function(f){return new(f||u)(W.Y36(ts),W.Y36(ds),W.$8M("tabindex"),W.Y36(W.Qsj),W.Y36(W.SBq),W.Y36(ot.S$))},u.\u0275dir=W.lG2({type:u,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(f,v){1&f&&W.NdJ("click",function(C){return v.onClick(C.button,C.ctrlKey,C.shiftKey,C.altKey,C.metaKey)}),2&f&&W.uIk("target",v.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[W.TTD]}),u})();class lc{}let Gc=(()=>{class u{constructor(f,v,b,C,S){this.router=f,this.injector=b,this.preloadingStrategy=C,this.loader=S}setUpPreloading(){this.subscription=this.router.events.pipe((0,Dt.h)(f=>f instanceof mo),(0,Vn.b)(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(f,v){const b=[];for(const C of v){C.providers&&!C._injector&&(C._injector=(0,W.MMx)(C.providers,f,`Route: ${C.path}`));const S=C._injector??f,z=C._loadedInjector??S;(C.loadChildren&&!C._loadedRoutes&&void 0===C.canLoad||C.loadComponent&&!C._loadedComponent)&&b.push(this.preloadConfig(S,C)),(C.children||C._loadedRoutes)&&b.push(this.processRoutes(z,C.children??C._loadedRoutes))}return(0,ge.D)(b).pipe((0,dt.J)())}preloadConfig(f,v){return this.preloadingStrategy.preload(v,()=>{let b;b=v.loadChildren&&void 0===v.canLoad?this.loader.loadChildren(f,v):(0,Ge.of)(null);const C=b.pipe((0,an.z)(S=>null===S?(0,Ge.of)(void 0):(v._loadedRoutes=S.routes,v._loadedInjector=S.injector,this.processRoutes(S.injector??f,S.routes))));if(v.loadComponent&&!v._loadedComponent){const S=this.loader.loadComponent(v);return(0,ge.D)([C,S]).pipe((0,dt.J)())}return C})}}return u.\u0275fac=function(f){return new(f||u)(W.LFG(ts),W.LFG(W.Sil),W.LFG(W.lqb),W.LFG(lc),W.LFG(va))},u.\u0275prov=W.Yz7({token:u,factory:u.\u0275fac,providedIn:"root"}),u})();const Js=new W.OlP("");let nl=(()=>{class u{constructor(f,v,b,C,S={}){this.urlSerializer=f,this.transitions=v,this.viewportScroller=b,this.zone=C,this.options=S,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},S.scrollPositionRestoration=S.scrollPositionRestoration||"disabled",S.anchorScrolling=S.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(f=>{f instanceof rr?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=f.navigationTrigger,this.restoredId=f.restoredState?f.restoredState.navigationId:0):f instanceof mo&&(this.lastId=f.id,this.scheduleScrollEvent(f,this.urlSerializer.parse(f.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(f=>{f instanceof Uo&&(f.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(f.position):f.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(f.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(f,v){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new Uo(f,"popstate"===this.lastSource?this.store[this.restoredId]:null,v))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return u.\u0275fac=function(f){W.$Z()},u.\u0275prov=W.Yz7({token:u,factory:u.\u0275fac}),u})();var ko=(()=>((ko=ko||{})[ko.COMPLETE=0]="COMPLETE",ko[ko.FAILED=1]="FAILED",ko[ko.REDIRECTING=2]="REDIRECTING",ko))();const wa=!1;function Cs(u,d){return{\u0275kind:u,\u0275providers:d}}const Qs=new W.OlP("",{providedIn:"root",factory:()=>!1});function zl(){const u=(0,W.f3M)(W.zs3);return d=>{const f=u.get(W.z2F);if(d!==f.components[0])return;const v=u.get(ts),b=u.get(rl);1===u.get(Sc)&&v.initialNavigation(),u.get(Bl,null,W.XFs.Optional)?.setUpPreloading(),u.get(Js,null,W.XFs.Optional)?.init(),v.resetRootComponentType(f.componentTypes[0]),b.closed||(b.next(),b.unsubscribe())}}const rl=new W.OlP(wa?"bootstrap done indicator":"",{factory:()=>new dn.x}),Sc=new W.OlP(wa?"initial navigation":"",{providedIn:"root",factory:()=>1});function qc(){let u=[];return u=wa?[{provide:W.Xts,multi:!0,useFactory:()=>{const d=(0,W.f3M)(ts);return()=>d.events.subscribe(f=>{console.group?.(`Router Event: ${f.constructor.name}`),console.log(function pi(u){if(!("type"in u))return`Unknown Router Event: ${u.constructor.name}`;switch(u.type){case 14:return`ActivationEnd(path: '${u.snapshot.routeConfig?.path||""}')`;case 13:return`ActivationStart(path: '${u.snapshot.routeConfig?.path||""}')`;case 12:return`ChildActivationEnd(path: '${u.snapshot.routeConfig?.path||""}')`;case 11:return`ChildActivationStart(path: '${u.snapshot.routeConfig?.path||""}')`;case 8:return`GuardsCheckEnd(id: ${u.id}, url: '${u.url}', urlAfterRedirects: '${u.urlAfterRedirects}', state: ${u.state}, shouldActivate: ${u.shouldActivate})`;case 7:return`GuardsCheckStart(id: ${u.id}, url: '${u.url}', urlAfterRedirects: '${u.urlAfterRedirects}', state: ${u.state})`;case 2:return`NavigationCancel(id: ${u.id}, url: '${u.url}')`;case 16:return`NavigationSkipped(id: ${u.id}, url: '${u.url}')`;case 1:return`NavigationEnd(id: ${u.id}, url: '${u.url}', urlAfterRedirects: '${u.urlAfterRedirects}')`;case 3:return`NavigationError(id: ${u.id}, url: '${u.url}', error: ${u.error})`;case 0:return`NavigationStart(id: ${u.id}, url: '${u.url}')`;case 6:return`ResolveEnd(id: ${u.id}, url: '${u.url}', urlAfterRedirects: '${u.urlAfterRedirects}', state: ${u.state})`;case 5:return`ResolveStart(id: ${u.id}, url: '${u.url}', urlAfterRedirects: '${u.urlAfterRedirects}', state: ${u.state})`;case 10:return`RouteConfigLoadEnd(path: ${u.route.path})`;case 9:return`RouteConfigLoadStart(path: ${u.route.path})`;case 4:return`RoutesRecognized(id: ${u.id}, url: '${u.url}', urlAfterRedirects: '${u.urlAfterRedirects}', state: ${u.state})`;case 15:return`Scroll(anchor: '${u.anchor}', position: '${u.position?`${u.position[0]}, ${u.position[1]}`:null}')`}}(f)),console.log(f),console.groupEnd?.()})}}]:[],Cs(1,u)}const Bl=new W.OlP(wa?"router preloader":"");function Wc(u){return Cs(0,[{provide:Bl,useExisting:Gc},{provide:lc,useExisting:u}])}const cc=!1,Su=new W.OlP(cc?"router duplicate forRoot guard":"ROUTER_FORROOT_GUARD"),Mu=[ot.Ye,{provide:On,useClass:ce},ts,Io,{provide:ds,useFactory:function Cc(u){return u.routerState.root},deps:[ts]},va,cc?{provide:Qs,useValue:!0}:[]];function go(){return new W.PXZ("Router",ts)}let Mc=(()=>{class u{constructor(f){}static forRoot(f,v){return{ngModule:u,providers:[Mu,cc&&v?.enableTracing?qc().\u0275providers:[],{provide:ya,multi:!0,useValue:f},{provide:Su,useFactory:ba,deps:[[ts,new W.FiY,new W.tp0]]},{provide:es,useValue:v||{}},v?.useHash?{provide:ot.S$,useClass:ot.Do}:{provide:ot.S$,useClass:ot.b0},{provide:Js,useFactory:()=>{const u=(0,W.f3M)(ot.EM),d=(0,W.f3M)(W.R0b),f=(0,W.f3M)(es),v=(0,W.f3M)(sc),b=(0,W.f3M)(On);return f.scrollOffset&&u.setOffset(f.scrollOffset),new nl(b,v,u,d,f)}},v?.preloadingStrategy?Wc(v.preloadingStrategy).\u0275providers:[],{provide:W.PXZ,multi:!0,useFactory:go},v?.initialNavigation?p(v):[],[{provide:r,useFactory:zl},{provide:W.tb,multi:!0,useExisting:r}]]}}static forChild(f){return{ngModule:u,providers:[{provide:ya,multi:!0,useValue:f}]}}}return u.\u0275fac=function(f){return new(f||u)(W.LFG(Su,8))},u.\u0275mod=W.oAB({type:u}),u.\u0275inj=W.cJS({imports:[Bs]}),u})();function ba(u){if(cc&&u)throw new W.vHH(4007,"The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function p(u){return["disabled"===u.initialNavigation?Cs(3,[{provide:W.ip1,multi:!0,useFactory:()=>{const d=(0,W.f3M)(ts);return()=>{d.setUpLocationChangeListener()}}},{provide:Sc,useValue:2}]).\u0275providers:[],"enabledBlocking"===u.initialNavigation?Cs(2,[{provide:Sc,useValue:0},{provide:W.ip1,multi:!0,deps:[W.zs3],useFactory:d=>{const f=d.get(ot.V_,Promise.resolve());return()=>f.then(()=>new Promise(v=>{const b=d.get(ts),C=d.get(rl);(function xa(u,d){u.events.pipe((0,Dt.h)(f=>f instanceof mo||f instanceof lo||f instanceof wo||f instanceof Fi),(0,$e.U)(f=>f instanceof mo||f instanceof Fi?ko.COMPLETE:f instanceof lo&&(0===f.code||1===f.code)?ko.REDIRECTING:ko.FAILED),(0,Dt.h)(f=>f!==ko.REDIRECTING),At(1)).subscribe(()=>{d()})})(b,()=>{v(!0)}),d.get(sc).afterPreactivation=()=>(v(!0),C.closed?(0,Ge.of)(void 0):C),b.initialNavigation()}))}}]).\u0275providers:[]]}const r=new W.OlP(cc?"Router Initializer":"")}},or=>{or(or.s=4066)}]);