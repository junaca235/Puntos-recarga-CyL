(self.webpackChunkPuntos_de_CyL=self.webpackChunkPuntos_de_CyL||[]).push([[179],{7277:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{h:()=>c});var Y=Te(2454),W=Te.n(Y),Xe=Te(8256);let c=(()=>{class Re{constructor(){this.options={title:"",icon:"info",toast:!0,showConfirmButton:!1,timer:3e3}}showAlert(xt){const Tt={...this.options,...xt};W().fire(Tt)}}return Re.\u0275fac=function(xt){return new(xt||Re)},Re.\u0275cmp=Xe.Xpm({type:Re,selectors:[["app-sweet-alert"]],decls:0,vars:0,template:function(xt,Tt){}}),Re})()},2340:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{N:()=>Y});const Y={mapboxToken:"pk.eyJ1IjoianVuY2EyMzUiLCJhIjoiY2xmdjBpa2VnMDJrYzNrbzMwMmEyOXlmZiJ9.GJ8cigJUn2cUWxd_Wx_5VQ",mongoUrl:"https://puntos-recarga-cyl.up.railway.app/api",jcylUrl:"https://analisis.datosabiertos.jcyl.es/api/records/1.0/search/?dataset=puntos-de-recarga-del-vehiculo-electrico&rows=123"}},8697:(ii,Ke,Te)=>{"use strict";var Y=Te(1481),W=Te(8256),Xe=Te(7340);function Re(ie){return new W.vHH(3e3,!1)}function ln(){return typeof window<"u"&&typeof window.document<"u"}function Rn(){return typeof process<"u"&&"[object process]"==={}.toString.call(process)}function un(ie){switch(ie.length){case 0:return new Xe.ZN;case 1:return ie[0];default:return new Xe.ZE(ie)}}function Hn(ie,R,L,G,se=new Map,me=new Map){const Oe=[],Ue=[];let st=-1,mt=null;if(G.forEach(xn=>{const Sn=xn.get("offset"),ci=Sn==st,oi=ci&&mt||new Map;xn.forEach((Un,Jn)=>{let Ni=Jn,xi=Un;if("offset"!==Jn)switch(Ni=R.normalizePropertyName(Ni,Oe),xi){case Xe.k1:xi=se.get(Jn);break;case Xe.l3:xi=me.get(Jn);break;default:xi=R.normalizeStyleValue(Jn,Ni,xi,Oe)}oi.set(Ni,xi)}),ci||Ue.push(oi),mt=oi,st=Sn}),Oe.length)throw function En(ie){return new W.vHH(3502,!1)}();return Ue}function ui(ie,R,L,G){switch(R){case"start":ie.onStart(()=>G(L&&qn(L,"start",ie)));break;case"done":ie.onDone(()=>G(L&&qn(L,"done",ie)));break;case"destroy":ie.onDestroy(()=>G(L&&qn(L,"destroy",ie)))}}function qn(ie,R,L){const me=hi(ie.element,ie.triggerName,ie.fromState,ie.toState,R||ie.phaseName,L.totalTime??ie.totalTime,!!L.disabled),Oe=ie._data;return null!=Oe&&(me._data=Oe),me}function hi(ie,R,L,G,se="",me=0,Oe){return{element:ie,triggerName:R,fromState:L,toState:G,phaseName:se,totalTime:me,disabled:!!Oe}}function Ht(ie,R,L){let G=ie.get(R);return G||ie.set(R,G=L),G}function zi(ie){const R=ie.indexOf(":");return[ie.substring(1,R),ie.slice(R+1)]}let li=(ie,R)=>!1,Wi=(ie,R,L)=>[],si=null;function Wt(ie){const R=ie.parentNode||ie.host;return R===si?null:R}(Rn()||typeof Element<"u")&&(ln()?(si=(()=>document.documentElement)(),li=(ie,R)=>{for(;R;){if(R===ie)return!0;R=Wt(R)}return!1}):li=(ie,R)=>ie.contains(R),Wi=(ie,R,L)=>{if(L)return Array.from(ie.querySelectorAll(R));const G=ie.querySelector(R);return G?[G]:[]});let ni=null,os=!1;const Zi=li,jt=Wi;let Hi=(()=>{class ie{validateStyleProperty(L){return function lo(ie){ni||(ni=function zr(){return typeof document<"u"?document.body:null}()||{},os=!!ni.style&&"WebkitAppearance"in ni.style);let R=!0;return ni.style&&!function yr(ie){return"ebkit"==ie.substring(1,6)}(ie)&&(R=ie in ni.style,!R&&os&&(R="Webkit"+ie.charAt(0).toUpperCase()+ie.slice(1)in ni.style)),R}(L)}matchesElement(L,G){return!1}containsElement(L,G){return Zi(L,G)}getParentElement(L){return Wt(L)}query(L,G,se){return jt(L,G,se)}computeStyle(L,G,se){return se||""}animate(L,G,se,me,Oe,Ue=[],st){return new Xe.ZN(se,me)}}return ie.\u0275fac=function(L){return new(L||ie)},ie.\u0275prov=W.Yz7({token:ie,factory:ie.\u0275fac}),ie})(),Ri=(()=>{class ie{}return ie.NOOP=new Hi,ie})();const Yi=1e3,cr="ng-enter",Ji="ng-leave",Ee="ng-trigger",ne=".ng-trigger",ae="ng-animating",xe=".ng-animating";function Me(ie){if("number"==typeof ie)return ie;const R=ie.match(/^(-?[\.\d]+)(m?s)/);return!R||R.length<2?0:ze(parseFloat(R[1]),R[2])}function ze(ie,R){return"s"===R?ie*Yi:ie}function fe(ie,R,L){return ie.hasOwnProperty("duration")?ie:function oe(ie,R,L){let se,me=0,Oe="";if("string"==typeof ie){const Ue=ie.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===Ue)return R.push(Re()),{duration:0,delay:0,easing:""};se=ze(parseFloat(Ue[1]),Ue[2]);const st=Ue[3];null!=st&&(me=ze(parseFloat(st),Ue[4]));const mt=Ue[5];mt&&(Oe=mt)}else se=ie;if(!L){let Ue=!1,st=R.length;se<0&&(R.push(function nn(){return new W.vHH(3100,!1)}()),Ue=!0),me<0&&(R.push(function xt(){return new W.vHH(3101,!1)}()),Ue=!0),Ue&&R.splice(st,0,Re())}return{duration:se,delay:me,easing:Oe}}(ie,R,L)}function re(ie,R={}){return Object.keys(ie).forEach(L=>{R[L]=ie[L]}),R}function Ce(ie){const R=new Map;return Object.keys(ie).forEach(L=>{R.set(L,ie[L])}),R}function ut(ie,R=new Map,L){if(L)for(let[G,se]of L)R.set(G,se);for(let[G,se]of ie)R.set(G,se);return R}function Dn(ie,R,L){return L?R+":"+L+";":""}function cn(ie){let R="";for(let L=0;L<ie.style.length;L++){const G=ie.style.item(L);R+=Dn(0,G,ie.style.getPropertyValue(G))}for(const L in ie.style)ie.style.hasOwnProperty(L)&&!L.startsWith("_")&&(R+=Dn(0,Ai(L),ie.style[L]));ie.setAttribute("style",R)}function gn(ie,R,L){ie.style&&(R.forEach((G,se)=>{const me=Tn(se);L&&!L.has(se)&&L.set(se,ie.style[me]),ie.style[me]=G}),Rn()&&cn(ie))}function Fn(ie,R){ie.style&&(R.forEach((L,G)=>{const se=Tn(G);ie.style[se]=""}),Rn()&&cn(ie))}function Ve(ie){return Array.isArray(ie)?1==ie.length?ie[0]:(0,Xe.vP)(ie):ie}const ge=new RegExp("{{\\s*(.+?)\\s*}}","g");function $e(ie){let R=[];if("string"==typeof ie){let L;for(;L=ge.exec(ie);)R.push(L[1]);ge.lastIndex=0}return R}function dt(ie,R,L){const G=ie.toString(),se=G.replace(ge,(me,Oe)=>{let Ue=R[Oe];return null==Ue&&(L.push(function Et(ie){return new W.vHH(3003,!1)}()),Ue=""),Ue.toString()});return se==G?ie:se}function on(ie){const R=[];let L=ie.next();for(;!L.done;)R.push(L.value),L=ie.next();return R}const _n=/-+([a-z0-9])/g;function Tn(ie){return ie.replace(_n,(...R)=>R[1].toUpperCase())}function Ai(ie){return ie.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function Cn(ie,R,L){switch(R.type){case 7:return ie.visitTrigger(R,L);case 0:return ie.visitState(R,L);case 1:return ie.visitTransition(R,L);case 2:return ie.visitSequence(R,L);case 3:return ie.visitGroup(R,L);case 4:return ie.visitAnimate(R,L);case 5:return ie.visitKeyframes(R,L);case 6:return ie.visitStyle(R,L);case 8:return ie.visitReference(R,L);case 9:return ie.visitAnimateChild(R,L);case 10:return ie.visitAnimateRef(R,L);case 11:return ie.visitQuery(R,L);case 12:return ie.visitStagger(R,L);default:throw function At(ie){return new W.vHH(3004,!1)}()}}function Co(ie,R){return window.getComputedStyle(ie)[R]}const qo="*";function go(ie,R){const L=[];return"string"==typeof ie?ie.split(/\s*,\s*/).forEach(G=>function $s(ie,R,L){if(":"==ie[0]){const st=function ft(ie,R){switch(ie){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(L,G)=>parseFloat(G)>parseFloat(L);case":decrement":return(L,G)=>parseFloat(G)<parseFloat(L);default:return R.push(function tt(ie){return new W.vHH(3016,!1)}()),"* => *"}}(ie,L);if("function"==typeof st)return void R.push(st);ie=st}const G=ie.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==G||G.length<4)return L.push(function Zn(ie){return new W.vHH(3015,!1)}()),R;const se=G[1],me=G[2],Oe=G[3];R.push(bi(se,Oe));"<"==me[0]&&!(se==qo&&Oe==qo)&&R.push(bi(Oe,se))}(G,L,R)):L.push(ie),L}const ti=new Set(["true","1"]),ai=new Set(["false","0"]);function bi(ie,R){const L=ti.has(ie)||ai.has(ie),G=ti.has(R)||ai.has(R);return(se,me)=>{let Oe=ie==qo||ie==se,Ue=R==qo||R==me;return!Oe&&L&&"boolean"==typeof se&&(Oe=se?ti.has(ie):ai.has(ie)),!Ue&&G&&"boolean"==typeof me&&(Ue=me?ti.has(R):ai.has(R)),Oe&&Ue}}const ir=new RegExp("s*:selfs*,?","g");function Wo(ie,R,L,G){return new Zo(ie).build(R,L,G)}class Zo{constructor(R){this._driver=R}build(R,L,G){const se=new hn(L);return this._resetContextStyleTimingState(se),Cn(this,Ve(R),se)}_resetContextStyleTimingState(R){R.currentQuerySelector="",R.collectedStyles=new Map,R.collectedStyles.set("",new Map),R.currentTime=0}visitTrigger(R,L){let G=L.queryCount=0,se=L.depCount=0;const me=[],Oe=[];return"@"==R.name.charAt(0)&&L.errors.push(function Qt(){return new W.vHH(3006,!1)}()),R.definitions.forEach(Ue=>{if(this._resetContextStyleTimingState(L),0==Ue.type){const st=Ue,mt=st.name;mt.toString().split(/\s*,\s*/).forEach(xn=>{st.name=xn,me.push(this.visitState(st,L))}),st.name=mt}else if(1==Ue.type){const st=this.visitTransition(Ue,L);G+=st.queryCount,se+=st.depCount,Oe.push(st)}else L.errors.push(function An(){return new W.vHH(3007,!1)}())}),{type:7,name:R.name,states:me,transitions:Oe,queryCount:G,depCount:se,options:null}}visitState(R,L){const G=this.visitStyle(R.styles,L),se=R.options&&R.options.params||null;if(G.containsDynamicStyles){const me=new Set,Oe=se||{};G.styles.forEach(Ue=>{Ue instanceof Map&&Ue.forEach(st=>{$e(st).forEach(mt=>{Oe.hasOwnProperty(mt)||me.add(mt)})})}),me.size&&(on(me.values()),L.errors.push(function It(ie,R){return new W.vHH(3008,!1)}()))}return{type:0,name:R.name,style:G,options:se?{params:se}:null}}visitTransition(R,L){L.queryCount=0,L.depCount=0;const G=Cn(this,Ve(R.animation),L);return{type:1,matchers:go(R.expr,L.errors),animation:G,queryCount:L.queryCount,depCount:L.depCount,options:In(R.options)}}visitSequence(R,L){return{type:2,steps:R.steps.map(G=>Cn(this,G,L)),options:In(R.options)}}visitGroup(R,L){const G=L.currentTime;let se=0;const me=R.steps.map(Oe=>{L.currentTime=G;const Ue=Cn(this,Oe,L);return se=Math.max(se,L.currentTime),Ue});return L.currentTime=se,{type:3,steps:me,options:In(R.options)}}visitAnimate(R,L){const G=function Qi(ie,R){if(ie.hasOwnProperty("duration"))return ie;if("number"==typeof ie)return Ii(fe(ie,R).duration,0,"");const L=ie;if(L.split(/\s+/).some(me=>"{"==me.charAt(0)&&"{"==me.charAt(1))){const me=Ii(0,0,"");return me.dynamic=!0,me.strValue=L,me}const se=fe(L,R);return Ii(se.duration,se.delay,se.easing)}(R.timings,L.errors);L.currentAnimateTimings=G;let se,me=R.styles?R.styles:(0,Xe.oB)({});if(5==me.type)se=this.visitKeyframes(me,L);else{let Oe=R.styles,Ue=!1;if(!Oe){Ue=!0;const mt={};G.easing&&(mt.easing=G.easing),Oe=(0,Xe.oB)(mt)}L.currentTime+=G.duration+G.delay;const st=this.visitStyle(Oe,L);st.isEmptyStep=Ue,se=st}return L.currentAnimateTimings=null,{type:4,timings:G,style:se,options:null}}visitStyle(R,L){const G=this._makeStyleAst(R,L);return this._validateStyleAst(G,L),G}_makeStyleAst(R,L){const G=[],se=Array.isArray(R.styles)?R.styles:[R.styles];for(let Ue of se)"string"==typeof Ue?Ue===Xe.l3?G.push(Ue):L.errors.push(new W.vHH(3002,!1)):G.push(Ce(Ue));let me=!1,Oe=null;return G.forEach(Ue=>{if(Ue instanceof Map&&(Ue.has("easing")&&(Oe=Ue.get("easing"),Ue.delete("easing")),!me))for(let st of Ue.values())if(st.toString().indexOf("{{")>=0){me=!0;break}}),{type:6,styles:G,easing:Oe,offset:R.offset,containsDynamicStyles:me,options:null}}_validateStyleAst(R,L){const G=L.currentAnimateTimings;let se=L.currentTime,me=L.currentTime;G&&me>0&&(me-=G.duration+G.delay),R.styles.forEach(Oe=>{"string"!=typeof Oe&&Oe.forEach((Ue,st)=>{const mt=L.collectedStyles.get(L.currentQuerySelector),xn=mt.get(st);let Sn=!0;xn&&(me!=se&&me>=xn.startTime&&se<=xn.endTime&&(L.errors.push(function Nn(ie,R,L,G,se){return new W.vHH(3010,!1)}()),Sn=!1),me=xn.startTime),Sn&&mt.set(st,{startTime:me,endTime:se}),L.options&&function Ne(ie,R,L){const G=R.params||{},se=$e(ie);se.length&&se.forEach(me=>{G.hasOwnProperty(me)||L.push(function Tt(ie){return new W.vHH(3001,!1)}())})}(Ue,L.options,L.errors)})})}visitKeyframes(R,L){const G={type:5,styles:[],options:null};if(!L.currentAnimateTimings)return L.errors.push(function pn(){return new W.vHH(3011,!1)}()),G;let me=0;const Oe=[];let Ue=!1,st=!1,mt=0;const xn=R.steps.map(xi=>{const gr=this._makeStyleAst(xi,L);let tr=null!=gr.offset?gr.offset:function Mi(ie){if("string"==typeof ie)return null;let R=null;if(Array.isArray(ie))ie.forEach(L=>{if(L instanceof Map&&L.has("offset")){const G=L;R=parseFloat(G.get("offset")),G.delete("offset")}});else if(ie instanceof Map&&ie.has("offset")){const L=ie;R=parseFloat(L.get("offset")),L.delete("offset")}return R}(gr.styles),Wn=0;return null!=tr&&(me++,Wn=gr.offset=tr),st=st||Wn<0||Wn>1,Ue=Ue||Wn<mt,mt=Wn,Oe.push(Wn),gr});st&&L.errors.push(function rn(){return new W.vHH(3012,!1)}()),Ue&&L.errors.push(function an(){return new W.vHH(3200,!1)}());const Sn=R.steps.length;let ci=0;me>0&&me<Sn?L.errors.push(function Pt(){return new W.vHH(3202,!1)}()):0==me&&(ci=1/(Sn-1));const oi=Sn-1,Un=L.currentTime,Jn=L.currentAnimateTimings,Ni=Jn.duration;return xn.forEach((xi,gr)=>{const tr=ci>0?gr==oi?1:ci*gr:Oe[gr],Wn=tr*Ni;L.currentTime=Un+Jn.delay+Wn,Jn.duration=Wn,this._validateStyleAst(xi,L),xi.offset=tr,G.styles.push(xi)}),G}visitReference(R,L){return{type:8,animation:Cn(this,Ve(R.animation),L),options:In(R.options)}}visitAnimateChild(R,L){return L.depCount++,{type:9,options:In(R.options)}}visitAnimateRef(R,L){return{type:10,animation:this.visitReference(R.animation,L),options:In(R.options)}}visitQuery(R,L){const G=L.currentQuerySelector,se=R.options||{};L.queryCount++,L.currentQuery=R;const[me,Oe]=function tn(ie){const R=!!ie.split(/\s*,\s*/).find(L=>":self"==L);return R&&(ie=ie.replace(ir,"")),ie=ie.replace(/@\*/g,ne).replace(/@\w+/g,L=>ne+"-"+L.slice(1)).replace(/:animating/g,xe),[ie,R]}(R.selector);L.currentQuerySelector=G.length?G+" "+me:me,Ht(L.collectedStyles,L.currentQuerySelector,new Map);const Ue=Cn(this,Ve(R.animation),L);return L.currentQuery=null,L.currentQuerySelector=G,{type:11,selector:me,limit:se.limit||0,optional:!!se.optional,includeSelf:Oe,animation:Ue,originalSelector:R.selector,options:In(R.options)}}visitStagger(R,L){L.currentQuery||L.errors.push(function Se(){return new W.vHH(3013,!1)}());const G="full"===R.timings?{duration:0,delay:0,easing:"full"}:fe(R.timings,L.errors,!0);return{type:12,animation:Cn(this,Ve(R.animation),L),timings:G,options:null}}}class hn{constructor(R){this.errors=R,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function In(ie){return ie?(ie=re(ie)).params&&(ie.params=function Ft(ie){return ie?re(ie):null}(ie.params)):ie={},ie}function Ii(ie,R,L){return{duration:ie,delay:R,easing:L}}function So(ie,R,L,G,se,me,Oe=null,Ue=!1){return{type:1,element:ie,keyframes:R,preStyleProps:L,postStyleProps:G,duration:se,delay:me,totalTime:se+me,easing:Oe,subTimeline:Ue}}class ki{constructor(){this._map=new Map}get(R){return this._map.get(R)||[]}append(R,L){let G=this._map.get(R);G||this._map.set(R,G=[]),G.push(...L)}has(R){return this._map.has(R)}clear(){this._map.clear()}}const Yn=new RegExp(":enter","g"),Zr=new RegExp(":leave","g");function Xo(ie,R,L,G,se,me=new Map,Oe=new Map,Ue,st,mt=[]){return(new fr).buildKeyframes(ie,R,L,G,se,me,Oe,Ue,st,mt)}class fr{buildKeyframes(R,L,G,se,me,Oe,Ue,st,mt,xn=[]){mt=mt||new ki;const Sn=new ko(R,L,mt,se,me,xn,[]);Sn.options=st;const ci=st.delay?Me(st.delay):0;Sn.currentTimeline.delayNextStep(ci),Sn.currentTimeline.setStyles([Oe],null,Sn.errors,st),Cn(this,G,Sn);const oi=Sn.timelines.filter(Un=>Un.containsAnimation());if(oi.length&&Ue.size){let Un;for(let Jn=oi.length-1;Jn>=0;Jn--){const Ni=oi[Jn];if(Ni.element===L){Un=Ni;break}}Un&&!Un.allowOnlyTimelineStyles()&&Un.setStyles([Ue],null,Sn.errors,st)}return oi.length?oi.map(Un=>Un.buildKeyframes()):[So(L,[],[],[],0,ci,"",!1)]}visitTrigger(R,L){}visitState(R,L){}visitTransition(R,L){}visitAnimateChild(R,L){const G=L.subInstructions.get(L.element);if(G){const se=L.createSubContext(R.options),me=L.currentTimeline.currentTime,Oe=this._visitSubInstructions(G,se,se.options);me!=Oe&&L.transformIntoNewTimeline(Oe)}L.previousNode=R}visitAnimateRef(R,L){const G=L.createSubContext(R.options);G.transformIntoNewTimeline(),this._applyAnimationRefDelays([R.options,R.animation.options],L,G),this.visitReference(R.animation,G),L.transformIntoNewTimeline(G.currentTimeline.currentTime),L.previousNode=R}_applyAnimationRefDelays(R,L,G){for(const se of R){const me=se?.delay;if(me){const Oe="number"==typeof me?me:Me(dt(me,se?.params??{},L.errors));G.delayNextStep(Oe)}}}_visitSubInstructions(R,L,G){let me=L.currentTimeline.currentTime;const Oe=null!=G.duration?Me(G.duration):null,Ue=null!=G.delay?Me(G.delay):null;return 0!==Oe&&R.forEach(st=>{const mt=L.appendInstructionToTimeline(st,Oe,Ue);me=Math.max(me,mt.duration+mt.delay)}),me}visitReference(R,L){L.updateOptions(R.options,!0),Cn(this,R.animation,L),L.previousNode=R}visitSequence(R,L){const G=L.subContextCount;let se=L;const me=R.options;if(me&&(me.params||me.delay)&&(se=L.createSubContext(me),se.transformIntoNewTimeline(),null!=me.delay)){6==se.previousNode.type&&(se.currentTimeline.snapshotCurrentStyles(),se.previousNode=Xi);const Oe=Me(me.delay);se.delayNextStep(Oe)}R.steps.length&&(R.steps.forEach(Oe=>Cn(this,Oe,se)),se.currentTimeline.applyStylesToKeyframe(),se.subContextCount>G&&se.transformIntoNewTimeline()),L.previousNode=R}visitGroup(R,L){const G=[];let se=L.currentTimeline.currentTime;const me=R.options&&R.options.delay?Me(R.options.delay):0;R.steps.forEach(Oe=>{const Ue=L.createSubContext(R.options);me&&Ue.delayNextStep(me),Cn(this,Oe,Ue),se=Math.max(se,Ue.currentTimeline.currentTime),G.push(Ue.currentTimeline)}),G.forEach(Oe=>L.currentTimeline.mergeTimelineCollectedStyles(Oe)),L.transformIntoNewTimeline(se),L.previousNode=R}_visitTiming(R,L){if(R.dynamic){const G=R.strValue;return fe(L.params?dt(G,L.params,L.errors):G,L.errors)}return{duration:R.duration,delay:R.delay,easing:R.easing}}visitAnimate(R,L){const G=L.currentAnimateTimings=this._visitTiming(R.timings,L),se=L.currentTimeline;G.delay&&(L.incrementTime(G.delay),se.snapshotCurrentStyles());const me=R.style;5==me.type?this.visitKeyframes(me,L):(L.incrementTime(G.duration),this.visitStyle(me,L),se.applyStylesToKeyframe()),L.currentAnimateTimings=null,L.previousNode=R}visitStyle(R,L){const G=L.currentTimeline,se=L.currentAnimateTimings;!se&&G.hasCurrentStyleProperties()&&G.forwardFrame();const me=se&&se.easing||R.easing;R.isEmptyStep?G.applyEmptyStep(me):G.setStyles(R.styles,me,L.errors,L.options),L.previousNode=R}visitKeyframes(R,L){const G=L.currentAnimateTimings,se=L.currentTimeline.duration,me=G.duration,Ue=L.createSubContext().currentTimeline;Ue.easing=G.easing,R.styles.forEach(st=>{Ue.forwardTime((st.offset||0)*me),Ue.setStyles(st.styles,st.easing,L.errors,L.options),Ue.applyStylesToKeyframe()}),L.currentTimeline.mergeTimelineCollectedStyles(Ue),L.transformIntoNewTimeline(se+me),L.previousNode=R}visitQuery(R,L){const G=L.currentTimeline.currentTime,se=R.options||{},me=se.delay?Me(se.delay):0;me&&(6===L.previousNode.type||0==G&&L.currentTimeline.hasCurrentStyleProperties())&&(L.currentTimeline.snapshotCurrentStyles(),L.previousNode=Xi);let Oe=G;const Ue=L.invokeQuery(R.selector,R.originalSelector,R.limit,R.includeSelf,!!se.optional,L.errors);L.currentQueryTotal=Ue.length;let st=null;Ue.forEach((mt,xn)=>{L.currentQueryIndex=xn;const Sn=L.createSubContext(R.options,mt);me&&Sn.delayNextStep(me),mt===L.element&&(st=Sn.currentTimeline),Cn(this,R.animation,Sn),Sn.currentTimeline.applyStylesToKeyframe(),Oe=Math.max(Oe,Sn.currentTimeline.currentTime)}),L.currentQueryIndex=0,L.currentQueryTotal=0,L.transformIntoNewTimeline(Oe),st&&(L.currentTimeline.mergeTimelineCollectedStyles(st),L.currentTimeline.snapshotCurrentStyles()),L.previousNode=R}visitStagger(R,L){const G=L.parentContext,se=L.currentTimeline,me=R.timings,Oe=Math.abs(me.duration),Ue=Oe*(L.currentQueryTotal-1);let st=Oe*L.currentQueryIndex;switch(me.duration<0?"reverse":me.easing){case"reverse":st=Ue-st;break;case"full":st=G.currentStaggerTime}const xn=L.currentTimeline;st&&xn.delayNextStep(st);const Sn=xn.currentTime;Cn(this,R.animation,L),L.previousNode=R,G.currentStaggerTime=se.currentTime-Sn+(se.startTime-G.currentTimeline.startTime)}}const Xi={};class ko{constructor(R,L,G,se,me,Oe,Ue,st){this._driver=R,this.element=L,this.subInstructions=G,this._enterClassName=se,this._leaveClassName=me,this.errors=Oe,this.timelines=Ue,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=Xi,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=st||new Jr(this._driver,L,0),Ue.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(R,L){if(!R)return;const G=R;let se=this.options;null!=G.duration&&(se.duration=Me(G.duration)),null!=G.delay&&(se.delay=Me(G.delay));const me=G.params;if(me){let Oe=se.params;Oe||(Oe=this.options.params={}),Object.keys(me).forEach(Ue=>{(!L||!Oe.hasOwnProperty(Ue))&&(Oe[Ue]=dt(me[Ue],Oe,this.errors))})}}_copyOptions(){const R={};if(this.options){const L=this.options.params;if(L){const G=R.params={};Object.keys(L).forEach(se=>{G[se]=L[se]})}}return R}createSubContext(R=null,L,G){const se=L||this.element,me=new ko(this._driver,se,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(se,G||0));return me.previousNode=this.previousNode,me.currentAnimateTimings=this.currentAnimateTimings,me.options=this._copyOptions(),me.updateOptions(R),me.currentQueryIndex=this.currentQueryIndex,me.currentQueryTotal=this.currentQueryTotal,me.parentContext=this,this.subContextCount++,me}transformIntoNewTimeline(R){return this.previousNode=Xi,this.currentTimeline=this.currentTimeline.fork(this.element,R),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(R,L,G){const se={duration:L??R.duration,delay:this.currentTimeline.currentTime+(G??0)+R.delay,easing:""},me=new _o(this._driver,R.element,R.keyframes,R.preStyleProps,R.postStyleProps,se,R.stretchStartingKeyframe);return this.timelines.push(me),se}incrementTime(R){this.currentTimeline.forwardTime(this.currentTimeline.duration+R)}delayNextStep(R){R>0&&this.currentTimeline.delayNextStep(R)}invokeQuery(R,L,G,se,me,Oe){let Ue=[];if(se&&Ue.push(this.element),R.length>0){R=(R=R.replace(Yn,"."+this._enterClassName)).replace(Zr,"."+this._leaveClassName);let mt=this._driver.query(this.element,R,1!=G);0!==G&&(mt=G<0?mt.slice(mt.length+G,mt.length):mt.slice(0,G)),Ue.push(...mt)}return!me&&0==Ue.length&&Oe.push(function fn(ie){return new W.vHH(3014,!1)}()),Ue}}class Jr{constructor(R,L,G,se){this._driver=R,this.element=L,this.startTime=G,this._elementTimelineStylesLookup=se,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(L),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(L,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(R){const L=1===this._keyframes.size&&this._pendingStyles.size;this.duration||L?(this.forwardTime(this.currentTime+R),L&&this.snapshotCurrentStyles()):this.startTime+=R}fork(R,L){return this.applyStylesToKeyframe(),new Jr(this._driver,R,L||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(R){this.applyStylesToKeyframe(),this.duration=R,this._loadKeyframe()}_updateStyle(R,L){this._localTimelineStyles.set(R,L),this._globalTimelineStyles.set(R,L),this._styleSummary.set(R,{time:this.currentTime,value:L})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(R){R&&this._previousKeyframe.set("easing",R);for(let[L,G]of this._globalTimelineStyles)this._backFill.set(L,G||Xe.l3),this._currentKeyframe.set(L,Xe.l3);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(R,L,G,se){L&&this._previousKeyframe.set("easing",L);const me=se&&se.params||{},Oe=function Qr(ie,R){const L=new Map;let G;return ie.forEach(se=>{if("*"===se){G=G||R.keys();for(let me of G)L.set(me,Xe.l3)}else ut(se,L)}),L}(R,this._globalTimelineStyles);for(let[Ue,st]of Oe){const mt=dt(st,me,G);this._pendingStyles.set(Ue,mt),this._localTimelineStyles.has(Ue)||this._backFill.set(Ue,this._globalTimelineStyles.get(Ue)??Xe.l3),this._updateStyle(Ue,mt)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((R,L)=>{this._currentKeyframe.set(L,R)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((R,L)=>{this._currentKeyframe.has(L)||this._currentKeyframe.set(L,R)}))}snapshotCurrentStyles(){for(let[R,L]of this._localTimelineStyles)this._pendingStyles.set(R,L),this._updateStyle(R,L)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const R=[];for(let L in this._currentKeyframe)R.push(L);return R}mergeTimelineCollectedStyles(R){R._styleSummary.forEach((L,G)=>{const se=this._styleSummary.get(G);(!se||L.time>se.time)&&this._updateStyle(G,L.value)})}buildKeyframes(){this.applyStylesToKeyframe();const R=new Set,L=new Set,G=1===this._keyframes.size&&0===this.duration;let se=[];this._keyframes.forEach((Ue,st)=>{const mt=ut(Ue,new Map,this._backFill);mt.forEach((xn,Sn)=>{xn===Xe.k1?R.add(Sn):xn===Xe.l3&&L.add(Sn)}),G||mt.set("offset",st/this.duration),se.push(mt)});const me=R.size?on(R.values()):[],Oe=L.size?on(L.values()):[];if(G){const Ue=se[0],st=new Map(Ue);Ue.set("offset",0),st.set("offset",1),se=[Ue,st]}return So(this.element,se,me,Oe,this.duration,this.startTime,this.easing,!1)}}class _o extends Jr{constructor(R,L,G,se,me,Oe,Ue=!1){super(R,L,Oe.delay),this.keyframes=G,this.preStyleProps=se,this.postStyleProps=me,this._stretchStartingKeyframe=Ue,this.timings={duration:Oe.duration,delay:Oe.delay,easing:Oe.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let R=this.keyframes,{delay:L,duration:G,easing:se}=this.timings;if(this._stretchStartingKeyframe&&L){const me=[],Oe=G+L,Ue=L/Oe,st=ut(R[0]);st.set("offset",0),me.push(st);const mt=ut(R[0]);mt.set("offset",Ro(Ue)),me.push(mt);const xn=R.length-1;for(let Sn=1;Sn<=xn;Sn++){let ci=ut(R[Sn]);const oi=ci.get("offset");ci.set("offset",Ro((L+oi*G)/Oe)),me.push(ci)}G=Oe,L=0,se="",R=me}return So(this.element,R,this.preStyleProps,this.postStyleProps,G,L,se,!0)}}function Ro(ie,R=3){const L=Math.pow(10,R-1);return Math.round(ie*L)/L}class ca{}const eo=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class to extends ca{normalizePropertyName(R,L){return Tn(R)}normalizeStyleValue(R,L,G,se){let me="";const Oe=G.toString().trim();if(eo.has(L)&&0!==G&&"0"!==G)if("number"==typeof G)me="px";else{const Ue=G.match(/^[+-]?[\d\.]+([a-z]*)$/);Ue&&0==Ue[1].length&&se.push(function _t(ie,R){return new W.vHH(3005,!1)}())}return Oe+me}}function Hs(ie,R,L,G,se,me,Oe,Ue,st,mt,xn,Sn,ci){return{type:0,element:ie,triggerName:R,isRemovalTransition:se,fromState:L,fromStyles:me,toState:G,toStyles:Oe,timelines:Ue,queriedElements:st,preStyleProps:mt,postStyleProps:xn,totalTime:Sn,errors:ci}}const no={};class Ei{constructor(R,L,G){this._triggerName=R,this.ast=L,this._stateStyles=G}match(R,L,G,se){return function io(ie,R,L,G,se){return ie.some(me=>me(R,L,G,se))}(this.ast.matchers,R,L,G,se)}buildStyles(R,L,G){let se=this._stateStyles.get("*");return void 0!==R&&(se=this._stateStyles.get(R?.toString())||se),se?se.buildStyles(L,G):new Map}build(R,L,G,se,me,Oe,Ue,st,mt,xn){const Sn=[],ci=this.ast.options&&this.ast.options.params||no,Un=this.buildStyles(G,Ue&&Ue.params||no,Sn),Jn=st&&st.params||no,Ni=this.buildStyles(se,Jn,Sn),xi=new Set,gr=new Map,tr=new Map,Wn="void"===se,dr={params:$r(Jn,ci),delay:this.ast.options?.delay},Si=xn?[]:Xo(R,L,this.ast.animation,me,Oe,Un,Ni,dr,mt,Sn);let br=0;if(Si.forEach(J=>{br=Math.max(J.duration+J.delay,br)}),Sn.length)return Hs(L,this._triggerName,G,se,Wn,Un,Ni,[],[],gr,tr,br,Sn);Si.forEach(J=>{const j=J.element,ue=Ht(gr,j,new Set);J.preStyleProps.forEach(et=>ue.add(et));const Ae=Ht(tr,j,new Set);J.postStyleProps.forEach(et=>Ae.add(et)),j!==L&&xi.add(j)});const N=on(xi.values());return Hs(L,this._triggerName,G,se,Wn,Un,Ni,Si,N,gr,tr,br)}}function $r(ie,R){const L=re(R);for(const G in ie)ie.hasOwnProperty(G)&&null!=ie[G]&&(L[G]=ie[G]);return L}class Mr{constructor(R,L,G){this.styles=R,this.defaultParams=L,this.normalizer=G}buildStyles(R,L){const G=new Map,se=re(this.defaultParams);return Object.keys(R).forEach(me=>{const Oe=R[me];null!==Oe&&(se[me]=Oe)}),this.styles.styles.forEach(me=>{"string"!=typeof me&&me.forEach((Oe,Ue)=>{Oe&&(Oe=dt(Oe,se,L));const st=this.normalizer.normalizePropertyName(Ue,L);Oe=this.normalizer.normalizeStyleValue(Ue,st,Oe,L),G.set(Ue,Oe)})}),G}}class us{constructor(R,L,G){this.name=R,this.ast=L,this._normalizer=G,this.transitionFactories=[],this.states=new Map,L.states.forEach(se=>{this.states.set(se.name,new Mr(se.style,se.options&&se.options.params||{},G))}),Hr(this.states,"true","1"),Hr(this.states,"false","0"),L.transitions.forEach(se=>{this.transitionFactories.push(new Ei(R,se,this.states))}),this.fallbackTransition=function ur(ie,R,L){return new Ei(ie,{type:1,animation:{type:2,steps:[],options:null},matchers:[(Oe,Ue)=>!0],options:null,queryCount:0,depCount:0},R)}(R,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(R,L,G,se){return this.transitionFactories.find(Oe=>Oe.match(R,L,G,se))||null}matchStyles(R,L,G){return this.fallbackTransition.buildStyles(R,L,G)}}function Hr(ie,R,L){ie.has(R)?ie.has(L)||ie.set(L,ie.get(R)):ie.has(L)&&ie.set(R,ie.get(L))}const Ko=new ki;class Gs{constructor(R,L,G){this.bodyNode=R,this._driver=L,this._normalizer=G,this._animations=new Map,this._playersById=new Map,this.players=[]}register(R,L){const G=[],se=[],me=Wo(this._driver,L,G,se);if(G.length)throw function yi(ie){return new W.vHH(3503,!1)}();this._animations.set(R,me)}_buildPlayer(R,L,G){const se=R.element,me=Hn(0,this._normalizer,0,R.keyframes,L,G);return this._driver.animate(se,me,R.duration,R.delay,R.easing,[],!0)}create(R,L,G={}){const se=[],me=this._animations.get(R);let Oe;const Ue=new Map;if(me?(Oe=Xo(this._driver,L,me,cr,Ji,new Map,new Map,G,Ko,se),Oe.forEach(xn=>{const Sn=Ht(Ue,xn.element,new Map);xn.postStyleProps.forEach(ci=>Sn.set(ci,null))})):(se.push(function Mt(){return new W.vHH(3300,!1)}()),Oe=[]),se.length)throw function Bi(ie){return new W.vHH(3504,!1)}();Ue.forEach((xn,Sn)=>{xn.forEach((ci,oi)=>{xn.set(oi,this._driver.computeStyle(Sn,oi,Xe.l3))})});const mt=un(Oe.map(xn=>{const Sn=Ue.get(xn.element);return this._buildPlayer(xn,new Map,Sn)}));return this._playersById.set(R,mt),mt.onDestroy(()=>this.destroy(R)),this.players.push(mt),mt}destroy(R){const L=this._getPlayer(R);L.destroy(),this._playersById.delete(R);const G=this.players.indexOf(L);G>=0&&this.players.splice(G,1)}_getPlayer(R){const L=this._playersById.get(R);if(!L)throw function qe(ie){return new W.vHH(3301,!1)}();return L}listen(R,L,G,se){const me=hi(L,"","","");return ui(this._getPlayer(R),G,me,se),()=>{}}command(R,L,G,se){if("register"==G)return void this.register(R,se[0]);if("create"==G)return void this.create(R,L,se[0]||{});const me=this._getPlayer(R);switch(G){case"play":me.play();break;case"pause":me.pause();break;case"reset":me.reset();break;case"restart":me.restart();break;case"finish":me.finish();break;case"init":me.init();break;case"setPosition":me.setPosition(parseFloat(se[0]));break;case"destroy":this.destroy(R)}}}const hs="ng-animate-queued",ro="ng-animate-disabled",ea=[],pr={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},da={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},Gr="__ng_removed";class As{get params(){return this.options.params}constructor(R,L=""){this.namespaceId=L;const G=R&&R.hasOwnProperty("value");if(this.value=function Ya(ie){return ie??null}(G?R.value:R),G){const me=re(R);delete me.value,this.options=me}else this.options={};this.options.params||(this.options.params={})}absorbOptions(R){const L=R.params;if(L){const G=this.options.params;Object.keys(L).forEach(se=>{null==G[se]&&(G[se]=L[se])})}}}const qs="void",Yo=new As(qs);class xs{constructor(R,L,G){this.id=R,this.hostElement=L,this._engine=G,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+R,sr(L,this._hostClassName)}listen(R,L,G,se){if(!this._triggers.has(L))throw function at(ie,R){return new W.vHH(3302,!1)}();if(null==G||0==G.length)throw function bt(ie){return new W.vHH(3303,!1)}();if(!function Oa(ie){return"start"==ie||"done"==ie}(G))throw function Dt(ie,R){return new W.vHH(3400,!1)}();const me=Ht(this._elementListeners,R,[]),Oe={name:L,phase:G,callback:se};me.push(Oe);const Ue=Ht(this._engine.statesByElement,R,new Map);return Ue.has(L)||(sr(R,Ee),sr(R,Ee+"-"+L),Ue.set(L,Yo)),()=>{this._engine.afterFlush(()=>{const st=me.indexOf(Oe);st>=0&&me.splice(st,1),this._triggers.has(L)||Ue.delete(L)})}}register(R,L){return!this._triggers.has(R)&&(this._triggers.set(R,L),!0)}_getTrigger(R){const L=this._triggers.get(R);if(!L)throw function Ut(ie){return new W.vHH(3401,!1)}();return L}trigger(R,L,G,se=!0){const me=this._getTrigger(L),Oe=new Jo(this.id,L,R);let Ue=this._engine.statesByElement.get(R);Ue||(sr(R,Ee),sr(R,Ee+"-"+L),this._engine.statesByElement.set(R,Ue=new Map));let st=Ue.get(L);const mt=new As(G,this.id);if(!(G&&G.hasOwnProperty("value"))&&st&&mt.absorbOptions(st.options),Ue.set(L,mt),st||(st=Yo),mt.value!==qs&&st.value===mt.value){if(!function Da(ie,R){const L=Object.keys(ie),G=Object.keys(R);if(L.length!=G.length)return!1;for(let se=0;se<L.length;se++){const me=L[se];if(!R.hasOwnProperty(me)||ie[me]!==R[me])return!1}return!0}(st.params,mt.params)){const Jn=[],Ni=me.matchStyles(st.value,st.params,Jn),xi=me.matchStyles(mt.value,mt.params,Jn);Jn.length?this._engine.reportError(Jn):this._engine.afterFlush(()=>{Fn(R,Ni),gn(R,xi)})}return}const ci=Ht(this._engine.playersByElement,R,[]);ci.forEach(Jn=>{Jn.namespaceId==this.id&&Jn.triggerName==L&&Jn.queued&&Jn.destroy()});let oi=me.matchTransition(st.value,mt.value,R,mt.params),Un=!1;if(!oi){if(!se)return;oi=me.fallbackTransition,Un=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:R,triggerName:L,transition:oi,fromState:st,toState:mt,player:Oe,isFallbackTransition:Un}),Un||(sr(R,hs),Oe.onStart(()=>{Ao(R,hs)})),Oe.onDone(()=>{let Jn=this.players.indexOf(Oe);Jn>=0&&this.players.splice(Jn,1);const Ni=this._engine.playersByElement.get(R);if(Ni){let xi=Ni.indexOf(Oe);xi>=0&&Ni.splice(xi,1)}}),this.players.push(Oe),ci.push(Oe),Oe}deregister(R){this._triggers.delete(R),this._engine.statesByElement.forEach(L=>L.delete(R)),this._elementListeners.forEach((L,G)=>{this._elementListeners.set(G,L.filter(se=>se.name!=R))})}clearElementCache(R){this._engine.statesByElement.delete(R),this._elementListeners.delete(R);const L=this._engine.playersByElement.get(R);L&&(L.forEach(G=>G.destroy()),this._engine.playersByElement.delete(R))}_signalRemovalForInnerTriggers(R,L){const G=this._engine.driver.query(R,ne,!0);G.forEach(se=>{if(se[Gr])return;const me=this._engine.fetchNamespacesByElement(se);me.size?me.forEach(Oe=>Oe.triggerLeaveAnimation(se,L,!1,!0)):this.clearElementCache(se)}),this._engine.afterFlushAnimationsDone(()=>G.forEach(se=>this.clearElementCache(se)))}triggerLeaveAnimation(R,L,G,se){const me=this._engine.statesByElement.get(R),Oe=new Map;if(me){const Ue=[];if(me.forEach((st,mt)=>{if(Oe.set(mt,st.value),this._triggers.has(mt)){const xn=this.trigger(R,mt,qs,se);xn&&Ue.push(xn)}}),Ue.length)return this._engine.markElementAsRemoved(this.id,R,!0,L,Oe),G&&un(Ue).onDone(()=>this._engine.processLeaveNode(R)),!0}return!1}prepareLeaveAnimationListeners(R){const L=this._elementListeners.get(R),G=this._engine.statesByElement.get(R);if(L&&G){const se=new Set;L.forEach(me=>{const Oe=me.name;if(se.has(Oe))return;se.add(Oe);const st=this._triggers.get(Oe).fallbackTransition,mt=G.get(Oe)||Yo,xn=new As(qs),Sn=new Jo(this.id,Oe,R);this._engine.totalQueuedPlayers++,this._queue.push({element:R,triggerName:Oe,transition:st,fromState:mt,toState:xn,player:Sn,isFallbackTransition:!0})})}}removeNode(R,L){const G=this._engine;if(R.childElementCount&&this._signalRemovalForInnerTriggers(R,L),this.triggerLeaveAnimation(R,L,!0))return;let se=!1;if(G.totalAnimations){const me=G.players.length?G.playersByQueriedElement.get(R):[];if(me&&me.length)se=!0;else{let Oe=R;for(;Oe=Oe.parentNode;)if(G.statesByElement.get(Oe)){se=!0;break}}}if(this.prepareLeaveAnimationListeners(R),se)G.markElementAsRemoved(this.id,R,!1,L);else{const me=R[Gr];(!me||me===pr)&&(G.afterFlush(()=>this.clearElementCache(R)),G.destroyInnerAnimations(R),G._onRemovalComplete(R,L))}}insertNode(R,L){sr(R,this._hostClassName)}drainQueuedTransitions(R){const L=[];return this._queue.forEach(G=>{const se=G.player;if(se.destroyed)return;const me=G.element,Oe=this._elementListeners.get(me);Oe&&Oe.forEach(Ue=>{if(Ue.name==G.triggerName){const st=hi(me,G.triggerName,G.fromState.value,G.toState.value);st._data=R,ui(G.player,Ue.phase,st,Ue.callback)}}),se.markedForDestroy?this._engine.afterFlush(()=>{se.destroy()}):L.push(G)}),this._queue=[],L.sort((G,se)=>{const me=G.transition.ast.depCount,Oe=se.transition.ast.depCount;return 0==me||0==Oe?me-Oe:this._engine.driver.containsElement(G.element,se.element)?1:-1})}destroy(R){this.players.forEach(L=>L.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,R)}elementContainsData(R){let L=!1;return this._elementListeners.has(R)&&(L=!0),L=!!this._queue.find(G=>G.element===R)||L,L}}class fa{_onRemovalComplete(R,L){this.onRemovalComplete(R,L)}constructor(R,L,G){this.bodyNode=R,this.driver=L,this._normalizer=G,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(se,me)=>{}}get queuedPlayers(){const R=[];return this._namespaceList.forEach(L=>{L.players.forEach(G=>{G.queued&&R.push(G)})}),R}createNamespace(R,L){const G=new xs(R,L,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,L)?this._balanceNamespaceList(G,L):(this.newHostElements.set(L,G),this.collectEnterElement(L)),this._namespaceLookup[R]=G}_balanceNamespaceList(R,L){const G=this._namespaceList,se=this.namespacesByHostElement;if(G.length-1>=0){let Oe=!1,Ue=this.driver.getParentElement(L);for(;Ue;){const st=se.get(Ue);if(st){const mt=G.indexOf(st);G.splice(mt+1,0,R),Oe=!0;break}Ue=this.driver.getParentElement(Ue)}Oe||G.unshift(R)}else G.push(R);return se.set(L,R),R}register(R,L){let G=this._namespaceLookup[R];return G||(G=this.createNamespace(R,L)),G}registerTrigger(R,L,G){let se=this._namespaceLookup[R];se&&se.register(L,G)&&this.totalAnimations++}destroy(R,L){if(!R)return;const G=this._fetchNamespace(R);this.afterFlush(()=>{this.namespacesByHostElement.delete(G.hostElement),delete this._namespaceLookup[R];const se=this._namespaceList.indexOf(G);se>=0&&this._namespaceList.splice(se,1)}),this.afterFlushAnimationsDone(()=>G.destroy(L))}_fetchNamespace(R){return this._namespaceLookup[R]}fetchNamespacesByElement(R){const L=new Set,G=this.statesByElement.get(R);if(G)for(let se of G.values())if(se.namespaceId){const me=this._fetchNamespace(se.namespaceId);me&&L.add(me)}return L}trigger(R,L,G,se){if(yo(L)){const me=this._fetchNamespace(R);if(me)return me.trigger(L,G,se),!0}return!1}insertNode(R,L,G,se){if(!yo(L))return;const me=L[Gr];if(me&&me.setForRemoval){me.setForRemoval=!1,me.setForMove=!0;const Oe=this.collectedLeaveElements.indexOf(L);Oe>=0&&this.collectedLeaveElements.splice(Oe,1)}if(R){const Oe=this._fetchNamespace(R);Oe&&Oe.insertNode(L,G)}se&&this.collectEnterElement(L)}collectEnterElement(R){this.collectedEnterElements.push(R)}markElementAsDisabled(R,L){L?this.disabledNodes.has(R)||(this.disabledNodes.add(R),sr(R,ro)):this.disabledNodes.has(R)&&(this.disabledNodes.delete(R),Ao(R,ro))}removeNode(R,L,G,se){if(yo(L)){const me=R?this._fetchNamespace(R):null;if(me?me.removeNode(L,se):this.markElementAsRemoved(R,L,!1,se),G){const Oe=this.namespacesByHostElement.get(L);Oe&&Oe.id!==R&&Oe.removeNode(L,se)}}else this._onRemovalComplete(L,se)}markElementAsRemoved(R,L,G,se,me){this.collectedLeaveElements.push(L),L[Gr]={namespaceId:R,setForRemoval:se,hasAnimation:G,removedBeforeQueried:!1,previousTriggersValues:me}}listen(R,L,G,se,me){return yo(L)?this._fetchNamespace(R).listen(L,G,se,me):()=>{}}_buildInstruction(R,L,G,se,me){return R.transition.build(this.driver,R.element,R.fromState.value,R.toState.value,G,se,R.fromState.options,R.toState.options,L,me)}destroyInnerAnimations(R){let L=this.driver.query(R,ne,!0);L.forEach(G=>this.destroyActiveAnimationsForElement(G)),0!=this.playersByQueriedElement.size&&(L=this.driver.query(R,xe,!0),L.forEach(G=>this.finishActiveQueriedAnimationOnElement(G)))}destroyActiveAnimationsForElement(R){const L=this.playersByElement.get(R);L&&L.forEach(G=>{G.queued?G.markedForDestroy=!0:G.destroy()})}finishActiveQueriedAnimationOnElement(R){const L=this.playersByQueriedElement.get(R);L&&L.forEach(G=>G.finish())}whenRenderingDone(){return new Promise(R=>{if(this.players.length)return un(this.players).onDone(()=>R());R()})}processLeaveNode(R){const L=R[Gr];if(L&&L.setForRemoval){if(R[Gr]=pr,L.namespaceId){this.destroyInnerAnimations(R);const G=this._fetchNamespace(L.namespaceId);G&&G.clearElementCache(R)}this._onRemovalComplete(R,L.setForRemoval)}R.classList?.contains(ro)&&this.markElementAsDisabled(R,!1),this.driver.query(R,".ng-animate-disabled",!0).forEach(G=>{this.markElementAsDisabled(G,!1)})}flush(R=-1){let L=[];if(this.newHostElements.size&&(this.newHostElements.forEach((G,se)=>this._balanceNamespaceList(G,se)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let G=0;G<this.collectedEnterElements.length;G++)sr(this.collectedEnterElements[G],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const G=[];try{L=this._flushAnimations(G,R)}finally{for(let se=0;se<G.length;se++)G[se]()}}else for(let G=0;G<this.collectedLeaveElements.length;G++)this.processLeaveNode(this.collectedLeaveElements[G]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(G=>G()),this._flushFns=[],this._whenQuietFns.length){const G=this._whenQuietFns;this._whenQuietFns=[],L.length?un(L).onDone(()=>{G.forEach(se=>se())}):G.forEach(se=>se())}}reportError(R){throw function Ot(ie){return new W.vHH(3402,!1)}()}_flushAnimations(R,L){const G=new ki,se=[],me=new Map,Oe=[],Ue=new Map,st=new Map,mt=new Map,xn=new Set;this.disabledNodes.forEach(I=>{xn.add(I);const H=this.driver.query(I,".ng-animate-queued",!0);for(let pe=0;pe<H.length;pe++)xn.add(H[pe])});const Sn=this.bodyNode,ci=Array.from(this.statesByElement.keys()),oi=ds(ci,this.collectedEnterElements),Un=new Map;let Jn=0;oi.forEach((I,H)=>{const pe=cr+Jn++;Un.set(H,pe),I.forEach(We=>sr(We,pe))});const Ni=[],xi=new Set,gr=new Set;for(let I=0;I<this.collectedLeaveElements.length;I++){const H=this.collectedLeaveElements[I],pe=H[Gr];pe&&pe.setForRemoval&&(Ni.push(H),xi.add(H),pe.hasAnimation?this.driver.query(H,".ng-star-inserted",!0).forEach(We=>xi.add(We)):gr.add(H))}const tr=new Map,Wn=ds(ci,Array.from(xi));Wn.forEach((I,H)=>{const pe=Ji+Jn++;tr.set(H,pe),I.forEach(We=>sr(We,pe))}),R.push(()=>{oi.forEach((I,H)=>{const pe=Un.get(H);I.forEach(We=>Ao(We,pe))}),Wn.forEach((I,H)=>{const pe=tr.get(H);I.forEach(We=>Ao(We,pe))}),Ni.forEach(I=>{this.processLeaveNode(I)})});const dr=[],Si=[];for(let I=this._namespaceList.length-1;I>=0;I--)this._namespaceList[I].drainQueuedTransitions(L).forEach(pe=>{const We=pe.player,en=pe.element;if(dr.push(We),this.collectedEnterElements.length){const Zt=en[Gr];if(Zt&&Zt.setForMove){if(Zt.previousTriggersValues&&Zt.previousTriggersValues.has(pe.triggerName)){const Nr=Zt.previousTriggersValues.get(pe.triggerName),qr=this.statesByElement.get(pe.element);if(qr&&qr.has(pe.triggerName)){const oa=qr.get(pe.triggerName);oa.value=Nr,qr.set(pe.triggerName,oa)}}return void We.destroy()}}const Ln=!Sn||!this.driver.containsElement(Sn,en),zn=tr.get(en),Gi=Un.get(en),Ti=this._buildInstruction(pe,G,Gi,zn,Ln);if(Ti.errors&&Ti.errors.length)return void Si.push(Ti);if(Ln)return We.onStart(()=>Fn(en,Ti.fromStyles)),We.onDestroy(()=>gn(en,Ti.toStyles)),void se.push(We);if(pe.isFallbackTransition)return We.onStart(()=>Fn(en,Ti.fromStyles)),We.onDestroy(()=>gn(en,Ti.toStyles)),void se.push(We);const Xs=[];Ti.timelines.forEach(Zt=>{Zt.stretchStartingKeyframe=!0,this.disabledNodes.has(Zt.element)||Xs.push(Zt)}),Ti.timelines=Xs,G.append(en,Ti.timelines),Oe.push({instruction:Ti,player:We,element:en}),Ti.queriedElements.forEach(Zt=>Ht(Ue,Zt,[]).push(We)),Ti.preStyleProps.forEach((Zt,Nr)=>{if(Zt.size){let qr=st.get(Nr);qr||st.set(Nr,qr=new Set),Zt.forEach((oa,Ma)=>qr.add(Ma))}}),Ti.postStyleProps.forEach((Zt,Nr)=>{let qr=mt.get(Nr);qr||mt.set(Nr,qr=new Set),Zt.forEach((oa,Ma)=>qr.add(Ma))})});if(Si.length){const I=[];Si.forEach(H=>{I.push(function ei(ie,R){return new W.vHH(3505,!1)}())}),dr.forEach(H=>H.destroy()),this.reportError(I)}const br=new Map,N=new Map;Oe.forEach(I=>{const H=I.element;G.has(H)&&(N.set(H,H),this._beforeAnimationBuild(I.player.namespaceId,I.instruction,br))}),se.forEach(I=>{const H=I.element;this._getPreviousPlayers(H,!1,I.namespaceId,I.triggerName,null).forEach(We=>{Ht(br,H,[]).push(We),We.destroy()})});const J=Ni.filter(I=>vo(I,st,mt)),j=new Map;Ms(j,this.driver,gr,mt,Xe.l3).forEach(I=>{vo(I,st,mt)&&J.push(I)});const Ae=new Map;oi.forEach((I,H)=>{Ms(Ae,this.driver,new Set(I),st,Xe.k1)}),J.forEach(I=>{const H=j.get(I),pe=Ae.get(I);j.set(I,new Map([...Array.from(H?.entries()??[]),...Array.from(pe?.entries()??[])]))});const et=[],x=[],E={};Oe.forEach(I=>{const{element:H,player:pe,instruction:We}=I;if(G.has(H)){if(xn.has(H))return pe.onDestroy(()=>gn(H,We.toStyles)),pe.disabled=!0,pe.overrideTotalTime(We.totalTime),void se.push(pe);let en=E;if(N.size>1){let zn=H;const Gi=[];for(;zn=zn.parentNode;){const Ti=N.get(zn);if(Ti){en=Ti;break}Gi.push(zn)}Gi.forEach(Ti=>N.set(Ti,en))}const Ln=this._buildAnimation(pe.namespaceId,We,br,me,Ae,j);if(pe.setRealPlayer(Ln),en===E)et.push(pe);else{const zn=this.playersByElement.get(en);zn&&zn.length&&(pe.parentPlayer=un(zn)),se.push(pe)}}else Fn(H,We.fromStyles),pe.onDestroy(()=>gn(H,We.toStyles)),x.push(pe),xn.has(H)&&se.push(pe)}),x.forEach(I=>{const H=me.get(I.element);if(H&&H.length){const pe=un(H);I.setRealPlayer(pe)}}),se.forEach(I=>{I.parentPlayer?I.syncPlayerEvents(I.parentPlayer):I.destroy()});for(let I=0;I<Ni.length;I++){const H=Ni[I],pe=H[Gr];if(Ao(H,Ji),pe&&pe.hasAnimation)continue;let We=[];if(Ue.size){let Ln=Ue.get(H);Ln&&Ln.length&&We.push(...Ln);let zn=this.driver.query(H,xe,!0);for(let Gi=0;Gi<zn.length;Gi++){let Ti=Ue.get(zn[Gi]);Ti&&Ti.length&&We.push(...Ti)}}const en=We.filter(Ln=>!Ln.destroyed);en.length?vr(this,H,en):this.processLeaveNode(H)}return Ni.length=0,et.forEach(I=>{this.players.push(I),I.onDone(()=>{I.destroy();const H=this.players.indexOf(I);this.players.splice(H,1)}),I.play()}),et}elementContainsData(R,L){let G=!1;const se=L[Gr];return se&&se.setForRemoval&&(G=!0),this.playersByElement.has(L)&&(G=!0),this.playersByQueriedElement.has(L)&&(G=!0),this.statesByElement.has(L)&&(G=!0),this._fetchNamespace(R).elementContainsData(L)||G}afterFlush(R){this._flushFns.push(R)}afterFlushAnimationsDone(R){this._whenQuietFns.push(R)}_getPreviousPlayers(R,L,G,se,me){let Oe=[];if(L){const Ue=this.playersByQueriedElement.get(R);Ue&&(Oe=Ue)}else{const Ue=this.playersByElement.get(R);if(Ue){const st=!me||me==qs;Ue.forEach(mt=>{mt.queued||!st&&mt.triggerName!=se||Oe.push(mt)})}}return(G||se)&&(Oe=Oe.filter(Ue=>!(G&&G!=Ue.namespaceId||se&&se!=Ue.triggerName))),Oe}_beforeAnimationBuild(R,L,G){const me=L.element,Oe=L.isRemovalTransition?void 0:R,Ue=L.isRemovalTransition?void 0:L.triggerName;for(const st of L.timelines){const mt=st.element,xn=mt!==me,Sn=Ht(G,mt,[]);this._getPreviousPlayers(mt,xn,Oe,Ue,L.toState).forEach(oi=>{const Un=oi.getRealPlayer();Un.beforeDestroy&&Un.beforeDestroy(),oi.destroy(),Sn.push(oi)})}Fn(me,L.fromStyles)}_buildAnimation(R,L,G,se,me,Oe){const Ue=L.triggerName,st=L.element,mt=[],xn=new Set,Sn=new Set,ci=L.timelines.map(Un=>{const Jn=Un.element;xn.add(Jn);const Ni=Jn[Gr];if(Ni&&Ni.removedBeforeQueried)return new Xe.ZN(Un.duration,Un.delay);const xi=Jn!==st,gr=function Oo(ie){const R=[];return uo(ie,R),R}((G.get(Jn)||ea).map(br=>br.getRealPlayer())).filter(br=>!!br.element&&br.element===Jn),tr=me.get(Jn),Wn=Oe.get(Jn),dr=Hn(0,this._normalizer,0,Un.keyframes,tr,Wn),Si=this._buildPlayer(Un,dr,gr);if(Un.subTimeline&&se&&Sn.add(Jn),xi){const br=new Jo(R,Ue,Jn);br.setRealPlayer(Si),mt.push(br)}return Si});mt.forEach(Un=>{Ht(this.playersByQueriedElement,Un.element,[]).push(Un),Un.onDone(()=>function Oi(ie,R,L){let G=ie.get(R);if(G){if(G.length){const se=G.indexOf(L);G.splice(se,1)}0==G.length&&ie.delete(R)}return G}(this.playersByQueriedElement,Un.element,Un))}),xn.forEach(Un=>sr(Un,ae));const oi=un(ci);return oi.onDestroy(()=>{xn.forEach(Un=>Ao(Un,ae)),gn(st,L.toStyles)}),Sn.forEach(Un=>{Ht(se,Un,[]).push(oi)}),oi}_buildPlayer(R,L,G){return L.length>0?this.driver.animate(R.element,L,R.duration,R.delay,R.easing,G):new Xe.ZN(R.duration,R.delay)}}class Jo{constructor(R,L,G){this.namespaceId=R,this.triggerName=L,this.element=G,this._player=new Xe.ZN,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(R){this._containsRealPlayer||(this._player=R,this._queuedCallbacks.forEach((L,G)=>{L.forEach(se=>ui(R,G,void 0,se))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(R.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(R){this.totalTime=R}syncPlayerEvents(R){const L=this._player;L.triggerCallback&&R.onStart(()=>L.triggerCallback("start")),R.onDone(()=>this.finish()),R.onDestroy(()=>this.destroy())}_queueEvent(R,L){Ht(this._queuedCallbacks,R,[]).push(L)}onDone(R){this.queued&&this._queueEvent("done",R),this._player.onDone(R)}onStart(R){this.queued&&this._queueEvent("start",R),this._player.onStart(R)}onDestroy(R){this.queued&&this._queueEvent("destroy",R),this._player.onDestroy(R)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(R){this.queued||this._player.setPosition(R)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(R){const L=this._player;L.triggerCallback&&L.triggerCallback(R)}}function yo(ie){return ie&&1===ie.nodeType}function ws(ie,R){const L=ie.style.display;return ie.style.display=R??"none",L}function Ms(ie,R,L,G,se){const me=[];L.forEach(st=>me.push(ws(st)));const Oe=[];G.forEach((st,mt)=>{const xn=new Map;st.forEach(Sn=>{const ci=R.computeStyle(mt,Sn,se);xn.set(Sn,ci),(!ci||0==ci.length)&&(mt[Gr]=da,Oe.push(mt))}),ie.set(mt,xn)});let Ue=0;return L.forEach(st=>ws(st,me[Ue++])),Oe}function ds(ie,R){const L=new Map;if(ie.forEach(Ue=>L.set(Ue,[])),0==R.length)return L;const G=1,se=new Set(R),me=new Map;function Oe(Ue){if(!Ue)return G;let st=me.get(Ue);if(st)return st;const mt=Ue.parentNode;return st=L.has(mt)?mt:se.has(mt)?G:Oe(mt),me.set(Ue,st),st}return R.forEach(Ue=>{const st=Oe(Ue);st!==G&&L.get(st).push(Ue)}),L}function sr(ie,R){ie.classList?.add(R)}function Ao(ie,R){ie.classList?.remove(R)}function vr(ie,R,L){un(L).onDone(()=>ie.processLeaveNode(R))}function uo(ie,R){for(let L=0;L<ie.length;L++){const G=ie[L];G instanceof Xe.ZE?uo(G.players,R):R.push(G)}}function vo(ie,R,L){const G=L.get(ie);if(!G)return!1;let se=R.get(ie);return se?G.forEach(me=>se.add(me)):R.set(ie,G),L.delete(ie),!0}class Is{constructor(R,L,G){this.bodyNode=R,this._driver=L,this._normalizer=G,this._triggerCache={},this.onRemovalComplete=(se,me)=>{},this._transitionEngine=new fa(R,L,G),this._timelineEngine=new Gs(R,L,G),this._transitionEngine.onRemovalComplete=(se,me)=>this.onRemovalComplete(se,me)}registerTrigger(R,L,G,se,me){const Oe=R+"-"+se;let Ue=this._triggerCache[Oe];if(!Ue){const st=[],mt=[],xn=Wo(this._driver,me,st,mt);if(st.length)throw function zt(ie,R){return new W.vHH(3404,!1)}();Ue=function Xr(ie,R,L){return new us(ie,R,L)}(se,xn,this._normalizer),this._triggerCache[Oe]=Ue}this._transitionEngine.registerTrigger(L,se,Ue)}register(R,L){this._transitionEngine.register(R,L)}destroy(R,L){this._transitionEngine.destroy(R,L)}onInsert(R,L,G,se){this._transitionEngine.insertNode(R,L,G,se)}onRemove(R,L,G,se){this._transitionEngine.removeNode(R,L,se||!1,G)}disableAnimations(R,L){this._transitionEngine.markElementAsDisabled(R,L)}process(R,L,G,se){if("@"==G.charAt(0)){const[me,Oe]=zi(G);this._timelineEngine.command(me,L,Oe,se)}else this._transitionEngine.trigger(R,L,G,se)}listen(R,L,G,se,me){if("@"==G.charAt(0)){const[Oe,Ue]=zi(G);return this._timelineEngine.listen(Oe,L,Ue,me)}return this._transitionEngine.listen(R,L,G,se,me)}flush(R=-1){this._transitionEngine.flush(R)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let mr=(()=>{class ie{constructor(L,G,se){this._element=L,this._startStyles=G,this._endStyles=se,this._state=0;let me=ie.initialStylesByElement.get(L);me||ie.initialStylesByElement.set(L,me=new Map),this._initialStyles=me}start(){this._state<1&&(this._startStyles&&gn(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(gn(this._element,this._initialStyles),this._endStyles&&(gn(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(ie.initialStylesByElement.delete(this._element),this._startStyles&&(Fn(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Fn(this._element,this._endStyles),this._endStyles=null),gn(this._element,this._initialStyles),this._state=3)}}return ie.initialStylesByElement=new WeakMap,ie})();function Ws(ie){let R=null;return ie.forEach((L,G)=>{(function Ps(ie){return"display"===ie||"position"===ie})(G)&&(R=R||new Map,R.set(G,L))}),R}class Ir{constructor(R,L,G,se){this.element=R,this.keyframes=L,this.options=G,this._specialStyles=se,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=G.duration,this._delay=G.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(R=>R()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const R=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,R,this.options),this._finalKeyframe=R.length?R[R.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(R){const L=[];return R.forEach(G=>{L.push(Object.fromEntries(G))}),L}_triggerWebAnimation(R,L,G){return R.animate(this._convertKeyframesToObject(L),G)}onStart(R){this._originalOnStartFns.push(R),this._onStartFns.push(R)}onDone(R){this._originalOnDoneFns.push(R),this._onDoneFns.push(R)}onDestroy(R){this._onDestroyFns.push(R)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(R=>R()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(R=>R()),this._onDestroyFns=[])}setPosition(R){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=R*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const R=new Map;this.hasStarted()&&this._finalKeyframe.forEach((G,se)=>{"offset"!==se&&R.set(se,this._finished?G:Co(this.element,se))}),this.currentSnapshot=R}triggerCallback(R){const L="start"===R?this._onStartFns:this._onDoneFns;L.forEach(G=>G()),L.length=0}}class mi{validateStyleProperty(R){return!0}validateAnimatableStyleProperty(R){return!0}matchesElement(R,L){return!1}containsElement(R,L){return Zi(R,L)}getParentElement(R){return Wt(R)}query(R,L,G){return jt(R,L,G)}computeStyle(R,L,G){return window.getComputedStyle(R)[L]}animate(R,L,G,se,me,Oe=[]){const st={duration:G,delay:se,fill:0==se?"both":"forwards"};me&&(st.easing=me);const mt=new Map,xn=Oe.filter(oi=>oi instanceof Ir);(function po(ie,R){return 0===ie||0===R})(G,se)&&xn.forEach(oi=>{oi.currentSnapshot.forEach((Un,Jn)=>mt.set(Jn,Un))});let Sn=function je(ie){return ie.length?ie[0]instanceof Map?ie:ie.map(R=>Ce(R)):[]}(L).map(oi=>ut(oi));Sn=function Yr(ie,R,L){if(L.size&&R.length){let G=R[0],se=[];if(L.forEach((me,Oe)=>{G.has(Oe)||se.push(Oe),G.set(Oe,me)}),se.length)for(let me=1;me<R.length;me++){let Oe=R[me];se.forEach(Ue=>Oe.set(Ue,Co(ie,Ue)))}}return R}(R,Sn,mt);const ci=function Sa(ie,R){let L=null,G=null;return Array.isArray(R)&&R.length?(L=Ws(R[0]),R.length>1&&(G=Ws(R[R.length-1]))):R instanceof Map&&(L=Ws(R)),L||G?new mr(ie,L,G):null}(R,Sn);return new Ir(R,Sn,st,ci)}}var Pr=Te(6895);let bs=(()=>{class ie extends Xe._j{constructor(L,G){super(),this._nextAnimationId=0,this._renderer=L.createRenderer(G.body,{id:"0",encapsulation:W.ifc.None,styles:[],data:{animation:[]}})}build(L){const G=this._nextAnimationId.toString();this._nextAnimationId++;const se=Array.isArray(L)?(0,Xe.vP)(L):L;return Fo(this._renderer,null,G,"register",[se]),new xr(G,this._renderer)}}return ie.\u0275fac=function(L){return new(L||ie)(W.LFG(W.FYo),W.LFG(Pr.K0))},ie.\u0275prov=W.Yz7({token:ie,factory:ie.\u0275fac}),ie})();class xr extends Xe.LC{constructor(R,L){super(),this._id=R,this._renderer=L}create(R,L){return new Aa(this._id,R,L||{},this._renderer)}}class Aa{constructor(R,L,G,se){this.id=R,this.element=L,this._renderer=se,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",G)}_listen(R,L){return this._renderer.listen(this.element,`@@${this.id}:${R}`,L)}_command(R,...L){return Fo(this._renderer,this.element,this.id,R,L)}onDone(R){this._listen("done",R)}onStart(R){this._listen("start",R)}onDestroy(R){this._listen("destroy",R)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(R){this._command("setPosition",R)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function Fo(ie,R,L,G,se){return ie.setProperty(R,`@@${L}:${G}`,se)}const ho="@.disabled";let pa=(()=>{class ie{constructor(L,G,se){this.delegate=L,this.engine=G,this._zone=se,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),G.onRemovalComplete=(me,Oe)=>{const Ue=Oe?.parentNode(me);Ue&&Oe.removeChild(Ue,me)}}createRenderer(L,G){const me=this.delegate.createRenderer(L,G);if(!(L&&G&&G.data&&G.data.animation)){let xn=this._rendererCache.get(me);return xn||(xn=new ks("",me,this.engine,()=>this._rendererCache.delete(me)),this._rendererCache.set(me,xn)),xn}const Oe=G.id,Ue=G.id+"-"+this._currentId;this._currentId++,this.engine.register(Ue,L);const st=xn=>{Array.isArray(xn)?xn.forEach(st):this.engine.registerTrigger(Oe,Ue,L,xn.name,xn)};return G.data.animation.forEach(st),new Xn(this,Ue,me,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(L,G,se){L>=0&&L<this._microtaskId?this._zone.run(()=>G(se)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(me=>{const[Oe,Ue]=me;Oe(Ue)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([G,se]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return ie.\u0275fac=function(L){return new(L||ie)(W.LFG(W.FYo),W.LFG(Is),W.LFG(W.R0b))},ie.\u0275prov=W.Yz7({token:ie,factory:ie.\u0275fac}),ie})();class ks{constructor(R,L,G,se){this.namespaceId=R,this.delegate=L,this.engine=G,this._onDestroy=se,this.destroyNode=this.delegate.destroyNode?me=>L.destroyNode(me):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),this._onDestroy?.()}createElement(R,L){return this.delegate.createElement(R,L)}createComment(R){return this.delegate.createComment(R)}createText(R){return this.delegate.createText(R)}appendChild(R,L){this.delegate.appendChild(R,L),this.engine.onInsert(this.namespaceId,L,R,!1)}insertBefore(R,L,G,se=!0){this.delegate.insertBefore(R,L,G),this.engine.onInsert(this.namespaceId,L,R,se)}removeChild(R,L,G){this.engine.onRemove(this.namespaceId,L,this.delegate,G)}selectRootElement(R,L){return this.delegate.selectRootElement(R,L)}parentNode(R){return this.delegate.parentNode(R)}nextSibling(R){return this.delegate.nextSibling(R)}setAttribute(R,L,G,se){this.delegate.setAttribute(R,L,G,se)}removeAttribute(R,L,G){this.delegate.removeAttribute(R,L,G)}addClass(R,L){this.delegate.addClass(R,L)}removeClass(R,L){this.delegate.removeClass(R,L)}setStyle(R,L,G,se){this.delegate.setStyle(R,L,G,se)}removeStyle(R,L,G){this.delegate.removeStyle(R,L,G)}setProperty(R,L,G){"@"==L.charAt(0)&&L==ho?this.disableAnimations(R,!!G):this.delegate.setProperty(R,L,G)}setValue(R,L){this.delegate.setValue(R,L)}listen(R,L,G){return this.delegate.listen(R,L,G)}disableAnimations(R,L){this.engine.disableAnimations(R,L)}}class Xn extends ks{constructor(R,L,G,se,me){super(L,G,se,me),this.factory=R,this.namespaceId=L}setProperty(R,L,G){"@"==L.charAt(0)?"."==L.charAt(1)&&L==ho?this.disableAnimations(R,G=void 0===G||!!G):this.engine.process(this.namespaceId,R,L.slice(1),G):this.delegate.setProperty(R,L,G)}listen(R,L,G){if("@"==L.charAt(0)){const se=function Ki(ie){switch(ie){case"body":return document.body;case"document":return document;case"window":return window;default:return ie}}(R);let me=L.slice(1),Oe="";return"@"!=me.charAt(0)&&([me,Oe]=function Ha(ie){const R=ie.indexOf(".");return[ie.substring(0,R),ie.slice(R+1)]}(me)),this.engine.listen(this.namespaceId,se,me,Oe,Ue=>{this.factory.scheduleListenerCallback(Ue._data||-1,G,Ue)})}return this.delegate.listen(R,L,G)}}const Fa=[{provide:Xe._j,useClass:bs},{provide:ca,useFactory:function ta(){return new to}},{provide:Is,useClass:(()=>{class ie extends Is{constructor(L,G,se,me){super(L.body,G,se)}ngOnDestroy(){this.flush()}}return ie.\u0275fac=function(L){return new(L||ie)(W.LFG(Pr.K0),W.LFG(Ri),W.LFG(ca),W.LFG(W.z2F))},ie.\u0275prov=W.Yz7({token:ie,factory:ie.\u0275fac}),ie})()},{provide:W.FYo,useFactory:function na(ie,R,L){return new pa(ie,R,L)},deps:[Y.se,Is,W.R0b]}],Zs=[{provide:Ri,useFactory:()=>new mi},{provide:W.QbO,useValue:"BrowserAnimations"},...Fa],ps=[{provide:Ri,useClass:Hi},{provide:W.QbO,useValue:"NoopAnimations"},...Fa];let Nt=(()=>{class ie{static withConfig(L){return{ngModule:ie,providers:L.disableAnimations?ps:Zs}}}return ie.\u0275fac=function(L){return new(L||ie)},ie.\u0275mod=W.oAB({type:ie}),ie.\u0275inj=W.cJS({providers:Zs,imports:[Y.b2]}),ie})();var hr=Te(529),es=Te(346);const xo=[{path:"mapas",loadChildren:()=>Promise.all([Te.e(592),Te.e(808)]).then(Te.bind(Te,2808)).then(ie=>ie.MapasModule)},{path:"auth",loadChildren:()=>Promise.all([Te.e(592),Te.e(415)]).then(Te.bind(Te,7429)).then(ie=>ie.AuthModule)},{path:"**",redirectTo:"mapas"}];let wr=(()=>{class ie{}return ie.\u0275fac=function(L){return new(L||ie)},ie.\u0275mod=W.oAB({type:ie}),ie.\u0275inj=W.cJS({imports:[es.Bz.forRoot(xo,{useHash:!1}),es.Bz]}),ie})();var ma=Te(9898),ga=Te(2340);let Es=(()=>{class ie{constructor(){this.title="Puntos_de_CyL"}ngOnInit(){ma.accessToken=ga.N.mapboxToken}}return ie.\u0275fac=function(L){return new(L||ie)},ie.\u0275cmp=W.Xpm({type:ie,selectors:[["app-root"]],decls:1,vars:0,template:function(L,G){1&L&&W._UZ(0,"router-outlet")},dependencies:[es.lC]}),ie})(),_a=(()=>{class ie{}return ie.\u0275fac=function(L){return new(L||ie)},ie.\u0275mod=W.oAB({type:ie}),ie.\u0275inj=W.cJS({imports:[Pr.ez]}),ie})();var ia=Te(7277);let oo=(()=>{class ie{}return ie.\u0275fac=function(L){return new(L||ie)},ie.\u0275mod=W.oAB({type:ie,bootstrap:[Es]}),ie.\u0275inj=W.cJS({providers:[ia.h],imports:[Y.b2,wr,Nt,hr.JF,_a]}),ie})();var zo=Te(5226);if(!navigator.geolocation)throw Te.n(zo)().fire("Error","El navegador no soporta la Geolocalizaci\xf3n","error"),new Error("El navegador no soporta la Geolocalizaci\xf3n");Y.q6().bootstrapModule(oo).catch(ie=>console.error(ie))},9898:function(ii){ii.exports=function(){"use strict";var Ke,Te,Y;function W(c,Re){if(Ke)if(Te){var nn="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+Ke+")(sharedChunk); ("+Te+")(sharedChunk); self.onerror = null;",xt={};Ke(xt),Y=Re(xt),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(Y.workerUrl=window.URL.createObjectURL(new Blob([nn],{type:"text/javascript"})))}else Te=Re;else Ke=Re}return W(0,function(c){var Re=typeof self<"u"?self:{},nn="2.15.0";let xt;const Tt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==xt){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{xt=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch{xt=t}}return xt},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Tt.API_URL)return null;try{const t=new URL(Tt.API_URL);return"api.mapbox.cn"===t.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===t.hostname?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Et={supported:!1,testSupport:function(t){!Qt&&_t&&(An?It(t):At=t)}};let At,_t,Qt=!1,An=!1;function It(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,_t),t.isContextLost())return;Et.supported=!0}catch{}t.deleteTexture(e),Qt=!0}Re.document&&(_t=Re.document.createElement("img"),_t.onload=function(){At&&It(At),At=null,An=!0},_t.onerror=function(){Qt=!0,At=null},_t.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const bn="01";function Yt(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var Nn=pn;function pn(t,e,n,s){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=s}pn.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,s=0;s<8;s++){var u=this.sampleCurveX(n)-t;if(Math.abs(u)<e)return n;var f=this.sampleCurveDerivativeX(n);if(Math.abs(f)<1e-6)break;n-=u/f}var g=0,b=1;for(n=t,s=0;s<20&&(u=this.sampleCurveX(n),!(Math.abs(u-t)<e));s++)t>u?g=n:b=n,n=.5*(b-g)+g;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var rn=Yt(Nn),an=Pt;function Pt(t,e){this.x=t,this.y=e}Pt.prototype={clone:function(){return new Pt(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),s=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=s,this},_rotateAround:function(t,e){var n=Math.cos(t),s=Math.sin(t),u=e.y+s*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-s*(this.y-e.y),this.y=u,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Pt.convert=function(t){return t instanceof Pt?t:Array.isArray(t)?new Pt(t[0],t[1]):t};var Se=Yt(an);const fn=Math.PI/180,Zn=180/Math.PI;function tt(t){return t*fn}function kt(t){return t*Zn}const pt=[[0,0],[1,0],[1,1],[0,1]];function zt(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function En(t,e,n,s){const u=new rn(t,e,n,s);return function(f){return u.solve(f)}}const yi=En(.25,.1,.25,1);function Mt(t,e,n){return Math.min(n,Math.max(e,t))}function Bi(t,e,n){return(n=Mt((n-t)/(e-t),0,1))*n*(3-2*n)}function qe(t,e,n){const s=n-e,u=((t-e)%s+s)%s+e;return u===e?n:u}function at(t,e,n){if(!t.length)return n(null,[]);let s=t.length;const u=new Array(t.length);let f=null;t.forEach((g,b)=>{e(g,(S,A)=>{S&&(f=S),u[b]=A,0==--s&&n(f,u)})})}function bt(t){const e=[];for(const n in t)e.push(t[n]);return e}function Dt(t,...e){for(const n of e)for(const s in n)t[s]=n[s];return t}let Ut=1;function Ot(){return Ut++}function On(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function ei(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function ji(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function ln(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function Rn(t,e){return-1!==t.indexOf(e,t.length-e.length)}function un(t,e,n){const s={};for(const u in t)s[u]=e.call(n||this,t[u],u,t);return s}function Hn(t,e,n){const s={};for(const u in t)e.call(n||this,t[u],u,t)&&(s[u]=t[u]);return s}function ui(t){return Array.isArray(t)?t.map(ui):"object"==typeof t&&t?un(t,ui):t}const qn={};function hi(t){qn[t]||(typeof console<"u"&&console.warn(t),qn[t]=!0)}function Ht(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function zi(t){let e=0;for(let n,s,u=0,f=t.length,g=f-1;u<f;g=u++)n=t[u],s=t[g],e+=(s.x-n.x)*(n.y+s.y);return e}function li(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function Wi(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,s,u,f)=>{const g=u||f;return e[s]=!g||g.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let si=null;function Wt(t){if(null==si){const e=t.navigator?t.navigator.userAgent:null;si=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return si}function Ar(t){try{const e=Re[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function yr(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const ni="mapbox-tiles";let Vi,zr,os=500,lo=50;function Zi(){try{return Re.caches}catch{}}function jt(){Zi()&&!Vi&&(Vi=Re.caches.open(ni))}function ht(t){const e=t.indexOf("?");if(e<0)return t;const s=function(u){const f=u.indexOf("?");return f>0?u.slice(f+1).split("&"):[]}(t).filter(u=>{const f=u.split("=");return"language"===f[0]||"worldview"===f[0]});return s.length?`${t.slice(0,e)}?${s.join("&")}`:t.slice(0,e)}let Hi=1/0;const Ri={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Ri);class Yi extends Error{constructor(e,n,s){401===n&&fe(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Wr=li()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Re.location.protocol?Re.parent:Re).location.href,vi=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(Wr())&&!/^\w+:/.test(n))){if(Re.fetch&&Re.Request&&Re.AbortController&&Re.Request.prototype.hasOwnProperty("signal"))return function(s,u){const f=new Re.AbortController,g=new Re.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:Wr(),referrerPolicy:s.referrerPolicy,signal:f.signal});let b=!1,S=!1;const A=(O=g.url).indexOf("sku=")>0&&fe(O);var O;"json"===s.type&&g.headers.set("Accept","application/json");const z=(q,X,te)=>{if(S)return;if(q&&"SecurityError"!==q.message&&hi(q.toString()),X&&te)return V(X);const de=Date.now();Re.fetch(g).then(ye=>{if(ye.ok){const Ie=A?ye.clone():null;return V(ye,Ie,de)}return u(new Yi(ye.statusText,ye.status,s.url))}).catch(ye=>{"AbortError"!==ye.name&&u(new Error(`${ye.message} ${s.url}`))})},V=(q,X,te)=>{("arrayBuffer"===s.type?q.arrayBuffer():"json"===s.type?q.json():q.text()).then(de=>{S||(X&&te&&function(ye,Ie,ve){if(jt(),!Vi)return;const De={status:Ie.status,statusText:Ie.statusText,headers:new Re.Headers};Ie.headers.forEach((rt,Qe)=>De.headers.set(Qe,rt));const Fe=Wi(Ie.headers.get("Cache-Control")||"");if(Fe["no-store"])return;Fe["max-age"]&&De.headers.set("Expires",new Date(ve+1e3*Fe["max-age"]).toUTCString());const Le=De.headers.get("Expires");Le&&(new Date(Le).getTime()-ve<42e4||function(rt,Qe){if(void 0===zr)try{new Response(new ReadableStream),zr=!0}catch{zr=!1}zr?Qe(rt.body):rt.blob().then(Qe)}(Ie,rt=>{const Qe=new Re.Response(rt,De);jt(),Vi&&Vi.then(yt=>yt.put(ht(ye.url),Qe)).catch(yt=>hi(yt.message))}))}(g,X,te),b=!0,u(null,de,q.headers.get("Cache-Control"),q.headers.get("Expires")))}).catch(de=>{S||u(new Error(de.message))})};return A?function(q,X){if(jt(),!Vi)return X(null);const te=ht(q.url);Vi.then(de=>{de.match(te).then(ye=>{const Ie=function(ve){if(!ve)return!1;const De=new Date(ve.headers.get("Expires")||0),Fe=Wi(ve.headers.get("Cache-Control")||"");return De>Date.now()&&!Fe["no-cache"]}(ye);de.delete(te),Ie&&de.put(te,ye.clone()),X(null,ye,Ie)}).catch(X)}).catch(X)}(g,z):z(null,null),{cancel:()=>{S=!0,b||f.abort()}}}(t,e);if(li()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(s,u){const f=new Re.XMLHttpRequest;f.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(f.responseType="arraybuffer");for(const g in s.headers)f.setRequestHeader(g,s.headers[g]);return"json"===s.type&&(f.responseType="text",f.setRequestHeader("Accept","application/json")),f.withCredentials="include"===s.credentials,f.onerror=()=>{u(new Error(f.statusText))},f.onload=()=>{if((f.status>=200&&f.status<300||0===f.status)&&null!==f.response){let g=f.response;if("json"===s.type)try{g=JSON.parse(f.response)}catch(b){return u(b)}u(null,g,f.getResponseHeader("Cache-Control"),f.getResponseHeader("Expires"))}else u(new Yi(f.statusText,f.status,s.url))},f.send(s.body),{cancel:()=>f.abort()}}(t,e)},cr=function(t,e){return vi(Dt(t,{type:"arrayBuffer"}),e)};function Ji(t){const e=Re.document.createElement("a");return e.href=t,e.protocol===Re.document.location.protocol&&e.host===Re.document.location.host}const Ee="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let ne,ae;ne=[],ae=0;const xe=function(t,e){if(Et.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),ae>=Tt.MAX_PARALLEL_IMAGE_REQUESTS){const f={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return ne.push(f),f}ae++;let n=!1;const s=()=>{if(!n)for(n=!0,ae--;ne.length&&ae<Tt.MAX_PARALLEL_IMAGE_REQUESTS;){const f=ne.shift(),{requestParameters:g,callback:b,cancelled:S}=f;S||(f.cancel=xe(g,b).cancel)}},u=cr(t,(f,g,b,S)=>{s(),f?e(f):g&&(Re.createImageBitmap?function(A,O){const z=new Re.Blob([new Uint8Array(A)],{type:"image/png"});Re.createImageBitmap(z).then(V=>{O(null,V)}).catch(V=>{O(new Error(`Could not load image because of ${V.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(g,(A,O)=>e(A,O,b,S)):function(A,O){const z=new Re.Image,V=Re.URL;z.onload=()=>{O(null,z),V.revokeObjectURL(z.src),z.onload=null,Re.requestAnimationFrame(()=>{z.src=Ee})},z.onerror=()=>O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const q=new Re.Blob([new Uint8Array(A)],{type:"image/png"});z.src=A.byteLength?V.createObjectURL(q):Ee}(g,(A,O)=>e(A,O,b,S)))});return{cancel:()=>{u.cancel(),s()}}},Me="NO_ACCESS_TOKEN";function ze(t){return 0===t.indexOf("mapbox:")}function fe(t){return Tt.API_URL_REGEX.test(t)}function oe(t){return Tt.API_CDN_URL_REGEX.test(t)}function re(t){return Tt.API_STYLE_REGEX.test(t)&&!Ce(t)}function Ce(t){return Tt.API_SPRITE_REGEX.test(t)}const je=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ye(t){const e=t.match(je);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ut(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}const Dn="mapbox.eventData";function cn(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Re.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class gn{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=cn(Tt.ACCESS_TOKEN);let s="";return s=n&&n.u?Re.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(u,f)=>String.fromCharCode(Number("0x"+f)))):Tt.ACCESS_TOKEN||"",e?`${Dn}.${e}:${s}`:`${Dn}:${s}`}fetchEventData(){const e=Ar("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const u=Re.localStorage.getItem(n);u&&(this.eventData=JSON.parse(u));const f=Re.localStorage.getItem(s);f&&(this.anonId=f)}catch{hi("Unable to read from LocalStorage")}}saveEventData(){const e=Ar("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{Re.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&Re.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{hi("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,s,u){if(!Tt.EVENTS_URL)return;const f=Ye(Tt.EVENTS_URL);f.params.push(`access_token=${u||Tt.ACCESS_TOKEN||""}`);const g={event:this.type,created:new Date(e).toISOString()},b=n?Dt(g,n):g,S={url:ut(f),headers:{"Content-Type":"text/plain"},body:JSON.stringify([b])};var O;this.pendingRequest=(O=A=>{this.pendingRequest=null,s(A),this.saveEventData(),this.processRequests(u)},vi(Dt(S,{method:"POST"}),O))}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const Fn=new class extends gn{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){Tt.EVENTS_URL&&Tt.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>ze(n)||fe(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=cn(Tt.ACCESS_TOKEN),n=e?e.u:Tt.ACCESS_TOKEN;let s=n!==this.eventData.tokenU;ji(this.anonId)||(this.anonId=On(),s=!0);const u=this.queue.shift();if(this.eventData.lastSuccess){const f=new Date(this.eventData.lastSuccess),g=new Date(u),b=(u-this.eventData.lastSuccess)/864e5;s=s||b>=1||b<-1||f.getDate()!==g.getDate()}else s=!0;s?this.postEvent(u,{sdkIdentifier:"mapbox-gl-js",sdkVersion:nn,skuId:bn,"enabled.telemetry":!1,userId:this.anonId},f=>{f||(this.eventData.lastSuccess=u,this.eventData.tokenU=n)},t):this.processRequests()}},Ve=Fn.postTurnstileEvent.bind(Fn),Ne=new class extends gn{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,s){this.skuToken=e,this.errorCb=s,Tt.EVENTS_URL&&(n||Tt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Me)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),ji(this.anonId)||(this.anonId=On()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:nn,skuId:bn,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t))}},ge=Ne.postMapLoadEvent.bind(Ne),$e=new class extends gn{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){Tt.EVENTS_URL&&(t||Tt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:n}=this.queue.shift(),s=function(u){const f=Re.performance.getEntriesByType("resource"),g=Re.performance.getEntriesByType("mark"),b=function(V){const q={};if(V)for(const X in V)if("other"!==X)for(const te of V[X]){const de=`${X}ResolveRangeMin`,ye=`${X}ResolveRangeMax`,Ie=`${X}RequestCount`,ve=`${X}RequestCachedCount`;q[de]=Math.min(q[de]||1/0,te.startTime),q[ye]=Math.max(q[ye]||-1/0,te.responseEnd);const De=Fe=>{void 0===q[Fe]&&(q[Fe]=0),++q[Fe]};void 0!==te.transferSize&&0===te.transferSize&&De(ve),De(Ie)}return q}(function(V,q){const X={};if(V)for(const te of V){const de=q(te);void 0===X[de]&&(X[de]=[]),X[de].push(te)}return X}(f,Yr)),S=Re.devicePixelRatio,A=Re.navigator.connection||Re.navigator.mozConnection||Re.navigator.webkitConnection,O={counters:[],metadata:[],attributes:[]},z=(V,q,X)=>{null!=X&&V.push({name:q,value:X.toString()})};for(const V in b)z(O.counters,V,b[V]);if(u.interactionRange[0]!==1/0&&u.interactionRange[1]!==-1/0&&(z(O.counters,"interactionRangeMin",u.interactionRange[0]),z(O.counters,"interactionRangeMax",u.interactionRange[1])),g)for(const V of Object.keys(Ai)){const q=Ai[V],X=g.find(te=>te.name===q);X&&z(O.counters,q,X.startTime)}return z(O.counters,"visibilityHidden",u.visibilityHidden),z(O.attributes,"style",function(V){if(V)for(const q of V){const X=q.name.split("?")[0];if(re(X)){const te=X.split("/").slice(-2);if(2===te.length)return`mapbox://styles/${te[0]}/${te[1]}`}}}(f)),z(O.attributes,"terrainEnabled",u.terrainEnabled?"true":"false"),z(O.attributes,"fogEnabled",u.fogEnabled?"true":"false"),z(O.attributes,"projection",u.projection),z(O.attributes,"zoom",u.zoom),z(O.metadata,"devicePixelRatio",S),z(O.metadata,"connectionEffectiveType",A?A.effectiveType:void 0),z(O.metadata,"navigatorUserAgent",Re.navigator.userAgent),z(O.metadata,"screenWidth",Re.screen.width),z(O.metadata,"screenHeight",Re.screen.height),z(O.metadata,"windowWidth",Re.innerWidth),z(O.metadata,"windowHeight",Re.innerHeight),z(O.metadata,"mapWidth",u.width/S),z(O.metadata,"mapHeight",u.height/S),z(O.metadata,"webglRenderer",u.renderer),z(O.metadata,"webglVendor",u.vendor),z(O.metadata,"sdkVersion",nn),z(O.metadata,"sdkIdentifier","mapbox-gl-js"),O}(n);for(const u of s.metadata);for(const u of s.counters);for(const u of s.attributes);this.postEvent(e,s,()=>{},t)}},dt=$e.postPerformanceEvent.bind($e),on=new class extends gn{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,s){if(!Tt.API_URL||!Tt.SESSION_PATH)return;const u=Ye(Tt.API_URL+Tt.SESSION_PATH);u.params.push(`sku=${e||""}`),u.params.push(`access_token=${s||Tt.ACCESS_TOKEN||""}`);const f={url:ut(u),headers:{"Content-Type":"text/plain"}};var b;this.pendingRequest=(b=g=>{this.pendingRequest=null,n(g),this.saveEventData(),this.processRequests(s)},vi(Dt(f,{method:"GET"}),b))}getSessionAPI(t,e,n,s){this.skuToken=e,this.errorCb=s,Tt.SESSION_PATH&&Tt.API_URL&&(n||Tt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(Me)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t)}},_n=on.getSessionAPI.bind(on),Tn=new Set,Ai={create:"create",load:"load",fullLoad:"fullLoad"},po={mark(t){Re.performance.mark(t)},measure(t,e,n){Re.performance.measure(t,e,n)}};function Yr(t){const e=t.name.split("?")[0];return oe(e)&&e.includes("mapbox-gl.js")?"javascript":oe(e)&&e.includes("mapbox-gl.css")?"css":Tt.API_FONTS_REGEX.test(e)?"fontRange":Ce(e)?"sprite":re(e)?"style":Tt.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const Cn=Re.performance;function Co(t){const e=t?t.url.toString():void 0;return Cn.getEntriesByName(e)}let Do,vs,ss,mo;const as={now:()=>void 0!==ss?ss:Re.performance.now(),setNow(t){ss=t},restoreNow(){ss=void 0},frame(t){const e=Re.requestAnimationFrame(t);return{cancel:()=>Re.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:n,height:s}=t;mo||(mo=Re.document.createElement("canvas"));const u=mo.getContext("2d",{willReadFrequently:!0});if(!u)throw new Error("failed to create canvas 2d context");return(n>mo.width||s>mo.height)&&(mo.width=n,mo.height=s),u.clearRect(-e,-e,n+2*e,s+2*e),u.drawImage(t,0,0,n,s),u.getImageData(-e,-e,n+2*e,s+2*e)},resolveURL:t=>(Do||(Do=Re.document.createElement("a")),Do.href=t,Do.href),get devicePixelRatio(){return Re.devicePixelRatio},get prefersReducedMotion(){return!!Re.matchMedia&&(null==vs&&(vs=Re.matchMedia("(prefers-reduced-motion: reduce)")),vs.matches)}};function Ho(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function Go(t,e,n){if(n&&n[t]){const s=n[t].indexOf(e);-1!==s&&n[t].splice(s,1)}}class qo{constructor(e,n={}){Dt(this,n),this.type=e}}class go extends qo{constructor(e,n={}){super("error",Dt({error:e},n))}}class $s{on(e,n){return this._listeners=this._listeners||{},Ho(e,n,this._listeners),this}off(e,n){return Go(e,n,this._listeners),Go(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Ho(e,n,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,n){"string"==typeof e&&(e=new qo(e,n||{}));const s=e.type;if(this.listens(s)){e.target=this;const u=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const b of u)b.call(this,e);const f=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const b of f)Go(s,b,this._oneTimeListeners),b.call(this,e);const g=this._eventedParent;g&&(Dt(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),g.fire(e))}else e instanceof go&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var ft=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"requires":["fill-extrusion-edge-radius"],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function ti(t,...e){for(const n of e)for(const s in n)t[s]=n[s];return t}function ai(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function bi(t){if(Array.isArray(t))return t.map(bi);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=bi(t[n]);return e}return ai(t)}class ls extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var ir=ls;class Wo{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[s,u]of n)this.bindings[s]=u}concat(e){return new Wo(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Po=Wo;const Zo={kind:"null"},tn={kind:"number"},Ft={kind:"string"},hn={kind:"boolean"},Mi={kind:"color"},Qi={kind:"object"},In={kind:"value"},Ii={kind:"collator"},So={kind:"formatted"},ki={kind:"resolvedImage"};function Vr(t,e){return{kind:"array",itemType:t,N:e}}function Li(t){if("array"===t.kind){const e=Li(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const Yn=[Zo,tn,Ft,hn,Mi,So,Qi,Vr(In),ki];function co(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!co(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const n of Yn)if(!co(n,e))return null}return`Expected ${Li(t)} but found ${Li(e)} instead.`}function Zr(t,e){return e.some(n=>n.kind===t.kind)}function Xo(t,e){return e.some(n=>"null"===n?null===t:"array"===n?Array.isArray(t):"object"===n?t&&!Array.isArray(t)&&"object"==typeof t:n===typeof t)}var fr,Xi={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function ko(t){return(t=Math.round(t))<0?0:t>255?255:t}function Jr(t){return ko("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function _o(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function Ro(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{fr={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in Xi)return Xi[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=n.indexOf("("),u=n.indexOf(")");if(-1!==s&&u+1===n.length){var f=n.substr(0,s),g=n.substr(s+1,u-(s+1)).split(","),b=1;switch(f){case"rgba":if(4!==g.length)return null;b=_o(g.pop());case"rgb":return 3!==g.length?null:[Jr(g[0]),Jr(g[1]),Jr(g[2]),b];case"hsla":if(4!==g.length)return null;b=_o(g.pop());case"hsl":if(3!==g.length)return null;var S=(parseFloat(g[0])%360+360)%360/360,A=_o(g[1]),O=_o(g[2]),z=O<=.5?O*(A+1):O+A-O*A,V=2*O-z;return[ko(255*Ro(V,z,S+1/3)),ko(255*Ro(V,z,S)),ko(255*Ro(V,z,S-1/3)),b];default:return null}}return null}}catch{}class Qr{constructor(e,n,s,u=1){this.r=e,this.g=n,this.b=s,this.a=u}static parse(e){if(!e)return;if(e instanceof Qr)return e;if("string"!=typeof e)return;const n=fr(e);return n?new Qr(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,s,u]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(s)},${u})`}toArray(){const{r:e,g:n,b:s,a:u}=this;return 0===u?[0,0,0,0]:[255*e/u,255*n/u,255*s/u,u]}toArray01(){const{r:e,g:n,b:s,a:u}=this;return 0===u?[0,0,0,0]:[e/u,n/u,s/u,u]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:s,a:u}=this;return[e,n,s,u]}}Qr.black=new Qr(0,0,0,1),Qr.white=new Qr(1,1,1,1),Qr.transparent=new Qr(0,0,0,0),Qr.red=new Qr(1,0,0,1),Qr.blue=new Qr(0,0,1,1);var ri=Qr;class ca{constructor(e,n,s){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class ua{constructor(e,n,s,u,f){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=s,this.fontStack=u,this.textColor=f}}class eo{constructor(e){this.sections=e}static fromString(e){return new eo([new ua(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof eo?e:eo.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);const s={};n.fontStack&&(s["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(s["font-scale"]=n.scale),n.textColor&&(s["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(s)}return e}}class to{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new to({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Hs(t,e,n,s){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[t,e,n,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[t,e,n,s]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function no(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof ri||t instanceof ca||t instanceof eo||t instanceof to)return!0;if(Array.isArray(t)){for(const e of t)if(!no(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!no(t[e]))return!1;return!0}return!1}function Ei(t){if(null===t)return Zo;if("string"==typeof t)return Ft;if("boolean"==typeof t)return hn;if("number"==typeof t)return tn;if(t instanceof ri)return Mi;if(t instanceof ca)return Ii;if(t instanceof eo)return So;if(t instanceof to)return ki;if(Array.isArray(t)){const e=t.length;let n;for(const s of t){const u=Ei(s);if(n){if(n===u)continue;n=In;break}n=u}return Vr(n||In,e)}return Qi}function cs(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof ri||t instanceof eo||t instanceof to?t.toString():JSON.stringify(t)}class io{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(2!==e.length)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!no(e[1]))return n.error("invalid value");const s=e[1];let u=Ei(s);const f=n.expectedType;return"array"!==u.kind||0!==u.N||!f||"array"!==f.kind||"number"==typeof f.N&&0!==f.N||(u=f),new io(u,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ri?["rgba"].concat(this.value.toArray()):this.value instanceof eo?this.value.serialize():this.value}}var $r=io,Mr=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const Xr={string:Ft,number:tn,boolean:hn,object:Qi};class us{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s,u=1;const f=e[0];if("array"===f){let b,S;if(e.length>2){const A=e[1];if("string"!=typeof A||!(A in Xr)||"object"===A)return n.error('The item type argument of "array" must be one of string, number, boolean',1);b=Xr[A],u++}else b=In;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);S=e[2],u++}s=Vr(b,S)}else s=Xr[f];const g=[];for(;u<e.length;u++){const b=n.parse(e[u],u,In);if(!b)return null;g.push(b)}return new us(s,g)}evaluate(e){for(let n=0;n<this.args.length;n++){const s=this.args[n].evaluate(e);if(!co(this.type,Ei(s)))return s;if(n===this.args.length-1)throw new Mr(`Expected value to be of type ${Li(this.type)}, but found ${Li(Ei(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if("array"===e.kind){const s=e.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){n.push(s.kind);const u=e.N;("number"==typeof u||this.args.length>1)&&n.push(u)}}return n.concat(this.args.map(s=>s.serialize()))}}var ur=us;class Hr{constructor(e){this.type=So,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&"object"==typeof s)return n.error("First argument must be an image or text section.");const u=[];let f=!1;for(let g=1;g<=e.length-1;++g){const b=e[g];if(f&&"object"==typeof b&&!Array.isArray(b)){f=!1;let S=null;if(b["font-scale"]&&(S=n.parse(b["font-scale"],1,tn),!S))return null;let A=null;if(b["text-font"]&&(A=n.parse(b["text-font"],1,Vr(Ft)),!A))return null;let O=null;if(b["text-color"]&&(O=n.parse(b["text-color"],1,Mi),!O))return null;const z=u[u.length-1];z.scale=S,z.font=A,z.textColor=O}else{const S=n.parse(e[g],1,In);if(!S)return null;const A=S.type.kind;if("string"!==A&&"value"!==A&&"null"!==A&&"resolvedImage"!==A)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");f=!0,u.push({content:S,scale:null,font:null,textColor:null})}}return new Hr(u)}evaluate(e){return new eo(this.sections.map(n=>{const s=n.content.evaluate(e);return Ei(s)===ki?new ua("",s,null,null,null):new ua(cs(s),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const s={};n.scale&&(s["font-scale"]=n.scale.serialize()),n.font&&(s["text-font"]=n.font.serialize()),n.textColor&&(s["text-color"]=n.textColor.serialize()),e.push(s)}return e}}class Ko{constructor(e){this.type=ki,this.input=e}static parse(e,n){if(2!==e.length)return n.error("Expected two arguments.");const s=n.parse(e[1],1,Ft);return s?new Ko(s):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),s=to.fromString(n);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(n)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Gs={"to-boolean":hn,"to-color":Mi,"to-number":tn,"to-string":Ft};class hs{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[0];if(("to-boolean"===s||"to-string"===s)&&2!==e.length)return n.error("Expected one argument.");const u=Gs[s],f=[];for(let g=1;g<e.length;g++){const b=n.parse(e[g],g,In);if(!b)return null;f.push(b)}return new hs(u,f)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let n,s;for(const u of this.args){if(n=u.evaluate(e),s=null,n instanceof ri)return n;if("string"==typeof n){const f=e.parseColor(n);if(f)return f}else if(Array.isArray(n)&&(s=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Hs(n[0],n[1],n[2],n[3]),!s))return new ri(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Mr(s||`Could not parse color from value '${"string"==typeof n?n:String(JSON.stringify(n))}'`)}if("number"===this.type.kind){let n=null;for(const s of this.args){if(n=s.evaluate(e),null===n)return 0;const u=Number(n);if(!isNaN(u))return u}throw new Mr(`Could not convert ${JSON.stringify(n)} to number.`)}return"formatted"===this.type.kind?eo.fromString(cs(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?to.fromString(cs(this.args[0].evaluate(e))):cs(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Hr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ko(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var ha=hs;const ro=["Unknown","Point","LineString","Polygon"];var Ca=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?ro[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(s*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=ri.parse(t)),e}};class Ss{constructor(e,n,s,u){this.name=e,this.type=n,this._evaluate=s,this.args=u}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const s=e[0],u=Ss.definitions[s];if(!u)return n.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const f=Array.isArray(u)?u[0]:u.type,g=Array.isArray(u)?[[u[1],u[2]]]:u.overloads,b=g.filter(([A])=>!Array.isArray(A)||A.length===e.length-1);let S=null;for(const[A,O]of b){S=new Sa(n.registry,n.path,null,n.scope);const z=[];let V=!1;for(let q=1;q<e.length;q++){const X=e[q],te=Array.isArray(A)?A[q-1]:A.type,de=S.parse(X,1+z.length,te);if(!de){V=!0;break}z.push(de)}if(!V)if(Array.isArray(A)&&A.length!==z.length)S.error(`Expected ${A.length} arguments, but found ${z.length} instead.`);else{for(let q=0;q<z.length;q++){const X=Array.isArray(A)?A[q]:A.type,te=z[q];S.concat(q+1).checkSubtype(X,te.type)}if(0===S.errors.length)return new Ss(s,f,O,z)}}if(1===b.length)n.errors.push(...S.errors);else{const A=(b.length?b:g).map(([z])=>{return V=z,Array.isArray(V)?`(${V.map(Li).join(", ")})`:`(${Li(V.type)}...)`;var V}).join(" | "),O=[];for(let z=1;z<e.length;z++){const V=n.parse(e[z],1+O.length);if(!V)return null;O.push(Li(V.type))}n.error(`Expected arguments of type ${A}, but found (${O.join(", ")}) instead.`)}return null}static register(e,n){Ss.definitions=n;for(const s in n)e[s]=Ss}}var Lo=Ss;class ea{constructor(e,n,s){this.type=Ii,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(2!==e.length)return n.error("Expected one argument.");const s=e[1];if("object"!=typeof s||Array.isArray(s))return n.error("Collator options argument must be an object.");const u=n.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,hn);if(!u)return null;const f=n.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,hn);if(!f)return null;let g=null;return s.locale&&(g=n.parse(s.locale,1,Ft),!g)?null:new ea(u,f,g)}evaluate(e){return new ca(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const pr=8192;function da(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Gr(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function As(t,e){const n=(180+t[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,u=Math.pow(2,e.z);return[Math.round(n*u*pr),Math.round(s*u*pr)]}function qs(t,e,n){const s=t[0]-e[0],u=t[1]-e[1],f=t[0]-n[0],g=t[1]-n[1];return s*g-f*u==0&&s*f<=0&&u*g<=0}function Yo(t,e){let n=!1;for(let g=0,b=e.length;g<b;g++){const S=e[g];for(let A=0,O=S.length;A<O-1;A++){if(qs(t,S[A],S[A+1]))return!1;(u=S[A])[1]>(s=t)[1]!=(f=S[A+1])[1]>s[1]&&s[0]<(f[0]-u[0])*(s[1]-u[1])/(f[1]-u[1])+u[0]&&(n=!n)}}var s,u,f;return n}function xs(t,e){for(let n=0;n<e.length;n++)if(Yo(t,e[n]))return!0;return!1}function fa(t,e,n,s){const u=s[0]-n[0],f=s[1]-n[1],g=(t[0]-n[0])*f-u*(t[1]-n[1]),b=(e[0]-n[0])*f-u*(e[1]-n[1]);return g>0&&b<0||g<0&&b>0}function Jo(t,e,n){for(const A of n)for(let O=0;O<A.length-1;++O)if((b=[(g=A[O+1])[0]-(f=A[O])[0],g[1]-f[1]])[0]*(S=[(u=e)[0]-(s=t)[0],u[1]-s[1]])[1]-b[1]*S[0]!=0&&fa(s,u,f,g)&&fa(f,g,s,u))return!0;var s,u,f,g,b,S;return!1}function Oi(t,e){for(let n=0;n<t.length;++n)if(!Yo(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Jo(t[n],t[n+1],e))return!1;return!0}function Ya(t,e){for(let n=0;n<e.length;n++)if(Oi(t,e[n]))return!0;return!1}function yo(t,e,n){const s=[];for(let u=0;u<t.length;u++){const f=[];for(let g=0;g<t[u].length;g++){const b=As(t[u][g],n);da(e,b),f.push(b)}s.push(f)}return s}function Oa(t,e,n){const s=[];for(let u=0;u<t.length;u++){const f=yo(t[u],e,n);s.push(f)}return s}function ws(t,e,n,s){if(t[0]<n[0]||t[0]>n[2]){const u=.5*s;let f=t[0]-n[0]>u?-s:n[0]-t[0]>u?s:0;0===f&&(f=t[0]-n[2]>u?-s:n[2]-t[0]>u?s:0),t[0]+=f}da(e,t)}function Ms(t,e,n,s){const u=Math.pow(2,s.z)*pr,f=[s.x*pr,s.y*pr],g=[];if(!t)return g;for(const b of t)for(const S of b){const A=[S.x+f[0],S.y+f[1]];ws(A,e,n,u),g.push(A)}return g}function ds(t,e,n,s){const u=Math.pow(2,s.z)*pr,f=[s.x*pr,s.y*pr],g=[];if(!t)return g;for(const S of t){const A=[];for(const O of S){const z=[O.x+f[0],O.y+f[1]];da(e,z),A.push(z)}g.push(A)}if(e[2]-e[0]<=u/2){(b=e)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const S of g)for(const A of S)ws(A,e,n,u)}var b;return g}class sr{constructor(e,n){this.type=hn,this.geojson=e,this.geometries=n}static parse(e,n){if(2!==e.length)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(no(e[1])){const s=e[1];if("FeatureCollection"===s.type)for(let u=0;u<s.features.length;++u){const f=s.features[u].geometry.type;if("Polygon"===f||"MultiPolygon"===f)return new sr(s,s.features[u].geometry)}else if("Feature"===s.type){const u=s.geometry.type;if("Polygon"===u||"MultiPolygon"===u)return new sr(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new sr(s,s)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(n,s){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(!g)return!1;if("Polygon"===s.type){const b=yo(s.coordinates,f,g),S=Ms(n.geometry(),u,f,g);if(!Gr(u,f))return!1;for(const A of S)if(!Yo(A,b))return!1}if("MultiPolygon"===s.type){const b=Oa(s.coordinates,f,g),S=Ms(n.geometry(),u,f,g);if(!Gr(u,f))return!1;for(const A of S)if(!xs(A,b))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(n,s){const u=[1/0,1/0,-1/0,-1/0],f=[1/0,1/0,-1/0,-1/0],g=n.canonicalID();if(!g)return!1;if("Polygon"===s.type){const b=yo(s.coordinates,f,g),S=ds(n.geometry(),u,f,g);if(!Gr(u,f))return!1;for(const A of S)if(!Oi(A,b))return!1}if("MultiPolygon"===s.type){const b=Oa(s.coordinates,f,g),S=ds(n.geometry(),u,f,g);if(!Gr(u,f))return!1;for(const A of S)if(!Ya(A,b))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Ao=sr;function vr(t){if(t instanceof Lo&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof Ao)return!1;let e=!0;return t.eachChild(n=>{e&&!vr(n)&&(e=!1)}),e}function Oo(t){if(t instanceof Lo&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(n=>{e&&!Oo(n)&&(e=!1)}),e}function uo(t,e){if(t instanceof Lo&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(s=>{n&&!uo(s,e)&&(n=!1)}),n}class Da{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(2!==e.length||"string"!=typeof e[1])return n.error("'var' expression requires exactly one string literal argument.");const s=e[1];return n.scope.has(s)?new Da(s,n.scope.get(s)):n.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var vo=Da;class Is{constructor(e,n=[],s,u=new Po,f=[]){this.registry=e,this.path=n,this.key=n.map(g=>`[${g}]`).join(""),this.scope=u,this.errors=f,this.expectedType=s}parse(e,n,s,u,f={}){return n?this.concat(n,s,u)._parse(e,f):this._parse(e,f)}_parse(e,n){function s(u,f,g){return"assert"===g?new ur(f,[u]):"coerce"===g?new ha(f,[u]):u}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const u=e[0];if("string"!=typeof u)return this.error(`Expression name must be a string, but found ${typeof u} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const f=this.registry[u];if(f){let g=f.parse(e,this);if(!g)return null;if(this.expectedType){const b=this.expectedType,S=g.type;if("string"!==b.kind&&"number"!==b.kind&&"boolean"!==b.kind&&"object"!==b.kind&&"array"!==b.kind||"value"!==S.kind)if("color"!==b.kind&&"formatted"!==b.kind&&"resolvedImage"!==b.kind||"value"!==S.kind&&"string"!==S.kind){if(this.checkSubtype(b,S))return null}else g=s(g,b,n.typeAnnotation||"coerce");else g=s(g,b,n.typeAnnotation||"assert")}if(!(g instanceof $r)&&"resolvedImage"!==g.type.kind&&mr(g)){const b=new Ca;try{g=new $r(g.type,g.evaluate(b))}catch(S){return this.error(S.message),null}}return g}return this.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,s){const u="number"==typeof e?this.path.concat(e):this.path,f=s?this.scope.concat(s):this.scope;return new Is(this.registry,u,n||null,f,this.errors)}error(e,...n){const s=`${this.key}${n.map(u=>`[${u}]`).join("")}`;this.errors.push(new ir(s,e))}checkSubtype(e,n){const s=co(e,n);return s&&this.error(s),s}}var Sa=Is;function mr(t){if(t instanceof vo)return mr(t.boundExpression);if(t instanceof Lo&&"error"===t.name||t instanceof ea||t instanceof Ao)return!1;const e=t instanceof ha||t instanceof ur;let n=!0;return t.eachChild(s=>{n=e?n&&mr(s):n&&s instanceof $r}),!!n&&vr(t)&&uo(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ws(t,e){const n=t.length-1;let s,u,f=0,g=n,b=0;for(;f<=g;)if(b=Math.floor((f+g)/2),s=t[b],u=t[b+1],s<=e){if(b===n||e<u)return b;f=b+1}else{if(!(s>e))throw new Mr("Input is not a number.");g=b-1}return 0}class Ps{constructor(e,n,s){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[u,f]of s)this.labels.push(u),this.outputs.push(f)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const s=n.parse(e[1],1,tn);if(!s)return null;const u=[];let f=null;n.expectedType&&"value"!==n.expectedType.kind&&(f=n.expectedType);for(let g=1;g<e.length;g+=2){const b=1===g?-1/0:e[g],S=e[g+1],A=g,O=g+1;if("number"!=typeof b)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',A);if(u.length&&u[u.length-1][0]>=b)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',A);const z=n.parse(S,O,f);if(!z)return null;f=f||z.type,u.push([b,z])}return new Ps(f,s,u)}evaluate(e){const n=this.labels,s=this.outputs;if(1===n.length)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return s[0].evaluate(e);const f=n.length;return u>=n[f-1]?s[f-1].evaluate(e):s[Ws(n,u)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var Ir=Ps;function mi(t,e,n){return t*(1-n)+e*n}var Pr=Object.freeze({__proto__:null,array:function(t,e,n){return t.map((s,u)=>mi(s,e[u],n))},color:function(t,e,n){return new ri(mi(t.r,e.r,n),mi(t.g,e.g,n),mi(t.b,e.b,n),mi(t.a,e.a,n))},number:mi});const bs=.95047,xr=1.08883,Aa=4/29,Fo=6/29,Bo=3*Fo*Fo,ho=Fo*Fo*Fo,pa=Math.PI/180,ks=180/Math.PI;function Xn(t){return t>ho?Math.pow(t,1/3):t/Bo+Aa}function Ki(t){return t>Fo?t*t*t:Bo*(t-Aa)}function Ha(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function fs(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function ta(t){const e=fs(t.r),n=fs(t.g),s=fs(t.b),u=Xn((.4124564*e+.3575761*n+.1804375*s)/bs),f=Xn((.2126729*e+.7151522*n+.072175*s)/1);return{l:116*f-16,a:500*(u-f),b:200*(f-Xn((.0193339*e+.119192*n+.9503041*s)/xr)),alpha:t.a}}function na(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,s=isNaN(t.b)?e:e-t.b/200;return e=1*Ki(e),n=bs*Ki(n),s=xr*Ki(s),new ri(Ha(3.2404542*n-1.5371385*e-.4985314*s),Ha(-.969266*n+1.8760108*e+.041556*s),Ha(.0556434*n-.2040259*e+1.0572252*s),t.alpha)}function Fa(t,e,n){const s=e-t;return t+n*(s>180||s<-180?s-360*Math.round(s/360):s)}const Zs={forward:ta,reverse:na,interpolate:function(t,e,n){return{l:mi(t.l,e.l,n),a:mi(t.a,e.a,n),b:mi(t.b,e.b,n),alpha:mi(t.alpha,e.alpha,n)}}},ps={forward:function(t){const{l:e,a:n,b:s}=ta(t),u=Math.atan2(s,n)*ks;return{h:u<0?u+360:u,c:Math.sqrt(n*n+s*s),l:e,alpha:t.a}},reverse:function(t){const e=t.h*pa,n=t.c;return na({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:Fa(t.h,e.h,n),c:mi(t.c,e.c,n),l:mi(t.l,e.l,n),alpha:mi(t.alpha,e.alpha,n)}}};var Nt=Object.freeze({__proto__:null,hcl:ps,lab:Zs});class Pi{constructor(e,n,s,u,f){this.type=e,this.operator=n,this.interpolation=s,this.input=u,this.labels=[],this.outputs=[];for(const[g,b]of f)this.labels.push(g),this.outputs.push(b)}static interpolationFactor(e,n,s,u){let f=0;if("exponential"===e.name)f=Ba(n,e.base,s,u);else if("linear"===e.name)f=Ba(n,1,s,u);else if("cubic-bezier"===e.name){const g=e.controlPoints;f=new rn(g[0],g[1],g[2],g[3]).solve(Ba(n,1,s,u))}return f}static parse(e,n){let[s,u,f,...g]=e;if(!Array.isArray(u)||0===u.length)return n.error("Expected an interpolation type expression.",1);if("linear"===u[0])u={name:"linear"};else if("exponential"===u[0]){const A=u[1];if("number"!=typeof A)return n.error("Exponential interpolation requires a numeric base.",1,1);u={name:"exponential",base:A}}else{if("cubic-bezier"!==u[0])return n.error(`Unknown interpolation type ${String(u[0])}`,1,0);{const A=u.slice(1);if(4!==A.length||A.some(O=>"number"!=typeof O||O<0||O>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);u={name:"cubic-bezier",controlPoints:A}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(f=n.parse(f,2,tn),!f)return null;const b=[];let S=null;"interpolate-hcl"===s||"interpolate-lab"===s?S=Mi:n.expectedType&&"value"!==n.expectedType.kind&&(S=n.expectedType);for(let A=0;A<g.length;A+=2){const O=g[A],z=g[A+1],V=A+3,q=A+4;if("number"!=typeof O)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',V);if(b.length&&b[b.length-1][0]>=O)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',V);const X=n.parse(z,q,S);if(!X)return null;S=S||X.type,b.push([O,X])}return"number"===S.kind||"color"===S.kind||"array"===S.kind&&"number"===S.itemType.kind&&"number"==typeof S.N?new Pi(S,s,u,f,b):n.error(`Type ${Li(S)} is not interpolatable.`)}evaluate(e){const n=this.labels,s=this.outputs;if(1===n.length)return s[0].evaluate(e);const u=this.input.evaluate(e);if(u<=n[0])return s[0].evaluate(e);const f=n.length;if(u>=n[f-1])return s[f-1].evaluate(e);const g=Ws(n,u),b=Pi.interpolationFactor(this.interpolation,u,n[g],n[g+1]),S=s[g].evaluate(e),A=s[g+1].evaluate(e);return"interpolate"===this.operator?Pr[this.type.kind.toLowerCase()](S,A,b):"interpolate-hcl"===this.operator?ps.reverse(ps.interpolate(ps.forward(S),ps.forward(A),b)):Zs.reverse(Zs.interpolate(Zs.forward(S),Zs.forward(A),b))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)n.push(this.labels[s],this.outputs[s].serialize());return n}}function Ba(t,e,n,s){const u=s-n,f=t-n;return 0===u?0:1===e?f/u:(Math.pow(e,f)-1)/(Math.pow(e,u)-1)}var Qo=Pi;class hr{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let s=null;const u=n.expectedType;u&&"value"!==u.kind&&(s=u);const f=[];for(const b of e.slice(1)){const S=n.parse(b,1+f.length,s,void 0,{typeAnnotation:"omit"});if(!S)return null;s=s||S.type,f.push(S)}const g=u&&f.some(b=>co(u,b.type));return new hr(g?In:s,f)}evaluate(e){let n,s=null,u=0;for(const f of this.args){if(u++,s=f.evaluate(e),s&&s instanceof to&&!s.available&&(n||(n=s),s=null,u===this.args.length))return n;if(null!==s)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var es=hr;class xo{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let f=1;f<e.length-1;f+=2){const g=e[f];if("string"!=typeof g)return n.error(`Expected string, but found ${typeof g} instead.`,f);if(/[^a-zA-Z0-9_]/.test(g))return n.error("Variable names must contain only alphanumeric characters or '_'.",f);const b=n.parse(e[f+1],f+1);if(!b)return null;s.push([g,b])}const u=n.parse(e[e.length-1],e.length-1,n.expectedType,s);return u?new xo(s,u):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,s]of this.bindings)e.push(n,s.serialize());return e.push(this.result.serialize()),e}}var wr=xo;class ma{constructor(e,n,s){this.type=e,this.index=n,this.input=s}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,tn),u=n.parse(e[2],2,Vr(n.expectedType||In));return s&&u?new ma(u.type.itemType,s,u):null}evaluate(e){const n=this.index.evaluate(e),s=this.input.evaluate(e);if(n<0)throw new Mr(`Array index out of bounds: ${n} < 0.`);if(n>=s.length)throw new Mr(`Array index out of bounds: ${n} > ${s.length-1}.`);if(n!==Math.floor(n))throw new Mr(`Array index must be an integer, but found ${n} instead.`);return s[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var ga=ma;class Es{constructor(e,n){this.type=hn,this.needle=e,this.haystack=n}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,In),u=n.parse(e[2],2,In);return s&&u?Zr(s.type,[hn,Ft,tn,Zo,In])?new Es(s,u):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Li(s.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(null==s)return!1;if(!Xo(n,["boolean","string","number","null"]))throw new Mr(`Expected first argument to be of type boolean, string, number or null, but found ${Li(Ei(n))} instead.`);if(!Xo(s,["string","array"]))throw new Mr(`Expected second argument to be of type array or string, but found ${Li(Ei(s))} instead.`);return s.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var _a=Es;class ia{constructor(e,n,s){this.type=tn,this.needle=e,this.haystack=n,this.fromIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,In),u=n.parse(e[2],2,In);if(!s||!u)return null;if(!Zr(s.type,[hn,Ft,tn,Zo,In]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Li(s.type)} instead`);if(4===e.length){const f=n.parse(e[3],3,tn);return f?new ia(s,u,f):null}return new ia(s,u)}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!Xo(n,["boolean","string","number","null"]))throw new Mr(`Expected first argument to be of type boolean, string, number or null, but found ${Li(Ei(n))} instead.`);if(!Xo(s,["string","array"]))throw new Mr(`Expected second argument to be of type array or string, but found ${Li(Ei(s))} instead.`);if(this.fromIndex){const u=this.fromIndex.evaluate(e);return s.indexOf(n,u)}return s.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var oo=ia;class zo{constructor(e,n,s,u,f,g){this.inputType=e,this.type=n,this.input=s,this.cases=u,this.outputs=f,this.otherwise=g}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let s,u;n.expectedType&&"value"!==n.expectedType.kind&&(u=n.expectedType);const f={},g=[];for(let A=2;A<e.length-1;A+=2){let O=e[A];const z=e[A+1];Array.isArray(O)||(O=[O]);const V=n.concat(A);if(0===O.length)return V.error("Expected at least one branch label.");for(const X of O){if("number"!=typeof X&&"string"!=typeof X)return V.error("Branch labels must be numbers or strings.");if("number"==typeof X&&Math.abs(X)>Number.MAX_SAFE_INTEGER)return V.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof X&&Math.floor(X)!==X)return V.error("Numeric branch labels must be integer values.");if(s){if(V.checkSubtype(s,Ei(X)))return null}else s=Ei(X);if(void 0!==f[String(X)])return V.error("Branch labels must be unique.");f[String(X)]=g.length}const q=n.parse(z,A,u);if(!q)return null;u=u||q.type,g.push(q)}const b=n.parse(e[1],1,In);if(!b)return null;const S=n.parse(e[e.length-1],e.length-1,u);return S?"value"!==b.type.kind&&n.concat(1).checkSubtype(s,b.type)?null:new zo(s,u,b,f,g,S):null}evaluate(e){const n=this.input.evaluate(e);return(Ei(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),s=[],u={};for(const g of n){const b=u[this.cases[g]];void 0===b?(u[this.cases[g]]=s.length,s.push([this.cases[g],[g]])):s[b][1].push(g)}const f=g=>"number"===this.inputType.kind?Number(g):g;for(const[g,b]of s)e.push(1===b.length?f(b[0]):b.map(f)),e.push(this.outputs[g].serialize());return e.push(this.otherwise.serialize()),e}}var ra=zo;class ie{constructor(e,n,s){this.type=e,this.branches=n,this.otherwise=s}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let s;n.expectedType&&"value"!==n.expectedType.kind&&(s=n.expectedType);const u=[];for(let g=1;g<e.length-1;g+=2){const b=n.parse(e[g],g,hn);if(!b)return null;const S=n.parse(e[g+1],g+1,s);if(!S)return null;u.push([b,S]),s=s||S.type}const f=n.parse(e[e.length-1],e.length-1,s);return f?new ie(s,u,f):null}evaluate(e){for(const[n,s]of this.branches)if(n.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,s]of this.branches)e(n),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var R=ie;class L{constructor(e,n,s,u){this.type=e,this.input=n,this.beginIndex=s,this.endIndex=u}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,In),u=n.parse(e[2],2,tn);if(!s||!u)return null;if(!Zr(s.type,[Vr(In),Ft,In]))return n.error(`Expected first argument to be of type array or string, but found ${Li(s.type)} instead`);if(4===e.length){const f=n.parse(e[3],3,tn);return f?new L(s.type,s,u,f):null}return new L(s.type,s,u)}evaluate(e){const n=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!Xo(n,["string","array"]))throw new Mr(`Expected first argument to be of type array or string, but found ${Li(Ei(n))} instead.`);if(this.endIndex){const u=this.endIndex.evaluate(e);return n.slice(s,u)}return n.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var G=L;function se(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function me(t,e,n,s){return 0===s.compare(e,n)}function Oe(t,e,n){const s="=="!==t&&"!="!==t;return class X0{constructor(f,g,b){this.type=hn,this.lhs=f,this.rhs=g,this.collator=b,this.hasUntypedArgument="value"===f.type.kind||"value"===g.type.kind}static parse(f,g){if(3!==f.length&&4!==f.length)return g.error("Expected two or three arguments.");const b=f[0];let S=g.parse(f[1],1,In);if(!S)return null;if(!se(b,S.type))return g.concat(1).error(`"${b}" comparisons are not supported for type '${Li(S.type)}'.`);let A=g.parse(f[2],2,In);if(!A)return null;if(!se(b,A.type))return g.concat(2).error(`"${b}" comparisons are not supported for type '${Li(A.type)}'.`);if(S.type.kind!==A.type.kind&&"value"!==S.type.kind&&"value"!==A.type.kind)return g.error(`Cannot compare types '${Li(S.type)}' and '${Li(A.type)}'.`);s&&("value"===S.type.kind&&"value"!==A.type.kind?S=new ur(A.type,[S]):"value"!==S.type.kind&&"value"===A.type.kind&&(A=new ur(S.type,[A])));let O=null;if(4===f.length){if("string"!==S.type.kind&&"string"!==A.type.kind&&"value"!==S.type.kind&&"value"!==A.type.kind)return g.error("Cannot use collator to compare non-string types.");if(O=g.parse(f[3],3,Ii),!O)return null}return new X0(S,A,O)}evaluate(f){const g=this.lhs.evaluate(f),b=this.rhs.evaluate(f);if(s&&this.hasUntypedArgument){const S=Ei(g),A=Ei(b);if(S.kind!==A.kind||"string"!==S.kind&&"number"!==S.kind)throw new Mr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${S.kind}, ${A.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const S=Ei(g),A=Ei(b);if("string"!==S.kind||"string"!==A.kind)return e(f,g,b)}return this.collator?n(f,g,b,this.collator.evaluate(f)):e(f,g,b)}eachChild(f){f(this.lhs),f(this.rhs),this.collator&&f(this.collator)}outputDefined(){return!0}serialize(){const f=[t];return this.eachChild(g=>{f.push(g.serialize())}),f}}}const Ue=Oe("==",function(t,e,n){return e===n},me),st=Oe("!=",function(t,e,n){return e!==n},function(t,e,n,s){return!me(0,e,n,s)}),mt=Oe("<",function(t,e,n){return e<n},function(t,e,n,s){return s.compare(e,n)<0}),xn=Oe(">",function(t,e,n){return e>n},function(t,e,n,s){return s.compare(e,n)>0}),Sn=Oe("<=",function(t,e,n){return e<=n},function(t,e,n,s){return s.compare(e,n)<=0}),ci=Oe(">=",function(t,e,n){return e>=n},function(t,e,n,s){return s.compare(e,n)>=0});class oi{constructor(e,n,s,u,f,g){this.type=Ft,this.number=e,this.locale=n,this.currency=s,this.unit=u,this.minFractionDigits=f,this.maxFractionDigits=g}static parse(e,n){if(3!==e.length)return n.error("Expected two arguments.");const s=n.parse(e[1],1,tn);if(!s)return null;const u=e[2];if("object"!=typeof u||Array.isArray(u))return n.error("NumberFormat options argument must be an object.");let f=null;if(u.locale&&(f=n.parse(u.locale,1,Ft),!f))return null;let g=null;if(u.currency&&(g=n.parse(u.currency,1,Ft),!g))return null;let b=null;if(u.unit&&(b=n.parse(u.unit,1,Ft),!b))return null;let S=null;if(u["min-fraction-digits"]&&(S=n.parse(u["min-fraction-digits"],1,tn),!S))return null;let A=null;return u["max-fraction-digits"]&&(A=n.parse(u["max-fraction-digits"],1,tn),!A)?null:new oi(s,f,g,b,S,A)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class Un{constructor(e){this.type=tn,this.input=e}static parse(e,n){if(2!==e.length)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=n.parse(e[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?n.error(`Expected argument of type string or array, but found ${Li(s.type)} instead.`):new Un(s):null}evaluate(e){const n=this.input.evaluate(e);if("string"==typeof n||Array.isArray(n))return n.length;throw new Mr(`Expected value to be of type string or array, but found ${Li(Ei(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}const Jn={"==":Ue,"!=":st,">":xn,"<":mt,">=":ci,"<=":Sn,array:ur,at:ga,boolean:ur,case:R,coalesce:es,collator:ea,format:Hr,image:Ko,in:_a,"index-of":oo,interpolate:Qo,"interpolate-hcl":Qo,"interpolate-lab":Qo,length:Un,let:wr,literal:$r,match:ra,number:ur,"number-format":oi,object:ur,slice:G,step:Ir,string:ur,"to-boolean":ha,"to-color":ha,"to-number":ha,"to-string":ha,var:vo,within:Ao};function Ni(t,[e,n,s,u]){e=e.evaluate(t),n=n.evaluate(t),s=s.evaluate(t);const f=u?u.evaluate(t):1,g=Hs(e,n,s,f);if(g)throw new Mr(g);return new ri(e/255*f,n/255*f,s/255*f,f)}function xi(t,e){return t in e}function gr(t,e){const n=e[t];return void 0===n?null:n}function tr(t){return{type:t}}Lo.register(Jn,{error:[{kind:"error"},[Ft],(t,[e])=>{throw new Mr(e.evaluate(t))}],typeof:[Ft,[In],(t,[e])=>Li(Ei(e.evaluate(t)))],"to-rgba":[Vr(tn,4),[Mi],(t,[e])=>e.evaluate(t).toArray()],rgb:[Mi,[tn,tn,tn],Ni],rgba:[Mi,[tn,tn,tn,tn],Ni],has:{type:hn,overloads:[[[Ft],(t,[e])=>xi(e.evaluate(t),t.properties())],[[Ft,Qi],(t,[e,n])=>xi(e.evaluate(t),n.evaluate(t))]]},get:{type:In,overloads:[[[Ft],(t,[e])=>gr(e.evaluate(t),t.properties())],[[Ft,Qi],(t,[e,n])=>gr(e.evaluate(t),n.evaluate(t))]]},"feature-state":[In,[Ft],(t,[e])=>gr(e.evaluate(t),t.featureState||{})],properties:[Qi,[],t=>t.properties()],"geometry-type":[Ft,[],t=>t.geometryType()],id:[In,[],t=>t.id()],zoom:[tn,[],t=>t.globals.zoom],pitch:[tn,[],t=>t.globals.pitch||0],"distance-from-center":[tn,[],t=>t.distanceFromCenter()],"heatmap-density":[tn,[],t=>t.globals.heatmapDensity||0],"line-progress":[tn,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[tn,[],t=>t.globals.skyRadialProgress||0],accumulated:[In,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[tn,tr(tn),(t,e)=>{let n=0;for(const s of e)n+=s.evaluate(t);return n}],"*":[tn,tr(tn),(t,e)=>{let n=1;for(const s of e)n*=s.evaluate(t);return n}],"-":{type:tn,overloads:[[[tn,tn],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[tn],(t,[e])=>-e.evaluate(t)]]},"/":[tn,[tn,tn],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[tn,[tn,tn],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[tn,[],()=>Math.LN2],pi:[tn,[],()=>Math.PI],e:[tn,[],()=>Math.E],"^":[tn,[tn,tn],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[tn,[tn],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[tn,[tn],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[tn,[tn],(t,[e])=>Math.log(e.evaluate(t))],log2:[tn,[tn],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[tn,[tn],(t,[e])=>Math.sin(e.evaluate(t))],cos:[tn,[tn],(t,[e])=>Math.cos(e.evaluate(t))],tan:[tn,[tn],(t,[e])=>Math.tan(e.evaluate(t))],asin:[tn,[tn],(t,[e])=>Math.asin(e.evaluate(t))],acos:[tn,[tn],(t,[e])=>Math.acos(e.evaluate(t))],atan:[tn,[tn],(t,[e])=>Math.atan(e.evaluate(t))],min:[tn,tr(tn),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[tn,tr(tn),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[tn,[tn],(t,[e])=>Math.abs(e.evaluate(t))],round:[tn,[tn],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[tn,[tn],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[tn,[tn],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[hn,[Ft,In],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[hn,[In],(t,[e])=>t.id()===e.value],"filter-type-==":[hn,[Ft],(t,[e])=>t.geometryType()===e.value],"filter-<":[hn,[Ft,In],(t,[e,n])=>{const s=t.properties()[e.value],u=n.value;return typeof s==typeof u&&s<u}],"filter-id-<":[hn,[In],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n<s}],"filter->":[hn,[Ft,In],(t,[e,n])=>{const s=t.properties()[e.value],u=n.value;return typeof s==typeof u&&s>u}],"filter-id->":[hn,[In],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n>s}],"filter-<=":[hn,[Ft,In],(t,[e,n])=>{const s=t.properties()[e.value],u=n.value;return typeof s==typeof u&&s<=u}],"filter-id-<=":[hn,[In],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n<=s}],"filter->=":[hn,[Ft,In],(t,[e,n])=>{const s=t.properties()[e.value],u=n.value;return typeof s==typeof u&&s>=u}],"filter-id->=":[hn,[In],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n>=s}],"filter-has":[hn,[In],(t,[e])=>e.value in t.properties()],"filter-has-id":[hn,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[hn,[Vr(Ft)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[hn,[Vr(In)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[hn,[Ft,Vr(In)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[hn,[Ft,Vr(In)],(t,[e,n])=>function(s,u,f,g){for(;f<=g;){const b=f+g>>1;if(u[b]===s)return!0;u[b]>s?g=b-1:f=b+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:hn,overloads:[[[hn,hn],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[tr(hn),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:hn,overloads:[[[hn,hn],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[tr(hn),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[hn,[hn],(t,[e])=>!e.evaluate(t)],"is-supported-script":[hn,[Ft],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Ft,[Ft],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Ft,[Ft],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Ft,tr(In),(t,e)=>e.map(n=>cs(n.evaluate(t))).join("")],"resolved-locale":[Ft,[Ii],(t,[e])=>e.evaluate(t).resolvedLocale()]});var Wn=Jn;function dr(t){return{result:"success",value:t}}function Si(t){return{result:"error",value:t}}function br(t){return"data-driven"===t["property-type"]}function N(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function J(t){return!!t.expression&&t.expression.interpolated}function j(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function ue(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function Ae(t){return t}function et(t,e){const n="color"===e.type,s=t.stops&&"object"==typeof t.stops[0][0],u=s||!(s||void 0!==t.property),f=t.type||(J(e)?"exponential":"interval");if(n&&((t=ti({},t)).stops&&(t.stops=t.stops.map(A=>[A[0],ri.parse(A[1])])),t.default=ri.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!Nt[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let g,b,S;if("exponential"===f)g=H;else if("interval"===f)g=I;else if("categorical"===f){g=E,b=Object.create(null);for(const A of t.stops)b[A[0]]=A[1];S=typeof t.stops[0][0]}else{if("identity"!==f)throw new Error(`Unknown function type "${f}"`);g=pe}if(s){const A={},O=[];for(let q=0;q<t.stops.length;q++){const X=t.stops[q],te=X[0].zoom;void 0===A[te]&&(A[te]={zoom:te,type:t.type,property:t.property,default:t.default,stops:[]},O.push(te)),A[te].stops.push([X[0].value,X[1]])}const z=[];for(const q of O)z.push([A[q].zoom,et(A[q],e)]);const V={name:"linear"};return{kind:"composite",interpolationType:V,interpolationFactor:Qo.interpolationFactor.bind(void 0,V),zoomStops:z.map(q=>q[0]),evaluate:({zoom:q},X)=>H({stops:z,base:t.base},e,q).evaluate(q,X)}}if(u){const A="exponential"===f?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:A,interpolationFactor:Qo.interpolationFactor.bind(void 0,A),zoomStops:t.stops.map(O=>O[0]),evaluate:({zoom:O})=>g(t,e,O,b,S)}}return{kind:"source",evaluate(A,O){const z=O&&O.properties?O.properties[t.property]:void 0;return void 0===z?x(t.default,e.default):g(t,e,z,b,S)}}}function x(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function E(t,e,n,s,u){return x(typeof n===u?s[n]:void 0,t.default,e.default)}function I(t,e,n){if("number"!==j(n))return x(t.default,e.default);const s=t.stops.length;if(1===s||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[s-1][0])return t.stops[s-1][1];const u=Ws(t.stops.map(f=>f[0]),n);return t.stops[u][1]}function H(t,e,n){const s=void 0!==t.base?t.base:1;if("number"!==j(n))return x(t.default,e.default);const u=t.stops.length;if(1===u||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[u-1][0])return t.stops[u-1][1];const f=Ws(t.stops.map(O=>O[0]),n),g=function(O,z,V,q){const X=q-V,te=O-V;return 0===X?0:1===z?te/X:(Math.pow(z,te)-1)/(Math.pow(z,X)-1)}(n,s,t.stops[f][0],t.stops[f+1][0]),b=t.stops[f][1],S=t.stops[f+1][1];let A=Pr[e.type]||Ae;if(t.colorSpace&&"rgb"!==t.colorSpace){const O=Nt[t.colorSpace];A=(z,V)=>O.reverse(O.interpolate(O.forward(z),O.forward(V),g))}return"function"==typeof b.evaluate?{evaluate(...O){const z=b.evaluate.apply(void 0,O),V=S.evaluate.apply(void 0,O);if(void 0!==z&&void 0!==V)return A(z,V,g)}}:A(b,S,g)}function pe(t,e,n){return"color"===e.type?n=ri.parse(n):"formatted"===e.type?n=eo.fromString(n.toString()):"resolvedImage"===e.type?n=to.fromString(n.toString()):j(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),x(n,t.default,e.default)}class We{constructor(e,n){var s;this.expression=e,this._warningHistory={},this._evaluator=new Ca,this._defaultValue=n?"color"===(s=n).type&&(ue(s.default)||Array.isArray(s.default))?new ri(0,0,0,0):"color"===s.type?ri.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(e,n,s,u,f,g,b,S){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=s,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=S||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,s,u,f,g,b,S){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=s||null,this._evaluator.canonical=u||null,this._evaluator.availableImages=f||null,this._evaluator.formattedSection=g||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=S||null;try{const A=this.expression.evaluate(this._evaluator);if(null==A||"number"==typeof A&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new Mr(`Expected value to be one of ${Object.keys(this._enumValues).map(O=>JSON.stringify(O)).join(", ")}, but found ${JSON.stringify(A)} instead.`);return A}catch(A){return this._warningHistory[A.message]||(this._warningHistory[A.message]=!0,typeof console<"u"&&console.warn(A.message)),this._defaultValue}}}function en(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Wn}function Ln(t,e){const n=new Sa(Wn,[],e?function(u){const f={color:Mi,string:Ft,number:tn,enum:Ft,boolean:hn,formatted:So,resolvedImage:ki};return"array"===u.type?Vr(f[u.value]||In,u.length):f[u.type]}(e):void 0),s=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return s?dr(new We(s,e)):Si(n.errors)}class zn{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent="constant"!==e&&!Oo(n.expression)}evaluateWithoutErrorHandling(e,n,s,u,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,u,f,g)}evaluate(e,n,s,u,f,g){return this._styleExpression.evaluate(e,n,s,u,f,g)}}class Gi{constructor(e,n,s,u){this.kind=e,this.zoomStops=s,this._styleExpression=n,this.isStateDependent="camera"!==e&&!Oo(n.expression),this.interpolationType=u}evaluateWithoutErrorHandling(e,n,s,u,f,g){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,u,f,g)}evaluate(e,n,s,u,f,g){return this._styleExpression.evaluate(e,n,s,u,f,g)}interpolationFactor(e,n,s){return this.interpolationType?Qo.interpolationFactor(this.interpolationType,e,n,s):0}}function Ti(t,e){if("error"===(t=Ln(t,e)).result)return t;const n=t.value.expression,s=vr(n);if(!s&&!br(e))return Si([new ir("","data expressions not supported")]);const u=uo(n,["zoom","pitch","distance-from-center"]);if(!u&&!N(e))return Si([new ir("","zoom expressions not supported")]);const f=ts(n);return f||u?f instanceof ir?Si([f]):f instanceof Qo&&!J(e)?Si([new ir("",'"interpolate" expressions cannot be used with this property')]):dr(f?new Gi(s?"camera":"composite",t.value,f.labels,f instanceof Qo?f.interpolation:void 0):new zn(s?"constant":"source",t.value)):Si([new ir("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Xs{constructor(e,n){this._parameters=e,this._specification=n,ti(this,et(this._parameters,this._specification))}static deserialize(e){return new Xs(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function ts(t){let e=null;if(t instanceof wr)e=ts(t.result);else if(t instanceof es){for(const n of t.args)if(e=ts(n),e)break}else(t instanceof Ir||t instanceof Qo)&&t.input instanceof Lo&&"zoom"===t.input.name&&(e=t);return e instanceof ir||t.eachChild(n=>{const s=ts(n);s instanceof ir?e=s:!e&&s?e=new ir("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new ir("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class Zt{constructor(e,n,s,u){this.message=(e?`${e}: `:"")+s,u&&(this.identifier=u),null!=n&&n.__line__&&(this.line=n.__line__)}}function Nr(t){const e=t.key,n=t.value,s=t.valueSpec||{},u=t.objectElementValidators||{},f=t.style,g=t.styleSpec;let b=[];const S=j(n);if("object"!==S)return[new Zt(e,n,`object expected, ${S} found`)];for(const A in n){const O=A.split(".")[0];let z;u[O]?z=u[O]:s[O]?z=so:u["*"]?z=u["*"]:s["*"]&&(z=so),z?b=b.concat(z({key:(e&&`${e}.`)+A,value:n[A],valueSpec:s[O]||s["*"],style:f,styleSpec:g,object:n,objectKey:A},n)):b.push(new Zt(e,n[A],`unknown property "${A}"`))}for(const A in s)u[A]||s[A].required&&void 0===s[A].default&&void 0===n[A]&&b.push(new Zt(e,n,`missing required property "${A}"`));return b}function qr(t){const e=t.value,n=t.valueSpec,s=t.style,u=t.styleSpec,f=t.key,g=t.arrayElementValidator||so;if("array"!==j(e))return[new Zt(f,e,`array expected, ${j(e)} found`)];if(n.length&&e.length!==n.length)return[new Zt(f,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new Zt(f,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let b={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};u.$version<7&&(b.function=n.function),"object"===j(n.value)&&(b=n.value);let S=[];for(let A=0;A<e.length;A++)S=S.concat(g({array:e,arrayIndex:A,value:e[A],valueSpec:b,style:s,styleSpec:u,key:`${f}[${A}]`}));return S}function oa(t){const e=t.key,n=t.value,s=t.valueSpec;let u=j(n);if("number"===u&&n!=n&&(u="NaN"),"number"!==u)return[new Zt(e,n,`number expected, ${u} found`)];if("minimum"in s){let f=s.minimum;if("array"===j(s.minimum)&&(f=s.minimum[t.arrayIndex]),n<f)return[new Zt(e,n,`${n} is less than the minimum value ${f}`)]}if("maximum"in s){let f=s.maximum;if("array"===j(s.maximum)&&(f=s.maximum[t.arrayIndex]),n>f)return[new Zt(e,n,`${n} is greater than the maximum value ${f}`)]}return[]}function Ma(t){const e=t.valueSpec,n=ai(t.value.type);let s,u,f,g={};const b="categorical"!==n&&void 0===t.value.property,S=!b,A="array"===j(t.value.stops)&&"array"===j(t.value.stops[0])&&"object"===j(t.value.stops[0][0]),O=Nr({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(q){if("identity"===n)return[new Zt(q.key,q.value,'identity function may not have a "stops" property')];let X=[];const te=q.value;return X=X.concat(qr({key:q.key,value:te,valueSpec:q.valueSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:z})),"array"===j(te)&&0===te.length&&X.push(new Zt(q.key,te,"array must have at least one stop")),X},default:function(q){return so({key:q.key,value:q.value,valueSpec:e,style:q.style,styleSpec:q.styleSpec})}}});return"identity"===n&&b&&O.push(new Zt(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||O.push(new Zt(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!J(t.valueSpec)&&O.push(new Zt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(S&&!br(t.valueSpec)?O.push(new Zt(t.key,t.value,"property functions not supported")):b&&!N(t.valueSpec)&&O.push(new Zt(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!A||void 0!==t.value.property||O.push(new Zt(t.key,t.value,'"property" property is required')),O;function z(q){let X=[];const te=q.value,de=q.key;if("array"!==j(te))return[new Zt(de,te,`array expected, ${j(te)} found`)];if(2!==te.length)return[new Zt(de,te,`array length 2 expected, length ${te.length} found`)];if(A){if("object"!==j(te[0]))return[new Zt(de,te,`object expected, ${j(te[0])} found`)];if(void 0===te[0].zoom)return[new Zt(de,te,"object stop key must have zoom")];if(void 0===te[0].value)return[new Zt(de,te,"object stop key must have value")];const ye=ai(te[0].zoom);if("number"!=typeof ye)return[new Zt(de,te[0].zoom,"stop zoom values must be numbers")];if(f&&f>ye)return[new Zt(de,te[0].zoom,"stop zoom values must appear in ascending order")];ye!==f&&(f=ye,u=void 0,g={}),X=X.concat(Nr({key:`${de}[0]`,value:te[0],valueSpec:{zoom:{}},style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:oa,value:V}}))}else X=X.concat(V({key:`${de}[0]`,value:te[0],valueSpec:{},style:q.style,styleSpec:q.styleSpec},te));return en(bi(te[1]))?X.concat([new Zt(`${de}[1]`,te[1],"expressions are not allowed in function stops.")]):X.concat(so({key:`${de}[1]`,value:te[1],valueSpec:e,style:q.style,styleSpec:q.styleSpec}))}function V(q,X){const te=j(q.value),de=ai(q.value),ye=null!==q.value?q.value:X;if(s){if(te!==s)return[new Zt(q.key,ye,`${te} stop domain type must match previous stop domain type ${s}`)]}else s=te;if("number"!==te&&"string"!==te&&"boolean"!==te&&"number"!=typeof de&&"string"!=typeof de&&"boolean"!=typeof de)return[new Zt(q.key,ye,"stop domain value must be a number, string, or boolean")];if("number"!==te&&"categorical"!==n){let Ie=`number expected, ${te} found`;return br(e)&&void 0===n&&(Ie+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Zt(q.key,ye,Ie)]}return"categorical"!==n||"number"!==te||"number"==typeof de&&isFinite(de)&&Math.floor(de)===de?"categorical"!==n&&"number"===te&&"number"==typeof de&&"number"==typeof u&&void 0!==u&&de<u?[new Zt(q.key,ye,"stop domain values must appear in ascending order")]:(u=de,"categorical"===n&&de in g?[new Zt(q.key,ye,"stop domain values must be unique")]:(g[de]=!0,[])):[new Zt(q.key,ye,`integer expected, found ${String(de)}`)]}}function kr(t){const e=("property"===t.expressionContext?Ti:Ln)(bi(t.value),t.valueSpec);if("error"===e.result)return e.value.map(s=>new Zt(`${t.key}${s.key}`,t.value,s.message));const n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new Zt(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Oo(n))return[new Zt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return Ja(n,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!uo(n,["zoom","feature-state"]))return[new Zt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!vr(n))return[new Zt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Ja(t,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const u of e.valueSpec.expression.parameters)n.delete(u);if(0===n.size)return[];const s=[];return t instanceof Lo&&n.has(t.name)?[new Zt(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(u=>{s.push(...Ja(u,e))}),s)}function Ql(t){const e=t.key,n=t.value,s=t.valueSpec,u=[];return Array.isArray(s.values)?-1===s.values.indexOf(ai(n))&&u.push(new Zt(e,n,`expected one of [${s.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(s.values).indexOf(ai(n))&&u.push(new Zt(e,n,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(n)} found`)),u}function pl(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!pl(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function ml(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};pl(t)||(t=Il(t));const n=t;let s=!0;try{s=function(A){if(!za(A))return A;let O=bi(A);return gl(O),O=Qa(O),O}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const u=ft[`filter_${e}`],f=Ln(s,u);let g=null;if("error"===f.result)throw new Error(f.value.map(A=>`${A.key}: ${A.message}`).join(", "));g=(A,O,z)=>f.value.evaluate(A,O,{},z);let b=null,S=null;if(s!==n){const A=Ln(n,u);if("error"===A.result)throw new Error(A.value.map(O=>`${O.key}: ${O.message}`).join(", "));b=(O,z,V,q,X)=>A.value.evaluate(O,z,{},V,void 0,void 0,q,X),S=!vr(A.value.expression)}return{filter:g,dynamicFilter:b||void 0,needGeometry:qc(s),needFeature:!!S}}function Qa(t){if(!Array.isArray(t))return t;const e=function(n){if(Eu.has(n[0]))for(let s=1;s<n.length;s++)if(za(n[s]))return!0;return n}(t);return!0===e?e:e.map(n=>Qa(n))}function gl(t){let e=!1;const n=[];if("case"===t[0]){for(let s=1;s<t.length-1;s+=2)e=e||za(t[s]),n.push(t[s+1]);n.push(t[t.length-1])}else if("match"===t[0]){e=e||za(t[1]);for(let s=2;s<t.length-1;s+=2)n.push(t[s+1]);n.push(t[t.length-1])}else if("step"===t[0]){e=e||za(t[1]);for(let s=1;s<t.length-1;s+=2)n.push(t[s+1])}e&&(t.length=0,t.push("any",...n));for(let s=1;s<t.length;s++)gl(t[s])}function za(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let n=1;n<t.length;n++)if(za(t[n]))return!0;return!1}const Eu=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Tu(t,e){return t<e?-1:t>e?1:0}function qc(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(qc(t[e]))return!0;return!1}function Il(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?ya(t[1],t[2],"=="):"!="===e?Rl(ya(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?ya(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map(Il))):"all"===e?["all"].concat(t.slice(1).map(Il)):"none"===e?["all"].concat(t.slice(1).map(Il).map(Rl)):"in"===e?Pl(t[1],t.slice(2)):"!in"===e?Rl(Pl(t[1],t.slice(2))):"has"===e?kl(t[1]):"!has"===e?Rl(kl(t[1])):"within"!==e||t;var n}function ya(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function Pl(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Tu)]]:["filter-in-small",t,["literal",e]]}}function kl(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Rl(t){return["!",t]}function el(t){return pl(bi(t.value))?kr(ti({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):_l(t)}function _l(t){const e=t.value,n=t.key;if("array"!==j(e))return[new Zt(n,e,`array expected, ${j(e)} found`)];const s=t.styleSpec;let u,f=[];if(e.length<1)return[new Zt(n,e,"filter array must have at least 1 element")];switch(f=f.concat(Ql({key:`${n}[0]`,value:e[0],valueSpec:s.filter_operator,style:t.style,styleSpec:t.styleSpec})),ai(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===ai(e[1])&&f.push(new Zt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&f.push(new Zt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(u=j(e[1]),"string"!==u&&f.push(new Zt(`${n}[1]`,e[1],`string expected, ${u} found`)));for(let g=2;g<e.length;g++)u=j(e[g]),"$type"===ai(e[1])?f=f.concat(Ql({key:`${n}[${g}]`,value:e[g],valueSpec:s.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==u&&"number"!==u&&"boolean"!==u&&f.push(new Zt(`${n}[${g}]`,e[g],`string, number, or boolean expected, ${u} found`));break;case"any":case"all":case"none":for(let g=1;g<e.length;g++)f=f.concat(_l({key:`${n}[${g}]`,value:e[g],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":u=j(e[1]),2!==e.length?f.push(new Zt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==u&&f.push(new Zt(`${n}[1]`,e[1],`string expected, ${u} found`));break;case"within":u=j(e[1]),2!==e.length?f.push(new Zt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==u&&f.push(new Zt(`${n}[1]`,e[1],`object expected, ${u} found`))}return f}function ec(t,e){const n=t.key,s=t.style,u=t.styleSpec,f=t.value,g=t.objectKey,b=u[`${e}_${t.layerType}`];if(!b)return[];const S=g.match(/^(.*)-transition$/);if("paint"===e&&S&&b[S[1]]&&b[S[1]].transition)return so({key:n,value:f,valueSpec:u.transition,style:s,styleSpec:u});const A=t.valueSpec||b[g];if(!A)return[new Zt(n,f,`unknown property "${g}"`)];let O;if("string"===j(f)&&br(A)&&!A.tokens&&(O=/^{([^}]+)}$/.exec(f))){const V=`\`{ "type": "identity", "property": ${O?JSON.stringify(O[1]):'"_"'} }\``;return[new Zt(n,f,`"${g}" does not support interpolation syntax\nUse an identity property function instead: ${V}.`)]}const z=[];return"symbol"===t.layerType&&("text-field"===g&&s&&!s.glyphs&&z.push(new Zt(n,f,'use of "text-field" requires a style "glyphs" property')),"text-font"===g&&ue(bi(f))&&"identity"===ai(f.type)&&z.push(new Zt(n,f,'"text-font" does not support identity functions'))),z.concat(so({key:t.key,value:f,valueSpec:A,style:s,styleSpec:u,expressionContext:"property",propertyType:e,propertyKey:g}))}function Cu(t){return ec(t,"paint")}function yc(t){return ec(t,"layout")}function Ts(t){let e=[];const n=t.value,s=t.key,u=t.style,f=t.styleSpec;n.type||n.ref||e.push(new Zt(s,n,'either "type" or "ref" is required'));let g=ai(n.type);const b=ai(n.ref);if(n.id){const S=ai(n.id);for(let A=0;A<t.arrayIndex;A++){const O=u.layers[A];ai(O.id)===S&&e.push(new Zt(s,n.id,`duplicate layer id "${n.id}", previously used at line ${O.id.__line__}`))}}if("ref"in n){let S;["type","source","source-layer","filter","layout"].forEach(A=>{A in n&&e.push(new Zt(s,n[A],`"${A}" is prohibited for ref layers`))}),u.layers.forEach(A=>{ai(A.id)===b&&(S=A)}),S?S.ref?e.push(new Zt(s,n.ref,"ref cannot reference another ref layer")):g=ai(S.type):"string"==typeof b&&e.push(new Zt(s,n.ref,`ref layer "${b}" not found`))}else if("background"!==g&&"sky"!==g)if(n.source){const S=u.sources&&u.sources[n.source],A=S&&ai(S.type);S?"vector"===A&&"raster"===g?e.push(new Zt(s,n.source,`layer "${n.id}" requires a raster source`)):"raster"===A&&"raster"!==g?e.push(new Zt(s,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==A||n["source-layer"]?"raster-dem"===A&&"hillshade"!==g?e.push(new Zt(s,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==g||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===A&&S.lineMetrics||e.push(new Zt(s,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new Zt(s,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new Zt(s,n.source,`source "${n.source}" not found`))}else e.push(new Zt(s,n,'missing required property "source"'));return e=e.concat(Nr({key:s,value:n,valueSpec:f.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>so({key:`${s}.type`,value:n.type,valueSpec:f.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:S=>el(ti({layerType:g},S)),layout:S=>Nr({layer:n,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":A=>yc(ti({layerType:g},A))}}),paint:S=>Nr({layer:n,key:S.key,value:S.value,valueSpec:{},style:S.style,styleSpec:S.styleSpec,objectElementValidators:{"*":A=>Cu(ti({layerType:g},A))}})}})),e}function Ga(t){const e=t.value,n=t.key,s=j(e);return"string"!==s?[new Zt(n,e,`string expected, ${s} found`)]:[]}const Ll={promoteId:function({key:t,value:e}){if("string"===j(e))return Ga({key:t,value:e});{const n=[];for(const s in e)n.push(...Ga({key:`${t}.${s}`,value:e[s]}));return n}}};function Du(t){const e=t.value,n=t.key,s=t.styleSpec,u=t.style;if(!e.type)return[new Zt(n,e,'"type" is required')];const f=ai(e.type);let g;switch(f){case"vector":case"raster":case"raster-dem":return g=Nr({key:n,value:e,valueSpec:s[`source_${f.replace("-","_")}`],style:t.style,styleSpec:s,objectElementValidators:Ll}),g;case"geojson":if(g=Nr({key:n,value:e,valueSpec:s.source_geojson,style:u,styleSpec:s,objectElementValidators:Ll}),e.cluster)for(const b in e.clusterProperties){const[S,A]=e.clusterProperties[b],O="string"==typeof S?[S,["accumulated"],["get",b]]:S;g.push(...kr({key:`${n}.${b}.map`,value:A,expressionContext:"cluster-map"})),g.push(...kr({key:`${n}.${b}.reduce`,value:O,expressionContext:"cluster-reduce"}))}return g;case"video":return Nr({key:n,value:e,valueSpec:s.source_video,style:u,styleSpec:s});case"image":return Nr({key:n,value:e,valueSpec:s.source_image,style:u,styleSpec:s});case"canvas":return[new Zt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ql({key:`${n}.type`,value:e.type,valueSpec:{values:vc(s)},style:u,styleSpec:s})}}function vc(t){return t.source.reduce((e,n)=>{const s=t[n];return"enum"===s.type.type&&(e=e.concat(Object.keys(s.type.values))),e},[])}function qa(t){const e=t.value,n=t.styleSpec,s=n.light,u=t.style;let f=[];const g=j(e);if(void 0===e)return f;if("object"!==g)return f=f.concat([new Zt("light",e,`object expected, ${g} found`)]),f;for(const b in e){const S=b.match(/^(.*)-transition$/);f=f.concat(S&&s[S[1]]&&s[S[1]].transition?so({key:b,value:e[b],valueSpec:n.transition,style:u,styleSpec:n}):s[b]?so({key:b,value:e[b],valueSpec:s[b],style:u,styleSpec:n}):[new Zt(b,e[b],`unknown property "${b}"`)])}return f}function Su(t){const e=t.value,n=t.key,s=t.style,u=t.styleSpec,f=u.terrain;let g=[];const b=j(e);if(void 0===e)return g;if("object"!==b)return g=g.concat([new Zt("terrain",e,`object expected, ${b} found`)]),g;for(const S in e){const A=S.match(/^(.*)-transition$/);g=g.concat(A&&f[A[1]]&&f[A[1]].transition?so({key:S,value:e[S],valueSpec:u.transition,style:s,styleSpec:u}):f[S]?so({key:S,value:e[S],valueSpec:f[S],style:s,styleSpec:u}):[new Zt(S,e[S],`unknown property "${S}"`)])}if(e.source){const S=s.sources&&s.sources[e.source],A=S&&ai(S.type);S?"raster-dem"!==A&&g.push(new Zt(n,e.source,`terrain cannot be used with a source of type ${String(A)}, it only be used with a "raster-dem" source type`)):g.push(new Zt(n,e.source,`source "${e.source}" not found`))}else g.push(new Zt(n,e,'terrain is missing required property "source"'));return g}function Au(t){const e=t.value,n=t.style,s=t.styleSpec,u=s.fog;let f=[];const g=j(e);if(void 0===e)return f;if("object"!==g)return f=f.concat([new Zt("fog",e,`object expected, ${g} found`)]),f;for(const b in e){const S=b.match(/^(.*)-transition$/);f=f.concat(S&&u[S[1]]&&u[S[1]].transition?so({key:b,value:e[b],valueSpec:s.transition,style:n,styleSpec:s}):u[b]?so({key:b,value:e[b],valueSpec:u[b],style:n,styleSpec:s}):[new Zt(b,e[b],`unknown property "${b}"`)])}return f}const Wc={"*":()=>[],array:qr,boolean:function(t){const e=t.value,n=t.key,s=j(e);return"boolean"!==s?[new Zt(n,e,`boolean expected, ${s} found`)]:[]},number:oa,color:function(t){const e=t.key,n=t.value,s=j(n);return"string"!==s?[new Zt(e,n,`color expected, ${s} found`)]:null===fr(n)?[new Zt(e,n,`color expected, "${n}" found`)]:[]},enum:Ql,filter:el,function:Ma,layer:Ts,object:Nr,source:Du,light:qa,terrain:Su,fog:Au,string:Ga,formatted:function(t){return 0===Ga(t).length?[]:kr(t)},resolvedImage:function(t){return 0===Ga(t).length?[]:kr(t)},projection:function(t){const e=t.value,n=t.styleSpec,s=n.projection,u=t.style;let f=[];const g=j(e);if("object"===g)for(const b in e)f=f.concat(so({key:b,value:e[b],valueSpec:s[b],style:u,styleSpec:n}));else"string"!==g&&(f=f.concat([new Zt("projection",e,`object or string expected, ${g} found`)]));return f}};function so(t){const e=t.value,n=t.valueSpec,s=t.styleSpec;return n.expression&&ue(ai(e))?Ma(t):n.expression&&en(bi(e))?kr(t):n.type&&Wc[n.type]?Wc[n.type](t):Nr(ti({},t,{valueSpec:n.type?s[n.type]:n}))}function Mu(t){const e=t.value,n=t.key,s=Ga(t);return s.length||(-1===e.indexOf("{fontstack}")&&s.push(new Zt(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&s.push(new Zt(n,e,'"glyphs" url must include a "{range}" token'))),s}function Rs(t,e=ft){return va(so({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Mu,"*":()=>[]}}))}const Zc=t=>va(Cu(t)),Ol=t=>va(yc(t));function va(t){return t.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function tc(t,e){let n=!1;if(e&&e.length)for(const s of e)t.fire(new go(new Error(s.message))),n=!0;return n}var sa=Ls,ns=3;function Ls(t,e,n){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var u=new Int32Array(this.arrayBuffer);t=u[0],this.d=(e=u[1])+2*(n=u[2]);for(var f=0;f<this.d*this.d;f++){var g=u[ns+f],b=u[ns+f+1];s.push(g===b?null:u.subarray(g,b))}var S=u[ns+s.length+1];this.keys=u.subarray(u[ns+s.length],S),this.bboxes=u.subarray(S),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var A=0;A<this.d*this.d;A++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var O=n/e*t;this.min=-O,this.max=t+O}Ls.prototype.insert=function(t,e,n,s,u){this._forEachCell(e,n,s,u,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(u)},Ls.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Ls.prototype._insertCell=function(t,e,n,s,u,f){this.cells[u].push(f)},Ls.prototype.query=function(t,e,n,s,u){var f=this.min,g=this.max;if(t<=f&&e<=f&&g<=n&&g<=s&&!u)return Array.prototype.slice.call(this.keys);var b=[];return this._forEachCell(t,e,n,s,this._queryCell,b,{},u),b},Ls.prototype._queryCell=function(t,e,n,s,u,f,g,b){var S=this.cells[u];if(null!==S)for(var A=this.keys,O=this.bboxes,z=0;z<S.length;z++){var V=S[z];if(void 0===g[V]){var q=4*V;(b?b(O[q+0],O[q+1],O[q+2],O[q+3]):t<=O[q+2]&&e<=O[q+3]&&n>=O[q+0]&&s>=O[q+1])?(g[V]=!0,f.push(A[V])):g[V]=!1}}},Ls.prototype._forEachCell=function(t,e,n,s,u,f,g,b){for(var S=this._convertToCellCoord(t),A=this._convertToCellCoord(e),O=this._convertToCellCoord(n),z=this._convertToCellCoord(s),V=S;V<=O;V++)for(var q=A;q<=z;q++){var X=this.d*q+V;if((!b||b(this._convertFromCellCoord(V),this._convertFromCellCoord(q),this._convertFromCellCoord(V+1),this._convertFromCellCoord(q+1)))&&u.call(this,t,e,n,s,X,f,g,b))return}},Ls.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Ls.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Ls.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=ns+this.cells.length+1+1,n=0,s=0;s<this.cells.length;s++)n+=this.cells[s].length;var u=new Int32Array(e+n+this.keys.length+this.bboxes.length);u[0]=this.extent,u[1]=this.n,u[2]=this.padding;for(var f=e,g=0;g<t.length;g++){var b=t[g];u[ns+g]=f,u.set(b,f),f+=b.length}return u[ns+t.length]=f,u.set(this.keys,f),u[ns+t.length+1]=f+=this.keys.length,u.set(this.bboxes,f),f+=this.bboxes.length,u.buffer};var yl=Yt(sa);const nc={};function wn(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),nc[e]={klass:t,omit:n.omit||[]}}wn(Object,"Object"),yl.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},yl.deserialize=function(t){return new yl(t.buffer)},Object.defineProperty(yl,"name",{value:"Grid"}),wn(yl,"Grid"),wn(ri,"Color"),wn(Error,"Error"),wn(Yi,"AJAXError"),wn(to,"ResolvedImage"),wn(Xs,"StylePropertyFunction"),wn(We,"StyleExpression",{omit:["_evaluator"]}),wn(Gi,"ZoomDependentExpression"),wn(zn,"ZoomConstantExpression"),wn(Lo,"CompoundExpression",{omit:["_evaluate"]});for(const t in Wn)nc[Wn[t]._classRegistryKey]||wn(Wn[t],`Expression${t}`);function Xc(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function ic(t){return Re.ImageBitmap&&t instanceof Re.ImageBitmap}function ar(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Xc(t)||ic(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.push(n.buffer),n}if(t instanceof Re.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const s of t)n.push(ar(s,e));return n}if("object"==typeof t){const n=t.constructor,s=n._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const u=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const f in t)t.hasOwnProperty(f)&&(nc[s].omit.indexOf(f)>=0||(u[f]=ar(t[f],e)));t instanceof Error&&(u.message=t.message)}if(u.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(u.$name=s),u}throw new Error("can't serialize object of type "+typeof t)}function Fl(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Xc(t)||ic(t)||ArrayBuffer.isView(t)||t instanceof Re.ImageData)return t;if(Array.isArray(t))return t.map(Fl);if("object"==typeof t){const e=t.$name||"Object",{klass:n}=nc[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const s=Object.create(n.prototype);for(const u of Object.keys(t))"$name"!==u&&(s[u]=Fl(t[u]));return s}throw new Error("can't deserialize object of type "+typeof t)}const vn={"Latin-1 Supplement":t=>t>=128&&t<=255,Arabic:t=>t>=1536&&t<=1791,"Arabic Supplement":t=>t>=1872&&t<=1919,"Arabic Extended-A":t=>t>=2208&&t<=2303,"Hangul Jamo":t=>t>=4352&&t<=4607,"Unified Canadian Aboriginal Syllabics":t=>t>=5120&&t<=5759,Khmer:t=>t>=6016&&t<=6143,"Unified Canadian Aboriginal Syllabics Extended":t=>t>=6320&&t<=6399,"General Punctuation":t=>t>=8192&&t<=8303,"Letterlike Symbols":t=>t>=8448&&t<=8527,"Number Forms":t=>t>=8528&&t<=8591,"Miscellaneous Technical":t=>t>=8960&&t<=9215,"Control Pictures":t=>t>=9216&&t<=9279,"Optical Character Recognition":t=>t>=9280&&t<=9311,"Enclosed Alphanumerics":t=>t>=9312&&t<=9471,"Geometric Shapes":t=>t>=9632&&t<=9727,"Miscellaneous Symbols":t=>t>=9728&&t<=9983,"Miscellaneous Symbols and Arrows":t=>t>=11008&&t<=11263,"CJK Radicals Supplement":t=>t>=11904&&t<=12031,"Kangxi Radicals":t=>t>=12032&&t<=12255,"Ideographic Description Characters":t=>t>=12272&&t<=12287,"CJK Symbols and Punctuation":t=>t>=12288&&t<=12351,Hiragana:t=>t>=12352&&t<=12447,Katakana:t=>t>=12448&&t<=12543,Bopomofo:t=>t>=12544&&t<=12591,"Hangul Compatibility Jamo":t=>t>=12592&&t<=12687,Kanbun:t=>t>=12688&&t<=12703,"Bopomofo Extended":t=>t>=12704&&t<=12735,"CJK Strokes":t=>t>=12736&&t<=12783,"Katakana Phonetic Extensions":t=>t>=12784&&t<=12799,"Enclosed CJK Letters and Months":t=>t>=12800&&t<=13055,"CJK Compatibility":t=>t>=13056&&t<=13311,"CJK Unified Ideographs Extension A":t=>t>=13312&&t<=19903,"Yijing Hexagram Symbols":t=>t>=19904&&t<=19967,"CJK Unified Ideographs":t=>t>=19968&&t<=40959,"Yi Syllables":t=>t>=40960&&t<=42127,"Yi Radicals":t=>t>=42128&&t<=42191,"Hangul Jamo Extended-A":t=>t>=43360&&t<=43391,"Hangul Syllables":t=>t>=44032&&t<=55215,"Hangul Jamo Extended-B":t=>t>=55216&&t<=55295,"Private Use Area":t=>t>=57344&&t<=63743,"CJK Compatibility Ideographs":t=>t>=63744&&t<=64255,"Arabic Presentation Forms-A":t=>t>=64336&&t<=65023,"Vertical Forms":t=>t>=65040&&t<=65055,"CJK Compatibility Forms":t=>t>=65072&&t<=65103,"Small Form Variants":t=>t>=65104&&t<=65135,"Arabic Presentation Forms-B":t=>t>=65136&&t<=65279,"Halfwidth and Fullwidth Forms":t=>t>=65280&&t<=65519};function Kc(t){for(const e of t)if(fh(e.charCodeAt(0)))return!0;return!1}function ad(t){for(const e of t)if(!ld(e.charCodeAt(0)))return!1;return!0}function ld(t){return!(vn.Arabic(t)||vn["Arabic Supplement"](t)||vn["Arabic Extended-A"](t)||vn["Arabic Presentation Forms-A"](t)||vn["Arabic Presentation Forms-B"](t))}function fh(t){return!(746!==t&&747!==t&&(t<4352||!(vn["Bopomofo Extended"](t)||vn.Bopomofo(t)||vn["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||vn["CJK Compatibility Ideographs"](t)||vn["CJK Compatibility"](t)||vn["CJK Radicals Supplement"](t)||vn["CJK Strokes"](t)||!(!vn["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||vn["CJK Unified Ideographs Extension A"](t)||vn["CJK Unified Ideographs"](t)||vn["Enclosed CJK Letters and Months"](t)||vn["Hangul Compatibility Jamo"](t)||vn["Hangul Jamo Extended-A"](t)||vn["Hangul Jamo Extended-B"](t)||vn["Hangul Jamo"](t)||vn["Hangul Syllables"](t)||vn.Hiragana(t)||vn["Ideographic Description Characters"](t)||vn.Kanbun(t)||vn["Kangxi Radicals"](t)||vn["Katakana Phonetic Extensions"](t)||vn.Katakana(t)&&12540!==t||!(!vn["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!vn["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||vn["Unified Canadian Aboriginal Syllabics"](t)||vn["Unified Canadian Aboriginal Syllabics Extended"](t)||vn["Vertical Forms"](t)||vn["Yijing Hexagram Symbols"](t)||vn["Yi Syllables"](t)||vn["Yi Radicals"](t))))}function cd(t){return!(fh(t)||(e=t,vn["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||vn["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||vn["Letterlike Symbols"](e)||vn["Number Forms"](e)||vn["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||vn["Control Pictures"](e)&&9251!==e||vn["Optical Character Recognition"](e)||vn["Enclosed Alphanumerics"](e)||vn["Geometric Shapes"](e)||vn["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||vn["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||vn["CJK Symbols and Punctuation"](e)||vn.Katakana(e)||vn["Private Use Area"](e)||vn["CJK Compatibility Forms"](e)||vn["Small Form Variants"](e)||vn["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e}function Na(t){return t>=1424&&t<=2303||vn["Arabic Presentation Forms-A"](t)||vn["Arabic Presentation Forms-B"](t)}function Tf(t,e){return!(!e&&Na(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||vn.Khmer(t))}function ph(t){for(const e of t)if(Na(e.charCodeAt(0)))return!0;return!1}const wo="deferred",rc="loading",vl="loaded";let Bl=null,h="unavailable",i=null;const l=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(h="error"),Bl&&Bl(t)};function p(){w.fire(new qo("pluginStateChange",{pluginStatus:h,pluginURL:i}))}const w=new $s,C=function(){return h},P=function(){if(h!==wo||!i)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");h=rc,p(),i&&cr({url:i},t=>{t?l(t):(h=vl,p())})},m={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>h===vl||null!=m.applyArabicShaping,isLoading:()=>h===rc,setState(t){h=t.pluginStatus,i=t.pluginURL},isParsed:()=>null!=m.applyArabicShaping&&null!=m.processBidirectionalText&&null!=m.processStyledBidirectionalText,getPluginURL:()=>i};class y{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(n,s){for(const u of n)if(!Tf(u.charCodeAt(0),s))return!1;return!0}(e,m.isLoaded())}}class _{constructor(e,n){this.property=e,this.value=n,this.expression=function(s,u){if(ue(s))return new Xs(s,u);if(en(s)){const f=Ti(s,u);if("error"===f.result)throw new Error(f.value.map(g=>`${g.key}: ${g.message}`).join(", "));return f.value}{let f=s;return"string"==typeof s&&"color"===u.type&&(f=ri.parse(s)),{kind:"constant",evaluate:()=>f}}}(void 0===n?e.specification.default:n,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,n,s){return this.property.possiblyEvaluate(this,e,n,s)}}class T{constructor(e){this.property=e,this.value=new _(e,void 0)}transitioned(e,n){return new F(this.property,this.value,n,Dt({},e.transition,this.transition),e.now)}untransitioned(){return new F(this.property,this.value,null,{},0)}}class M{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return ui(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new T(this._values[e].property)),this._values[e].value=new _(this._values[e].property,null===n?void 0:ui(n))}getTransition(e){return ui(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new T(this._values[e].property)),this._values[e].transition=ui(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);void 0!==s&&(e[n]=s);const u=this.getTransition(n);void 0!==u&&(e[`${n}-transition`]=u)}return e}transitioned(e,n){const s=new U(this._properties);for(const u of Object.keys(this._values))s._values[u]=this._values[u].transitioned(e,n._values[u]);return s}untransitioned(){const e=new U(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class F{constructor(e,n,s,u,f){const g=u.delay||0,b=u.duration||0;f=f||0,this.property=e,this.value=n,this.begin=f+g,this.end=this.begin+b,e.specification.transition&&(u.delay||u.duration)&&(this.prior=s)}possiblyEvaluate(e,n,s){const u=e.now||0,f=this.value.possiblyEvaluate(e,n,s),g=this.prior;if(g){if(u>this.end)return this.prior=null,f;if(this.value.isDataDriven())return this.prior=null,f;if(u<this.begin)return g.possiblyEvaluate(e,n,s);{const b=(u-this.begin)/(this.end-this.begin);return this.property.interpolate(g.possiblyEvaluate(e,n,s),f,zt(b))}}return f}}class U{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,s){const u=new le(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,n,s);return u}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class K{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return ui(this._values[e].value)}setValue(e,n){this._values[e]=new _(this._values[e].property,null===n?void 0:ui(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);void 0!==s&&(e[n]=s)}return e}possiblyEvaluate(e,n,s){const u=new le(this._properties);for(const f of Object.keys(this._values))u._values[f]=this._values[f].possiblyEvaluate(e,n,s);return u}}class ee{constructor(e,n,s){this.property=e,this.value=n,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,n,s,u){return this.property.evaluate(this.value,this.parameters,e,n,s,u)}}class le{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Z{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,s){const u=Pr[this.specification.type];return u?u(e,n,s):e}}class ce{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,s,u){return new ee(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(n,null,{},s,u)}:e.expression,n)}interpolate(e,n,s){if("constant"!==e.value.kind||"constant"!==n.value.kind)return e;if(void 0===e.value.value||void 0===n.value.value)return new ee(this,{kind:"constant",value:void 0},e.parameters);const u=Pr[this.specification.type];return u?new ee(this,{kind:"constant",value:u(e.value.value,n.value.value,s)},e.parameters):e}evaluate(e,n,s,u,f,g){return"constant"===e.kind?e.value:e.evaluate(n,s,u,f,g)}}class _e{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,u){return!!e.expression.evaluate(n,null,{},s,u)}interpolate(){return!1}}class we{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new y(0,{});for(const s in e){const u=e[s];u.specification.overridable&&this.overridableProperties.push(s);const f=this.defaultPropertyValues[s]=new _(u,void 0),g=this.defaultTransitionablePropertyValues[s]=new T(u);this.defaultTransitioningPropertyValues[s]=g.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=f.possiblyEvaluate(n)}}}function ke(t,e){return 256*(t=Mt(Math.floor(t),0,255))+Mt(Math.floor(e),0,255)}wn(ce,"DataDrivenProperty"),wn(Z,"DataConstantProperty"),wn(_e,"ColorRampProperty");const Be={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Pe{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Ze{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function He(t,e=1){let n=0,s=0;return{members:t.map(u=>{const f=Be[u.type].BYTES_PER_ELEMENT,g=n=nt(n,Math.max(e,f)),b=u.components||1;return s=Math.max(s,f),n+=f*b,{name:u.name,type:u.type,components:b,offset:g}}),size:nt(n,Math.max(s,e)),alignment:e}}function nt(t,e){return Math.ceil(t/e)*e}class Gt extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const u=2*e;return this.int16[u+0]=n,this.int16[u+1]=s,e}}Gt.prototype.bytesPerElement=4,wn(Gt,"StructArrayLayout2i4");class Je extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,s)}emplace(e,n,s,u){const f=3*e;return this.int16[f+0]=n,this.int16[f+1]=s,this.int16[f+2]=u,e}}Je.prototype.bytesPerElement=6,wn(Je,"StructArrayLayout3i6");class wt extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,s,u)}emplace(e,n,s,u,f){const g=4*e;return this.int16[g+0]=n,this.int16[g+1]=s,this.int16[g+2]=u,this.int16[g+3]=f,e}}wt.prototype.bytesPerElement=8,wn(wt,"StructArrayLayout4i8");class ct extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,g,b){const S=this.length;return this.resize(S+1),this.emplace(S,e,n,s,u,f,g,b)}emplace(e,n,s,u,f,g,b,S){const A=6*e,O=12*e,z=3*e;return this.int16[A+0]=n,this.int16[A+1]=s,this.uint8[O+4]=u,this.uint8[O+5]=f,this.uint8[O+6]=g,this.uint8[O+7]=b,this.float32[z+2]=S,e}}ct.prototype.bytesPerElement=12,wn(ct,"StructArrayLayout2i4ub1f12");class $t extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,s,u)}emplace(e,n,s,u,f){const g=4*e;return this.float32[g+0]=n,this.float32[g+1]=s,this.float32[g+2]=u,this.float32[g+3]=f,e}}$t.prototype.bytesPerElement=16,wn($t,"StructArrayLayout4f16");class it extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,u,f)}emplace(e,n,s,u,f,g){const b=6*e,S=3*e;return this.uint16[b+0]=n,this.uint16[b+1]=s,this.uint16[b+2]=u,this.uint16[b+3]=f,this.float32[S+2]=g,e}}it.prototype.bytesPerElement=12,wn(it,"StructArrayLayout4ui1f12");class vt extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,s,u)}emplace(e,n,s,u,f){const g=4*e;return this.uint16[g+0]=n,this.uint16[g+1]=s,this.uint16[g+2]=u,this.uint16[g+3]=f,e}}vt.prototype.bytesPerElement=8,wn(vt,"StructArrayLayout4ui8");class Vt extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,s,u,f,g)}emplace(e,n,s,u,f,g,b){const S=6*e;return this.int16[S+0]=n,this.int16[S+1]=s,this.int16[S+2]=u,this.int16[S+3]=f,this.int16[S+4]=g,this.int16[S+5]=b,e}}Vt.prototype.bytesPerElement=12,wn(Vt,"StructArrayLayout6i12");class Rt extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,g,b,S,A,O,z,V){const q=this.length;return this.resize(q+1),this.emplace(q,e,n,s,u,f,g,b,S,A,O,z,V)}emplace(e,n,s,u,f,g,b,S,A,O,z,V,q){const X=12*e;return this.int16[X+0]=n,this.int16[X+1]=s,this.int16[X+2]=u,this.int16[X+3]=f,this.uint16[X+4]=g,this.uint16[X+5]=b,this.uint16[X+6]=S,this.uint16[X+7]=A,this.int16[X+8]=O,this.int16[X+9]=z,this.int16[X+10]=V,this.int16[X+11]=q,e}}Rt.prototype.bytesPerElement=24,wn(Rt,"StructArrayLayout4i4ui4i24");class Kt extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,g){const b=this.length;return this.resize(b+1),this.emplace(b,e,n,s,u,f,g)}emplace(e,n,s,u,f,g,b){const S=10*e,A=5*e;return this.int16[S+0]=n,this.int16[S+1]=s,this.int16[S+2]=u,this.float32[A+2]=f,this.float32[A+3]=g,this.float32[A+4]=b,e}}Kt.prototype.bytesPerElement=20,wn(Kt,"StructArrayLayout3i3f20");class jn extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}jn.prototype.bytesPerElement=4,wn(jn,"StructArrayLayout1ul4");class di extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,g,b,S,A,O,z,V,q){const X=this.length;return this.resize(X+1),this.emplace(X,e,n,s,u,f,g,b,S,A,O,z,V,q)}emplace(e,n,s,u,f,g,b,S,A,O,z,V,q,X){const te=20*e,de=10*e;return this.int16[te+0]=n,this.int16[te+1]=s,this.int16[te+2]=u,this.int16[te+3]=f,this.int16[te+4]=g,this.float32[de+3]=b,this.float32[de+4]=S,this.float32[de+5]=A,this.float32[de+6]=O,this.int16[te+14]=z,this.uint32[de+8]=V,this.uint16[te+18]=q,this.uint16[te+19]=X,e}}di.prototype.bytesPerElement=40,wn(di,"StructArrayLayout5i4f1i1ul2ui40");class Pn extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,g,b){const S=this.length;return this.resize(S+1),this.emplace(S,e,n,s,u,f,g,b)}emplace(e,n,s,u,f,g,b,S){const A=8*e;return this.int16[A+0]=n,this.int16[A+1]=s,this.int16[A+2]=u,this.int16[A+4]=f,this.int16[A+5]=g,this.int16[A+6]=b,this.int16[A+7]=S,e}}Pn.prototype.bytesPerElement=16,wn(Pn,"StructArrayLayout3i2i2i16");class Kn extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,u,f)}emplace(e,n,s,u,f,g){const b=4*e,S=8*e;return this.float32[b+0]=n,this.float32[b+1]=s,this.float32[b+2]=u,this.int16[S+6]=f,this.int16[S+7]=g,e}}Kn.prototype.bytesPerElement=16,wn(Kn,"StructArrayLayout2f1f2i16");class Ui extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,s,u)}emplace(e,n,s,u,f){const g=12*e,b=3*e;return this.uint8[g+0]=n,this.uint8[g+1]=s,this.float32[b+1]=u,this.float32[b+2]=f,e}}Ui.prototype.bytesPerElement=12,wn(Ui,"StructArrayLayout2ub2f12");class Fi extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,s)}emplace(e,n,s,u){const f=3*e;return this.float32[f+0]=n,this.float32[f+1]=s,this.float32[f+2]=u,e}}Fi.prototype.bytesPerElement=12,wn(Fi,"StructArrayLayout3f12");class Bn extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){const u=this.length;return this.resize(u+1),this.emplace(u,e,n,s)}emplace(e,n,s,u){const f=3*e;return this.uint16[f+0]=n,this.uint16[f+1]=s,this.uint16[f+2]=u,e}}Bn.prototype.bytesPerElement=6,wn(Bn,"StructArrayLayout3ui6");class rr extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,g,b,S,A,O,z,V,q,X,te,de,ye,Ie,ve,De,Fe){const Le=this.length;return this.resize(Le+1),this.emplace(Le,e,n,s,u,f,g,b,S,A,O,z,V,q,X,te,de,ye,Ie,ve,De,Fe)}emplace(e,n,s,u,f,g,b,S,A,O,z,V,q,X,te,de,ye,Ie,ve,De,Fe,Le){const rt=30*e,Qe=15*e,yt=60*e;return this.int16[rt+0]=n,this.int16[rt+1]=s,this.int16[rt+2]=u,this.float32[Qe+2]=f,this.float32[Qe+3]=g,this.uint16[rt+8]=b,this.uint16[rt+9]=S,this.uint32[Qe+5]=A,this.uint32[Qe+6]=O,this.uint32[Qe+7]=z,this.uint16[rt+16]=V,this.uint16[rt+17]=q,this.uint16[rt+18]=X,this.float32[Qe+10]=te,this.float32[Qe+11]=de,this.uint8[yt+48]=ye,this.uint8[yt+49]=Ie,this.uint8[yt+50]=ve,this.uint32[Qe+13]=De,this.int16[rt+28]=Fe,this.uint8[yt+58]=Le,e}}rr.prototype.bytesPerElement=60,wn(rr,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Er extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f,g,b,S,A,O,z,V,q,X,te,de,ye,Ie,ve,De,Fe,Le,rt,Qe,yt,qt,lt,St,Ct,Bt){const Xt=this.length;return this.resize(Xt+1),this.emplace(Xt,e,n,s,u,f,g,b,S,A,O,z,V,q,X,te,de,ye,Ie,ve,De,Fe,Le,rt,Qe,yt,qt,lt,St,Ct,Bt)}emplace(e,n,s,u,f,g,b,S,A,O,z,V,q,X,te,de,ye,Ie,ve,De,Fe,Le,rt,Qe,yt,qt,lt,St,Ct,Bt,Xt){const gt=38*e,mn=19*e;return this.int16[gt+0]=n,this.int16[gt+1]=s,this.int16[gt+2]=u,this.float32[mn+2]=f,this.float32[mn+3]=g,this.int16[gt+8]=b,this.int16[gt+9]=S,this.int16[gt+10]=A,this.int16[gt+11]=O,this.int16[gt+12]=z,this.int16[gt+13]=V,this.uint16[gt+14]=q,this.uint16[gt+15]=X,this.uint16[gt+16]=te,this.uint16[gt+17]=de,this.uint16[gt+18]=ye,this.uint16[gt+19]=Ie,this.uint16[gt+20]=ve,this.uint16[gt+21]=De,this.uint16[gt+22]=Fe,this.uint16[gt+23]=Le,this.uint16[gt+24]=rt,this.uint16[gt+25]=Qe,this.uint16[gt+26]=yt,this.uint16[gt+27]=qt,this.uint16[gt+28]=lt,this.uint32[mn+15]=St,this.float32[mn+16]=Ct,this.float32[mn+17]=Bt,this.float32[mn+18]=Xt,e}}Er.prototype.bytesPerElement=76,wn(Er,"StructArrayLayout3i2f6i15ui1ul3f76");class _r extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}_r.prototype.bytesPerElement=4,wn(_r,"StructArrayLayout1f4");class Rr extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,u,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,u,f)}emplace(e,n,s,u,f,g){const b=5*e;return this.float32[b+0]=n,this.float32[b+1]=s,this.float32[b+2]=u,this.float32[b+3]=f,this.float32[b+4]=g,e}}Rr.prototype.bytesPerElement=20,wn(Rr,"StructArrayLayout5f20");class Os extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,u){const f=this.length;return this.resize(f+1),this.emplace(f,e,n,s,u)}emplace(e,n,s,u,f){const g=6*e;return this.uint32[3*e+0]=n,this.uint16[g+2]=s,this.uint16[g+3]=u,this.uint16[g+4]=f,e}}Os.prototype.bytesPerElement=12,wn(Os,"StructArrayLayout1ul3ui12");class Fs extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const u=2*e;return this.uint16[u+0]=n,this.uint16[u+1]=s,e}}Fs.prototype.bytesPerElement=4,wn(Fs,"StructArrayLayout2ui4");class Ua extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}Ua.prototype.bytesPerElement=2,wn(Ua,"StructArrayLayout1ui2");class tl extends Ze{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const u=2*e;return this.float32[u+0]=n,this.float32[u+1]=s,e}}tl.prototype.bytesPerElement=8,wn(tl,"StructArrayLayout2f8");class Ur extends Pe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ur.prototype.size=40;class Lr extends di{get(e){return new Ur(this,e)}}wn(Lr,"CollisionBoxArray");class or extends Pe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}or.prototype.size=60;class bo extends rr{get(e){return new or(this,e)}}wn(bo,"PlacedSymbolArray");class xa extends Pe{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}xa.prototype.size=76;class Kr extends Er{get(e){return new xa(this,e)}}wn(Kr,"SymbolInstanceArray");class Ia extends _r{getoffsetX(e){return this.float32[1*e+0]}}wn(Ia,"GlyphOffsetArray");class mh extends Gt{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}wn(mh,"SymbolLineVertexArray");class xc extends Pe{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}xc.prototype.size=12;class Yc extends Os{get(e){return new xc(this,e)}}wn(Yc,"FeatureIndexArray");class nl extends Fs{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}wn(nl,"FillExtrusionCentroidArray");const il=He([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),zl=He([{name:"a_dash",components:4,type:"Uint16"}]);var Jc={exports:{}},nm=function(t,e){var n,s,u,f,g,b,S,A;for(s=t.length-(n=3&t.length),u=e,g=3432918353,b=461845907,A=0;A<s;)S=255&t.charCodeAt(A)|(255&t.charCodeAt(++A))<<8|(255&t.charCodeAt(++A))<<16|(255&t.charCodeAt(++A))<<24,++A,u=27492+(65535&(f=5*(65535&(u=(u^=S=(65535&(S=(S=(65535&S)*g+(((S>>>16)*g&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295)<<13|u>>>19))+((5*(u>>>16)&65535)<<16)&4294967295))+((58964+(f>>>16)&65535)<<16);switch(S=0,n){case 3:S^=(255&t.charCodeAt(A+2))<<16;case 2:S^=(255&t.charCodeAt(A+1))<<8;case 1:u^=S=(65535&(S=(S=(65535&(S^=255&t.charCodeAt(A)))*g+(((S>>>16)*g&65535)<<16)&4294967295)<<15|S>>>17))*b+(((S>>>16)*b&65535)<<16)&4294967295}return u^=t.length,u=2246822507*(65535&(u^=u>>>16))+((2246822507*(u>>>16)&65535)<<16)&4294967295,u=3266489909*(65535&(u^=u>>>13))+((3266489909*(u>>>16)&65535)<<16)&4294967295,(u^=u>>>16)>>>0},Zg=function(t,e){for(var n,s=t.length,u=e^s,f=0;s>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(f)|(255&t.charCodeAt(++f))<<8|(255&t.charCodeAt(++f))<<16|(255&t.charCodeAt(++f))<<24))+((1540483477*(n>>>16)&65535)<<16),u=1540483477*(65535&u)+((1540483477*(u>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),s-=4,++f;switch(s){case 3:u^=(255&t.charCodeAt(f+2))<<16;case 2:u^=(255&t.charCodeAt(f+1))<<8;case 1:u=1540483477*(65535&(u^=255&t.charCodeAt(f)))+((1540483477*(u>>>16)&65535)<<16)}return u=1540483477*(65535&(u^=u>>>13))+((1540483477*(u>>>16)&65535)<<16),(u^=u>>>15)>>>0};Jc.exports=nm,Jc.exports.murmur3=nm,Jc.exports.murmur2=Zg;var ud=Yt(Jc.exports);class Iu{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,s,u){this.ids.push(im(e)),this.positions.push(n,s,u)}getPositions(e){const n=im(e);let s=0,u=this.ids.length-1;for(;s<u;){const g=s+u>>1;this.ids[g]>=n?u=g:s=g+1}const f=[];for(;this.ids[s]===n;)f.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return f}static serialize(e,n){const s=new Float64Array(e.ids),u=new Uint32Array(e.positions);return Cf(s,u,0,s.length-1),n&&n.push(s.buffer,u.buffer),{ids:s,positions:u}}static deserialize(e){const n=new Iu;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function im(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:ud(String(t))}function Cf(t,e,n,s){for(;n<s;){const u=t[n+s>>1];let f=n-1,g=s+1;for(;;){do{f++}while(t[f]<u);do{g--}while(t[g]>u);if(f>=g)break;hd(t,f,g),hd(e,3*f,3*g),hd(e,3*f+1,3*g+1),hd(e,3*f+2,3*g+2)}g-n<s-g?(Cf(t,e,n,g),n=g+1):(Cf(t,e,g+1,s),s=g)}}function hd(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}wn(Iu,"FeaturePositionMap");class Nl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class dd extends Nl{constructor(e){super(e),this.current=0}set(e,n,s){this.fetchUniformLocation(e,n)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class rm extends Nl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,s){this.fetchUniformLocation(e,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class Pa extends Nl{constructor(e){super(e),this.current=ri.transparent}set(e,n,s){this.fetchUniformLocation(e,n)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const Df=new Float32Array(16),om=new Float32Array(9),Sf=new Float32Array(4);function Ks(t){return[ke(255*t.r,255*t.g),ke(255*t.b,255*t.a)]}class oc{constructor(e,n,s){this.value=e,this.uniformNames=n.map(u=>`u_${u}`),this.type=s}setUniform(e,n,s,u,f){n.set(e,f,u.constantOr(this.value))}getBinding(e,n){return"color"===this.type?new Pa(e):new dd(e)}}class Qc{constructor(e,n){this.uniformNames=n.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,s,u,f){const g="u_pattern"===f||"u_dash"===f?this.pattern:"u_pixel_ratio"===f?this.pixelRatio:null;g&&n.set(e,f,g)}getBinding(e,n){return"u_pattern"===n||"u_dash"===n?new rm(e):new dd(e)}}class Ul{constructor(e,n,s,u){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=n.map(f=>({name:`a_${f}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new u}populatePaintArray(e,n,s,u,f,g){const b=this.paintVertexArray.length,S=this.expression.evaluate(new y(0),n,{},f,u,g);this.paintVertexArray.resize(e),this._setPaintValue(b,e,S)}updatePaintArray(e,n,s,u,f){const g=this.expression.evaluate({zoom:0},s,u,void 0,f);this._setPaintValue(e,n,g)}_setPaintValue(e,n,s){if("color"===this.type){const u=Ks(s);for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,u[0],u[1])}else{for(let u=e;u<n;u++)this.paintVertexArray.emplace(u,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class xl{constructor(e,n,s,u,f,g){this.expression=e,this.uniformNames=n.map(b=>`u_${b}_t`),this.type=s,this.useIntegerZoom=u,this.zoom=f,this.maxValue=0,this.paintVertexAttributes=n.map(b=>({name:`a_${b}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new g}populatePaintArray(e,n,s,u,f,g){const b=this.expression.evaluate(new y(this.zoom),n,{},f,u,g),S=this.expression.evaluate(new y(this.zoom+1),n,{},f,u,g),A=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(A,e,b,S)}updatePaintArray(e,n,s,u,f){const g=this.expression.evaluate({zoom:this.zoom},s,u,void 0,f),b=this.expression.evaluate({zoom:this.zoom+1},s,u,void 0,f);this._setPaintValue(e,n,g,b)}_setPaintValue(e,n,s,u){if("color"===this.type){const f=Ks(s),g=Ks(u);for(let b=e;b<n;b++)this.paintVertexArray.emplace(b,f[0],f[1],g[0],g[1])}else{for(let f=e;f<n;f++)this.paintVertexArray.emplace(f,s,u);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(u))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,s,u,f){const g=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,b=Mt(this.expression.interpolationFactor(g,this.zoom,this.zoom+1),0,1);n.set(e,f,b)}getBinding(e,n){return new dd(e)}}class sc{constructor(e,n,s,u,f){this.expression=e,this.layerId=f,this.paintVertexAttributes=("array"===s?zl:il).members;for(let g=0;g<n.length;++g);this.paintVertexArray=new u}populatePaintArray(e,n,s){const u=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(u,e,n.patterns&&n.patterns[this.layerId],s)}updatePaintArray(e,n,s,u,f,g){this._setPaintValues(e,n,s.patterns&&s.patterns[this.layerId],g)}_setPaintValues(e,n,s,u){if(!u||!s)return;const f=u[s];if(!f)return;const{tl:g,br:b,pixelRatio:S}=f;for(let A=e;A<n;A++)this.paintVertexArray.emplace(A,g[0],g[1],b[0],b[1],S)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class bc{constructor(e,n,s=(()=>!0)){this.binders={},this._buffers=[];const u=[];for(const f in e.paint._values){if(!s(f))continue;const g=e.paint.get(f);if(!(g instanceof ee&&br(g.property.specification)))continue;const b=sm(f,e.type),S=g.value,A=g.property.specification.type,O=!!g.property.useIntegerZoom,z="line-dasharray"===f||f.endsWith("pattern"),V="line-dasharray"===f&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==S.kind||V)if("source"===S.kind||V||z){const q=fd(f,A,"source");this.binders[f]=z?new sc(S,b,A,q,e.id):new Ul(S,b,A,q),u.push(`/a_${f}`)}else{const q=fd(f,A,"composite");this.binders[f]=new xl(S,b,A,O,n,q),u.push(`/z_${f}`)}else this.binders[f]=z?new Qc(S.value,b):new oc(S.value,b,A),u.push(`/u_${f}`)}this.cacheKey=u.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof Ul||n instanceof xl?n.maxValue:0}populatePaintArrays(e,n,s,u,f,g){for(const b in this.binders){const S=this.binders[b];(S instanceof Ul||S instanceof xl||S instanceof sc)&&S.populatePaintArray(e,n,s,u,f,g)}}setConstantPatternPositions(e){for(const n in this.binders){const s=this.binders[n];s instanceof Qc&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,n,s,u,f,g){let b=!1;for(const S in e){const A=n.getPositions(S);for(const O of A){const z=s.feature(O.index);for(const V in this.binders){const q=this.binders[V];if((q instanceof Ul||q instanceof xl||q instanceof sc)&&!0===q.expression.isStateDependent){const X=u.paint.get(V);q.expression=X.value,q.updatePaintArray(O.start,O.end,z,e[S],f,g),b=!0}}}}return b}defines(){const e=[];for(const n in this.binders){const s=this.binders[n];(s instanceof oc||s instanceof Qc)&&e.push(...s.uniformNames.map(u=>`#define HAS_UNIFORM_${u}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof Ul||s instanceof xl||s instanceof sc)for(let u=0;u<s.paintVertexAttributes.length;u++)e.push(s.paintVertexAttributes[u].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof oc||s instanceof Qc||s instanceof xl)for(const u of s.uniformNames)e.push(u)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const s in this.binders){const u=this.binders[s];if(u instanceof oc||u instanceof Qc||u instanceof xl)for(const f of u.uniformNames)n.push({name:f,property:s,binding:u.getBinding(e,f)})}return n}setUniforms(e,n,s,u,f){for(const{name:g,property:b,binding:S}of s)this.binders[b].setUniform(e,S,f,u.get(b),g)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof Ul||n instanceof xl||n instanceof sc)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const s=this.binders[n];(s instanceof Ul||s instanceof xl||s instanceof sc)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof Ul||n instanceof xl||n instanceof sc)&&n.destroy()}}}class Ec{constructor(e,n,s=(()=>!0)){this.programConfigurations={};for(const u of e)this.programConfigurations[u.id]=new bc(u,n,s);this.needsUpload=!1,this._featureMap=new Iu,this._bufferOffset=0}populatePaintArrays(e,n,s,u,f,g,b){for(const S in this.programConfigurations)this.programConfigurations[S].populatePaintArrays(e,n,u,f,g,b);void 0!==n.id&&this._featureMap.add(n.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,s,u,f){for(const g of s)this.needsUpload=this.programConfigurations[g.id].updatePaintArrays(e,this._featureMap,n,g,u,f)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Xg={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function sm(t,e){return Xg[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Kg={"line-pattern":{source:it,composite:it},"fill-pattern":{source:it,composite:it},"fill-extrusion-pattern":{source:it,composite:it},"line-dasharray":{source:vt,composite:vt}},Yg={color:{source:tl,composite:$t},number:{source:_r,composite:tl}};function fd(t,e,n){const s=Kg[t];return s&&s[n]||Yg[e][n]}wn(oc,"ConstantBinder"),wn(Qc,"PatternConstantBinder"),wn(Ul,"SourceExpressionBinder"),wn(sc,"PatternCompositeBinder"),wn(xl,"CompositeExpressionBinder"),wn(bc,"ProgramConfiguration",{omit:["_buffers"]}),wn(Ec,"ProgramConfigurationSet");const pd="-transition";class wl extends $s{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new K(n.layout)),n.paint)){this._transitionablePaint=new M(n.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new le(n.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,s={}){null!=n&&this._validate(Ol,`layers.${this.id}.layout.${e}`,e,n,s)||("visibility"!==e?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return Rn(e,pd)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,s={}){if(null!=n&&this._validate(Zc,`layers.${this.id}.paint.${e}`,e,n,s))return!1;if(Rn(e,pd))return this._transitionablePaint.setTransition(e.slice(0,-11),n||void 0),!1;{const u=this._transitionablePaint._values[e],f=u.value.isDataDriven(),g=u.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const b=this._transitionablePaint._values[e].value,S=b.isDataDriven(),A=Rn(e,"pattern")||"line-dasharray"===e;return S||f||A||this._handleOverridablePaintPropertyUpdate(e,g,b)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,n,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),Hn(e,(n,s)=>!(void 0===n||"layout"===s&&!Object.keys(n).length||"paint"===s&&!Object.keys(n).length))}_validate(e,n,s,u,f={}){return(!f||!1!==f.validate)&&tc(this,e.call(Rs,{key:n,layerType:this.type,objectKey:s,value:u,styleSpec:ft,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof ee&&br(n.property.specification)&&("source"===n.value.kind||"composite"===n.value.kind)&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=ml(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const gh=He([{name:"a_pos",components:2,type:"Int16"}],4),Jg=He([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class No{constructor(e=[]){this.segments=e}prepareSegment(e,n,s,u){let f=this.segments[this.segments.length-1];return e>No.MAX_VERTEX_ARRAY_LENGTH&&hi(`Max vertices per segment is ${No.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!f||f.vertexLength+e>No.MAX_VERTEX_ARRAY_LENGTH||f.sortKey!==u)&&(f={vertexOffset:n.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},void 0!==u&&(f.sortKey=u),this.segments.push(f)),f}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,s,u){return new No([{vertexOffset:e,primitiveOffset:n,vertexLength:s,primitiveLength:u,vaos:{},sortKey:0}])}}No.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,wn(No,"SegmentVector");var Gn=8192;class jl{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Or?new Or(e.lng,e.lat):Or.convert(e),this}setSouthWest(e){return this._sw=e instanceof Or?new Or(e.lng,e.lat):Or.convert(e),this}extend(e){const n=this._sw,s=this._ne;let u,f;if(e instanceof Or)u=e,f=e;else{if(!(e instanceof jl))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(jl.convert(e)):this.extend(Or.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(Or.convert(e)):this;if(u=e._sw,f=e._ne,!u||!f)return this}return n||s?(n.lng=Math.min(u.lng,n.lng),n.lat=Math.min(u.lat,n.lat),s.lng=Math.max(f.lng,s.lng),s.lat=Math.max(f.lat,s.lat)):(this._sw=new Or(u.lng,u.lat),this._ne=new Or(f.lng,f.lat)),this}getCenter(){return new Or((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Or(this.getWest(),this.getNorth())}getSouthEast(){return new Or(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:s}=Or.convert(e);let u=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(u=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&u}static convert(e){return!e||e instanceof jl?e:new jl(e)}}var _h=1e-6,Bs=typeof Float32Array<"u"?Float32Array:Array;function md(){var t=new Bs(9);return Bs!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Af(t,e,n){var s=e[0],u=e[1],f=e[2],g=e[3],b=e[4],S=e[5],A=e[6],O=e[7],z=e[8],V=n[0],q=n[1],X=n[2],te=n[3],de=n[4],ye=n[5],Ie=n[6],ve=n[7],De=n[8];return t[0]=V*s+q*g+X*A,t[1]=V*u+q*b+X*O,t[2]=V*f+q*S+X*z,t[3]=te*s+de*g+ye*A,t[4]=te*u+de*b+ye*O,t[5]=te*f+de*S+ye*z,t[6]=Ie*s+ve*g+De*A,t[7]=Ie*u+ve*b+De*O,t[8]=Ie*f+ve*S+De*z,t}function bl(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function yh(t,e){var n=e[0],s=e[1],u=e[2],f=e[3],g=e[4],b=e[5],S=e[6],A=e[7],O=e[8],z=e[9],V=e[10],q=e[11],X=e[12],te=e[13],de=e[14],ye=e[15],Ie=n*b-s*g,ve=n*S-u*g,De=n*A-f*g,Fe=s*S-u*b,Le=s*A-f*b,rt=u*A-f*S,Qe=O*te-z*X,yt=O*de-V*X,qt=O*ye-q*X,lt=z*de-V*te,St=z*ye-q*te,Ct=V*ye-q*de,Bt=Ie*Ct-ve*St+De*lt+Fe*qt-Le*yt+rt*Qe;return Bt?(t[0]=(b*Ct-S*St+A*lt)*(Bt=1/Bt),t[1]=(u*St-s*Ct-f*lt)*Bt,t[2]=(te*rt-de*Le+ye*Fe)*Bt,t[3]=(V*Le-z*rt-q*Fe)*Bt,t[4]=(S*qt-g*Ct-A*yt)*Bt,t[5]=(n*Ct-u*qt+f*yt)*Bt,t[6]=(de*De-X*rt-ye*ve)*Bt,t[7]=(O*rt-V*De+q*ve)*Bt,t[8]=(g*St-b*qt+A*Qe)*Bt,t[9]=(s*qt-n*St-f*Qe)*Bt,t[10]=(X*Le-te*De+ye*Ie)*Bt,t[11]=(z*De-O*Le-q*Ie)*Bt,t[12]=(b*yt-g*lt-S*Qe)*Bt,t[13]=(n*lt-s*yt+u*Qe)*Bt,t[14]=(te*ve-X*Fe-de*Ie)*Bt,t[15]=(O*Fe-z*ve+V*Ie)*Bt,t):null}function eu(t,e,n){var s=e[0],u=e[1],f=e[2],g=e[3],b=e[4],S=e[5],A=e[6],O=e[7],z=e[8],V=e[9],q=e[10],X=e[11],te=e[12],de=e[13],ye=e[14],Ie=e[15],ve=n[0],De=n[1],Fe=n[2],Le=n[3];return t[0]=ve*s+De*b+Fe*z+Le*te,t[1]=ve*u+De*S+Fe*V+Le*de,t[2]=ve*f+De*A+Fe*q+Le*ye,t[3]=ve*g+De*O+Fe*X+Le*Ie,t[4]=(ve=n[4])*s+(De=n[5])*b+(Fe=n[6])*z+(Le=n[7])*te,t[5]=ve*u+De*S+Fe*V+Le*de,t[6]=ve*f+De*A+Fe*q+Le*ye,t[7]=ve*g+De*O+Fe*X+Le*Ie,t[8]=(ve=n[8])*s+(De=n[9])*b+(Fe=n[10])*z+(Le=n[11])*te,t[9]=ve*u+De*S+Fe*V+Le*de,t[10]=ve*f+De*A+Fe*q+Le*ye,t[11]=ve*g+De*O+Fe*X+Le*Ie,t[12]=(ve=n[12])*s+(De=n[13])*b+(Fe=n[14])*z+(Le=n[15])*te,t[13]=ve*u+De*S+Fe*V+Le*de,t[14]=ve*f+De*A+Fe*q+Le*ye,t[15]=ve*g+De*O+Fe*X+Le*Ie,t}function vh(t,e,n){var s,u,f,g,b,S,A,O,z,V,q,X,te=n[0],de=n[1],ye=n[2];return e===t?(t[12]=e[0]*te+e[4]*de+e[8]*ye+e[12],t[13]=e[1]*te+e[5]*de+e[9]*ye+e[13],t[14]=e[2]*te+e[6]*de+e[10]*ye+e[14],t[15]=e[3]*te+e[7]*de+e[11]*ye+e[15]):(u=e[1],f=e[2],g=e[3],b=e[4],S=e[5],A=e[6],O=e[7],z=e[8],V=e[9],q=e[10],X=e[11],t[0]=s=e[0],t[1]=u,t[2]=f,t[3]=g,t[4]=b,t[5]=S,t[6]=A,t[7]=O,t[8]=z,t[9]=V,t[10]=q,t[11]=X,t[12]=s*te+b*de+z*ye+e[12],t[13]=u*te+S*de+V*ye+e[13],t[14]=f*te+A*de+q*ye+e[14],t[15]=g*te+O*de+X*ye+e[15]),t}function tu(t,e,n){var s=n[0],u=n[1],f=n[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*u,t[5]=e[5]*u,t[6]=e[6]*u,t[7]=e[7]*u,t[8]=e[8]*f,t[9]=e[9]*f,t[10]=e[10]*f,t[11]=e[11]*f,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function Mf(t,e,n){var s=Math.sin(n),u=Math.cos(n),f=e[4],g=e[5],b=e[6],S=e[7],A=e[8],O=e[9],z=e[10],V=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=f*u+A*s,t[5]=g*u+O*s,t[6]=b*u+z*s,t[7]=S*u+V*s,t[8]=A*u-f*s,t[9]=O*u-g*s,t[10]=z*u-b*s,t[11]=V*u-S*s,t}function gd(t,e,n){var s=Math.sin(n),u=Math.cos(n),f=e[0],g=e[1],b=e[2],S=e[3],A=e[8],O=e[9],z=e[10],V=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*u-A*s,t[1]=g*u-O*s,t[2]=b*u-z*s,t[3]=S*u-V*s,t[8]=f*s+A*u,t[9]=g*s+O*u,t[10]=b*s+z*u,t[11]=S*s+V*u,t}function am(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function If(t,e,n){var s,u,f,g=n[0],b=n[1],S=n[2],A=Math.hypot(g,b,S);return A<_h?null:(g*=A=1/A,b*=A,S*=A,s=Math.sin(e),u=Math.cos(e),t[0]=g*g*(f=1-u)+u,t[1]=b*g*f+S*s,t[2]=S*g*f-b*s,t[3]=0,t[4]=g*b*f-S*s,t[5]=b*b*f+u,t[6]=S*b*f+g*s,t[7]=0,t[8]=g*S*f+b*s,t[9]=b*S*f-g*s,t[10]=S*S*f+u,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Pf=eu;function _d(){var t=new Bs(3);return Bs!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function yd(t){var e=new Bs(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function xh(t){return Math.hypot(t[0],t[1],t[2])}function Pu(t,e,n){var s=new Bs(3);return s[0]=t,s[1]=e,s[2]=n,s}function Vl(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function vd(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function Tc(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function ku(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function Ru(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function Wa(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function xd(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t}function zs(t,e){var n=e[0],s=e[1],u=e[2],f=n*n+s*s+u*u;return f>0&&(f=1/Math.sqrt(f)),t[0]=e[0]*f,t[1]=e[1]*f,t[2]=e[2]*f,t}function rl(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function wd(t,e,n){var s=e[0],u=e[1],f=e[2],g=n[0],b=n[1],S=n[2];return t[0]=u*S-f*b,t[1]=f*g-s*S,t[2]=s*b-u*g,t}function Eo(t,e,n){var s=e[0],u=e[1],f=e[2],g=n[3]*s+n[7]*u+n[11]*f+n[15];return t[0]=(n[0]*s+n[4]*u+n[8]*f+n[12])/(g=g||1),t[1]=(n[1]*s+n[5]*u+n[9]*f+n[13])/g,t[2]=(n[2]*s+n[6]*u+n[10]*f+n[14])/g,t}function kf(t,e,n){var s=n[0],u=n[1],f=n[2],g=e[0],b=e[1],S=e[2],A=u*S-f*b,O=f*g-s*S,z=s*b-u*g,V=u*z-f*O,q=f*A-s*z,X=s*O-u*A,te=2*n[3];return O*=te,z*=te,q*=2,X*=2,t[0]=g+(A*=te)+(V*=2),t[1]=b+O+q,t[2]=S+z+X,t}var nu,ol=vd,bd=Tc,Ed=xh;function Rf(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Td(t,e){var n=e[0],s=e[1],u=e[2],f=e[3],g=n*n+s*s+u*u+f*f;return g>0&&(g=1/Math.sqrt(g)),t[0]=n*g,t[1]=s*g,t[2]=u*g,t[3]=f*g,t}function ac(t,e,n){var s=e[0],u=e[1],f=e[2],g=e[3];return t[0]=n[0]*s+n[4]*u+n[8]*f+n[12]*g,t[1]=n[1]*s+n[5]*u+n[9]*f+n[13]*g,t[2]=n[2]*s+n[6]*u+n[10]*f+n[14]*g,t[3]=n[3]*s+n[7]*u+n[11]*f+n[15]*g,t}function Cd(){var t=new Bs(4);return Bs!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function Lu(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function lm(t,e,n){n*=.5;var s=e[0],u=e[1],f=e[2],g=e[3],b=Math.sin(n),S=Math.cos(n);return t[0]=s*S+g*b,t[1]=u*S+f*b,t[2]=f*S-u*b,t[3]=g*S-s*b,t}function Lf(t,e,n){n*=.5;var s=e[0],u=e[1],f=e[2],g=e[3],b=Math.sin(n),S=Math.cos(n);return t[0]=s*S-f*b,t[1]=u*S+g*b,t[2]=f*S+s*b,t[3]=g*S-u*b,t}_d(),nu=new Bs(4),Bs!=Float32Array&&(nu[0]=0,nu[1]=0,nu[2]=0,nu[3]=0);var Qg=Td;_d(),Pu(1,0,0),Pu(0,1,0),Cd(),Cd(),md();const e_=He([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:cm}=e_,Of=He([{name:"a_pos_3",components:3,type:"Int16"}]);var Ou=He([{name:"a_pos",type:"Int16",components:2}]);class Fu{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,s){const u=rl(n,this.dir);if(Math.abs(u)<1e-6)return!1;const f=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/u;return s[0]=this.pos[0]+this.dir[0]*f,s[1]=this.pos[1]+this.dir[1]*f,s[2]=this.pos[2]+this.dir[2]*f,!0}closestPointOnSphere(e,n,s){if(te=(q=this.pos)[0],de=q[1],ye=q[2],Ie=(X=e)[0],ve=X[1],De=X[2],Math.abs(te-Ie)<=_h*Math.max(1,Math.abs(te),Math.abs(Ie))&&Math.abs(de-ve)<=_h*Math.max(1,Math.abs(de),Math.abs(ve))&&Math.abs(ye-De)<=_h*Math.max(1,Math.abs(ye),Math.abs(De))||0===n)return s[0]=s[1]=s[2]=0,!1;var q,X,te,de,ye,Ie,ve,De;const[u,f,g]=this.dir,b=this.pos[0]-e[0],S=this.pos[1]-e[1],A=this.pos[2]-e[2],O=u*u+f*f+g*g,z=2*(b*u+S*f+A*g),V=z*z-4*O*(b*b+S*S+A*A-n*n);if(V<0){const q=Math.max(-z/2,0),X=b+u*q,te=S+f*q,de=A+g*q,ye=Math.hypot(X,te,de);return s[0]=X*n/ye,s[1]=te*n/ye,s[2]=de*n/ye,!1}{const q=(-z-Math.sqrt(V))/(2*O);if(q<0){const X=Math.hypot(b,S,A);return s[0]=b*n/X,s[1]=S*n/X,s[2]=A*n/X,!1}return s[0]=b+u*q,s[1]=S+f*q,s[2]=A+g*q,!0}}}class wh{constructor(e,n,s,u,f){this.TL=e,this.TR=n,this.BR=s,this.BL=u,this.horizon=f}static fromInvProjectionMatrix(e,n,s){const u=[-1,1,1],f=[1,1,1],g=[1,-1,1],b=[-1,-1,1],S=Eo(u,u,e),A=Eo(f,f,e),O=Eo(g,g,e),z=Eo(b,b,e);return new wh(S,A,O,z,n/s)}}class Cc{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,s,u){const f=Math.pow(2,s),g=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(S=>{const A=ac([],S,e),O=1/A[3]/n*f;return(z=A)[0]=(V=A)[0]*(q=[O,O,u?1/A[3]:O,O])[0],z[1]=V[1]*q[1],z[2]=V[2]*q[2],z[3]=V[3]*q[3],z;var z,V,q}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(S=>{const A=zs([],wd([],ol([],g[S[0]],g[S[1]]),ol([],g[S[2]],g[S[1]]))),O=-rl(A,g[S[1]]);return A.concat(O)});return new Cc(g,b)}}class wa{static fromPoints(e){const n=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const u of e)ku(n,n,u),Ru(s,s,u);return new wa(n,s)}static applyTransform(e,n){const s=e.getCorners();for(let u=0;u<s.length;++u)Eo(s[u],s[u],n);return wa.fromPoints(s)}constructor(e,n){this.min=e,this.max=n,this.center=Wa([],Vl([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],s=yd(this.min),u=yd(this.max);for(let f=0;f<n.length;f++)s[f]=n[f]?this.min[f]:this.center[f],u[f]=n[f]?this.center[f]:this.max[f];return u[2]=this.max[2],new wa(s,u)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){const n=this.getCorners();let s=!0;for(let u=0;u<e.planes.length;u++){const f=e.planes[u];let g=0;for(let b=0;b<n.length;b++)g+=rl(f,n[b])+f[3]>=0;if(0===g)return 0;g!==n.length&&(s=!1)}if(s)return 2;for(let u=0;u<3;u++){let f=Number.MAX_VALUE,g=-Number.MAX_VALUE;for(let b=0;b<e.points.length;b++){const S=e.points[b][u]-this.min[u];f=Math.min(f,S),g=Math.max(g,S)}if(g<0||f>this.max[u]-this.min[u])return 0}return 1}}const Ff=5,t_=6,$l=Gn/Math.PI/2,Bf=16383,Bu=[64,32,16],ka=-$l,Va=$l,um=[new wa([ka,ka,ka],[Va,Va,Va]),new wa([ka,ka,ka],[0,0,Va]),new wa([0,ka,ka],[Va,0,Va]),new wa([ka,0,ka],[0,Va,Va]),new wa([0,0,ka],[Va,Va,Va])];function bh(t){return t*$l/Uu}function zf(t,e,n,s=!0){const u=Wa([],t._camera.position,t.worldSize),f=[e,n,1,1];ac(f,f,t.pixelMatrixInverse),Rf(f,f,1/f[3]);const g=zs([],ol([],f,u)),b=t.globeMatrix,S=[b[12],b[13],b[14]],A=ol([],S,u),O=xh(A),z=zs([],A),V=t.worldSize/(2*Math.PI),q=rl(z,g),X=Math.asin(V/O);if(X<Math.acos(q)){if(!s)return null;const qt=[],lt=[];Wa(qt,g,O/q),zs(lt,ol(lt,qt,A)),zs(g,Vl(g,A,Wa(g,lt,Math.tan(X)*O)))}const te=[];new Fu(u,g).closestPointOnSphere(S,V,te);const de=zs([],yr(b,0)),ye=zs([],yr(b,1)),Ie=zs([],yr(b,2)),ve=rl(de,te),De=rl(ye,te),Fe=rl(Ie,te),Le=kt(Math.asin(-De/V));let rt=kt(Math.atan2(ve,Fe));rt=t.center.lng+function(qt,lt){const St=(lt-qt+180)%360-180;return St<-180?St+360:St}(t.center.lng,rt);const Qe=sl(rt),yt=Mt(al(Le),0,1);return new ju(Qe,yt)}class hm{constructor(e,n,s){this.a=ol([],e,s),this.b=ol([],n,s),this.center=s;const u=zs([],this.a),f=zs([],this.b);this.angle=Math.acos(rl(u,f))}}function Nf(t,e){if(0===t.angle)return null;let n;return n=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(s,u,f,g){const b=Math.sin(f);return s*(Math.sin((1-g)*f)/b)+u*(Math.sin(g*f)/b)}(t.a[e],t.b[e],t.angle,Mt(n,0,1))+t.center[e]}function Hl(t){if(t.z<=1)return um[t.z+2*t.y+t.x];const e=Uf(Sc(t));return wa.fromPoints(e)}function ru(t,e,n){return Wa(t,t,1-n),xd(t,t,e,n)}function dm(t,e){const n=Nu(e.zoom);if(0===n)return Hl(t);const s=Sc(t),u=Uf(s),f=sl(s.getWest())*e.worldSize,g=sl(s.getEast())*e.worldSize,b=al(s.getNorth())*e.worldSize,S=al(s.getSouth())*e.worldSize,A=[f,b,0],O=[g,b,0],z=[f,S,0],V=[g,S,0],q=yh([],e.globeMatrix);return Eo(A,A,q),Eo(O,O,q),Eo(z,z,q),Eo(V,V,q),u[0]=ru(u[0],z,n),u[1]=ru(u[1],V,n),u[2]=ru(u[2],O,n),u[3]=ru(u[3],A,n),wa.fromPoints(u)}function fm(t,e,n){for(const s of t)Eo(s,s,e),Wa(s,s,n)}function Sc({x:t,y:e,z:n}){const s=1/(1<<n),u=new Or(ll(t*s),Ns((e+1)*s)),f=new Or(ll((t+1)*s),Ns(e*s));return new jl(u,f)}function Uf(t){const e=tt(t.getNorth()),n=tt(t.getSouth()),s=Math.cos(e),u=Math.cos(n),f=Math.sin(e),g=Math.sin(n),b=t.getWest(),S=t.getEast();return[Eh(u,g,b),Eh(u,g,S),Eh(s,f,S),Eh(s,f,b)]}function Eh(t,e,n,s=$l){return n=tt(n),[t*Math.sin(n)*s,-e*s,t*Math.cos(n)*s]}function Th(t,e,n){return Eh(Math.cos(tt(t)),Math.sin(tt(t)),e,n)}function Dd(t,e,n,s){const u=1<<n.z,f=(t/Gn+n.x)/u;return Th(Ns((e/Gn+n.y)/u),ll(f),s)}function jf({min:t,max:e}){return Bf/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const n_=new Float64Array(16);function zu(t){const e=jf(t),n=am(n_,[e,e,e]);return vh(n,n,((s=[])[0]=-(u=t.min)[0],s[1]=-u[1],s[2]=-u[2],s));var s,u}function Vf(t){const e=(s=t.min,(n=n_)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=s[0],n[13]=s[1],n[14]=s[2],n[15]=1,n);var n,s;const u=1/jf(t);return tu(e,e,[u,u,u])}function pm(t,e,n,s,u){const f=function(S){const A=Gn/(2*Math.PI);return S/(2*Math.PI)/A}(n),g=[t,e,-n/(2*Math.PI)],b=bl(new Float64Array(16));return vh(b,b,g),tu(b,b,[f,f,f]),Mf(b,b,tt(-u)),gd(b,b,tt(-s)),b}function Nu(t){return Bi(Ff,t_,t)}function mm(t,e){const n=Th(e.lat,e.lng);return g=(u=vd([],function(X){const te=Th(X._center.lat,X._center.lng);let de=wd([],Pu(0,1,0),te);const ye=If([],-X.angle,te);de=Eo(de,de,ye),If(ye,-X._pitch,de);const Ie=zs([],te);return Wa(Ie,Ie,bh(X.cameraToCenterDistance/X.pixelsPerMeter)),Eo(Ie,Ie,ye),Vl([],te,Ie)}(t),n))[0],b=u[1],S=u[2],A=(f=n)[0],O=f[1],z=f[2],q=(V=Math.sqrt(g*g+b*b+S*S)*Math.sqrt(A*A+O*O+z*z))&&rl(u,f)/V,Math.acos(Math.min(Math.max(q,-1),1));var u,f,g,b,S,A,O,z,V,q}function Ch(t,e){return mm(t,e)>Math.PI/2*1.01}const Gl=tt(85),Dh=Math.cos(Gl),gm=Math.sin(Gl),Uu=6371008.8,$f=2*Math.PI*Uu;class ou{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ou(qe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,s=this.lat*n,u=e.lat*n,f=Math.sin(s)*Math.sin(u)+Math.cos(s)*Math.cos(u)*Math.cos((e.lng-this.lng)*n);return Uu*Math.acos(Math.min(f,1))}toBounds(e=0){const n=360*e/40075017,s=n/Math.cos(Math.PI/180*this.lat);return new jl(new ou(this.lng-s,this.lat-n),new ou(this.lng+s,this.lat+n))}toEcef(e){const n=bh(e);return Th(this.lat,this.lng,$l+n)}static convert(e){if(e instanceof ou)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new ou(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new ou(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}var Or=ou;function _m(t){return $f*Math.cos(t*Math.PI/180)}function sl(t){return(180+t)/360}function al(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ql(t,e){return t/_m(e)}function ll(t){return 360*t-180}function Ns(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function ym(t,e){return t*_m(Ns(e))}const Ys=85.051129;function vm(t){return 1/Math.cos(t*Math.PI/180)}class ju{constructor(e,n,s=0){this.x=+e,this.y=+n,this.z=+s}static fromLngLat(e,n=0){const s=Or.convert(e);return new ju(sl(s.lng),al(s.lat),ql(n,s.lat))}toLngLat(){return new Or(ll(this.x),Ns(this.y))}toAltitude(){return ym(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/$f*vm(Ns(this.y))}}function Sd(t,e,n,s,u,f,g,b,S){const A=(e+s)/2,O=(n+u)/2,z=new Se(A,O);b(z),function(V,q,X,te,de,ye){const Ie=X-de,ve=te-ye;return Math.abs((te-q)*Ie-(X-V)*ve)/Math.hypot(Ie,ve)}(z.x,z.y,f.x,f.y,g.x,g.y)>=S?(Sd(t,e,n,A,O,f,z,b,S),Sd(t,A,O,s,u,z,g,b,S)):t.push(g)}function Sh(t,e,n){let s=t[0],u=s.x,f=s.y;e(s);const g=[s];for(let b=1;b<t.length;b++){const S=t[b],{x:A,y:O}=S;e(S),Sd(g,u,f,A,O,s,S,e,n),u=A,f=O,s=S}return g}function Hf(t,e,n,s){if(s(e,n)){const u=e.add(n)._mult(.5);Hf(t,e,u,s),Hf(t,u,n,s)}else t.push(n)}function Gf(t,e){let n=t[0];const s=[n];for(let u=1;u<t.length;u++){const f=t[u];Hf(s,n,f,e),n=f}return s}const qf=Math.pow(2,14)-1,ms=-qf-1;function i_(t,e){const n=Math.round(t.x*e),s=Math.round(t.y*e);return t.x=Mt(n,ms,qf),t.y=Mt(s,ms,qf),(n<t.x||n>t.x+1||s<t.y||s>t.y+1)&&hi("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function lc(t,e,n){const s=t.loadGeometry(),u=t.extent,f=Gn/u;if(e&&n&&n.projection.isReprojectedInTileSpace){const g=1<<e.z,{scale:b,x:S,y:A,projection:O}=n,z=V=>{const q=ll((e.x+V.x/u)/g),X=Ns((e.y+V.y/u)/g),te=O.project(q,X);V.x=(te.x*b-S)*u,V.y=(te.y*b-A)*u};for(let V=0;V<s.length;V++)if(1!==t.type)s[V]=Sh(s[V],z,1);else{const q=[];for(const X of s[V])X.x<0||X.x>=u||X.y<0||X.y>=u||(z(X),q.push(X));s[V]=q}}for(const g of s)for(const b of g)i_(b,f);return s}function Ac(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?lc(t):[]}}function Ah(t,e,n,s,u){t.emplaceBack(2*e+(s+1)/2,2*n+(u+1)/2)}function Ad(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class Wf{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new Gt,this.indexArray=new Bn,this.segments=new No,this.programConfigurations=new Ec(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,u){const f=this.layers[0],g=[];let b=null;"circle"===f.type&&(b=f.layout.get("circle-sort-key"));for(const{feature:A,id:O,index:z,sourceLayerIndex:V}of e){const q=this.layers[0]._featureFilter.needGeometry,X=Ac(A,q);if(!this.layers[0]._featureFilter.filter(new y(this.zoom),X,s))continue;const te=b?b.evaluate(X,{},s):void 0,de={id:O,properties:A.properties,type:A.type,sourceLayerIndex:V,index:z,geometry:q?X.geometry:lc(A,s,u),patterns:{},sortKey:te};g.push(de)}b&&g.sort((A,O)=>A.sortKey-O.sortKey);let S=null;"globe"===u.projection.name&&(this.globeExtVertexArray=new Vt,S=u.projection);for(const A of g){const{geometry:O,index:z,sourceLayerIndex:V}=A,q=e[z].feature;this.addFeature(A,O,z,n.availableImages,s,S),n.featureIndex.insert(q,O,z,V,this.index)}}update(e,n,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,gh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Jg.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,s,u,f,g){for(const b of n)for(const S of b){const A=S.x,O=S.y;if(A<0||A>=Gn||O<0||O>=Gn)continue;if(g){const q=g.projectTilePoint(A,O,f),X=g.upVector(f,A,O),te=this.globeExtVertexArray;Ad(te,q,X),Ad(te,q,X),Ad(te,q,X),Ad(te,q,X)}const z=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),V=z.vertexLength;Ah(this.layoutVertexArray,A,O,-1,-1),Ah(this.layoutVertexArray,A,O,1,-1),Ah(this.layoutVertexArray,A,O,1,1),Ah(this.layoutVertexArray,A,O,-1,1),this.indexArray.emplaceBack(V,V+1,V+2),this.indexArray.emplaceBack(V,V+2,V+3),z.vertexLength+=4,z.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},u,f)}}function xm(t,e){for(let n=0;n<t.length;n++)if(Mc(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Mc(t,e[n]))return!0;return!!wm(t,e)}function r_(t,e,n){return!!Mc(t,e)||!!Ih(e,t,n)}function Zf(t,e){if(1===t.length)return Kf(e,t[0]);for(let n=0;n<e.length;n++){const s=e[n];for(let u=0;u<s.length;u++)if(Mc(t,s[u]))return!0}for(let n=0;n<t.length;n++)if(Kf(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(wm(t,e[n]))return!0;return!1}function By(t,e,n){if(t.length>1){if(wm(t,e))return!0;for(let s=0;s<e.length;s++)if(Ih(e[s],t,n))return!0}for(let s=0;s<t.length;s++)if(Ih(t[s],e,n))return!0;return!1}function wm(t,e){if(0===t.length||0===e.length)return!1;for(let n=0;n<t.length-1;n++){const s=t[n],u=t[n+1];for(let f=0;f<e.length-1;f++)if(Mh(s,u,e[f],e[f+1]))return!0}return!1}function Mh(t,e,n,s){return Ht(t,n,s)!==Ht(e,n,s)&&Ht(t,e,n)!==Ht(t,e,s)}function Ih(t,e,n){const s=n*n;if(1===e.length)return t.distSqr(e[0])<s;for(let u=1;u<e.length;u++)if(Xf(t,e[u-1],e[u])<s)return!0;return!1}function Xf(t,e,n){const s=e.distSqr(n);if(0===s)return t.distSqr(e);const u=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/s;return t.distSqr(u<0?e:u>1?n:n.sub(e)._mult(u)._add(e))}function Kf(t,e){let n,s,u,f=!1;for(let g=0;g<t.length;g++){n=t[g];for(let b=0,S=n.length-1;b<n.length;S=b++)s=n[b],u=n[S],s.y>e.y!=u.y>e.y&&e.x<(u.x-s.x)*(e.y-s.y)/(u.y-s.y)+s.x&&(f=!f)}return f}function Mc(t,e){let n=!1;for(let s=0,u=t.length-1;s<t.length;u=s++){const f=t[s],g=t[u];f.y>e.y!=g.y>e.y&&e.x<(g.x-f.x)*(e.y-f.y)/(g.y-f.y)+f.x&&(n=!n)}return n}function bm(t,e,n,s,u){for(const g of t)if(e<=g.x&&n<=g.y&&s>=g.x&&u>=g.y)return!0;const f=[new Se(e,n),new Se(e,u),new Se(s,u),new Se(s,n)];if(t.length>2)for(const g of f)if(Mc(t,g))return!0;for(let g=0;g<t.length-1;g++)if(o_(t[g],t[g+1],f))return!0;return!1}function o_(t,e,n){const s=n[0],u=n[2];if(t.x<s.x&&e.x<s.x||t.x>u.x&&e.x>u.x||t.y<s.y&&e.y<s.y||t.y>u.y&&e.y>u.y)return!1;const f=Ht(t,e,n[0]);return f!==Ht(t,e,n[1])||f!==Ht(t,e,n[2])||f!==Ht(t,e,n[3])}function su(t,e,n){const s=e.paint.get(t).value;return"constant"===s.kind?s.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Ph(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Md(t,e,n,s,u){if(!e[0]&&!e[1])return t;const f=Se.convert(e)._mult(u);"viewport"===n&&f._rotate(-s);const g=[];for(let b=0;b<t.length;b++)g.push(t[b].sub(f));return g}function s_(t,e,n,s){const u=Se.convert(t)._mult(s);return"viewport"===e&&u._rotate(-n),u}wn(Wf,"CircleBucket",{omit:["layers"]});const Yf=new we({"circle-sort-key":new ce(ft.layout_circle["circle-sort-key"])});var a_={paint:new we({"circle-radius":new ce(ft.paint_circle["circle-radius"]),"circle-color":new ce(ft.paint_circle["circle-color"]),"circle-blur":new ce(ft.paint_circle["circle-blur"]),"circle-opacity":new ce(ft.paint_circle["circle-opacity"]),"circle-translate":new Z(ft.paint_circle["circle-translate"]),"circle-translate-anchor":new Z(ft.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Z(ft.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Z(ft.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ce(ft.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ce(ft.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ce(ft.paint_circle["circle-stroke-opacity"])}),layout:Yf};function Id(t,e,n,s,u,f,g,b,S){if(f&&t.queryGeometry.isAboveHorizon)return!1;f&&(S*=t.pixelToTileUnitsFactor);const A=t.tileID.canonical,O=n.projection.upVectorScale(A,n.center.lat,n.worldSize).metersToTile;for(const z of e)for(const V of z){const q=V.add(b),X=u&&n.elevation?n.elevation.exaggeration()*u.getElevationAt(q.x,q.y,!0):0,te=n.projection.projectTilePoint(q.x,q.y,A);if(X>0){const ve=n.projection.upVector(A,q.x,q.y);te.x+=ve[0]*O*X,te.y+=ve[1]*O*X,te.z+=ve[2]*O*X}const de=f?q:Em(te.x,te.y,te.z,s),ye=f?t.tilespaceRays.map(ve=>l_(ve,X)):t.queryGeometry.screenGeometry,Ie=ac([],[te.x,te.y,te.z,1],s);if(!g&&f?S*=Ie[3]/n.cameraToCenterDistance:g&&!f&&(S*=n.cameraToCenterDistance/Ie[3]),f){const ve=Ns((V.y/Gn+A.y)/(1<<A.z));S/=n.projection.pixelsPerMeter(ve,1)/ql(1,ve)}if(r_(ye,de,S))return!0}return!1}function Em(t,e,n,s){const u=ac([],[t,e,n,1],s);return new Se(u[0]/u[3],u[1]/u[3])}const Jf=Pu(0,0,0),au=Pu(0,0,1);function l_(t,e){const n=_d();return Jf[2]=e,t.intersectsPlane(Jf,au,n),new Se(n[0],n[1])}class Pd extends Wf{}function kh(t,{width:e,height:n},s,u){if(u){if(u instanceof Uint8ClampedArray)u=new Uint8Array(u.buffer);else if(u.length!==e*n*s)throw new RangeError("mismatched image size")}else u=new Uint8Array(e*n*s);return t.width=e,t.height=n,t.data=u,t}function Tm(t,e,n){const{width:s,height:u}=e;s===t.width&&u===t.height||(Rh(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,s),height:Math.min(t.height,u)},n),t.width=s,t.height=u,t.data=e.data)}function Rh(t,e,n,s,u,f){if(0===u.width||0===u.height)return e;if(u.width>t.width||u.height>t.height||n.x>t.width-u.width||n.y>t.height-u.height)throw new RangeError("out of range source coordinates for image copy");if(u.width>e.width||u.height>e.height||s.x>e.width-u.width||s.y>e.height-u.height)throw new RangeError("out of range destination coordinates for image copy");const g=t.data,b=e.data;for(let S=0;S<u.height;S++){const A=((n.y+S)*t.width+n.x)*f,O=((s.y+S)*e.width+s.x)*f;for(let z=0;z<u.width*f;z++)b[O+z]=g[A+z]}return e}wn(Pd,"HeatmapBucket",{omit:["layers"]});class cl{constructor(e,n){kh(this,e,1,n)}resize(e){Tm(this,new cl(e),1)}clone(){return new cl({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,u,f){Rh(e,n,s,u,f,1)}}class Cs{constructor(e,n){kh(this,e,4,n)}resize(e){Tm(this,new Cs(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Cs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,u,f){Rh(e,n,s,u,f,4)}}wn(cl,"AlphaImage"),wn(Cs,"RGBAImage");var Cm={paint:new we({"heatmap-radius":new ce(ft.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ce(ft.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Z(ft.paint_heatmap["heatmap-intensity"]),"heatmap-color":new _e(ft.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Z(ft.paint_heatmap["heatmap-opacity"])})};function Lh(t){const e={},n=t.resolution||256,s=t.clips?t.clips.length:1,u=t.image||new Cs({width:n,height:s}),f=(g,b,S)=>{e[t.evaluationKey]=S;const A=t.expression.evaluate(e);u.data[g+b+0]=Math.floor(255*A.r/A.a),u.data[g+b+1]=Math.floor(255*A.g/A.a),u.data[g+b+2]=Math.floor(255*A.b/A.a),u.data[g+b+3]=Math.floor(255*A.a)};if(t.clips)for(let g=0,b=0;g<s;++g,b+=4*n)for(let S=0,A=0;S<n;S++,A+=4){const O=S/(n-1),{start:z,end:V}=t.clips[g];f(b,A,z*(1-O)+V*O)}else for(let g=0,b=0;g<n;g++,b+=4)f(0,b,g/(n-1));return u}var c_={paint:new we({"hillshade-illumination-direction":new Z(ft.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Z(ft.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Z(ft.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Z(ft.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Z(ft.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Z(ft.paint_hillshade["hillshade-accent-color"])})};const u_=He([{name:"a_pos",components:2,type:"Int16"}],4),{members:Dm}=u_;var Ic={exports:{}};function kd(t,e,n){n=n||2;var s,u,f,g,b,S,A,O=e&&e.length,z=O?e[0]*n:t.length,V=Sm(t,0,z,n,!0),q=[];if(!V||V.next===V.prev)return q;if(O&&(V=function(te,de,ye,Ie){var ve,De,Fe,Le=[];for(ve=0,De=de.length;ve<De;ve++)(Fe=Sm(te,de[ve]*Ie,ve<De-1?de[ve+1]*Ie:te.length,Ie,!1))===Fe.next&&(Fe.steiner=!0),Le.push(Vu(Fe));for(Le.sort(zy),ve=0;ve<Le.length;ve++)ye=f_(Le[ve],ye);return ye}(t,e,V,n)),t.length>80*n){s=f=t[0],u=g=t[1];for(var X=n;X<z;X+=n)(b=t[X])<s&&(s=b),(S=t[X+1])<u&&(u=S),b>f&&(f=b),S>g&&(g=S);A=0!==(A=Math.max(f-s,g-u))?32767/A:0}return cu(V,q,n,s,u,A,0),q}function Sm(t,e,n,s,u){var f,g;if(u===uu(t,e,n,s)>0)for(f=e;f<n;f+=s)g=Fd(f,t[f],t[f+1],g);else for(f=n-s;f>=e;f-=s)g=Fd(f,t[f],t[f+1],g);return g&&Rd(g,g.next)&&(zh(g),g=g.next),g}function lu(t,e){if(!t)return t;e||(e=t);var n,s=t;do{if(n=!1,s.steiner||!Rd(s,s.next)&&0!==Mo(s.prev,s,s.next))s=s.next;else{if(zh(s),(s=e=s.prev)===s.next)break;n=!0}}while(n||s!==e);return e}function cu(t,e,n,s,u,f,g){if(t){!g&&f&&function(O,z,V,q){var X=O;do{0===X.z&&(X.z=Qf(X.x,X.y,z,V,q)),X.prevZ=X.prev,X.nextZ=X.next,X=X.next}while(X!==O);X.prevZ.nextZ=null,X.prevZ=null,function(te){var de,ye,Ie,ve,De,Fe,Le,rt,Qe=1;do{for(ye=te,te=null,De=null,Fe=0;ye;){for(Fe++,Ie=ye,Le=0,de=0;de<Qe&&(Le++,Ie=Ie.nextZ);de++);for(rt=Qe;Le>0||rt>0&&Ie;)0!==Le&&(0===rt||!Ie||ye.z<=Ie.z)?(ve=ye,ye=ye.nextZ,Le--):(ve=Ie,Ie=Ie.nextZ,rt--),De?De.nextZ=ve:te=ve,ve.prevZ=De,De=ve;ye=Ie}De.nextZ=null,Qe*=2}while(Fe>1)}(X)}(t,s,u,f);for(var b,S,A=t;t.prev!==t.next;)if(b=t.prev,S=t.next,f?Am(t,s,u,f):h_(t))e.push(b.i/n|0),e.push(t.i/n|0),e.push(S.i/n|0),zh(t),t=S.next,A=S.next;else if((t=S)===A){g?1===g?cu(t=d_(lu(t),e,n),e,n,s,u,f,2):2===g&&Mm(t,e,n,s,u,f):cu(lu(t),e,n,s,u,f,1);break}}}function h_(t){var e=t.prev,n=t,s=t.next;if(Mo(e,n,s)>=0)return!1;for(var u=e.x,f=n.x,g=s.x,b=e.y,S=n.y,A=s.y,O=u<f?u<g?u:g:f<g?f:g,z=b<S?b<A?b:A:S<A?S:A,V=u>f?u>g?u:g:f>g?f:g,q=b>S?b>A?b:A:S>A?S:A,X=s.next;X!==e;){if(X.x>=O&&X.x<=V&&X.y>=z&&X.y<=q&&Wl(u,b,f,S,g,A,X.x,X.y)&&Mo(X.prev,X,X.next)>=0)return!1;X=X.next}return!0}function Am(t,e,n,s){var u=t.prev,f=t,g=t.next;if(Mo(u,f,g)>=0)return!1;for(var b=u.x,S=f.x,A=g.x,O=u.y,z=f.y,V=g.y,q=b<S?b<A?b:A:S<A?S:A,X=O<z?O<V?O:V:z<V?z:V,te=b>S?b>A?b:A:S>A?S:A,de=O>z?O>V?O:V:z>V?z:V,ye=Qf(q,X,e,n,s),Ie=Qf(te,de,e,n,s),ve=t.prevZ,De=t.nextZ;ve&&ve.z>=ye&&De&&De.z<=Ie;){if(ve.x>=q&&ve.x<=te&&ve.y>=X&&ve.y<=de&&ve!==u&&ve!==g&&Wl(b,O,S,z,A,V,ve.x,ve.y)&&Mo(ve.prev,ve,ve.next)>=0||(ve=ve.prevZ,De.x>=q&&De.x<=te&&De.y>=X&&De.y<=de&&De!==u&&De!==g&&Wl(b,O,S,z,A,V,De.x,De.y)&&Mo(De.prev,De,De.next)>=0))return!1;De=De.nextZ}for(;ve&&ve.z>=ye;){if(ve.x>=q&&ve.x<=te&&ve.y>=X&&ve.y<=de&&ve!==u&&ve!==g&&Wl(b,O,S,z,A,V,ve.x,ve.y)&&Mo(ve.prev,ve,ve.next)>=0)return!1;ve=ve.prevZ}for(;De&&De.z<=Ie;){if(De.x>=q&&De.x<=te&&De.y>=X&&De.y<=de&&De!==u&&De!==g&&Wl(b,O,S,z,A,V,De.x,De.y)&&Mo(De.prev,De,De.next)>=0)return!1;De=De.nextZ}return!0}function d_(t,e,n){var s=t;do{var u=s.prev,f=s.next.next;!Rd(u,f)&&Im(u,s,s.next,f)&&Bh(u,f)&&Bh(f,u)&&(e.push(u.i/n|0),e.push(s.i/n|0),e.push(f.i/n|0),zh(s),zh(s.next),s=t=f),s=s.next}while(s!==t);return lu(s)}function Mm(t,e,n,s,u,f){var g=t;do{for(var b=g.next.next;b!==g.prev;){if(g.i!==b.i&&p_(g,b)){var S=Od(g,b);return g=lu(g,g.next),S=lu(S,S.next),cu(g,e,n,s,u,f,0),void cu(S,e,n,s,u,f,0)}b=b.next}g=g.next}while(g!==t)}function zy(t,e){return t.x-e.x}function f_(t,e){var n=function(u,f){var g,b=f,S=u.x,A=u.y,O=-1/0;do{if(A<=b.y&&A>=b.next.y&&b.next.y!==b.y){var z=b.x+(A-b.y)*(b.next.x-b.x)/(b.next.y-b.y);if(z<=S&&z>O&&(O=z,g=b.x<b.next.x?b:b.next,z===S))return g}b=b.next}while(b!==f);if(!g)return null;var V,q=g,X=g.x,te=g.y,de=1/0;b=g;do{S>=b.x&&b.x>=X&&S!==b.x&&Wl(A<te?S:O,A,X,te,A<te?O:S,A,b.x,b.y)&&(V=Math.abs(A-b.y)/(S-b.x),Bh(b,u)&&(V<de||V===de&&(b.x>g.x||b.x===g.x&&Oh(g,b)))&&(g=b,de=V)),b=b.next}while(b!==q);return g}(t,e);if(!n)return e;var s=Od(n,t);return lu(s,s.next),lu(n,n.next)}function Oh(t,e){return Mo(t.prev,t,e.prev)<0&&Mo(e.next,t,t.next)<0}function Qf(t,e,n,s,u){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*u|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*u|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Vu(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Wl(t,e,n,s,u,f,g,b){return(u-g)*(e-b)>=(t-g)*(f-b)&&(t-g)*(s-b)>=(n-g)*(e-b)&&(n-g)*(f-b)>=(u-g)*(s-b)}function p_(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,s){var u=n;do{if(u.i!==n.i&&u.next.i!==n.i&&u.i!==s.i&&u.next.i!==s.i&&Im(u,u.next,n,s))return!0;u=u.next}while(u!==n);return!1}(t,e)&&(Bh(t,e)&&Bh(e,t)&&function(n,s){var u=n,f=!1,g=(n.x+s.x)/2,b=(n.y+s.y)/2;do{u.y>b!=u.next.y>b&&u.next.y!==u.y&&g<(u.next.x-u.x)*(b-u.y)/(u.next.y-u.y)+u.x&&(f=!f),u=u.next}while(u!==n);return f}(t,e)&&(Mo(t.prev,t,e.prev)||Mo(t,e.prev,e))||Rd(t,e)&&Mo(t.prev,t,t.next)>0&&Mo(e.prev,e,e.next)>0)}function Mo(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Rd(t,e){return t.x===e.x&&t.y===e.y}function Im(t,e,n,s){var u=Fh(Mo(t,e,n)),f=Fh(Mo(t,e,s)),g=Fh(Mo(n,s,t)),b=Fh(Mo(n,s,e));return u!==f&&g!==b||!(0!==u||!Ld(t,n,e))||!(0!==f||!Ld(t,s,e))||!(0!==g||!Ld(n,t,s))||!(0!==b||!Ld(n,e,s))}function Ld(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Fh(t){return t>0?1:t<0?-1:0}function Bh(t,e){return Mo(t.prev,t,t.next)<0?Mo(t,e,t.next)>=0&&Mo(t,t.prev,e)>=0:Mo(t,e,t.prev)<0||Mo(t,t.next,e)<0}function Od(t,e){var n=new Nh(t.i,t.x,t.y),s=new Nh(e.i,e.x,e.y),u=t.next,f=e.prev;return t.next=e,e.prev=t,n.next=u,u.prev=n,s.next=n,n.prev=s,f.next=s,s.prev=f,s}function Fd(t,e,n,s){var u=new Nh(t,e,n);return s?(u.next=s.next,u.prev=s,s.next.prev=u,s.next=u):(u.prev=u,u.next=u),u}function zh(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Nh(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function uu(t,e,n,s){for(var u=0,f=e,g=n-s;f<n;f+=s)u+=(t[g]-t[f])*(t[f+1]+t[g+1]),g=f;return u}Ic.exports=kd,Ic.exports.default=kd,kd.deviation=function(t,e,n,s){var u=e&&e.length,f=Math.abs(uu(t,0,u?e[0]*n:t.length,n));if(u)for(var g=0,b=e.length;g<b;g++)f-=Math.abs(uu(t,e[g]*n,g<b-1?e[g+1]*n:t.length,n));var S=0;for(g=0;g<s.length;g+=3){var A=s[g]*n,O=s[g+1]*n,z=s[g+2]*n;S+=Math.abs((t[A]-t[z])*(t[O+1]-t[A+1])-(t[A]-t[O])*(t[z+1]-t[A+1]))}return 0===f&&0===S?0:Math.abs((S-f)/f)},kd.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},s=0,u=0;u<t.length;u++){for(var f=0;f<t[u].length;f++)for(var g=0;g<e;g++)n.vertices.push(t[u][f][g]);u>0&&n.holes.push(s+=t[u-1].length)}return n};var ep=Yt(Ic.exports);function m_(t,e,n,s,u){Pm(t,e,n||0,s||t.length-1,u||g_)}function Pm(t,e,n,s,u){for(;s>n;){if(s-n>600){var f=s-n+1,g=e-n+1,b=Math.log(f),S=.5*Math.exp(2*b/3),A=.5*Math.sqrt(b*S*(f-S)/f)*(g-f/2<0?-1:1);Pm(t,e,Math.max(n,Math.floor(e-g*S/f+A)),Math.min(s,Math.floor(e+(f-g)*S/f+A)),u)}var O=t[e],z=n,V=s;for(Uh(t,n,e),u(t[s],O)>0&&Uh(t,n,s);z<V;){for(Uh(t,z,V),z++,V--;u(t[z],O)<0;)z++;for(;u(t[V],O)>0;)V--}0===u(t[n],O)?Uh(t,n,V):Uh(t,++V,s),V<=e&&(n=V+1),e<=V&&(s=V-1)}}function Uh(t,e,n){var s=t[e];t[e]=t[n],t[n]=s}function g_(t,e){return t<e?-1:t>e?1:0}function tp(t,e){const n=t.length;if(n<=1)return[t];const s=[];let u,f;for(let g=0;g<n;g++){const b=zi(t[g]);0!==b&&(t[g].area=Math.abs(b),void 0===f&&(f=b<0),f===b<0?(u&&s.push(u),u=[t[g]]):u.push(t[g]))}if(u&&s.push(u),e>1)for(let g=0;g<s.length;g++)s[g].length<=e||(m_(s[g],e,1,s[g].length-1,__),s[g]=s[g].slice(0,e));return s}function __(t,e){return e.area-t.area}function Pc(t,e,n){const s=n.patternDependencies;let u=!1;for(const f of e){const g=f.paint.get(`${t}-pattern`);g.isConstant()||(u=!0);const b=g.constantOr(null);b&&(u=!0,s[b]=!0)}return u}function El(t,e,n,s,u){const f=u.patternDependencies;for(const g of e){const b=g.paint.get(`${t}-pattern`).value;if("constant"!==b.kind){let S=b.evaluate({zoom:s},n,{},u.availableImages);S=S&&S.name?S.name:S,f[S]=!0,n.patterns[g.id]=S}}return n}class Bd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Gt,this.indexArray=new Bn,this.indexArray2=new Fs,this.programConfigurations=new Ec(e.layers,e.zoom),this.segments=new No,this.segments2=new No,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,s,u){this.hasPattern=Pc("fill",this.layers,n);const f=this.layers[0].layout.get("fill-sort-key"),g=[];for(const{feature:b,id:S,index:A,sourceLayerIndex:O}of e){const z=this.layers[0]._featureFilter.needGeometry,V=Ac(b,z);if(!this.layers[0]._featureFilter.filter(new y(this.zoom),V,s))continue;const q=f?f.evaluate(V,{},s,n.availableImages):void 0,X={id:S,properties:b.properties,type:b.type,sourceLayerIndex:O,index:A,geometry:z?V.geometry:lc(b,s,u),patterns:{},sortKey:q};g.push(X)}f&&g.sort((b,S)=>b.sortKey-S.sortKey);for(const b of g){const{geometry:S,index:A,sourceLayerIndex:O}=b;if(this.hasPattern){const z=El("fill",this.layers,b,this.zoom,n);this.patternFeatures.push(z)}else this.addFeature(b,S,A,s,{},n.availableImages);n.featureIndex.insert(e[A].feature,S,A,O,this.index)}}update(e,n,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,u)}addFeatures(e,n,s,u,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,n,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Dm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,s,u,f,g=[]){for(const b of tp(n,500)){let S=0;for(const X of b)S+=X.length;const A=this.segments.prepareSegment(S,this.layoutVertexArray,this.indexArray),O=A.vertexLength,z=[],V=[];for(const X of b){if(0===X.length)continue;X!==b[0]&&V.push(z.length/2);const te=this.segments2.prepareSegment(X.length,this.layoutVertexArray,this.indexArray2),de=te.vertexLength;this.layoutVertexArray.emplaceBack(X[0].x,X[0].y),this.indexArray2.emplaceBack(de+X.length-1,de),z.push(X[0].x),z.push(X[0].y);for(let ye=1;ye<X.length;ye++)this.layoutVertexArray.emplaceBack(X[ye].x,X[ye].y),this.indexArray2.emplaceBack(de+ye-1,de+ye),z.push(X[ye].x),z.push(X[ye].y);te.vertexLength+=X.length,te.primitiveLength+=X.length}const q=ep(z,V);for(let X=0;X<q.length;X+=3)this.indexArray.emplaceBack(O+q[X],O+q[X+1],O+q[X+2]);A.vertexLength+=S,A.primitiveLength+=q.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,g,u)}}wn(Bd,"FillBucket",{omit:["layers","patternFeatures"]});const y_=new we({"fill-sort-key":new ce(ft.layout_fill["fill-sort-key"])});var Ny={paint:new we({"fill-antialias":new Z(ft.paint_fill["fill-antialias"]),"fill-opacity":new ce(ft.paint_fill["fill-opacity"]),"fill-color":new ce(ft.paint_fill["fill-color"]),"fill-outline-color":new ce(ft.paint_fill["fill-outline-color"]),"fill-translate":new Z(ft.paint_fill["fill-translate"]),"fill-translate-anchor":new Z(ft.paint_fill["fill-translate-anchor"]),"fill-pattern":new ce(ft.paint_fill["fill-pattern"])}),layout:y_};const Uy=He([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),km=He([{name:"a_centroid_pos",components:2,type:"Uint16"}]),jy=He([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Rm}=Uy;var jh={},v_=an,np=$u;function $u(t,e,n,s,u){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=s,this._values=u,t.readFields(x_,this,e)}function x_(t,e,n){1==t?e.id=n.readVarint():2==t?function(s,u){for(var f=s.readVarint()+s.pos;s.pos<f;){var g=u._keys[s.readVarint()],b=u._values[s.readVarint()];u.properties[g]=b}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function Tl(t){for(var e,n,s=0,u=0,f=t.length,g=f-1;u<f;g=u++)s+=((n=t[g]).x-(e=t[u]).x)*(e.y+n.y);return s}$u.types=["Unknown","Point","LineString","Polygon"],$u.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,s=1,u=0,f=0,g=0,b=[];t.pos<n;){if(u<=0){var S=t.readVarint();s=7&S,u=S>>3}if(u--,1===s||2===s)f+=t.readSVarint(),g+=t.readSVarint(),1===s&&(e&&b.push(e),e=[]),e.push(new v_(f,g));else{if(7!==s)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&b.push(e),b},$u.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,s=0,u=0,f=0,g=1/0,b=-1/0,S=1/0,A=-1/0;t.pos<e;){if(s<=0){var O=t.readVarint();n=7&O,s=O>>3}if(s--,1===n||2===n)(u+=t.readSVarint())<g&&(g=u),u>b&&(b=u),(f+=t.readSVarint())<S&&(S=f),f>A&&(A=f);else if(7!==n)throw new Error("unknown command "+n)}return[g,S,b,A]},$u.prototype.toGeoJSON=function(t,e,n){var s,u,f=this.extent*Math.pow(2,n),g=this.extent*t,b=this.extent*e,S=this.loadGeometry(),A=$u.types[this.type];function O(q){for(var X=0;X<q.length;X++){var te=q[X];q[X]=[360*(te.x+g)/f-180,360/Math.PI*Math.atan(Math.exp((180-360*(te.y+b)/f)*Math.PI/180))-90]}}switch(this.type){case 1:var z=[];for(s=0;s<S.length;s++)z[s]=S[s][0];O(S=z);break;case 2:for(s=0;s<S.length;s++)O(S[s]);break;case 3:for(S=function(q){var X=q.length;if(X<=1)return[q];for(var te,de,ye=[],Ie=0;Ie<X;Ie++){var ve=Tl(q[Ie]);0!==ve&&(void 0===de&&(de=ve<0),de===ve<0?(te&&ye.push(te),te=[q[Ie]]):te.push(q[Ie]))}return te&&ye.push(te),ye}(S),s=0;s<S.length;s++)for(u=0;u<S[s].length;u++)O(S[s][u])}1===S.length?S=S[0]:A="Multi"+A;var V={type:"Feature",geometry:{type:A,coordinates:S},properties:this.properties};return"id"in this&&(V.id=this.id),V};var w_=np,ip=Lm;function Lm(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(b_,this,e),this.length=this._features.length}function b_(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(s){for(var u=null,f=s.readVarint()+s.pos;s.pos<f;){var g=s.readVarint()>>3;u=1===g?s.readString():2===g?s.readFloat():3===g?s.readDouble():4===g?s.readVarint64():5===g?s.readVarint():6===g?s.readSVarint():7===g?s.readBoolean():null}return u}(n))}Lm.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new w_(this._pbf,e,this.extent,this._keys,this._values)};var E_=ip;function T_(t,e,n){if(3===t){var s=new E_(n,n.readVarint()+n.pos);s.length&&(e[s.name]=s)}}var zd=jh.VectorTile=function(t,e){this.layers=t.readFields(T_,{},e)},Nd=jh.VectorTileFeature=np;function Ud(t,e,n,s){const u=[],f=0===s?(g,b,S,A,O,z)=>{g.push(new Se(z,S+(z-b)/(A-b)*(O-S)))}:(g,b,S,A,O,z)=>{g.push(new Se(b+(z-S)/(O-S)*(A-b),z))};for(const g of t){const b=[];for(const S of g){if(S.length<=2)continue;const A=[];for(let V=0;V<S.length-1;V++){const q=S[V].x,X=S[V].y,te=S[V+1].x,de=S[V+1].y,ye=0===s?q:X,Ie=0===s?te:de;ye<e?Ie>e&&f(A,q,X,te,de,e):ye>n?Ie<n&&f(A,q,X,te,de,n):A.push(S[V]),Ie<e&&ye>=e&&f(A,q,X,te,de,e),Ie>n&&ye<=n&&f(A,q,X,te,de,n)}let O=S[S.length-1];const z=0===s?O.x:O.y;z>=e&&z<=n&&A.push(O),A.length&&(O=A[A.length-1],A[0].x===O.x&&A[0].y===O.y||A.push(A[0]),b.push(A))}b.length&&u.push(b)}return u}jh.VectorTileLayer=ip;const C_=Nd.types,$i=Math.pow(2,13);function Hu(t,e,n,s,u,f,g,b){t.emplaceBack((e<<1)+g,(n<<1)+f,(Math.floor(s*$i)<<1)+u,Math.round(b))}function Gu(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class rp{constructor(){this.acc=new Se(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Se(e.x,e.y),this.max=new Se(e.x,e.y))}append(e,n){this.currentPolyCount.edges++,this.acc._add(e);const s=this.min,u=this.max;e.x<s.x?s.x=e.x:e.x>u.x&&(u.x=e.x),e.y<s.y?s.y=e.y:e.y>u.y&&(u.y=e.y),((0===e.x||e.x===Gn)&&e.x===n.x)!=((0===e.y||e.y===Gn)&&e.y===n.y)&&this.processBorderOverlap(e,n),n.x<0!=e.x<0&&this.addBorderIntersection(0,mi(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>Gn!=e.x>Gn&&this.addBorderIntersection(1,mi(n.y,e.y,(Gn-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,mi(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>Gn!=e.y>Gn&&this.addBorderIntersection(3,mi(n.x,e.x,(Gn-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];n<s[0]&&(s[0]=n),n>s[1]&&(s[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const s=0===e.x?0:1;this.addBorderIntersection(s,n.y),this.addBorderIntersection(s,e.y)}else{const s=0===e.y?2:3;this.addBorderIntersection(s,n.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((n,s)=>n+s.edges,0);return 0!==e?this.acc.div(e)._round():new Se(0,0)}span(){return new Se(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0)}}class Vh{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new wt,this.centroidVertexArray=new nl,this.indexArray=new Bn,this.programConfigurations=new Ec(e.layers,e.zoom),this.segments=new No,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=e.enableTerrain}populate(e,n,s,u){this.features=[],this.hasPattern=Pc("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(f){const g=Math.exp(Math.PI*(1-f.y/(1<<f.z)*2));return 80150034*g/(g*g+1)/Gn/(1<<f.z)}(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:f,id:g,index:b,sourceLayerIndex:S}of e){const A=this.layers[0]._featureFilter.needGeometry,O=Ac(f,A);if(!this.layers[0]._featureFilter.filter(new y(this.zoom),O,s))continue;const z={id:g,sourceLayerIndex:S,index:b,geometry:A?O.geometry:lc(f,s,u),properties:f.properties,type:f.type,patterns:{}},V=this.layoutVertexArray.length;this.hasPattern?this.features.push(El("fill-extrusion",this.layers,z,this.zoom,n)):this.addFeature(z,z.geometry,b,s,{},n.availableImages,u),n.featureIndex.insert(f,z.geometry,b,S,this.index,V)}this.sortBorders()}addFeatures(e,n,s,u,f){for(const g of this.features){const{geometry:b}=g;this.addFeature(g,b,g.index,n,s,u,f)}this.sortBorders()}update(e,n,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Rm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,jy.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,km.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,s,u,f,g,b){const S=[new Se(0,0),new Se(Gn,Gn)],A=b.projection,O="globe"===A.name,z=this.enableTerrain&&!O?new rp:null,V="Polygon"===C_[e.type];O&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Vt);const q=tp(n,500);for(let ye=q.length-1;ye>=0;ye--){const Ie=q[ye];(0===Ie.length||(X=Ie[0]).every(ve=>ve.x<=0)||X.every(ve=>ve.x>=Gn)||X.every(ve=>ve.y<=0)||X.every(ve=>ve.y>=Gn))&&q.splice(ye,1)}var X;let te;if(O)te=sp(q,S,u);else{te=[];for(const ye of q)te.push({polygon:ye,bounds:S})}const de=V?this.edgeRadius:0;for(const{polygon:ye,bounds:Ie}of te){let ve=0,De=0;for(const Le of ye)V&&!Le[0].equals(Le[Le.length-1])&&Le.push(Le[0]),De+=V?Le.length-1:Le.length;const Fe=this.segments.prepareSegment((V?5:4)*De,this.layoutVertexArray,this.indexArray);if(V){const Le=[],rt=[];ve=Fe.vertexLength;for(const yt of ye){let qt,lt;yt.length&&yt!==ye[0]&&rt.push(Le.length/2),qt=yt[1].sub(yt[0])._perp()._unit();for(let St=1;St<yt.length;St++){const Ct=yt[St],Bt=yt[St===yt.length-1?1:St+1];let{x:Xt,y:gt}=Ct;if(de){lt=Bt.sub(Ct)._perp()._unit();const mn=qt.add(lt)._unit(),Mn=de*Math.min(4,1/(qt.x*mn.x+qt.y*mn.y));Xt+=Mn*mn.x,gt+=Mn*mn.y,qt=lt}Hu(this.layoutVertexArray,Xt,gt,0,0,1,1,0),Fe.vertexLength++,Le.push(Ct.x,Ct.y),O&&Gu(this.layoutVertexExtArray,A.projectTilePoint(Xt,gt,u),A.upVector(u,Xt,gt))}}const Qe=ep(Le,rt);for(let yt=0;yt<Qe.length;yt+=3)this.indexArray.emplaceBack(ve+Qe[yt],ve+Qe[yt+2],ve+Qe[yt+1]),Fe.primitiveLength++}for(const Le of ye){z&&Le.length&&z.startRing(Le[0]);let rt,Qe,yt,qt=Le.length>4&&zm(Le[Le.length-2],Le[0],Le[1]),lt=de?Fm(Le[Le.length-2],Le[0],Le[1],de):0;Qe=Le[1].sub(Le[0])._perp()._unit();let St=!0;for(let Ct=1,Bt=0;Ct<Le.length;Ct++){let Xt=Le[Ct-1],gt=Le[Ct];const mn=Le[Ct===Le.length-1?1:Ct+1];if(z&&V&&z.currentPolyCount.top++,op(gt,Xt,Ie)){de&&(Qe=mn.sub(gt)._perp()._unit(),St=!St);continue}z&&z.append(gt,Xt);const Mn=gt.sub(Xt)._perp(),yn=Mn.x/(Math.abs(Mn.x)+Math.abs(Mn.y)),gi=Mn.y>0?1:0,Jt=Xt.dist(gt);if(Bt+Jt>32768&&(Bt=0),de){yt=mn.sub(gt)._perp()._unit();let wi=Bm(Xt,gt,mn,Om(Qe,yt),de);isNaN(wi)&&(wi=0);const Qn=gt.sub(Xt)._unit();Xt=Xt.add(Qn.mult(lt))._round(),gt=gt.add(Qn.mult(-wi))._round(),lt=wi,Qe=yt}const Vn=Fe.vertexLength,_i=Le.length>4&&zm(Xt,gt,mn);let er=Nm(Bt,qt,St);if(Hu(this.layoutVertexArray,Xt.x,Xt.y,yn,gi,0,0,er),Hu(this.layoutVertexArray,Xt.x,Xt.y,yn,gi,0,1,er),Bt+=Jt,er=Nm(Bt,_i,!St),qt=_i,Hu(this.layoutVertexArray,gt.x,gt.y,yn,gi,0,0,er),Hu(this.layoutVertexArray,gt.x,gt.y,yn,gi,0,1,er),Fe.vertexLength+=4,this.indexArray.emplaceBack(Vn+0,Vn+1,Vn+2),this.indexArray.emplaceBack(Vn+1,Vn+3,Vn+2),Fe.primitiveLength+=2,de){const wi=ve+(1===Ct?Le.length-2:Ct-2),Qn=1===Ct?ve:wi+1;if(this.indexArray.emplaceBack(Vn+1,wi,Vn+3),this.indexArray.emplaceBack(wi,Qn,Vn+3),Fe.primitiveLength+=2,void 0===rt&&(rt=Vn),!op(mn,Le[Ct],Ie)){const jr=Ct===Le.length-1?rt:Fe.vertexLength;this.indexArray.emplaceBack(Vn+2,Vn+3,jr),this.indexArray.emplaceBack(Vn+3,jr+1,jr),this.indexArray.emplaceBack(Vn+3,Qn,jr+1),Fe.primitiveLength+=3}St=!St}if(O){const wi=this.layoutVertexExtArray,Qn=A.projectTilePoint(Xt.x,Xt.y,u),jr=A.projectTilePoint(gt.x,gt.y,u),Ci=A.upVector(u,Xt.x,Xt.y),Di=A.upVector(u,gt.x,gt.y);Gu(wi,Qn,Ci),Gu(wi,Qn,Ci),Gu(wi,jr,Di),Gu(wi,jr,Di)}}V&&(ve+=Le.length-1)}}if(z&&z.polyCount.length>0){if(z.borders){z.vertexArrayOffset=this.centroidVertexArray.length;const ye=z.borders,Ie=this.featuresOnBorder.push(z)-1;for(let ve=0;ve<4;ve++)ye[ve][0]!==Number.MAX_VALUE&&this.borders[ve].push(Ie)}this.encodeCentroid(z.borders?void 0:z.centroid(),z)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,g,u)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((n,s)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,n,s=!0){let u,f;if(e)if(0!==e.y){const b=n.span()._mult(this.tileToMeter);u=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(b.x/10)),f=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(b.y/10))}else u=Math.ceil(7*(e.x+450)),f=0;else u=0,f=+s;let g=s?this.centroidVertexArray.length:n.vertexArrayOffset;for(const b of n.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*b.edges+b.top);for(let S=0;S<b.top;S++)this.centroidVertexArray.emplace(g++,u,f);for(let S=0;S<2*b.edges;S++)this.centroidVertexArray.emplace(g++,0,f),this.centroidVertexArray.emplace(g++,u,f)}}}function Om(t,e){const n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function Fm(t,e,n,s){const u=e.sub(t)._perp()._unit(),f=n.sub(e)._perp()._unit();return Bm(t,e,n,Om(u,f),s)}function Bm(t,e,n,s,u){const f=Math.sqrt(1-s*s);return Math.min(t.dist(e)/3,e.dist(n)/3,u*f/s)}function op(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function zm(t,e,n){if(t.x<0||t.x>=Gn||e.x<0||e.x>=Gn||n.x<0||n.x>=Gn)return!1;const s=n.sub(e),u=s.perp(),f=t.sub(e);return(s.x*f.x+s.y*f.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(f.x*f.x+f.y*f.y))>-.866&&u.x*f.x+u.y*f.y<0}function Nm(t,e,n){const s=e?2|t:-3&t;return n?1|s:-2&s}function D_(){const t=Math.PI/32,e=Math.tan(t),n=Uu;return n*Math.sqrt(1+2*e*e)-n}function sp(t,e,n){const s=1<<n.z,u=ll(n.x/s),f=ll((n.x+1)/s),g=Ns(n.y/s),b=Ns((n.y+1)/s);return function(S,A,O,z,V=0,q){const X=[];if(!S.length||!O||!z)return X;const te=(Le,rt)=>{for(const Qe of Le)X.push({polygon:Qe,bounds:rt})},de=Math.ceil(Math.log2(O)),ye=Math.ceil(Math.log2(z)),Ie=de-ye,ve=[];for(let Le=0;Le<Math.abs(Ie);Le++)ve.push(Ie>0?0:1);for(let Le=0;Le<Math.min(de,ye);Le++)ve.push(0),ve.push(1);let De=S;if(De=Ud(De,A[0].y-V,A[1].y+V,1),De=Ud(De,A[0].x-V,A[1].x+V,0),!De.length)return X;const Fe=[];for(ve.length?Fe.push({polygons:De,bounds:A,depth:0}):te(De,A);Fe.length;){const Le=Fe.pop(),rt=Le.depth,Qe=ve[rt],yt=Le.bounds[0],qt=Le.bounds[1],lt=0===Qe?yt.x:yt.y,St=0===Qe?qt.x:qt.y,Ct=q?q(Qe,lt,St):.5*(lt+St),Bt=Ud(Le.polygons,lt-V,Ct+V,Qe),Xt=Ud(Le.polygons,Ct-V,St+V,Qe);if(Bt.length){const gt=[yt,new Se(0===Qe?Ct:qt.x,1===Qe?Ct:qt.y)];ve.length>rt+1?Fe.push({polygons:Bt,bounds:gt,depth:rt+1}):te(Bt,gt)}if(Xt.length){const gt=[new Se(0===Qe?Ct:yt.x,1===Qe?Ct:yt.y),qt];ve.length>rt+1?Fe.push({polygons:Xt,bounds:gt,depth:rt+1}):te(Xt,gt)}}return X}(t,e,Math.ceil((f-u)/11.25),Math.ceil((g-b)/11.25),1,(S,A,O)=>{if(0===S)return.5*(A+O);{const z=Ns((n.y+A/Gn)/s);return(al(.5*(Ns((n.y+O/Gn)/s)+z))*s-n.y)*Gn}})}wn(Vh,"FillExtrusionBucket",{omit:["layers","features"]}),wn(rp,"PartMetadata");const Um=new we({"fill-extrusion-edge-radius":new Z(ft["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var hu={paint:new we({"fill-extrusion-opacity":new Z(ft["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ce(ft["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Z(ft["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Z(ft["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new ce(ft["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ce(ft["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ce(ft["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Z(ft["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Z(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Z(ft["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-rounded-roof":new Z(ft["paint_fill-extrusion"]["fill-extrusion-rounded-roof"])}),layout:Um};function jm(t,e,n){var s=2*Math.PI*6378137/256/Math.pow(2,n);return[t*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class qu{constructor(e,n,s){this.z=e,this.x=n,this.y=s,this.key=Vd(0,e,e,n,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const s=(g=this.y,b=this.z,S=jm(256*(f=this.x),256*(g=Math.pow(2,b)-g-1),b),A=jm(256*(f+1),256*(g+1),b),S[0]+","+S[1]+","+A[0]+","+A[1]),u=function(f,g,b){let S,A="";for(let O=f;O>0;O--)S=1<<O-1,A+=(g&S?1:0)+(b&S?2:0);return A}(this.z,this.x,this.y);var f,g,b,S,A;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class jd{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Vd(e,n.z,n.z,n.x,n.y)}}class ba{constructor(e,n,s,u,f){this.overscaledZ=e,this.wrap=n,this.canonical=new qu(s,+u,+f),this.key=0===n&&e===s?this.canonical.key:Vd(n,e,s,u,f)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new ba(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ba(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Vd(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Vd(this.wrap*+n,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new ba(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,s=2*this.canonical.x,u=2*this.canonical.y;return[new ba(n,this.wrap,n,s,u),new ba(n,this.wrap,n,s+1,u),new ba(n,this.wrap,n,s,u+1),new ba(n,this.wrap,n,s+1,u+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new ba(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new ba(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new jd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Vd(t,e,n,s,u){const f=1<<Math.min(n,22);let g=f*(u%f)+s%f;return t&&n<22&&(g+=f*f*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*g+n)+(e-n)}wn(qu,"CanonicalTileID"),wn(ba,"OverscaledTileID",{omit:["projMatrix"]});class $h extends Se{constructor(e,n,s){super(e,n),this.z=s}}function $d(t,e){return t.x*e.x+t.y*e.y}function Vm(t,e){if(1===t.length){let n=0;const s=e[n++];let u;for(;!u||s.equals(u);)if(u=e[n++],!u)return 1/0;for(;n<e.length;n++){const f=e[n],g=t[0],b=u.sub(s),S=f.sub(s),A=g.sub(s),O=$d(b,b),z=$d(b,S),V=$d(S,S),q=$d(A,b),X=$d(A,S),te=O*V-z*z,de=(V*q-z*X)/te,ye=(O*X-z*q)/te,Ie=s.z*(1-de-ye)+u.z*de+f.z*ye;if(isFinite(Ie))return Ie}return 1/0}{let n=1/0;for(const s of e)n=Math.min(n,s.z);return n}}function ap(t,e,n,s,u,f,g,b){const S=g*u.getElevationAt(t,e,!0,!0),A=0!==f[0],O=A?0===f[1]?g*(f[0]/7-450):g*function(z,V,q){const X=Math.floor(V[0]/8),te=Math.floor(V[1]/8),de=10*(V[0]-8*X),ye=10*(V[1]-8*te),Ie=z.getElevationAt(X,te,!0,!0),ve=z.getMeterToDEM(q),De=Math.floor(.5*(de*ve-1)),Fe=Math.floor(.5*(ye*ve-1)),Le=z.tileCoordToPixel(X,te),rt=2*De+1,Qe=2*Fe+1,yt=(Mn=rt,yn=Qe,[(Xt=z).getElevationAtPixel(gt=Le.x-De,mn=Le.y-Fe,!0),Xt.getElevationAtPixel(gt+yn,mn,!0),Xt.getElevationAtPixel(gt,mn+yn,!0),Xt.getElevationAtPixel(gt+Mn,mn+yn,!0)]),qt=Math.abs(yt[0]-yt[1]),lt=Math.abs(yt[2]-yt[3]),St=Math.abs(yt[0]-yt[2])+Math.abs(yt[1]-yt[3]),Ct=Math.min(.25,.5*ve*(qt+lt)/rt),Bt=Math.min(.25,.5*ve*St/Qe);var Xt,gt,mn,Mn,yn;return Ie+Math.max(Ct*de,Bt*ye)}(u,f,b):S;return{base:S+(0===n)?-1:n,top:A?Math.max(O+s,S+n+2):S+s}}const Vy=He([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:S_}=Vy,Wu=He([{name:"a_packed",components:4,type:"Float32"}]),{members:A_}=Wu,$m=Nd.types,Hd=Math.cos(Math.PI/180*37.5);class Gd{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new ct,this.layoutVertexArray2=new $t,this.indexArray=new Bn,this.programConfigurations=new Ec(e.layers,e.zoom),this.segments=new No,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,u){this.hasPattern=Pc("line",this.layers,n);const f=this.layers[0].layout.get("line-sort-key"),g=[];for(const{feature:O,id:z,index:V,sourceLayerIndex:q}of e){const X=this.layers[0]._featureFilter.needGeometry,te=Ac(O,X);if(!this.layers[0]._featureFilter.filter(new y(this.zoom),te,s))continue;const de=f?f.evaluate(te,{},s):void 0,ye={id:z,properties:O.properties,type:O.type,sourceLayerIndex:q,index:V,geometry:X?te.geometry:lc(O,s,u),patterns:{},sortKey:de};g.push(ye)}f&&g.sort((O,z)=>O.sortKey-z.sortKey);const{lineAtlas:b,featureIndex:S}=n,A=this.addConstantDashes(b);for(const O of g){const{geometry:z,index:V,sourceLayerIndex:q}=O;if(A&&this.addFeatureDashes(O,b),this.hasPattern){const X=El("line",this.layers,O,this.zoom,n);this.patternFeatures.push(X)}else this.addFeature(O,z,V,s,b.positions,n.availableImages);S.insert(e[V].feature,z,V,q,this.index)}}addConstantDashes(e){let n=!1;for(const s of this.layers){const u=s.paint.get("line-dasharray").value,f=s.layout.get("line-cap").value;if("constant"!==u.kind||"constant"!==f.kind)n=!0;else{const g=f.value,b=u.value;if(!b)continue;e.addDash(b,g)}}return n}addFeatureDashes(e,n){const s=this.zoom;for(const u of this.layers){const f=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if("constant"===f.kind&&"constant"===g.kind)continue;let b,S;if("constant"===f.kind){if(b=f.value,!b)continue}else b=f.evaluate({zoom:s},e);S="constant"===g.kind?g.value:g.evaluate({zoom:s},e),n.addDash(b,S),e.patterns[u.id]=n.getKey(b,S)}}update(e,n,s,u){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,u)}addFeatures(e,n,s,u,f){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,n,s,u)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,A_)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,S_),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,s,u,f,g){const b=this.layers[0].layout,S=b.get("line-join").evaluate(e,{}),A=b.get("line-cap").evaluate(e,{}),O=b.get("line-miter-limit"),z=b.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const V of n)this.addLine(V,e,S,A,O,z);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,f,g,u)}addLine(e,n,s,u,f,g){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ye=0;ye<e.length-1;ye++)this.totalDistance+=e[ye].dist(e[ye+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const b="Polygon"===$m[n.type];let S=e.length;for(;S>=2&&e[S-1].equals(e[S-2]);)S--;let A=0;for(;A<S-1&&e[A].equals(e[A+1]);)A++;if(S<(b?3:2))return;"bevel"===s&&(f=1.05);const O=this.overscaling<=16?15*Gn/(512*this.overscaling):0,z=this.segments.prepareSegment(10*S,this.layoutVertexArray,this.indexArray);let V,q,X,te,de;this.e1=this.e2=-1,b&&(V=e[S-2],de=e[A].sub(V)._unit()._perp());for(let ye=A;ye<S;ye++){if(X=ye===S-1?b?e[A+1]:void 0:e[ye+1],X&&e[ye].equals(X))continue;de&&(te=de),V&&(q=V),V=e[ye],de=X?X.sub(V)._unit()._perp():te,te=te||de;let Ie=te.add(de);0===Ie.x&&0===Ie.y||Ie._unit();const ve=te.x*de.x+te.y*de.y,De=Ie.x*de.x+Ie.y*de.y,Fe=0!==De?1/De:1/0,Le=2*Math.sqrt(2-2*De),rt=De<Hd&&q&&X,Qe=te.x*de.y-te.y*de.x>0;if(rt&&ye>A){const lt=V.dist(q);if(lt>2*O){const St=V.sub(V.sub(q)._mult(O/lt)._round());this.updateDistance(q,St),this.addCurrentVertex(St,te,0,0,z),q=St}}const yt=q&&X;let qt=yt?s:b?"butt":u;if(yt&&"round"===qt&&(Fe<g?qt="miter":Fe<=2&&(qt="fakeround")),"miter"===qt&&Fe>f&&(qt="bevel"),"bevel"===qt&&(Fe>2&&(qt="flipbevel"),Fe<f&&(qt="miter")),q&&this.updateDistance(q,V),"miter"===qt)Ie._mult(Fe),this.addCurrentVertex(V,Ie,0,0,z);else if("flipbevel"===qt){if(Fe>100)Ie=de.mult(-1);else{const lt=Fe*te.add(de).mag()/te.sub(de).mag();Ie._perp()._mult(lt*(Qe?-1:1))}this.addCurrentVertex(V,Ie,0,0,z),this.addCurrentVertex(V,Ie.mult(-1),0,0,z)}else if("bevel"===qt||"fakeround"===qt){const lt=-Math.sqrt(Fe*Fe-1),St=Qe?lt:0,Ct=Qe?0:lt;if(q&&this.addCurrentVertex(V,te,St,Ct,z),"fakeround"===qt){const Bt=Math.round(180*Le/Math.PI/20);for(let Xt=1;Xt<Bt;Xt++){let gt=Xt/Bt;if(.5!==gt){const Mn=gt-.5;gt+=gt*Mn*(gt-1)*((1.0904+ve*(ve*(3.55645-1.43519*ve)-3.2452))*Mn*Mn+(.848013+ve*(.215638*ve-1.06021)))}const mn=de.sub(te)._mult(gt)._add(te)._unit()._mult(Qe?-1:1);this.addHalfVertex(V,mn.x,mn.y,!1,Qe,0,z)}}X&&this.addCurrentVertex(V,de,-St,-Ct,z)}else if("butt"===qt)this.addCurrentVertex(V,Ie,0,0,z);else if("square"===qt){const lt=q?1:-1;q||this.addCurrentVertex(V,Ie,lt,lt,z),this.addCurrentVertex(V,Ie,0,0,z),q&&this.addCurrentVertex(V,Ie,lt,lt,z)}else"round"===qt&&(q&&(this.addCurrentVertex(V,te,0,0,z),this.addCurrentVertex(V,te,1,1,z,!0)),X&&(this.addCurrentVertex(V,de,-1,-1,z,!0),this.addCurrentVertex(V,de,0,0,z)));if(rt&&ye<S-1){const lt=V.dist(X);if(lt>2*O){const St=V.add(X.sub(V)._mult(O/lt)._round());this.updateDistance(V,St),this.addCurrentVertex(St,de,0,0,z),V=St}}}}addCurrentVertex(e,n,s,u,f,g=!1){const b=n.y*u-n.x,S=-n.y-n.x*u;this.addHalfVertex(e,n.x+n.y*s,n.y-n.x*s,g,!1,s,f),this.addHalfVertex(e,b,S,g,!0,-u,f)}addHalfVertex({x:e,y:n},s,u,f,g,b,S){this.layoutVertexArray.emplaceBack((e<<1)+(f?1:0),(n<<1)+(g?1:0),Math.round(63*s)+128,Math.round(63*u)+128,1+(0===b?0:b<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const A=S.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),S.primitiveLength++),g?this.e2=A:this.e1=A}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}wn(Gd,"LineBucket",{omit:["layers","patternFeatures"]});const Hm=new we({"line-cap":new ce(ft.layout_line["line-cap"]),"line-join":new ce(ft.layout_line["line-join"]),"line-miter-limit":new Z(ft.layout_line["line-miter-limit"]),"line-round-limit":new Z(ft.layout_line["line-round-limit"]),"line-sort-key":new ce(ft.layout_line["line-sort-key"])});var Gm={paint:new we({"line-opacity":new ce(ft.paint_line["line-opacity"]),"line-color":new ce(ft.paint_line["line-color"]),"line-translate":new Z(ft.paint_line["line-translate"]),"line-translate-anchor":new Z(ft.paint_line["line-translate-anchor"]),"line-width":new ce(ft.paint_line["line-width"]),"line-gap-width":new ce(ft.paint_line["line-gap-width"]),"line-offset":new ce(ft.paint_line["line-offset"]),"line-blur":new ce(ft.paint_line["line-blur"]),"line-dasharray":new ce(ft.paint_line["line-dasharray"]),"line-pattern":new ce(ft.paint_line["line-pattern"]),"line-gradient":new _e(ft.paint_line["line-gradient"]),"line-trim-offset":new Z(ft.paint_line["line-trim-offset"])}),layout:Hm};const qm=new class extends ce{possiblyEvaluate(t,e){return e=new y(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,s){return e=Dt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,s)}}(Gm.paint.properties["line-width"].specification);function Wm(t,e){return e>0?e+2*t:t}qm.useIntegerZoom=!0;const M_=He([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),I_=He([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Zm=He([{name:"a_projected_pos",components:4,type:"Float32"}],4);He([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const P_=He([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),Xm=He([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);He([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const lp=He([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),cp=He([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);He([{name:"triangle",components:3,type:"Uint16"}]),He([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),He([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),He([{type:"Float32",name:"offsetX"}]),He([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var Js=24;const Za=128;function up(t,e){const{expression:n}=e;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new y(t+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:u}=n;let f=0;for(;f<s.length&&s[f]<=t;)f++;f=Math.max(0,f-1);let g=f;for(;g<s.length&&s[g]<t+1;)g++;g=Math.min(s.length-1,g);const b=s[f],S=s[g];return"composite"===n.kind?{kind:"composite",minZoom:b,maxZoom:S,interpolationType:u}:{kind:"camera",minZoom:b,maxZoom:S,minSize:n.evaluate(new y(b)),maxSize:n.evaluate(new y(S)),interpolationType:u}}}function hp(t,{uSize:e,uSizeT:n},{lowerSize:s,upperSize:u}){return"source"===t.kind?s/Za:"composite"===t.kind?mi(s/Za,u/Za,n):e}function Cl(t,e){let n=0,s=0;if("constant"===t.kind)s=t.layoutSize;else if("source"!==t.kind){const{interpolationType:u,minZoom:f,maxZoom:g}=t,b=u?Mt(Qo.interpolationFactor(u,e,f,g),0,1):0;"camera"===t.kind?s=mi(t.minSize,t.maxSize,b):n=b}return{uSizeT:n,uSize:s}}var Km=Object.freeze({__proto__:null,SIZE_PACK_FACTOR:Za,evaluateSizeForFeature:hp,evaluateSizeForZoom:Cl,getSizeData:up});function k_(t,e,n){return t.sections.forEach(s=>{s.text=function(u,f,g){const b=f.layout.get("text-transform").evaluate(g,{});return"uppercase"===b?u=u.toLocaleUpperCase():"lowercase"===b&&(u=u.toLocaleLowerCase()),m.applyArabicShaping&&(u=m.applyArabicShaping(u)),u}(s.text,e,n)}),t}const Zu={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function R_(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function L_(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}var Hh=lr,du=function(t,e,n,s,u){var f,g,b=8*u-s-1,S=(1<<b)-1,A=S>>1,O=-7,z=n?u-1:0,V=n?-1:1,q=t[e+z];for(z+=V,f=q&(1<<-O)-1,q>>=-O,O+=b;O>0;f=256*f+t[e+z],z+=V,O-=8);for(g=f&(1<<-O)-1,f>>=-O,O+=s;O>0;g=256*g+t[e+z],z+=V,O-=8);if(0===f)f=1-A;else{if(f===S)return g?NaN:1/0*(q?-1:1);g+=Math.pow(2,s),f-=A}return(q?-1:1)*g*Math.pow(2,f-s)},qd=function(t,e,n,s,u,f){var g,b,S,A=8*f-u-1,O=(1<<A)-1,z=O>>1,V=23===u?Math.pow(2,-24)-Math.pow(2,-77):0,q=s?0:f-1,X=s?1:-1,te=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(b=isNaN(e)?1:0,g=O):(g=Math.floor(Math.log(e)/Math.LN2),e*(S=Math.pow(2,-g))<1&&(g--,S*=2),(e+=g+z>=1?V/S:V*Math.pow(2,1-z))*S>=2&&(g++,S/=2),g+z>=O?(b=0,g=O):g+z>=1?(b=(e*S-1)*Math.pow(2,u),g+=z):(b=e*Math.pow(2,z-1)*Math.pow(2,u),g=0));u>=8;t[n+q]=255&b,q+=X,b/=256,u-=8);for(g=g<<u|b,A+=u;A>0;t[n+q]=255&g,q+=X,g/=256,A-=8);t[n+q-X]|=128*te};function lr(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}lr.Varint=0,lr.Fixed64=1,lr.Bytes=2,lr.Fixed32=5;var Gh=4294967296,qh=1/Gh,dp=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Dl(t){return t.type===lr.Bytes?t.readVarint()+t.pos:t.pos+1}function Wd(t,e,n){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(s);for(var u=n.pos-1;u>=t;u--)n.buf[u+s]=n.buf[u]}function Ym(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function fp(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function O_(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function F_(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function Jm(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function B_(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function Qm(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function eg(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function z_(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Zd(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Qs(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function tg(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}lr.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var s=this.readVarint(),u=s>>3,f=this.pos;this.type=7&s,t(u,e,this),this.pos===f&&this.skip(s)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Zd(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=tg(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Zd(this.buf,this.pos)+Zd(this.buf,this.pos+4)*Gh;return this.pos+=8,t},readSFixed64:function(){var t=Zd(this.buf,this.pos)+tg(this.buf,this.pos+4)*Gh;return this.pos+=8,t},readFloat:function(){var t=du(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=du(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,s=this.buf;return e=127&(n=s[this.pos++]),n<128?e:(e|=(127&(n=s[this.pos++]))<<7,n<128?e:(e|=(127&(n=s[this.pos++]))<<14,n<128?e:(e|=(127&(n=s[this.pos++]))<<21,n<128?e:function(u,f,g){var b,S,A=g.buf;if(b=(112&(S=A[g.pos++]))>>4,S<128||(b|=(127&(S=A[g.pos++]))<<3,S<128)||(b|=(127&(S=A[g.pos++]))<<10,S<128)||(b|=(127&(S=A[g.pos++]))<<17,S<128)||(b|=(127&(S=A[g.pos++]))<<24,S<128)||(b|=(1&(S=A[g.pos++]))<<31,S<128))return function kc(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(u,b,f);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=s[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&dp?dp.decode(this.buf.subarray(e,t)):function(n,s,u){for(var f="",g=s;g<u;){var b,S,A,O=n[g],z=null,V=O>239?4:O>223?3:O>191?2:1;if(g+V>u)break;1===V?O<128&&(z=O):2===V?128==(192&(b=n[g+1]))&&(z=(31&O)<<6|63&b)<=127&&(z=null):3===V?(S=n[g+2],128==(192&(b=n[g+1]))&&128==(192&S)&&((z=(15&O)<<12|(63&b)<<6|63&S)<=2047||z>=55296&&z<=57343)&&(z=null)):4===V&&(S=n[g+2],A=n[g+3],128==(192&(b=n[g+1]))&&128==(192&S)&&128==(192&A)&&((z=(15&O)<<18|(63&b)<<12|(63&S)<<6|63&A)<=65535||z>=1114112)&&(z=null)),null===z?(z=65533,V=1):z>65535&&(z-=65536,f+=String.fromCharCode(z>>>10&1023|55296),z=56320|1023&z),f+=String.fromCharCode(z),g+=V}return f}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==lr.Bytes)return t.push(this.readVarint(e));var n=Dl(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==lr.Bytes)return t.push(this.readSVarint());var e=Dl(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==lr.Bytes)return t.push(this.readBoolean());var e=Dl(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==lr.Bytes)return t.push(this.readFloat());var e=Dl(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==lr.Bytes)return t.push(this.readDouble());var e=Dl(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==lr.Bytes)return t.push(this.readFixed32());var e=Dl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==lr.Bytes)return t.push(this.readSFixed32());var e=Dl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==lr.Bytes)return t.push(this.readFixed64());var e=Dl(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==lr.Bytes)return t.push(this.readSFixed64());var e=Dl(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===lr.Varint)for(;this.buf[this.pos++]>127;);else if(e===lr.Bytes)this.pos=this.readVarint()+this.pos;else if(e===lr.Fixed32)this.pos+=4;else{if(e!==lr.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Qs(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Qs(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Qs(this.buf,-1&t,this.pos),Qs(this.buf,Math.floor(t*qh),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Qs(this.buf,-1&t,this.pos),Qs(this.buf,Math.floor(t*qh),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var s,u,f,b;if(e>=0?(s=e%4294967296|0,u=e/4294967296|0):(u=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,u=u+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),f=s,(b=n).buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,f>>>=7,b.buf[b.pos++]=127&f|128,b.buf[b.pos]=127&(f>>>=7),function(f,g){var b=(7&f)<<4;g.buf[g.pos++]|=b|((f>>>=3)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f|((f>>>=7)?128:0),f&&(g.buf[g.pos++]=127&f)))))}(u,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(s,u,f){for(var g,b,S=0;S<u.length;S++){if((g=u.charCodeAt(S))>55295&&g<57344){if(!b){g>56319||S+1===u.length?(s[f++]=239,s[f++]=191,s[f++]=189):b=g;continue}if(g<56320){s[f++]=239,s[f++]=191,s[f++]=189,b=g;continue}g=b-55296<<10|g-56320|65536,b=null}else b&&(s[f++]=239,s[f++]=191,s[f++]=189,b=null);g<128?s[f++]=g:(g<2048?s[f++]=g>>6|192:(g<65536?s[f++]=g>>12|224:(s[f++]=g>>18|240,s[f++]=g>>12&63|128),s[f++]=g>>6&63|128),s[f++]=63&g|128)}return f}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&Wd(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),qd(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),qd(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var s=this.pos-n;s>=128&&Wd(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeMessage:function(t,e,n){this.writeTag(t,lr.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Ym,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,fp,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Jm,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,O_,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,F_,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,B_,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Qm,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,eg,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,z_,e)},writeBytesField:function(t,e){this.writeTag(t,lr.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,lr.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,lr.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,lr.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,lr.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,lr.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,lr.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,lr.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,lr.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,lr.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var Xd=Yt(Hh);const ng=3;function pp(t,e,n){e.glyphs=[],1===t&&n.readMessage(ig,e)}function ig(t,e,n){if(3===t){const{id:s,bitmap:u,width:f,height:g,left:b,top:S,advance:A}=n.readMessage(N_,{});e.glyphs.push({id:s,bitmap:new cl({width:f+2*ng,height:g+2*ng},u),metrics:{width:f,height:g,left:b,top:S,advance:A}})}else 4===t?e.ascender=n.readSVarint():5===t&&(e.descender=n.readSVarint())}function N_(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}const rg=ng;function mp(t){let e=0,n=0;for(const g of t)e+=g.w*g.h,n=Math.max(n,g.w);t.sort((g,b)=>b.h-g.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let u=0,f=0;for(const g of t)for(let b=s.length-1;b>=0;b--){const S=s[b];if(!(g.w>S.w||g.h>S.h)){if(g.x=S.x,g.y=S.y,f=Math.max(f,g.y+g.h),u=Math.max(u,g.x+g.w),g.w===S.w&&g.h===S.h){const A=s.pop();b<s.length&&(s[b]=A)}else g.h===S.h?(S.x+=g.w,S.w-=g.w):g.w===S.w?(S.y+=g.h,S.h-=g.h):(s.push({x:S.x+g.w,y:S.y,w:S.w-g.w,h:g.h}),S.y+=g.h,S.h-=g.h);break}}return{w:u,h:f,fill:e/(u*f)||0}}const Ea=1;class gp{constructor(e,{pixelRatio:n,version:s,stretchX:u,stretchY:f,content:g}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=u,this.stretchY=f,this.content=g,this.version=s}get tl(){return[this.paddedRect.x+Ea,this.paddedRect.y+Ea]}get br(){return[this.paddedRect.x+this.paddedRect.w-Ea,this.paddedRect.y+this.paddedRect.h-Ea]}get displaySize(){return[(this.paddedRect.w-2*Ea)/this.pixelRatio,(this.paddedRect.h-2*Ea)/this.pixelRatio]}}class og{constructor(e,n){const s={},u={};this.haveRenderCallbacks=[];const f=[];this.addImages(e,s,f),this.addImages(n,u,f);const{w:g,h:b}=mp(f),S=new Cs({width:g||1,height:b||1});for(const A in e){const O=e[A],z=s[A].paddedRect;Cs.copy(O.data,S,{x:0,y:0},{x:z.x+Ea,y:z.y+Ea},O.data)}for(const A in n){const O=n[A],z=u[A].paddedRect,V=z.x+Ea,q=z.y+Ea,X=O.data.width,te=O.data.height;Cs.copy(O.data,S,{x:0,y:0},{x:V,y:q},O.data),Cs.copy(O.data,S,{x:0,y:te-1},{x:V,y:q-1},{width:X,height:1}),Cs.copy(O.data,S,{x:0,y:0},{x:V,y:q+te},{width:X,height:1}),Cs.copy(O.data,S,{x:X-1,y:0},{x:V-1,y:q},{width:1,height:te}),Cs.copy(O.data,S,{x:0,y:0},{x:V+X,y:q},{width:1,height:te})}this.image=S,this.iconPositions=s,this.patternPositions=u}addImages(e,n,s){for(const u in e){const f=e[u],g={x:0,y:0,w:f.data.width+2*Ea,h:f.data.height+2*Ea};s.push(g),n[u]=new gp(g,f),f.hasRenderCallback&&this.haveRenderCallbacks.push(u)}}patchUpdatedImages(e,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),n),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),n)}patchUpdatedImage(e,n,s){if(!e||!n||e.version===n.version)return;e.version=n.version;const[u,f]=e.tl;s.update(n.data,void 0,{x:u,y:f})}}wn(gp,"ImagePosition"),wn(og,"ImageAtlas");const Ra={horizontal:1,vertical:2,horizontalOnly:3},sg=-17;class Wh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const s=new Wh;return s.scale=e||1,s.fontStack=n,s}static forImage(e){const n=new Wh;return n.imageName=e,n}}class Xu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const s=new Xu;for(let u=0;u<e.sections.length;u++){const f=e.sections[u];f.image?s.addImageSection(f):s.addTextSection(f,n)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(n,s){let u="";for(let f=0;f<n.length;f++){const g=n.charCodeAt(f+1)||null,b=n.charCodeAt(f-1)||null;u+=!s&&(g&&cd(g)&&!Zu[n[f+1]]||b&&cd(b)&&!Zu[n[f-1]])||!Zu[n[f]]?n[f]:Zu[n[f]]}return u}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Kd[this.text.charCodeAt(s)];s++)e++;let n=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Kd[this.text.charCodeAt(s)];s--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const s=new Xu;return s.text=this.text.substring(e,n),s.sectionIndex=this.sectionIndex.slice(e,n),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Wh.forText(e.scale,e.fontStack||n));const s=this.sections.length-1;for(let u=0;u<e.text.length;++u)this.sectionIndex.push(s)}addImageSection(e){const n=e.image?e.image.name:"";if(0===n.length)return void hi("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Wh.forImage(n)),this.sectionIndex.push(this.sections.length-1)):hi("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function _p(t,e,n,s,u,f,g,b,S,A,O,z,V,q,X){const te=Xu.fromFeature(t,u);z===Ra.vertical&&te.verticalizePunctuation(V);let de=[];const ye=function(Le,rt,Qe,yt,qt,lt){if(!Le)return[];const St=[],Ct=function(mn,Mn,yn,gi,Jt,Vn){let _i=0;for(let er=0;er<mn.length();er++){const wi=mn.getSection(er);_i+=Yd(mn.getCharCode(er),wi,gi,Jt,Mn,Vn)}return _i/Math.max(1,Math.ceil(_i/yn))}(Le,rt,Qe,yt,qt,lt),Bt=Le.text.indexOf("\u200b")>=0;let Xt=0;for(let mn=0;mn<Le.length();mn++){const Mn=Le.getSection(mn),yn=Le.getCharCode(mn);if(Kd[yn]||(Xt+=Yd(yn,Mn,yt,qt,rt,lt)),mn<Le.length()-1){const gi=!((gt=yn)<11904||!(vn["Bopomofo Extended"](gt)||vn.Bopomofo(gt)||vn["CJK Compatibility Forms"](gt)||vn["CJK Compatibility Ideographs"](gt)||vn["CJK Compatibility"](gt)||vn["CJK Radicals Supplement"](gt)||vn["CJK Strokes"](gt)||vn["CJK Symbols and Punctuation"](gt)||vn["CJK Unified Ideographs Extension A"](gt)||vn["CJK Unified Ideographs"](gt)||vn["Enclosed CJK Letters and Months"](gt)||vn["Halfwidth and Fullwidth Forms"](gt)||vn.Hiragana(gt)||vn["Ideographic Description Characters"](gt)||vn["Kangxi Radicals"](gt)||vn["Katakana Phonetic Extensions"](gt)||vn.Katakana(gt)||vn["Vertical Forms"](gt)||vn["Yi Radicals"](gt)||vn["Yi Syllables"](gt)));(Zl[yn]||gi||Mn.imageName)&&St.push(yp(mn+1,Xt,Ct,St,U_(yn,Le.getCharCode(mn+1),gi&&Bt),!1))}}var gt;return lg(yp(Le.length(),Xt,Ct,St,0,!0))}(te,A,f,e,s,q),{processBidirectionalText:Ie,processStyledBidirectionalText:ve}=m;if(Ie&&1===te.sections.length){const Le=Ie(te.toString(),ye);for(const rt of Le){const Qe=new Xu;Qe.text=rt,Qe.sections=te.sections;for(let yt=0;yt<rt.length;yt++)Qe.sectionIndex.push(0);de.push(Qe)}}else if(ve){const Le=ve(te.text,te.sectionIndex,ye);for(const rt of Le){const Qe=new Xu;Qe.text=rt[0],Qe.sectionIndex=rt[1],Qe.sections=te.sections,de.push(Qe)}}else de=function(Le,rt){const Qe=[],yt=Le.text;let qt=0;for(const lt of rt)Qe.push(Le.substring(qt,lt)),qt=lt;return qt<yt.length&&Qe.push(Le.substring(qt,yt.length)),Qe}(te,ye);const De=[],Fe={positionedLines:De,text:te.toString(),top:O[1],bottom:O[1],left:O[0],right:O[0],writingMode:z,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Le,rt,Qe,yt,qt,lt,St,Ct,Bt,Xt,gt,mn){let Mn=0,yn=0,gi=0;const Jt="right"===Ct?1:"left"===Ct?0:.5;let Vn=!1;for(const Ci of qt){const Di=Ci.getSections();for(const Tr of Di){if(Tr.imageName)continue;const Fr=rt[Tr.fontStack];if(Fr&&(Vn=void 0!==Fr.ascender&&void 0!==Fr.descender,!Vn))break}if(!Vn)break}let _i=0;for(const Ci of qt){Ci.trim();const Di=Ci.getMaxScale(),Tr=(Di-1)*Js,Fr={positionedGlyphs:[],lineOffset:0};Le.positionedLines[_i]=Fr;const Br=Fr.positionedGlyphs;let Cr=0;if(!Ci.length()){yn+=lt,++_i;continue}let ao=0,To=0;for(let Dr=0;Dr<Ci.length();Dr++){const is=Ci.getSection(Dr),jo=Ci.getSectionIndex(Dr),fo=Ci.getCharCode(Dr);let nr=is.scale,Vo=null,Sr=null,aa=null,Io=Js,Ds=0;const _s=!(Bt===Ra.horizontal||!gt&&!fh(fo)||gt&&(Kd[fo]||(er=fo,vn.Arabic(er)||vn["Arabic Supplement"](er)||vn["Arabic Extended-A"](er)||vn["Arabic Presentation Forms-A"](er)||vn["Arabic Presentation Forms-B"](er))));if(is.imageName){const la=yt[is.imageName];if(!la)continue;aa=is.imageName,Le.iconsInText=Le.iconsInText||!0,Sr=la.paddedRect;const ys=la.displaySize;nr=nr*Js/mn,Vo={width:ys[0],height:ys[1],left:Ea,top:-rg,advance:_s?ys[1]:ys[0],localGlyph:!1},Ds=Vn?-Vo.height*nr:sg+Di*Js-ys[1]*nr,Io=Vo.advance;const fl=(_s?ys[0]:ys[1])*nr-Js*Di;fl>0&&fl>Cr&&(Cr=fl)}else{const la=Qe[is.fontStack];if(!la)continue;la[fo]&&(Sr=la[fo]);const ys=rt[is.fontStack];if(!ys)continue;const fl=ys.glyphs[fo];if(!fl)continue;if(Vo=fl.metrics,Io=8203!==fo?Js:0,Vn){const xu=void 0!==ys.ascender?Math.abs(ys.ascender):0,lh=void 0!==ys.descender?Math.abs(ys.descender):0,ch=(xu+lh)*nr;ao<ch&&(ao=ch,To=(xu-lh)/2*nr),Ds=-xu*nr}else Ds=sg+(Di-nr)*Js}_s?(Le.verticalizable=!0,Br.push({glyph:fo,imageName:aa,x:Mn,y:yn+Ds,vertical:_s,scale:nr,localGlyph:Vo.localGlyph,fontStack:is.fontStack,sectionIndex:jo,metrics:Vo,rect:Sr}),Mn+=Io*nr+Xt):(Br.push({glyph:fo,imageName:aa,x:Mn,y:yn+Ds,vertical:_s,scale:nr,localGlyph:Vo.localGlyph,fontStack:is.fontStack,sectionIndex:jo,metrics:Vo,rect:Sr}),Mn+=Vo.advance*nr+Xt)}0!==Br.length&&(gi=Math.max(Mn-Xt,gi),Vn?cg(Br,Jt,Cr,To,lt*Di/2):cg(Br,Jt,Cr,0,lt/2)),Mn=0;const Uo=lt*Di+Cr;Fr.lineOffset=Math.max(Cr,Tr),yn+=Uo,++_i}var er;const wi=yn,{horizontalAlign:Qn,verticalAlign:jr}=vp(St);(function(Ci,Di,Tr,Fr,Br,Cr){const ao=(Di-Tr)*Br,To=-Cr*Fr;for(const Uo of Ci)for(const Dr of Uo.positionedGlyphs)Dr.x+=ao,Dr.y+=To})(Le.positionedLines,Jt,Qn,jr,gi,wi),Le.top+=-jr*wi,Le.bottom=Le.top+wi,Le.left+=-Qn*gi,Le.right=Le.left+gi,Le.hasBaseline=Vn}(Fe,e,n,s,de,g,b,S,z,A,V,X),!function(Le){for(const rt of Le)if(0!==rt.positionedGlyphs.length)return!1;return!0}(De)&&Fe}const Kd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Zl={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Yd(t,e,n,s,u,f){if(e.imageName){const g=s[e.imageName];return g?g.displaySize[0]*e.scale*Js/f+u:0}{const g=n[e.fontStack],b=g&&g.glyphs[t];return b?b.metrics.advance*e.scale+u:0}}function ag(t,e,n,s){const u=Math.pow(t-e,2);return s?t<e?u/2:2*u:u+Math.abs(n)*n}function U_(t,e,n){let s=0;return 10===t&&(s-=1e4),n&&(s+=150),40!==t&&65288!==t||(s+=50),41!==e&&65289!==e||(s+=50),s}function yp(t,e,n,s,u,f){let g=null,b=ag(e,n,u,f);for(const S of s){const A=ag(e-S.x,n,u,f)+S.badness;A<=b&&(g=S,b=A)}return{index:t,x:e,priorBreak:g,badness:b}}function lg(t){return t?lg(t.priorBreak).concat(t.index):[]}function vp(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function cg(t,e,n,s,u){if(!(e||n||s||u))return;const f=t.length-1,g=t[f],b=(g.x+g.metrics.advance*g.scale)*e;for(let S=0;S<=f;S++)t[S].x-=b,t[S].y+=n+s+u}function xp(t,e,n){const{horizontalAlign:s,verticalAlign:u}=vp(n),f=e[0]-t.displaySize[0]*s,g=e[1]-t.displaySize[1]*u;return{image:t,top:g,bottom:g+t.displaySize[1],left:f,right:f+t.displaySize[0]}}function ug(t,e,n,s,u,f){const g=t.image;let b;if(g.content){const de=g.content,ye=g.pixelRatio||1;b=[de[0]/ye,de[1]/ye,g.displaySize[0]-de[2]/ye,g.displaySize[1]-de[3]/ye]}const S=e.left*f,A=e.right*f;let O,z,V,q;"width"===n||"both"===n?(q=u[0]+S-s[3],z=u[0]+A+s[1]):(q=u[0]+(S+A-g.displaySize[0])/2,z=q+g.displaySize[0]);const X=e.top*f,te=e.bottom*f;return"height"===n||"both"===n?(O=u[1]+X-s[0],V=u[1]+te+s[2]):(O=u[1]+(X+te-g.displaySize[1])/2,V=O+g.displaySize[1]),{image:g,top:O,right:z,bottom:V,left:q,collisionPadding:b}}class cc extends Se{constructor(e,n,s,u,f){super(e,n),this.angle=u,this.z=s,void 0!==f&&(this.segment=f)}clone(){return new cc(this.x,this.y,this.z,this.angle,this.segment)}}function Zh(t,e,n,s,u){if(void 0===e.segment)return!0;let f=e,g=e.segment+1,b=0;for(;b>-n/2;){if(g--,g<0)return!1;b-=t[g].dist(f),f=t[g]}b+=t[g].dist(t[g+1]),g++;const S=[];let A=0;for(;b<n/2;){const O=t[g],z=t[g+1];if(!z)return!1;let V=t[g-1].angleTo(O)-O.angleTo(z);for(V=Math.abs((V+3*Math.PI)%(2*Math.PI)-Math.PI),S.push({distance:b,angleDelta:V}),A+=V;b-S[0].distance>s;)A-=S.shift().angleDelta;if(A>u)return!1;g++,b+=O.dist(z)}return!0}function Xh(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function Kh(t,e,n){return t?.6*e*n:0}function j_(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function wp(t,e,n,s,u,f){const g=Kh(n,u,f),b=j_(n,s)*f;let S=0;const A=Xh(t)/2;for(let O=0;O<t.length-1;O++){const z=t[O],V=t[O+1],q=z.dist(V);if(S+q>A){const X=(A-S)/q,te=mi(z.x,V.x,X),de=mi(z.y,V.y,X),ye=new cc(te,de,0,V.angleTo(z),O);return!g||Zh(t,ye,b,g,e)?ye:void 0}S+=q}}function $y(t,e,n,s,u,f,g,b,S){const A=Kh(s,f,g),O=j_(s,u),z=O*g,V=0===t[0].x||t[0].x===S||0===t[0].y||t[0].y===S;return e-z<e/4&&(e=z+e/4),bp(t,V?e/2*b%e:(O/2+2*f)*g*b%e,e,A,n,z,V,!1,S)}function bp(t,e,n,s,u,f,g,b,S){const A=f/2,O=Xh(t);let z=0,V=e-n,q=[];for(let X=0;X<t.length-1;X++){const te=t[X],de=t[X+1],ye=te.dist(de),Ie=de.angleTo(te);for(;V+n<z+ye;){V+=n;const ve=(V-z)/ye,De=mi(te.x,de.x,ve),Fe=mi(te.y,de.y,ve);if(De>=0&&De<S&&Fe>=0&&Fe<S&&V-A>=0&&V+A<=O){const Le=new cc(De,Fe,0,Ie,X);Le._round(),s&&!Zh(t,Le,f,s,u)||q.push(Le)}}z+=ye}return b||q.length||g||(q=bp(t,z/2,n,s,u,f,g,!0,S)),q}function Ep(t,e,n,s,u){const f=[];for(let g=0;g<t.length;g++){const b=t[g];let S;for(let A=0;A<b.length-1;A++){let O=b[A],z=b[A+1];O.x<e&&z.x<e||(O.x<e?O=new Se(e,O.y+(e-O.x)/(z.x-O.x)*(z.y-O.y))._round():z.x<e&&(z=new Se(e,O.y+(e-O.x)/(z.x-O.x)*(z.y-O.y))._round()),O.y<n&&z.y<n||(O.y<n?O=new Se(O.x+(n-O.y)/(z.y-O.y)*(z.x-O.x),n)._round():z.y<n&&(z=new Se(O.x+(n-O.y)/(z.y-O.y)*(z.x-O.x),n)._round()),O.x>=s&&z.x>=s||(O.x>=s?O=new Se(s,O.y+(s-O.x)/(z.x-O.x)*(z.y-O.y))._round():z.x>=s&&(z=new Se(s,O.y+(s-O.x)/(z.x-O.x)*(z.y-O.y))._round()),O.y>=u&&z.y>=u||(O.y>=u?O=new Se(O.x+(u-O.y)/(z.y-O.y)*(z.x-O.x),u)._round():z.y>=u&&(z=new Se(O.x+(u-O.y)/(z.y-O.y)*(z.x-O.x),u)._round()),S&&O.equals(S[S.length-1])||(S=[O],f.push(S)),S.push(z)))))}}return f}wn(cc,"Anchor");const Ku=1e20;function Tp(t,e,n,s,u,f,g,b,S){for(let A=e;A<e+s;A++)Jd(t,n*f+A,f,u,g,b,S);for(let A=n;A<n+u;A++)Jd(t,A*f+e,1,s,g,b,S)}function Jd(t,e,n,s,u,f,g){f[0]=0,g[0]=-Ku,g[1]=Ku,u[0]=t[e];for(let b=1,S=0,A=0;b<s;b++){u[b]=t[e+b*n];const O=b*b;do{const z=f[S];A=(u[b]-u[z]+O-z*z)/(b-z)/2}while(A<=g[S]&&--S>-1);S++,f[S]=b,g[S]=A,g[S+1]=Ku}for(let b=0,S=0;b<s;b++){for(;g[S+1]<b;)S++;const A=f[S],O=b-A;t[e+b*n]=u[A]+O*O}}const Us=2,Yu={none:0,ideographs:1,all:2};class uc{constructor(e,n,s){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const s=[];for(const u in e)for(const f of e[u])s.push({stack:u,id:f});at(s,({stack:u,id:f},g)=>{let b=this.entries[u];b||(b=this.entries[u]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let S=b.glyphs[f];if(void 0!==S)return void g(null,{stack:u,id:f,glyph:S});if(S=this._tinySDF(b,u,f),S)return b.glyphs[f]=S,void g(null,{stack:u,id:f,glyph:S});const A=Math.floor(f/256);if(256*A>65535)return void g(new Error("glyphs > 65535 not supported"));if(b.ranges[A])return void g(null,{stack:u,id:f,glyph:S});let O=b.requests[A];O||(O=b.requests[A]=[],uc.loadGlyphRange(u,A,this.url,this.requestManager,(z,V)=>{if(V){b.ascender=V.ascender,b.descender=V.descender;for(const q in V.glyphs)this._doesCharSupportLocalGlyph(+q)||(b.glyphs[+q]=V.glyphs[+q]);b.ranges[A]=!0}for(const q of O)q(z,V);delete b.requests[A]})),O.push((z,V)=>{z?g(z):V&&g(null,{stack:u,id:f,glyph:V.glyphs[f]||null})})},(u,f)=>{if(u)n(u);else if(f){const g={};for(const{stack:b,id:S,glyph:A}of f)void 0===g[b]&&(g[b]={}),void 0===g[b].glyphs&&(g[b].glyphs={}),g[b].glyphs[S]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},g[b].ascender=this.entries[b].ascender,g[b].descender=this.entries[b].descender;n(null,g)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Yu.none&&(this.localGlyphMode===Yu.all?!!this.localFontFamily:!!this.localFontFamily&&(vn["CJK Unified Ideographs"](e)||vn["Hangul Syllables"](e)||vn.Hiragana(e)||vn.Katakana(e)||vn["CJK Symbols and Punctuation"](e)))}_tinySDF(e,n,s){const u=this.localFontFamily;if(!u||!this._doesCharSupportLocalGlyph(s))return;let f=e.tinySDF;if(!f){let te="400";/bold/i.test(n)?te="900":/medium/i.test(n)?te="500":/light/i.test(n)&&(te="200"),f=e.tinySDF=new uc.TinySDF({fontFamily:u,fontWeight:te,fontSize:24*Us,buffer:3*Us,radius:8*Us}),f.fontWeight=te}if(this.localGlyphs[f.fontWeight][s])return this.localGlyphs[f.fontWeight][s];const g=String.fromCharCode(s),{data:b,width:S,height:A,glyphWidth:O,glyphHeight:z,glyphLeft:V,glyphTop:q,glyphAdvance:X}=f.draw(g);return this.localGlyphs[f.fontWeight][s]={id:s,bitmap:new cl({width:S,height:A},b),metrics:{width:O/Us,height:z/Us,left:V/Us,top:q/Us-27,advance:X/Us,localGlyph:!0}}}}uc.loadGlyphRange=function(t,e,n,s,u){const f=256*e,g=f+255,b=s.transformRequest(s.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${f}-${g}`),Ri.Glyphs);cr(b,(S,A)=>{if(S)u(S);else if(A){const O={},z=new Xd(A).readFields(pp,{});for(const V of z.glyphs)O[V.id]=V;u(null,{glyphs:O,ascender:z.ascender,descender:z.descender})}})},uc.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:s=.25,fontFamily:u="sans-serif",fontWeight:f="normal",fontStyle:g="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=n;const b=this.size=t+4*e,S=this._createCanvas(b),A=this.ctx=S.getContext("2d",{willReadFrequently:!0});A.font=`${g} ${f} ${t}px ${u}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:u,actualBoundingBoxRight:f}=this.ctx.measureText(t),g=Math.ceil(n),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(f-u))),S=Math.min(this.size-this.buffer,g+Math.ceil(s)),A=b+2*this.buffer,O=S+2*this.buffer,z=Math.max(A*O,0),V=new Uint8ClampedArray(z),q={data:V,width:A,height:O,glyphWidth:b,glyphHeight:S,glyphTop:g,glyphLeft:0,glyphAdvance:e};if(0===b||0===S)return q;const{ctx:X,buffer:te,gridInner:de,gridOuter:ye}=this;X.clearRect(te,te,b,S),X.fillText(t,te,te+g);const Ie=X.getImageData(te,te,b,S);ye.fill(Ku,0,z),de.fill(0,0,z);for(let ve=0;ve<S;ve++)for(let De=0;De<b;De++){const Fe=Ie.data[4*(ve*b+De)+3]/255;if(0===Fe)continue;const Le=(ve+te)*A+De+te;if(1===Fe)ye[Le]=0,de[Le]=Ku;else{const rt=.5-Fe;ye[Le]=rt>0?rt*rt:0,de[Le]=rt<0?rt*rt:0}}Tp(ye,0,0,A,O,A,this.f,this.v,this.z),Tp(de,te,te,b,S,A,this.f,this.v,this.z);for(let ve=0;ve<z;ve++){const De=Math.sqrt(ye[ve])-Math.sqrt(de[ve]);V[ve]=Math.round(255-255*(De/this.radius+this.cutoff))}return q}};const Xl=Ea;function hg(t,e,n,s){const u=[],f=t.image,g=f.pixelRatio,b=f.paddedRect.w-2*Xl,S=f.paddedRect.h-2*Xl,A=t.right-t.left,O=t.bottom-t.top,z=f.stretchX||[[0,b]],V=f.stretchY||[[0,S]],q=(lt,St)=>lt+St[1]-St[0],X=z.reduce(q,0),te=V.reduce(q,0),de=b-X,ye=S-te;let Ie=0,ve=X,De=0,Fe=te,Le=0,rt=de,Qe=0,yt=ye;if(f.content&&s){const lt=f.content;Ie=Yh(z,0,lt[0]),De=Yh(V,0,lt[1]),ve=Yh(z,lt[0],lt[2]),Fe=Yh(V,lt[1],lt[3]),Le=lt[0]-Ie,Qe=lt[1]-De,rt=lt[2]-lt[0]-ve,yt=lt[3]-lt[1]-Fe}const qt=(lt,St,Ct,Bt)=>{const Xt=Qd(lt.stretch-Ie,ve,A,t.left),gt=ef(lt.fixed-Le,rt,lt.stretch,X),mn=Qd(St.stretch-De,Fe,O,t.top),Mn=ef(St.fixed-Qe,yt,St.stretch,te),yn=Qd(Ct.stretch-Ie,ve,A,t.left),gi=ef(Ct.fixed-Le,rt,Ct.stretch,X),Jt=Qd(Bt.stretch-De,Fe,O,t.top),Vn=ef(Bt.fixed-Qe,yt,Bt.stretch,te),_i=new Se(Xt,mn),er=new Se(yn,mn),wi=new Se(yn,Jt),Qn=new Se(Xt,Jt),jr=new Se(gt/g,Mn/g),Ci=new Se(gi/g,Vn/g),Di=e*Math.PI/180;if(Di){const Br=Math.sin(Di),Cr=Math.cos(Di),ao=[Cr,-Br,Br,Cr];_i._matMult(ao),er._matMult(ao),Qn._matMult(ao),wi._matMult(ao)}const Tr=lt.stretch+lt.fixed,Fr=St.stretch+St.fixed;return{tl:_i,tr:er,bl:Qn,br:wi,tex:{x:f.paddedRect.x+Xl+Tr,y:f.paddedRect.y+Xl+Fr,w:Ct.stretch+Ct.fixed-Tr,h:Bt.stretch+Bt.fixed-Fr},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:jr,pixelOffsetBR:Ci,minFontScaleX:rt/g/A,minFontScaleY:yt/g/O,isSDF:n}};if(s&&(f.stretchX||f.stretchY)){const lt=Cp(z,de,X),St=Cp(V,ye,te);for(let Ct=0;Ct<lt.length-1;Ct++){const Bt=lt[Ct],Xt=lt[Ct+1];for(let gt=0;gt<St.length-1;gt++)u.push(qt(Bt,St[gt],Xt,St[gt+1]))}}else u.push(qt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:b+1},{fixed:0,stretch:S+1}));return u}function Yh(t,e,n){let s=0;for(const u of t)s+=Math.max(e,Math.min(n,u[1]))-Math.max(e,Math.min(n,u[0]));return s}function Cp(t,e,n){const s=[{fixed:-Xl,stretch:0}];for(const[u,f]of t){const g=s[s.length-1];s.push({fixed:u-g.stretch,stretch:g.stretch}),s.push({fixed:u-g.stretch,stretch:g.stretch+(f-u)})}return s.push({fixed:e+Xl,stretch:n}),s}function Qd(t,e,n,s){return t/e*n+s}function ef(t,e,n,s){return t-e*n/s}function Jh(t,e,n,s){const u=e+t.positionedLines[s].lineOffset;return 0===s?n+u/2:n+(u+(e+t.positionedLines[s-1].lineOffset))/2}class V_{constructor(e=[],n=Hy){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:s}=this,u=n[e];for(;e>0;){const f=e-1>>1,g=n[f];if(s(u,g)>=0)break;n[e]=g,e=f}n[e]=u}_down(e){const{data:n,compare:s}=this,u=this.length>>1,f=n[e];for(;e<u;){let g=1+(e<<1),b=n[g];const S=g+1;if(S<this.length&&s(n[S],b)<0&&(g=S,b=n[S]),s(b,f)>=0)break;n[e]=b,e=g}n[e]=f}}function Hy(t,e){return t<e?-1:t>e?1:0}function $_(t,e=1,n=!1){let s=1/0,u=1/0,f=-1/0,g=-1/0;const b=t[0];for(let q=0;q<b.length;q++){const X=b[q];(!q||X.x<s)&&(s=X.x),(!q||X.y<u)&&(u=X.y),(!q||X.x>f)&&(f=X.x),(!q||X.y>g)&&(g=X.y)}const S=Math.min(f-s,g-u);let A=S/2;const O=new V_([],H_);if(0===S)return new Se(s,u);for(let q=s;q<f;q+=S)for(let X=u;X<g;X+=S)O.push(new Ju(q+A,X+A,A,t));let z=function(q){let X=0,te=0,de=0;const ye=q[0];for(let Ie=0,ve=ye.length,De=ve-1;Ie<ve;De=Ie++){const Fe=ye[Ie],Le=ye[De],rt=Fe.x*Le.y-Le.x*Fe.y;te+=(Fe.x+Le.x)*rt,de+=(Fe.y+Le.y)*rt,X+=3*rt}return new Ju(te/X,de/X,0,q)}(t),V=O.length;for(;O.length;){const q=O.pop();(q.d>z.d||!z.d)&&(z=q,n&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,V)),q.max-z.d<=e||(A=q.h/2,O.push(new Ju(q.p.x-A,q.p.y-A,A,t)),O.push(new Ju(q.p.x+A,q.p.y-A,A,t)),O.push(new Ju(q.p.x-A,q.p.y+A,A,t)),O.push(new Ju(q.p.x+A,q.p.y+A,A,t)),V+=4)}return n&&(console.log(`num probes: ${V}`),console.log(`best distance: ${z.d}`)),z.p}function H_(t,e){return e.max-t.max}class Ju{constructor(e,n,s,u){this.p=new Se(e,n),this.h=s,this.d=function(f,g){let b=!1,S=1/0;for(let A=0;A<g.length;A++){const O=g[A];for(let z=0,V=O.length,q=V-1;z<V;q=z++){const X=O[z],te=O[q];X.y>f.y!=te.y>f.y&&f.x<(te.x-X.x)*(f.y-X.y)/(te.y-X.y)+X.x&&(b=!b),S=Math.min(S,Xf(f,X,te))}}return(b?1:-1)*Math.sqrt(S)}(this.p,u),this.max=this.d+this.h*Math.SQRT2}}const Qu=7,Dp=Number.POSITIVE_INFINITY,G_=Math.sqrt(2);function dg(t,[e,n]){let s=0,u=0;if(n===Dp){e<0&&(e=0);const f=e/G_;switch(t){case"top-right":case"top-left":u=f-Qu;break;case"bottom-right":case"bottom-left":u=-f+Qu;break;case"bottom":u=-e+Qu;break;case"top":u=e-Qu}switch(t){case"top-right":case"bottom-right":s=-f;break;case"top-left":case"bottom-left":s=f;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":u=n-Qu;break;case"bottom-right":case"bottom-left":case"bottom":u=-n+Qu}switch(t){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,u]}function fg(t,e,n,s,u,f,g,b,S,A){t.createArrays(),t.tilePixelRatio=Gn/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const O=t.layers[0].layout,z=t.layers[0]._unevaluatedLayout._values,V={};if("composite"===t.textSizeData.kind){const{minZoom:te,maxZoom:de}=t.textSizeData;V.compositeTextSizes=[z["text-size"].possiblyEvaluate(new y(te),b),z["text-size"].possiblyEvaluate(new y(de),b)]}if("composite"===t.iconSizeData.kind){const{minZoom:te,maxZoom:de}=t.iconSizeData;V.compositeIconSizes=[z["icon-size"].possiblyEvaluate(new y(te),b),z["icon-size"].possiblyEvaluate(new y(de),b)]}V.layoutTextSize=z["text-size"].possiblyEvaluate(new y(S+1),b),V.layoutIconSize=z["icon-size"].possiblyEvaluate(new y(S+1),b),V.textMaxSize=z["text-size"].possiblyEvaluate(new y(18),b);const q="map"===O.get("text-rotation-alignment")&&"point"!==O.get("symbol-placement"),X=O.get("text-size");for(const te of t.features){const de=O.get("text-font").evaluate(te,{},b).join(","),ye=X.evaluate(te,{},b),Ie=V.layoutTextSize.evaluate(te,{},b),ve=(V.layoutIconSize.evaluate(te,{},b),{horizontal:{},vertical:void 0}),De=te.text;let Fe,Le=[0,0];if(De){const yt=De.toString(),qt=O.get("text-letter-spacing").evaluate(te,{},b)*Js,lt=O.get("text-line-height").evaluate(te,{},b)*Js,St=ad(yt)?qt:0,Ct=O.get("text-anchor").evaluate(te,{},b),Bt=O.get("text-variable-anchor");if(!Bt){const yn=O.get("text-radial-offset").evaluate(te,{},b);Le=yn?dg(Ct,[yn*Js,Dp]):O.get("text-offset").evaluate(te,{},b).map(gi=>gi*Js)}let Xt=q?"center":O.get("text-justify").evaluate(te,{},b);const gt="point"===O.get("symbol-placement"),mn=gt?O.get("text-max-width").evaluate(te,{},b)*Js:1/0,Mn=yn=>{t.allowVerticalPlacement&&Kc(yt)&&(ve.vertical=_p(De,e,n,u,de,mn,lt,Ct,yn,St,Le,Ra.vertical,!0,Ie,ye))};if(!q&&Bt){const yn="auto"===Xt?Bt.map(Jt=>Qh(Jt)):[Xt];let gi=!1;for(let Jt=0;Jt<yn.length;Jt++){const Vn=yn[Jt];if(!ve.horizontal[Vn])if(gi)ve.horizontal[Vn]=ve.horizontal[0];else{const _i=_p(De,e,n,u,de,mn,lt,"center",Vn,St,Le,Ra.horizontal,!1,Ie,ye);_i&&(ve.horizontal[Vn]=_i,gi=1===_i.positionedLines.length)}}Mn("left")}else{if("auto"===Xt&&(Xt=Qh(Ct)),gt||O.get("text-writing-mode").indexOf("horizontal")>=0||!Kc(yt)){const yn=_p(De,e,n,u,de,mn,lt,Ct,Xt,St,Le,Ra.horizontal,!1,Ie,ye);yn&&(ve.horizontal[Xt]=yn)}Mn(gt?"left":Xt)}}let rt=!1;if(te.icon&&te.icon.name){const yt=s[te.icon.name];yt&&(Fe=xp(u[te.icon.name],O.get("icon-offset").evaluate(te,{},b),O.get("icon-anchor").evaluate(te,{},b)),rt=yt.sdf,void 0===t.sdfIcons?t.sdfIcons=yt.sdf:t.sdfIcons!==yt.sdf&&hi("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(yt.pixelRatio!==t.pixelRatio||0!==O.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const Qe=mg(ve.horizontal)||ve.vertical;t.iconsInText||(t.iconsInText=!!Qe&&Qe.iconsInText),(Qe||Fe)&&q_(t,te,ve,Fe,s,V,Ie,0,Le,rt,g,b,A)}f&&t.generateCollisionDebugBuffers(S,t.collisionBoxArray)}function Qh(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function q_(t,e,n,s,u,f,g,b,S,A,O,z,V){let q=f.textMaxSize.evaluate(e,{},z);void 0===q&&(q=g);const X=t.layers[0].layout,te=X.get("icon-offset").evaluate(e,{},z),de=mg(n.horizontal)||n.vertical,ye="globe"===V.name,Ie=Js,ve=g/Ie,De=t.tilePixelRatio*q/Ie,Fe=(Ct=t.overscaling,t.zoom>18&&Ct>2&&(Ct>>=1),Math.max(Gn/(512*Ct),1)*X.get("symbol-spacing")),Le=X.get("text-padding")*t.tilePixelRatio,rt=X.get("icon-padding")*t.tilePixelRatio,Qe=tt(X.get("text-max-angle")),yt="map"===X.get("text-rotation-alignment")&&"point"!==X.get("symbol-placement"),qt="map"===X.get("icon-rotation-alignment")&&"point"!==X.get("symbol-placement"),lt=X.get("symbol-placement"),St=Fe/2;var Ct;const Bt=X.get("icon-text-fit");let Xt;s&&"none"!==Bt&&(t.allowVerticalPlacement&&n.vertical&&(Xt=ug(s,n.vertical,Bt,X.get("icon-text-fit-padding"),te,ve)),de&&(s=ug(s,de,Bt,X.get("icon-text-fit-padding"),te,ve)));const gt=(mn,Mn,yn)=>{if(Mn.x<0||Mn.x>=Gn||Mn.y<0||Mn.y>=Gn)return;let gi=null;if(ye){const{x:Jt,y:Vn,z:_i}=V.projectTilePoint(Mn.x,Mn.y,yn);gi={anchor:new cc(Jt,Vn,_i,0,void 0),up:V.upVector(yn,Mn.x,Mn.y)}}!function(Jt,Vn,_i,er,wi,Qn,jr,Ci,Di,Tr,Fr,Br,Cr,ao,To,Uo,Dr,is,jo,fo,nr,Vo,Sr,aa,Io){const Ds=Jt.addToLineVertexArray(Vn,er);let _s,la,ys,fl,xu,lh,ch,jc=0,kg=0,Rg=0,wu=0,Lg=-1,od=-1;const gc={};let Hp=ud("");const Vc=_i?_i.anchor:Vn;let Og=0,fi=0;if(void 0===Di._unevaluatedLayout.getValue("text-radial-offset")?[Og,fi]=Di.layout.get("text-offset").evaluate(nr,{},Io).map(js=>js*Js):(Og=Di.layout.get("text-radial-offset").evaluate(nr,{},Io)*Js,fi=Dp),Jt.allowVerticalPlacement&&wi.vertical){const js=wi.vertical;if(To)lh=Sp(js),Ci&&(ch=Sp(Ci));else{const $a=Di.layout.get("text-rotate").evaluate(nr,{},Io)+90;ys=tf(Tr,Vc,Vn,Fr,Br,Cr,js,ao,$a,Uo),Ci&&(fl=tf(Tr,Vc,Vn,Fr,Br,Cr,Ci,is,$a))}}if(Qn){const js=Di.layout.get("icon-rotate").evaluate(nr,{},Io),$a="none"!==Di.layout.get("icon-text-fit"),Hc=hg(Qn,js,Sr,$a),uh=Ci?hg(Ci,js,Sr,$a):void 0;la=tf(Tr,Vc,Vn,Fr,Br,Cr,Qn,is,js),jc=4*Hc.length;const $o=Jt.iconSizeData;let hh=null;"source"===$o.kind?(hh=[Za*Di.layout.get("icon-size").evaluate(nr,{},Io)],hh[0]>Rc&&hi(`${Jt.layerIds[0]}: Value for "icon-size" is >= ${fu}. Reduce your "icon-size".`)):"composite"===$o.kind&&(hh=[Za*Vo.compositeIconSizes[0].evaluate(nr,{},Io),Za*Vo.compositeIconSizes[1].evaluate(nr,{},Io)],(hh[0]>Rc||hh[1]>Rc)&&hi(`${Jt.layerIds[0]}: Value for "icon-size" is >= ${fu}. Reduce your "icon-size".`)),Jt.addSymbols(Jt.icon,Hc,hh,fo,jo,nr,!1,_i,Vn,Ds.lineStartIndex,Ds.lineLength,-1,aa,Io),Lg=Jt.icon.placedSymbolArray.length-1,uh&&(kg=4*uh.length,Jt.addSymbols(Jt.icon,uh,hh,fo,jo,nr,Ra.vertical,_i,Vn,Ds.lineStartIndex,Ds.lineLength,-1,aa,Io),od=Jt.icon.placedSymbolArray.length-1)}for(const js in wi.horizontal){const $a=wi.horizontal[js];_s||(Hp=ud($a.text),To?xu=Sp($a):_s=tf(Tr,Vc,Vn,Fr,Br,Cr,$a,ao,Di.layout.get("text-rotate").evaluate(nr,{},Io),Uo));const Hc=1===$a.positionedLines.length;if(Rg+=pg(Jt,_i,Vn,$a,jr,Di,To,nr,Uo,Ds,wi.vertical?Ra.horizontal:Ra.horizontalOnly,Hc?Object.keys(wi.horizontal):[js],gc,Lg,Vo,aa,Io),Hc)break}wi.vertical&&(wu+=pg(Jt,_i,Vn,wi.vertical,jr,Di,To,nr,Uo,Ds,Ra.vertical,["vertical"],gc,od,Vo,aa,Io));let $c=-1;const Gp=(js,$a)=>js?Math.max(js,$a):$a;$c=Gp(xu,$c),$c=Gp(lh,$c),$c=Gp(ch,$c);const ty=$c>-1?1:0;Jt.glyphOffsetArray.length>=pc.MAX_GLYPHS&&hi("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==nr.sortKey&&Jt.addToSortKeyRanges(Jt.symbolInstances.length,nr.sortKey),Jt.symbolInstances.emplaceBack(Vc.x,Vc.y,Vc.z,Vn.x,Vn.y,gc.right>=0?gc.right:-1,gc.center>=0?gc.center:-1,gc.left>=0?gc.left:-1,gc.vertical>=0?gc.vertical:-1,Lg,od,Hp,void 0!==_s?_s:Jt.collisionBoxArray.length,void 0!==_s?_s+1:Jt.collisionBoxArray.length,void 0!==ys?ys:Jt.collisionBoxArray.length,void 0!==ys?ys+1:Jt.collisionBoxArray.length,void 0!==la?la:Jt.collisionBoxArray.length,void 0!==la?la+1:Jt.collisionBoxArray.length,fl||Jt.collisionBoxArray.length,fl?fl+1:Jt.collisionBoxArray.length,Fr,Rg,wu,jc,kg,ty,0,Og,fi,$c)}(t,Mn,gi,mn,n,s,u,Xt,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,Le,yt,S,0,rt,qt,te,e,f,A,O,z)};if("line"===lt)for(const mn of Ep(e.geometry,0,0,Gn,Gn)){const Mn=$y(mn,Fe,Qe,n.vertical||de,s,Ie,De,t.overscaling,Gn);for(const yn of Mn)de&&W_(t,de.text,St,yn)||gt(mn,yn,z)}else if("line-center"===lt){for(const mn of e.geometry)if(mn.length>1){const Mn=wp(mn,Qe,n.vertical||de,s,Ie,De);Mn&&gt(mn,Mn,z)}}else if("Polygon"===e.type)for(const mn of tp(e.geometry,0)){const Mn=$_(mn,16);gt(mn[0],new cc(Mn.x,Mn.y,0,0,void 0),z)}else if("LineString"===e.type)for(const mn of e.geometry)gt(mn,new cc(mn[0].x,mn[0].y,0,0,void 0),z);else if("Point"===e.type)for(const mn of e.geometry)for(const Mn of mn)gt([Mn],new cc(Mn.x,Mn.y,0,0,void 0),z)}const fu=255,Rc=fu*Za;function pg(t,e,n,s,u,f,g,b,S,A,O,z,V,q,X,te,de){const ye=function(De,Fe,Le,rt,Qe,yt,qt,lt){const St=[];if(0===Fe.positionedLines.length)return St;const Ct=rt.layout.get("text-rotate").evaluate(yt,{})*Math.PI/180,Bt=function(yn){const gi=yn[0],Jt=yn[1],Vn=gi*Jt;return Vn>0?[gi,-Jt]:Vn<0?[-gi,Jt]:0===gi?[Jt,gi]:[Jt,-gi]}(Le);let Xt=Math.abs(Fe.top-Fe.bottom);for(const yn of Fe.positionedLines)Xt-=yn.lineOffset;const gt=Fe.positionedLines.length,mn=Xt/gt;let Mn=Fe.top-Le[1];for(let yn=0;yn<gt;++yn){const gi=Fe.positionedLines[yn];Mn=Jh(Fe,mn,Mn,yn);for(const Jt of gi.positionedGlyphs){if(!Jt.rect)continue;const Vn=Jt.rect||{};let _i=rg+1,er=!0,wi=1,Qn=0;if(Jt.imageName){const Sr=qt[Jt.imageName];if(!Sr)continue;if(Sr.sdf){hi("SDF images are not supported in formatted text and will be ignored.");continue}er=!1,wi=Sr.pixelRatio,_i=Ea/wi}const jr=(Qe||lt)&&Jt.vertical,Ci=Jt.metrics.advance*Jt.scale/2,Di=Jt.metrics,Tr=Jt.rect;if(null===Tr)continue;lt&&Fe.verticalizable&&(Qn=Jt.imageName?Ci-Jt.metrics.width*Jt.scale/2:0);const Fr=Qe?[Jt.x+Ci,Jt.y]:[0,0];let Br=[0,0],Cr=[0,0],ao=!1;Qe||(jr?(Cr=[Jt.x+Ci+Bt[0],Jt.y+Bt[1]-Qn],ao=!0):Br=[Jt.x+Ci+Le[0],Jt.y+Le[1]-Qn]);const To=Tr.w*Jt.scale/(wi*(Jt.localGlyph?Us:1)),Uo=Tr.h*Jt.scale/(wi*(Jt.localGlyph?Us:1));let Dr,is,jo,fo;if(jr){const Sr=Jt.y-Mn,aa=new Se(-Ci,Ci-Sr),Io=-Math.PI/2,Ds=new Se(...Cr);Dr=new Se(-Ci+Br[0],Br[1]),Dr._rotateAround(Io,aa)._add(Ds),Dr.x+=-Sr+Ci,Dr.y-=(Di.left-_i)*Jt.scale;const _s=Jt.imageName?Di.advance*Jt.scale:Js*Jt.scale,la=String.fromCharCode(Jt.glyph);R_(la)?Dr.x+=(1-_i)*Jt.scale:L_(la)?Dr.x+=_s-Di.height*Jt.scale+(-_i-1)*Jt.scale:Dr.x+=Jt.imageName||Di.width+2*_i===Tr.w&&Di.height+2*_i===Tr.h?(_s-Uo)/2:(_s-(Di.height+2*_i)*Jt.scale)/2,is=new Se(Dr.x,Dr.y-To),jo=new Se(Dr.x+Uo,Dr.y),fo=new Se(Dr.x+Uo,Dr.y-To)}else{const Sr=(Di.left-_i)*Jt.scale-Ci+Br[0],aa=(-Di.top-_i)*Jt.scale+Br[1],Io=Sr+To,Ds=aa+Uo;Dr=new Se(Sr,aa),is=new Se(Io,aa),jo=new Se(Sr,Ds),fo=new Se(Io,Ds)}if(Ct){let Sr;Sr=Qe?new Se(0,0):ao?new Se(Bt[0],Bt[1]):new Se(Le[0],Le[1]),Dr._rotateAround(Ct,Sr),is._rotateAround(Ct,Sr),jo._rotateAround(Ct,Sr),fo._rotateAround(Ct,Sr)}const nr=new Se(0,0),Vo=new Se(0,0);St.push({tl:Dr,tr:is,bl:jo,br:fo,tex:Vn,writingMode:Fe.writingMode,glyphOffset:Fr,sectionIndex:Jt.sectionIndex,isSDF:er,pixelOffsetTL:nr,pixelOffsetBR:Vo,minFontScaleX:0,minFontScaleY:0})}}return St}(0,s,S,f,g,b,u,t.allowVerticalPlacement),Ie=t.textSizeData;let ve=null;"source"===Ie.kind?(ve=[Za*f.layout.get("text-size").evaluate(b,{},de)],ve[0]>Rc&&hi(`${t.layerIds[0]}: Value for "text-size" is >= ${fu}. Reduce your "text-size".`)):"composite"===Ie.kind&&(ve=[Za*X.compositeTextSizes[0].evaluate(b,{},de),Za*X.compositeTextSizes[1].evaluate(b,{},de)],(ve[0]>Rc||ve[1]>Rc)&&hi(`${t.layerIds[0]}: Value for "text-size" is >= ${fu}. Reduce your "text-size".`)),t.addSymbols(t.text,ye,ve,S,g,b,O,e,n,A.lineStartIndex,A.lineLength,q,te,de);for(const De of z)V[De]=t.text.placedSymbolArray.length-1;return 4*ye.length}function mg(t){for(const e in t)return t[e];return null}function tf(t,e,n,s,u,f,g,b,S,A){let O=g.top,z=g.bottom,V=g.left,q=g.right;const X=g.collisionPadding;if(X&&(V-=X[0],O-=X[1],q+=X[2],z+=X[3]),S){const te=new Se(V,O),de=new Se(q,O),ye=new Se(V,z),Ie=new Se(q,z),ve=tt(S);let De=new Se(0,0);A&&(De=new Se(A[0],A[1])),te._rotateAround(ve,De),de._rotateAround(ve,De),ye._rotateAround(ve,De),Ie._rotateAround(ve,De),V=Math.min(te.x,de.x,ye.x,Ie.x),q=Math.max(te.x,de.x,ye.x,Ie.x),O=Math.min(te.y,de.y,ye.y,Ie.y),z=Math.max(te.y,de.y,ye.y,Ie.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,V,O,q,z,b,s,u,f),t.length-1}function Sp(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function W_(t,e,n,s){const u=t.compareText;if(e in u){const f=u[e];for(let g=f.length-1;g>=0;g--)if(s.dist(f[g])<n)return!0}else u[e]=[];return u[e].push(s),!1}function gg(t,e){const n=t.fovAboveCenter,s=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,u=(t._camera.position[2]*t.worldSize-s)/Math.cos(t._pitch),f=Math.sin(n)*u/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),g=Math.sin(t._pitch)*f+u;return Math.min(1.01*g,u*(1/t._horizonShift))}function Lc(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),s=t.x*n,u=(t.x+1)*n,f=t.y*n,g=(t.y+1)*n,b=ll(s),S=ll(u),A=Ns(f),O=Ns(g),z=e.project(b,A),V=e.project(S,A),q=e.project(S,O),X=e.project(b,O);let te=Math.min(z.x,V.x,q.x,X.x),de=Math.min(z.y,V.y,q.y,X.y),ye=Math.max(z.x,V.x,q.x,X.x),Ie=Math.max(z.y,V.y,q.y,X.y);const ve=n/16;function De(Le,rt,Qe,yt,qt,lt){const St=(Qe+qt)/2,Ct=(yt+lt)/2,Bt=e.project(ll(St),Ns(Ct)),Xt=Math.max(0,te-Bt.x,de-Bt.y,Bt.x-ye,Bt.y-Ie);te=Math.min(te,Bt.x),ye=Math.max(ye,Bt.x),de=Math.min(de,Bt.y),Ie=Math.max(Ie,Bt.y),Xt>ve&&(De(Le,Bt,Qe,yt,St,Ct),De(Bt,rt,St,Ct,qt,lt))}De(z,V,s,f,u,f),De(V,q,u,f,u,g),De(q,X,u,g,s,g),De(X,z,s,g,s,f),te-=ve,de-=ve,ye+=ve,Ie+=ve;const Fe=1/Math.max(ye-te,Ie-de);return{scale:Fe,x:te*Fe,y:de*Fe,x2:ye*Fe,y2:Ie*Fe,projection:e}}const _g=bl(new Float32Array(16));class Oc{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Or(0,0)}projectTilePoint(e,n,s){return{x:e,y:n,z:0}}locationPoint(e,n,s=!0){return e._coordinatePoint(e.locationCoordinate(n),s)}pixelsPerMeter(e,n){return ql(1,e)*n}pixelSpaceConversion(e,n,s){return 1}farthestPixelDistance(e){return gg(e,e.pixelsPerMeter)}pointCoordinate(e,n,s,u){const f=e.horizonLineFromTop(!1),g=new Se(n,Math.max(f,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(g,u))}pointCoordinate3D(e,n,s){const u=new Se(n,s);if(e.elevation)return e.elevation.pointCoordinate(u);{const f=this.pointCoordinate(e,u.x,u.y,0);return[f.x,f.y,f.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);const s=e.horizonLineFromTop();return n.y<s}createInversionMatrix(e,n){return _g}createTileMatrix(e,n,s){let u,f,g;const b=s.canonical,S=bl(new Float64Array(16));if(this.isReprojectedInTileSpace){const A=Lc(b,this);u=1,f=A.x+s.wrap*A.scale,g=A.y,tu(S,S,[u/A.scale,u/A.scale,e.pixelsPerMeter/n])}else u=n/e.zoomScale(b.z),f=(b.x+Math.pow(2,b.z)*s.wrap)*u,g=b.y*u;return vh(S,S,[f,g,0]),tu(S,S,[u/Gn,u/Gn,1]),S}upVector(e,n,s){return[0,0,1]}upVectorScale(e,n,s){return{metersToTile:1}}}class Gy extends Oc{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,s]=this.parallels=e.parallels||[29.5,45.5],u=Math.sin(tt(n));this.n=(u+Math.sin(tt(s)))/2,this.c=1+u*(2*this.n-u),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:s,c:u,r0:f}=this,g=tt(e-this.center[0]),b=tt(n),S=Math.sqrt(u-2*s*Math.sin(b))/s;return{x:S*Math.sin(g*s),y:S*Math.cos(g*s)-f,z:0}}unproject(e,n){const{n:s,c:u,r0:f}=this,g=f+n;let b=Math.atan2(e,Math.abs(g))*Math.sign(g);g*s<0&&(b-=Math.PI*Math.sign(e)*Math.sign(g));const S=tt(this.center[0])*s;b=qe(b,-Math.PI-S,Math.PI-S);const A=Mt(kt(b/s)+this.center[0],-180,180),O=Math.asin(Mt((u-(e*e+g*g)*s*s)/(2*s),-1,1)),z=Mt(kt(O),-Ys,Ys);return new Or(A,z)}}const eh=1.340264,nf=-.081106,Fc=893e-6,ed=.003796,rf=Math.sqrt(3)/2;class Ap extends Oc{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(rf*Math.sin(n)),u=s*s,f=u*u*u;return{x:.5*(e*Math.cos(s)/(rf*(eh+3*nf*u+f*(7*Fc+9*ed*u)))/Math.PI+.5),y:1-.5*(s*(eh+nf*u+f*(Fc+ed*u))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,u=s*s,f=u*u*u;for(let O,z,V,q=0;q<12&&(z=s*(eh+nf*u+f*(Fc+ed*u))-n,V=eh+3*nf*u+f*(7*Fc+9*ed*u),O=z/V,s=Mt(s-O,-Math.PI/3,Math.PI/3),u=s*s,f=u*u*u,!(Math.abs(O)<1e-12));++q);const g=rf*e*(eh+3*nf*u+f*(7*Fc+9*ed*u))/Math.cos(s),b=Math.asin(Math.sin(s)/rf),S=Mt(180*g/Math.PI,-180,180),A=Mt(180*b/Math.PI,-Ys,Ys);return new Or(S,A)}}class Z_ extends Oc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const s=360*(e-.5),u=Mt(360*(.5-n),-Ys,Ys);return new Or(s,u)}}const La=Math.PI/2;function Bc(t){return Math.tan((La+t)/2)}class Ta extends Oc{constructor(e){super(e),this.center=e.center||[0,30];const[n,s]=this.parallels=e.parallels||[30,30];let u=tt(n),f=tt(s);this.southernCenter=u+f<0,this.southernCenter&&(u=-u,f=-f);const g=Math.cos(u),b=Bc(u);this.n=u===f?Math.sin(u):Math.log(g/Math.cos(f))/Math.log(Bc(f)/b),this.f=g*Math.pow(Bc(u),this.n)/this.n}project(e,n){n=tt(n),this.southernCenter&&(n=-n),e=tt(e-this.center[0]);const s=1e-6,{n:u,f}=this;f>0?n<-La+s&&(n=-La+s):n>La-s&&(n=La-s);const g=f/Math.pow(Bc(n),u);let b=g*Math.sin(u*e),S=f-g*Math.cos(u*e);return b=.5*(b/Math.PI+.5),S=.5*(S/Math.PI+.5),{x:b,y:this.southernCenter?S:1-S,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:s,f:u}=this,f=u-n,g=Math.sign(f),b=Math.sign(s)*Math.sqrt(e*e+f*f);let S=Math.atan2(e,Math.abs(f))*g;f*s<0&&(S-=Math.PI*Math.sign(e)*g);const A=Mt(kt(S/s)+this.center[0],-180,180),O=Mt(kt(2*Math.atan(Math.pow(u/b,1/s))-La),-Ys,Ys);return new Or(A,this.southernCenter?-O:O)}}class zc extends Oc{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:sl(e),y:al(n),z:0}}unproject(e,n){const s=ll(e),u=Ns(n);return new Or(s,u)}}const td=tt(Ys);class ul extends Oc{project(e,n){const s=(n=tt(n))*n,u=s*s;return{x:.5*((e=tt(e))*(.8707-.131979*s+u*(u*(.003971*s-.001529*u)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+s*(.015085+u*(.028874*s-.044475-.005916*u)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,u=25,f=0,g=s*s;do{g=s*s;const A=g*g;f=(s*(1.007226+g*(.015085+A*(.028874*g-.044475-.005916*A)))-n)/(1.007226+g*(.045255+A*(.259866*g-.311325-.005916*11*A))),s=Mt(s-f,-td,td)}while(Math.abs(f)>1e-6&&--u>0);g=s*s;const b=Mt(kt(e/(.8707+g*(g*(g*g*g*(.003971-.001529*g)-.013791)-.131979))),-180,180),S=kt(s);return new Or(b,S)}}const sf=tt(Ys);class th extends Oc{project(e,n){n=tt(n),e=tt(e);const s=Math.cos(n),u=2/Math.PI,f=Math.acos(s*Math.cos(e/2)),g=Math.sin(f)/f,b=.5*(e*u+2*s*Math.sin(e/2)/g)||0,S=.5*(n+Math.sin(n)/g)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(S/Math.PI+1),z:0}}unproject(e,n){let s=e=(2*e-.5)*Math.PI,u=n=(2*(1-n)-1)*Math.PI,f=25;const g=1e-6;let b=0,S=0;do{const A=Math.cos(u),O=Math.sin(u),z=2*O*A,V=O*O,q=A*A,X=Math.cos(s/2),te=Math.sin(s/2),de=2*X*te,ye=te*te,Ie=1-q*X*X,ve=Ie?1/Ie:0,De=Ie?Math.acos(A*X)*Math.sqrt(1/Ie):0,Fe=.5*(2*De*A*te+2*s/Math.PI)-e,Le=.5*(De*O+u)-n,rt=.5*ve*(q*ye+De*A*X*V)+1/Math.PI,Qe=ve*(de*z/4-De*O*te),yt=.125*ve*(z*te-De*O*q*de),qt=.5*ve*(V*X+De*ye*A)+.5,lt=Qe*yt-qt*rt;b=(Le*Qe-Fe*qt)/lt,S=(Fe*yt-Le*rt)/lt,s=Mt(s-b,-Math.PI,Math.PI),u=Mt(u-S,-sf,sf)}while((Math.abs(b)>g||Math.abs(S)>g)&&--f>0);return new Or(kt(s),kt(u))}}class pu extends Oc{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(tt(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:s,cosPhi:u}=this;return{x:tt(e)*u*s+.5,y:-Math.sin(tt(n))/u*s+.5,z:0}}unproject(e,n){const{scale:s,cosPhi:u}=this,f=-(n-.5)/s,g=Mt(kt((e-.5)/s)/u,-180,180),b=Math.asin(Mt(f*u,-1,1)),S=Mt(kt(b),-Ys,Ys);return new Or(g,S)}}class nh extends zc{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,s){const u=Dd(e,n,s);return Eo(u,u,zu(Hl(s))),{x:u[0],y:u[1],z:u[2]}}locationPoint(e,n){const s=Th(n.lat,n.lng),u=zs([],s),f=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;xd(s,s,u,ql(1,0)*Gn*f);const g=bl(new Float64Array(16));return eu(g,e.pixelMatrix,e.globeMatrix),Eo(s,s,g),new Se(s[0],s[1])}pixelsPerMeter(e,n){return ql(1,0)*n}pixelSpaceConversion(e,n,s){const u=ql(1,e)*n,f=mi(ql(1,45)*n,u,s);return this.pixelsPerMeter(e,n)/f}createTileMatrix(e,n,s){const u=Vf(Hl(s.canonical));return eu(new Float64Array(16),e.globeMatrix,u)}createInversionMatrix(e,n){const{center:s}=e,u=zu(Hl(n));return gd(u,u,tt(s.lng)),Mf(u,u,tt(s.lat)),tu(u,u,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(u)}pointCoordinate(e,n,s,u){return zf(e,n,s,!0)||new ju(0,0)}pointCoordinate3D(e,n,s){const u=this.pointCoordinate(e,n,s,0);return[u.x,u.y,u.z]}isPointAboveHorizon(e,n){return!zf(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(u,f){const g=u.cameraToCenterDistance,b=u._centerAltitude*f,S=u._camera,A=u._camera.forward(),O=Vl([],Wa([],A,-g),[0,0,b]),z=u.worldSize/(2*Math.PI),V=[0,0,-z],q=u.width/u.height,X=Math.tan(u.fovAboveCenter),te=Wa([],S.up(),X),de=Wa([],S.right(),X*q),ye=zs([],Vl([],Vl([],A,te),de)),Ie=[];let ve;if(new Fu(O,ye).closestPointOnSphere(V,z,Ie)){const De=Vl([],Ie,V),Fe=ol([],De,O);ve=Math.cos(u.fovAboveCenter)*xh(Fe)}else{const De=ol([],O,V),Fe=ol([],V,O);zs(Fe,Fe);const Le=xh(De)-z;ve=Math.sqrt(Le*(Le+2*z));const rt=Math.acos(ve/(z+Le))-Math.acos(rl(A,Fe));ve*=Math.cos(rt)}return 1.01*ve}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=Nu(e.zoom);if(s>0){const u=gg(e,ql(1,e.center.lat)*e.worldSize),f=e.worldSize/(2*Math.PI),g=Math.max(e.width,e.height)/e.worldSize*Math.PI;return mi(n,u+f*(1-Math.cos(g)),Math.pow(s,10))}return n}upVector(e,n,s){return Dd(n,s,e,1)}upVectorScale(e){return{metersToTile:bh(jf(Hl(e)))}}}function mu(t){const e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new zc(t);case"equirectangular":return new Z_(t);case"naturalEarth":return new ul(t);case"equalEarth":return new Ap(t);case"winkelTripel":return new th(t);case"albers":return n?new pu(t):new Gy(t);case"lambertConformalConic":return n?new pu(t):new Ta(t);case"globe":return new nh(t)}throw new Error(`Invalid projection name: ${t.name}`)}const ih=Nd.types,rh=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function hc(t,e,n,s,u,f,g,b,S,A,O,z,V){const q=b?Math.min(Rc,Math.round(b[0])):0,X=b?Math.min(Rc,Math.round(b[1])):0;t.emplaceBack(e,n,Math.round(32*s),Math.round(32*u),f,g,(q<<1)+(S?1:0),X,16*A,16*O,256*z,256*V)}function dc(t,e,n,s,u,f,g){t.emplaceBack(e,n,s,u,f,g)}function fc(t,e,n,s,u){t.emplaceBack(e,n,s,u),t.emplaceBack(e,n,s,u),t.emplaceBack(e,n,s,u),t.emplaceBack(e,n,s,u)}function yg(t){for(const e of t.sections)if(ph(e.text))return!0;return!1}class af{constructor(e){this.layoutVertexArray=new Rt,this.indexArray=new Bn,this.programConfigurations=e,this.segments=new No,this.dynamicLayoutVertexArray=new $t,this.opacityVertexArray=new jn,this.placedSymbolArray=new bo,this.globeExtVertexArray=new Kt}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,n,s,u){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,M_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Zm.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,rh,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,I_.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||u)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}wn(af,"SymbolBuffers");class lf{constructor(e,n,s){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new s,this.segments=new No,this.collisionVertexArray=new Ui,this.collisionVertexArrayExt=new Fi}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,P_.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,Xm.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}wn(lf,"CollisionBuffers");class pc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(g=>g.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=bl([]),this.placementViewportMatrix=bl([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=up(this.zoom,n["text-size"]),this.iconSizeData=up(this.zoom,n["icon-size"]);const s=this.layers[0].layout,u=s.get("symbol-sort-key"),f=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==f&&void 0!==u.constantOr(1),this.sortFeaturesByY=("viewport-y"===f||"auto"===f&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(g=>Ra[g]),this.stateDependentLayerIds=this.layers.filter(g=>g.isStateDependent()).map(g=>g.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new af(new Ec(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new af(new Ec(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new Ia,this.lineVertexArray=new mh,this.symbolInstances=new Kr}calculateGlyphDependencies(e,n,s,u,f){for(let g=0;g<e.length;g++)if(n[e.charCodeAt(g)]=!0,u&&f){const b=Zu[e.charAt(g)];b&&(n[b.charCodeAt(0)]=!0)}}populate(e,n,s,u){const f=this.layers[0],g=f.layout,b="globe"===this.projection.name,S=g.get("text-font"),A=g.get("text-field"),O=g.get("icon-image"),z=("constant"!==A.value.kind||A.value.value instanceof eo&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&("constant"!==S.value.kind||S.value.value.length>0),V="constant"!==O.value.kind||!!O.value.value||Object.keys(O.parameters).length>0,q=g.get("symbol-sort-key");if(this.features=[],!z&&!V)return;const X=n.iconDependencies,te=n.glyphDependencies,de=n.availableImages,ye=new y(this.zoom);for(const{feature:Ie,id:ve,index:De,sourceLayerIndex:Fe}of e){const Le=f._featureFilter.needGeometry,rt=Ac(Ie,Le);if(!f._featureFilter.filter(ye,rt,s))continue;if(Le||(rt.geometry=lc(Ie,s,u)),b&&1!==Ie.type&&s.z<=5){const lt=rt.geometry,St=.98078528056,Ct=(Bt,Xt)=>rl(Dd(Bt.x,Bt.y,s,1),Dd(Xt.x,Xt.y,s,1))<St;for(let Bt=0;Bt<lt.length;Bt++)lt[Bt]=Gf(lt[Bt],Ct)}let Qe,yt;if(z){const lt=f.getValueAndResolveTokens("text-field",rt,s,de),St=eo.factory(lt);yg(St)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===C()||this.hasRTLText&&m.isParsed())&&(Qe=k_(St,f,rt))}if(V){const lt=f.getValueAndResolveTokens("icon-image",rt,s,de);yt=lt instanceof to?lt:to.fromString(lt)}if(!Qe&&!yt)continue;const qt=this.sortFeaturesByKey?q.evaluate(rt,{},s):void 0;if(this.features.push({id:ve,text:Qe,icon:yt,index:De,sourceLayerIndex:Fe,geometry:rt.geometry,properties:Ie.properties,type:ih[Ie.type],sortKey:qt}),yt&&(X[yt.name]=!0),Qe){const lt=S.evaluate(rt,{},s).join(","),St="map"===g.get("text-rotation-alignment")&&"point"!==g.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Ra.vertical)>=0;for(const Ct of Qe.sections)if(Ct.image)X[Ct.image.name]=!0;else{const Bt=Kc(Qe.toString()),Xt=Ct.fontStack||lt,gt=te[Xt]=te[Xt]||{};this.calculateGlyphDependencies(Ct.text,gt,St,this.allowVerticalPlacement,Bt)}}}"line"===g.get("symbol-placement")&&(this.features=function(Ie){const ve={},De={},Fe=[];let Le=0;function rt(lt){Fe.push(Ie[lt]),Le++}function Qe(lt,St,Ct){const Bt=De[lt];return delete De[lt],De[St]=Bt,Fe[Bt].geometry[0].pop(),Fe[Bt].geometry[0]=Fe[Bt].geometry[0].concat(Ct[0]),Bt}function yt(lt,St,Ct){const Bt=ve[St];return delete ve[St],ve[lt]=Bt,Fe[Bt].geometry[0].shift(),Fe[Bt].geometry[0]=Ct[0].concat(Fe[Bt].geometry[0]),Bt}function qt(lt,St,Ct){const Bt=Ct?St[0][St[0].length-1]:St[0][0];return`${lt}:${Bt.x}:${Bt.y}`}for(let lt=0;lt<Ie.length;lt++){const St=Ie[lt],Ct=St.geometry,Bt=St.text?St.text.toString():null;if(!Bt){rt(lt);continue}const Xt=qt(Bt,Ct),gt=qt(Bt,Ct,!0);if(Xt in De&&gt in ve&&De[Xt]!==ve[gt]){const mn=yt(Xt,gt,Ct),Mn=Qe(Xt,gt,Fe[mn].geometry);delete ve[Xt],delete De[gt],De[qt(Bt,Fe[Mn].geometry,!0)]=Mn,Fe[mn].geometry=null}else Xt in De?Qe(Xt,gt,Ct):gt in ve?yt(Xt,gt,Ct):(rt(lt),ve[Xt]=Le-1,De[gt]=Le-1)}return Fe.filter(lt=>lt.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Ie,ve)=>Ie.sortKey-ve.sortKey)}update(e,n,s,u){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,s,u),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,s,u))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=mu(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const s=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:u,y:f}of n)this.lineVertexArray.emplaceBack(u,f);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,n,s,u,f,g,b,S,A,O,z,V,q,X){const te=e.indexArray,de=e.layoutVertexArray,ye=e.globeExtVertexArray,Ie=e.segments.prepareSegment(4*n.length,de,te,this.canOverlap?g.sortKey:void 0),ve=this.glyphOffsetArray.length,De=Ie.vertexLength,Fe=this.allowVerticalPlacement&&b===Ra.vertical?Math.PI/2:0,Le=g.text&&g.text.sections;for(let Qe=0;Qe<n.length;Qe++){const{tl:yt,tr:qt,bl:lt,br:St,tex:Ct,pixelOffsetTL:Bt,pixelOffsetBR:Xt,minFontScaleX:gt,minFontScaleY:mn,glyphOffset:Mn,isSDF:yn,sectionIndex:gi}=n[Qe],Jt=Ie.vertexLength,Vn=Mn[1];if(hc(de,A.x,A.y,yt.x,Vn+yt.y,Ct.x,Ct.y,s,yn,Bt.x,Bt.y,gt,mn),hc(de,A.x,A.y,qt.x,Vn+qt.y,Ct.x+Ct.w,Ct.y,s,yn,Xt.x,Bt.y,gt,mn),hc(de,A.x,A.y,lt.x,Vn+lt.y,Ct.x,Ct.y+Ct.h,s,yn,Bt.x,Xt.y,gt,mn),hc(de,A.x,A.y,St.x,Vn+St.y,Ct.x+Ct.w,Ct.y+Ct.h,s,yn,Xt.x,Xt.y,gt,mn),S){const{x:_i,y:er,z:wi}=S.anchor,[Qn,jr,Ci]=S.up;dc(ye,_i,er,wi,Qn,jr,Ci),dc(ye,_i,er,wi,Qn,jr,Ci),dc(ye,_i,er,wi,Qn,jr,Ci),dc(ye,_i,er,wi,Qn,jr,Ci),fc(e.dynamicLayoutVertexArray,_i,er,wi,Fe)}else fc(e.dynamicLayoutVertexArray,A.x,A.y,A.z,Fe);te.emplaceBack(Jt,Jt+1,Jt+2),te.emplaceBack(Jt+1,Jt+2,Jt+3),Ie.vertexLength+=4,Ie.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Mn[0]),Qe!==n.length-1&&gi===n[Qe+1].sectionIndex||e.programConfigurations.populatePaintArrays(de.length,g,g.index,{},q,X,Le&&Le[gi])}const rt=S?S.anchor:A;e.placedSymbolArray.emplaceBack(rt.x,rt.y,rt.z,A.x,A.y,ve,this.glyphOffsetArray.length-ve,De,O,z,A.segment,s?s[0]:0,s?s[1]:0,u[0],u[1],b,0,!1,0,V,0)}_commitLayoutVertex(e,n,s,u,f,g,b){e.emplaceBack(n,s,u,f,g,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(e,n,s,u,f,g,b){const S=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),A=S.vertexLength,O=b.tileAnchorX,z=b.tileAnchorY;for(let q=0;q<4;q++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,u,f,g,O,z,new Se(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,f,g,O,z,new Se(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,u,f,g,O,z,new Se(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,u,f,g,O,z,new Se(e.x1,e.y2)),S.vertexLength+=4;const V=s.indexArray;V.emplaceBack(A,A+1),V.emplaceBack(A+1,A+2),V.emplaceBack(A+2,A+3),V.emplaceBack(A+3,A),S.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,s,u,f,g){for(let b=u;b<f;b++){const S=s.get(b),A=this.getSymbolInstanceTextSize(e,g,n,b);this._addCollisionDebugVertices(S,A,this.textCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,g)}}_addIconDebugCollisionBoxes(e,n,s,u,f,g){for(let b=u;b<f;b++){const S=s.get(b),A=this.getSymbolInstanceIconSize(e,n,g.placedIconSymbolIndex);this._addCollisionDebugVertices(S,A,this.iconCollisionBox,S.projectedAnchorX,S.projectedAnchorY,S.projectedAnchorZ,g)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new lf(Pn,lp.members,Fs),this.iconCollisionBox=new lf(Pn,lp.members,Fs);const s=Cl(this.iconSizeData,e),u=Cl(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._addTextDebugCollisionBoxes(u,e,n,g.textBoxStartIndex,g.textBoxEndIndex,g),this._addTextDebugCollisionBoxes(u,e,n,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._addIconDebugCollisionBoxes(s,e,n,g.iconBoxStartIndex,g.iconBoxEndIndex,g),this._addIconDebugCollisionBoxes(s,e,n,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g)}}getSymbolInstanceTextSize(e,n,s,u){const f=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:u),g=hp(this.textSizeData,e,f)/Js;return this.tilePixelRatio*g}getSymbolInstanceIconSize(e,n,s){const u=this.icon.placedSymbolArray.get(s),f=hp(this.iconSizeData,e,u);return this.tilePixelRatio*f}_commitDebugCollisionVertexUpdate(e,n,s){e.emplaceBack(n,-s,-s),e.emplaceBack(n,s,-s),e.emplaceBack(n,s,s),e.emplaceBack(n,-s,s)}_updateTextDebugCollisionBoxes(e,n,s,u,f,g){for(let b=u;b<f;b++){const S=s.get(b),A=this.getSymbolInstanceTextSize(e,g,n,b);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,A,S.padding)}}_updateIconDebugCollisionBoxes(e,n,s,u,f,g){for(let b=u;b<f;b++){const S=s.get(b),A=this.getSymbolInstanceIconSize(e,n,g);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,A,S.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=Cl(this.iconSizeData,e),u=Cl(this.textSizeData,e);for(let f=0;f<this.symbolInstances.length;f++){const g=this.symbolInstances.get(f);this._updateTextDebugCollisionBoxes(u,e,n,g.textBoxStartIndex,g.textBoxEndIndex,g),this._updateTextDebugCollisionBoxes(u,e,n,g.verticalTextBoxStartIndex,g.verticalTextBoxEndIndex,g),this._updateIconDebugCollisionBoxes(s,e,n,g.iconBoxStartIndex,g.iconBoxEndIndex,g.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(s,e,n,g.verticalIconBoxStartIndex,g.verticalIconBoxEndIndex,g.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,s,u,f,g,b,S,A){const O={};if(n<s){const{x1:z,y1:V,x2:q,y2:X,padding:te,projectedAnchorX:de,projectedAnchorY:ye,projectedAnchorZ:Ie,tileAnchorX:ve,tileAnchorY:De,featureIndex:Fe}=e.get(n);O.textBox={x1:z,y1:V,x2:q,y2:X,padding:te,projectedAnchorX:de,projectedAnchorY:ye,projectedAnchorZ:Ie,tileAnchorX:ve,tileAnchorY:De},O.textFeatureIndex=Fe}if(u<f){const{x1:z,y1:V,x2:q,y2:X,padding:te,projectedAnchorX:de,projectedAnchorY:ye,projectedAnchorZ:Ie,tileAnchorX:ve,tileAnchorY:De,featureIndex:Fe}=e.get(u);O.verticalTextBox={x1:z,y1:V,x2:q,y2:X,padding:te,projectedAnchorX:de,projectedAnchorY:ye,projectedAnchorZ:Ie,tileAnchorX:ve,tileAnchorY:De},O.verticalTextFeatureIndex=Fe}if(g<b){const{x1:z,y1:V,x2:q,y2:X,padding:te,projectedAnchorX:de,projectedAnchorY:ye,projectedAnchorZ:Ie,tileAnchorX:ve,tileAnchorY:De,featureIndex:Fe}=e.get(g);O.iconBox={x1:z,y1:V,x2:q,y2:X,padding:te,projectedAnchorX:de,projectedAnchorY:ye,projectedAnchorZ:Ie,tileAnchorX:ve,tileAnchorY:De},O.iconFeatureIndex=Fe}if(S<A){const{x1:z,y1:V,x2:q,y2:X,padding:te,projectedAnchorX:de,projectedAnchorY:ye,projectedAnchorZ:Ie,tileAnchorX:ve,tileAnchorY:De,featureIndex:Fe}=e.get(S);O.verticalIconBox={x1:z,y1:V,x2:q,y2:X,padding:te,projectedAnchorX:de,projectedAnchorY:ye,projectedAnchorZ:Ie,tileAnchorX:ve,tileAnchorY:De},O.verticalIconFeatureIndex=Fe}return O}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const s=e.placedSymbolArray.get(n),u=s.vertexStartIndex+4*s.numGlyphs;for(let f=s.vertexStartIndex;f<u;f+=4)e.indexArray.emplaceBack(f,f+1,f+2),e.indexArray.emplaceBack(f+1,f+2,f+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const n=Math.sin(e),s=Math.cos(e),u=[],f=[],g=[];for(let b=0;b<this.symbolInstances.length;++b){g.push(b);const S=this.symbolInstances.get(b);u.push(0|Math.round(n*S.tileAnchorX+s*S.tileAnchorY)),f.push(S.featureIndex)}return g.sort((b,S)=>u[b]-u[S]||f[S]-f[b]),g}addToSortKeyRanges(e,n){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===n?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const s=this.symbolInstances.get(n);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:u,centerJustifiedTextSymbolIndex:f,leftJustifiedTextSymbolIndex:g,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:S,verticalPlacedIconSymbolIndex:A}=s;u>=0&&this.addIndicesForPlacedSymbol(this.text,u),f>=0&&f!==u&&this.addIndicesForPlacedSymbol(this.text,f),g>=0&&g!==f&&g!==u&&this.addIndicesForPlacedSymbol(this.text,g),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),S>=0&&this.addIndicesForPlacedSymbol(this.icon,S),A>=0&&this.addIndicesForPlacedSymbol(this.icon,A)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}wn(pc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),pc.MAX_GLYPHS=65535,pc.addDynamicAttributes=fc;const vg=new we({"symbol-placement":new Z(ft.layout_symbol["symbol-placement"]),"symbol-spacing":new Z(ft.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Z(ft.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ce(ft.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Z(ft.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Z(ft.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Z(ft.layout_symbol["icon-ignore-placement"]),"icon-optional":new Z(ft.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Z(ft.layout_symbol["icon-rotation-alignment"]),"icon-size":new ce(ft.layout_symbol["icon-size"]),"icon-text-fit":new Z(ft.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Z(ft.layout_symbol["icon-text-fit-padding"]),"icon-image":new ce(ft.layout_symbol["icon-image"]),"icon-rotate":new ce(ft.layout_symbol["icon-rotate"]),"icon-padding":new Z(ft.layout_symbol["icon-padding"]),"icon-keep-upright":new Z(ft.layout_symbol["icon-keep-upright"]),"icon-offset":new ce(ft.layout_symbol["icon-offset"]),"icon-anchor":new ce(ft.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Z(ft.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Z(ft.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Z(ft.layout_symbol["text-rotation-alignment"]),"text-field":new ce(ft.layout_symbol["text-field"]),"text-font":new ce(ft.layout_symbol["text-font"]),"text-size":new ce(ft.layout_symbol["text-size"]),"text-max-width":new ce(ft.layout_symbol["text-max-width"]),"text-line-height":new ce(ft.layout_symbol["text-line-height"]),"text-letter-spacing":new ce(ft.layout_symbol["text-letter-spacing"]),"text-justify":new ce(ft.layout_symbol["text-justify"]),"text-radial-offset":new ce(ft.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Z(ft.layout_symbol["text-variable-anchor"]),"text-anchor":new ce(ft.layout_symbol["text-anchor"]),"text-max-angle":new Z(ft.layout_symbol["text-max-angle"]),"text-writing-mode":new Z(ft.layout_symbol["text-writing-mode"]),"text-rotate":new ce(ft.layout_symbol["text-rotate"]),"text-padding":new Z(ft.layout_symbol["text-padding"]),"text-keep-upright":new Z(ft.layout_symbol["text-keep-upright"]),"text-transform":new ce(ft.layout_symbol["text-transform"]),"text-offset":new ce(ft.layout_symbol["text-offset"]),"text-allow-overlap":new Z(ft.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Z(ft.layout_symbol["text-ignore-placement"]),"text-optional":new Z(ft.layout_symbol["text-optional"])});var cf={paint:new we({"icon-opacity":new ce(ft.paint_symbol["icon-opacity"]),"icon-color":new ce(ft.paint_symbol["icon-color"]),"icon-halo-color":new ce(ft.paint_symbol["icon-halo-color"]),"icon-halo-width":new ce(ft.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ce(ft.paint_symbol["icon-halo-blur"]),"icon-translate":new Z(ft.paint_symbol["icon-translate"]),"icon-translate-anchor":new Z(ft.paint_symbol["icon-translate-anchor"]),"text-opacity":new ce(ft.paint_symbol["text-opacity"]),"text-color":new ce(ft.paint_symbol["text-color"],{runtimeType:Mi,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new ce(ft.paint_symbol["text-halo-color"]),"text-halo-width":new ce(ft.paint_symbol["text-halo-width"]),"text-halo-blur":new ce(ft.paint_symbol["text-halo-blur"]),"text-translate":new Z(ft.paint_symbol["text-translate"]),"text-translate-anchor":new Z(ft.paint_symbol["text-translate-anchor"])}),layout:vg};class Mp{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:Zo,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}wn(Mp,"FormatSectionOverride",{omit:["defaultValue"]});class nd extends wl{constructor(e){super(e,cf)}recalculate(e,n){super.recalculate(e,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const u=[];for(const f of s)u.indexOf(f)<0&&u.push(f);this.layout._values["text-writing-mode"]=u}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,s,u){const f=this.layout.get(e).evaluate(n,{},s,u),g=this._unevaluatedLayout._values[e];return g.isDataDriven()||en(g.value)||!f?f:(b=n.properties,f.replace(/{([^{}]+)}/g,(A,O)=>O in b?String(b[O]):""));var b}createBucket(e){return new pc(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of cf.paint.overridableProperties){if(!nd.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),s=new Mp(n),u=new We(s,n.property.specification);let f=null;f="constant"===n.value.kind||"source"===n.value.kind?new zn("source",u):new Gi("composite",u,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new ee(n.property,f,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven())&&nd.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const s=e.get("text-field"),u=cf.paint.properties[n];let f=!1;const g=b=>{for(const S of b)if(u.overrides&&u.overrides.hasOverride(S))return void(f=!0)};if("constant"===s.value.kind&&s.value.value instanceof eo)g(s.value.value.sections);else if("source"===s.value.kind){const b=A=>{f||(A instanceof $r&&Ei(A.value)===So?g(A.value.sections):A instanceof Hr?g(A.sections):A.eachChild(b))},S=s.value;S._styleExpression&&b(S._styleExpression.expression)}return f}getProgramConfiguration(e){return new bc(this,e)}}var xg={paint:new we({"background-color":new Z(ft.paint_background["background-color"]),"background-pattern":new Z(ft.paint_background["background-pattern"]),"background-opacity":new Z(ft.paint_background["background-opacity"])})},X_={paint:new we({"raster-opacity":new Z(ft.paint_raster["raster-opacity"]),"raster-hue-rotate":new Z(ft.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Z(ft.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Z(ft.paint_raster["raster-brightness-max"]),"raster-saturation":new Z(ft.paint_raster["raster-saturation"]),"raster-contrast":new Z(ft.paint_raster["raster-contrast"]),"raster-resampling":new Z(ft.paint_raster["raster-resampling"]),"raster-fade-duration":new Z(ft.paint_raster["raster-fade-duration"])})};class K_ extends wl{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var wg={paint:new we({"sky-type":new Z(ft.paint_sky["sky-type"]),"sky-atmosphere-sun":new Z(ft.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Z(ft.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Z(ft.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Z(ft.paint_sky["sky-gradient-radius"]),"sky-gradient":new _e(ft.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Z(ft.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Z(ft.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Z(ft.paint_sky["sky-opacity"])})};function Ip(t,e,n){const s=[0,0,1],u=Lu([]);return Lf(u,u,n?-tt(t)+Math.PI:tt(t)),lm(u,u,-tt(e)),kf(s,s,u),zs(s,s)}const bg={circle:class extends wl{constructor(t){super(t,a_)}createBucket(t){return new Wf(t)}queryRadius(t){const e=t;return su("circle-radius",this,e)+su("circle-stroke-width",this,e)+Ph(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,s,u,f,g,b){const S=s_(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),A=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return Id(t,s,f,g,b,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),S,A)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new bc(this,t)}},heatmap:class extends wl{createBucket(t){return new Pd(t)}constructor(t){super(t,Cm),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Lh({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return su("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,s,u,f,g,b){const S=this.paint.get("heatmap-radius").evaluate(e,n);return Id(t,s,f,g,b,!0,!0,new Se(0,0),S)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new bc(this,t)}},hillshade:class extends wl{constructor(t){super(t,c_)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends wl{constructor(t){super(t,Ny)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(t){return new bc(this,t)}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Bd(t)}queryRadius(){return Ph(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,s,u,f){return!t.queryGeometry.isAboveHorizon&&Zf(Md(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends wl{constructor(t){super(t,hu)}createBucket(t){return new Vh(t)}queryRadius(){return Ph(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new bc(this,t)}queryIntersectsFeature(t,e,n,s,u,f,g,b,S){const A=s_(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),O=this.paint.get("fill-extrusion-height").evaluate(e,n),z=this.paint.get("fill-extrusion-base").evaluate(e,n),V=[0,0],q=b&&f.elevation,X=f.elevation?f.elevation.exaggeration():1,te=t.tile.getBucket(this);if(q&&te instanceof Vh){const De=te.centroidVertexArray,Fe=S+1;Fe<De.length&&(V[0]=De.geta_centroid_pos0(Fe),V[1]=De.geta_centroid_pos1(Fe))}if(0===V[0]&&1===V[1])return!1;"globe"===f.projection.name&&(s=sp([s],[new Se(0,0),new Se(Gn,Gn)],t.tileID.canonical).map(De=>De.polygon).flat());const de=q?b:null,[ye,Ie]=(Fe=s,Le=z,rt=O,Qe=A,yt=g,qt=de,lt=V,St=X,Ct=f.center.lat,"globe"===(De=f).projection.name?function(Xt,gt,mn,Mn,yn,gi,Jt,Vn,_i,er,wi){const Qn=[],jr=[],Ci=Xt.projection.upVectorScale(wi,Xt.center.lat,Xt.worldSize).metersToTile,Di=[0,0,0,1],Tr=[0,0,0,1],Fr=(Cr,ao,To,Uo)=>{Cr[0]=ao,Cr[1]=To,Cr[2]=Uo,Cr[3]=1},Br=D_();mn>0&&(mn+=Br),Mn+=Br;for(const Cr of gt){const ao=[],To=[];for(const Uo of Cr){const Dr=Uo.x+yn.x,is=Uo.y+yn.y,jo=Xt.projection.projectTilePoint(Dr,is,wi),fo=Xt.projection.upVector(wi,Uo.x,Uo.y);let nr=mn,Vo=Mn;if(Jt){const Sr=ap(Dr,is,mn,Mn,Jt,Vn,_i,er);nr+=Sr.base,Vo+=Sr.top}0!==mn?Fr(Di,jo.x+fo[0]*Ci*nr,jo.y+fo[1]*Ci*nr,jo.z+fo[2]*Ci*nr):Fr(Di,jo.x,jo.y,jo.z),Fr(Tr,jo.x+fo[0]*Ci*Vo,jo.y+fo[1]*Ci*Vo,jo.z+fo[2]*Ci*Vo),Eo(Di,Di,gi),Eo(Tr,Tr,gi),ao.push(new $h(Di[0],Di[1],Di[2])),To.push(new $h(Tr[0],Tr[1],Tr[2]))}Qn.push(ao),jr.push(To)}return[Qn,jr]}(De,Fe,Le,rt,Qe,yt,qt,lt,St,Ct,t.tileID.canonical):qt?function(Xt,gt,mn,Mn,yn,gi,Jt,Vn,_i){const er=[],wi=[],Qn=[0,0,0,1];for(const jr of Xt){const Ci=[],Di=[];for(const Tr of jr){const Fr=Tr.x+Mn.x,Br=Tr.y+Mn.y,Cr=ap(Fr,Br,gt,mn,gi,Jt,Vn,_i);Qn[0]=Fr,Qn[1]=Br,Qn[2]=Cr.base,Qn[3]=1,ac(Qn,Qn,yn),Qn[3]=Math.max(Qn[3],1e-5);const ao=new $h(Qn[0]/Qn[3],Qn[1]/Qn[3],Qn[2]/Qn[3]);Qn[0]=Fr,Qn[1]=Br,Qn[2]=Cr.top,Qn[3]=1,ac(Qn,Qn,yn),Qn[3]=Math.max(Qn[3],1e-5);const To=new $h(Qn[0]/Qn[3],Qn[1]/Qn[3],Qn[2]/Qn[3]);Ci.push(ao),Di.push(To)}er.push(Ci),wi.push(Di)}return[er,wi]}(Fe,Le,rt,Qe,yt,qt,lt,St,Ct):function(Xt,gt,mn,Mn,yn){const gi=[],Jt=[],Vn=yn[8]*gt,_i=yn[9]*gt,er=yn[10]*gt,wi=yn[11]*gt,Qn=yn[8]*mn,jr=yn[9]*mn,Ci=yn[10]*mn,Di=yn[11]*mn;for(const Tr of Xt){const Fr=[],Br=[];for(const Cr of Tr){const ao=Cr.x+Mn.x,To=Cr.y+Mn.y,Uo=yn[0]*ao+yn[4]*To+yn[12],Dr=yn[1]*ao+yn[5]*To+yn[13],is=yn[2]*ao+yn[6]*To+yn[14],jo=yn[3]*ao+yn[7]*To+yn[15],fo=Uo+Vn,nr=Dr+_i,Vo=is+er,Sr=Math.max(jo+wi,1e-5),aa=Uo+Qn,Io=Dr+jr,Ds=is+Ci,_s=Math.max(jo+Di,1e-5);Fr.push(new $h(fo/Sr,nr/Sr,Vo/Sr)),Br.push(new $h(aa/_s,Io/_s,Ds/_s))}gi.push(Fr),Jt.push(Br)}return[gi,Jt]}(Fe,Le,rt,Qe,yt)),ve=t.queryGeometry;var De,Fe,Le,rt,Qe,yt,qt,lt,St,Ct;return function(De,Fe,Le){let rt=1/0;Zf(Le,Fe)&&(rt=Vm(Le,Fe[0]));for(let Qe=0;Qe<Fe.length;Qe++){const yt=Fe[Qe],qt=De[Qe];for(let lt=0;lt<yt.length-1;lt++){const St=yt[lt],Ct=[St,yt[lt+1],qt[lt+1],qt[lt],St];xm(Le,Ct)&&(rt=Math.min(rt,Vm(Le,Ct)))}}return rt!==1/0&&rt}(ye,Ie,ve.isPointQuery()?ve.screenBounds:ve.screenGeometry)}},line:class extends wl{constructor(t){super(t,Gm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ir,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=qm.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Gd(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new bc(this,t)}queryRadius(t){const e=t,n=Wm(su("line-width",this,e),su("line-gap-width",this,e)),s=su("line-offset",this,e);return n/2+Math.abs(s)+Ph(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,s,u,f){if(t.queryGeometry.isAboveHorizon)return!1;const g=Md(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),f.angle,t.pixelToTileUnitsFactor),b=t.pixelToTileUnitsFactor/2*Wm(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),S=this.paint.get("line-offset").evaluate(e,n);return S&&(s=function(A,O){const z=[],V=new Se(0,0);for(let q=0;q<A.length;q++){const X=A[q],te=[];for(let de=0;de<X.length;de++){const ye=X[de],Ie=X[de+1],ve=0===de?V:ye.sub(X[de-1])._unit()._perp(),De=de===X.length-1?V:Ie.sub(ye)._unit()._perp(),Fe=ve._add(De)._unit();Fe._mult(1/(Fe.x*De.x+Fe.y*De.y)),te.push(Fe._mult(O)._add(ye))}z.push(te)}return z}(s,S*t.pixelToTileUnitsFactor)),function(A,O,z){for(let V=0;V<O.length;V++){const q=O[V];if(A.length>=3)for(let X=0;X<q.length;X++)if(Mc(A,q[X]))return!0;if(By(A,q,z))return!0}return!1}(g,s,b)}isTileClipped(){return!0}},symbol:nd,background:class extends wl{constructor(t){super(t,xg)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends wl{constructor(t){super(t,X_)}getProgramIds(){return["raster"]}},sky:class extends wl{constructor(t){super(t,wg),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Lh({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),u=!s,f=t.style.light,g=f.properties.get("position");return u&&"viewport"===f.properties.get("anchor")&&hi("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),u?Ip(g.azimuthal,90-g.polar,e):Ip(s[0],90-s[1],e)}const n=this.paint.get("sky-gradient-center");return Ip(n[0],90-n[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}};class gu{constructor(e,n,s,u){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(n,u)}update(e,n,s){const{width:u,height:f}=e,{context:g}=this,{gl:b}=g,{HTMLImageElement:S,HTMLCanvasElement:A,HTMLVideoElement:O,ImageData:z,ImageBitmap:V}=Re;if(b.bindTexture(b.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===b.RGBA&&(!n||!1!==n.premultiply)),s||this.size&&this.size[0]===u&&this.size[1]===f){const{x:q,y:X}=s||{x:0,y:0};e instanceof S||e instanceof A||e instanceof O||e instanceof z||V&&e instanceof V?b.texSubImage2D(b.TEXTURE_2D,0,q,X,b.RGBA,b.UNSIGNED_BYTE,e):b.texSubImage2D(b.TEXTURE_2D,0,q,X,u,f,b.RGBA,b.UNSIGNED_BYTE,e.data)}else this.size=[u,f],e instanceof S||e instanceof A||e instanceof O||e instanceof z||V&&e instanceof V?b.texImage2D(b.TEXTURE_2D,0,this.format,this.format,b.UNSIGNED_BYTE,e):b.texImage2D(b.TEXTURE_2D,0,this.format,u,f,0,this.format,b.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&b.generateMipmap(b.TEXTURE_2D)}bind(e,n){const{context:s}=this,{gl:u}=s;u.bindTexture(u.TEXTURE_2D,this.texture),e!==this.filter&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MAG_FILTER,e),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_MIN_FILTER,this.useMipmap?e===u.NEAREST?u.NEAREST_MIPMAP_NEAREST:u.LINEAR_MIPMAP_NEAREST:e),this.filter=e),n!==this.wrap&&(u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_S,n),u.texParameteri(u.TEXTURE_2D,u.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Pp{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Y_{constructor(){this.tasks={},this.taskQueue=[],ln(["process"],this),this.invoker=new Pp(this.process),this.nextId=0}add(e,n){const s=this.nextId++,u=function({type:f,isSymbolTile:g,zoom:b}){return b=b||0,"message"===f?0:"maybePrepare"!==f||g?"parseTile"!==f||g?"parseTile"===f&&g?300-b:"maybePrepare"===f&&g?400-b:500:200-b:100-b}(n);if(0===u){li();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:n,priority:u,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){li();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let u=0;u<this.taskQueue.length;u++){const f=this.tasks[this.taskQueue[u]];f.priority<n&&(n=f.priority,e=u)}if(null===e)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class id{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const s=e[n];this._stringToNumber[s]=n,this._numberToString[n]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const uf=["tile","layer","source","sourceLayer","state"];class hf{constructor(e,n,s,u,f){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=s,this._y=u,this.properties=e.properties,this.id=f}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const n of uf)void 0!==this[n]&&(e[n]=this[n]);return e}}const hl=32,Xa=33,Sl=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,s=0,u=0,f=0,g=0,b=0;for(1&e?u=f=g=hl:n=s=b=hl;(e>>=1)>1;){const A=n+u>>1,O=s+f>>1;1&e?(u=n,f=s,n=g,s=b):(n=u,s=f,u=g,f=b),g=A,b=O}const S=4*t;Sl[S+0]=n,Sl[S+1]=s,Sl[S+2]=u,Sl[S+3]=f}const dl=new Uint16Array(2178),mc=new Uint8Array(1089),oh=new Uint16Array(1089);function kp(t){return 0===t?-.03125:32===t?.03125:0}var Rp=He([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const df={type:2,extent:Gn,loadGeometry:()=>[[new Se(0,0),new Se(Gn+1,0),new Se(Gn+1,Gn+1),new Se(0,Gn+1),new Se(0,0)]]};class ff{constructor(e,n,s,u,f){this.tileID=e,this.uid=Ot(),this.uses=0,this.tileSize=n,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=f,this.expiredRequestCount=0,this.state="loading",u&&u.transform&&(this.projection=u.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<as.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Lc(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(u,f){const g={};if(!f)return g;for(const b of u){const S=b.layerIds.map(A=>f.getLayer(A)).filter(Boolean);if(0!==S.length){b.layers=S,b.stateDependentLayerIds&&(b.stateDependentLayers=b.stateDependentLayerIds.map(A=>S.filter(O=>O.id===A)[0]));for(const A of S)g[A.id]=b}}return g}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const u in this.buckets){const f=this.buckets[u];if(f instanceof pc){if(this.hasSymbolBuckets=!0,!s)break;f.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const u in this.buckets){const f=this.buckets[u];if(f instanceof pc&&f.hasRTLText){this.hasRTLText=!0,m.isLoading()||m.isLoaded()||"deferred"!==C()||P();break}}this.queryPadding=0;for(const u in this.buckets){const f=this.buckets[u];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(u).queryRadius(f))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new Lr}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const u=this.buckets[s];u.uploadPending()&&u.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new gu(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new gu(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new gu(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,s,u,f,g,b,S){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:u,pixelPosMatrix:b,transform:g,params:f,tileTransform:this.tileTransform},e,n,s):{}}querySourceFeatures(e,n){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const u=s.loadVTLayers(),f=n?n.sourceLayer:"",g=u._geojsonTileLayer||u[f];if(!g)return;const b=ml(n&&n.filter),{z:S,x:A,y:O}=this.tileID.canonical,z={z:S,x:A,y:O};for(let V=0;V<g.length;V++){const q=g.feature(V);if(b.needGeometry){const de=Ac(q,!0);if(!b.filter(new y(this.tileID.overscaledZ),de,this.tileID.canonical))continue}else if(!b.filter(new y(this.tileID.overscaledZ),q))continue;const X=s.getId(q,f),te=new hf(q,S,A,O,X);te.tile=z,e.push(te)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const s=Wi(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let u=!1;if(this.expirationTime>s)u=!1;else if(n)if(this.expirationTime<n)u=!0;else{const f=this.expirationTime-n;f?this.expirationTime=s+Math.max(f,3e4):u=!0}else u=!0;u?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!n)return;const s=this.latestFeatureIndex.loadVTLayers(),u=n.style.listImages();for(const f in this.buckets){if(!n.style.hasLayer(f))continue;const g=this.buckets[f],b=g.layers[0].sourceLayer||"_geojsonTileLayer",S=s[b],A=e[b];if(!S||!A||0===Object.keys(A).length)continue;if(g.update(A,S,u,this.imageAtlas&&this.imageAtlas.patternPositions||{}),g instanceof Gd||g instanceof Bd){const z=n.style._getSourceCache(g.layers[0].source);n._terrain&&n._terrain.enabled&&z&&g.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(z.id,this.tileID)}const O=n&&n.style&&n.style.getLayer(f);O&&(this.queryPadding=Math.max(this.queryPadding,O.queryRadius(g)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<as.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=as.now()+e}setTexture(e,n){const s=n.context,u=s.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new gu(s,e,u.RGBA,{useMipmap:!0}),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE))}setDependencies(e,n){const s={};for(const u of n)s[u]=!0;this.dependencies[e]=s}hasDependency(e,n){for(const s of e){const u=this.dependencies[s];if(u)for(const f of n)if(u[f])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||"mercator"===n.name||this._tileDebugBuffer)return;const s=lc(df,this.tileID.canonical,this.tileTransform)[0],u=new Gt,f=new Ua;for(let g=0;g<s.length;g++){const{x:b,y:S}=s[g];u.emplaceBack(b,S),f.emplaceBack(g)}f.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(f),this._tileDebugBuffer=e.createVertexBuffer(u,Ou.members),this._tileDebugSegments=No.simpleSegment(0,0,u.length,f.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||"mercator"===n.name)return;const s=lc(df,this.tileID.canonical,this.tileTransform)[0];let u,f;if(this.isRaster){const g=function(b,S){const A=Lc(b,S),O=Math.pow(2,b.z);for(let de=0;de<Xa;de++)for(let ye=0;ye<Xa;ye++){const Ie=ll((b.x+(ye+kp(ye))/hl)/O),ve=Ns((b.y+(de+kp(de))/hl)/O),De=S.project(Ie,ve),Fe=de*Xa+ye;dl[2*Fe+0]=Math.round((De.x*A.scale-A.x)*Gn),dl[2*Fe+1]=Math.round((De.y*A.scale-A.y)*Gn)}mc.fill(0),oh.fill(0);for(let de=2045;de>=0;de--){const ye=4*de,Ie=Sl[ye+0],ve=Sl[ye+1],De=Sl[ye+2],Fe=Sl[ye+3],Le=Ie+De>>1,rt=ve+Fe>>1,Qe=Le+rt-ve,yt=rt+Ie-Le,qt=ve*Xa+Ie,lt=Fe*Xa+De,St=rt*Xa+Le,Ct=Math.hypot((dl[2*qt+0]+dl[2*lt+0])/2-dl[2*St+0],(dl[2*qt+1]+dl[2*lt+1])/2-dl[2*St+1])>=16;mc[St]=mc[St]||(Ct?1:0),de<1022&&(mc[St]=mc[St]||mc[(ve+yt>>1)*Xa+(Ie+Qe>>1)]||mc[(Fe+yt>>1)*Xa+(De+Qe>>1)])}const z=new wt,V=new Bn;let q=0;function X(de,ye){const Ie=ye*Xa+de;return 0===oh[Ie]&&(z.emplaceBack(dl[2*Ie+0],dl[2*Ie+1],de*Gn/hl,ye*Gn/hl),oh[Ie]=++q),oh[Ie]-1}function te(de,ye,Ie,ve,De,Fe){const Le=de+Ie>>1,rt=ye+ve>>1;if(Math.abs(de-De)+Math.abs(ye-Fe)>1&&mc[rt*Xa+Le])te(De,Fe,de,ye,Le,rt),te(Ie,ve,De,Fe,Le,rt);else{const Qe=X(de,ye),yt=X(Ie,ve),qt=X(De,Fe);V.emplaceBack(Qe,yt,qt)}}return te(0,0,hl,hl,hl,0),te(hl,hl,0,0,0,hl),{vertices:z,indices:V}}(this.tileID.canonical,n);u=g.vertices,f=g.indices}else{u=new wt,f=new Bn;for(const{x:b,y:S}of s)u.emplaceBack(b,S,0,0);const g=ep(u.int16,void 0,4);for(let b=0;b<g.length;b+=3)f.emplaceBack(g[b],g[b+1],g[b+2])}this._tileBoundsBuffer=e.createVertexBuffer(u,Rp.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(f),this._tileBoundsSegments=No.simpleSegment(0,0,u.length,f.length)}_makeGlobeTileDebugBuffers(e,n){const s=n.projection;if(!s||"globe"!==s.name||n.freezeTileCoverage)return;const u=this.tileID.canonical,f=zu(dm(u,n)),g=Nu(n.zoom);let b;g>0&&(b=yh(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,u,n,f,b,g),this._makeGlobeTileDebugTextBuffer(e,u,n,f,b,g)}_globePoint(e,n,s,u,f,g,b){let S=Dd(e,n,s);if(g){const A=1<<s.z,O=sl(u.center.lng),z=al(u.center.lat),V=(s.x+.5)/A-O;let q=0;V>.5?q=-1:V<-.5&&(q=1);let X=(e/Gn+s.x)/A+q,te=(n/Gn+s.y)/A;X=(X-O)*u._pixelsPerMercatorPixel+O,te=(te-z)*u._pixelsPerMercatorPixel+z;const de=[X*u.worldSize,te*u.worldSize,0];Eo(de,de,g),S=ru(S,de,b)}return Eo(S,S,f)}_makeGlobeTileDebugBorderBuffer(e,n,s,u,f,g){const b=new Gt,S=new Ua,A=new Je,O=(V,q,X,te,de)=>{const ye=(X-V)/(de-1),Ie=(te-q)/(de-1),ve=b.length;for(let De=0;De<de;De++){const Fe=V+De*ye,Le=q+De*Ie;b.emplaceBack(Fe,Le);const rt=this._globePoint(Fe,Le,n,s,u,f,g);A.emplaceBack(rt[0],rt[1],rt[2]),S.emplaceBack(ve+De)}},z=Gn;O(0,0,z,0,16),O(z,0,z,z,16),O(z,z,0,z,16),O(0,z,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(S),this._tileDebugBuffer=e.createVertexBuffer(b,Ou.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(A,Of.members),this._tileDebugSegments=No.simpleSegment(0,0,b.length,S.length)}_makeGlobeTileDebugTextBuffer(e,n,s,u,f,g){const b=Gn/4,S=new Gt,A=new Bn,O=new Je,z=25;A.reserve(32),S.reserve(z),O.reserve(z);const V=(q,X)=>z*q+X;for(let q=0;q<z;q++){const X=q*b;for(let te=0;te<z;te++){const de=te*b;S.emplaceBack(de,X);const ye=this._globePoint(de,X,n,s,u,f,g);O.emplaceBack(ye[0],ye[1],ye[2])}}for(let q=0;q<4;q++)for(let X=0;X<4;X++){const te=V(q,X),de=V(q,X+1),ye=V(q+1,X),Ie=V(q+1,X+1);A.emplaceBack(te,de,ye),A.emplaceBack(ye,de,Ie)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(A),this._tileDebugTextBuffer=e.createVertexBuffer(S,Ou.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(O,Of.members),this._tileDebugTextSegments=No.simpleSegment(0,0,z,32)}}class J_{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,s){const u=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][u]=this.stateChanges[e][u]||{},Dt(this.stateChanges[e][u],s),null===this.deletedStates[e]){this.deletedStates[e]={};for(const f in this.state[e])f!==u&&(this.deletedStates[e][f]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][u]){this.deletedStates[e][u]={};for(const f in this.state[e][u])s[f]||(this.deletedStates[e][u][f]=null)}else for(const f in s)this.deletedStates[e]&&this.deletedStates[e][u]&&null===this.deletedStates[e][u][f]&&delete this.deletedStates[e][u][f]}removeFeatureState(e,n,s){if(null===this.deletedStates[e])return;const u=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&void 0!==n)null!==this.deletedStates[e][u]&&(this.deletedStates[e][u]=this.deletedStates[e][u]||{},this.deletedStates[e][u][s]=null);else if(void 0!==n)if(this.stateChanges[e]&&this.stateChanges[e][u])for(s in this.deletedStates[e][u]={},this.stateChanges[e][u])this.deletedStates[e][u][s]=null;else this.deletedStates[e][u]=null;else this.deletedStates[e]=null}getState(e,n){const s=String(n),u=Dt({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const f=this.deletedStates[e][n];if(null===f)return{};for(const g in f)delete u[g]}return u}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const s={};for(const u in this.stateChanges){this.state[u]=this.state[u]||{};const f={};for(const g in this.stateChanges[u])this.state[u][g]||(this.state[u][g]={}),Dt(this.state[u][g],this.stateChanges[u][g]),f[g]=this.state[u][g];s[u]=f}for(const u in this.deletedStates){this.state[u]=this.state[u]||{};const f={};if(null===this.deletedStates[u])for(const g in this.state[u])f[g]={},this.state[u][g]={};else for(const g in this.deletedStates[u]){if(null===this.deletedStates[u][g])this.state[u][g]={};else if(this.state[u][g])for(const b of Object.keys(this.deletedStates[u][g]))delete this.state[u][g][b];f[g]=this.state[u][g]}s[u]=s[u]||{},Dt(s[u],f)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const u in e)e[u].setFeatureState(s,n)}}class Lp{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const s=this.toIdx(e,n);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function Op(t,e,n,s){let u=0,f=Number.MAX_VALUE;for(let g=0;g<3;g++)if(Math.abs(s[g])<1e-15){if(n[g]<t[g]||n[g]>e[g])return null}else{const b=1/s[g];let S=(t[g]-n[g])*b,A=(e[g]-n[g])*b;if(S>A){const O=S;S=A,A=O}if(S>u&&(u=S),A<f&&(f=A),u>f)return null}return u}function Fp(t,e,n,s,u,f,g,b,S,A,O){const z=s-t,V=u-e,q=f-n,X=g-t,te=b-e,de=S-n,ye=O[1]*de-O[2]*te,Ie=O[2]*X-O[0]*de,ve=O[0]*te-O[1]*X,De=z*ye+V*Ie+q*ve;if(Math.abs(De)<1e-15)return null;const Fe=1/De,Le=A[0]-t,rt=A[1]-e,Qe=A[2]-n,yt=(Le*ye+rt*Ie+Qe*ve)*Fe;if(yt<0||yt>1)return null;const qt=rt*q-Qe*V,lt=Qe*z-Le*q,St=Le*V-rt*z,Ct=(O[0]*qt+O[1]*lt+O[2]*St)*Fe;return Ct<0||yt+Ct>1?null:(X*qt+te*lt+de*St)*Fe}function Bp(t,e,n){return(t-e)/(n-e)}function Eg(t,e,n,s,u,f,g,b,S){const A=1<<n,O=f-s,z=g-u,V=(t+1)/A*O+s,q=(e+0)/A*z+u,X=(e+1)/A*z+u;b[0]=(t+0)/A*O+s,b[1]=q,S[0]=V,S[1]=X}class zp{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(f){const g=Math.ceil(Math.log2(f.dim/8)),b=[];let S=Math.ceil(Math.pow(2,g));const A=1/S,O=(q,X,te,de,ye)=>{const Ie=de?1:0,ve=(q+1)*te-Ie,De=X*te,Fe=(X+1)*te-Ie;ye[0]=q*te,ye[1]=De,ye[2]=ve,ye[3]=Fe};let z=new Lp(S);const V=[];for(let q=0;q<S*S;q++){O(q%S,Math.floor(q/S),A,!1,V);const X=Kl(V[0],V[1],f),te=Kl(V[2],V[1],f),de=Kl(V[2],V[3],f),ye=Kl(V[0],V[3],f);z.minimums.push(Math.min(X,te,de,ye)),z.maximums.push(Math.max(X,te,de,ye)),z.leaves.push(1)}for(b.push(z),S/=2;S>=1;S/=2){const q=b[b.length-1];z=new Lp(S);for(let X=0;X<S*S;X++){O(X%S,Math.floor(X/S),2,!0,V);const te=q.getElevation(V[0],V[1]),de=q.getElevation(V[2],V[1]),ye=q.getElevation(V[2],V[3]),Ie=q.getElevation(V[0],V[3]),ve=q.isLeaf(V[0],V[1]),De=q.isLeaf(V[2],V[1]),Fe=q.isLeaf(V[2],V[3]),Le=q.isLeaf(V[0],V[3]),rt=Math.min(te.min,de.min,ye.min,Ie.min),Qe=Math.max(te.max,de.max,ye.max,Ie.max),yt=ve&&De&&Fe&&Le;z.maximums.push(Qe),z.minimums.push(rt),z.leaves.push(Qe-rt<=5&&yt?1:0)}b.push(z)}return b}(this.dem),s=n.length-1,u=n[s];this._addNode(u.minimums[0],u.maximums[0],u.leaves[0]),this._construct(n,0,0,s,0)}raycastRoot(e,n,s,u,f,g,b=1){return Op([e,n,-100],[s,u,this.maximums[0]*b],f,g)}raycast(e,n,s,u,f,g,b=1){if(!this.nodeCount)return null;const S=this.raycastRoot(e,n,s,u,f,g,b);if(null==S)return null;const A=[],O=[],z=[],V=[],q=[{idx:0,t:S,nodex:0,nodey:0,depth:0}];for(;q.length>0;){const{idx:X,t:te,nodex:de,nodey:ye,depth:Ie}=q.pop();if(this.leaves[X]){Eg(de,ye,Ie,e,n,s,u,z,V);const De=1<<Ie,Fe=(de+0)/De,Le=(de+1)/De,rt=(ye+0)/De,Qe=(ye+1)/De,yt=Kl(Fe,rt,this.dem)*b,qt=Kl(Le,rt,this.dem)*b,lt=Kl(Le,Qe,this.dem)*b,St=Kl(Fe,Qe,this.dem)*b,Ct=Fp(z[0],z[1],yt,V[0],z[1],qt,V[0],V[1],lt,f,g),Bt=Fp(V[0],V[1],lt,z[0],V[1],St,z[0],z[1],yt,f,g),Xt=Math.min(null!==Ct?Ct:Number.MAX_VALUE,null!==Bt?Bt:Number.MAX_VALUE);if(Xt!==Number.MAX_VALUE)return Xt;{const gt=xd([],f,g,te);if(Np(yt,qt,St,lt,Bp(gt[0],z[0],V[0]),Bp(gt[1],z[1],V[1]))>=gt[2])return te}continue}let ve=0;for(let De=0;De<this._siblingOffset.length;De++){Eg((de<<1)+this._siblingOffset[De][0],(ye<<1)+this._siblingOffset[De][1],Ie+1,e,n,s,u,z,V),z[2]=-100,V[2]=this.maximums[this.childOffsets[X]+De]*b;const Fe=Op(z,V,f,g);if(null!=Fe){const Le=Fe;A[De]=Le;let rt=!1;for(let Qe=0;Qe<ve&&!rt;Qe++)Le>=A[O[Qe]]&&(O.splice(Qe,0,De),rt=!0);rt||(O[ve]=De),ve++}}for(let De=0;De<ve;De++){const Fe=O[De];q.push({idx:this.childOffsets[X]+Fe,t:A[Fe],nodex:(de<<1)+this._siblingOffset[Fe][0],nodey:(ye<<1)+this._siblingOffset[Fe][1],depth:Ie+1})}}return null}_addNode(e,n,s){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,s,u,f){if(1===e[u].isLeaf(n,s))return;this.childOffsets[f]||(this.childOffsets[f]=this.nodeCount);const g=u-1,b=e[g];let S=0,A=0;for(let O=0;O<this._siblingOffset.length;O++){const z=2*n+this._siblingOffset[O][0],V=2*s+this._siblingOffset[O][1],q=b.getElevation(z,V),X=b.isLeaf(z,V),te=this._addNode(q.min,q.max,X);X&&(S|=1<<O),A||(A=te)}for(let O=0;O<this._siblingOffset.length;O++)S&1<<O||this._construct(e,2*n+this._siblingOffset[O][0],2*s+this._siblingOffset[O][1],g,A+O)}}function Np(t,e,n,s,u,f){return mi(mi(t,n,f),mi(e,s,f),u)}function Kl(t,e,n){const s=n.dim,u=Mt(t*s-.5,0,s-1),f=Mt(e*s-.5,0,s-1),g=Math.floor(u),b=Math.floor(f),S=Math.min(g+1,s-1),A=Math.min(b+1,s-1);return Np(n.get(g,b),n.get(S,b),n.get(g,A),n.get(S,A),u-g,f-b)}const pf={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Tg(t,e,n){return(256*t*256+256*e+n)/10-1e4}function Cg(t,e,n){return 256*t+e+n/256-32768}class rd{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,s,u=!1,f=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return hi(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const g=this.dim=n.height-2,b=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=s||"mapbox",this.borderReady=u,!u){for(let S=0;S<g;S++)b[this._idx(-1,S)]=b[this._idx(0,S)],b[this._idx(g,S)]=b[this._idx(g-1,S)],b[this._idx(S,-1)]=b[this._idx(S,0)],b[this._idx(S,g)]=b[this._idx(S,g-1)];b[this._idx(-1,-1)]=b[this._idx(0,0)],b[this._idx(g,-1)]=b[this._idx(g-1,0)],b[this._idx(-1,g)]=b[this._idx(0,g-1)],b[this._idx(g,g)]=b[this._idx(g-1,g-1)],f&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new zp(this)}get(e,n,s=!1){s&&(e=Mt(e,-1,this.dim),n=Mt(n,-1,this.dim));const u=4*this._idx(e,n);return("terrarium"===this.encoding?Cg:Tg)(this.pixels[u],this.pixels[u+1],this.pixels[u+2])}static getUnpackVector(e){return pf[e]}get unpackVector(){return pf[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}static pack(e,n){const s=[0,0,0,0],u=rd.getUnpackVector(n);let f=Math.floor((e+u[3])/u[2]);return s[2]=f%256,f=Math.floor(f/256),s[1]=f%256,f=Math.floor(f/256),s[0]=f,s}getPixels(){return new Cs({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let u=n*this.dim,f=n*this.dim+this.dim,g=s*this.dim,b=s*this.dim+this.dim;switch(n){case-1:u=f-1;break;case 1:f=u+1}switch(s){case-1:g=b-1;break;case 1:b=g+1}const S=-n*this.dim,A=-s*this.dim;for(let O=g;O<b;O++)for(let z=u;z<f;z++){const V=4*this._idx(z,O),q=4*this._idx(z+S,O+A);this.pixels[V+0]=e.pixels[q+0],this.pixels[V+1]=e.pixels[q+1],this.pixels[V+2]=e.pixels[q+2],this.pixels[V+3]=e.pixels[q+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}wn(rd,"DEMData"),wn(zp,"DemMinMaxQuadTree",{omit:["dem"]});class Dg{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,s){const u=e.wrapped().key;void 0===this.data[u]&&(this.data[u]=[]);const f={value:n,timeout:void 0};if(void 0!==s&&(f.timeout=setTimeout(()=>{this.remove(e,f)},s)),this.data[u].push(f),this.order.push(u),this.order.length>this.max){const g=this._getAndRemoveByKey(this.order[0]);g&&this.onRemove(g)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const s=e.wrapped().key,u=void 0===n?0:this.data[s].indexOf(n),f=this.data[s][u];return this.data[s].splice(u,1),f.timeout&&clearTimeout(f.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(f.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const s in this.data)for(const u of this.data[s])e(u.value)||n.push(u);for(const s of n)this.remove(s.value.tileID,s)}}class _u{constructor(e,n,s){this.func=e,this.mask=n,this.range=s}}_u.ReadOnly=!1,_u.ReadWrite=!0,_u.disabled=new _u(519,_u.ReadOnly,[0,1]);class gf{constructor(e,n,s,u,f,g){this.test=e,this.ref=n,this.mask=s,this.fail=u,this.depthFail=f,this.pass=g}}gf.disabled=new gf({func:519,mask:0},0,0,7680,7680,7680);class Al{constructor(e,n,s){this.blendFunction=e,this.blendColor=n,this.mask=s}}Al.Replace=[1,0],Al.disabled=new Al(Al.Replace,ri.transparent,[!1,!1,!1,!1]),Al.unblended=new Al(Al.Replace,ri.transparent,[!0,!0,!0,!0]),Al.alphaBlended=new Al([1,771],ri.transparent,[!0,!0,!0,!0]);class Ml{constructor(e,n,s){this.enable=e,this.mode=n,this.frontFace=s}}Ml.disabled=new Ml(!1,1029,2305),Ml.backCCW=new Ml(!0,1029,2305),Ml.backCW=new Ml(!0,1029,2304),Ml.frontCW=new Ml(!0,1028,2304),Ml.frontCCW=new Ml(!0,1028,2305);class yu extends $s{constructor(e,n,s){super(),this.id=e,this._onlySymbols=s,n.on("data",u=>{"source"===u.dataType&&"metadata"===u.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===u.dataType&&"content"===u.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new Dg(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new J_,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if("loaded"!==n.state&&"errored"!==n.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const s=this._tiles[n];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return bt(this._tiles).map(e=>e.tileID).sort(_f).map(e=>e.key)}getRenderableIds(e){const n=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&n.push(this._tiles[s]);return e?n.sort((s,u)=>{const f=s.tileID,g=u.tileID,b=new Se(f.canonical.x,f.canonical.y)._rotate(this.transform.angle),S=new Se(g.canonical.x,g.canonical.y)._rotate(this.transform.angle);return f.overscaledZ-g.overscaledZ||S.y-b.y||S.x-b.x}).map(s=>s.tileID.key):n.map(s=>s.tileID).sort(_f).map(s=>s.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const s=this._tiles[e];s&&("loading"!==s.state&&(s.state=n),this._loadTile(s,this._tileLoaded.bind(this,s,e,n)))}_tileLoaded(e,n,s,u){if(u)if(e.state="errored",404!==u.status)this._source.fire(new go(u,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const f=this.map.painter.terrain;this.update(this.transform,f.getScaledDemTileSize(),!0),f.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=as.now(),"expired"===s&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new qo("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let u=0;u<n.length;u++){const f=n[u];if(e.neighboringTiles&&e.neighboringTiles[f]){const g=this.getTileByID(f);s(e,g),s(g,e)}}function s(u,f){if(!u.dem||u.dem.borderReady)return;u.needsHillshadePrepare=!0,u.needsDEMTextureUpload=!0;let g=f.tileID.canonical.x-u.tileID.canonical.x;const b=f.tileID.canonical.y-u.tileID.canonical.y,S=Math.pow(2,u.tileID.canonical.z),A=f.tileID.key;0===g&&0===b||Math.abs(b)>1||(Math.abs(g)>1&&(1===Math.abs(g+S)?g+=S:1===Math.abs(g-S)&&(g-=S)),f.dem&&u.dem&&(u.dem.backfillBorder(f.dem,g,b),u.neighboringTiles&&u.neighboringTiles[A]&&(u.neighboringTiles[A].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,s,u){for(const f in this._tiles){let g=this._tiles[f];if(u[f]||!g.hasData()||g.tileID.overscaledZ<=n||g.tileID.overscaledZ>s)continue;let b=g.tileID;for(;g&&g.tileID.overscaledZ>n+1;){const A=g.tileID.scaledTo(g.tileID.overscaledZ-1);g=this._tiles[A.key],g&&g.hasData()&&(b=A)}let S=b;for(;S.overscaledZ>n;)if(S=S.scaledTo(S.overscaledZ-1),e[S.key]){u[b.key]=b;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=n?s:null}for(let s=e.overscaledZ-1;s>=n;s--){const u=e.scaledTo(s),f=this._getLoadedTile(u);if(f)return f}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const s=Math.ceil(e.width/n)+1,u=Math.ceil(e.height/n)+1,f=Math.floor(s*u*5),g="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,f):f,b="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,g):g;this._cache.setMaxSize(b)}handleWrapJump(e){const n=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,n){const s={};for(const u in this._tiles){const f=this._tiles[u];f.tileID=f.tileID.unwrapTo(f.tileID.wrap+n),s[f.tileID.key]=f}this._tiles=s;for(const u in this._timers)clearTimeout(this._timers[u]),delete this._timers[u];for(const u in this._tiles)this._setTileReloadTimer(+u,this._tiles[u])}}update(e,n,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let u;this.updateCacheSize(e,n),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?u=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(b=>new ba(b.canonical.z,b.wrap,b.canonical.z,b.canonical.x,b.canonical.y)):(u=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(u=u.filter(b=>this._source.hasTile(b)))):u=[];const f=this._updateRetainedTiles(u);if(Nc(this._source.type)&&0!==u.length){const b={},S={},A=Object.keys(f);for(const z of A){const V=f[z],q=this._tiles[z];if(!q||q.fadeEndTime&&q.fadeEndTime<=as.now())continue;const X=this.findLoadedParent(V,Math.max(V.overscaledZ-yu.maxOverzooming,this._source.minzoom));X&&(this._addTile(X.tileID),b[X.tileID.key]=X.tileID),S[z]=V}const O=u[u.length-1].overscaledZ;for(const z in this._tiles){const V=this._tiles[z];if(f[z]||!V.hasData())continue;let q=V.tileID;for(;q.overscaledZ>O;){q=q.scaledTo(q.overscaledZ-1);const X=this._tiles[q.key];if(X&&X.hasData()&&S[q.key]){f[z]=V.tileID;break}}}for(const z in b)f[z]||(this._coveredTiles[z]=!0,f[z]=b[z])}for(const b in f)this._tiles[b].clearFadeHold();const g=function(b,S){const A=[];for(const O in b)O in S||A.push(O);return A}(this._tiles,f);for(const b of g){const S=this._tiles[b];S.hasSymbolBuckets&&!S.holdingForFade()?S.setHoldDuration(this.map._fadeDuration):S.hasSymbolBuckets&&!S.symbolFadeFinished()||this._removeTile(+b)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(0===e.length)return n;const s={},u=e.reduce((A,O)=>Math.min(A,O.overscaledZ),1/0),f=e[0].overscaledZ,g=Math.max(f-yu.maxOverzooming,this._source.minzoom),b=Math.max(f+yu.maxUnderzooming,this._source.minzoom),S={};for(const A of e){const O=this._addTile(A);n[A.key]=A,O.hasData()||u<this._source.maxzoom&&(S[A.key]=A)}this._retainLoadedChildren(S,u,b,n);for(const A of e){let O=this._tiles[A.key];if(O.hasData())continue;if(A.canonical.z>=this._source.maxzoom){const V=A.children(this._source.maxzoom)[0],q=this.getTile(V);if(q&&q.hasData()){n[V.key]=V;continue}}else{const V=A.children(this._source.maxzoom);if(n[V[0].key]&&n[V[1].key]&&n[V[2].key]&&n[V[3].key])continue}let z=O.wasRequested();for(let V=A.overscaledZ-1;V>=g;--V){const q=A.scaledTo(V);if(s[q.key]||(s[q.key]=!0,O=this.getTile(q),!O&&z&&(O=this._addTile(q)),O&&(n[q.key]=q,z=O.wasRequested(),O.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let s,u=this._tiles[e].tileID;for(;u.overscaledZ>0;){if(u.key in this._loadedParentTiles){s=this._loadedParentTiles[u.key];break}n.push(u.key);const f=u.scaledTo(u.overscaledZ-1);if(s=this._getLoadedTile(f),s)break;u=f}for(const f of n)this._loadedParentTiles[f]=s}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const s=Boolean(n);if(!s){const u=this.map?this.map.painter:null;n=new ff(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,u,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,s||this._source.fire(new qo("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=n.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&"reloading"!==n.state?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,s){const u=[],f=this.transform;if(!f)return u;const g="globe"===f.projection.name,b=sl(f.center.lng);for(const S in this._tiles){const A=this._tiles[S];if(s&&A.clearQueryDebugViz(),A.holdingForFade())continue;let O;if(g){const z=A.tileID.canonical;if(0===z.z){const V=[Math.abs(Mt(b,...vu(z,-1))-b),Math.abs(Mt(b,...vu(z,1))-b)];O=[0,2*V.indexOf(Math.min(...V))-1]}else{const V=[Math.abs(Mt(b,...vu(z,-1))-b),Math.abs(Mt(b,...vu(z,0))-b),Math.abs(Mt(b,...vu(z,1))-b)];O=[V.indexOf(Math.min(...V))-1]}}else O=[0];for(const z of O){const V=e.containsTile(A,f,n,z);V&&u.push(V)}}return u}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of n)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(Nc(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=as.now())return!0}return!1}setFeatureState(e,n,s){this._state.updateState(e=e||"_geojsonTileLayer",n,s)}removeFeatureState(e,n,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,s)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,s){const u=this._tiles[e];u&&u.setDependencies(n,s)}reloadTilesForDependencies(e,n){for(const s in this._tiles)this._tiles[s].hasDependency(e,n)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,n))}_preloadTiles(e,n){if(!this._sourceLoaded){const b=()=>{this._sourceLoaded&&(this._source.off("data",b),this._preloadTiles(e,n))};return void this._source.on("data",b)}const s=new Map,u=Array.isArray(e)?e:[e],f=this.map.painter.terrain,g=this.usedForTerrain&&f?f.getScaledDemTileSize():this._source.tileSize;for(const b of u){const S=b.coveringTiles({tileSize:g,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const A of S)s.set(A.key,A);this.usedForTerrain&&b.updateElevation(!1)}at(Array.from(s.values()),(b,S)=>{const A=new ff(b,this._source.tileSize*b.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(A,O=>{"raster-dem"===this._source.type&&A.dem&&this._backfillDEM(A),S(O,A)})},n)}}function _f(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||s-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Nc(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function vu(t,e){const n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}yu.maxOverzooming=10,yu.maxUnderzooming=3;class yf{constructor(e,n,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=s}static create(e,n,s){const u=s||e.findDEMTileFor(n);if(!u||!u.dem)return;const f=u.dem,g=u.tileID,b=1<<n.canonical.z-g.canonical.z;return new yf(u,u.tileSize/Gn/b,[(n.canonical.x/b-g.canonical.x)*f.dim,(n.canonical.y/b-g.canonical.y)*f.dim])}tileCoordToPixel(e,n){const s=n*this._scale+this._offset[1],u=Math.floor(e*this._scale+this._offset[0]),f=Math.floor(s);return new Se(u,f)}getElevationAt(e,n,s,u){const f=e*this._scale+this._offset[0],g=n*this._scale+this._offset[1],b=Math.floor(f),S=Math.floor(g),A=this._dem;return u=!!u,s?mi(mi(A.get(b,S,u),A.get(b,S+1,u),g-S),mi(A.get(b+1,S,u),A.get(b+1,S+1,u),g-S),f-b):A.get(b,S,u)}getElevationAtPixel(e,n,s){return this._dem.get(e,n,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*ql(1,e)*this._dem.stride}}class vf{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new yl(Gn,16,0),this.featureIndexArray=new Yc,this.promoteId=n}insert(e,n,s,u,f,g=0){const b=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,u,f,g);const S=this.grid;for(let A=0;A<n.length;A++){const O=n[A],z=[1/0,1/0,-1/0,-1/0];for(let V=0;V<O.length;V++){const q=O[V];z[0]=Math.min(z[0],q.x),z[1]=Math.min(z[1],q.y),z[2]=Math.max(z[2],q.x),z[3]=Math.max(z[3],q.y)}z[0]<Gn&&z[1]<Gn&&z[2]>=0&&z[3]>=0&&S.insert(b,z[0],z[1],z[2],z[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new zd(new Xd(this.rawTileData)).layers,this.sourceLayerCoder=new id(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,s,u){this.loadVTLayers();const f=e.params||{},g=ml(f.filter),b=e.tileResult,S=e.transform,A=b.bufferedTilespaceBounds,O=this.grid.query(A.min.x,A.min.y,A.max.x,A.max.y,(X,te,de,ye)=>bm(b.bufferedTilespaceGeometry,X,te,de,ye));O.sort(qy);let z=null;S.elevation&&O.length>0&&(z=yf.create(S.elevation,this.tileID));const V={};let q;for(let X=0;X<O.length;X++){const te=O[X];if(te===q)continue;q=te;const de=this.featureIndexArray.get(te);let ye=null;this.loadMatchingFeature(V,de,g,f.layers,f.availableImages,n,s,u,(Ie,ve,De,Fe=0)=>(ye||(ye=lc(Ie,this.tileID.canonical,e.tileTransform)),ve.queryIntersectsFeature(b,Ie,De,ye,this.z,e.transform,e.pixelPosMatrix,z,Fe)))}return V}loadMatchingFeature(e,n,s,u,f,g,b,S,A){const{featureIndex:O,bucketIndex:z,sourceLayerIndex:V,layoutVertexArrayOffset:q}=n,X=this.bucketLayerIDs[z];if(u&&!function(Ie,ve){for(let De=0;De<Ie.length;De++)if(ve.indexOf(Ie[De])>=0)return!0;return!1}(u,X))return;const te=this.sourceLayerCoder.decode(V),de=this.vtLayers[te].feature(O);if(s.needGeometry){const Ie=Ac(de,!0);if(!s.filter(new y(this.tileID.overscaledZ),Ie,this.tileID.canonical))return}else if(!s.filter(new y(this.tileID.overscaledZ),de))return;const ye=this.getId(de,te);for(let Ie=0;Ie<X.length;Ie++){const ve=X[Ie];if(u&&u.indexOf(ve)<0)continue;const De=g[ve];if(!De)continue;let Fe={};void 0!==ye&&S&&(Fe=S.getState(De.sourceLayer||"_geojsonTileLayer",ye));const Le=Dt({},b[ve]);Le.paint=Q_(Le.paint,De.paint,de,Fe,f),Le.layout=Q_(Le.layout,De.layout,de,Fe,f);const rt=!A||A(de,De,Fe,q);if(!rt)continue;const Qe=new hf(de,this.z,this.x,this.y,ye);Qe.layer=Le;let yt=e[ve];void 0===yt&&(yt=e[ve]=[]),yt.push({featureIndex:O,feature:Qe,intersectionZ:rt})}}lookupSymbolFeatures(e,n,s,u,f,g,b,S){const A={};this.loadVTLayers();const O=ml(f);for(const z of e)this.loadMatchingFeature(A,{bucketIndex:s,sourceLayerIndex:u,featureIndex:z,layoutVertexArrayOffset:0},O,g,b,S,n);return A}loadFeature(e){const{featureIndex:n,sourceLayerIndex:s}=e;this.loadVTLayers();const u=this.sourceLayerCoder.decode(s),f=this.vtFeatures[u];if(f[n])return f[n];const g=this.vtLayers[u].feature(n);return f[n]=g,g}hasLayer(e){for(const n of this.bucketLayerIDs)for(const s of n)if(e===s)return!0;return!1}getId(e,n){let s=e.id;if(this.promoteId){const u="string"==typeof this.promoteId?this.promoteId:this.promoteId[n];null!=u&&(s=e.properties[u]),"boolean"==typeof s&&(s=Number(s))}return s}}function Q_(t,e,n,s,u){return un(t,(f,g)=>{const b=e instanceof le?e.get(g):null;return b&&b.evaluate?b.evaluate(n,s,u):b})}function qy(t,e){return e-t}wn(vf,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Sg{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new cl({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const s=this.getKey(e,n);return this.positions[s]}trim(){const e=this.width,n=this.height=ei(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,s){const u=[];let f=e.length%2==1?-e[e.length-1]*s:0,g=e[0]*s,b=!0;u.push({left:f,right:g,isDash:b,zeroLength:0===e[0]});let S=e[0];for(let A=1;A<e.length;A++){b=!b;const O=e[A];f=S*s,S+=O,g=S*s,u.push({left:f,right:g,isDash:b,zeroLength:0===O})}return u}addRoundDash(e,n,s){const u=n/2;for(let f=-s;f<=s;f++){const g=this.width*(this.nextRow+s+f);let b=0,S=e[b];for(let A=0;A<this.width;A++){A/S.right>1&&(S=e[++b]);const O=Math.abs(A-S.left),z=Math.abs(A-S.right),V=Math.min(O,z);let q;const X=f/s*(u+1);if(S.isDash){const te=u-Math.abs(X);q=Math.sqrt(V*V+te*te)}else q=u-Math.sqrt(V*V+X*X);this.image.data[g+A]=Math.max(0,Math.min(255,q+128))}}}addRegularDash(e,n){for(let S=e.length-1;S>=0;--S){const A=e[S],O=e[S+1];A.zeroLength?e.splice(S,1):O&&O.isDash===A.isDash&&(O.left=A.left,e.splice(S,1))}const s=e[0],u=e[e.length-1];s.isDash===u.isDash&&(s.left=u.left-this.width,u.right=s.right+this.width);const f=this.width*this.nextRow;let g=0,b=e[g];for(let S=0;S<this.width;S++){S/b.right>1&&(b=e[++g]);const A=Math.abs(S-b.left),O=Math.abs(S-b.right),z=Math.min(A,O);this.image.data[f+S]=Math.max(0,Math.min(255,(b.isDash?z:-z)+n+128))}}addDash(e,n){const s=this.getKey(e,n);if(this.positions[s])return this.positions[s];const u="round"===n,f=u?7:0,g=2*f+1;if(this.nextRow+g>this.height)return hi("LineAtlas out of space"),null;0===e.length&&e.push(1);let b=0;for(let O=0;O<e.length;O++)e[O]<0&&(hi("Negative value is found in line dasharray, replacing values with 0"),e[O]=0),b+=e[O];if(0!==b){const O=this.width/b,z=this.getDashRanges(e,this.width,O);u?this.addRoundDash(z,O,f):this.addRegularDash(z,"square"===n?.5*O:0)}const S=this.nextRow+f;this.nextRow+=g;const A={tl:[S,f],br:[b,0]};return this.positions[s]=A,A}}wn(Sg,"LineAtlas");const Ag=1*Us;class Up{constructor(e){const n={},s=[];for(const b in e){const S=e[b],A=n[b]={};for(const O in S.glyphs){const z=S.glyphs[+O];if(!z||0===z.bitmap.width||0===z.bitmap.height)continue;const V=z.metrics.localGlyph?Ag:1,q={x:0,y:0,w:z.bitmap.width+2*V,h:z.bitmap.height+2*V};s.push(q),A[O]=q}}const{w:u,h:f}=mp(s),g=new cl({width:u||1,height:f||1});for(const b in e){const S=e[b];for(const A in S.glyphs){const O=S.glyphs[+A];if(!O||0===O.bitmap.width||0===O.bitmap.height)continue;const z=n[b][A],V=O.metrics.localGlyph?Ag:1;cl.copy(O.bitmap,g,{x:0,y:0},{x:z.x+V,y:z.y+V},O.bitmap)}}this.image=g,this.positions=n}}wn(Up,"GlyphAtlas");class ey{constructor(e){this.tileID=new ba(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=Lc(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,n,s,u,f){this.status="parsing",this.data=e,this.collisionBoxArray=new Lr;const g=new id(Object.keys(e.layers).sort()),b=new vf(this.tileID,this.promoteId);b.bucketLayerIDs=[];const S={},A=new Sg(256,256),O={featureIndex:b,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:A,availableImages:s},z=n.familiesBySource[this.source];for(const Fe in z){const Le=e.layers[Fe];if(!Le)continue;let rt=!1,Qe=!1;for(const lt of z[Fe])"symbol"===lt[0].type?rt=!0:Qe=!0;if(!0===this.isSymbolTile&&!rt||!1===this.isSymbolTile&&!Qe)continue;1===Le.version&&hi(`Vector tile source "${this.source}" layer "${Fe}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const yt=g.encode(Fe),qt=[];for(let lt=0;lt<Le.length;lt++){const St=Le.feature(lt),Ct=b.getId(St,Fe);qt.push({feature:St,id:Ct,index:lt,sourceLayerIndex:yt})}for(const lt of z[Fe]){const St=lt[0];void 0!==this.isSymbolTile&&"symbol"===St.type!==this.isSymbolTile||St.minzoom&&this.zoom<Math.floor(St.minzoom)||St.maxzoom&&this.zoom>=St.maxzoom||"none"!==St.visibility&&(gs(lt,this.zoom,s),(S[St.id]=St.createBucket({index:b.bucketLayerIDs.length,layers:lt,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:yt,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(qt,O,this.tileID.canonical,this.tileTransform),b.bucketLayerIDs.push(lt.map(Ct=>Ct.id)))}}let V,q,X,te;A.trim();const de={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ye=()=>{if(V)return f(V);if(q&&X&&te){const Fe=new Up(q),Le=new og(X,te);for(const rt in S){const Qe=S[rt];Qe instanceof pc?(gs(Qe.layers,this.zoom,s),fg(Qe,q,Fe.positions,X,Le.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):Qe.hasPattern&&(Qe instanceof Gd||Qe instanceof Bd||Qe instanceof Vh)&&(gs(Qe.layers,this.zoom,s),Qe.addFeatures(O,this.tileID.canonical,Le.patternPositions,s,this.tileTransform))}this.status="done",f(null,{buckets:bt(S).filter(rt=>!rt.isEmpty()),featureIndex:b,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Fe.image,lineAtlas:A,imageAtlas:Le,glyphMap:this.returnDependencies?q:null,iconMap:this.returnDependencies?X:null,glyphPositions:this.returnDependencies?Fe.positions:null})}},Ie=un(O.glyphDependencies,Fe=>Object.keys(Fe).map(Number));Object.keys(Ie).length?u.send("getGlyphs",{uid:this.uid,stacks:Ie},(Fe,Le)=>{V||(V=Fe,q=Le,ye())},void 0,!1,de):q={};const ve=Object.keys(O.iconDependencies);ve.length?u.send("getImages",{icons:ve,source:this.source,tileID:this.tileID,type:"icons"},(Fe,Le)=>{V||(V=Fe,X=Le,ye())},void 0,!1,de):X={};const De=Object.keys(O.patternDependencies);De.length?u.send("getImages",{icons:De,source:this.source,tileID:this.tileID,type:"patterns"},(Fe,Le)=>{V||(V=Fe,te=Le,ye())},void 0,!1,de):te={},ye()}}function gs(t,e,n){const s=new y(e);for(const u of t)u.recalculate(s,n)}class jp{constructor(e){this.entries={},this.scheduler=e}request(e,n,s,u){const f=this.entries[e]=this.entries[e]||{callbacks:[]};if(f.result){const[g,b]=f.result;return this.scheduler?this.scheduler.add(()=>{u(g,b)},n):u(g,b),()=>{}}return f.callbacks.push(u),f.cancel||(f.cancel=s((g,b)=>{f.result=[g,b];for(const S of f.callbacks)this.scheduler?this.scheduler.add(()=>{S(g,b)},n):S(g,b);setTimeout(()=>delete this.entries[e],3e3)})),()=>{f.result||(f.callbacks=f.callbacks.filter(g=>g!==u),f.callbacks.length||(f.cancel(),delete this.entries[e]))}}}function Mg(t,e,n){const s=JSON.stringify(t.request);return t.data&&(this.deduped.entries[s]={result:[null,t.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},u=>{const f=cr(t.request,(g,b,S,A)=>{g?u(g):b&&u(null,{vectorTile:n?void 0:new zd(new Xd(b)),rawData:b,cacheControl:S,expires:A})});return()=>{f.cancel(),u()}},e)}const Ig=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class xf{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[n,s]=new Uint8Array(e,0,2);if(219!==n)throw new Error("Data does not appear to be in a KDBush format.");const u=s>>4;if(1!==u)throw new Error(`Got v${u} data when expected v1.`);const f=Ig[15&s];if(!f)throw new Error("Unrecognized array type.");const[g]=new Uint16Array(e,2,1),[b]=new Uint32Array(e,4,1);return new xf(b,g,f,e)}constructor(e,n=64,s=Float64Array,u){if(isNaN(e)||e<0)throw new Error(`Unpexpected numItems value: ${e}.`);this.numItems=+e,this.nodeSize=Math.min(Math.max(+n,2),65535),this.ArrayType=s,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const f=Ig.indexOf(this.ArrayType),g=2*e*this.ArrayType.BYTES_PER_ELEMENT,b=e*this.IndexArrayType.BYTES_PER_ELEMENT,S=(8-b%8)%8;if(f<0)throw new Error(`Unexpected typed array class: ${s}.`);u&&u instanceof ArrayBuffer?(this.data=u,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+S,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+g+b+S),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+b+S,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+f]),new Uint16Array(this.data,2,1)[0]=n,new Uint32Array(this.data,4,1)[0]=e)}add(e,n){const s=this._pos>>1;return this.ids[s]=s,this.coords[this._pos++]=e,this.coords[this._pos++]=n,s}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error(`Added ${e} items when expected ${this.numItems}.`);return Vp(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,n,s,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:f,coords:g,nodeSize:b}=this,S=[0,f.length-1,0],A=[];for(;S.length;){const O=S.pop()||0,z=S.pop()||0,V=S.pop()||0;if(z-V<=b){for(let de=V;de<=z;de++){const ye=g[2*de],Ie=g[2*de+1];ye>=e&&ye<=s&&Ie>=n&&Ie<=u&&A.push(f[de])}continue}const q=V+z>>1,X=g[2*q],te=g[2*q+1];X>=e&&X<=s&&te>=n&&te<=u&&A.push(f[q]),(0===O?e<=X:n<=te)&&(S.push(V),S.push(q-1),S.push(1-O)),(0===O?s>=X:u>=te)&&(S.push(q+1),S.push(z),S.push(1-O))}return A}within(e,n,s){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:u,coords:f,nodeSize:g}=this,b=[0,u.length-1,0],S=[],A=s*s;for(;b.length;){const O=b.pop()||0,z=b.pop()||0,V=b.pop()||0;if(z-V<=g){for(let de=V;de<=z;de++)Pg(f[2*de],f[2*de+1],e,n)<=A&&S.push(u[de]);continue}const q=V+z>>1,X=f[2*q],te=f[2*q+1];Pg(X,te,e,n)<=A&&S.push(u[q]),(0===O?e-s<=X:n-s<=te)&&(b.push(V),b.push(q-1),b.push(1-O)),(0===O?e+s>=X:n+s>=te)&&(b.push(q+1),b.push(z),b.push(1-O))}return S}}function Vp(t,e,n,s,u,f){if(u-s<=n)return;const g=s+u>>1;$p(t,e,g,s,u,f),Vp(t,e,n,s,g-1,1-f),Vp(t,e,n,g+1,u,1-f)}function $p(t,e,n,s,u,f){for(;u>s;){if(u-s>600){const A=u-s+1,O=n-s+1,z=Math.log(A),V=.5*Math.exp(2*z/3),q=.5*Math.sqrt(z*V*(A-V)/A)*(O-A/2<0?-1:1);$p(t,e,n,Math.max(s,Math.floor(n-O*V/A+q)),Math.min(u,Math.floor(n+(A-O)*V/A+q)),f)}const g=e[2*n+f];let b=s,S=u;for(ah(t,e,s,n),e[2*u+f]>g&&ah(t,e,s,u);b<S;){for(ah(t,e,b,S),b++,S--;e[2*b+f]<g;)b++;for(;e[2*S+f]>g;)S--}e[2*s+f]===g?ah(t,e,s,S):(S++,ah(t,e,S,u)),S<=n&&(s=S+1),n<=S&&(u=S-1)}}function ah(t,e,n,s){Uc(t,n,s),Uc(e,2*n,2*s),Uc(e,2*n+1,2*s+1)}function Uc(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}function Pg(t,e,n,s){const u=t-n,f=e-s;return u*u+f*f}c.ARRAY_TYPE=Bs,c.AUTH_ERR_MSG=Me,c.Aabb=wa,c.Actor=class{constructor(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},ln(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=li()?t:Re,this.scheduler=new Y_}send(t,e,n,s,u=!1,f){const g=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=f,this.callbacks[g]=n);const b=Wt(this.globalScope)?void 0:[];return this.target.postMessage({id:g,type:t,hasCallback:!!n,targetMapId:s,mustQueue:u,sourceMapId:this.mapId,data:ar(e,b)},b),{cancel:()=>{n&&delete this.callbacks[g],this.target.postMessage({id:g,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(t){const e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const s=this.cancelCallbacks[n];delete this.cancelCallbacks[n],s&&s.cancel()}else if(e.mustQueue||li()){const s=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),s&&s.metadata||{type:"message"})}else this.processTask(n,e)}processTask(t,e){if("<response>"===e.type){const n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(Fl(e.error)):n(null,Fl(e.data)))}else{const n=Wt(this.globalScope)?void 0:[],s=e.hasCallback?(f,g)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:f?ar(f):null,data:ar(g,n)},n)}:f=>{},u=Fl(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,u,s);else if(this.parent.getWorkerSource){const f=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,f[0],u.source)[f[1]](u,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},c.CanonicalTileID=qu,c.Color=ri,c.ColorMode=Al,c.CullFaceMode=Ml,c.DEMData=rd,c.DataConstantProperty=Z,c.DedupedRequest=jp,c.DepthMode=_u,c.EXTENT=Gn,c.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const n=e.getSource().maxzoom,s=1<<n,u=Math.floor(t.x),f=Math.floor((t.x-u)*s),g=Math.floor(t.y*s),b=this.findDEMTileFor(new ba(n,u,n,f,g));return!(!b||!b.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const s=this._source();if(!s||t.y<0||t.y>1)return e;const u=s.getSource().maxzoom,f=1<<u,g=Math.floor(t.x),b=t.x-g,S=new ba(u,g,u,Math.floor(b*f),Math.floor(t.y*f)),A=this.findDEMTileFor(S);if(!A||!A.dem)return e;const O=A.dem,z=1<<A.tileID.canonical.z,V=(b*z-A.tileID.canonical.x)*O.dim,q=(t.y*z-A.tileID.canonical.y)*O.dim,X=Math.floor(V),te=Math.floor(q);return(n?this.exaggeration():1)*mi(mi(O.get(X,te),O.get(X,te+1),q-te),mi(O.get(X+1,te),O.get(X+1,te+1),q-te),V-X)}getAtTileOffset(t,e,n){const s=1<<t.canonical.z;return this.getAtPointOrZero(new ju(t.wrap+(t.canonical.x+e/Gn)/s,(t.canonical.y+n/Gn)/s))}getAtTileOffsetFunc(t,e,n,s){return u=>{const f=this.getAtTileOffset(t,u.x,u.y),g=s.upVector(t.canonical,u.x,u.y);return Wa(g,g,f*s.upVectorScale(t.canonical,e,n).metersToTile),g}}getForTilePoints(t,e,n,s){if(this.isUsingMockSource())return!1;const u=yf.create(this,t,s);return!!u&&(e.forEach(f=>{f[2]=this.exaggeration()*u.getElevationAt(f[0],f[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const n=e.dem.tree,s=e.tileID,u=1<<t.canonical.z-s.canonical.z;let f=t.canonical.x/u-s.canonical.x,g=t.canonical.y/u-s.canonical.y,b=0;for(let S=0;S<t.canonical.z-s.canonical.z&&!n.leaves[b];S++){f*=2,g*=2;const A=2*Math.floor(g)+Math.floor(f);b=n.childOffsets[b]+A,f%=1,g%=1}return{min:this.exaggeration()*n.minimums[b],max:this.exaggeration()*n.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},c.ErrorEvent=go,c.EvaluationParameters=y,c.Event=qo,c.Evented=$s,c.FillExtrusionBucket=Vh,c.Frustum=Cc,c.FrustumCorners=wh,c.GLOBE_RADIUS=$l,c.GLOBE_SCALE_MATCH_LATITUDE=45,c.GLOBE_ZOOM_THRESHOLD_MAX=t_,c.GLOBE_ZOOM_THRESHOLD_MIN=Ff,c.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_fillGridMeshWithLods(t,e){const n=new Gt,s=new Bn,u=[],f=t+1+2,g=e[0]+1,b=e[0]+1+(1+e.length),S=(A,O,z)=>{let V=A===f-1?A-2:0===A?A:A-1;return V+=z?24575:0,[V,O]};for(let A=0;A<f;++A)n.emplaceBack(...S(A,0,!0));for(let A=0;A<g;++A)for(let O=0;O<f;++O)n.emplaceBack(...S(O,A,(0===O||O===f-1)&&!0));for(let A=0;A<e.length;++A){const O=e[A];for(let z=0;z<f;++z)n.emplaceBack(...S(z,O,!0))}for(let A=0;A<e.length;++A){const O=s.length,z=e[A]+1+2,V=new Bn;for(let te=0;te<z-1;te++){const de=te===z-2,ye=de?f*(b-e.length+A-te):f;for(let Ie=0;Ie<f-1;Ie++){const ve=te*f+Ie;0===te||de||0===Ie||Ie===f-2?(V.emplaceBack(ve+1,ve,ve+ye),V.emplaceBack(ve+ye,ve+ye+1,ve+1)):(s.emplaceBack(ve+1,ve,ve+ye),s.emplaceBack(ve+ye,ve+ye+1,ve+1))}}const q=No.simpleSegment(0,O,n.length,s.length-O);for(let te=0;te<V.uint16.length;te+=3)s.emplaceBack(V.uint16[te],V.uint16[te+1],V.uint16[te+2]);const X=No.simpleSegment(0,O,n.length,s.length-O);u.push({withoutSkirts:q,withSkirts:X})}return{vertices:n,indices:s,segments:u}}_createGrid(t){const e=this._fillGridMeshWithLods(64,Bu);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Ou.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new Bn;for(let u=0;u<=64;u++)e.emplaceBack(0,u+1,u+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const n=new Rr,s=new Rr;this._poleSegments=[];for(let u=0,f=0;u<Ff;u++){const g=360/(1<<u);n.emplaceBack(0,-$l,0,.5,0),s.emplaceBack(0,-$l,0,.5,1);for(let b=0;b<=64;b++){const S=b/64,A=mi(0,g,S),[O,z,V]=Eh(Dh,gm,A,$l);n.emplaceBack(O,z,V,S,0),s.emplaceBack(O,z,V,S,1)}this._poleSegments.push(No.simpleSegment(f,0,66,64)),f+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,cm,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(s,cm,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const n=new Fs,s=64,u=s+1+2,f=1;this._wireframeSegments=[];for(let g=0,b=0;g<Bu.length;g++){const S=Bu[g];for(let O=f;O<S+f;O++)for(let z=f;z<s+f;z++){const V=O*u+z;n.emplaceBack(V,V+1),n.emplaceBack(V,V+u),n.emplaceBack(V,V+u+1)}const A=S*s*3;this._wireframeSegments.push(No.simpleSegment(0,b,(S+1)*u,A)),b+=A}this._wireframeIndexBuffer=t.createIndexBuffer(n)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},c.GlyphManager=uc,c.ImagePosition=gp,c.KDBush=xf,c.LivePerformanceUtils=po,c.LngLat=Or,c.LngLatBounds=jl,c.LocalGlyphMode=Yu,c.MAX_MERCATOR_LATITUDE=Ys,c.MercatorCoordinate=ju,c.ONE_EM=Js,c.OverscaledTileID=ba,c.PerformanceMarkers=Ai,c.Point=Se,c.Properties=we,c.RGBAImage=Cs,c.Ray=Fu,c.RequestManager=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",bn,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!ze(t))return t;const n=Ye(t);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!ze(t))return t;const n=Ye(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,s){if(!ze(t))return t;const u=Ye(t);return u.path=`/v4/${u.authority}.json`,u.params.push("secure"),n&&u.params.push(`language=${n}`),s&&u.params.push(`worldview=${s}`),this._makeAPIURL(u,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,s){const u=Ye(t);return ze(t)?(u.path=`/styles/v1${u.path}/sprite${e}${n}`,this._makeAPIURL(u,this._customAccessToken||s)):(u.path+=`${e}${n}`,ut(u))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!ze(t))return t;const s=Ye(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&"raster"!==s.authority&&512===n?"@2x":""}${Et.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${Tt.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${Tt.TILE_URL_VERSION}${s.path}`);const u=this._customAccessToken||function(f){for(const g of f){const b=g.match(/^access_token=(.*)$/);if(b)return b[1]}return null}(s.params)||Tt.ACCESS_TOKEN;return Tt.REQUIRE_ACCESS_TOKEN&&u&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,u)}canonicalizeTileURL(t,e){const n=Ye(t);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let s="mapbox://";n.path.match(/^\/raster\/v1\//)?s+=`raster/${n.path.replace(`/${Tt.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${n.path.replace(`/${Tt.TILE_URL_VERSION}/`,"")}`;let u=n.params;return e&&(u=u.filter(f=>!f.match(/^access_token=/))),u.length&&(s+=`?${u.join("&")}`),s}canonicalizeTileset(t,e){const n=!!e&&ze(e),s=[];for(const u of t.tiles||[])fe(u)?s.push(this.canonicalizeTileURL(u,n)):s.push(u);return s}_makeAPIURL(t,e){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=Ye(Tt.API_URL);if(t.protocol=s.protocol,t.authority=s.authority,"http"===t.protocol){const u=t.params.indexOf("secure");u>=0&&t.params.splice(u,1)}if("/"!==s.path&&(t.path=`${s.path}${t.path}`),!Tt.REQUIRE_ACCESS_TOKEN)return ut(t);if(e=e||Tt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(u=>-1===u.indexOf("access_token")),t.params.push(`access_token=${e||""}`),ut(t)}},c.ResourceType=Ri,c.SegmentVector=No,c.SourceCache=yu,c.StencilMode=gf,c.StructArrayLayout1ui2=Ua,c.StructArrayLayout2f1f2i16=Kn,c.StructArrayLayout2i4=Gt,c.StructArrayLayout2ui4=Fs,c.StructArrayLayout3f12=Fi,c.StructArrayLayout3ui6=Bn,c.StructArrayLayout4i8=wt,c.StructArrayLayout5f20=Rr,c.Texture=gu,c.Tile=ff,c.Transitionable=M,c.Uniform1f=dd,c.Uniform1i=class extends Nl{constructor(t){super(t),this.current=0}set(t,e,n){this.fetchUniformLocation(t,e)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},c.Uniform2f=class extends Nl{constructor(t){super(t),this.current=[0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}},c.Uniform3f=class extends Nl{constructor(t){super(t),this.current=[0,0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}},c.Uniform4f=rm,c.UniformColor=Pa,c.UniformMatrix2f=class extends Nl{constructor(t){super(t),this.current=Sf}set(t,e,n){if(this.fetchUniformLocation(t,e))for(let s=0;s<4;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}},c.UniformMatrix3f=class extends Nl{constructor(t){super(t),this.current=om}set(t,e,n){if(this.fetchUniformLocation(t,e))for(let s=0;s<9;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},c.UniformMatrix4f=class extends Nl{constructor(t){super(t),this.current=Df}set(t,e,n){if(this.fetchUniformLocation(t,e)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let s=1;s<16;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}},c.UnwrappedTileID=jd,c.ValidationError=Zt,c.VectorTileFeature=Nd,c.VectorTileWorkerSource=class extends $s{constructor(t,e,n,s,u){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=u||Mg,this.loading={},this.loaded={},this.deduped=new jp(t.scheduler),this.isSpriteLoaded=s,this.scheduler=t.scheduler}loadTile(t,e){const n=t.uid,s=t&&t.request,u=s&&s.collectResourceTiming,f=this.loading[n]=new ey(t);f.abort=this.loadVectorData(t,(g,b)=>{const S=!this.loading[n];if(delete this.loading[n],S||g||!b)return f.status="done",S||(this.loaded[n]=f),e(g);const A=b.rawData,O={};b.expires&&(O.expires=b.expires),b.cacheControl&&(O.cacheControl=b.cacheControl),f.vectorTile=b.vectorTile||new zd(new Xd(A));const z=()=>{f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,(V,q)=>{if(V||!q)return e(V);const X={};if(u){const te=Co(s);te.length>0&&(X.resourceTiming=JSON.parse(JSON.stringify(te)))}e(null,Dt({rawTileData:A.slice(0)},q,O,X))})};this.isSpriteLoaded?z():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(z,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):z()}),this.loaded=this.loaded||{},this.loaded[n]=f})}reloadTile(t,e){const n=this.loaded,s=t.uid,u=this;if(n&&n[s]){const f=n[s];f.showCollisionBoxes=t.showCollisionBoxes,f.enableTerrain=!!t.enableTerrain,f.projection=t.projection,f.tileTransform=Lc(t.tileID.canonical,t.projection);const g=(b,S)=>{const A=f.reloadCallback;A&&(delete f.reloadCallback,f.parse(f.vectorTile,u.layerIndex,this.availableImages,u.actor,A)),e(b,S)};"parsing"===f.status?f.reloadCallback=g:"done"===f.status&&(f.vectorTile?f.parse(f.vectorTile,this.layerIndex,this.availableImages,this.actor,g):g())}}abortTile(t,e){const n=t.uid,s=this.loading[n];s&&(s.abort&&s.abort(),delete this.loading[n]),e()}removeTile(t,e){const n=this.loaded,s=t.uid;n&&n[s]&&delete n[s],e()}},c.WritingMode=Ra,c.ZoomDependentExpression=Gi,c.add=Vl,c.addDynamicAttributes=fc,c.adjoint=function(t,e){var n=e[0],s=e[1],u=e[2],f=e[3],g=e[4],b=e[5],S=e[6],A=e[7],O=e[8];return t[0]=g*O-b*A,t[1]=u*A-s*O,t[2]=s*b-u*g,t[3]=b*S-f*O,t[4]=n*O-u*S,t[5]=u*f-n*b,t[6]=f*A-g*S,t[7]=s*S-n*A,t[8]=n*g-s*f,t},c.asyncAll=at,c.bezier=En,c.bindAll=ln,c.boundsAttributes=Rp,c.bufferConvexPolygon=function(t,e){const n=[];for(let s=0;s<t.length;s++){const u=qe(s-1,-1,t.length-1),f=qe(s+1,-1,t.length-1),g=t[s],b=t[f],S=t[u].sub(g).unit(),A=b.sub(g).unit(),O=A.angleWithSep(S.x,S.y),z=S.add(A).unit().mult(-1*e/Math.sin(O/2));n.push(g.add(z))}return n},c.cacheEntryPossiblyAdded=function(t){Hi++,Hi>lo&&(t.getActor().send("enforceCacheSizeLimit",os),Hi=0)},c.calculateGlobeLabelMatrix=function(t,e){const{x:n,y:s}=t.point,u=pm(n,s,t.worldSize/t._pixelsPerMercatorPixel,0,0);return eu(u,u,Vf(Hl(e)))},c.calculateGlobeMatrix=function(t){const{x:e,y:n}=t.point,{lng:s,lat:u}=t._center;return pm(e,n,t.worldSize,s,u)},c.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,n=e/ql(1,t.center.lat),s=bl(new Float64Array(16));return vh(s,s,[t.point.x,t.point.y,0]),tu(s,s,[n,n,e]),Float32Array.from(s)},c.circumferenceAtLatitude=_m,c.clamp=Mt,c.clearTileCache=function(t){if(!Zi())return;const e=Re.caches.delete(ni);t&&e.catch(t).then(()=>t())},c.clipLine=Ep,c.clone=function(t){var e=new Bs(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},c.clone$1=ui,c.collisionCircleLayout=cp,c.config=Tt,c.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},c.create=function(){var t=new Bs(16);return Bs!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},c.create$1=md,c.createExpression=Ln,c.createLayout=He,c.createStyleLayer=function(t){return"custom"===t.type?new K_(t):new bg[t.type](t)},c.cross=wd,c.degToRad=tt,c.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},c.div=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},c.dot=rl,c.earthRadius=Uu,c.ease=yi,c.easeCubicInOut=zt,c.ecefToLatLng=function([t,e,n]){const s=Math.hypot(t,e,n),u=Math.atan2(t,n),f=.5*Math.PI-Math.acos(-e/s);return new Or(kt(u),kt(f))},c.emitValidationErrors=tc,c.endsWith=Rn,c.enforceCacheSizeLimit=function(t){jt(),Vi&&Vi.then(e=>{e.keys().then(n=>{for(let s=0;s<n.length-t;s++)e.delete(n[s])})})},c.evaluateSizeForFeature=hp,c.evaluateSizeForZoom=Cl,c.evaluateVariableOffset=dg,c.evented=w,c.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},c.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},c.exported=as,c.exported$1=Et,c.extend=Dt,c.extend$1=ti,c.fillExtrusionHeightLift=D_,c.filterObject=Hn,c.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},c.fromQuat=function(t,e){var n=e[0],s=e[1],u=e[2],f=e[3],g=n+n,b=s+s,S=u+u,A=n*g,O=s*g,z=s*b,V=u*g,q=u*b,X=u*S,te=f*g,de=f*b,ye=f*S;return t[0]=1-z-X,t[1]=O+ye,t[2]=V-de,t[3]=0,t[4]=O-ye,t[5]=1-A-X,t[6]=q+te,t[7]=0,t[8]=V+de,t[9]=q-te,t[10]=1-A-z,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},c.fromRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=n,t[2]=0,t[3]=-n,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},c.fromScaling=am,c.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return pt[e]},c.getAABBPointSquareDist=function(t,e,n){let s=0;for(let u=0;u<2;++u){const f=n?n[u]:0;t[u]>f&&(s+=(t[u]-f)*(t[u]-f)),e[u]<f&&(s+=(f-e[u])*(f-e[u]))}return s},c.getAnchorAlignment=vp,c.getAnchorJustification=Qh,c.getBounds=function(t){let e=1/0,n=1/0,s=-1/0,u=-1/0;for(const f of t)e=Math.min(e,f.x),n=Math.min(n,f.y),s=Math.max(s,f.x),u=Math.max(u,f.y);return{min:new Se(e,n),max:new Se(s,u)}},c.getColumn=yr,c.getDefaultExportFromCjs=Yt,c.getGridMatrix=function(t,e,n,s){const u=e.getNorth(),f=e.getSouth(),g=e.getWest(),b=e.getEast(),S=1<<t.z,A=b-g,O=u-f,z=A/64,V=-O/Bu[n],q=[0,z,0,V,0,0,u,g,0];if(t.z>0){const X=180/s;Af(q,q,[X/A+1,0,0,0,X/O+1,0,-.5*X/z,.5*X/V,1])}return q[2]=S,q[5]=t.x,q[8]=t.y,q},c.getImage=xe,c.getJSON=function(t,e){return vi(Dt(t,{type:"json"}),e)},c.getLatitudinalLod=function(t){const e=Ys-5;t=Mt(t,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(tt(t))),3);return Math.round(n*(Bu.length-1))},c.getMapSessionAPI=_n,c.getPerformanceMeasurement=Co,c.getProjection=mu,c.getRTLTextPluginStatus=C,c.getReferrer=Wr,c.getTilePoint=function(t,{x:e,y:n},s=0){return new Se(((e-s)*t.scale-t.x)*Gn,(n*t.scale-t.y)*Gn)},c.getTileVec3=function(t,e,n=0){return Pu(((e.x-n)*t.scale-t.x)*Gn,(e.y*t.scale-t.y)*Gn,ym(e.z,e.y))},c.getVideo=function(t,e){const n=Re.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let s=0;s<t.length;s++){const u=Re.document.createElement("source");Ji(t[s])||(n.crossOrigin="Anonymous"),u.src=t[s],n.appendChild(u)}return{cancel:()=>{}}},c.globeCenterToScreenPoint=function(t){const e=[0,0,0],n=bl(new Float64Array(16));return eu(n,t.pixelMatrix,t.globeMatrix),Eo(e,e,n),new Se(e[0],e[1])},c.globeDenormalizeECEF=Vf,c.globeECEFOrigin=function(t,e){const n=[0,0,0];return Eo(n,n,zu(Hl(e.canonical))),Eo(n,n,t),n},c.globeMetersToEcef=bh,c.globeNormalizeECEF=zu,c.globePixelsToTileUnits=function(t,e){return Gn/(512*Math.pow(2,t))*jf(Hl(e))},c.globePoleMatrixForTile=function(t,e,n){const s=bl(new Float64Array(16)),u=(e/(1<<t)-.5)*Math.PI*2;return gd(s,n.globeMatrix,u),Float32Array.from(s)},c.globeTileBounds=Hl,c.globeTiltAtLngLat=mm,c.globeToMercatorTransition=Nu,c.globeUseCustomAntiAliasing=function(t,e,n){const s=Nu(n.zoom),u=t.style.map._antialias,f=!!e.extStandardDerivatives,g=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===s&&!u&&!g&&f},c.identity=bl,c.identity$1=Lu,c.invert=yh,c.isFullscreen=function(){return!!Re.document.fullscreenElement||!!Re.document.webkitFullscreenElement},c.isLngLatBehindGlobe=Ch,c.isMapAuthenticated=function(t){return Tn.has(t)},c.isMapboxURL=ze,c.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!Wt(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},c.latFromMercatorY=Ns,c.latLngToECEF=Th,c.len=Ed,c.length=xh,c.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},c.lngFromMercatorX=ll,c.loadVectorTile=Mg,c.makeRequest=vi,c.mapValue=function(t,e,n,s,u){return Mt((t-e)/(n-e)*(u-s)+s,s,u)},c.mercatorScale=vm,c.mercatorXfromLng=sl,c.mercatorYfromLat=al,c.mercatorZfromAltitude=ql,c.mul=Pf,c.mul$1=bd,c.multiply=eu,c.multiply$1=Af,c.multiply$2=Tc,c.nextPowerOfTwo=ei,c.normalize=zs,c.normalize$1=Qg,c.normalize$2=Td,c.number=mi,c.ortho=function(t,e,n,s,u,f,g){var b=1/(e-n),S=1/(s-u),A=1/(f-g);return t[0]=-2*b,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*S,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*A,t[11]=0,t[12]=(e+n)*b,t[13]=(u+s)*S,t[14]=(g+f)*A,t[15]=1,t},c.pbf=Hh,c.perspective=function(t,e,n,s,u){var f,g=1/Math.tan(e/2);return t[0]=g/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=g,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=u&&u!==1/0?(t[10]=(u+s)*(f=1/(s-u)),t[14]=2*u*s*f):(t[10]=-1,t[14]=-2*s),t},c.pick=function(t,e){const n={};for(let s=0;s<e.length;s++){const u=e[s];u in t&&(n[u]=t[u])}return n},c.plugin=m,c.pointGeometry=an,c.polesInViewport=function(t){const e=bl(new Float64Array(16));eu(e,t.pixelMatrix,t.globeMatrix);const n=[0,ka,0],s=[0,Va,0];return Eo(n,n,e),Eo(s,s,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!Ch(t,new Or(t.center.lat,90)),s[0]>0&&s[0]<=t.width&&s[1]>0&&s[1]<=t.height&&!Ch(t,new Or(t.center.lat,-90))]},c.polygonContainsPoint=Mc,c.polygonIntersectsBox=bm,c.polygonIntersectsPolygon=xm,c.polygonizeBounds=function(t,e,n=0,s=!0){const u=new Se(n,n),f=t.sub(u),g=e.add(u),b=[f,new Se(g.x,f.y),g,new Se(f.x,g.y)];return s&&b.push(f.clone()),b},c.posAttributes=Ou,c.postMapLoadEvent=ge,c.postPerformanceEvent=dt,c.postTurnstileEvent=Ve,c.potpack=mp,c.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},c.radToDeg=kt,c.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],c.registerForPluginStateChange=function(t){return t({pluginStatus:h,pluginURL:i}),w.on("pluginStateChange",t),t},c.removeAuthState=function(t){Tn.delete(t)},c.renderColorRamp=Lh,c.resample=Sh,c.rotateX=Mf,c.rotateX$1=lm,c.rotateY=gd,c.rotateY$1=Lf,c.rotateZ=function(t,e,n){var s=Math.sin(n),u=Math.cos(n),f=e[0],g=e[1],b=e[2],S=e[3],A=e[4],O=e[5],z=e[6],V=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=f*u+A*s,t[1]=g*u+O*s,t[2]=b*u+z*s,t[3]=S*u+V*s,t[4]=A*u-f*s,t[5]=O*u-g*s,t[6]=z*u-b*s,t[7]=V*u-S*s,t},c.rotateZ$1=function(t,e,n){n*=.5;var s=e[0],u=e[1],f=e[2],g=e[3],b=Math.sin(n),S=Math.cos(n);return t[0]=s*S+u*b,t[1]=u*S-s*b,t[2]=f*S+g*b,t[3]=g*S-f*b,t},c.scale=tu,c.scale$1=Rf,c.scale$2=Wa,c.scaleAndAdd=xd,c.set=function(t,e,n,s){return t[0]=e,t[1]=n,t[2]=s,t},c.setCacheLimits=function(t,e){os=t,lo=e},c.setColumn=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},c.setRTLTextPlugin=function(t,e,n=!1){if(h===wo||h===rc||h===vl)throw new Error("setRTLTextPlugin cannot be called multiple times.");i=as.resolveURL(t),h=wo,Bl=e,p(),n||P()},c.smoothstep=Bi,c.spec=ft,c.squaredLength=function(t){var e=t[0],n=t[1],s=t[2];return e*e+n*n+s*s},c.storeAuthState=function(t,e){e?Tn.add(t):Tn.delete(t)},c.sub=ol,c.subtract=vd,c.symbolSize=Km,c.tileAABB=function(t,e,n,s,u,f,g,b,S){if("globe"===S.name)return function Dc(t,e,n){const s=e/t.worldSize,u=t.globeMatrix;if(n.z<=1){const Qe=Hl(n).getCorners();return fm(Qe,u,s),wa.fromPoints(Qe)}const f=Sc(n),g=Uf(f);fm(g,u,s);const b=Number.MAX_VALUE,S=[-b,-b,-b],A=[b,b,b];if(f.contains(t.center)){for(const qt of g)ku(A,A,qt),Ru(S,S,qt);S[2]=0;const Qe=t.point,yt=[Qe.x*s,Qe.y*s,0];return ku(A,A,yt),Ru(S,S,yt),new wa(A,S)}const O=[u[12]*s,u[13]*s,u[14]*s],z=f.getCenter(),V=Mt(t.center.lat,-Ys,Ys),q=Mt(z.lat,-Ys,Ys),X=sl(t.center.lng),te=al(V);let de=X-sl(z.lng);const ye=te-al(q);de>.5?de-=1:de<-.5&&(de+=1);let Ie=0;Math.abs(de)>Math.abs(ye)?Ie=de>=0?1:3:(Ie=ye>=0?0:2,xd(O,O,[u[4]*s,u[5]*s,u[6]*s],-Math.sin(tt(ye>=0?f.getSouth():f.getNorth()))*$l));const ve=g[Ie],De=g[(Ie+1)%4],Fe=new hm(ve,De,O),Le=[Nf(Fe,0)||ve[0],Nf(Fe,1)||ve[1],Nf(Fe,2)||ve[2]],rt=Nu(t.zoom);if(rt>0){const Qe=function({x:qt,y:lt,z:St},Ct,Bt,Xt,gt){const mn=1/(1<<St);let Mn=qt*mn,yn=Mn+mn,gi=lt*mn,Jt=gi+mn,Vn=0;const _i=(Mn+yn)/2-Xt;return _i>.5?Vn=-1:_i<-.5&&(Vn=1),Mn=((Mn+Vn)*Ct-(Xt*=Ct))*Bt+Xt,yn=((yn+Vn)*Ct-Xt)*Bt+Xt,gi=(gi*Ct-(gt*=Ct))*Bt+gt,Jt=(Jt*Ct-gt)*Bt+gt,[[Mn,Jt,0],[yn,Jt,0],[yn,gi,0],[Mn,gi,0]]}(n,e,t._pixelsPerMercatorPixel,X,te);for(let qt=0;qt<g.length;qt++)ru(g[qt],Qe[qt],rt);const yt=Vl([],Qe[Ie],Qe[(Ie+1)%4]);Wa(yt,yt,.5),ru(Le,yt,rt)}for(const Qe of g)ku(A,A,Qe),Ru(S,S,Qe);return A[2]=Math.min(ve[2],De[2]),ku(A,A,Le),Ru(S,S,Le),new wa(A,S)}(t,e,new qu(n,s,u));const A=Lc({z:n,x:s,y:u},S);return new wa([(f+A.x/A.scale)*e,e*(A.y/A.scale),g],[(f+A.x2/A.scale)*e,e*(A.y2/A.scale),b])},c.tileCornersToBounds=Sc,c.tileTransform=Lc,c.transformMat3=function(t,e,n){var s=e[0],u=e[1],f=e[2];return t[0]=s*n[0]+u*n[3]+f*n[6],t[1]=s*n[1]+u*n[4]+f*n[7],t[2]=s*n[2]+u*n[5]+f*n[8],t},c.transformMat4=Eo,c.transformMat4$1=ac,c.transformQuat=kf,c.transitionTileAABBinECEF=dm,c.translate=vh,c.transpose=function(t,e){if(t===e){var n=e[1],s=e[2],u=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=s,t[7]=u}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},c.triggerPluginCompletionEvent=l,c.uniqueId=Ot,c.updateGlobeVertexNormal=function(t,e,n,s,u){const f=5*e+2;t.float32[f+0]=n,t.float32[f+1]=s,t.float32[f+2]=u},c.validateCustomStyleLayer=function(t){const e=[],n=t.id;return void 0===n&&e.push({message:`layers.${n}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},c.validateFilter=t=>va(el(t)),c.validateFog=t=>va(Au(t)),c.validateLayer=t=>va(Ts(t)),c.validateLight=t=>va(qa(t)),c.validateSource=t=>va(Du(t)),c.validateStyle=Rs,c.validateTerrain=t=>va(Su(t)),c.values=bt,c.vectorTile=jh,c.version=nn,c.warnOnce=hi,c.window=Re,c.wrap=qe}),W(0,function(c){function Re(Ee){if("number"==typeof Ee||"boolean"==typeof Ee||"string"==typeof Ee||null==Ee)return JSON.stringify(Ee);if(Array.isArray(Ee)){let ae="[";for(const xe of Ee)ae+=`${Re(xe)},`;return`${ae}]`}let ne="{";for(const ae of Object.keys(Ee).sort())ne+=`${ae}:${Re(Ee[ae])},`;return`${ne}}`}function nn(Ee){let ne="";for(const ae of c.refProperties)ne+=`/${Re(Ee[ae])}`;return ne}class xt{constructor(ne){this.keyCache={},ne&&this.replace(ne)}replace(ne){this._layerConfigs={},this._layers={},this.update(ne,[])}update(ne,ae){for(const Me of ne)this._layerConfigs[Me.id]=Me,(this._layers[Me.id]=c.createStyleLayer(Me)).compileFilter(),this.keyCache[Me.id]&&delete this.keyCache[Me.id];for(const Me of ae)delete this.keyCache[Me],delete this._layerConfigs[Me],delete this._layers[Me];this.familiesBySource={};const xe=function(Me,ze){const fe={};for(let re=0;re<Me.length;re++){const Ce=ze&&ze[Me[re].id]||nn(Me[re]);ze&&(ze[Me[re].id]=Ce);let je=fe[Ce];je||(je=fe[Ce]=[]),je.push(Me[re])}const oe=[];for(const re in fe)oe.push(fe[re]);return oe}(c.values(this._layerConfigs),this.keyCache);for(const Me of xe){const ze=Me.map(Ye=>this._layers[Ye.id]),fe=ze[0];if("none"===fe.visibility)continue;const oe=fe.source||"";let re=this.familiesBySource[oe];re||(re=this.familiesBySource[oe]={});const Ce=fe.sourceLayer||"_geojsonTileLayer";let je=re[Ce];je||(je=re[Ce]=[]),je.push(ze)}}}class Tt{loadTile(ne,ae){const{uid:xe,encoding:Me,rawImageData:ze,padding:fe,buildQuadTree:oe}=ne,re=c.window.ImageBitmap&&ze instanceof c.window.ImageBitmap?this.getImageData(ze,fe):ze;ae(null,new c.DEMData(xe,re,Me,fe<1,oe))}getImageData(ne,ae){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ne.width,ne.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ne.width,this.offscreenCanvas.height=ne.height,this.offscreenCanvasContext.drawImage(ne,0,0,ne.width,ne.height);const xe=this.offscreenCanvasContext.getImageData(-ae,-ae,ne.width+2*ae,ne.height+2*ae);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),xe}}function Et(Ee,ne){if(0!==Ee.length){At(Ee[0],ne);for(var ae=1;ae<Ee.length;ae++)At(Ee[ae],!ne)}}function At(Ee,ne){for(var ae=0,xe=0,Me=0,ze=Ee.length,fe=ze-1;Me<ze;fe=Me++){var oe=(Ee[Me][0]-Ee[fe][0])*(Ee[fe][1]+Ee[Me][1]),re=ae+oe;xe+=Math.abs(ae)>=Math.abs(oe)?ae-re+oe:oe-re+ae,ae=re}ae+xe>=0!=!!ne&&Ee.reverse()}var _t=c.getDefaultExportFromCjs(function Ee(ne,ae){var xe,Me=ne&&ne.type;if("FeatureCollection"===Me)for(xe=0;xe<ne.features.length;xe++)Ee(ne.features[xe],ae);else if("GeometryCollection"===Me)for(xe=0;xe<ne.geometries.length;xe++)Ee(ne.geometries[xe],ae);else if("Feature"===Me)Ee(ne.geometry,ae);else if("Polygon"===Me)Et(ne.coordinates,ae);else if("MultiPolygon"===Me)for(xe=0;xe<ne.coordinates.length;xe++)Et(ne.coordinates[xe],ae);return ne});const Qt=c.VectorTileFeature.prototype.toGeoJSON;var An={exports:{}},It=c.pointGeometry,bn=c.vectorTile.VectorTileFeature,Yt=Nn;function Nn(Ee,ne){this.options=ne||{},this.features=Ee,this.length=Ee.length}function pn(Ee,ne){this.id="number"==typeof Ee.id?Ee.id:void 0,this.type=Ee.type,this.rawGeometry=1===Ee.type?[Ee.geometry]:Ee.geometry,this.properties=Ee.tags,this.extent=ne||4096}Nn.prototype.feature=function(Ee){return new pn(this.features[Ee],this.options.extent)},pn.prototype.loadGeometry=function(){var Ee=this.rawGeometry;this.geometry=[];for(var ne=0;ne<Ee.length;ne++){for(var ae=Ee[ne],xe=[],Me=0;Me<ae.length;Me++)xe.push(new It(ae[Me][0],ae[Me][1]));this.geometry.push(xe)}return this.geometry},pn.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Ee=this.geometry,ne=1/0,ae=-1/0,xe=1/0,Me=-1/0,ze=0;ze<Ee.length;ze++)for(var fe=Ee[ze],oe=0;oe<fe.length;oe++){var re=fe[oe];ne=Math.min(ne,re.x),ae=Math.max(ae,re.x),xe=Math.min(xe,re.y),Me=Math.max(Me,re.y)}return[ne,xe,ae,Me]},pn.prototype.toGeoJSON=bn.prototype.toGeoJSON;var rn=c.pbf,an=Yt;function Pt(Ee){var ne=new rn;return function(ae,xe){for(var Me in ae.layers)xe.writeMessage(3,Se,ae.layers[Me])}(Ee,ne),ne.finish()}function Se(Ee,ne){var ae;ne.writeVarintField(15,Ee.version||1),ne.writeStringField(1,Ee.name||""),ne.writeVarintField(5,Ee.extent||4096);var xe={keys:[],values:[],keycache:{},valuecache:{}};for(ae=0;ae<Ee.length;ae++)xe.feature=Ee.feature(ae),ne.writeMessage(2,fn,xe);var Me=xe.keys;for(ae=0;ae<Me.length;ae++)ne.writeStringField(3,Me[ae]);var ze=xe.values;for(ae=0;ae<ze.length;ae++)ne.writeMessage(4,zt,ze[ae])}function fn(Ee,ne){var ae=Ee.feature;void 0!==ae.id&&ne.writeVarintField(1,ae.id),ne.writeMessage(2,Zn,Ee),ne.writeVarintField(3,ae.type),ne.writeMessage(4,pt,ae)}function Zn(Ee,ne){var ae=Ee.feature,xe=Ee.keys,Me=Ee.values,ze=Ee.keycache,fe=Ee.valuecache;for(var oe in ae.properties){var re=ae.properties[oe],Ce=ze[oe];if(null!==re){void 0===Ce&&(xe.push(oe),ze[oe]=Ce=xe.length-1),ne.writeVarint(Ce);var je=typeof re;"string"!==je&&"boolean"!==je&&"number"!==je&&(re=JSON.stringify(re));var Ye=je+":"+re,ut=fe[Ye];void 0===ut&&(Me.push(re),fe[Ye]=ut=Me.length-1),ne.writeVarint(ut)}}}function tt(Ee,ne){return(ne<<3)+(7&Ee)}function kt(Ee){return Ee<<1^Ee>>31}function pt(Ee,ne){for(var ae=Ee.loadGeometry(),xe=Ee.type,Me=0,ze=0,fe=ae.length,oe=0;oe<fe;oe++){var re=ae[oe],Ce=1;1===xe&&(Ce=re.length),ne.writeVarint(tt(1,Ce));for(var je=3===xe?re.length-1:re.length,Ye=0;Ye<je;Ye++){1===Ye&&1!==xe&&ne.writeVarint(tt(2,je-1));var ut=re[Ye].x-Me,Dn=re[Ye].y-ze;ne.writeVarint(kt(ut)),ne.writeVarint(kt(Dn)),Me+=ut,ze+=Dn}3===xe&&ne.writeVarint(tt(7,1))}}function zt(Ee,ne){var ae=typeof Ee;"string"===ae?ne.writeStringField(1,Ee):"boolean"===ae?ne.writeBooleanField(7,Ee):"number"===ae&&(Ee%1!=0?ne.writeDoubleField(3,Ee):Ee<0?ne.writeSVarintField(6,Ee):ne.writeVarintField(5,Ee))}An.exports=Pt,An.exports.fromVectorTileJs=Pt,An.exports.fromGeojsonVt=function(Ee,ne){ne=ne||{};var ae={};for(var xe in Ee)ae[xe]=new an(Ee[xe].features,ne),ae[xe].name=xe,ae[xe].version=ne.version,ae[xe].extent=ne.extent;return Pt({layers:ae})},An.exports.GeoJSONWrapper=an;var En=c.getDefaultExportFromCjs(An.exports);const yi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ee=>Ee},Mt=Math.fround||(Bi=new Float32Array(1),Ee=>(Bi[0]=+Ee,Bi[0]));var Bi;const qe=3,at=5,bt=6;class Dt{constructor(ne){this.options=Object.assign(Object.create(yi),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:ae,minZoom:xe,maxZoom:Me}=this.options;ae&&console.time("total time");const ze=`prepare ${ne.length} points`;ae&&console.time(ze),this.points=ne;const fe=[];for(let re=0;re<ne.length;re++){const Ce=ne[re];if(!Ce.geometry)continue;const[je,Ye]=Ce.geometry.coordinates,ut=Mt(On(je)),Dn=Mt(ei(Ye));fe.push(ut,Dn,1/0,re,-1,1),this.options.reduce&&fe.push(0)}let oe=this.trees[Me+1]=this._createTree(fe);ae&&console.timeEnd(ze);for(let re=Me;re>=xe;re--){const Ce=+Date.now();oe=this.trees[re]=this._createTree(this._cluster(oe,re)),ae&&console.log("z%d: %d clusters in %dms",re,oe.numItems,+Date.now()-Ce)}return ae&&console.timeEnd("total time"),this}getClusters(ne,ae){let xe=((ne[0]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,ne[1]));let ze=180===ne[2]?180:((ne[2]+180)%360+360)%360-180;const fe=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)xe=-180,ze=180;else if(xe>ze){const Ye=this.getClusters([xe,Me,180,fe],ae),ut=this.getClusters([-180,Me,ze,fe],ae);return Ye.concat(ut)}const oe=this.trees[this._limitZoom(ae)],re=oe.range(On(xe),ei(fe),On(ze),ei(Me)),Ce=oe.data,je=[];for(const Ye of re){const ut=this.stride*Ye;je.push(Ce[ut+at]>1?Ut(Ce,ut,this.clusterProps):this.points[Ce[ut+qe]])}return je}getChildren(ne){const ae=this._getOriginId(ne),xe=this._getOriginZoom(ne),Me="No cluster with the specified id.",ze=this.trees[xe];if(!ze)throw new Error(Me);const fe=ze.data;if(ae*this.stride>=fe.length)throw new Error(Me);const oe=this.options.radius/(this.options.extent*Math.pow(2,xe-1)),re=ze.within(fe[ae*this.stride],fe[ae*this.stride+1],oe),Ce=[];for(const je of re){const Ye=je*this.stride;fe[Ye+4]===ne&&Ce.push(fe[Ye+at]>1?Ut(fe,Ye,this.clusterProps):this.points[fe[Ye+qe]])}if(0===Ce.length)throw new Error(Me);return Ce}getLeaves(ne,ae,xe){const Me=[];return this._appendLeaves(Me,ne,ae=ae||10,xe=xe||0,0),Me}getTile(ne,ae,xe){const Me=this.trees[this._limitZoom(ne)],ze=Math.pow(2,ne),{extent:fe,radius:oe}=this.options,re=oe/fe,Ce=(xe-re)/ze,je=(xe+1+re)/ze,Ye={features:[]};return this._addTileFeatures(Me.range((ae-re)/ze,Ce,(ae+1+re)/ze,je),Me.data,ae,xe,ze,Ye),0===ae&&this._addTileFeatures(Me.range(1-re/ze,Ce,1,je),Me.data,ze,xe,ze,Ye),ae===ze-1&&this._addTileFeatures(Me.range(0,Ce,re/ze,je),Me.data,-1,xe,ze,Ye),Ye.features.length?Ye:null}getClusterExpansionZoom(ne){let ae=this._getOriginZoom(ne)-1;for(;ae<=this.options.maxZoom;){const xe=this.getChildren(ne);if(ae++,1!==xe.length)break;ne=xe[0].properties.cluster_id}return ae}_appendLeaves(ne,ae,xe,Me,ze){const fe=this.getChildren(ae);for(const oe of fe){const re=oe.properties;if(re&&re.cluster?ze+re.point_count<=Me?ze+=re.point_count:ze=this._appendLeaves(ne,re.cluster_id,xe,Me,ze):ze<Me?ze++:ne.push(oe),ne.length===xe)break}return ze}_createTree(ne){const ae=new c.KDBush(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let xe=0;xe<ne.length;xe+=this.stride)ae.add(ne[xe],ne[xe+1]);return ae.finish(),ae.data=ne,ae}_addTileFeatures(ne,ae,xe,Me,ze,fe){for(const oe of ne){const re=oe*this.stride,Ce=ae[re+at]>1;let je,Ye,ut;if(Ce)je=Ot(ae,re,this.clusterProps),Ye=ae[re],ut=ae[re+1];else{const gn=this.points[ae[re+qe]];je=gn.properties;const[Fn,Ve]=gn.geometry.coordinates;Ye=On(Fn),ut=ei(Ve)}const Dn={type:1,geometry:[[Math.round(this.options.extent*(Ye*ze-xe)),Math.round(this.options.extent*(ut*ze-Me))]],tags:je};let cn;cn=Ce||this.options.generateId?ae[re+qe]:this.points[ae[re+qe]].id,void 0!==cn&&(Dn.id=cn),fe.features.push(Dn)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,ae){const{radius:xe,extent:Me,reduce:ze,minPoints:fe}=this.options,oe=xe/(Me*Math.pow(2,ae)),re=ne.data,Ce=[],je=this.stride;for(let Ye=0;Ye<re.length;Ye+=je){if(re[Ye+2]<=ae)continue;re[Ye+2]=ae;const ut=re[Ye],Dn=re[Ye+1],cn=ne.within(re[Ye],re[Ye+1],oe),gn=re[Ye+at];let Fn=gn;for(const Ve of cn){const Ne=Ve*je;re[Ne+2]>ae&&(Fn+=re[Ne+at])}if(Fn>gn&&Fn>=fe){let Ve,Ne=ut*gn,ge=Dn*gn,$e=-1;const dt=((Ye/je|0)<<5)+(ae+1)+this.points.length;for(const on of cn){const _n=on*je;if(re[_n+2]<=ae)continue;re[_n+2]=ae;const Tn=re[_n+at];Ne+=re[_n]*Tn,ge+=re[_n+1]*Tn,re[_n+4]=dt,ze&&(Ve||(Ve=this._map(re,Ye,!0),$e=this.clusterProps.length,this.clusterProps.push(Ve)),ze(Ve,this._map(re,_n)))}re[Ye+4]=dt,Ce.push(Ne/Fn,ge/Fn,1/0,dt,-1,Fn),ze&&Ce.push($e)}else{for(let Ve=0;Ve<je;Ve++)Ce.push(re[Ye+Ve]);if(Fn>1)for(const Ve of cn){const Ne=Ve*je;if(!(re[Ne+2]<=ae)){re[Ne+2]=ae;for(let ge=0;ge<je;ge++)Ce.push(re[Ne+ge])}}}}return Ce}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,ae,xe){if(ne[ae+at]>1){const fe=this.clusterProps[ne[ae+bt]];return xe?Object.assign({},fe):fe}const Me=this.points[ne[ae+qe]].properties,ze=this.options.map(Me);return xe&&ze===Me?Object.assign({},ze):ze}}function Ut(Ee,ne,ae){return{type:"Feature",id:Ee[ne+qe],properties:Ot(Ee,ne,ae),geometry:{type:"Point",coordinates:[(xe=Ee[ne],360*(xe-.5)),ji(Ee[ne+1])]}};var xe}function Ot(Ee,ne,ae){const xe=Ee[ne+at],Me=xe>=1e4?`${Math.round(xe/1e3)}k`:xe>=1e3?Math.round(xe/100)/10+"k":xe,ze=Ee[ne+bt],fe=-1===ze?{}:Object.assign({},ae[ze]);return Object.assign(fe,{cluster:!0,cluster_id:Ee[ne+qe],point_count:xe,point_count_abbreviated:Me})}function On(Ee){return Ee/360+.5}function ei(Ee){const ne=Math.sin(Ee*Math.PI/180),ae=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ae<0?0:ae>1?1:ae}function ji(Ee){const ne=(180-360*Ee)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function ln(Ee,ne,ae,xe){for(var Me,ze=xe,fe=ae-ne>>1,oe=ae-ne,re=Ee[ne],Ce=Ee[ne+1],je=Ee[ae],Ye=Ee[ae+1],ut=ne+3;ut<ae;ut+=3){var Dn=Rn(Ee[ut],Ee[ut+1],re,Ce,je,Ye);if(Dn>ze)Me=ut,ze=Dn;else if(Dn===ze){var cn=Math.abs(ut-fe);cn<oe&&(Me=ut,oe=cn)}}ze>xe&&(Me-ne>3&&ln(Ee,ne,Me,xe),Ee[Me+2]=ze,ae-Me>3&&ln(Ee,Me,ae,xe))}function Rn(Ee,ne,ae,xe,Me,ze){var fe=Me-ae,oe=ze-xe;if(0!==fe||0!==oe){var re=((Ee-ae)*fe+(ne-xe)*oe)/(fe*fe+oe*oe);re>1?(ae=Me,xe=ze):re>0&&(ae+=fe*re,xe+=oe*re)}return(fe=Ee-ae)*fe+(oe=ne-xe)*oe}function un(Ee,ne,ae,xe){var Me={id:void 0===Ee?null:Ee,type:ne,geometry:ae,tags:xe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ze){var fe=ze.geometry,oe=ze.type;if("Point"===oe||"MultiPoint"===oe||"LineString"===oe)Hn(ze,fe);else if("Polygon"===oe||"MultiLineString"===oe)for(var re=0;re<fe.length;re++)Hn(ze,fe[re]);else if("MultiPolygon"===oe)for(re=0;re<fe.length;re++)for(var Ce=0;Ce<fe[re].length;Ce++)Hn(ze,fe[re][Ce])}(Me),Me}function Hn(Ee,ne){for(var ae=0;ae<ne.length;ae+=3)Ee.minX=Math.min(Ee.minX,ne[ae]),Ee.minY=Math.min(Ee.minY,ne[ae+1]),Ee.maxX=Math.max(Ee.maxX,ne[ae]),Ee.maxY=Math.max(Ee.maxY,ne[ae+1])}function ui(Ee,ne,ae,xe){if(ne.geometry){var Me=ne.geometry.coordinates,ze=ne.geometry.type,fe=Math.pow(ae.tolerance/((1<<ae.maxZoom)*ae.extent),2),oe=[],re=ne.id;if(ae.promoteId?re=ne.properties[ae.promoteId]:ae.generateId&&(re=xe||0),"Point"===ze)qn(Me,oe);else if("MultiPoint"===ze)for(var Ce=0;Ce<Me.length;Ce++)qn(Me[Ce],oe);else if("LineString"===ze)hi(Me,oe,fe,!1);else if("MultiLineString"===ze){if(ae.lineMetrics){for(Ce=0;Ce<Me.length;Ce++)hi(Me[Ce],oe=[],fe,!1),Ee.push(un(re,"LineString",oe,ne.properties));return}Ht(Me,oe,fe,!1)}else if("Polygon"===ze)Ht(Me,oe,fe,!0);else{if("MultiPolygon"!==ze){if("GeometryCollection"===ze){for(Ce=0;Ce<ne.geometry.geometries.length;Ce++)ui(Ee,{id:re,geometry:ne.geometry.geometries[Ce],properties:ne.properties},ae,xe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Ce=0;Ce<Me.length;Ce++){var je=[];Ht(Me[Ce],je,fe,!0),oe.push(je)}}Ee.push(un(re,ze,oe,ne.properties))}}function qn(Ee,ne){ne.push(zi(Ee[0])),ne.push(li(Ee[1])),ne.push(0)}function hi(Ee,ne,ae,xe){for(var Me,ze,fe=0,oe=0;oe<Ee.length;oe++){var re=zi(Ee[oe][0]),Ce=li(Ee[oe][1]);ne.push(re),ne.push(Ce),ne.push(0),oe>0&&(fe+=xe?(Me*Ce-re*ze)/2:Math.sqrt(Math.pow(re-Me,2)+Math.pow(Ce-ze,2))),Me=re,ze=Ce}var je=ne.length-3;ne[2]=1,ln(ne,0,je,ae),ne[je+2]=1,ne.size=Math.abs(fe),ne.start=0,ne.end=ne.size}function Ht(Ee,ne,ae,xe){for(var Me=0;Me<Ee.length;Me++){var ze=[];hi(Ee[Me],ze,ae,xe),ne.push(ze)}}function zi(Ee){return Ee/360+.5}function li(Ee){var ne=Math.sin(Ee*Math.PI/180),ae=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ae<0?0:ae>1?1:ae}function Wi(Ee,ne,ae,xe,Me,ze,fe,oe){if(xe/=ne,ze>=(ae/=ne)&&fe<xe)return Ee;if(fe<ae||ze>=xe)return null;for(var re=[],Ce=0;Ce<Ee.length;Ce++){var je=Ee[Ce],Ye=je.geometry,ut=je.type,Dn=0===Me?je.minX:je.minY,cn=0===Me?je.maxX:je.maxY;if(Dn>=ae&&cn<xe)re.push(je);else if(!(cn<ae||Dn>=xe)){var gn=[];if("Point"===ut||"MultiPoint"===ut)si(Ye,gn,ae,xe,Me);else if("LineString"===ut)Wt(Ye,gn,ae,xe,Me,!1,oe.lineMetrics);else if("MultiLineString"===ut)yr(Ye,gn,ae,xe,Me,!1);else if("Polygon"===ut)yr(Ye,gn,ae,xe,Me,!0);else if("MultiPolygon"===ut)for(var Fn=0;Fn<Ye.length;Fn++){var Ve=[];yr(Ye[Fn],Ve,ae,xe,Me,!0),Ve.length&&gn.push(Ve)}if(gn.length){if(oe.lineMetrics&&"LineString"===ut){for(Fn=0;Fn<gn.length;Fn++)re.push(un(je.id,ut,gn[Fn],je.tags));continue}"LineString"!==ut&&"MultiLineString"!==ut||(1===gn.length?(ut="LineString",gn=gn[0]):ut="MultiLineString"),"Point"!==ut&&"MultiPoint"!==ut||(ut=3===gn.length?"Point":"MultiPoint"),re.push(un(je.id,ut,gn,je.tags))}}}return re.length?re:null}function si(Ee,ne,ae,xe,Me){for(var ze=0;ze<Ee.length;ze+=3){var fe=Ee[ze+Me];fe>=ae&&fe<=xe&&(ne.push(Ee[ze]),ne.push(Ee[ze+1]),ne.push(Ee[ze+2]))}}function Wt(Ee,ne,ae,xe,Me,ze,fe){for(var oe,re,Ce=Ar(Ee),je=0===Me?os:lo,Ye=Ee.start,ut=0;ut<Ee.length-3;ut+=3){var Dn=Ee[ut],cn=Ee[ut+1],gn=Ee[ut+2],Fn=Ee[ut+3],Ve=Ee[ut+4],Ne=0===Me?Dn:cn,ge=0===Me?Fn:Ve,$e=!1;fe&&(oe=Math.sqrt(Math.pow(Dn-Fn,2)+Math.pow(cn-Ve,2))),Ne<ae?ge>ae&&(re=je(Ce,Dn,cn,Fn,Ve,ae),fe&&(Ce.start=Ye+oe*re)):Ne>xe?ge<xe&&(re=je(Ce,Dn,cn,Fn,Ve,xe),fe&&(Ce.start=Ye+oe*re)):ni(Ce,Dn,cn,gn),ge<ae&&Ne>=ae&&(re=je(Ce,Dn,cn,Fn,Ve,ae),$e=!0),ge>xe&&Ne<=xe&&(re=je(Ce,Dn,cn,Fn,Ve,xe),$e=!0),!ze&&$e&&(fe&&(Ce.end=Ye+oe*re),ne.push(Ce),Ce=Ar(Ee)),fe&&(Ye+=oe)}var dt=Ee.length-3;Dn=Ee[dt],cn=Ee[dt+1],gn=Ee[dt+2],(Ne=0===Me?Dn:cn)>=ae&&Ne<=xe&&ni(Ce,Dn,cn,gn),dt=Ce.length-3,ze&&dt>=3&&(Ce[dt]!==Ce[0]||Ce[dt+1]!==Ce[1])&&ni(Ce,Ce[0],Ce[1],Ce[2]),Ce.length&&ne.push(Ce)}function Ar(Ee){var ne=[];return ne.size=Ee.size,ne.start=Ee.start,ne.end=Ee.end,ne}function yr(Ee,ne,ae,xe,Me,ze){for(var fe=0;fe<Ee.length;fe++)Wt(Ee[fe],ne,ae,xe,Me,ze,!1)}function ni(Ee,ne,ae,xe){Ee.push(ne),Ee.push(ae),Ee.push(xe)}function os(Ee,ne,ae,xe,Me,ze){var fe=(ze-ne)/(xe-ne);return Ee.push(ze),Ee.push(ae+(Me-ae)*fe),Ee.push(1),fe}function lo(Ee,ne,ae,xe,Me,ze){var fe=(ze-ae)/(Me-ae);return Ee.push(ne+(xe-ne)*fe),Ee.push(ze),Ee.push(1),fe}function Vi(Ee,ne){for(var ae=[],xe=0;xe<Ee.length;xe++){var Me,ze=Ee[xe],fe=ze.type;if("Point"===fe||"MultiPoint"===fe||"LineString"===fe)Me=zr(ze.geometry,ne);else if("MultiLineString"===fe||"Polygon"===fe){Me=[];for(var oe=0;oe<ze.geometry.length;oe++)Me.push(zr(ze.geometry[oe],ne))}else if("MultiPolygon"===fe)for(Me=[],oe=0;oe<ze.geometry.length;oe++){for(var re=[],Ce=0;Ce<ze.geometry[oe].length;Ce++)re.push(zr(ze.geometry[oe][Ce],ne));Me.push(re)}ae.push(un(ze.id,fe,Me,ze.tags))}return ae}function zr(Ee,ne){var ae=[];ae.size=Ee.size,void 0!==Ee.start&&(ae.start=Ee.start,ae.end=Ee.end);for(var xe=0;xe<Ee.length;xe+=3)ae.push(Ee[xe]+ne,Ee[xe+1],Ee[xe+2]);return ae}function Zi(Ee,ne){if(Ee.transformed)return Ee;var ae,xe,Me,ze=1<<Ee.z,fe=Ee.x,oe=Ee.y;for(ae=0;ae<Ee.features.length;ae++){var re=Ee.features[ae],Ce=re.geometry,je=re.type;if(re.geometry=[],1===je)for(xe=0;xe<Ce.length;xe+=2)re.geometry.push(jt(Ce[xe],Ce[xe+1],ne,ze,fe,oe));else for(xe=0;xe<Ce.length;xe++){var Ye=[];for(Me=0;Me<Ce[xe].length;Me+=2)Ye.push(jt(Ce[xe][Me],Ce[xe][Me+1],ne,ze,fe,oe));re.geometry.push(Ye)}}return Ee.transformed=!0,Ee}function jt(Ee,ne,ae,xe,Me,ze){return[Math.round(ae*(Ee*xe-Me)),Math.round(ae*(ne*xe-ze))]}function ht(Ee,ne,ae,xe,Me){for(var ze=ne===Me.maxZoom?0:Me.tolerance/((1<<ne)*Me.extent),fe={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:ae,y:xe,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},oe=0;oe<Ee.length;oe++){fe.numFeatures++,Hi(fe,Ee[oe],ze,Me);var re=Ee[oe].minX,Ce=Ee[oe].minY,je=Ee[oe].maxX,Ye=Ee[oe].maxY;re<fe.minX&&(fe.minX=re),Ce<fe.minY&&(fe.minY=Ce),je>fe.maxX&&(fe.maxX=je),Ye>fe.maxY&&(fe.maxY=Ye)}return fe}function Hi(Ee,ne,ae,xe){var Me=ne.geometry,ze=ne.type,fe=[];if("Point"===ze||"MultiPoint"===ze)for(var oe=0;oe<Me.length;oe+=3)fe.push(Me[oe]),fe.push(Me[oe+1]),Ee.numPoints++,Ee.numSimplified++;else if("LineString"===ze)Ri(fe,Me,Ee,ae,!1,!1);else if("MultiLineString"===ze||"Polygon"===ze)for(oe=0;oe<Me.length;oe++)Ri(fe,Me[oe],Ee,ae,"Polygon"===ze,0===oe);else if("MultiPolygon"===ze)for(var re=0;re<Me.length;re++){var Ce=Me[re];for(oe=0;oe<Ce.length;oe++)Ri(fe,Ce[oe],Ee,ae,!0,0===oe)}if(fe.length){var je=ne.tags||null;if("LineString"===ze&&xe.lineMetrics){for(var Ye in je={},ne.tags)je[Ye]=ne.tags[Ye];je.mapbox_clip_start=Me.start/Me.size,je.mapbox_clip_end=Me.end/Me.size}var ut={geometry:fe,type:"Polygon"===ze||"MultiPolygon"===ze?3:"LineString"===ze||"MultiLineString"===ze?2:1,tags:je};null!==ne.id&&(ut.id=ne.id),Ee.features.push(ut)}}function Ri(Ee,ne,ae,xe,Me,ze){var fe=xe*xe;if(xe>0&&ne.size<(Me?fe:xe))ae.numPoints+=ne.length/3;else{for(var oe=[],re=0;re<ne.length;re+=3)(0===xe||ne[re+2]>fe)&&(ae.numSimplified++,oe.push(ne[re]),oe.push(ne[re+1])),ae.numPoints++;Me&&function(Ce,je){for(var Ye=0,ut=0,Dn=Ce.length,cn=Dn-2;ut<Dn;cn=ut,ut+=2)Ye+=(Ce[ut]-Ce[cn])*(Ce[ut+1]+Ce[cn+1]);if(Ye>0===je)for(ut=0,Dn=Ce.length;ut<Dn/2;ut+=2){var gn=Ce[ut],Fn=Ce[ut+1];Ce[ut]=Ce[Dn-2-ut],Ce[ut+1]=Ce[Dn-1-ut],Ce[Dn-2-ut]=gn,Ce[Dn-1-ut]=Fn}}(oe,ze),Ee.push(oe)}}function Yi(Ee,ne){var ae=(ne=this.options=function(Me,ze){for(var fe in ze)Me[fe]=ze[fe];return Me}(Object.create(this.options),ne)).debug;if(ae&&console.time("preprocess data"),ne.maxZoom<0||ne.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ne.promoteId&&ne.generateId)throw new Error("promoteId and generateId cannot be used together.");var Me,ze,fe,oe,re,Ce,xe=function(Me,ze){var fe=[];if("FeatureCollection"===Me.type)for(var oe=0;oe<Me.features.length;oe++)ui(fe,Me.features[oe],ze,oe);else ui(fe,"Feature"===Me.type?Me:{geometry:Me},ze);return fe}(Ee,ne);this.tiles={},this.tileCoords=[],ae&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ne.indexMaxZoom,ne.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),oe=Me=xe,re=Wi(Me,1,-1-(fe=(ze=ne).buffer/ze.extent),fe,0,-1,2,ze),Ce=Wi(Me,1,1-fe,2+fe,0,-1,2,ze),(re||Ce)&&(oe=Wi(Me,1,-fe,1+fe,0,-1,2,ze)||[],re&&(oe=Vi(re,1).concat(oe)),Ce&&(oe=oe.concat(Vi(Ce,-1)))),(xe=oe).length&&this.splitTile(xe,0,0,0),ae&&(xe.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Wr(Ee,ne,ae){return 32*((1<<Ee)*ae+ne)+Ee}function vi(Ee,ne){const ae=Ee.tileID.canonical;if(!this._geoJSONIndex)return ne(null,null);const xe=this._geoJSONIndex.getTile(ae.z,ae.x,ae.y);if(!xe)return ne(null,null);const Me=new class{constructor(fe){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=c.EXTENT,this.length=fe.length,this._features=fe}feature(fe){return new class{constructor(oe){this._feature=oe,this.extent=c.EXTENT,this.type=oe.type,this.properties=oe.tags,"id"in oe&&!isNaN(oe.id)&&(this.id=parseInt(oe.id,10))}loadGeometry(){if(1===this._feature.type){const oe=[];for(const re of this._feature.geometry)oe.push([new c.Point(re[0],re[1])]);return oe}{const oe=[];for(const re of this._feature.geometry){const Ce=[];for(const je of re)Ce.push(new c.Point(je[0],je[1]));oe.push(Ce)}return oe}}toGeoJSON(oe,re,Ce){return Qt.call(this,oe,re,Ce)}}(this._features[fe])}}(xe.features);let ze=En(Me);0===ze.byteOffset&&ze.byteLength===ze.buffer.byteLength||(ze=new Uint8Array(ze)),ne(null,{vectorTile:Me,rawData:ze.buffer})}Yi.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Yi.prototype.splitTile=function(Ee,ne,ae,xe,Me,ze,fe){for(var oe=[Ee,ne,ae,xe],re=this.options,Ce=re.debug;oe.length;){xe=oe.pop(),ae=oe.pop(),ne=oe.pop(),Ee=oe.pop();var je=1<<ne,Ye=Wr(ne,ae,xe),ut=this.tiles[Ye];if(!ut&&(Ce>1&&console.time("creation"),ut=this.tiles[Ye]=ht(Ee,ne,ae,xe,re),this.tileCoords.push({z:ne,x:ae,y:xe}),Ce)){Ce>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ne,ae,xe,ut.numFeatures,ut.numPoints,ut.numSimplified),console.timeEnd("creation"));var Dn="z"+ne;this.stats[Dn]=(this.stats[Dn]||0)+1,this.total++}if(ut.source=Ee,Me){if(ne===re.maxZoom||ne===Me)continue;var cn=1<<Me-ne;if(ae!==Math.floor(ze/cn)||xe!==Math.floor(fe/cn))continue}else if(ne===re.indexMaxZoom||ut.numPoints<=re.indexMaxPoints)continue;if(ut.source=null,0!==Ee.length){Ce>1&&console.time("clipping");var gn,Fn,Ve,Ne,ge,$e,dt=.5*re.buffer/re.extent,on=.5-dt,_n=.5+dt,Tn=1+dt;gn=Fn=Ve=Ne=null,ge=Wi(Ee,je,ae-dt,ae+_n,0,ut.minX,ut.maxX,re),$e=Wi(Ee,je,ae+on,ae+Tn,0,ut.minX,ut.maxX,re),Ee=null,ge&&(gn=Wi(ge,je,xe-dt,xe+_n,1,ut.minY,ut.maxY,re),Fn=Wi(ge,je,xe+on,xe+Tn,1,ut.minY,ut.maxY,re),ge=null),$e&&(Ve=Wi($e,je,xe-dt,xe+_n,1,ut.minY,ut.maxY,re),Ne=Wi($e,je,xe+on,xe+Tn,1,ut.minY,ut.maxY,re),$e=null),Ce>1&&console.timeEnd("clipping"),oe.push(gn||[],ne+1,2*ae,2*xe),oe.push(Fn||[],ne+1,2*ae,2*xe+1),oe.push(Ve||[],ne+1,2*ae+1,2*xe),oe.push(Ne||[],ne+1,2*ae+1,2*xe+1)}}},Yi.prototype.getTile=function(Ee,ne,ae){var xe=this.options,Me=xe.extent,ze=xe.debug;if(Ee<0||Ee>24)return null;var fe=1<<Ee,oe=Wr(Ee,ne=(ne%fe+fe)%fe,ae);if(this.tiles[oe])return Zi(this.tiles[oe],Me);ze>1&&console.log("drilling down to z%d-%d-%d",Ee,ne,ae);for(var re,Ce=Ee,je=ne,Ye=ae;!re&&Ce>0;)Ce--,je=Math.floor(je/2),Ye=Math.floor(Ye/2),re=this.tiles[Wr(Ce,je,Ye)];return re&&re.source?(ze>1&&console.log("found parent tile z%d-%d-%d",Ce,je,Ye),ze>1&&console.time("drilling down"),this.splitTile(re.source,Ce,je,Ye,Ee,ne,ae),ze>1&&console.timeEnd("drilling down"),this.tiles[oe]?Zi(this.tiles[oe],Me):null):null};class cr extends c.VectorTileWorkerSource{constructor(ne,ae,xe,Me,ze){super(ne,ae,xe,Me,vi),ze&&(this.loadGeoJSON=ze)}loadData(ne,ae){const xe=ne&&ne.request,Me=xe&&xe.collectResourceTiming;this.loadGeoJSON(ne,(ze,fe)=>{if(ze||!fe)return ae(ze);if("object"!=typeof fe)return ae(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));{_t(fe,!0);try{if(ne.filter){const re=c.createExpression(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===re.result)throw new Error(re.value.map(je=>`${je.key}: ${je.message}`).join(", "));fe={type:"FeatureCollection",features:fe.features.filter(je=>re.value.evaluate({zoom:0},je))}}this._geoJSONIndex=ne.cluster?new Dt(function({superclusterOptions:re,clusterProperties:Ce}){if(!Ce||!re)return re;const je={},Ye={},ut={accumulated:null,zoom:0},Dn={properties:null},cn=Object.keys(Ce);for(const gn of cn){const[Fn,Ve]=Ce[gn],Ne=c.createExpression(Ve),ge=c.createExpression("string"==typeof Fn?[Fn,["accumulated"],["get",gn]]:Fn);je[gn]=Ne.value,Ye[gn]=ge.value}return re.map=gn=>{Dn.properties=gn;const Fn={};for(const Ve of cn)Fn[Ve]=je[Ve].evaluate(ut,Dn);return Fn},re.reduce=(gn,Fn)=>{Dn.properties=Fn;for(const Ve of cn)ut.accumulated=gn[Ve],gn[Ve]=Ye[Ve].evaluate(ut,Dn)},re}(ne)).load(fe.features):new Yi(re=fe,ne.geojsonVtOptions)}catch(re){return ae(re)}this.loaded={};const oe={};if(Me){const re=c.getPerformanceMeasurement(xe);re&&(oe.resourceTiming={},oe.resourceTiming[ne.source]=JSON.parse(JSON.stringify(re)))}ae(null,oe)}var re})}reloadTile(ne,ae){const xe=this.loaded;return xe&&xe[ne.uid]?super.reloadTile(ne,ae):this.loadTile(ne,ae)}loadGeoJSON(ne,ae){if(ne.request)c.getJSON(ne.request,ae);else{if("string"!=typeof ne.data)return ae(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));try{return ae(null,JSON.parse(ne.data))}catch{return ae(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(ne,ae){try{ae(null,this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId))}catch(xe){ae(xe)}}getClusterChildren(ne,ae){try{ae(null,this._geoJSONIndex.getChildren(ne.clusterId))}catch(xe){ae(xe)}}getClusterLeaves(ne,ae){try{ae(null,this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset))}catch(xe){ae(xe)}}}class Ji{constructor(ne){this.self=ne,this.actor=new c.Actor(ne,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=c.getProjection({name:"mercator"}),this.workerSourceTypes={vector:c.VectorTileWorkerSource,geojson:cr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(ae,xe)=>{if(this.workerSourceTypes[ae])throw new Error(`Worker source with name "${ae}" already registered.`);this.workerSourceTypes[ae]=xe},this.self.registerRTLTextPlugin=ae=>{if(c.plugin.isParsed())throw new Error("RTL text plugin already registered.");c.plugin.applyArabicShaping=ae.applyArabicShaping,c.plugin.processBidirectionalText=ae.processBidirectionalText,c.plugin.processStyledBidirectionalText=ae.processStyledBidirectionalText}}clearCaches(ne,ae,xe){delete this.layerIndexes[ne],delete this.availableImages[ne],delete this.workerSources[ne],delete this.demWorkerSources[ne],xe()}checkIfReady(ne,ae,xe){xe()}setReferrer(ne,ae){this.referrer=ae}spriteLoaded(ne,ae){this.isSpriteLoaded[ne]=ae;for(const xe in this.workerSources[ne]){const Me=this.workerSources[ne][xe];for(const ze in Me)Me[ze]instanceof c.VectorTileWorkerSource&&(Me[ze].isSpriteLoaded=ae,Me[ze].fire(new c.Event("isSpriteLoaded")))}}setImages(ne,ae,xe){this.availableImages[ne]=ae;for(const Me in this.workerSources[ne]){const ze=this.workerSources[ne][Me];for(const fe in ze)ze[fe].availableImages=ae}xe()}enableTerrain(ne,ae,xe){this.terrain=ae,xe()}setProjection(ne,ae){this.projections[ne]=c.getProjection(ae)}setLayers(ne,ae,xe){this.getLayerIndex(ne).replace(ae),xe()}updateLayers(ne,ae,xe){this.getLayerIndex(ne).update(ae.layers,ae.removedIds),xe()}loadTile(ne,ae,xe){const Me=this.enableTerrain?c.extend({enableTerrain:this.terrain},ae):ae;Me.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,ae.type,ae.source).loadTile(Me,xe)}loadDEMTile(ne,ae,xe){const Me=this.enableTerrain?c.extend({buildQuadTree:this.terrain},ae):ae;this.getDEMWorkerSource(ne,ae.source).loadTile(Me,xe)}reloadTile(ne,ae,xe){const Me=this.enableTerrain?c.extend({enableTerrain:this.terrain},ae):ae;Me.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,ae.type,ae.source).reloadTile(Me,xe)}abortTile(ne,ae,xe){this.getWorkerSource(ne,ae.type,ae.source).abortTile(ae,xe)}removeTile(ne,ae,xe){this.getWorkerSource(ne,ae.type,ae.source).removeTile(ae,xe)}removeSource(ne,ae,xe){if(!this.workerSources[ne]||!this.workerSources[ne][ae.type]||!this.workerSources[ne][ae.type][ae.source])return;const Me=this.workerSources[ne][ae.type][ae.source];delete this.workerSources[ne][ae.type][ae.source],void 0!==Me.removeSource?Me.removeSource(ae,xe):xe()}loadWorkerSource(ne,ae,xe){try{this.self.importScripts(ae.url),xe()}catch(Me){xe(Me.toString())}}syncRTLPluginState(ne,ae,xe){try{c.plugin.setState(ae);const Me=c.plugin.getPluginURL();if(c.plugin.isLoaded()&&!c.plugin.isParsed()&&null!=Me){this.self.importScripts(Me);const ze=c.plugin.isParsed();xe(ze?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Me}`),ze)}}catch(Me){xe(Me.toString())}}getAvailableImages(ne){let ae=this.availableImages[ne];return ae||(ae=[]),ae}getLayerIndex(ne){let ae=this.layerIndexes[ne];return ae||(ae=this.layerIndexes[ne]=new xt),ae}getWorkerSource(ne,ae,xe){return this.workerSources[ne]||(this.workerSources[ne]={}),this.workerSources[ne][ae]||(this.workerSources[ne][ae]={}),this.workerSources[ne][ae][xe]||(this.workerSources[ne][ae][xe]=new this.workerSourceTypes[ae]({send:(ze,fe,oe,re,Ce,je)=>{this.actor.send(ze,fe,oe,ne,Ce,je)},scheduler:this.actor.scheduler},this.getLayerIndex(ne),this.getAvailableImages(ne),this.isSpriteLoaded[ne])),this.workerSources[ne][ae][xe]}getDEMWorkerSource(ne,ae){return this.demWorkerSources[ne]||(this.demWorkerSources[ne]={}),this.demWorkerSources[ne][ae]||(this.demWorkerSources[ne][ae]=new Tt),this.demWorkerSources[ne][ae]}enforceCacheSizeLimit(ne,ae){c.enforceCacheSizeLimit(ae)}getWorkerPerformanceMetrics(ne,ae,xe){xe(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ji(self)),Ji}),W(0,function(c){function Re(h,i){if(Array.isArray(h)){if(!Array.isArray(i)||h.length!==i.length)return!1;for(let l=0;l<h.length;l++)if(!Re(h[l],i[l]))return!1;return!0}if("object"==typeof h&&null!==h&&null!==i){if("object"!=typeof i||Object.keys(h).length!==Object.keys(i).length)return!1;for(const l in h)if(!Re(h[l],i[l]))return!1;return!0}return h===i}var nn=xt;function xt(h){return i=h,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var p,w,C=new Blob([""],{type:"text/javascript"}),P=URL.createObjectURL(C);try{w=new Worker(P),p=!0}catch{p=!1}return w&&w.terminate(),URL.revokeObjectURL(P),p}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var p=document.createElement("canvas");p.width=p.height=1;var w=p.getContext("2d");if(!w)return!1;var C=w.getImageData(0,0,1,1);return C&&C.width===p.width}()||(void 0===Tt[l=i&&i.failIfMajorPerformanceCaveat]&&(Tt[l]=function(p){var w,P,m,y,C=(P=p,m=document.createElement("canvas"),(y=Object.create(xt.webGLContextAttributes)).failIfMajorPerformanceCaveat=P,m.getContext("webgl",y)||m.getContext("experimental-webgl",y));if(!C)return!1;try{w=C.createShader(C.VERTEX_SHADER)}catch{return!1}return!(!w||C.isContextLost())&&(C.shaderSource(w,"void main() {}"),C.compileShader(w),!0===C.getShaderParameter(w,C.COMPILE_STATUS))}(l)),!Tt[l]||document.documentMode));var i,l}var Tt={};function Et(h,i,l){const p=c.window.document.createElement(h);return void 0!==i&&(p.className=i),l&&l.appendChild(p),p}function At(h,i,l){const p=c.window.document.createElementNS("http://www.w3.org/2000/svg",h);for(const w of Object.keys(i))p.setAttributeNS(null,w,i[w]);return l&&l.appendChild(p),p}xt.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const _t=c.window.document&&c.window.document.documentElement.style,Qt=_t&&void 0!==_t.userSelect?"userSelect":"WebkitUserSelect";let An;function It(){_t&&Qt&&(An=_t[Qt],_t[Qt]="none")}function bn(){_t&&Qt&&(_t[Qt]=An)}function Yt(h){h.preventDefault(),h.stopPropagation(),c.window.removeEventListener("click",Yt,!0)}function Nn(){c.window.addEventListener("click",Yt,!0),c.window.setTimeout(()=>{c.window.removeEventListener("click",Yt,!0)},0)}function pn(h,i){const l=h.getBoundingClientRect();return Pt(h,l,i)}function rn(h,i){const l=h.getBoundingClientRect(),p=[];for(let w=0;w<i.length;w++)p.push(Pt(h,l,i[w]));return p}function an(h){return void 0!==c.window.InstallTrigger&&2===h.button&&h.ctrlKey&&c.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button}function Pt(h,i,l){const p=h.offsetWidth===i.width?1:h.offsetWidth/i.width;return new c.Point((l.clientX-i.left)*p,(l.clientY-i.top)*p)}function Se(h,i){var l=i[0],p=i[1],w=i[2],C=i[3],P=l*C-w*p;return P?(h[0]=C*(P=1/P),h[1]=-p*P,h[2]=-w*P,h[3]=l*P,h):null}function fn(h){const{userImage:i}=h;return!!(i&&i.render&&i.render())&&(h.data.replace(new Uint8Array(i.data.buffer)),!0)}class Zn extends c.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new c.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:l,callback:p}of this.requestors)this._notify(l,p);this.requestors=[]}}hasImage(i){return!!this.getImage(i)}getImage(i){return this.images[i]}addImage(i,l){this._validate(i,l)&&(this.images[i]=l)}_validate(i,l){let p=!0;return this._validateStretch(l.stretchX,l.data&&l.data.width)||(this.fire(new c.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),p=!1),this._validateStretch(l.stretchY,l.data&&l.data.height)||(this.fire(new c.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),p=!1),this._validateContent(l.content,l)||(this.fire(new c.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),p=!1),p}_validateStretch(i,l){if(!i)return!0;let p=0;for(const w of i){if(w[0]<p||w[1]<w[0]||l<w[1])return!1;p=w[1]}return!0}_validateContent(i,l){return!(i&&(4!==i.length||i[0]<0||l.data.width<i[0]||i[1]<0||l.data.height<i[1]||i[2]<0||l.data.width<i[2]||i[3]<0||l.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,l){l.version=this.images[i].version+1,this.images[i]=l,this.updatedImages[i]=!0}removeImage(i){const l=this.images[i];delete this.images[i],delete this.patterns[i],l.userImage&&l.userImage.onRemove&&l.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,l){let p=!0;if(!this.isLoaded())for(const w of i)this.images[w]||(p=!1);this.isLoaded()||p?this._notify(i,l):this.requestors.push({ids:i,callback:l})}_notify(i,l){const p={};for(const w of i){this.images[w]||this.fire(new c.Event("styleimagemissing",{id:w}));const C=this.images[w];C?p[w]={data:C.data.clone(),pixelRatio:C.pixelRatio,sdf:C.sdf,version:C.version,stretchX:C.stretchX,stretchY:C.stretchY,content:C.content,hasRenderCallback:Boolean(C.userImage&&C.userImage.render)}:c.warnOnce(`Image "${w}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}l(null,p)}getPixelSize(){const{width:i,height:l}=this.atlasImage;return{width:i,height:l}}getPattern(i){const l=this.patterns[i],p=this.getImage(i);if(!p)return null;if(l&&l.position.version===p.version)return l.position;if(l)l.position.version=p.version;else{const w={w:p.data.width+2,h:p.data.height+2,x:0,y:0},C=new c.ImagePosition(w,p);this.patterns[i]={bin:w,position:C}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const l=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new c.Texture(i,this.atlasImage,l.RGBA),this.atlasTexture&&this.atlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const C in this.patterns)i.push(this.patterns[C].bin);const{w:l,h:p}=c.potpack(i),w=this.atlasImage;w.resize({width:l||1,height:p||1});for(const C in this.patterns){const{bin:P}=this.patterns[C],m=P.x+1,y=P.y+1,_=this.images[C].data,T=_.width,M=_.height;c.RGBAImage.copy(_,w,{x:0,y:0},{x:m,y},{width:T,height:M}),c.RGBAImage.copy(_,w,{x:0,y:M-1},{x:m,y:y-1},{width:T,height:1}),c.RGBAImage.copy(_,w,{x:0,y:0},{x:m,y:y+M},{width:T,height:1}),c.RGBAImage.copy(_,w,{x:T-1,y:0},{x:m-1,y},{width:1,height:M}),c.RGBAImage.copy(_,w,{x:0,y:0},{x:m+T,y},{width:1,height:M})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const l of i){if(this.callbackDispatchedThisFrame[l])continue;this.callbackDispatchedThisFrame[l]=!0;const p=this.images[l];fn(p)&&this.updateImage(l,p)}}}const tt=new c.Properties({anchor:new c.DataConstantProperty(c.spec.light.anchor),position:new class{constructor(){this.specification=c.spec.light.position}possiblyEvaluate(h,i){return function([l,p,w]){const C=c.degToRad(p+90),P=c.degToRad(w);return{x:l*Math.cos(C)*Math.sin(P),y:l*Math.sin(C)*Math.sin(P),z:l*Math.cos(P),azimuthal:p,polar:w}}(h.expression.evaluate(i))}interpolate(h,i,l){return{x:c.number(h.x,i.x,l),y:c.number(h.y,i.y,l),z:c.number(h.z,i.z,l),azimuthal:c.number(h.azimuthal,i.azimuthal,l),polar:c.number(h.polar,i.polar,l)}}},color:new c.DataConstantProperty(c.spec.light.color),intensity:new c.DataConstantProperty(c.spec.light.intensity)});class kt extends c.Evented{constructor(i){super(),this._transitionable=new c.Transitionable(tt),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,l={}){if(!this._validate(c.validateLight,i,l))for(const p in i){const w=i[p];c.endsWith(p,"-transition")?this._transitionable.setTransition(p.slice(0,-11),w):this._transitionable.setValue(p,w)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,l,p){return(!p||!1!==p.validate)&&c.emitValidationErrors(this,i.call(c.validateStyle,c.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}const pt=new c.Properties({source:new c.DataConstantProperty(c.spec.terrain.source),exaggeration:new c.DataConstantProperty(c.spec.terrain.exaggeration)});let zt=class extends c.Evented{constructor(h,i){super(),this._transitionable=new c.Transitionable(pt),this.set(h),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i}get(){return this._transitionable.serialize()}set(h){for(const i in h){const l=h[i];c.endsWith(i,"-transition")?this._transitionable.setTransition(i.slice(0,-11),l):this._transitionable.setValue(i,l)}}updateTransitions(h){this._transitioning=this._transitionable.transitioned(h,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(h){this.properties=this._transitioning.possiblyEvaluate(h)}};function En(h,i,l,p){const w=c.smoothstep(45,65,l),[C,P]=yi(h,p),m=c.length(i);let y=1-Math.min(1,Math.exp((m-C)/(P-C)*-6));return y*=y*y,y=Math.min(1,1.00747*y),y*w*h.alpha}function yi(h,i){const l=.5/Math.tan(.5*i);return[h.range[0]+l,h.range[1]+l]}const Mt=new c.Properties({range:new c.DataConstantProperty(c.spec.fog.range),color:new c.DataConstantProperty(c.spec.fog.color),"high-color":new c.DataConstantProperty(c.spec.fog["high-color"]),"space-color":new c.DataConstantProperty(c.spec.fog["space-color"]),"horizon-blend":new c.DataConstantProperty(c.spec.fog["horizon-blend"]),"star-intensity":new c.DataConstantProperty(c.spec.fog["star-intensity"])});class Bi extends c.Evented{constructor(i,l){super(),this._transitionable=new c.Transitionable(Mt),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=l}get state(){const i=this._transform,l="globe"===i.projection.name,p=c.globeToMercatorTransition(i.zoom),w=this.properties.get("range"),C=[.5,3];return{range:l?[c.number(C[0],w[0],p),c.number(C[1],w[1],p)]:w,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,l={}){if(!this._validate(c.validateFog,i,l)){for(const p of Object.keys(c.spec.fog))i&&void 0===i[p]&&(i[p]=c.spec.fog[p].default);for(const p in i){const w=i[p];c.endsWith(p,"-transition")?this._transitionable.setTransition(p.slice(0,-11),w):this._transitionable.setValue(p,w)}}}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const l=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:c.smoothstep(45,65,i))*l.a}getOpacityAtLatLng(i,l){return this._transform.projection.supportsFog?function(p,w,C){const P=c.MercatorCoordinate.fromLngLat(w),m=C.elevation?C.elevation.getAtPointOrZero(P):0,y=[P.x,P.y,m];return c.transformMat4(y,y,C.mercatorFogMatrix),En(p,y,C.pitch,C._fov)}(this.state,i,l):0}getFovAdjustedRange(i){return this._transform.projection.supportsFog?yi(this.state,i):[0,1]}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,l,p){return(!p||!1!==p.validate)&&c.emitValidationErrors(this,i.call(c.validateStyle,c.extend({value:l,style:{glyphs:!0,sprite:!0},styleSpec:c.spec})))}}class qe{constructor(i,l){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=c.uniqueId();const p=this.workerPool.acquire(this.id);for(let w=0;w<p.length;w++){const C=new qe.Actor(p[w],l,this.id);C.name=`Worker ${w}`,this.actors.push(C)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,l,p){c.asyncAll(this.actors,(w,C)=>{w.send(i,l,C)},p=p||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function at(h,i,l){return i*(c.EXTENT/(h.tileSize*Math.pow(2,l-h.tileID.overscaledZ)))}qe.Actor=c.Actor;class bt{constructor(i,l,p,w){this.screenBounds=i,this.cameraPoint=l,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=p,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,w)}static createFromScreenPoints(i,l){let p,w;if(i instanceof c.Point||"number"==typeof i[0]){const C=c.Point.convert(i);p=[C],w=l.isPointAboveHorizon(C)}else{const C=c.Point.convert(i[0]),P=c.Point.convert(i[1]);p=[C,P],w=c.polygonizeBounds(C,P).every(m=>l.isPointAboveHorizon(m))}return new bt(p,l.getCameraPoint(),w,l)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(i){return c.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const l=this.screenBounds[0],p=1===this.screenBounds.length?this.screenBounds[0].add(new c.Point(1,1)):this.screenBounds[1],w=c.polygonizeBounds(l,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>l.x&&this.cameraPoint.x<p.x?w.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?w[2]=this.cameraPoint:this.cameraPoint.x<=l.x&&(w[3]=this.cameraPoint)),c.bufferConvexPolygon(w,i)}bufferedCameraGeometryGlobe(i){const l=this.screenBounds[0],p=1===this.screenBounds.length?this.screenBounds[0].add(new c.Point(1,1)):this.screenBounds[1],w=c.polygonizeBounds(l,p,i),C=this.cameraPoint.clone();switch(3*((C.y>l.y)+(C.y>p.y))+((C.x>l.x)+(C.x>p.x))){case 0:w[0]=C,w[4]=C.clone();break;case 1:w.splice(1,0,C);break;case 2:w[1]=C;break;case 3:w.splice(4,0,C);break;case 5:w.splice(2,0,C);break;case 6:w[3]=C;break;case 7:w.splice(3,0,C);break;case 8:w[2]=C}return w}containsTile(i,l,p,w=0){const C=i.queryPadding/l._pixelsPerMercatorPixel+1,P=p?this._bufferedCameraMercator(C,l):this._bufferedScreenMercator(C,l);let m=i.tileID.wrap+(P.unwrapped?w:0);const y=P.polygon.map(le=>c.getTilePoint(i.tileTransform,le,m));if(!c.polygonIntersectsBox(y,0,0,c.EXTENT,c.EXTENT))return;m=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?w:0);const _=this.screenGeometryMercator.polygon.map(le=>c.getTileVec3(i.tileTransform,le,m)),T=_.map(le=>new c.Point(le[0],le[1])),M=l.getFreeCameraOptions().position||new c.MercatorCoordinate(0,0,0),F=c.getTileVec3(i.tileTransform,M,m),U=_.map(le=>{const Z=c.sub(le,le,F);return c.normalize(Z,Z),new c.Ray(F,Z)}),K=at(i,1,l.zoom)*l._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:T,tilespaceRays:U,bufferedTilespaceGeometry:y,bufferedTilespaceBounds:(ee=c.getBounds(y),ee.min.x=c.clamp(ee.min.x,0,c.EXTENT),ee.min.y=c.clamp(ee.min.y,0,c.EXTENT),ee.max.x=c.clamp(ee.max.x,0,c.EXTENT),ee.max.y=c.clamp(ee.max.y,0,c.EXTENT),ee),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:K};var ee}_bufferedScreenMercator(i,l){const p=Ot(i);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let w;return w="globe"===l.projection.name?this._projectAndResample(this.bufferedScreenGeometry(i),l):{polygon:this.bufferedScreenGeometry(i).map(C=>l.pointCoordinate3D(C)),unwrapped:!0},this._screenRaycastCache[p]=w,w}}_bufferedCameraMercator(i,l){const p=Ot(i);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let w;return w="globe"===l.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),l):{polygon:this.bufferedCameraGeometry(i).map(C=>l.pointCoordinate3D(C)),unwrapped:!0},this._cameraRaycastCache[p]=w,w}}_projectAndResample(i,l){const p=function(C,P){const m=c.multiply([],P.pixelMatrix,P.globeMatrix),y=[0,-c.GLOBE_RADIUS,0,1],_=[0,c.GLOBE_RADIUS,0,1],T=[0,0,0,1];c.transformMat4$1(y,y,m),c.transformMat4$1(_,_,m),c.transformMat4$1(T,T,m);const M=new c.Point(y[0]/y[3],y[1]/y[3]),F=new c.Point(_[0]/_[3],_[1]/_[3]),U=c.polygonContainsPoint(C,M)&&y[3]<T[3],K=c.polygonContainsPoint(C,F)&&_[3]<T[3];if(!U&&!K)return null;const ee=function(Pe,Ze,He){for(let nt=1;nt<Pe.length;nt++){const Gt=Ut(Ze.pointCoordinate3D(Pe[nt-1]).x),Je=Ut(Ze.pointCoordinate3D(Pe[nt]).x);if(He<0){if(Gt<Je)return{idx:nt,t:-Gt/(Je-1-Gt)}}else if(Je<Gt)return{idx:nt,t:(1-Gt)/(Je+1-Gt)}}return null}(C,P,U?-1:1);if(!ee)return null;const{idx:le,t:Z}=ee;let ce=le>1?Dt(C.slice(0,le),P):[],_e=le<C.length?Dt(C.slice(le),P):[];ce=ce.map(Pe=>new c.Point(Ut(Pe.x),Pe.y)),_e=_e.map(Pe=>new c.Point(Ut(Pe.x),Pe.y));const we=[...ce];0===we.length&&we.push(_e[_e.length-1]);const ke=c.number(we[we.length-1].y,(0===_e.length?ce[0]:_e[0]).y,Z);let Be;return Be=U?[new c.Point(0,ke),new c.Point(0,0),new c.Point(1,0),new c.Point(1,ke)]:[new c.Point(1,ke),new c.Point(1,1),new c.Point(0,1),new c.Point(0,ke)],we.push(...Be),0===_e.length?we.push(ce[0]):we.push(..._e),{polygon:we.map(Pe=>new c.MercatorCoordinate(Pe.x,Pe.y)),unwrapped:!1}}(i,l);if(p)return p;const w=function(C,P){let m=!1,y=-1/0,_=0;for(let M=0;M<C.length-1;M++)C[M].x>y&&(y=C[M].x,_=M);for(let M=0;M<C.length-1;M++){const F=(_+M)%(C.length-1),U=C[F],K=C[F+1];Math.abs(U.x-K.x)>.5&&(U.x<K.x?(U.x+=1,0===F&&(C[C.length-1].x+=1)):(K.x+=1,F+1===C.length-1&&(C[0].x+=1)),m=!0)}const T=c.mercatorXfromLng(P.center.lng);return m&&T<Math.abs(T-1)&&C.forEach(M=>{M.x-=1}),{polygon:C,unwrapped:m}}(Dt(i,l).map(C=>new c.Point(Ut(C.x),C.y)),l);return{polygon:w.polygon.map(C=>new c.MercatorCoordinate(C.x,C.y)),unwrapped:w.unwrapped}}}function Dt(h,i){return c.resample(h,l=>{const p=i.pointCoordinate3D(l);l.x=p.x,l.y=p.y},1/256)}function Ut(h){return h<0?1+h%1:h%1}function Ot(h){return 100*h|0}function On(h,i,l,p,w){const C=function(P,m){if(P)return w(P);if(m){h.url&&m.tiles&&h.tiles&&delete h.tiles;const y=c.pick(c.extend(m,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);m.vector_layers&&(y.vectorLayers=m.vector_layers,y.vectorLayerIds=y.vectorLayers.map(_=>_.id)),y.tiles=i.canonicalizeTileset(y,h.url),w(null,y)}};return h.url?c.getJSON(i.transformRequest(i.normalizeSourceURL(h.url,null,l,p),c.ResourceType.Source),C):c.exported.frame(()=>C(null,h))}class ei{constructor(i,l,p){this.bounds=c.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=l||0,this.maxzoom=p||24}validateBounds(i){return Array.isArray(i)&&4===i.length?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const l=Math.pow(2,i.z),p=Math.floor(c.mercatorXfromLng(this.bounds.getWest())*l),w=Math.floor(c.mercatorYfromLat(this.bounds.getNorth())*l),C=Math.ceil(c.mercatorXfromLng(this.bounds.getEast())*l),P=Math.ceil(c.mercatorYfromLat(this.bounds.getSouth())*l);return i.x>=p&&i.x<C&&i.y>=w&&i.y<P}}class ji{constructor(i,l,p){this.context=i;const w=i.gl;this.buffer=w.createBuffer(),this.dynamicDraw=Boolean(p),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const l=this.context.gl;this.context.unbindVAO(),this.bind(),l.bufferSubData(l.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ln={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Rn{constructor(i,l,p,w){this.length=l.length,this.attributes=p,this.itemSize=l.bytesPerElement,this.dynamicDraw=w,this.context=i;const C=i.gl;this.buffer=C.createBuffer(),i.bindVertexBuffer.set(this.buffer),C.bufferData(C.ARRAY_BUFFER,l.arrayBuffer,this.dynamicDraw?C.DYNAMIC_DRAW:C.STATIC_DRAW),this.dynamicDraw||l.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const l=this.context.gl;this.bind(),l.bufferSubData(l.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,l){for(let p=0;p<this.attributes.length;p++){const w=l.attributes[this.attributes[p].name];void 0!==w&&i.enableVertexAttribArray(w)}}setVertexAttribPointers(i,l,p){for(let w=0;w<this.attributes.length;w++){const C=this.attributes[w],P=l.attributes[C.name];void 0!==P&&i.vertexAttribPointer(P,C.components,i[ln[C.type]],!1,this.itemSize,C.offset+this.itemSize*(p||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class un{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Hn extends un{getDefault(){return c.Color.transparent}set(i){const l=this.current;(i.r!==l.r||i.g!==l.g||i.b!==l.b||i.a!==l.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class ui extends un{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class qn extends un{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class hi extends un{getDefault(){return[!0,!0,!0,!0]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Ht extends un{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class zi extends un{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class li extends un{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const l=this.current;(i.func!==l.func||i.ref!==l.ref||i.mask!==l.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Wi extends un{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class si extends un{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),this.current=i,this.dirty=!1}}class Wt extends un{getDefault(){return[0,1]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Ar extends un{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),this.current=i,this.dirty=!1}}class yr extends un{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class ni extends un{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.BLEND):l.disable(l.BLEND),this.current=i,this.dirty=!1}}class os extends un{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class lo extends un{getDefault(){return c.Color.transparent}set(i){const l=this.current;(i.r!==l.r||i.g!==l.g||i.b!==l.b||i.a!==l.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Vi extends un{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class zr extends un{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;i?l.enable(l.CULL_FACE):l.disable(l.CULL_FACE),this.current=i,this.dirty=!1}}class Zi extends un{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class jt extends un{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let ht,Hi=class extends un{getDefault(){return null}set(h){(h!==this.current||this.dirty)&&(this.gl.useProgram(h),this.current=h,this.dirty=!1)}};class Ri extends un{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Yi extends un{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const l=this.current;(i[0]!==l[0]||i[1]!==l[1]||i[2]!==l[2]||i[3]!==l[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Wr extends un{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindFramebuffer(l.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class vi extends un{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindRenderbuffer(l.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class cr extends un{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindTexture(l.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Ji extends un{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.bindBuffer(l.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Ee extends un{getDefault(){return null}set(i){const l=this.gl;l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class ne extends un{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class ae extends un{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class xe extends un{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Me extends un{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const l=this.gl;l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class ze extends un{constructor(i,l){super(i),this.context=i,this.parent=l}getDefault(){return null}}class fe extends ze{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class oe extends ze{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const l=this.gl;l.framebufferRenderbuffer(l.FRAMEBUFFER,this.attachment(),l.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class re extends oe{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ce{constructor(i,l,p,w){this.context=i,this.width=l,this.height=p;const C=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new fe(i,C),w&&(this.depthAttachment=new oe(i,C))}destroy(){const i=this.context.gl,l=this.colorAttachment.get();if(l&&i.deleteTexture(l),this.depthAttachment){const p=this.depthAttachment.get();p&&i.deleteRenderbuffer(p)}i.deleteFramebuffer(this.framebuffer)}}class je{constructor(i,l=!1){if(this.gl=i,this.isWebGL2=l,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),l){const p=i;this.extVertexArrayObject={createVertexArrayOES:p.createVertexArray.bind(i),deleteVertexArrayOES:p.deleteVertexArray.bind(i),bindVertexArrayOES:p.bindVertexArray.bind(i)}}this.clearColor=new Hn(this),this.clearDepth=new ui(this),this.clearStencil=new qn(this),this.colorMask=new hi(this),this.depthMask=new Ht(this),this.stencilMask=new zi(this),this.stencilFunc=new li(this),this.stencilOp=new Wi(this),this.stencilTest=new si(this),this.depthRange=new Wt(this),this.depthTest=new Ar(this),this.depthFunc=new yr(this),this.blend=new ni(this),this.blendFunc=new os(this),this.blendColor=new lo(this),this.blendEquation=new Vi(this),this.cullFace=new zr(this),this.cullFaceSide=new Zi(this),this.frontFace=new jt(this),this.program=new Hi(this),this.activeTexture=new Ri(this),this.viewport=new Yi(this),this.bindFramebuffer=new Wr(this),this.bindRenderbuffer=new vi(this),this.bindTexture=new cr(this),this.bindVertexBuffer=new Ji(this),this.bindElementBuffer=new Ee(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ne(this),this.pixelStoreUnpack=new ae(this),this.pixelStoreUnpackPremultiplyAlpha=new xe(this),this.pixelStoreUnpackFlipY=new Me(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),l||(this.extTextureHalfFloat=i.getExtension("OES_texture_half_float")),(l||this.extTextureHalfFloat&&i.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=l||i.getExtension("OES_standard_derivatives"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,l){return new ji(this,i,l)}createVertexBuffer(i,l,p){return new Rn(this,i,l,p)}createRenderbuffer(i,l,p){const w=this.gl,C=w.createRenderbuffer();return this.bindRenderbuffer.set(C),w.renderbufferStorage(w.RENDERBUFFER,i,l,p),this.bindRenderbuffer.set(null),C}createFramebuffer(i,l,p){return new Ce(this,i,l,p)}clear({color:i,depth:l,stencil:p}){const w=this.gl;let C=0;i&&(C|=w.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),void 0!==l&&(C|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(l),this.depthMask.set(!0)),void 0!==p&&(C|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),w.clear(C)}setCullFace(i){!1===i.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){Re(i.blendFunction,c.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Ye extends c.Evented{constructor(i,l,p,w){if(super(),this.id=i,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,c.extend(this,c.pick(l,["url","scheme","tileSize","promoteId"])),this._options=c.extend({type:"vector"},l),this._collectResourceTiming=l.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w),this._tileWorkers={},this._deduped=new c.DedupedRequest}load(i){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"}));const l=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map._worldview;this._tileJSONRequest=On(this._options,this.map._requestManager,l,p,(w,C)=>{this._tileJSONRequest=null,this._loaded=!0,w?(l&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${l}`),p&&2!==p.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new c.ErrorEvent(w))):C&&(c.extend(this,C),C.bounds&&(this.tileBounds=new ei(C.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(C.tiles,this.map._requestManager._customAccessToken),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))),i&&i(w)})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return c.extend({},this._options)}loadTile(i,l){const p=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(p,c.ResourceType.Tile),data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile};if(w.request.collectResourceTiming=this._collectResourceTiming,i.actor&&"expired"!==i.state)"loading"===i.state?i.reloadCallback=l:i.request=i.actor.send("reloadTile",w,C.bind(this));else if(i.actor=this._tileWorkers[p]=this._tileWorkers[p]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",w,C.bind(this),void 0,!0);else{const P=c.loadVectorTile.call({deduped:this._deduped},w,(m,y)=>{m||!y?C.call(this,m):(w.data={cacheControl:y.cacheControl,expires:y.expires,rawData:y.rawData.slice(0)},i.actor&&i.actor.send("loadTile",w,C.bind(this),void 0,!0))},!0);i.request={cancel:P}}function C(P,m){return delete i.request,i.aborted?l(null):P&&404!==P.status?l(P):(m&&m.resourceTiming&&(i.resourceTiming=m.resourceTiming),this.map._refreshExpiredTiles&&m&&i.setExpiryData(m),i.loadVectorData(m,this.map.painter),c.cacheEntryPossiblyAdded(this.dispatcher),l(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id})}unloadTile(i){i.unloadVectorData(),i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ut extends c.Evented{constructor(i,l,p,w){super(),this.id=i,this.dispatcher=p,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=c.extend({type:"raster"},l),c.extend(this,c.pick(l,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=On(this._options,this.map._requestManager,null,null,(l,p)=>{this._tileJSONRequest=null,this._loaded=!0,l?this.fire(new c.ErrorEvent(l)):p&&(c.extend(this,p),p.bounds&&(this.tileBounds=new ei(p.bounds,this.minzoom,this.maxzoom)),c.postTurnstileEvent(p.tiles),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))),i&&i(l)})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return c.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,l){const p=c.exported.devicePixelRatio>=2,w=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);i.request=c.getImage(this.map._requestManager.transformRequest(w,c.ResourceType.Tile),(C,P,m,y)=>(delete i.request,i.aborted?(i.state="unloaded",l(null)):C?(i.state="errored",l(C)):P?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:m,expires:y}),i.setTexture(P,this.map.painter),i.state="loaded",c.cacheEntryPossiblyAdded(this.dispatcher),void l(null)):l(null)))}static loadTileData(i,l,p){i.setTexture(l,p)}static unloadTileData(i,l){i.texture&&l.saveTileTexture(i.texture)}abortTile(i,l){i.request&&(i.request.cancel(),delete i.request),l()}unloadTile(i,l){i.texture&&this.map.painter.saveTileTexture(i.texture),l()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function Dn(h,i,l,p,w,C,P,m){const y=[h,l,w,i,p,C,1,1,1],_=[P,m,1],T=c.adjoint([],y),[M,F,U]=c.transformMat3(_,_,c.transpose(T,T));return c.multiply$1(y,[M,0,0,0,F,0,0,0,U],y)}class cn extends c.Evented{constructor(i,l,p,w){super(),this.id=i,this.dispatcher=p,this.coordinates=l.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=l,this._dirty=!1}load(i,l){this._loaded=l||!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=c.getImage(this.map._requestManager.transformRequest(this.url,c.ResourceType.Image),(p,w)=>{if(this._imageRequest=null,this._loaded=!0,p)this.fire(new c.ErrorEvent(p));else if(w){const{HTMLImageElement:C}=c.window;this.image=w instanceof C?c.exported.getImageData(w):w,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading()}})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this._imageRequest&&i.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(i){this.coordinates=i,this._boundsArray=void 0;const l=i.map(c.MercatorCoordinate.fromLngLat);return this.tileID=function(p){let w=1/0,C=1/0,P=-1/0,m=-1/0;for(const M of p)w=Math.min(w,M.x),C=Math.min(C,M.y),P=Math.max(P,M.x),m=Math.max(m,M.y);const y=Math.max(P-w,m-C),_=Math.max(0,Math.floor(-Math.log(y)/Math.LN2)),T=Math.pow(2,_);return new c.CanonicalTileID(_,Math.floor((w+P)/2*T),Math.floor((C+m)/2*T))}(l),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(i){for(const y in this.tiles){const _=this.tiles[y];"loaded"!==_.state&&(_.state="loaded",_.texture=this.texture)}if(this._boundsArray)return;const l=c.tileTransform(this.tileID,this.map.transform.projection),[p,w,C,P]=this.coordinates.map(y=>{const _=l.projection.project(y[0],y[1]);return c.getTilePoint(l,_)._round()});this.perspectiveTransform=function(y,_,T,M,F,U,K,ee,le,Z){const ce=Dn(0,0,y,0,0,_,y,_),_e=Dn(T,M,F,U,K,ee,le,Z);return c.multiply$1(_e,c.adjoint(ce,ce),_e),[_e[6]/_e[8]*y/c.EXTENT,_e[7]/_e[8]*_/c.EXTENT]}(this.width,this.height,p.x,p.y,w.x,w.y,P.x,P.y,C.x,C.y);const m=this._boundsArray=new c.StructArrayLayout4i8;m.emplaceBack(p.x,p.y,0,0),m.emplaceBack(w.x,w.y,c.EXTENT,0),m.emplaceBack(P.x,P.y,0,c.EXTENT),m.emplaceBack(C.x,C.y,c.EXTENT,c.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=i.createVertexBuffer(m,c.boundsAttributes.members),this.boundsSegments=c.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const i=this.map.painter.context,l=i.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new c.Texture(i,this.image,l.RGBA),this.texture.bind(l.LINEAR,l.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(i)}loadTile(i,l){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},l(null)):(i.state="errored",l(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const gn={vector:Ye,raster:ut,"raster-dem":class extends ut{constructor(h,i,l,p){super(h,i,l,p),this.type="raster-dem",this.maxzoom=22,this._options=c.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(h,i){const l=this.map._requestManager.normalizeTileURL(h.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(w,C){w&&(h.state="errored",i(w)),C&&(h.dem=C,h.dem.onDeserialize(),h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0,h.state="loaded",i(null))}h.request=c.getImage(this.map._requestManager.transformRequest(l,c.ResourceType.Tile),function(w,C,P,m){if(delete h.request,h.aborted)h.state="unloaded",i(null);else if(w)h.state="errored",i(w);else if(C){this.map._refreshExpiredTiles&&h.setExpiryData({cacheControl:P,expires:m});const y=c.window.ImageBitmap&&C instanceof c.window.ImageBitmap&&(null==ht&&(ht=c.window.OffscreenCanvas&&new c.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof c.window.createImageBitmap),ht),_=1-(C.width-c.prevPowerOfTwo(C.width))/2;_<1||h.neighboringTiles||(h.neighboringTiles=this._getNeighboringTiles(h.tileID));const T=y?C:c.exported.getImageData(C,_),M={uid:h.uid,coord:h.tileID,source:this.id,rawImageData:T,encoding:this.encoding,padding:_};h.actor&&"expired"!==h.state||(h.actor=this.dispatcher.getActor(),h.actor.send("loadDEMTile",M,p.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(h){const i=h.canonical,l=Math.pow(2,i.z),p=(i.x-1+l)%l,w=0===i.x?h.wrap-1:h.wrap,C=(i.x+1+l)%l,P=i.x+1===l?h.wrap+1:h.wrap,m={};return m[new c.OverscaledTileID(h.overscaledZ,w,i.z,p,i.y).key]={backfilled:!1},m[new c.OverscaledTileID(h.overscaledZ,P,i.z,C,i.y).key]={backfilled:!1},i.y>0&&(m[new c.OverscaledTileID(h.overscaledZ,w,i.z,p,i.y-1).key]={backfilled:!1},m[new c.OverscaledTileID(h.overscaledZ,h.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},m[new c.OverscaledTileID(h.overscaledZ,P,i.z,C,i.y-1).key]={backfilled:!1}),i.y+1<l&&(m[new c.OverscaledTileID(h.overscaledZ,w,i.z,p,i.y+1).key]={backfilled:!1},m[new c.OverscaledTileID(h.overscaledZ,h.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},m[new c.OverscaledTileID(h.overscaledZ,P,i.z,C,i.y+1).key]={backfilled:!1}),m}unloadTile(h){h.demTexture&&this.map.painter.saveTileTexture(h.demTexture),h.fbo&&(h.fbo.destroy(),delete h.fbo),h.dem&&delete h.dem,delete h.neighboringTiles,h.state="unloaded"}},geojson:class extends c.Evented{constructor(h,i,l,p){super(),this.id=h,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=l.getActor(),this.setEventedParent(p),this._data=i.data,this._options=c.extend({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const w=c.EXTENT/this.tileSize;this.workerOptions=c.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*w,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*w,extent:c.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:c.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*w,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(h){this.map=h,this.setData(this._data)}setData(h){return this._data=h,this._updateWorkerData(),this}getClusterExpansionZoom(h,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:h,source:this.id},i),this}getClusterChildren(h,i){return this.actor.send("geojson.getClusterChildren",{clusterId:h,source:this.id},i),this}getClusterLeaves(h,i,l,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:h,limit:i,offset:l},p),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new c.Event("dataloading",{dataType:"source"})),this._loaded=!1;const h=c.extend({},this.workerOptions),i=this._data;"string"==typeof i?(h.request=this.map._requestManager.transformRequest(c.exported.resolveURL(i),c.ResourceType.Source),h.request.collectResourceTiming=this._collectResourceTiming):h.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,h,(l,p)=>{if(this._loaded=!0,this._pendingLoad=null,l)this.fire(new c.ErrorEvent(l));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&p&&p.resourceTiming&&p.resourceTiming[this.id]&&(w.resourceTiming=p.resourceTiming[this.id]),this.fire(new c.Event("data",w)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(h,i){const l=h.actor?"reloadTile":"loadTile";h.actor=this.actor,h.request=this.actor.send(l,{type:this.type,uid:h.uid,tileID:h.tileID,tileZoom:h.tileZoom,zoom:h.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:c.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(p,w)=>(delete h.request,h.unloadVectorData(),h.aborted?i(null):p?i(p):(h.loadVectorData(w,this.map.painter,"reloadTile"===l),i(null))),void 0,"loadTile"===l)}abortTile(h){h.request&&(h.request.cancel(),delete h.request),h.aborted=!0}unloadTile(h){h.unloadVectorData(),this.actor.send("removeTile",{uid:h.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return c.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends cn{constructor(h,i,l,p){super(h,i,l,p),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const h=this.options;this.urls=[];for(const i of h.urls)this.urls.push(this.map._requestManager.transformRequest(i,c.ResourceType.Source).url);c.getVideo(this.urls,(i,l)=>{this._loaded=!0,i?this.fire(new c.ErrorEvent(i)):l&&(this.video=l,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(h){if(this.video){const i=this.video.seekable;h<i.start(0)||h>i.end(0)?this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=h}}getVideo(){return this.video}onAdd(h){this.map||(this.map=h,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const h=this.map.painter.context,i=h.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new c.Texture(h,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(h)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:cn,canvas:class extends cn{constructor(h,i,l,p){super(h,i,l,p),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some(w=>!Array.isArray(w)||2!==w.length||w.some(C=>"number"!=typeof C))||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${h}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${h}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${h}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof c.window.HTMLCanvasElement||this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${h}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new c.ErrorEvent(new c.ValidationError(`sources.${h}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof c.window.HTMLCanvasElement?this.options.canvas:c.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new c.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(h){this.map=h,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let h=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,h=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,h=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?(h||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new c.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const h of[this.canvas.width,this.canvas.height])if(isNaN(h)||h<=0)return!0;return!1}},custom:class extends c.Evented{constructor(h,i,l,p){super(),this.id=h,this.type="custom",this._dataType="raster",this._dispatcher=l,this._implementation=i,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new c.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new c.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new ei(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),c.extend(this,c.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return c.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new c.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(h){this._map=h,this._loaded=!1,this.fire(new c.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(h),this.load()}onRemove(h){this._implementation.onRemove&&this._implementation.onRemove(h)}hasTile(h){if(this._implementation.hasTile){const{x:i,y:l,z:p}=h.canonical;return this._implementation.hasTile({x:i,y:l,z:p})}return!this.tileBounds||this.tileBounds.contains(h.canonical)}loadTile(h,i){const{x:l,y:p,z:w}=h.tileID.canonical,C=new c.window.AbortController;h.request=Promise.resolve(this._implementation.loadTile({x:l,y:p,z:w},{signal:C.signal})).then(function(P){return delete h.request,h.aborted?(h.state="unloaded",i(null)):void 0===P?(h.state="errored",i(null)):null===P?(this.loadTileData(h,{width:this.tileSize,height:this.tileSize,data:null}),h.state="loaded",i(null)):(m=P)instanceof c.window.ImageData||m instanceof c.window.HTMLCanvasElement||m instanceof c.window.ImageBitmap||m instanceof c.window.HTMLImageElement?(this.loadTileData(h,P),h.state="loaded",void i(null)):(h.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var m}.bind(this)).catch(P=>{20!==P.code&&(h.state="errored",i(P))}),h.request.cancel=()=>C.abort()}loadTileData(h,i){ut.loadTileData(h,i,this._map.painter)}unloadTileData(h){ut.unloadTileData(h,this._map.painter)}unloadTile(h,i){if(this.unloadTileData(h),this._implementation.unloadTile){const{x:l,y:p,z:w}=h.tileID.canonical;this._implementation.unloadTile({x:l,y:p,z:w})}i()}abortTile(h,i){h.request&&h.request.cancel&&(h.request.cancel(),delete h.request),i()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(h=>({x:h.canonical.x,y:h.canonical.y,z:h.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new c.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Fn=function(h,i,l,p){const w=new gn[i.type](h,i,l,p);if(w.id!==h)throw new Error(`Expected Source id to be ${h} instead of ${w.id}`);return c.bindAll(["load","abort","unload","serialize","prepare"],w),w};function Ve(h,i){const l=c.identity([]);return c.scale(l,l,[.5*h.width,.5*-h.height,1]),c.translate(l,l,[1,-1,0]),c.multiply(l,l,h.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(l)}function Ne(h,i,l,p,w,C,P,m=!1){const y=h.tilesIn(p,P,m);y.sort($e);const _=[];for(const M of y)_.push({wrappedTileID:M.tile.tileID.wrapped().key,queryResults:M.tile.queryRenderedFeatures(i,l,h._state,M,w,C,Ve(h.transform,M.tile.tileID),m)});const T=function(M){const F={},U={};for(const K of M){const ee=K.queryResults,le=K.wrappedTileID,Z=U[le]=U[le]||{};for(const ce in ee){const _e=ee[ce],we=Z[ce]=Z[ce]||{},ke=F[ce]=F[ce]||[];for(const Be of _e)we[Be.featureIndex]||(we[Be.featureIndex]=!0,ke.push(Be))}}return F}(_);for(const M in T)T[M].forEach(F=>{const U=F.feature,K=U.layer;K&&"background"!==K.type&&"sky"!==K.type&&(U.source=K.source,K["source-layer"]&&(U.sourceLayer=K["source-layer"]),U.state=void 0!==U.id?h.getFeatureState(K["source-layer"],U.id):{})});return T}function ge(h,i){const l=h.getRenderableIds().map(C=>h.getTileByID(C)),p=[],w={};for(let C=0;C<l.length;C++){const P=l[C],m=P.tileID.canonical.key;w[m]||(w[m]=!0,P.querySourceFeatures(p,i))}return p}function $e(h,i){const l=h.tileID,p=i.tileID;return l.overscaledZ-p.overscaledZ||l.canonical.y-p.canonical.y||l.wrap-p.wrap||l.canonical.x-p.canonical.x}function dt(){return null!=Bl.workerClass?new Bl.workerClass:new c.window.Worker(Bl.workerUrl)}const on="mapboxgl_preloaded_worker_pool";class _n{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<_n.workerCount;)this.workers.push(new dt);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],0===this.numActive()&&(this.workers.forEach(l=>{l.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[on]}numActive(){return Object.keys(this.active).length}}let Tn;function Ai(){return Tn||(Tn=new _n),Tn}function po(h,i){const l={};for(const p in h)"ref"!==p&&(l[p]=h[p]);return c.refProperties.forEach(p=>{p in i&&(l[p]=i[p])}),l}function Yr(h){h=h.slice();const i=Object.create(null);for(let l=0;l<h.length;l++)i[h[l].id]=h[l];for(let l=0;l<h.length;l++)"ref"in h[l]&&(h[l]=po(h[l],i[h[l].ref]));return h}_n.workerCount=2;const Cn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Co(h,i,l){l.push({command:Cn.addSource,args:[h,i[h]]})}function Do(h,i,l){i.push({command:Cn.removeSource,args:[h]}),l[h]=!0}function vs(h,i,l,p){Do(h,l,p),Co(h,i,l)}function ss(h,i,l){let p;for(p in h[l])if(h[l].hasOwnProperty(p)&&"data"!==p&&!Re(h[l][p],i[l][p]))return!1;for(p in i[l])if(i[l].hasOwnProperty(p)&&"data"!==p&&!Re(h[l][p],i[l][p]))return!1;return!0}function mo(h,i,l,p,w,C){let P;for(P in i=i||{},h=h||{})h.hasOwnProperty(P)&&(Re(h[P],i[P])||l.push({command:C,args:[p,P,i[P],w]}));for(P in i)i.hasOwnProperty(P)&&!h.hasOwnProperty(P)&&(Re(h[P],i[P])||l.push({command:C,args:[p,P,i[P],w]}))}function as(h){return h.id}function Ho(h,i){return h[i.id]=i,h}class Go{constructor(i,l){this.reset(i,l)}reset(i,l){this.points=i||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(l||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(1===this.points.length)return this.points[0];i=c.clamp(i,0,1);let l=1,p=this._distances[l];const w=i*this.paddedLength+this.padding;for(;p<w&&l<this._distances.length;)p=this._distances[++l];const C=l-1,P=this._distances[C],m=p-P,y=m>0?(w-P)/m:0;return this.points[C].mult(1-y).add(this.points[l].mult(y))}}class qo{constructor(i,l,p){const w=this.boxCells=[],C=this.circleCells=[];this.xCellCount=Math.ceil(i/p),this.yCellCount=Math.ceil(l/p);for(let P=0;P<this.xCellCount*this.yCellCount;P++)w.push([]),C.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=l,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/l,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,l,p,w,C){this._forEachCell(l,p,w,C,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(l),this.bboxes.push(p),this.bboxes.push(w),this.bboxes.push(C)}insertCircle(i,l,p,w){this._forEachCell(l-w,p-w,l+w,p+w,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(l),this.circles.push(p),this.circles.push(w)}_insertBoxCell(i,l,p,w,C,P){this.boxCells[C].push(P)}_insertCircleCell(i,l,p,w,C,P){this.circleCells[C].push(P)}_query(i,l,p,w,C,P){if(p<0||i>this.width||w<0||l>this.height)return!C&&[];const m=[];if(i<=0&&l<=0&&this.width<=p&&this.height<=w){if(C)return!0;for(let y=0;y<this.boxKeys.length;y++)m.push({key:this.boxKeys[y],x1:this.bboxes[4*y],y1:this.bboxes[4*y+1],x2:this.bboxes[4*y+2],y2:this.bboxes[4*y+3]});for(let y=0;y<this.circleKeys.length;y++){const _=this.circles[3*y],T=this.circles[3*y+1],M=this.circles[3*y+2];m.push({key:this.circleKeys[y],x1:_-M,y1:T-M,x2:_+M,y2:T+M})}return P?m.filter(P):m}return this._forEachCell(i,l,p,w,this._queryCell,m,{hitTest:C,seenUids:{box:{},circle:{}}},P),C?m.length>0:m}_queryCircle(i,l,p,w,C){const P=i-p,m=i+p,y=l-p,_=l+p;if(m<0||P>this.width||_<0||y>this.height)return!w&&[];const T=[];return this._forEachCell(P,y,m,_,this._queryCellCircle,T,{hitTest:w,circle:{x:i,y:l,radius:p},seenUids:{box:{},circle:{}}},C),w?T.length>0:T}query(i,l,p,w,C){return this._query(i,l,p,w,!1,C)}hitTest(i,l,p,w,C){return this._query(i,l,p,w,!0,C)}hitTestCircle(i,l,p,w){return this._queryCircle(i,l,p,!0,w)}_queryCell(i,l,p,w,C,P,m,y){const _=m.seenUids,T=this.boxCells[C];if(null!==T){const F=this.bboxes;for(const U of T)if(!_.box[U]){_.box[U]=!0;const K=4*U;if(i<=F[K+2]&&l<=F[K+3]&&p>=F[K+0]&&w>=F[K+1]&&(!y||y(this.boxKeys[U]))){if(m.hitTest)return P.push(!0),!0;P.push({key:this.boxKeys[U],x1:F[K],y1:F[K+1],x2:F[K+2],y2:F[K+3]})}}}const M=this.circleCells[C];if(null!==M){const F=this.circles;for(const U of M)if(!_.circle[U]){_.circle[U]=!0;const K=3*U;if(this._circleAndRectCollide(F[K],F[K+1],F[K+2],i,l,p,w)&&(!y||y(this.circleKeys[U]))){if(m.hitTest)return P.push(!0),!0;{const ee=F[K],le=F[K+1],Z=F[K+2];P.push({key:this.circleKeys[U],x1:ee-Z,y1:le-Z,x2:ee+Z,y2:le+Z})}}}}}_queryCellCircle(i,l,p,w,C,P,m,y){const _=m.circle,T=m.seenUids,M=this.boxCells[C];if(null!==M){const U=this.bboxes;for(const K of M)if(!T.box[K]){T.box[K]=!0;const ee=4*K;if(this._circleAndRectCollide(_.x,_.y,_.radius,U[ee+0],U[ee+1],U[ee+2],U[ee+3])&&(!y||y(this.boxKeys[K])))return P.push(!0),!0}}const F=this.circleCells[C];if(null!==F){const U=this.circles;for(const K of F)if(!T.circle[K]){T.circle[K]=!0;const ee=3*K;if(this._circlesCollide(U[ee],U[ee+1],U[ee+2],_.x,_.y,_.radius)&&(!y||y(this.circleKeys[K])))return P.push(!0),!0}}}_forEachCell(i,l,p,w,C,P,m,y){const _=this._convertToXCellCoord(i),T=this._convertToYCellCoord(l),M=this._convertToXCellCoord(p),F=this._convertToYCellCoord(w);for(let U=_;U<=M;U++)for(let K=T;K<=F;K++)if(C.call(this,i,l,p,w,this.xCellCount*K+U,P,m,y))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,l,p,w,C,P){const m=w-i,y=C-l,_=p+P;return _*_>m*m+y*y}_circleAndRectCollide(i,l,p,w,C,P,m){const y=(P-w)/2,_=Math.abs(i-(w+y));if(_>y+p)return!1;const T=(m-C)/2,M=Math.abs(l-(C+T));if(M>T+p)return!1;if(_<=y||M<=T)return!0;const F=_-y,U=M-T;return F*F+U*U<=p*p}}const go={unknown:0,flipRequired:1,flipNotRequired:2},$s=Math.tan(85*Math.PI/180);function ft(h,i,l,p,w,C,P){const m=c.create();if(l)if("globe"===C.name){const y=c.calculateGlobeLabelMatrix(w,i);c.multiply(m,m,y)}else{const y=Se([],P);m[0]=y[0],m[1]=y[1],m[4]=y[2],m[5]=y[3],p||c.rotateZ(m,m,w.angle)}else c.multiply(m,w.labelPlaneMatrix,h);return m}function ti(h,i,l,p,w,C,P){const m=ft(h,i,l,p,w,C,P);return"globe"===C.name&&l||(m[2]=m[6]=m[10]=m[14]=0),m}function ai(h,i,l,p,w,C,P){if(l){if("globe"===C.name){const m=ft(h,i,l,p,w,C,P);return c.invert(m,m),c.multiply(m,h,m),m}{const m=c.clone(h),y=c.identity([]);return y[0]=P[0],y[1]=P[1],y[4]=P[2],y[5]=P[3],c.multiply(m,m,y),p||c.rotateZ(m,m,-w.angle),m}}return w.glCoordMatrix}function bi(h,i,l,p){const w=[h,i,l,1];l?c.transformMat4$1(w,w,p):In(w,w,p);const C=w[3];return w[0]/=C,w[1]/=C,w[2]/=C,w}function ls(h,i){return Math.min(.5+h/i*.5,1.5)}function ir(h,i){const l=h[0]/h[3],p=h[1]/h[3];return l>=-i[0]&&l<=i[0]&&p>=-i[1]&&p<=i[1]}function Wo(h,i,l,p,w,C,P,m,y,_){const T=l.transform,M=p?h.textSizeData:h.iconSizeData,F=c.evaluateSizeForZoom(M,l.transform.zoom),U="globe"===T.projection.name,K=[256/l.width*2+1,256/l.height*2+1],ee=p?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;ee.clear();let le=null;U&&(le=p?h.text.globeExtVertexArray:h.icon.globeExtVertexArray);const Z=h.lineVertexArray,ce=p?h.text.placedSymbolArray:h.icon.placedSymbolArray,_e=l.transform.width/l.transform.height;let we,ke=!1;for(let Be=0;Be<ce.length;Be++){const Pe=ce.get(Be),{numGlyphs:Ze,writingMode:He}=Pe;if(He!==c.WritingMode.vertical||ke||we===c.WritingMode.horizontal||(ke=!0),we=He,(Pe.hidden||He===c.WritingMode.vertical)&&!ke){Qi(Ze,ee);continue}ke=!1;const nt=new c.Point(Pe.tileAnchorX,Pe.tileAnchorY);let{x:Gt,y:Je,z:wt}=T.projection.projectTilePoint(nt.x,nt.y,_.canonical);if(y){const[di,Pn,Kn]=y(nt);Gt+=di,Je+=Pn,wt+=Kn}const ct=[Gt,Je,wt,1];if(c.transformMat4$1(ct,ct,i),!ir(ct,K)){Qi(Ze,ee);continue}const $t=ls(l.transform.cameraToCenterDistance,ct[3]),it=c.evaluateSizeForFeature(M,F,Pe),vt=P?it/$t:it*$t,Vt=bi(Gt,Je,wt,w);if(Vt[3]<=0){Qi(Ze,ee);continue}let Rt={};const Kt=P?null:y,jn=tn(Pe,vt,!1,m,i,w,C,h.glyphOffsetArray,Z,ee,le,Vt,nt,Rt,_e,Kt,T.projection,_,P);ke=jn.useVertical,Kt&&jn.needsFlipping&&(Rt={}),(jn.notEnoughRoom||ke||jn.needsFlipping&&tn(Pe,vt,!0,m,i,w,C,h.glyphOffsetArray,Z,ee,le,Vt,nt,Rt,_e,Kt,T.projection,_,P).notEnoughRoom)&&Qi(Ze,ee)}p?(h.text.dynamicLayoutVertexBuffer.updateData(ee),le&&h.text.globeExtVertexBuffer.updateData(le)):(h.icon.dynamicLayoutVertexBuffer.updateData(ee),le&&h.icon.globeExtVertexBuffer.updateData(le))}function Po(h,i,l,p,w,C,P,m,y,_,T,M,F,U,K,ee){const{lineStartIndex:le,glyphStartIndex:Z,segment:ce}=m,_e=Z+m.numGlyphs,we=le+m.lineLength,ke=i.getoffsetX(Z),Be=i.getoffsetX(_e-1),Pe=Mi(h*ke,l,p,w,C,P,ce,le,we,y,_,T,M,F,!0,U,K,ee);if(!Pe)return null;const Ze=Mi(h*Be,l,p,w,C,P,ce,le,we,y,_,T,M,F,!0,U,K,ee);return Ze?{first:Pe,last:Ze}:null}function Zo(h,i,l,p){return h===c.WritingMode.horizontal&&Math.abs(p)>Math.abs(l)?{useVertical:!0}:h===c.WritingMode.vertical?p>0?{needsFlipping:!0}:null:i!==go.unknown&&(0===(w=l)||Math.abs(p/w)>$s)?i===go.flipRequired?{needsFlipping:!0}:null:l<0?{needsFlipping:!0}:null;var w}function tn(h,i,l,p,w,C,P,m,y,_,T,M,F,U,K,ee,le,Z,ce){const _e=i/24,we=h.lineOffsetX*_e,ke=h.lineOffsetY*_e,{lineStartIndex:Be,glyphStartIndex:Pe,numGlyphs:Ze,segment:He,writingMode:nt,flipState:Gt}=h,Je=Be+h.lineLength,wt=ct=>{if(T){const[Vt,Rt,Kt]=ct.up,jn=_.length;c.updateGlobeVertexNormal(T,jn+0,Vt,Rt,Kt),c.updateGlobeVertexNormal(T,jn+1,Vt,Rt,Kt),c.updateGlobeVertexNormal(T,jn+2,Vt,Rt,Kt),c.updateGlobeVertexNormal(T,jn+3,Vt,Rt,Kt)}const[$t,it,vt]=ct.point;c.addDynamicAttributes(_,$t,it,vt,ct.angle)};if(Ze>1){const ct=Po(_e,m,we,ke,l,M,F,h,y,C,U,ee,!1,le,Z,ce);if(!ct)return{notEnoughRoom:!0};if(p&&!l){let[$t,it,vt]=ct.first.point,[Vt,Rt,Kt]=ct.last.point;[$t,it]=bi($t,it,vt,P),[Vt,Rt]=bi(Vt,Rt,Kt,P);const jn=Zo(nt,Gt,(Vt-$t)*K,Rt-it);if(h.flipState=jn&&jn.needsFlipping?go.flipRequired:go.flipNotRequired,jn)return jn}wt(ct.first);for(let $t=Pe+1;$t<Pe+Ze-1;$t++){const it=Mi(_e*m.getoffsetX($t),we,ke,l,M,F,He,Be,Je,y,C,U,ee,!1,!1,le,Z,ce);if(!it)return _.length-=4*($t-Pe),{notEnoughRoom:!0};wt(it)}wt(ct.last)}else{if(p&&!l){const $t=bi(F.x,F.y,0,w),it=Be+He+1,vt=new c.Point(y.getx(it),y.gety(it)),Vt=bi(vt.x,vt.y,0,w),Rt=Vt[3]>0?Vt:hn(F,vt,$t,1,w,void 0,le,Z.canonical),Kt=Zo(nt,Gt,(Rt[0]-$t[0])*K,Rt[1]-$t[1]);if(h.flipState=Kt&&Kt.needsFlipping?go.flipRequired:go.flipNotRequired,Kt)return Kt}const ct=Mi(_e*m.getoffsetX(Pe),we,ke,l,M,F,He,Be,Je,y,C,U,ee,!1,!1,le,Z,ce);if(!ct)return{notEnoughRoom:!0};wt(ct)}return{}}function Ft(h,i,l,p,w){const{x:C,y:P,z:m}=p.projectTilePoint(h.x,h.y,i);if(!w)return bi(C,P,m,l);const[y,_,T]=w(h);return bi(C+y,P+_,m+T,l)}function hn(h,i,l,p,w,C,P,m){const y=Ft(h.sub(i)._unit()._add(h),m,w,P,C);return c.sub(y,l,y),c.normalize(y,y),c.scaleAndAdd(y,l,y,p)}function Mi(h,i,l,p,w,C,P,m,y,_,T,M,F,U,K,ee,le,Z){const ce=p?h-i:h+i;let _e=ce>0?1:-1,we=0;p&&(_e*=-1,we=Math.PI),_e<0&&(we+=Math.PI);let ke=m+P+(_e>0?0:1)|0,Be=w,Pe=w,Ze=0,He=0;const nt=Math.abs(ce),Gt=[],Je=[];let wt=C,ct=wt;const $t=()=>hn(ct,wt,Pe,nt-Ze+1,T,F,ee,le.canonical);for(;Ze+He<=nt;){if(ke+=_e,ke<m||ke>=y)return null;if(Pe=Be,ct=wt,Gt.push(Pe),U&&Je.push(ct),wt=new c.Point(_.getx(ke),_.gety(ke)),Be=M[ke],!Be){const Kn=Ft(wt,le.canonical,T,ee,F);Be=Kn[3]>0?M[ke]=Kn:$t()}Ze+=He,He=c.distance(Pe,Be)}K&&F&&(M[ke]&&(Be=$t(),He=c.distance(Pe,Be)),M[ke]=Be);const it=(nt-Ze)/He,vt=wt.sub(ct)._mult(it)._add(ct),Vt=c.sub([],Be,Pe),Rt=c.scaleAndAdd([],Pe,Vt,it);let Kt=[0,0,1],jn=Vt[0],di=Vt[1];if(Z&&(Kt=ee.upVector(le.canonical,vt.x,vt.y),0!==Kt[0]||0!==Kt[1]||1!==Kt[2])){const Kn=[Kt[2],0,-Kt[0]],Ui=c.cross([],Kt,Kn);c.normalize(Kn,Kn),c.normalize(Ui,Ui),jn=c.dot(Vt,Kn),di=c.dot(Vt,Ui)}if(l){const Kn=c.cross([],Kt,Vt);c.normalize(Kn,Kn),c.scaleAndAdd(Rt,Rt,Kn,l*_e)}const Pn=we+Math.atan2(di,jn);return Gt.push(Rt),U&&Je.push(vt),{point:Rt,angle:Pn,path:Gt,tilePath:Je,up:Kt}}function Qi(h,i){const l=i.length,p=l+4*h;i.resize(p),i.float32.fill(-1/0,4*l,4*p)}function In(h,i,l){const p=i[0],w=i[1];return h[0]=l[0]*p+l[4]*w+l[12],h[1]=l[1]*p+l[5]*w+l[13],h[3]=l[3]*p+l[7]*w+l[15],h}const Ii=100;class So{constructor(i,l,p=new qo(i.width+200,i.height+200,25),w=new qo(i.width+200,i.height+200,25)){this.transform=i,this.grid=p,this.ignoredGrid=w,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+Ii,this.screenBottomBoundary=i.height+Ii,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=l}placeCollisionBox(i,l,p,w,C,P,m,y){let _=p.projectedAnchorX,T=p.projectedAnchorY,M=p.projectedAnchorZ;const F=p.elevation,U=p.tileID,K=i.getProjection();if(F&&U){const[Be,Pe,Ze]=K.upVector(U.canonical,p.tileAnchorX,p.tileAnchorY),He=K.upVectorScale(U.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;_+=Be*F*He,T+=Pe*F*He,M+=Ze*F*He}const ee=this.projectAndGetPerspectiveRatio(m,_,T,M,p.tileID,"globe"===K.name||!!F||this.transform.pitch>0,K),le=P*ee.perspectiveRatio,Z=(p.x1*l+w.x-p.padding)*le+ee.point.x,ce=(p.y1*l+w.y-p.padding)*le+ee.point.y,_e=(p.x2*l+w.x+p.padding)*le+ee.point.x,we=(p.y2*l+w.y+p.padding)*le+ee.point.y,ke=ee.perspectiveRatio<=.55||ee.occluded;return!this.isInsideGrid(Z,ce,_e,we)||!C&&this.grid.hitTest(Z,ce,_e,we,y)||ke?{box:[],offscreen:!1,occluded:ee.occluded}:{box:[Z,ce,_e,we],offscreen:this.isOffscreen(Z,ce,_e,we),occluded:!1}}placeCollisionCircles(i,l,p,w,C,P,m,y,_,T,M,F,U,K,ee){const le=[],Z=this.transform.elevation,ce=i.getProjection(),_e=Z?Z.getAtTileOffsetFunc(ee,this.transform.center.lat,this.transform.worldSize,ce):null,we=new c.Point(p.tileAnchorX,p.tileAnchorY);let{x:ke,y:Be,z:Pe}=ce.projectTilePoint(we.x,we.y,ee.canonical);if(_e){const[vt,Vt,Rt]=_e(we);ke+=vt,Be+=Vt,Pe+=Rt}const Ze="globe"===ce.name,He=this.projectAndGetPerspectiveRatio(m,ke,Be,Pe,ee,Ze||!!Z||this.transform.pitch>0,ce),{perspectiveRatio:nt}=He,Gt=(M?P/nt:P*nt)/c.ONE_EM,Je=bi(ke,Be,Pe,y),wt=He.signedDistanceFromCamera>0?Po(Gt,C,p.lineOffsetX*Gt,p.lineOffsetY*Gt,!1,Je,we,p,w,y,{},Z&&!M?_e:null,M&&!!Z,ce,ee,M):null;let ct=!1,$t=!1,it=!0;if(wt&&!He.occluded){const vt=.5*U*nt+K,Vt=new c.Point(-100,-100),Rt=new c.Point(this.screenRightBoundary,this.screenBottomBoundary),Kt=new Go,{first:jn,last:di}=wt,Pn=jn.path.length;let Kn=[];for(let Bn=Pn-1;Bn>=1;Bn--)Kn.push(jn.path[Bn]);for(let Bn=1;Bn<di.path.length;Bn++)Kn.push(di.path[Bn]);const Ui=2.5*vt;_&&(Kn=Kn.map(([Bn,rr,Er],_r)=>(_e&&!Ze&&(Er=_e(_r<Pn-1?jn.tilePath[Pn-1-_r]:di.tilePath[_r-Pn+2])[2]),bi(Bn,rr,Er,_))),Kn.some(Bn=>Bn[3]<=0)&&(Kn=[]));let Fi=[];if(Kn.length>0){let Bn=1/0,rr=-1/0,Er=1/0,_r=-1/0;for(const Rr of Kn)Bn=Math.min(Bn,Rr[0]),Er=Math.min(Er,Rr[1]),rr=Math.max(rr,Rr[0]),_r=Math.max(_r,Rr[1]);rr>=Vt.x&&Bn<=Rt.x&&_r>=Vt.y&&Er<=Rt.y&&(Fi=[Kn.map(Rr=>new c.Point(Rr[0],Rr[1]))],(Bn<Vt.x||rr>Rt.x||Er<Vt.y||_r>Rt.y)&&(Fi=c.clipLine(Fi,Vt.x,Vt.y,Rt.x,Rt.y)))}for(const Bn of Fi){Kt.reset(Bn,.25*vt);let rr=0;rr=Kt.length<=.5*vt?1:Math.ceil(Kt.paddedLength/Ui)+1;for(let Er=0;Er<rr;Er++){const _r=Er/Math.max(rr-1,1),Rr=Kt.lerp(_r),Os=Rr.x+Ii,Fs=Rr.y+Ii;le.push(Os,Fs,vt,0);const Ua=Os-vt,tl=Fs-vt,Ur=Os+vt,Lr=Fs+vt;if(it=it&&this.isOffscreen(Ua,tl,Ur,Lr),$t=$t||this.isInsideGrid(Ua,tl,Ur,Lr),!l&&this.grid.hitTestCircle(Os,Fs,vt,F)&&(ct=!0,!T))return{circles:[],offscreen:!1,collisionDetected:ct,occluded:!1}}}}return{circles:!T&&ct||!$t?[]:le,offscreen:it,collisionDetected:ct,occluded:He.occluded}}queryRenderedSymbols(i){if(0===i.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const l=[];let p=1/0,w=1/0,C=-1/0,P=-1/0;for(const T of i){const M=new c.Point(T.x+Ii,T.y+Ii);p=Math.min(p,M.x),w=Math.min(w,M.y),C=Math.max(C,M.x),P=Math.max(P,M.y),l.push(M)}const m=this.grid.query(p,w,C,P).concat(this.ignoredGrid.query(p,w,C,P)),y={},_={};for(const T of m){const M=T.key;if(void 0===y[M.bucketInstanceId]&&(y[M.bucketInstanceId]={}),y[M.bucketInstanceId][M.featureIndex])continue;const F=[new c.Point(T.x1,T.y1),new c.Point(T.x2,T.y1),new c.Point(T.x2,T.y2),new c.Point(T.x1,T.y2)];c.polygonIntersectsPolygon(l,F)&&(y[M.bucketInstanceId][M.featureIndex]=!0,void 0===_[M.bucketInstanceId]&&(_[M.bucketInstanceId]=[]),_[M.bucketInstanceId].push(M.featureIndex))}return _}insertCollisionBox(i,l,p,w,C){(l?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:w,collisionGroupID:C},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,l,p,w,C){const P=l?this.ignoredGrid:this.grid,m={bucketInstanceId:p,featureIndex:w,collisionGroupID:C};for(let y=0;y<i.length;y+=4)P.insertCircle(m,i[y],i[y+1],i[y+2])}projectAndGetPerspectiveRatio(i,l,p,w,C,P,m){const y=[l,p,w,1];let _=!1;w||this.transform.pitch>0?(c.transformMat4$1(y,y,i),this.fogState&&C&&"globe"!==m.name&&(_=function(F,U,K,ee,le,Z){const ce=Z.calculateFogTileMatrix(le),_e=[U,K,ee];return c.transformMat4(_e,_e,ce),En(F,_e,Z.pitch,Z._fov)}(this.fogState,l,p,w,C.toUnwrapped(),this.transform)>.9)):In(y,y,i);const T=y[3];return{point:new c.Point((y[0]/T+1)/2*this.transform.width+Ii,(-y[1]/T+1)/2*this.transform.height+Ii),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(m)/T*.5,1.5),signedDistanceFromCamera:T,occluded:P&&y[2]>T||_}}isOffscreen(i,l,p,w){return p<Ii||i>=this.screenRightBoundary||w<Ii||l>this.screenBottomBoundary}isInsideGrid(i,l,p,w){return p>=0&&i<this.gridRightBoundary&&w>=0&&l<this.gridBottomBoundary}getViewportMatrix(){const i=c.identity([]);return c.translate(i,i,[-100,-100,0]),i}}function ki(h,i,l){const p=i.createTileMatrix(h,h.worldSize,l.toUnwrapped());return c.multiply(new Float32Array(16),h.projMatrix,p)}function Vr(h,i,l){if(i.projection.name===l.projection.name)return h.projMatrix;const p=l.clone();return p.setProjection(i.projection),ki(p,i.getProjection(),h)}function Li(h,i,l){return i.name===l.projection.name?h.projMatrix:ki(l,i,h)}class Yn{constructor(i,l,p,w){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?l:-l))):w&&p?1:0,this.placed=p}isHidden(){return 0===this.opacity&&!this.placed}}class co{constructor(i,l,p,w,C,P=!1){this.text=new Yn(i?i.text:null,l,p,C),this.icon=new Yn(i?i.icon:null,l,w,C),this.clipped=P}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class Zr{constructor(i,l,p,w=!1){this.text=i,this.icon=l,this.skipFade=p,this.clipped=w}}class Xo{constructor(){this.invProjMatrix=c.create(),this.viewportMatrix=c.create(),this.circles=[]}}class fr{constructor(i,l,p,w,C){this.bucketInstanceId=i,this.featureIndex=l,this.sourceLayerIndex=p,this.bucketIndex=w,this.tileID=C}}class Xi{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const l=++this.maxGroupID;this.collisionGroups[i]={ID:l,predicate:p=>p.collisionGroupID===l}}return this.collisionGroups[i]}}function ko(h,i,l,p,w){const{horizontalAlign:C,verticalAlign:P}=c.getAnchorAlignment(h),m=-(C-.5)*i,y=-(P-.5)*l,_=c.evaluateVariableOffset(h,p);return new c.Point(m+_[0]*w,y+_[1]*w)}function Jr(h,i,l,p,w){const C=new c.Point(h,i);return l&&C._rotate(p?w:-w),C}class _o{constructor(i,l,p,w,C){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new So(this.transform,C),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=l,this.retainedQueryData={},this.collisionGroups=new Xi(p),this.collisionCircleArrays={},this.prevPlacement=w,w&&(w.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,l,p,w){const C=p.getBucket(l),P=p.latestFeatureIndex;if(!C||!P||l.id!==C.layerIds[0])return;const m=C.layers[0].layout,y=p.collisionBoxArray,_=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),T=p.tileSize/c.EXTENT,M=p.tileID.toUnwrapped();this.transform.setProjection(C.projection);const F=(U=p.tileID,K=C.getProjection(),ee=this.transform,K.name===this.projection?ee.calculateProjMatrix(U.toUnwrapped()):ki(ee,K,U));var U,K,ee;const le="map"===m.get("text-pitch-alignment"),Z="map"===m.get("text-rotation-alignment");l.compileFilter();const ce=l.dynamicFilter(),_e=l.dynamicFilterNeedsFeature(),we=this.transform.calculatePixelsToTileUnitsMatrix(p),ke=ti(F,p.tileID.canonical,le,Z,this.transform,C.getProjection(),we);let Be=null;if(le){const He=ai(F,p.tileID.canonical,le,Z,this.transform,C.getProjection(),we);Be=c.multiply([],this.transform.labelPlaneMatrix,He)}let Pe=null;ce&&p.latestFeatureIndex&&(Pe={unwrappedTileID:M,dynamicFilter:ce,dynamicFilterNeedsFeature:_e,featureIndex:p.latestFeatureIndex}),this.retainedQueryData[C.bucketInstanceId]=new fr(C.bucketInstanceId,P,C.sourceLayerIndex,C.index,p.tileID);const Ze={bucket:C,layout:m,posMatrix:F,textLabelPlaneMatrix:ke,labelToScreenMatrix:Be,clippingData:Pe,scale:_,textPixelRatio:T,holdingForFade:p.holdingForFade(),collisionBoxArray:y,partiallyEvaluatedTextSize:c.evaluateSizeForZoom(C.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:c.evaluateSizeForZoom(C.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(C.sourceID)};if(w)for(const He of C.sortKeyRanges){const{sortKey:nt,symbolInstanceStart:Gt,symbolInstanceEnd:Je}=He;i.push({sortKey:nt,symbolInstanceStart:Gt,symbolInstanceEnd:Je,parameters:Ze})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:C.symbolInstances.length,parameters:Ze})}attemptAnchorPlacement(i,l,p,w,C,P,m,y,_,T,M,F,U,K,ee,le,Z,ce){const{textOffset0:_e,textOffset1:we,crossTileID:ke}=F,Be=[_e,we],Pe=ko(i,p,w,Be,C),Ze=this.collisionIndex.placeCollisionBox(K,C,l,Jr(Pe.x,Pe.y,P,m,this.transform.angle),M,y,_,T.predicate);if(le){const He=K.getSymbolInstanceIconSize(ce,this.transform.zoom,F.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(K,He,le,Jr(Pe.x,Pe.y,P,m,this.transform.angle),M,y,_,T.predicate).box.length)return}if(Ze.box.length>0){let He;return this.prevPlacement&&this.prevPlacement.variableOffsets[ke]&&this.prevPlacement.placements[ke]&&this.prevPlacement.placements[ke].text&&(He=this.prevPlacement.variableOffsets[ke].anchor),this.variableOffsets[ke]={textOffset:Be,width:p,height:w,anchor:i,textScale:C,prevAnchor:He},this.markUsedJustification(K,i,F,ee),K.allowVerticalPlacement&&(this.markUsedOrientation(K,ee,F),this.placedOrientations[ke]=ee),{shift:Pe,placedGlyphBoxes:Ze}}}placeLayerBucketPart(i,l,p,w){const{bucket:C,layout:P,posMatrix:m,textLabelPlaneMatrix:y,labelToScreenMatrix:_,clippingData:T,textPixelRatio:M,holdingForFade:F,collisionBoxArray:U,partiallyEvaluatedTextSize:K,partiallyEvaluatedIconSize:ee,collisionGroup:le}=i.parameters,Z=P.get("text-optional"),ce=P.get("icon-optional"),_e=P.get("text-allow-overlap"),we=P.get("icon-allow-overlap"),ke="map"===P.get("text-rotation-alignment"),Be="map"===P.get("text-pitch-alignment"),Pe="none"!==P.get("icon-text-fit"),Ze="viewport-y"===P.get("symbol-z-order");this.transform.setProjection(C.projection);let He=_e&&(we||!C.hasIconData()||ce),nt=we&&(_e||!C.hasTextData()||Z);!C.collisionArrays&&U&&C.deserializeCollisionBoxes(U),p&&w&&C.updateCollisionDebugBuffers(this.transform.zoom,U);const Gt=(Je,wt,ct)=>{const{crossTileID:$t,numVerticalGlyphVertices:it}=Je;if(T){const Ur={zoom:this.transform.zoom,pitch:this.transform.pitch};let Lr=null;if(T.dynamicFilterNeedsFeature){const or=this.retainedQueryData[C.bucketInstanceId];Lr=T.featureIndex.loadFeature({featureIndex:Je.featureIndex,bucketIndex:or.bucketIndex,sourceLayerIndex:or.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,T.dynamicFilter)(Ur,Lr,this.retainedQueryData[C.bucketInstanceId].tileID.canonical,new c.Point(Je.tileAnchorX,Je.tileAnchorY),this.transform.calculateDistanceTileData(T.unwrappedTileID)))return this.placements[$t]=new Zr(!1,!1,!1,!0),void l.add($t)}if(l.has($t))return;if(F)return void(this.placements[$t]=new Zr(!1,!1,!1));let vt=!1,Vt=!1,Rt=!0,Kt=!1,jn=!1,di=null,Pn={box:null,offscreen:null,occluded:null},Kn={box:null,offscreen:null,occluded:null},Ui=null,Fi=null,Bn=null,rr=0,Er=0,_r=0;ct.textFeatureIndex?rr=ct.textFeatureIndex:Je.useRuntimeCollisionCircles&&(rr=Je.featureIndex),ct.verticalTextFeatureIndex&&(Er=ct.verticalTextFeatureIndex);const Rr=Ur=>{Ur.tileID=this.retainedQueryData[C.bucketInstanceId].tileID;const Lr=this.transform.elevation;(Lr||Ur.elevation)&&(Ur.elevation=Lr?Lr.getAtTileOffset(Ur.tileID,Ur.tileAnchorX,Ur.tileAnchorY):0)},Os=ct.textBox;if(Os){Rr(Os);const Ur=or=>{let bo=c.WritingMode.horizontal;if(C.allowVerticalPlacement&&!or&&this.prevPlacement){const xa=this.prevPlacement.placedOrientations[$t];xa&&(this.placedOrientations[$t]=xa,bo=xa,this.markUsedOrientation(C,bo,Je))}return bo},Lr=(or,bo)=>{if(C.allowVerticalPlacement&&it>0&&ct.verticalTextBox){for(const xa of C.writingModes)if(xa===c.WritingMode.vertical?(Pn=bo(),Kn=Pn):Pn=or(),Pn&&Pn.box&&Pn.box.length)break}else Pn=or()};if(P.get("text-variable-anchor")){let or=P.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[$t]){const Kr=this.prevPlacement.variableOffsets[$t];or.indexOf(Kr.anchor)>0&&(or=or.filter(Ia=>Ia!==Kr.anchor),or.unshift(Kr.anchor))}const bo=(Kr,Ia,mh)=>{const xc=C.getSymbolInstanceTextSize(K,Je,this.transform.zoom,wt),Yc=(Kr.x2-Kr.x1)*xc+2*Kr.padding,nl=(Kr.y2-Kr.y1)*xc+2*Kr.padding,il=Pe&&!we?Ia:null;il&&Rr(il);let zl={box:[],offscreen:!1,occluded:!1};const Jc=_e?2*or.length:or.length;for(let wc=0;wc<Jc;++wc){const ja=this.attemptAnchorPlacement(or[wc%or.length],Kr,Yc,nl,xc,ke,Be,M,m,le,wc>=or.length,Je,wt,C,mh,il,K,ee);if(ja&&(zl=ja.placedGlyphBoxes,zl&&zl.box&&zl.box.length)){vt=!0,di=ja.shift;break}}return zl};Lr(()=>bo(Os,ct.iconBox,c.WritingMode.horizontal),()=>{const Kr=ct.verticalTextBox;return Kr&&Rr(Kr),C.allowVerticalPlacement&&!(Pn&&Pn.box&&Pn.box.length)&&it>0&&Kr?bo(Kr,ct.verticalIconBox,c.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Pn&&(vt=Pn.box,Rt=Pn.offscreen,Kt=Pn.occluded);const xa=Ur(!(!Pn||!Pn.box));if(!vt&&this.prevPlacement){const Kr=this.prevPlacement.variableOffsets[$t];Kr&&(this.variableOffsets[$t]=Kr,this.markUsedJustification(C,Kr.anchor,Je,xa))}}else{const or=(bo,xa)=>{const Kr=C.getSymbolInstanceTextSize(K,Je,this.transform.zoom,wt),Ia=this.collisionIndex.placeCollisionBox(C,Kr,bo,new c.Point(0,0),_e,M,m,le.predicate);return Ia&&Ia.box&&Ia.box.length&&(this.markUsedOrientation(C,xa,Je),this.placedOrientations[$t]=xa),Ia};Lr(()=>or(Os,c.WritingMode.horizontal),()=>{const bo=ct.verticalTextBox;return C.allowVerticalPlacement&&it>0&&bo?(Rr(bo),or(bo,c.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Ur(!!(Pn&&Pn.box&&Pn.box.length))}}if(Ui=Pn,vt=Ui&&Ui.box&&Ui.box.length>0,Rt=Ui&&Ui.offscreen,Kt=Ui&&Ui.occluded,Je.useRuntimeCollisionCircles){const Ur=C.text.placedSymbolArray.get(Je.centerJustifiedTextSymbolIndex>=0?Je.centerJustifiedTextSymbolIndex:Je.verticalPlacedTextSymbolIndex),Lr=c.evaluateSizeForFeature(C.textSizeData,K,Ur),or=P.get("text-padding");Fi=this.collisionIndex.placeCollisionCircles(C,_e,Ur,C.lineVertexArray,C.glyphOffsetArray,Lr,m,y,_,p,Be,le.predicate,Je.collisionCircleDiameter*Lr/c.ONE_EM,or,this.retainedQueryData[C.bucketInstanceId].tileID),vt=_e||Fi.circles.length>0&&!Fi.collisionDetected,Rt=Rt&&Fi.offscreen,Kt=Fi.occluded}if(ct.iconFeatureIndex&&(_r=ct.iconFeatureIndex),ct.iconBox){const Ur=Lr=>{Rr(Lr);const or=Pe&&di?Jr(di.x,di.y,ke,Be,this.transform.angle):new c.Point(0,0),bo=C.getSymbolInstanceIconSize(ee,this.transform.zoom,Je.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(C,bo,Lr,or,we,M,m,le.predicate)};Kn&&Kn.box&&Kn.box.length&&ct.verticalIconBox?(Bn=Ur(ct.verticalIconBox),Vt=Bn.box.length>0):(Bn=Ur(ct.iconBox),Vt=Bn.box.length>0),Rt=Rt&&Bn.offscreen,jn=Bn.occluded}const Fs=Z||0===Je.numHorizontalGlyphVertices&&0===it,Ua=ce||0===Je.numIconVertices;if(Fs||Ua?Ua?Fs||(Vt=Vt&&vt):vt=Vt&&vt:Vt=vt=Vt&&vt,vt&&Ui&&Ui.box&&this.collisionIndex.insertCollisionBox(Ui.box,P.get("text-ignore-placement"),C.bucketInstanceId,Kn&&Kn.box&&Er?Er:rr,le.ID),Vt&&Bn&&this.collisionIndex.insertCollisionBox(Bn.box,P.get("icon-ignore-placement"),C.bucketInstanceId,_r,le.ID),Fi&&(vt&&this.collisionIndex.insertCollisionCircles(Fi.circles,P.get("text-ignore-placement"),C.bucketInstanceId,rr,le.ID),p)){const Ur=C.bucketInstanceId;let Lr=this.collisionCircleArrays[Ur];void 0===Lr&&(Lr=this.collisionCircleArrays[Ur]=new Xo);for(let or=0;or<Fi.circles.length;or+=4)Lr.circles.push(Fi.circles[or+0]),Lr.circles.push(Fi.circles[or+1]),Lr.circles.push(Fi.circles[or+2]),Lr.circles.push(Fi.collisionDetected?1:0)}const tl="globe"!==C.projection.name;He=He&&(tl||!Kt),nt=nt&&(tl||!jn),this.placements[$t]=new Zr(vt||He,Vt||nt,Rt||C.justReloaded),l.add($t)};if(Ze){const Je=C.getSortedSymbolIndexes(this.transform.angle);for(let wt=Je.length-1;wt>=0;--wt){const ct=Je[wt];Gt(C.symbolInstances.get(ct),ct,C.collisionArrays[ct])}}else for(let Je=i.symbolInstanceStart;Je<i.symbolInstanceEnd;Je++)Gt(C.symbolInstances.get(Je),Je,C.collisionArrays[Je]);if(p&&C.bucketInstanceId in this.collisionCircleArrays){const Je=this.collisionCircleArrays[C.bucketInstanceId];c.invert(Je.invProjMatrix,m),Je.viewportMatrix=this.collisionIndex.getViewportMatrix()}C.justReloaded=!1}markUsedJustification(i,l,p,w){const{leftJustifiedTextSymbolIndex:C,centerJustifiedTextSymbolIndex:P,rightJustifiedTextSymbolIndex:m,verticalPlacedTextSymbolIndex:y,crossTileID:_}=p,T=c.getAnchorJustification(l),M=w===c.WritingMode.vertical?y:"left"===T?C:"center"===T?P:"right"===T?m:-1;C>=0&&(i.text.placedSymbolArray.get(C).crossTileID=M>=0&&C!==M?0:_),P>=0&&(i.text.placedSymbolArray.get(P).crossTileID=M>=0&&P!==M?0:_),m>=0&&(i.text.placedSymbolArray.get(m).crossTileID=M>=0&&m!==M?0:_),y>=0&&(i.text.placedSymbolArray.get(y).crossTileID=M>=0&&y!==M?0:_)}markUsedOrientation(i,l,p){const w=l===c.WritingMode.horizontal||l===c.WritingMode.horizontalOnly?l:0,C=l===c.WritingMode.vertical?l:0,{leftJustifiedTextSymbolIndex:P,centerJustifiedTextSymbolIndex:m,rightJustifiedTextSymbolIndex:y,verticalPlacedTextSymbolIndex:_}=p,T=i.text.placedSymbolArray;P>=0&&(T.get(P).placedOrientation=w),m>=0&&(T.get(m).placedOrientation=w),y>=0&&(T.get(y).placedOrientation=w),_>=0&&(T.get(_).placedOrientation=C)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const l=this.prevPlacement;let p=!1;this.prevZoomAdjustment=l?l.zoomAdjustment(this.transform.zoom):0;const w=l?l.symbolFadeChange(i):1,C=l?l.opacities:{},P=l?l.variableOffsets:{},m=l?l.placedOrientations:{};for(const y in this.placements){const _=this.placements[y],T=C[y];T?(this.opacities[y]=new co(T,w,_.text,_.icon,null,_.clipped),p=p||_.text!==T.text.placed||_.icon!==T.icon.placed):(this.opacities[y]=new co(null,w,_.text,_.icon,_.skipFade,_.clipped),p=p||_.text||_.icon)}for(const y in C){const _=C[y];if(!this.opacities[y]){const T=new co(_,w,!1,!1);T.isHidden()||(this.opacities[y]=T,p=p||_.text.placed||_.icon.placed)}}for(const y in P)this.variableOffsets[y]||!this.opacities[y]||this.opacities[y].isHidden()||(this.variableOffsets[y]=P[y]);for(const y in m)this.placedOrientations[y]||!this.opacities[y]||this.opacities[y].isHidden()||(this.placedOrientations[y]=m[y]);p?this.lastPlacementChangeTime=i:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=l?l.lastPlacementChangeTime:i)}updateLayerOpacities(i,l){const p=new Set;for(const w of l){const C=w.getBucket(i);C&&w.latestFeatureIndex&&i.id===C.layerIds[0]&&this.updateBucketOpacities(C,p,w.collisionBoxArray)}}updateBucketOpacities(i,l,p){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const w=i.layers[0].layout,C=!!i.layers[0].dynamicFilter(),P=new co(null,0,!1,!1,!0),m=w.get("text-allow-overlap"),y=w.get("icon-allow-overlap"),_=w.get("text-variable-anchor"),T="map"===w.get("text-rotation-alignment"),M="map"===w.get("text-pitch-alignment"),F="none"!==w.get("icon-text-fit"),U=new co(null,0,m&&(y||!i.hasIconData()||w.get("icon-optional")),y&&(m||!i.hasTextData()||w.get("text-optional")),!0);!i.collisionArrays&&p&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(p);const K=(le,Z,ce)=>{for(let _e=0;_e<Z/4;_e++)le.opacityVertexArray.emplaceBack(ce)};let ee=0;for(let le=0;le<i.symbolInstances.length;le++){const Z=i.symbolInstances.get(le),{numHorizontalGlyphVertices:ce,numVerticalGlyphVertices:_e,crossTileID:we,numIconVertices:ke}=Z,Be=l.has(we);let Pe=this.opacities[we];Be?Pe=P:Pe||(Pe=U,this.opacities[we]=Pe),l.add(we);const Ze=ce>0||_e>0,He=ke>0,nt=this.placedOrientations[we],Gt=nt===c.WritingMode.vertical,Je=nt===c.WritingMode.horizontal||nt===c.WritingMode.horizontalOnly;if(!Ze&&!He||Pe.isHidden()||ee++,Ze){const wt=no(Pe.text);K(i.text,ce,Gt?Ei:wt),K(i.text,_e,Je?Ei:wt);const ct=Pe.text.isHidden(),{leftJustifiedTextSymbolIndex:$t,centerJustifiedTextSymbolIndex:it,rightJustifiedTextSymbolIndex:vt,verticalPlacedTextSymbolIndex:Vt}=Z,Rt=i.text.placedSymbolArray,Kt=ct||Gt?1:0;$t>=0&&(Rt.get($t).hidden=Kt),it>=0&&(Rt.get(it).hidden=Kt),vt>=0&&(Rt.get(vt).hidden=Kt),Vt>=0&&(Rt.get(Vt).hidden=ct||Je?1:0);const jn=this.variableOffsets[we];jn&&this.markUsedJustification(i,jn.anchor,Z,nt);const di=this.placedOrientations[we];di&&(this.markUsedJustification(i,"left",Z,di),this.markUsedOrientation(i,di,Z))}if(He){const wt=no(Pe.icon),{placedIconSymbolIndex:ct,verticalPlacedIconSymbolIndex:$t}=Z,it=i.icon.placedSymbolArray,vt=Pe.icon.isHidden()?1:0;ct>=0&&(K(i.icon,ke,Gt?Ei:wt),it.get(ct).hidden=vt),$t>=0&&(K(i.icon,Z.numVerticalIconVertices,Je?Ei:wt),it.get($t).hidden=vt)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const wt=i.collisionArrays[le];if(wt){let ct=new c.Point(0,0),$t=!0;if(wt.textBox||wt.verticalTextBox){if(_){const vt=this.variableOffsets[we];vt?(ct=ko(vt.anchor,vt.width,vt.height,vt.textOffset,vt.textScale),T&&ct._rotate(M?this.transform.angle:-this.transform.angle)):$t=!1}C&&($t=!Pe.clipped),wt.textBox&&Ro(i.textCollisionBox.collisionVertexArray,Pe.text.placed,!$t||Gt,ct.x,ct.y),wt.verticalTextBox&&Ro(i.textCollisionBox.collisionVertexArray,Pe.text.placed,!$t||Je,ct.x,ct.y)}const it=$t&&Boolean(!Je&&wt.verticalIconBox);wt.iconBox&&Ro(i.iconCollisionBox.collisionVertexArray,Pe.icon.placed,it,F?ct.x:0,F?ct.y:0),wt.verticalIconBox&&Ro(i.iconCollisionBox.collisionVertexArray,Pe.icon.placed,!it,F?ct.x:0,F?ct.y:0)}}}if(i.fullyClipped=0===ee,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const le=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=le.invProjMatrix,i.placementViewportMatrix=le.viewportMatrix,i.collisionCircleArray=le.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return 0===this.fadeDuration?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,l){const p=this.zoomAtLastRecencyCheck===l?1-this.zoomAdjustment(l):1;return this.zoomAtLastRecencyCheck=l,this.commitTime+this.fadeDuration*p>i}setStale(){this.stale=!0}}function Ro(h,i,l,p,w){h.emplaceBack(i?1:0,l?1:0,p||0,w||0),h.emplaceBack(i?1:0,l?1:0,p||0,w||0),h.emplaceBack(i?1:0,l?1:0,p||0,w||0),h.emplaceBack(i?1:0,l?1:0,p||0,w||0)}const Qr=Math.pow(2,25),ri=Math.pow(2,24),ca=Math.pow(2,17),ua=Math.pow(2,16),eo=Math.pow(2,9),to=Math.pow(2,8),Hs=Math.pow(2,1);function no(h){if(0===h.opacity&&!h.placed)return 0;if(1===h.opacity&&h.placed)return 4294967295;const i=h.placed?1:0,l=Math.floor(127*h.opacity);return l*Qr+i*ri+l*ca+i*ua+l*eo+i*to+l*Hs+i}const Ei=0;class cs{constructor(i){this._sortAcrossTiles="viewport-y"!==i.layout.get("symbol-z-order")&&void 0!==i.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,l,p,w,C){const P=this._bucketParts;for(;this._currentTileIndex<i.length;)if(l.getBucketParts(P,w,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,C())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,P.sort((m,y)=>m.sortKey-y.sortKey));this._currentPartIndex<P.length;){const m=P[this._currentPartIndex];if(l.placeLayerBucketPart(m,this._seenCrossTileIDs,p,0===m.symbolInstanceStart),this._currentPartIndex++,C())return!0}return!1}}class io{constructor(i,l,p,w,C,P,m,y){this.placement=new _o(i,C,P,m,y),this._currentPlacementIndex=l.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=w,this._done=!1}isDone(){return this._done}continuePlacement(i,l,p){const w=c.exported.now(),C=()=>{const P=c.exported.now()-w;return!this._forceFullPlacement&&P>2};for(;this._currentPlacementIndex>=0;){const P=l[i[this._currentPlacementIndex]],m=this.placement.collisionIndex.transform.zoom;if("symbol"===P.type&&(!P.minzoom||P.minzoom<=m)&&(!P.maxzoom||P.maxzoom>m)){if(this._inProgressLayer||(this._inProgressLayer=new cs(P)),this._inProgressLayer.continuePlacement(p[P.source],this.placement,this._showCollisionBoxes,P,C))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const $r=512/c.EXTENT/2;class Mr{constructor(i,l,p){this.tileID=i,this.bucketInstanceId=p,this.index=new c.KDBush(l.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const w=i.canonical.x*c.EXTENT,C=i.canonical.y*c.EXTENT;for(let P=0;P<l.length;P++){const{key:m,crossTileID:y,tileAnchorX:_,tileAnchorY:T}=l.get(P),M=Math.floor((w+_)*$r),F=Math.floor((C+T)*$r);this.index.add(M,F),this.keys.push(m),this.crossTileIDs.push(y)}this.index.finish()}findMatches(i,l,p){const w=this.tileID.canonical.z<l.canonical.z?1:Math.pow(2,this.tileID.canonical.z-l.canonical.z),C=$r/Math.pow(2,l.canonical.z-this.tileID.canonical.z),P=l.canonical.x*c.EXTENT,m=l.canonical.y*c.EXTENT;for(let y=0;y<i.length;y++){const _=i.get(y);if(_.crossTileID)continue;const{key:T,tileAnchorX:M,tileAnchorY:F}=_,U=Math.floor((P+M)*C),K=Math.floor((m+F)*C),ee=this.index.range(U-w,K-w,U+w,K+w);for(const le of ee){const Z=this.crossTileIDs[le];if(this.keys[le]===T&&!p.has(Z)){p.add(Z),_.crossTileID=Z;break}}}}}class Xr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class us{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const l=Math.round((i-this.lng)/360);if(0!==l)for(const p in this.indexes){const w=this.indexes[p],C={};for(const P in w){const m=w[P];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+l),C[m.tileID.key]=m}this.indexes[p]=C}this.lng=i}addBucket(i,l,p){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===l.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let C=0;C<l.symbolInstances.length;C++)l.symbolInstances.get(C).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const w=this.usedCrossTileIDs[i.overscaledZ];for(const C in this.indexes){const P=this.indexes[C];if(Number(C)>i.overscaledZ)for(const m in P){const y=P[m];y.tileID.isChildOf(i)&&y.findMatches(l.symbolInstances,i,w)}else{const m=P[i.scaledTo(Number(C)).key];m&&m.findMatches(l.symbolInstances,i,w)}}for(let C=0;C<l.symbolInstances.length;C++){const P=l.symbolInstances.get(C);P.crossTileID||(P.crossTileID=p.generate(),w.add(P.crossTileID))}return void 0===this.indexes[i.overscaledZ]&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Mr(i,l.symbolInstances,l.bucketInstanceId),!0}removeBucketCrossTileIDs(i,l){for(const p of l.crossTileIDs)this.usedCrossTileIDs[i].delete(p)}removeStaleBuckets(i){let l=!1;for(const p in this.indexes){const w=this.indexes[p];for(const C in w)i[w[C].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,w[C]),delete w[C],l=!0)}return l}}class ur{constructor(){this.layerIndexes={},this.crossTileIDs=new Xr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,l,p,w){let C=this.layerIndexes[i.id];void 0===C&&(C=this.layerIndexes[i.id]=new us);let P=!1;const m={};"globe"!==w.name&&C.handleWrapJump(p);for(const y of l){const _=y.getBucket(i);_&&i.id===_.layerIds[0]&&(_.bucketInstanceId||(_.bucketInstanceId=++this.maxBucketInstanceId),C.addBucket(y.tileID,_,this.crossTileIDs)&&(P=!0),m[_.bucketInstanceId]=!0)}return C.removeStaleBuckets(m)&&(P=!0),P}pruneUnusedLayers(i){const l={};i.forEach(p=>{l[p]=!0});for(const p in this.layerIndexes)l[p]||delete this.layerIndexes[p]}}const Hr=(h,i)=>c.emitValidationErrors(h,i&&i.filter(l=>"source.canvas"!==l.identifier)),Ko=c.pick(Cn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Gs=c.pick(Cn,["setCenter","setZoom","setBearing","setPitch"]),hs={version:8,layers:[],sources:{}},ha={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ro extends c.Evented{constructor(i,l={}){super(),this.map=i,this.dispatcher=new qe(Ai(),this),this.imageManager=new Zn,this.imageManager.setEventedParent(this),this.glyphManager=new c.GlyphManager(i._requestManager,l.localFontFamily?c.LocalGlyphMode.all:l.localIdeographFontFamily?c.LocalGlyphMode.ideographs:c.LocalGlyphMode.none,l.localFontFamily||l.localIdeographFontFamily),this.crossTileSymbolIndex=new ur,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",c.getReferrer());const p=this;this._rtlTextPluginCallback=ro.registerForPluginStateChange(w=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:w.pluginStatus,pluginURL:w.pluginURL},(C,P)=>{if(c.triggerPluginCompletionEvent(C),P&&P.every(m=>m))for(const m in p._sourceCaches){const y=p._sourceCaches[m],_=y.getSource().type;"vector"!==_&&"geojson"!==_||y.reload()}})}),this.on("data",w=>{if("source"!==w.dataType||"metadata"!==w.sourceDataType)return;const C=this.getSource(w.sourceId);if(C&&C.vectorLayerIds)for(const P in this._layers){const m=this._layers[P];m.source===C.id&&this._validateLayer(m)}})}loadURL(i,l={}){this.fire(new c.Event("dataloading",{dataType:"style"}));const p="boolean"==typeof l.validate?l.validate:!c.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,l.accessToken);const w=this.map._requestManager.transformRequest(i,c.ResourceType.Style);this._request=c.getJSON(w,(C,P)=>{this._request=null,C?this.fire(new c.ErrorEvent(C)):P&&this._load(P,p)})}loadJSON(i,l={}){this.fire(new c.Event("dataloading",{dataType:"style"})),this._request=c.exported.frame(()=>{this._request=null,this._load(i,!1!==l.validate)})}loadEmpty(){this.fire(new c.Event("dataloading",{dataType:"style"})),this._load(hs,!1)}_updateLayerCount(i,l){const p=l?1:-1;i.is3D()&&(this._num3DLayers+=p),"circle"===i.type&&(this._numCircleLayers+=p),"symbol"===i.type&&(this._numSymbolLayers+=p)}_load(i,l){if(l&&Hr(this,c.validateStyle(i)))return;this._loaded=!0,this.stylesheet=c.clone$1(i),this._updateMapProjection();for(const w in i.sources)this.addSource(w,i.sources[w],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const p=Yr(this.stylesheet.layers);this._order=p.map(w=>w.id),this._layers={},this._serializedLayers={};for(const w of p){const C=c.createStyleLayer(w);C.setEventedParent(this,{layer:{id:C.id}}),this._layers[C.id]=C,this._serializedLayers[C.id]=C.serialize(),this._updateLayerCount(C,!0)}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new kt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new c.Event("data",{dataType:"style"})),this.fire(new c.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(i){this._spriteRequest=function(l,p,w){let C,P,m;const y=c.exported.devicePixelRatio>1?"@2x":"";let _=c.getJSON(p.transformRequest(p.normalizeSpriteURL(l,y,".json"),c.ResourceType.SpriteJSON),(F,U)=>{_=null,m||(m=F,C=U,M())}),T=c.getImage(p.transformRequest(p.normalizeSpriteURL(l,y,".png"),c.ResourceType.SpriteImage),(F,U)=>{T=null,m||(m=F,P=U,M())});function M(){if(m)w(m);else if(C&&P){const F=c.exported.getImageData(P),U={};for(const K in C){const{width:ee,height:le,x:Z,y:ce,sdf:_e,pixelRatio:we,stretchX:ke,stretchY:Be,content:Pe}=C[K],Ze=new c.RGBAImage({width:ee,height:le});c.RGBAImage.copy(F,Ze,{x:Z,y:ce},{x:0,y:0},{width:ee,height:le}),U[K]={data:Ze,pixelRatio:we,sdf:_e,stretchX:ke,stretchY:Be,content:Pe}}w(null,U)}}return{cancel(){_&&(_.cancel(),_=null),T&&(T.cancel(),T=null)}}}(i,this.map._requestManager,(l,p)=>{if(this._spriteRequest=null,l)this.fire(new c.ErrorEvent(l));else if(p)for(const w in p)this.imageManager.addImage(w,p[w]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new c.Event("data",{dataType:"style"}))})}_validateLayer(i){const l=this.getSource(i.source);if(!l)return;const p=i.sourceLayer;p&&("geojson"===l.type||l.vectorLayerIds&&-1===l.vectorLayerIds.indexOf(p))&&this.fire(new c.ErrorEvent(new Error(`Source layer "${p}" does not exist on source "${l.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const l=[];for(const p of i){const w=this._layers[p];"custom"!==w.type&&l.push(w.serialize())}return l}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&("function"==typeof i.isLayerDraped?i.isLayerDraped():ha[i.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const l=this._changed;if(this._changed){const w=Object.keys(this._updatedLayers),C=Object.keys(this._removedLayers);(w.length||C.length)&&this._updateWorkerLayers(w,C);for(const P in this._updatedSources){const m=this._updatedSources[P];"reload"===m?this._reloadSource(P):"clear"===m&&this._clearSource(P)}this._updateTilesForChangedImages();for(const P in this._updatedPaintProps)this._layers[P].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const p={};for(const w in this._sourceCaches){const C=this._sourceCaches[w];p[w]=C.used,C.used=!1}for(const w of this._order){const C=this._layers[w];if(C.recalculate(i,this._availableImages),!C.isHidden(i.zoom)){const m=this._getLayerSourceCache(C);m&&(m.used=!0)}const P=this.map.painter;if(P){const m=C.getProgramIds();if(!m)continue;const y=C.getProgramConfiguration(i.zoom);for(const _ of m)P.useProgram(_,y)}}for(const w in p){const C=this._sourceCaches[w];p[w]!==C.used&&C.getSource().fire(new c.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),l&&this.fire(new c.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const l in this._sourceCaches)this._sourceCaches[l].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,l){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:l})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),Hr(this,c.validateStyle(i)))return!1;(i=c.clone$1(i)).layers=Yr(i.layers);const l=function(w,C){if(!w)return[{command:Cn.setStyle,args:[C]}];let P=[];try{if(!Re(w.version,C.version))return[{command:Cn.setStyle,args:[C]}];Re(w.center,C.center)||P.push({command:Cn.setCenter,args:[C.center]}),Re(w.zoom,C.zoom)||P.push({command:Cn.setZoom,args:[C.zoom]}),Re(w.bearing,C.bearing)||P.push({command:Cn.setBearing,args:[C.bearing]}),Re(w.pitch,C.pitch)||P.push({command:Cn.setPitch,args:[C.pitch]}),Re(w.sprite,C.sprite)||P.push({command:Cn.setSprite,args:[C.sprite]}),Re(w.glyphs,C.glyphs)||P.push({command:Cn.setGlyphs,args:[C.glyphs]}),Re(w.transition,C.transition)||P.push({command:Cn.setTransition,args:[C.transition]}),Re(w.light,C.light)||P.push({command:Cn.setLight,args:[C.light]}),Re(w.fog,C.fog)||P.push({command:Cn.setFog,args:[C.fog]}),Re(w.projection,C.projection)||P.push({command:Cn.setProjection,args:[C.projection]});const m={},y=[];!function(M,F,U,K){let ee;for(ee in F=F||{},M=M||{})M.hasOwnProperty(ee)&&(F.hasOwnProperty(ee)||Do(ee,U,K));for(ee in F){if(!F.hasOwnProperty(ee))continue;const le=F[ee];M.hasOwnProperty(ee)?Re(M[ee],le)||("geojson"===M[ee].type&&"geojson"===le.type&&ss(M,F,ee)?U.push({command:Cn.setGeoJSONSourceData,args:[ee,le.data]}):vs(ee,F,U,K)):Co(ee,F,U)}}(w.sources,C.sources,y,m);const _=[];w.layers&&w.layers.forEach(M=>{M.source&&m[M.source]?P.push({command:Cn.removeLayer,args:[M.id]}):_.push(M)});let T=w.terrain;T&&m[T.source]&&(P.push({command:Cn.setTerrain,args:[void 0]}),T=void 0),P=P.concat(y),Re(T,C.terrain)||P.push({command:Cn.setTerrain,args:[C.terrain]}),function(M,F,U){F=F||[];const K=(M=M||[]).map(as),ee=F.map(as),le=M.reduce(Ho,{}),Z=F.reduce(Ho,{}),ce=K.slice(),_e=Object.create(null);let we,ke,Be,Pe,Ze,He,nt;for(we=0,ke=0;we<K.length;we++)Be=K[we],Z.hasOwnProperty(Be)?ke++:(U.push({command:Cn.removeLayer,args:[Be]}),ce.splice(ce.indexOf(Be,ke),1));for(we=0,ke=0;we<ee.length;we++)Be=ee[ee.length-1-we],ce[ce.length-1-we]!==Be&&(le.hasOwnProperty(Be)?(U.push({command:Cn.removeLayer,args:[Be]}),ce.splice(ce.lastIndexOf(Be,ce.length-ke),1)):ke++,He=ce[ce.length-we],U.push({command:Cn.addLayer,args:[Z[Be],He]}),ce.splice(ce.length-we,0,Be),_e[Be]=!0);for(we=0;we<ee.length;we++)if(Be=ee[we],Pe=le[Be],Ze=Z[Be],!_e[Be]&&!Re(Pe,Ze))if(Re(Pe.source,Ze.source)&&Re(Pe["source-layer"],Ze["source-layer"])&&Re(Pe.type,Ze.type)){for(nt in mo(Pe.layout,Ze.layout,U,Be,null,Cn.setLayoutProperty),mo(Pe.paint,Ze.paint,U,Be,null,Cn.setPaintProperty),Re(Pe.filter,Ze.filter)||U.push({command:Cn.setFilter,args:[Be,Ze.filter]}),Re(Pe.minzoom,Ze.minzoom)&&Re(Pe.maxzoom,Ze.maxzoom)||U.push({command:Cn.setLayerZoomRange,args:[Be,Ze.minzoom,Ze.maxzoom]}),Pe)Pe.hasOwnProperty(nt)&&"layout"!==nt&&"paint"!==nt&&"filter"!==nt&&"metadata"!==nt&&"minzoom"!==nt&&"maxzoom"!==nt&&(0===nt.indexOf("paint.")?mo(Pe[nt],Ze[nt],U,Be,nt.slice(6),Cn.setPaintProperty):Re(Pe[nt],Ze[nt])||U.push({command:Cn.setLayerProperty,args:[Be,nt,Ze[nt]]}));for(nt in Ze)Ze.hasOwnProperty(nt)&&!Pe.hasOwnProperty(nt)&&"layout"!==nt&&"paint"!==nt&&"filter"!==nt&&"metadata"!==nt&&"minzoom"!==nt&&"maxzoom"!==nt&&(0===nt.indexOf("paint.")?mo(Pe[nt],Ze[nt],U,Be,nt.slice(6),Cn.setPaintProperty):Re(Pe[nt],Ze[nt])||U.push({command:Cn.setLayerProperty,args:[Be,nt,Ze[nt]]}))}else U.push({command:Cn.removeLayer,args:[Be]}),He=ce[ce.lastIndexOf(Be)+1],U.push({command:Cn.addLayer,args:[Ze,He]})}(_,C.layers,P)}catch(m){console.warn("Unable to compute style diff:",m),P=[{command:Cn.setStyle,args:[C]}]}return P}(this.serialize(),i).filter(w=>!(w.command in Gs));if(0===l.length)return!1;const p=l.filter(w=>!(w.command in Ko));if(p.length>0)throw new Error(`Unimplemented: ${p.map(w=>w.command).join(", ")}.`);return l.forEach(w=>{"setTransition"!==w.command&&"setProjection"!==w.command&&this[w.command].apply(this,w.args)}),this.stylesheet=i,this._updateMapProjection(),!0}addImage(i,l){return this.getImage(i)?this.fire(new c.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,l),this._afterImageUpdated(i),this)}updateImage(i,l){this.imageManager.updateImage(i,l)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i),this._afterImageUpdated(i),this):this.fire(new c.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new c.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,l,p={}){if(this._checkLoaded(),void 0!==this.getSource(i))throw new Error("There is already a source with this ID");if(!l.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(l).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(l.type)>=0&&this._validate(c.validateSource,`sources.${i}`,l,null,p))return;this.map&&this.map._collectResourceTiming&&(l.collectResourceTiming=!0);const w=Fn(i,l,this.dispatcher,this);w.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(i),source:w.serialize(),sourceId:i}));const C=P=>{const m=(P?"symbol:":"other:")+i,y=this._sourceCaches[m]=new c.SourceCache(m,w,P);(P?this._symbolSourceCaches:this._otherSourceCaches)[i]=y,y.style=this,y.onAdd(this.map)};C(!1),"vector"!==l.type&&"geojson"!==l.type||C(!0),w.onAdd&&w.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const l=this.getSource(i);if(!l)throw new Error("There is no source with this ID");for(const w in this._layers)if(this._layers[w].source===i)return this.fire(new c.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${w}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new c.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const p=this._getSourceCaches(i);for(const w of p)delete this._sourceCaches[w.id],delete this._updatedSources[w.id],w.fire(new c.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:w.getSource().id})),w.setEventedParent(null),w.clearTiles();return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],l.setEventedParent(null),l.onRemove&&l.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(i,l){this._checkLoaded(),this.getSource(i).setData(l),this._changed=!0}getSource(i){const l=this._getSourceCache(i);return l&&l.getSource()}_getSources(){const i=[];for(const l in this._otherSourceCaches){const p=this._getSourceCache(l);p&&i.push(p.getSource())}return i}addLayer(i,l,p={}){this._checkLoaded();const w=i.id;if(this.getLayer(w))return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${w}" already exists on this map`)));let C;if("custom"===i.type){if(Hr(this,c.validateCustomStyleLayer(i)))return;C=c.createStyleLayer(i)}else{if("object"==typeof i.source&&(this.addSource(w,i.source),i=c.clone$1(i),i=c.extend(i,{source:w})),this._validate(c.validateLayer,`layers.${w}`,i,{arrayIndex:-1},p))return;C=c.createStyleLayer(i),this._validateLayer(C),C.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[C.id]=C.serialize(),this._updateLayerCount(C,!0)}const P=l?this._order.indexOf(l):this._order.length;if(l&&-1===P)return void this.fire(new c.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`)));this._order.splice(P,0,w),this._layerOrderChanged=!0,this._layers[w]=C;const m=this._getLayerSourceCache(C);if(this._removedLayers[w]&&C.source&&m&&"custom"!==C.type){const y=this._removedLayers[w];delete this._removedLayers[w],y.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",m.pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,l){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===l)return;const p=this._order.indexOf(i);this._order.splice(p,1);const w=l?this._order.indexOf(l):this._order.length;l&&-1===w?this.fire(new c.ErrorEvent(new Error(`Layer with id "${l}" does not exist on this map.`))):(this._order.splice(w,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const l=this._layers[i];if(!l)return void this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));l.setEventedParent(null),this._updateLayerCount(l,!1);const p=this._order.indexOf(i);this._order.splice(p,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=l,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],l.onRemove&&l.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const l in this._layers)if(this._layers[l].type===i)return!0;return!1}setLayerZoomRange(i,l,p){this._checkLoaded();const w=this.getLayer(i);w?w.minzoom===l&&w.maxzoom===p||(null!=l&&(w.minzoom=l),null!=p&&(w.maxzoom=p),this._updateLayer(w)):this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,l,p={}){this._checkLoaded();const w=this.getLayer(i);if(w){if(!Re(w.filter,l))return null==l?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(c.validateFilter,`layers.${w.id}.filter`,l,{layerType:w.type},p)||(w.filter=c.clone$1(l),this._updateLayer(w)))}else this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){const l=this.getLayer(i);return l&&c.clone$1(l.filter)}setLayoutProperty(i,l,p,w={}){this._checkLoaded();const C=this.getLayer(i);C?Re(C.getLayoutProperty(l),p)||(C.setLayoutProperty(l,p,w),this._updateLayer(C)):this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,l){const p=this.getLayer(i);if(p)return p.getLayoutProperty(l);this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,l,p,w={}){this._checkLoaded();const C=this.getLayer(i);C?Re(C.getPaintProperty(l),p)||(C.setPaintProperty(l,p,w)&&this._updateLayer(C),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new c.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,l){const p=this.getLayer(i);return p&&p.getPaintProperty(l)}setFeatureState(i,l){this._checkLoaded();const p=i.source,w=i.sourceLayer,C=this.getSource(p);if(!C)return void this.fire(new c.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const P=C.type;if("geojson"===P&&w)return void this.fire(new c.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===P&&!w)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===i.id&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided.")));const m=this._getSourceCaches(p);for(const y of m)y.setFeatureState(w,i.id,l)}removeFeatureState(i,l){this._checkLoaded();const p=i.source,w=this.getSource(p);if(!w)return void this.fire(new c.ErrorEvent(new Error(`The source '${p}' does not exist in the map's style.`)));const C=w.type,P="vector"===C?i.sourceLayer:void 0;if("vector"===C&&!P)return void this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(l&&"string"!=typeof i.id&&"number"!=typeof i.id)return void this.fire(new c.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const m=this._getSourceCaches(p);for(const y of m)y.removeFeatureState(P,i.id,l)}getFeatureState(i){this._checkLoaded();const l=i.source,p=i.sourceLayer,w=this.getSource(l);if(w){if("vector"!==w.type||p)return void 0===i.id&&this.fire(new c.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(l)[0].getFeatureState(p,i.id);this.fire(new c.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new c.ErrorEvent(new Error(`The source '${l}' does not exist in the map's style.`)))}getTransition(){return c.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const l in this._sourceCaches){const p=this._sourceCaches[l].getSource();i[p.id]||(i[p.id]=p.serialize())}return c.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},l=>void 0!==l)}_updateLayer(i){this._updatedLayers[i.id]=!0;const l=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&l&&"raster"!==l.getSource().type&&(this._updatedSources[i.source]="reload",l.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const l=P=>"fill-extrusion"===this._layers[P].type,p={},w=[];for(let P=this._order.length-1;P>=0;P--){const m=this._order[P];if(l(m)){p[m]=P;for(const y of i){const _=y[m];if(_)for(const T of _)w.push(T)}}}w.sort((P,m)=>m.intersectionZ-P.intersectionZ);const C=[];for(let P=this._order.length-1;P>=0;P--){const m=this._order[P];if(l(m))for(let y=w.length-1;y>=0;y--){const _=w[y].feature;if(p[_.layer.id]<P)break;C.push(_),w.pop()}else for(const y of i){const _=y[m];if(_)for(const T of _)C.push(T.feature)}}return C}queryRenderedFeatures(i,l,p){l&&l.filter&&this._validate(c.validateFilter,"queryRenderedFeatures.filter",l.filter,null,l);const w={};if(l&&l.layers){if(!Array.isArray(l.layers))return this.fire(new c.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const y of l.layers){const _=this._layers[y];if(!_)return this.fire(new c.ErrorEvent(new Error(`The layer '${y}' does not exist in the map's style and cannot be queried for features.`))),[];w[_.source]=!0}}const C=[];l.availableImages=this._availableImages;const P=l&&l.layers?l.layers.some(y=>{const _=this.getLayer(y);return _&&_.is3D()}):this.has3DLayers(),m=bt.createFromScreenPoints(i,p);for(const y in this._sourceCaches){const _=this._sourceCaches[y].getSource().id;l.layers&&!w[_]||C.push(Ne(this._sourceCaches[y],this._layers,this._serializedLayers,m,l,p,P,!!this.map._showQueryGeometry))}return this.placement&&C.push(function(y,_,T,M,F,U,K){const ee={},le=U.queryRenderedSymbols(M),Z=[];for(const ce of Object.keys(le).map(Number))Z.push(K[ce]);Z.sort($e);for(const ce of Z){const _e=ce.featureIndex.lookupSymbolFeatures(le[ce.bucketInstanceId],_,ce.bucketIndex,ce.sourceLayerIndex,F.filter,F.layers,F.availableImages,y);for(const we in _e){const ke=ee[we]=ee[we]||[],Be=_e[we];Be.sort((Pe,Ze)=>{const He=ce.featureSortOrder;if(He){const nt=He.indexOf(Pe.featureIndex);return He.indexOf(Ze.featureIndex)-nt}return Ze.featureIndex-Pe.featureIndex});for(const Pe of Be)ke.push(Pe)}}for(const ce in ee)ee[ce].forEach(_e=>{const we=_e.feature,ke=T(y[ce]);if(!ke)return;const Be=ke.getFeatureState(we.layer["source-layer"],we.id);we.source=we.layer.source,we.layer["source-layer"]&&(we.sourceLayer=we.layer["source-layer"]),we.state=Be});return ee}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),m.screenGeometry,l,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(C)}querySourceFeatures(i,l){l&&l.filter&&this._validate(c.validateFilter,"querySourceFeatures.filter",l.filter,null,l);const p=this._getSourceCaches(i);let w=[];for(const C of p)w=w.concat(ge(C,l));return w}addSourceType(i,l,p){return ro.getSourceType(i)?p(new Error(`A source type called "${i}" already exists.`)):(ro.setSourceType(i,l),l.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:l.workerSourceURL},p):p(null,null))}getLight(){return this.light.getLight()}setLight(i,l={}){this._checkLoaded();const p=this.light.getLight();let w=!1;for(const P in i)if(!Re(i[P],p[P])){w=!0;break}if(!w)return;const C=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(i,l),this.light.updateTransitions(C)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,l=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);let p=i;if(1===l){if("object"==typeof p.source){const w="terrain-dem-src";this.addSource(w,p.source),p=c.clone$1(p),p=c.extend(p,{source:w})}if(this._validate(c.validateTerrain,"terrain",p))return}if(!this.terrain||this.terrain&&l!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,l)}else{const w=this.terrain,C=w.get();for(const P of Object.keys(c.spec.terrain))!p.hasOwnProperty(P)&&c.spec.terrain[P].default&&(p[P]=c.spec.terrain[P].default);for(const P in p)if(!Re(p[P],C[P])){w.set(p),this.stylesheet.terrain=p;const m=this._setTransitionParameters({duration:0});w.updateTransitions(m);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const l=this.fog=new Bi(i,this.map.transform);this.stylesheet.fog=i;const p=this._setTransitionParameters({duration:0});l.updateTransitions(p)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const l=this.fog,p=l.get();0===Object.keys(i).length&&l.set(i);for(const w in i)if(!Re(i[w],p[w])){l.set(i),this.stylesheet.fog=i;const C=this._setTransitionParameters({duration:0});l.updateTransitions(C);break}}else this._createFog(i);this._markersNeedUpdate=!0}_setTransitionParameters(i){return{now:c.exported.now(),transition:c.extend(i,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(p=>this.isLayerDraped(this._layers[p])),l=this._order.filter(p=>!this.isLayerDraped(this._layers[p]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...l)}_createTerrain(i,l){const p=this.terrain=new zt(i,l);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const w=this._setTransitionParameters({duration:0});p.updateTransitions(w)}_force3DLayerUpdate(){for(const i in this._layers){const l=this._layers[i];"fill-extrusion"===l.type&&this._updateLayer(l)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const l=this._layers[i];"symbol"===l.type&&this._updateLayer(l)}}_validate(i,l,p,w,C={}){return(!C||!1!==C.validate)&&Hr(this,i.call(c.validateStyle,c.extend({key:l,style:this.serialize(),value:p,styleSpec:c.spec},w)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),c.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const l=this._getSourceCaches(i);for(const p of l)p.clearTiles()}_reloadSource(i){const l=this._getSourceCaches(i);for(const p of l)p.resume(),p.reload()}_reloadSources(){for(const i of this._getSources())i.reload&&i.reload()}_updateSources(i){for(const l in this._sourceCaches)this._sourceCaches[l].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const l=this._sourceCaches[i];l.resume(),l.reload()}}_updatePlacement(i,l,p,w,C=!1){let P=!1,m=!1;const y={};for(const _ of this._order){const T=this._layers[_];if("symbol"!==T.type)continue;if(!y[T.source]){const F=this._getLayerSourceCache(T);if(!F)continue;y[T.source]=F.getRenderableIds(!0).map(U=>F.getTileByID(U)).sort((U,K)=>K.tileID.overscaledZ-U.tileID.overscaledZ||(U.tileID.isLessThan(K.tileID)?-1:1))}const M=this.crossTileSymbolIndex.addLayer(T,y[T.source],i.center.lng,i.projection);P=P||M}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),C=C||this._layerOrderChanged||0===p,this._layerOrderChanged&&this.fire(new c.Event("neworder")),(C||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(c.exported.now(),i.zoom))&&(this.pauseablePlacement=new io(i,this._order,C,l,p,w,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,y),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(c.exported.now()),m=!0),P&&this.pauseablePlacement.placement.setStale()),m||P)for(const _ of this._order){const T=this._layers[_];"symbol"===T.type&&this.placement.updateLayerOpacities(T,y[T.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(c.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,l,p){this.imageManager.getImages(l.icons,p),this._updateTilesForChangedImages();const w=C=>{C&&C.setDependencies(l.tileID.key,l.type,l.icons)};w(this._otherSourceCaches[l.source]),w(this._symbolSourceCaches[l.source])}getGlyphs(i,l,p){this.glyphManager.getGlyphs(l.stacks,p)}getResource(i,l,p){return c.makeRequest(l,p)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return"symbol"===i.type?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const l=[];return this._otherSourceCaches[i]&&l.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&l.push(this._symbolSourceCaches[i]),l}_isSourceCacheLoaded(i){const l=this._getSourceCaches(i);return 0===l.length?(this.fire(new c.ErrorEvent(new Error(`There is no source with ID '${i}'`))),!1):l.every(p=>p.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ro.getSourceType=function(h){return gn[h]},ro.setSourceType=function(h,i){gn[h]=i},ro.registerForPluginStateChange=c.registerForPluginStateChange;var Ca="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Ss="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Lo="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",ea="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",pr="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let da={},Gr={};const As=[];Jo(Ca,As),Jo(Lo,As),Jo(ea,As),Jo(pr,As),da=Oi("",Lo),Gr=Oi(pr,ea);const qs=Oi("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),Yo=Ca,xs="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var fa={background:Oi("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Oi("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Oi("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Oi("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Oi("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Oi("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Oi("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Oi("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Oi("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Oi("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Oi("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Oi("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Oi("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Oi("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Oi("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Oi("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Oi("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Oi("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Oi("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Oi("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Oi("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Oi("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Oi("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Oi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:Oi("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Oi("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ss),skyboxGradient:Oi("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Ss),skyboxCapture:Oi("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Oi("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Oi("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Jo(h,i){const l=h.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let p of l)if(p=p.trim(),"#"===p[0]&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const w=p.split(" ");for(const C of w)i.includes(C)||i.push(C)}}function Oi(h,i){const l=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,p=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),w={},C=[...As];return Jo(h,C),Jo(i,C),{fragmentSource:h=h.replace(l,(P,m,y,_,T)=>(w[T]=!0,"define"===m?`\n#ifndef HAS_UNIFORM_u_${T}\nvarying ${y} ${_} ${T};\n#else\nuniform ${y} ${_} u_${T};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${T}\n    ${y} ${_} ${T} = u_${T};\n#endif\n`)),vertexSource:i=i.replace(l,(P,m,y,_,T)=>{const M="float"===_?"vec2":"vec4",F=T.match(/color/)?"color":M;return w[T]?"define"===m?`\n#ifndef HAS_UNIFORM_u_${T}\nuniform lowp float u_${T}_t;\nattribute ${y} ${M} a_${T};\nvarying ${y} ${_} ${T};\n#else\nuniform ${y} ${_} u_${T};\n#endif\n`:"vec4"===F?`\n#ifndef HAS_UNIFORM_u_${T}\n    ${T} = a_${T};\n#else\n    ${y} ${_} ${T} = u_${T};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${T}\n    ${T} = unpack_mix_${F}(a_${T}, u_${T}_t);\n#else\n    ${y} ${_} ${T} = u_${T};\n#endif\n`:"define"===m?`\n#ifndef HAS_UNIFORM_u_${T}\nuniform lowp float u_${T}_t;\nattribute ${y} ${M} a_${T};\n#else\nuniform ${y} ${_} u_${T};\n#endif\n`:"vec4"===F?`\n#ifndef HAS_UNIFORM_u_${T}\n    ${y} ${_} ${T} = a_${T};\n#else\n    ${y} ${_} ${T} = u_${T};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${T}\n    ${y} ${_} ${T} = unpack_mix_${F}(a_${T}, u_${T}_t);\n#else\n    ${y} ${_} ${T} = u_${T};\n#endif\n`}),staticAttributes:p,usedDefines:C}}class Ya{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,l,p,w,C,P,m){this.context=i;let y=this.boundPaintVertexBuffers.length!==w.length;for(let T=0;!y&&T<w.length;T++)this.boundPaintVertexBuffers[T]!==w[T]&&(y=!0);let _=this.boundDynamicVertexBuffers.length!==m.length;for(let T=0;!_&&T<m.length;T++)this.boundDynamicVertexBuffers[T]!==m[T]&&(_=!0);if(!i.extVertexArrayObject||!this.vao||this.boundProgram!==l||this.boundLayoutVertexBuffer!==p||y||_||this.boundIndexBuffer!==C||this.boundVertexOffset!==P)this.freshBind(l,p,w,C,P,m);else{i.bindVertexArrayOES.set(this.vao);for(const T of m)T&&T.bind();C&&C.dynamicDraw&&C.bind()}}freshBind(i,l,p,w,C,P){let m;const y=i.numAttributes,_=this.context,T=_.gl;if(_.extVertexArrayObject)this.vao&&this.destroy(),this.vao=_.extVertexArrayObject.createVertexArrayOES(),_.bindVertexArrayOES.set(this.vao),m=0,this.boundProgram=i,this.boundLayoutVertexBuffer=l,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=w,this.boundVertexOffset=C,this.boundDynamicVertexBuffers=P;else{m=_.currentNumAttributes||0;for(let M=y;M<m;M++)T.disableVertexAttribArray(M)}l.enableAttributes(T,i),l.bind(),l.setVertexAttribPointers(T,i,C);for(const M of p)M.enableAttributes(T,i),M.bind(),M.setVertexAttribPointers(T,i,C);for(const M of P)M&&(M.enableAttributes(T,i),M.bind(),M.setVertexAttribPointers(T,i,C));w&&w.bind(),_.currentNumAttributes=y}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function yo(h,i){const l=Math.pow(2,i.canonical.z),p=i.canonical.y;return[new c.MercatorCoordinate(0,p/l).toLngLat().lat,new c.MercatorCoordinate(0,(p+1)/l).toLngLat().lat]}function Oa(h,i,l,p,w,C,P){const m=h.context,y=m.gl,_=l.fbo;if(!_)return;h.prepareDrawTile();const T=h.useProgram("hillshade");m.activeTexture.set(y.TEXTURE0),y.bindTexture(y.TEXTURE_2D,_.colorAttachment.get());const M=((ee,le,Z,ce)=>{const _e=Z.paint.get("hillshade-shadow-color"),we=Z.paint.get("hillshade-highlight-color"),ke=Z.paint.get("hillshade-accent-color");let Be=Z.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===Z.paint.get("hillshade-illumination-anchor")&&(Be-=ee.transform.angle);const Pe=!ee.options.moving;return{u_matrix:ce||ee.transform.calculateProjMatrix(le.tileID.toUnwrapped(),Pe),u_image:0,u_latrange:yo(0,le.tileID),u_light:[Z.paint.get("hillshade-exaggeration"),Be],u_shadow:_e,u_highlight:we,u_accent:ke}})(h,l,p,h.terrain?i.projMatrix:null);h.prepareDrawProgram(m,T,i.toUnwrapped());const{tileBoundsBuffer:F,tileBoundsIndexBuffer:U,tileBoundsSegments:K}=h.getTileBoundsBuffers(l);T.draw(m,y.TRIANGLES,w,C,P,c.CullFaceMode.disabled,M,p.id,F,U,K)}function ws(h,i,l){if(!i.needsDEMTextureUpload)return;const p=h.context,w=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||h.getTileTexture(l.stride);const C=l.getPixels();i.demTexture?i.demTexture.update(C,{premultiply:!1}):i.demTexture=new c.Texture(p,C,w.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function Ms(h,i,l,p,w,C){const P=h.context,m=P.gl;if(!i.dem)return;const y=i.dem;if(P.activeTexture.set(m.TEXTURE1),ws(h,i,y),!i.demTexture)return;i.demTexture.bind(m.NEAREST,m.CLAMP_TO_EDGE);const _=y.dim;P.activeTexture.set(m.TEXTURE0);let T=i.fbo;if(!T){const K=new c.Texture(P,{width:_,height:_,data:null},m.RGBA);K.bind(m.LINEAR,m.CLAMP_TO_EDGE),T=i.fbo=P.createFramebuffer(_,_,!0),T.colorAttachment.set(K.texture)}P.bindFramebuffer.set(T.framebuffer),P.viewport.set([0,0,_,_]);const{tileBoundsBuffer:M,tileBoundsIndexBuffer:F,tileBoundsSegments:U}=h.getMercatorTileBoundsBuffers();h.useProgram("hillshadePrepare").draw(P,m.TRIANGLES,p,w,C,c.CullFaceMode.disabled,((K,ee)=>{const le=ee.stride,Z=c.create();return c.ortho(Z,0,c.EXTENT,-c.EXTENT,0,0,1),c.translate(Z,Z,[0,-c.EXTENT,0]),{u_matrix:Z,u_image:1,u_dimension:[le,le],u_zoom:K.overscaledZ,u_unpack:ee.unpackVector}})(i.tileID,y),l.id,M,F,U),i.needsHillshadePrepare=!1}const ds=h=>({u_matrix:new c.UniformMatrix4f(h),u_image0:new c.Uniform1i(h),u_skirt_height:new c.Uniform1f(h)}),sr=(h,i)=>({u_matrix:h,u_image0:0,u_skirt_height:i}),Ao=(h,i,l,p,w,C,P,m,y,_,T,M,F,U,K)=>({u_proj_matrix:Float32Array.from(h),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:l,u_zoom_transition:w,u_merc_center:C,u_image0:0,u_frustum_tl:P,u_frustum_tr:m,u_frustum_br:y,u_frustum_bl:_,u_globe_pos:T,u_globe_radius:M,u_viewport:F,u_grid_matrix:K?Float32Array.from(K):new Float32Array(9),u_skirt_height:U});function vr(h,i){return null!=h&&null!=i&&!(!h.hasData()||!i.hasData())&&null!=h.demTexture&&null!=i.demTexture&&h.tileID.key!==i.tileID.key}const Oo=new class{constructor(){this.operations={}}newMorphing(h,i,l,p,w){if(h in this.operations){const C=this.operations[h];C.to.tileID.key!==l.tileID.key&&(C.queued=l)}else this.operations[h]={startTime:p,phase:0,duration:w,from:i,to:l,queued:null}}getMorphValuesForProxy(h){if(!(h in this.operations))return null;const i=this.operations[h];return{from:i.from,to:i.to,phase:i.phase}}update(h){for(const i in this.operations){const l=this.operations[i];for(l.phase=(h-l.startTime)/l.duration;l.phase>=1||!this._validOp(l);)if(!this._nextOp(l,h)){delete this.operations[i];break}}}_nextOp(h,i){return!!h.queued&&(h.from=h.to,h.to=h.queued,h.queued=null,h.phase=0,h.startTime=i,!0)}_validOp(h){return h.from.hasData()&&h.to.hasData()}},uo={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function Da(h){return 6*Math.pow(1.5,22-h)}function vo(h,i){const l=1<<h.z;return!i&&(0===h.x||h.x===l-1)||0===h.y||h.y===l-1}const Is=h=>({u_matrix:h});function Sa(h,i,l,p,w){if(w>0){const C=c.exported.now(),P=(C-h.timeAdded)/w,m=i?(C-i.timeAdded)/w:-1,y=l.getSource(),_=p.coveringZoomLevel({tileSize:y.tileSize,roundZoom:y.roundZoom}),T=!i||Math.abs(i.tileID.overscaledZ-_)>Math.abs(h.tileID.overscaledZ-_),M=T&&h.refreshedUponExpiration?1:c.clamp(T?P:1-m,0,1);return h.refreshedUponExpiration&&P>=1&&(h.refreshedUponExpiration=!1),i?{opacity:1,mix:1-M}:{opacity:M,mix:0}}return{opacity:1,mix:0}}class mr extends c.SourceCache{constructor(i){const l={type:"raster-dem",maxzoom:i.transform.maxZoom},p=new qe(Ai(),null),w=Fn("mock-dem",l,p,i.style);super("mock-dem",w,!1),w.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,l){i.state="loaded",l(null)}}class Ws extends c.SourceCache{constructor(i){const l=Fn("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new qe(Ai(),null),i.style);super("proxy",l,!1),l.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,l,p){if(i.freezeTileCoverage)return;this.transform=i;const w=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((C,P)=>{if(C[P.key]="",!this._tiles[P.key]){const m=new c.Tile(P,this._source.tileSize*P.overscaleFactor(),i.tileZoom);m.state="loaded",this._tiles[P.key]=m}return C},{});for(const C in this._tiles)C in w||(this.freeFBO(C),this._tiles[C].unloadVectorData(),delete this._tiles[C])}freeFBO(i){const l=this.proxyCachedFBO[i];if(void 0!==l){const p=Object.values(l);this.renderCachePool.push(...p),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Ps extends c.OverscaledTileID{constructor(i,l,p){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=l,this.projMatrix=p}}class Ir extends c.Elevation{constructor(i,l){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,w,C]=function(y){const _=new c.StructArrayLayout2i4,T=new c.StructArrayLayout3ui6,M=131;_.reserve(17161),T.reserve(33800);const F=c.EXTENT/128,U=c.EXTENT+F/2,K=U+F;for(let le=-F;le<K;le+=F)for(let Z=-F;Z<K;Z+=F){const ce=Z<0||Z>U||le<0||le>U?24575:0,_e=c.clamp(Math.round(Z),0,c.EXTENT),we=c.clamp(Math.round(le),0,c.EXTENT);_.emplaceBack(_e+ce,we)}const ee=(le,Z)=>{const ce=Z*M+le;T.emplaceBack(ce+1,ce,ce+M),T.emplaceBack(ce+M,ce+M+1,ce+1)};for(let le=1;le<129;le++)for(let Z=1;Z<129;Z++)ee(Z,le);return[0,129].forEach(le=>{for(let Z=0;Z<130;Z++)ee(Z,le),ee(le,Z)}),[_,T,32768]}(),P=i.context;this.gridBuffer=P.createVertexBuffer(p,c.posAttributes.members),this.gridIndexBuffer=P.createIndexBuffer(w),this.gridSegments=c.SegmentVector.simpleSegment(0,0,p.length,w.length),this.gridNoSkirtSegments=c.SegmentVector.simpleSegment(0,0,p.length,C),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Ws(l.map),this.orthoMatrix=c.create(),c.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,c.EXTENT,0,c.EXTENT,0,1);const m=P.gl;this._overlapStencilMode=new c.StencilMode({func:m.GEQUAL,mask:255},0,255,m.KEEP,m.KEEP,m.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=l,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new mr(l.map)}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(i,l,p){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const w=i.terrain.properties;this.sourceCache=0===i.terrain.drapeRenderMode?this._mockSourceCache:i._getSourceCache(w.get("source")),this._exaggeration=w.get("exaggeration");const C=()=>{this.sourceCache.used&&c.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const P=this.getScaledDemTileSize();this.sourceCache.update(l,P,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,C(),this._initializing=!0),C(),l.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(l),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==i.efficiency&&c.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&"source"===i.dataType?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):"style"===i.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const l=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=0===p._centerAltitude&&-1===this.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(p.center),-1),this._emptyDEMTextureDirty=!this._initializing);const w=this.proxyCoords=l.getIds().map(y=>{const _=l.getTileByID(y).tileID;return _.projMatrix=p.calculateProjMatrix(_.toUnwrapped()),_});(function(y,_){const T=_.transform.pointCoordinate(_.transform.getCameraPoint()),M=new c.Point(T.x,T.y);y.sort((F,U)=>{if(U.overscaledZ-F.overscaledZ)return U.overscaledZ-F.overscaledZ;const K=new c.Point(F.canonical.x+(1<<F.canonical.z)*F.wrap,F.canonical.y),ee=new c.Point(U.canonical.x+(1<<U.canonical.z)*U.wrap,U.canonical.y),le=M.mult(1<<F.canonical.z);return le.x-=.5,le.y-=.5,le.distSqr(K)-le.distSqr(ee)})})(w,this.painter),this._previousZoom=p.zoom;const C=this.proxyToSource||{};this.proxyToSource={},w.forEach(y=>{this.proxyToSource[y.key]={}}),this.terrainTileForTile={};const P=this._style._sourceCaches;for(const y in P){const _=P[y];if(!_.used||(_!==this.sourceCache&&this.resetTileLookupCache(_.id),this._setupProxiedCoordsForOrtho(_,i[y],C),_.usedForTerrain))continue;const T=i[y];_.getSource().reparseOverscaled&&this._assignTerrainTiles(T)}this.proxiedCoords[l.id]=w.map(y=>new Ps(y,y.key,this.orthoMatrix)),this._assignTerrainTiles(w),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(C),this.renderingToTexture=!1,this._updateTimestamp=c.exported.now();const m={};this._visibleDemTiles=[];for(const y of this.proxyCoords){const _=this.terrainTileForTile[y.key];if(!_)continue;const T=_.tileID.key;T in m||(this._visibleDemTiles.push(_),m[T]=T)}}_assignTerrainTiles(i){this._initializing||i.forEach(l=>{if(this.terrainTileForTile[l.key])return;const p=this._findTileCoveringTileID(l,this.sourceCache);p&&(this.terrainTileForTile[l.key]=p)})}_prepareDEMTextures(){const i=this.painter.context,l=i.gl;for(const p in this.terrainTileForTile){const w=this.terrainTileForTile[p],C=w.dem;!C||w.demTexture&&!w.needsDEMTextureUpload||(i.activeTexture.set(l.TEXTURE1),ws(this.painter,w,C))}}_prepareDemTileUniforms(i,l,p,w){if(!l||null==l.demTexture)return!1;const C=i.tileID.canonical,P=Math.pow(2,l.tileID.canonical.z-C.z),m=w||"";return p[`u_dem_tl${m}`]=[C.x*P%1,C.y*P%1],p[`u_dem_scale${m}`]=P,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,l=i.gl;if(!this._emptyDepthBufferTexture){const p=new c.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new c.Texture(i,p,l.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const l=this._visibleDemTiles.reduce((p,w)=>{if(!w.dem)return p;const C=w.dem.tree.minimums[0];return C>0&&i++,p+C},0);return i?l/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,l=i.gl;i.activeTexture.set(l.TEXTURE2);const p=this._getLoadedAreaMinimum(),w=new c.RGBAImage({width:1,height:1},new Uint8Array(c.DEMData.pack(p,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let C=this._emptyDEMTexture;return C?C.update(w,{premultiply:!1}):C=this._emptyDEMTexture=new c.Texture(i,w,l.RGBA,{premultiply:!1}),C}setupElevationDraw(i,l,p){const w=this.painter.context,C=w.gl,P=(m=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:c.DEMData.getUnpackVector(m),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var m;P.u_dem_size=this.sourceCache.getSource().tileSize,P.u_exaggeration=this.exaggeration();let y=null,_=null,T=1;if(p&&p.morphing&&this._useVertexMorphing){const M=p.morphing.srcDemTile,F=p.morphing.dstDemTile;T=p.morphing.phase,M&&F&&(this._prepareDemTileUniforms(i,M,P,"_prev")&&(_=M),this._prepareDemTileUniforms(i,F,P)&&(y=F))}if(_&&y?(w.activeTexture.set(C.TEXTURE2),y.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),w.activeTexture.set(C.TEXTURE4),_.demTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE,C.NEAREST),P.u_dem_lerp=T):(y=this.terrainTileForTile[i.tileID.key],w.activeTexture.set(C.TEXTURE2),(this._prepareDemTileUniforms(i,y,P)?y.demTexture:this.emptyDEMTexture).bind(C.NEAREST,C.CLAMP_TO_EDGE)),w.activeTexture.set(C.TEXTURE3),p&&p.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),this._depthFBO&&(P.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(C.NEAREST,C.CLAMP_TO_EDGE),P.u_depth_size_inv=[1,1]),p&&p.useMeterToDem&&y){const M=(1<<y.tileID.canonical.z)*c.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;P.u_meter_to_dem=M}if(p&&p.labelPlaneMatrixInv&&(P.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),l.setTerrainUniformValues(w,P),"globe"===this.painter.transform.projection.name){const M=this.globeUniformValues(this.painter.transform,i.tileID.canonical,p&&p.useDenormalizedUpVectorScale);l.setGlobeUniformValues(w,M)}}globeUniformValues(i,l,p){const w=i.projection;return{u_tile_tl_up:w.upVector(l,0,0),u_tile_tr_up:w.upVector(l,c.EXTENT,0),u_tile_br_up:w.upVector(l,c.EXTENT,c.EXTENT),u_tile_bl_up:w.upVector(l,0,c.EXTENT),u_tile_up_scale:p?c.globeMetersToEcef(1):w.upVectorScale(l,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const l=this.painter,p=this.painter.context;0!==i.length&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),l.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(w,C,P,m,y){if("globe"===w.transform.projection.name)!function(_,T,M,F,U){const K=_.context,ee=K.gl;let le,Z;const ce=_.options.showTerrainWireframe?2:0,_e=_.transform,we=c.globeUseCustomAntiAliasing(_,K,_e),ke=($t,it)=>{if(Z===$t)return;const vt=[uo[$t],"PROJECTION_GLOBE_VIEW"];we&&vt.push("CUSTOM_ANTIALIASING"),it&&vt.push(uo[ce]),le=_.useProgram("globeRaster",null,vt),Z=$t},Be=_.colorModeForRenderPass(),Pe=new c.DepthMode(ee.LEQUAL,c.DepthMode.ReadWrite,_.depthRangeFor3D);Oo.update(U);const Ze=c.calculateGlobeMercatorMatrix(_e),He=[c.mercatorXfromLng(_e.center.lng),c.mercatorYfromLat(_e.center.lat)],nt=ce?[!1,!0]:[!1],Gt=_.globeSharedBuffers,Je=[_e.width*c.exported.devicePixelRatio,_e.height*c.exported.devicePixelRatio],wt=Float32Array.from(_e.globeMatrix),ct={useDenormalizedUpVectorScale:!0};if(nt.forEach($t=>{const it=_.transform,vt=Da(it.zoom)*T.exaggeration();Z=-1;const Vt=$t?ee.LINES:ee.TRIANGLES;for(const Rt of F){const Kt=M.getTile(Rt),jn=c.StencilMode.disabled,di=T.prevTerrainTileForTile[Rt.key],Pn=T.terrainTileForTile[Rt.key];vr(di,Pn)&&Oo.newMorphing(Rt.key,di,Pn,U,250),K.activeTexture.set(ee.TEXTURE0),Kt.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);const Kn=Oo.getMorphValuesForProxy(Rt.key),Ui=Kn?1:0;Kn&&c.extend$1(ct,{morphing:{srcDemTile:Kn.from,dstDemTile:Kn.to,phase:c.easeCubicInOut(Kn.phase)}});const Fi=c.tileCornersToBounds(Rt.canonical),Bn=c.getLatitudinalLod(Fi.getCenter().lat),rr=c.getGridMatrix(Rt.canonical,Fi,Bn,it.worldSize/it._pixelsPerMercatorPixel),Er=c.globeNormalizeECEF(c.globeTileBounds(Rt.canonical)),_r=Ao(it.projMatrix,wt,Ze,Er,c.globeToMercatorTransition(it.zoom),He,it.frustumCorners.TL,it.frustumCorners.TR,it.frustumCorners.BR,it.frustumCorners.BL,it.globeCenterInViewSpace,it.globeRadius,Je,vt,rr);if(ke(Ui,$t),T.setupElevationDraw(Kt,le,ct),_.prepareDrawProgram(K,le,Rt.toUnwrapped()),Gt){const[Rr,Os,Fs]=$t?Gt.getWirefameBuffers(_.context,Bn):Gt.getGridBuffers(Bn,0!==vt);le.draw(K,Vt,Pe,jn,Be,c.CullFaceMode.backCCW,_r,"globe_raster",Rr,Os,Fs)}}}),Gt){const $t=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];we&&$t.push("CUSTOM_ANTIALIASING"),le=_.useProgram("globeRaster",null,$t);for(const it of F){const{x:vt,y:Vt,z:Rt}=it.canonical,Kt=0===Vt,jn=Vt===(1<<Rt)-1,[di,Pn,Kn,Ui]=Gt.getPoleBuffers(Rt);if(Ui&&(Kt||jn)){const Fi=M.getTile(it);K.activeTexture.set(ee.TEXTURE0),Fi.texture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE);let Bn=c.globePoleMatrixForTile(Rt,vt,_e);const rr=c.globeNormalizeECEF(c.globeTileBounds(it.canonical)),Er=(_r,Rr)=>_r.draw(K,ee.TRIANGLES,Pe,c.StencilMode.disabled,Be,c.CullFaceMode.disabled,Ao(_e.projMatrix,Bn,Bn,rr,0,He,_e.frustumCorners.TL,_e.frustumCorners.TR,_e.frustumCorners.BR,_e.frustumCorners.BL,_e.globeCenterInViewSpace,_e.globeRadius,Je,0),"globe_pole_raster",Rr,Kn,Ui);T.setupElevationDraw(Fi,le,ct),_.prepareDrawProgram(K,le,it.toUnwrapped()),Kt&&Er(le,di),jn&&(Bn=c.scale(c.create(),Bn,[1,-1,1]),Er(le,Pn))}}}}(w,C,P,m,y);else{const _=w.context,T=_.gl;let M,F;const U=w.options.showTerrainWireframe?2:0,K=(_e,we)=>{if(F===_e)return;const ke=[uo[_e]];we&&ke.push(uo[U]),M=w.useProgram("terrainRaster",null,ke),F=_e},ee=w.colorModeForRenderPass(),le=new c.DepthMode(T.LEQUAL,c.DepthMode.ReadWrite,w.depthRangeFor3D);Oo.update(y);const Z=w.transform,ce=Da(Z.zoom)*C.exaggeration();(U?[!1,!0]:[!1]).forEach(_e=>{F=-1;const we=_e?T.LINES:T.TRIANGLES,[ke,Be]=_e?C.getWirefameBuffer():[C.gridIndexBuffer,C.gridSegments];for(const Pe of m){const Ze=P.getTile(Pe),He=c.StencilMode.disabled,nt=C.prevTerrainTileForTile[Pe.key],Gt=C.terrainTileForTile[Pe.key];vr(nt,Gt)&&Oo.newMorphing(Pe.key,nt,Gt,y,250),_.activeTexture.set(T.TEXTURE0),Ze.texture.bind(T.LINEAR,T.CLAMP_TO_EDGE,T.LINEAR_MIPMAP_NEAREST);const Je=Oo.getMorphValuesForProxy(Pe.key),wt=Je?1:0;let ct;Je&&(ct={morphing:{srcDemTile:Je.from,dstDemTile:Je.to,phase:c.easeCubicInOut(Je.phase)}});const $t=sr(Pe.projMatrix,vo(Pe.canonical,Z.renderWorldCopies)?ce/10:ce);K(wt,_e),C.setupElevationDraw(Ze,M,ct),w.prepareDrawProgram(_,M,Pe.toUnwrapped()),M.draw(_,we,le,He,ee,c.CullFaceMode.backCCW,$t,"terrain_raster",C.gridBuffer,ke,Be)}})}}(l,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,l.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(0===this._drapedRenderBatches.length)return i+1;this.renderingToTexture=!0;const l=this.painter,p=this.painter.context,w=this.proxySourceCache,C=this.proxiedCoords[w.id],P=this._drapedRenderBatches.shift(),m=[],y=l.style.order;let _=0;for(const T of C){const M=w.getTileByID(T.proxyTileKey),F=w.proxyCachedFBO[T.key]?w.proxyCachedFBO[T.key][i]:void 0,U=void 0!==F?w.renderCache[F]:this.pool[_++],K=void 0!==F;if(M.texture=U.tex,K&&!U.dirty){m.push(M.tileID);continue}let ee;p.bindFramebuffer.set(U.fb.framebuffer),this.renderedToTile=!1,U.dirty&&(p.clear({color:c.Color.transparent,stencil:0}),U.dirty=!1);for(let le=P.start;le<=P.end;++le){const Z=l.style._layers[y[le]];if(Z.isHidden(l.transform.zoom))continue;const ce=l.style._getLayerSourceCache(Z),_e=ce?this.proxyToSource[T.key][ce.id]:[T];if(!_e)continue;const we=_e;p.viewport.set([0,0,U.fb.width,U.fb.height]),ee!==(ce?ce.id:null)&&(this._setupStencil(U,_e,Z,ce),ee=ce?ce.id:null),l.renderLayer(l,ce,Z,we)}this.renderedToTile?(U.dirty=!0,m.push(M.tileID)):K||--_,5===_&&(_=0,this.renderToBackBuffer(m))}return this.renderToBackBuffer(m),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,l.width,l.height]),P.end+1}postRender(){}renderCacheEfficiency(i){const l=i.order.length;if(0===l)return{efficiency:100};let p,w=0,C=0,P=!1;for(let m=0;m<l;++m){const y=i._layers[i.order[m]];this._style.isLayerDraped(y)?(P&&++w,++C):P||(P=!0,p=y.id)}return 0===C?{efficiency:100}:{efficiency:100*(1-w/C),firstUndrapedLayer:p}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(l=>l.dem).forEach(l=>{i=Math.min(i,l.dem.tree.minimums[0])}),0===i?i:(i-30)*this._exaggeration}raycast(i,l,p){if(!this._visibleDemTiles)return null;const w=this._visibleDemTiles.filter(C=>C.dem).map(C=>{const P=C.tileID,m=1<<P.overscaledZ,{x:y,y:_}=P.canonical,T=y/m,M=(y+1)/m,F=_/m,U=(_+1)/m;return{minx:T,miny:F,maxx:M,maxy:U,t:C.dem.tree.raycastRoot(T,F,M,U,i,l,p),tile:C}});w.sort((C,P)=>(null!==C.t?C.t:Number.MAX_VALUE)-(null!==P.t?P.t:Number.MAX_VALUE));for(const C of w){if(null==C.t)return null;const P=C.tile.dem.tree.raycast(C.minx,C.miny,C.maxx,C.maxy,i,l,p);if(null!=P)return P}return null}_createFBO(){const i=this.painter.context,l=i.gl,p=this.drapeBufferSize;i.activeTexture.set(l.TEXTURE0);const w=new c.Texture(i,{width:p[0],height:p[1],data:null},l.RGBA);w.bind(l.LINEAR,l.CLAMP_TO_EDGE);const C=i.createFramebuffer(p[0],p[1],!1);return C.colorAttachment.set(w.texture),C.depthAttachment=new re(i,C.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,C.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):C.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&l.texParameterf(l.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:C,tex:w,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const l=this._style._layers[i],p=l.isHidden(this.painter.transform.zoom);return"custom"===l.type?!p&&l.shouldRedrape():!p&&l.hasTransition()})}_clearLineLayersFromRenderCache(){let i=!1;for(const p of this._style._getSources())if(p instanceof Ye){i=!0;break}if(!i)return;const l={};for(let p=0;p<this._style.order.length;++p){const w=this._style._layers[this._style.order[p]],C=this._style._getLayerSourceCache(w);if(C&&!l[C.id]&&!w.isHidden(this.painter.transform.zoom)&&"line"===w.type&&w.widthExpression()instanceof c.ZoomDependentExpression){l[C.id]=!0;for(const P of this.proxyCoords){const m=this.proxyToSource[P.key][C.id];if(m)for(const y of m)this._clearRenderCacheForTile(C.id,y)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const p in this._style._sourceCaches)if(this._style._sourceCaches[p]._source instanceof ut){i=!0;break}if(!i)return;const l={};for(let p=0;p<this._style.order.length;++p){const w=this._style._layers[this._style.order[p]],C=this._style._getLayerSourceCache(w);if(!C||l[C.id]||w.isHidden(this.painter.transform.zoom)||"raster"!==w.type)continue;const P=w.paint.get("raster-fade-duration");for(const m of this.proxyCoords){const y=this.proxyToSource[m.key][C.id];if(y)for(const _ of y){const T=Sa(C.getTile(_),C.findLoadedParent(_,0),C,this.painter.transform,P);(1!==T.opacity||0!==T.mix)&&this._clearRenderCacheForTile(C.id,_)}}}}_setupDrapedRenderBatches(){const i=this._style.order,l=i.length;if(0===l)return;const p=[];let w,C=0,P=this._style._layers[i[C]];for(;!this._style.isLayerDraped(P)&&P.isHidden(this.painter.transform.zoom)&&++C<l;)P=this._style._layers[i[C]];for(;C<l;++C){const m=this._style._layers[i[C]];m.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(m)?void 0===w&&(w=C):void 0!==w&&(p.push({start:w,end:C-1}),w=void 0))}void 0!==w&&p.push({start:w,end:C-1}),this._drapedRenderBatches=p}_setupRenderCache(i){const l=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,l.renderCache.length>l.renderCachePool.length){const P=Object.values(l.proxyCachedFBO);l.proxyCachedFBO={};for(let m=0;m<P.length;++m){const y=Object.values(P[m]);l.renderCachePool.push(...y)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,w=this._tilesDirty;for(let P=p.length-1;P>=0;P--){const m=p[P];if(l.getTileByID(m.key),void 0!==l.proxyCachedFBO[m.key]){const y=i[m.key],_=this.proxyToSource[m.key];let T=0;for(const M in _){const F=_[M],U=y[M];if(!U||U.length!==F.length||F.some((K,ee)=>K!==U[ee]||w[M]&&w[M].hasOwnProperty(K.key))){T=-1;break}++T}for(const M in l.proxyCachedFBO[m.key])l.renderCache[l.proxyCachedFBO[m.key][M]].dirty=T<0||T!==Object.values(y).length}}const C=[...this._drapedRenderBatches];C.sort((P,m)=>m.end-m.start-(P.end-P.start));for(const P of C)for(const m of p){if(l.proxyCachedFBO[m.key])continue;let y=l.renderCachePool.pop();void 0===y&&l.renderCache.length<50&&(y=l.renderCache.length,l.renderCache.push(this._createFBO())),void 0!==y&&(l.proxyCachedFBO[m.key]={},l.proxyCachedFBO[m.key][P.start]=y,l.renderCache[y].dirty=!0)}this._tilesDirty={}}_setupStencil(i,l,p,w){if(!w||!this._sourceTilesOverlap[w.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const C=this.painter.context,P=C.gl;if(l.length<=1)return void(this._overlapStencilType=!1);let m;if(p.isTileClipped())m=l.length,this._overlapStencilMode.test={func:P.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(l[0].overscaledZ>l[l.length-1].overscaledZ))return void(this._overlapStencilType=!1);m=1,this._overlapStencilMode.test={func:P.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+m>255&&(C.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=m,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(l,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):c.StencilMode.disabled}_renderTileClippingMasks(i,l){const p=this.painter,w=this.painter.context,C=w.gl;p._tileClippingMaskIDs={},w.setColorMode(c.ColorMode.disabled),w.setDepthMode(c.DepthMode.disabled);const P=p.useProgram("clippingMask");for(const m of i){const y=p._tileClippingMaskIDs[m.key]=--l;P.draw(w,C.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:C.ALWAYS,mask:0},y,255,C.KEEP,C.KEEP,C.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,Is(m.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(i){const l=this.painter.transform;if(i.x<0||i.x>l.width||i.y<0||i.y>l.height)return null;const p=[i.x,i.y,1,1];c.transformMat4$1(p,p,l.pixelMatrixInverse),c.scale$1(p,p,1/p[3]),p[0]/=l.worldSize,p[1]/=l.worldSize;const w=l._camera.position,C=c.mercatorZfromAltitude(1,l.center.lat),P=[w[0],w[1],w[2]/C,0],m=c.subtract([],p.slice(0,3),P);c.normalize(m,m);const y=this.raycast(P,m,this._exaggeration);return null!==y&&y?(c.scaleAndAdd(P,P,m,y),P[3]=P[2],P[2]*=C,P):null}drawDepth(){const i=this.painter,l=i.context,p=this.proxySourceCache,w=Math.ceil(i.width),C=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===w&&this._depthFBO.height===C||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const P=l.gl,m=l.createFramebuffer(w,C,!0);l.activeTexture.set(P.TEXTURE0);const y=new c.Texture(l,{width:w,height:C,data:null},P.RGBA);y.bind(P.NEAREST,P.CLAMP_TO_EDGE),m.colorAttachment.set(y.texture);const _=l.createRenderbuffer(l.gl.DEPTH_COMPONENT16,w,C);m.depthAttachment.set(_),this._depthFBO=m,this._depthTexture=y}l.bindFramebuffer.set(this._depthFBO.framebuffer),l.viewport.set([0,0,w,C]),function(P,m,y,_){if("globe"===P.transform.projection.name)return;const T=P.context,M=T.gl;T.clear({depth:1});const F=P.useProgram("terrainDepth"),U=new c.DepthMode(M.LESS,c.DepthMode.ReadWrite,P.depthRangeFor3D);for(const K of _){const ee=y.getTile(K),le=sr(K.projMatrix,0);m.setupElevationDraw(ee,F),F.draw(T,M.TRIANGLES,U,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.backCCW,le,"terrain_depth",m.gridBuffer,m.gridIndexBuffer,m.gridNoSkirtSegments)}}(i,this,p,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,l,p){if(i.getSource()instanceof cn)return this._setupProxiedCoordsForImageSource(i,l,p);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const w=this.proxiedCoords[i.id]=[],C=this.proxyCoords;for(let m=0;m<C.length;m++){const y=C[m],_=this._findTileCoveringTileID(y,i);if(_){const T=this._createProxiedId(y,_,p[y.key]&&p[y.key][i.id]);w.push(T),this.proxyToSource[y.key][i.id]=[T]}}let P=!1;for(let m=0;m<l.length;m++){const y=i.getTile(l[m]);if(!y||!y.hasData())continue;const _=this._findTileCoveringTileID(y.tileID,this.proxySourceCache);if(_&&_.tileID.canonical.z!==y.tileID.canonical.z){const T=this.proxyToSource[_.tileID.key][i.id],M=this._createProxiedId(_.tileID,y,p[_.tileID.key]&&p[_.tileID.key][i.id]);T?T.splice(T.length-1,0,M):this.proxyToSource[_.tileID.key][i.id]=[M],w.push(M),P=!0}}this._sourceTilesOverlap[i.id]=P}_setupProxiedCoordsForImageSource(i,l,p){if(!i.getSource().loaded())return;const w=this.proxiedCoords[i.id]=[],C=this.proxyCoords,P=i.getSource(),m=new c.Point(P.tileID.x,P.tileID.y)._div(1<<P.tileID.z),y=P.coordinates.map(c.MercatorCoordinate.fromLngLat).reduce((T,M)=>(T.min.x=Math.min(T.min.x,M.x-m.x),T.min.y=Math.min(T.min.y,M.y-m.y),T.max.x=Math.max(T.max.x,M.x-m.x),T.max.y=Math.max(T.max.y,M.y-m.y),T),{min:new c.Point(Number.MAX_VALUE,Number.MAX_VALUE),max:new c.Point(-Number.MAX_VALUE,-Number.MAX_VALUE)}),_=(T,M)=>{const F=T.wrap+T.canonical.x/(1<<T.canonical.z),U=T.canonical.y/(1<<T.canonical.z),K=c.EXTENT/(1<<T.canonical.z),ee=M.wrap+M.canonical.x/(1<<M.canonical.z),le=M.canonical.y/(1<<M.canonical.z);return F+K<ee+y.min.x||F>ee+y.max.x||U+K<le+y.min.y||U>le+y.max.y};for(let T=0;T<C.length;T++){const M=C[T];for(let F=0;F<l.length;F++){const U=i.getTile(l[F]);if(!U||!U.hasData()||_(M,U.tileID))continue;const K=this._createProxiedId(M,U,p[M.key]&&p[M.key][i.id]),ee=this.proxyToSource[M.key][i.id];ee?ee.push(K):this.proxyToSource[M.key][i.id]=[K],w.push(K)}}}_createProxiedId(i,l,p){let w=this.orthoMatrix;if(p){const C=p.find(P=>P.key===l.tileID.key);if(C)return C}if(l.tileID.key!==i.key){const C=i.canonical.z-l.tileID.canonical.z;let P,m,y;w=c.create();const _=l.tileID.wrap-i.wrap<<i.overscaledZ;C>0?(P=c.EXTENT>>C,m=P*((l.tileID.canonical.x<<C)-i.canonical.x+_),y=P*((l.tileID.canonical.y<<C)-i.canonical.y)):(P=c.EXTENT<<-C,m=c.EXTENT*(l.tileID.canonical.x-(i.canonical.x+_<<-C)),y=c.EXTENT*(l.tileID.canonical.y-(i.canonical.y<<-C))),c.ortho(w,0,P,0,P,0,1),c.translate(w,w,[m,y,0])}return new Ps(l.tileID,i.key,w)}_findTileCoveringTileID(i,l){let p=l.getTile(i);if(p&&p.hasData())return p;const w=this._findCoveringTileCache[l.id],C=w[i.key];if(p=C?l.getTileByID(C):null,p&&p.hasData()||null===C)return p;let P=p?p.tileID:i,m=P.overscaledZ;const y=l.getSource().minzoom,_=[];if(!C){const M=l.getSource().maxzoom;if(i.canonical.z>=M){const F=i.canonical.z-M;l.getSource().reparseOverscaled?(m=Math.max(i.canonical.z+2,l.transform.tileZoom),P=new c.OverscaledTileID(m,i.wrap,M,i.canonical.x>>F,i.canonical.y>>F)):0!==F&&(m=M,P=new c.OverscaledTileID(m,i.wrap,M,i.canonical.x>>F,i.canonical.y>>F))}P.key!==i.key&&(_.push(P.key),p=l.getTile(P))}const T=M=>{_.forEach(F=>{w[F]=M}),_.length=0};for(m-=1;m>=y&&(!p||!p.hasData());m--){p&&T(p.tileID.key);const M=P.calculateScaledKey(m);if(p=l.getTileByID(M),p&&p.hasData())break;const F=w[M];if(null===F)break;void 0===F?_.push(M):p=l.getTileByID(F)}return T(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,l){let p=this._tilesDirty[i];p||(p=this._tilesDirty[i]={}),p[l.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(l){let p=0;const w=new c.StructArrayLayout2ui4,C=131;for(let P=1;P<129;P++){for(let m=1;m<129;m++)p=P*C+m,w.emplaceBack(p,p+1),w.emplaceBack(p,p+C),w.emplaceBack(p+1,p+C),128===P&&w.emplaceBack(p+C,p+C+1);w.emplaceBack(p+1,p+1+C)}return w}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=c.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class mi{static cacheKey(i,l,p,w){let C=`${l}${w?w.cacheKey:""}`;for(const P of p)i.usedDefines.includes(P)&&(C+=`/${P}`);return C}constructor(i,l,p,w,C,P){const m=i.gl;this.program=m.createProgram();const y=function(Z){const ce=[];for(let _e=0;_e<Z.length;_e++){if(null===Z[_e])continue;const we=Z[_e].split(" ");ce.push(we.pop())}return ce}(p.staticAttributes),_=w?w.getBinderAttributes():[],T=y.concat(_);let M=w?w.defines():[];M=M.concat(P.map(Z=>`#define ${Z}`));const F=i.isWebGL2?"#version 300 es\n":"",U=F+M.concat(i.extStandardDerivatives&&0===F.length?"#extension GL_OES_standard_derivatives : enable\n".concat(xs):xs,xs,Yo,qs.fragmentSource,Gr.fragmentSource,p.fragmentSource).join("\n"),K=F+M.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",Yo,qs.vertexSource,Gr.vertexSource,da.vertexSource,p.vertexSource).join("\n"),ee=m.createShader(m.FRAGMENT_SHADER);if(m.isContextLost())return void(this.failedToCreate=!0);m.shaderSource(ee,U),m.compileShader(ee),m.attachShader(this.program,ee);const le=m.createShader(m.VERTEX_SHADER);if(m.isContextLost())this.failedToCreate=!0;else{m.shaderSource(le,K),m.compileShader(le),m.attachShader(this.program,le),this.attributes={},this.numAttributes=T.length;for(let Z=0;Z<this.numAttributes;Z++)T[Z]&&(m.bindAttribLocation(this.program,Z,T[Z]),this.attributes[T[Z]]=Z);m.linkProgram(this.program),m.deleteShader(le),m.deleteShader(ee),this.fixedUniforms=C(i),this.binderUniforms=w?w.getUniforms(i):[],P.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new c.Uniform1i(Z=i),u_dem_prev:new c.Uniform1i(Z),u_dem_unpack:new c.Uniform4f(Z),u_dem_tl:new c.Uniform2f(Z),u_dem_scale:new c.Uniform1f(Z),u_dem_tl_prev:new c.Uniform2f(Z),u_dem_scale_prev:new c.Uniform1f(Z),u_dem_size:new c.Uniform1f(Z),u_dem_lerp:new c.Uniform1f(Z),u_exaggeration:new c.Uniform1f(Z),u_depth:new c.Uniform1i(Z),u_depth_size_inv:new c.Uniform2f(Z),u_meter_to_dem:new c.Uniform1f(Z),u_label_plane_matrix_inv:new c.UniformMatrix4f(Z)}),P.includes("GLOBE")&&(this.globeUniforms=(Z=>({u_tile_tl_up:new c.Uniform3f(Z),u_tile_tr_up:new c.Uniform3f(Z),u_tile_br_up:new c.Uniform3f(Z),u_tile_bl_up:new c.Uniform3f(Z),u_tile_up_scale:new c.Uniform1f(Z)}))(i)),P.includes("FOG")&&(this.fogUniforms=(Z=>({u_fog_matrix:new c.UniformMatrix4f(Z),u_fog_range:new c.Uniform2f(Z),u_fog_color:new c.Uniform4f(Z),u_fog_horizon_blend:new c.Uniform1f(Z),u_fog_temporal_offset:new c.Uniform1f(Z),u_frustum_tl:new c.Uniform3f(Z),u_frustum_tr:new c.Uniform3f(Z),u_frustum_br:new c.Uniform3f(Z),u_frustum_bl:new c.Uniform3f(Z),u_globe_pos:new c.Uniform3f(Z),u_globe_radius:new c.Uniform1f(Z),u_globe_transition:new c.Uniform1f(Z),u_is_globe:new c.Uniform1i(Z),u_viewport:new c.Uniform2f(Z)}))(i))}var Z}setTerrainUniformValues(i,l){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const w in l)p[w]&&p[w].set(this.program,w,l[w])}}setGlobeUniformValues(i,l){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const w in l)p[w]&&p[w].set(this.program,w,l[w])}}setFogUniformValues(i,l){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const w in l)p[w].set(this.program,w,l[w])}}draw(i,l,p,w,C,P,m,y,_,T,M,F,U,K,ee){const le=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(p),i.setStencilMode(w),i.setColorMode(C),i.setCullFace(P);for(const ce of Object.keys(this.fixedUniforms))this.fixedUniforms[ce].set(this.program,ce,m[ce]);K&&K.setUniforms(this.program,i,this.binderUniforms,F,{zoom:U});const Z={[le.LINES]:2,[le.TRIANGLES]:3,[le.LINE_STRIP]:1}[l];for(const ce of M.get()){const _e=ce.vaos||(ce.vaos={});(_e[y]||(_e[y]=new Ya)).bind(i,this,_,K?K.getPaintVertexBuffers():[],T,ce.vertexOffset,ee||[]),le.drawElements(l,ce.primitiveLength*Z,le.UNSIGNED_SHORT,ce.primitiveOffset*Z*2)}}}function Pr(h,i){const l=Math.pow(2,i.tileID.overscaledZ),p=i.tileSize*Math.pow(2,h.transform.tileZoom)/l,w=p*(i.tileID.canonical.x+i.tileID.wrap*l),C=p*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture.size,u_tile_units_to_pixels:1/at(i,1,h.transform.tileZoom),u_pixel_coord_upper:[w>>16,C>>16],u_pixel_coord_lower:[65535&w,65535&C]}}const bs=c.create(),xr=(h,i,l,p,w,C,P,m,y,_,T)=>{const M=i.style.light,F=M.properties.get("position"),U=[F.x,F.y,F.z],K=c.create$1();"viewport"===M.properties.get("anchor")&&(c.fromRotation(K,-i.transform.angle),c.transformMat3(U,U,K));const ee=M.properties.get("color"),le=i.transform,Z={u_matrix:h,u_lightpos:U,u_lightintensity:M.properties.get("intensity"),u_lightcolor:[ee.r,ee.g,ee.b],u_vertical_gradient:+l,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:bs,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:w,u_edge_radius:C};return"globe"===le.projection.name&&(Z.u_tile_id=[P.canonical.x,P.canonical.y,1<<P.canonical.z],Z.u_zoom_transition=y,Z.u_inv_rot_matrix=T,Z.u_merc_center=_,Z.u_up_dir=le.projection.upVector(new c.CanonicalTileID(0,0,0),_[0]*c.EXTENT,_[1]*c.EXTENT),Z.u_height_lift=m),Z},Aa=(h,i,l,p,w,C,P,m,y,_,T,M)=>{const F=xr(h,i,l,p,w,C,P,y,_,T,M),U={u_height_factor:-Math.pow(2,P.overscaledZ)/m.tileSize/8};return c.extend(F,Pr(i,m),U)},Fo=h=>({u_matrix:h}),Bo=(h,i,l)=>c.extend(Fo(h),Pr(i,l)),ho=(h,i)=>({u_matrix:h,u_world:i}),pa=(h,i,l,p)=>c.extend(Bo(h,i,l),{u_world:p}),ks=c.create(),Xn=(h,i,l,p,w,C)=>{const P=h.transform,m="globe"===P.projection.name;let y;if("map"===C.paint.get("circle-pitch-alignment"))if(m){const T=c.globePixelsToTileUnits(P.zoom,i.canonical)*P._pixelsPerMercatorPixel;y=Float32Array.from([T,0,0,T])}else y=P.calculatePixelsToTileUnitsMatrix(l);else y=new Float32Array([P.pixelsToGLUnits[0],0,0,P.pixelsToGLUnits[1]]);const _={u_camera_to_center_distance:P.cameraToCenterDistance,u_matrix:h.translatePosMatrix(i.projMatrix,l,C.paint.get("circle-translate"),C.paint.get("circle-translate-anchor")),u_device_pixel_ratio:c.exported.devicePixelRatio,u_extrude_scale:y,u_inv_rot_matrix:ks,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(m){_.u_inv_rot_matrix=p,_.u_merc_center=w,_.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],_.u_zoom_transition=c.globeToMercatorTransition(P.zoom);const T=w[0]*c.EXTENT,M=w[1]*c.EXTENT;_.u_up_dir=P.projection.upVector(new c.CanonicalTileID(0,0,0),T,M)}return _},Ki=h=>{const i=[];return"map"===h.paint.get("circle-pitch-alignment")&&i.push("PITCH_WITH_MAP"),"map"===h.paint.get("circle-pitch-scale")&&i.push("SCALE_WITH_MAP"),i},Ha=(h,i,l,p)=>{const w=c.EXTENT/l.tileSize;return{u_matrix:h,u_camera_to_center_distance:i.getCameraToCenterDistance(p),u_extrude_scale:[i.pixelsToGLUnits[0]/w,i.pixelsToGLUnits[1]/w]}},fs=(h,i,l=1)=>({u_matrix:h,u_color:i,u_overlay:0,u_overlay_scale:l}),ta=c.create(),na=(h,i,l,p,w,C,P)=>{const m=h.transform,y="globe"===m.projection.name,_=y?c.globePixelsToTileUnits(m.zoom,i.canonical)*m._pixelsPerMercatorPixel:at(l,1,C),T={u_matrix:i.projMatrix,u_extrude_scale:_,u_intensity:P,u_inv_rot_matrix:ta,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(y){T.u_inv_rot_matrix=p,T.u_merc_center=w,T.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],T.u_zoom_transition=c.globeToMercatorTransition(m.zoom);const M=w[0]*c.EXTENT,F=w[1]*c.EXTENT;T.u_up_dir=m.projection.upVector(new c.CanonicalTileID(0,0,0),M,F)}return T},Fa=(h,i,l,p,w,C,P)=>{const m=h.transform,y=m.calculatePixelsToTileUnitsMatrix(i);return{u_matrix:Nt(h,i,l,p),u_pixels_to_tile_units:y,u_device_pixel_ratio:C,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:w,u_texsize:Pi(l)?i.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:ps(i,h.transform),u_alpha_discard_threshold:0,u_trim_offset:P}},Zs=(h,i,l,p,w)=>{const C=h.transform;return{u_matrix:Nt(h,i,l,p),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:C.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:w,u_image:0,u_tile_units_to_pixels:ps(i,C),u_units_to_pixels:[1/C.pixelsToGLUnits[0],1/C.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function ps(h,i){return 1/at(h,1,i.tileZoom)}function Nt(h,i,l,p){return h.translatePosMatrix(p||i.tileID.projMatrix,i,l.paint.get("line-translate"),l.paint.get("line-translate-anchor"))}function Pi(h){const i=h.paint.get("line-dasharray").value;return i.value||"constant"!==i.kind}const Ba=(h,i,l,p,w,C)=>{return{u_matrix:h,u_tl_parent:i,u_scale_parent:l,u_fade_t:p.mix,u_opacity:p.opacity*w.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:w.paint.get("raster-brightness-min"),u_brightness_high:w.paint.get("raster-brightness-max"),u_saturation_factor:(m=w.paint.get("raster-saturation"),m>0?1-1/(1.001-m):-m),u_contrast_factor:(P=w.paint.get("raster-contrast"),P>0?1/(1-P):1+P),u_spin_weights:Qo(w.paint.get("raster-hue-rotate")),u_perspective_transform:C};var P,m};function Qo(h){h*=Math.PI/180;const i=Math.sin(h),l=Math.cos(h);return[(2*l+1)/3,(-Math.sqrt(3)*i-l+1)/3,(Math.sqrt(3)*i-l+1)/3]}const hr=c.create(),es=(h,i,l,p,w,C,P,m,y,_,T,M,F,U,K,ee)=>{const le=w.transform,Z={u_is_size_zoom_constant:+("constant"===h||"source"===h),u_is_size_feature_constant:+("constant"===h||"camera"===h),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:le.cameraToCenterDistance,u_rotate_symbol:+l,u_aspect_ratio:le.width/le.height,u_fade_change:w.options.fadeDuration?w.symbolFadeChange:1,u_matrix:C,u_label_plane_matrix:P,u_coord_matrix:m,u_is_text:+y,u_pitch_with_map:+p,u_texsize:_,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:hr,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:hr,u_up_vector:[0,-1,0]};return"globe"===ee.name&&(Z.u_tile_id=[T.canonical.x,T.canonical.y,1<<T.canonical.z],Z.u_zoom_transition=M,Z.u_inv_rot_matrix=U,Z.u_merc_center=F,Z.u_camera_forward=le._camera.forward(),Z.u_ecef_origin=c.globeECEFOrigin(le.globeMatrix,T.toUnwrapped()),Z.u_tile_matrix=Float32Array.from(le.globeMatrix),Z.u_up_vector=K),Z},xo=(h,i,l,p,w,C,P,m,y,_,T,M,F,U,K,ee,le)=>c.extend(es(h,i,l,p,w,C,P,m,y,_,M,F,U,K,ee,le),{u_gamma_scale:p?w.transform.cameraToCenterDistance*Math.cos(w.terrain?0:w.transform._pitch):1,u_device_pixel_ratio:c.exported.devicePixelRatio,u_is_halo:+T}),wr=(h,i,l,p,w,C,P,m,y,_,T,M,F,U,K,ee)=>c.extend(xo(h,i,l,p,w,C,P,m,!0,y,!0,T,M,F,U,K,ee),{u_texsize_icon:_,u_texture_icon:1}),ma=(h,i,l)=>({u_matrix:h,u_opacity:i,u_color:l}),ga=(h,i,l,p,w)=>c.extend(function(C,P,m){const y=P.imageManager.getPattern(C.toString()),{width:_,height:T}=P.imageManager.getPixelSize(),M=Math.pow(2,m.tileID.overscaledZ),F=m.tileSize*Math.pow(2,P.transform.tileZoom)/M,U=F*(m.tileID.canonical.x+m.tileID.wrap*M),K=F*m.tileID.canonical.y;return{u_image:0,u_pattern_tl:y.tl,u_pattern_br:y.br,u_texsize:[_,T],u_pattern_size:y.displaySize,u_tile_units_to_pixels:1/at(m,1,P.transform.tileZoom),u_pixel_coord_upper:[U>>16,K>>16],u_pixel_coord_lower:[65535&U,65535&K]}}(p,l,w),{u_matrix:h,u_opacity:i}),Es={fillExtrusion:h=>({u_matrix:new c.UniformMatrix4f(h),u_lightpos:new c.Uniform3f(h),u_lightintensity:new c.Uniform1f(h),u_lightcolor:new c.Uniform3f(h),u_vertical_gradient:new c.Uniform1f(h),u_opacity:new c.Uniform1f(h),u_edge_radius:new c.Uniform1f(h),u_ao:new c.Uniform2f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_up_dir:new c.Uniform3f(h),u_height_lift:new c.Uniform1f(h)}),fillExtrusionPattern:h=>({u_matrix:new c.UniformMatrix4f(h),u_lightpos:new c.Uniform3f(h),u_lightintensity:new c.Uniform1f(h),u_lightcolor:new c.Uniform3f(h),u_vertical_gradient:new c.Uniform1f(h),u_height_factor:new c.Uniform1f(h),u_edge_radius:new c.Uniform1f(h),u_ao:new c.Uniform2f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_up_dir:new c.Uniform3f(h),u_height_lift:new c.Uniform1f(h),u_image:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_pixel_coord_upper:new c.Uniform2f(h),u_pixel_coord_lower:new c.Uniform2f(h),u_tile_units_to_pixels:new c.Uniform1f(h),u_opacity:new c.Uniform1f(h)}),fill:h=>({u_matrix:new c.UniformMatrix4f(h)}),fillPattern:h=>({u_matrix:new c.UniformMatrix4f(h),u_image:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_pixel_coord_upper:new c.Uniform2f(h),u_pixel_coord_lower:new c.Uniform2f(h),u_tile_units_to_pixels:new c.Uniform1f(h)}),fillOutline:h=>({u_matrix:new c.UniformMatrix4f(h),u_world:new c.Uniform2f(h)}),fillOutlinePattern:h=>({u_matrix:new c.UniformMatrix4f(h),u_world:new c.Uniform2f(h),u_image:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_pixel_coord_upper:new c.Uniform2f(h),u_pixel_coord_lower:new c.Uniform2f(h),u_tile_units_to_pixels:new c.Uniform1f(h)}),circle:h=>({u_camera_to_center_distance:new c.Uniform1f(h),u_extrude_scale:new c.UniformMatrix2f(h),u_device_pixel_ratio:new c.Uniform1f(h),u_matrix:new c.UniformMatrix4f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_up_dir:new c.Uniform3f(h)}),collisionBox:h=>({u_matrix:new c.UniformMatrix4f(h),u_camera_to_center_distance:new c.Uniform1f(h),u_extrude_scale:new c.Uniform2f(h)}),collisionCircle:h=>({u_matrix:new c.UniformMatrix4f(h),u_inv_matrix:new c.UniformMatrix4f(h),u_camera_to_center_distance:new c.Uniform1f(h),u_viewport_size:new c.Uniform2f(h)}),debug:h=>({u_color:new c.UniformColor(h),u_matrix:new c.UniformMatrix4f(h),u_overlay:new c.Uniform1i(h),u_overlay_scale:new c.Uniform1f(h)}),clippingMask:h=>({u_matrix:new c.UniformMatrix4f(h)}),heatmap:h=>({u_extrude_scale:new c.Uniform1f(h),u_intensity:new c.Uniform1f(h),u_matrix:new c.UniformMatrix4f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_up_dir:new c.Uniform3f(h)}),heatmapTexture:h=>({u_image:new c.Uniform1i(h),u_color_ramp:new c.Uniform1i(h),u_opacity:new c.Uniform1f(h)}),hillshade:h=>({u_matrix:new c.UniformMatrix4f(h),u_image:new c.Uniform1i(h),u_latrange:new c.Uniform2f(h),u_light:new c.Uniform2f(h),u_shadow:new c.UniformColor(h),u_highlight:new c.UniformColor(h),u_accent:new c.UniformColor(h)}),hillshadePrepare:h=>({u_matrix:new c.UniformMatrix4f(h),u_image:new c.Uniform1i(h),u_dimension:new c.Uniform2f(h),u_zoom:new c.Uniform1f(h),u_unpack:new c.Uniform4f(h)}),line:h=>({u_matrix:new c.UniformMatrix4f(h),u_pixels_to_tile_units:new c.UniformMatrix2f(h),u_device_pixel_ratio:new c.Uniform1f(h),u_units_to_pixels:new c.Uniform2f(h),u_dash_image:new c.Uniform1i(h),u_gradient_image:new c.Uniform1i(h),u_image_height:new c.Uniform1f(h),u_texsize:new c.Uniform2f(h),u_tile_units_to_pixels:new c.Uniform1f(h),u_alpha_discard_threshold:new c.Uniform1f(h),u_trim_offset:new c.Uniform2f(h)}),linePattern:h=>({u_matrix:new c.UniformMatrix4f(h),u_texsize:new c.Uniform2f(h),u_pixels_to_tile_units:new c.UniformMatrix2f(h),u_device_pixel_ratio:new c.Uniform1f(h),u_image:new c.Uniform1i(h),u_units_to_pixels:new c.Uniform2f(h),u_tile_units_to_pixels:new c.Uniform1f(h),u_alpha_discard_threshold:new c.Uniform1f(h)}),raster:h=>({u_matrix:new c.UniformMatrix4f(h),u_tl_parent:new c.Uniform2f(h),u_scale_parent:new c.Uniform1f(h),u_fade_t:new c.Uniform1f(h),u_opacity:new c.Uniform1f(h),u_image0:new c.Uniform1i(h),u_image1:new c.Uniform1i(h),u_brightness_low:new c.Uniform1f(h),u_brightness_high:new c.Uniform1f(h),u_saturation_factor:new c.Uniform1f(h),u_contrast_factor:new c.Uniform1f(h),u_spin_weights:new c.Uniform3f(h),u_perspective_transform:new c.Uniform2f(h)}),symbolIcon:h=>({u_is_size_zoom_constant:new c.Uniform1i(h),u_is_size_feature_constant:new c.Uniform1i(h),u_size_t:new c.Uniform1f(h),u_size:new c.Uniform1f(h),u_camera_to_center_distance:new c.Uniform1f(h),u_rotate_symbol:new c.Uniform1i(h),u_aspect_ratio:new c.Uniform1f(h),u_fade_change:new c.Uniform1f(h),u_matrix:new c.UniformMatrix4f(h),u_label_plane_matrix:new c.UniformMatrix4f(h),u_coord_matrix:new c.UniformMatrix4f(h),u_is_text:new c.Uniform1i(h),u_pitch_with_map:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_camera_forward:new c.Uniform3f(h),u_tile_matrix:new c.UniformMatrix4f(h),u_up_vector:new c.Uniform3f(h),u_ecef_origin:new c.Uniform3f(h),u_texture:new c.Uniform1i(h)}),symbolSDF:h=>({u_is_size_zoom_constant:new c.Uniform1i(h),u_is_size_feature_constant:new c.Uniform1i(h),u_size_t:new c.Uniform1f(h),u_size:new c.Uniform1f(h),u_camera_to_center_distance:new c.Uniform1f(h),u_rotate_symbol:new c.Uniform1i(h),u_aspect_ratio:new c.Uniform1f(h),u_fade_change:new c.Uniform1f(h),u_matrix:new c.UniformMatrix4f(h),u_label_plane_matrix:new c.UniformMatrix4f(h),u_coord_matrix:new c.UniformMatrix4f(h),u_is_text:new c.Uniform1i(h),u_pitch_with_map:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_texture:new c.Uniform1i(h),u_gamma_scale:new c.Uniform1f(h),u_device_pixel_ratio:new c.Uniform1f(h),u_tile_id:new c.Uniform3f(h),u_zoom_transition:new c.Uniform1f(h),u_inv_rot_matrix:new c.UniformMatrix4f(h),u_merc_center:new c.Uniform2f(h),u_camera_forward:new c.Uniform3f(h),u_tile_matrix:new c.UniformMatrix4f(h),u_up_vector:new c.Uniform3f(h),u_ecef_origin:new c.Uniform3f(h),u_is_halo:new c.Uniform1i(h)}),symbolTextAndIcon:h=>({u_is_size_zoom_constant:new c.Uniform1i(h),u_is_size_feature_constant:new c.Uniform1i(h),u_size_t:new c.Uniform1f(h),u_size:new c.Uniform1f(h),u_camera_to_center_distance:new c.Uniform1f(h),u_rotate_symbol:new c.Uniform1i(h),u_aspect_ratio:new c.Uniform1f(h),u_fade_change:new c.Uniform1f(h),u_matrix:new c.UniformMatrix4f(h),u_label_plane_matrix:new c.UniformMatrix4f(h),u_coord_matrix:new c.UniformMatrix4f(h),u_is_text:new c.Uniform1i(h),u_pitch_with_map:new c.Uniform1i(h),u_texsize:new c.Uniform2f(h),u_texsize_icon:new c.Uniform2f(h),u_texture:new c.Uniform1i(h),u_texture_icon:new c.Uniform1i(h),u_gamma_scale:new c.Uniform1f(h),u_device_pixel_ratio:new c.Uniform1f(h),u_is_halo:new c.Uniform1i(h)}),background:h=>({u_matrix:new c.UniformMatrix4f(h),u_opacity:new c.Uniform1f(h),u_color:new c.UniformColor(h)}),backgroundPattern:h=>({u_matrix:new c.UniformMatrix4f(h),u_opacity:new c.Uniform1f(h),u_image:new c.Uniform1i(h),u_pattern_tl:new c.Uniform2f(h),u_pattern_br:new c.Uniform2f(h),u_texsize:new c.Uniform2f(h),u_pattern_size:new c.Uniform2f(h),u_pixel_coord_upper:new c.Uniform2f(h),u_pixel_coord_lower:new c.Uniform2f(h),u_tile_units_to_pixels:new c.Uniform1f(h)}),terrainRaster:ds,terrainDepth:ds,skybox:h=>({u_matrix:new c.UniformMatrix4f(h),u_sun_direction:new c.Uniform3f(h),u_cubemap:new c.Uniform1i(h),u_opacity:new c.Uniform1f(h),u_temporal_offset:new c.Uniform1f(h)}),skyboxGradient:h=>({u_matrix:new c.UniformMatrix4f(h),u_color_ramp:new c.Uniform1i(h),u_center_direction:new c.Uniform3f(h),u_radius:new c.Uniform1f(h),u_opacity:new c.Uniform1f(h),u_temporal_offset:new c.Uniform1f(h)}),skyboxCapture:h=>({u_matrix_3f:new c.UniformMatrix3f(h),u_sun_direction:new c.Uniform3f(h),u_sun_intensity:new c.Uniform1f(h),u_color_tint_r:new c.Uniform4f(h),u_color_tint_m:new c.Uniform4f(h),u_luminance:new c.Uniform1f(h)}),globeRaster:h=>({u_proj_matrix:new c.UniformMatrix4f(h),u_globe_matrix:new c.UniformMatrix4f(h),u_normalize_matrix:new c.UniformMatrix4f(h),u_merc_matrix:new c.UniformMatrix4f(h),u_zoom_transition:new c.Uniform1f(h),u_merc_center:new c.Uniform2f(h),u_image0:new c.Uniform1i(h),u_grid_matrix:new c.UniformMatrix3f(h),u_skirt_height:new c.Uniform1f(h),u_frustum_tl:new c.Uniform3f(h),u_frustum_tr:new c.Uniform3f(h),u_frustum_br:new c.Uniform3f(h),u_frustum_bl:new c.Uniform3f(h),u_globe_pos:new c.Uniform3f(h),u_globe_radius:new c.Uniform1f(h),u_viewport:new c.Uniform2f(h)}),globeAtmosphere:h=>({u_frustum_tl:new c.Uniform3f(h),u_frustum_tr:new c.Uniform3f(h),u_frustum_br:new c.Uniform3f(h),u_frustum_bl:new c.Uniform3f(h),u_horizon:new c.Uniform1f(h),u_transition:new c.Uniform1f(h),u_fadeout_range:new c.Uniform1f(h),u_color:new c.Uniform4f(h),u_high_color:new c.Uniform4f(h),u_space_color:new c.Uniform4f(h),u_star_intensity:new c.Uniform1f(h),u_star_density:new c.Uniform1f(h),u_star_size:new c.Uniform1f(h),u_temporal_offset:new c.Uniform1f(h),u_horizon_angle:new c.Uniform1f(h),u_rotation_matrix:new c.UniformMatrix4f(h)})};let _a;function ia(h,i,l,p,w,C,P){const m=h.context,y=m.gl,_=h.transform,T=h.useProgram("collisionBox"),M=[];let F=0,U=0;for(let we=0;we<p.length;we++){const ke=p[we],Be=i.getTile(ke),Pe=Be.getBucket(l);if(!Pe)continue;const Ze=Vr(ke,Pe,_);let He=Ze;0===w[0]&&0===w[1]||(He=h.translatePosMatrix(Ze,Be,w,C));const nt=P?Pe.textCollisionBox:Pe.iconCollisionBox,Gt=Pe.collisionCircleArray;if(Gt.length>0){const Je=c.create(),wt=He;c.mul(Je,Pe.placementInvProjMatrix,_.glCoordMatrix),c.mul(Je,Je,Pe.placementViewportMatrix),M.push({circleArray:Gt,circleOffset:U,transform:wt,invTransform:Je,projection:Pe.getProjection()}),F+=Gt.length/4,U=F}nt&&(h.terrain&&h.terrain.setupElevationDraw(Be,T),T.draw(m,y.LINES,c.DepthMode.disabled,c.StencilMode.disabled,h.colorModeForRenderPass(),c.CullFaceMode.disabled,Ha(He,_,Be,Pe.getProjection()),l.id,nt.layoutVertexBuffer,nt.indexBuffer,nt.segments,null,_.zoom,null,[nt.collisionVertexBuffer,nt.collisionVertexBufferExt]))}if(!P||!M.length)return;const K=h.useProgram("collisionCircle"),ee=new c.StructArrayLayout2f1f2i16;ee.resize(4*F),ee._trim();let le=0;for(const we of M)for(let ke=0;ke<we.circleArray.length/4;ke++){const Be=4*ke,Pe=we.circleArray[Be+0],Ze=we.circleArray[Be+1],He=we.circleArray[Be+2],nt=we.circleArray[Be+3];ee.emplace(le++,Pe,Ze,He,nt,0),ee.emplace(le++,Pe,Ze,He,nt,1),ee.emplace(le++,Pe,Ze,He,nt,2),ee.emplace(le++,Pe,Ze,He,nt,3)}(!_a||_a.length<2*F)&&(_a=function(we){const ke=2*we,Be=new c.StructArrayLayout3ui6;Be.resize(ke),Be._trim();for(let Pe=0;Pe<ke;Pe++){const Ze=6*Pe;Be.uint16[Ze+0]=4*Pe+0,Be.uint16[Ze+1]=4*Pe+1,Be.uint16[Ze+2]=4*Pe+2,Be.uint16[Ze+3]=4*Pe+2,Be.uint16[Ze+4]=4*Pe+3,Be.uint16[Ze+5]=4*Pe+0}return Be}(F));const Z=m.createIndexBuffer(_a,!0),ce=m.createVertexBuffer(ee,c.collisionCircleLayout.members,!0);for(const we of M){const ke={u_matrix:we.transform,u_inv_matrix:we.invTransform,u_camera_to_center_distance:(_e=_).getCameraToCenterDistance(we.projection),u_viewport_size:[_e.width,_e.height]};K.draw(m,y.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,h.colorModeForRenderPass(),c.CullFaceMode.disabled,ke,l.id,ce,Z,c.SegmentVector.simpleSegment(0,2*we.circleOffset,we.circleArray.length,we.circleArray.length/2),null,_.zoom)}var _e;ce.destroy(),Z.destroy()}const oo=c.create();function zo({width:h,height:i,anchor:l,textOffset:p,textScale:w},C){const{horizontalAlign:P,verticalAlign:m}=c.getAnchorAlignment(l),y=-(P-.5)*h,_=-(m-.5)*i,T=c.evaluateVariableOffset(l,p);return new c.Point((y/w+T[0])*C,(_/w+T[1])*C)}function ra(h,i,l,p,w,C,P,m,y,_,T){const M=h.text.placedSymbolArray,F=h.text.dynamicLayoutVertexArray,U=h.icon.dynamicLayoutVertexArray,K={},ee=h.getProjection(),le=Li(m,ee,C),Z=C.elevation,ce=ee.upVectorScale(m.canonical,C.center.lat,C.worldSize).metersToTile;F.clear();for(let _e=0;_e<M.length;_e++){const we=M.get(_e),{tileAnchorX:ke,tileAnchorY:Be,numGlyphs:Pe}=we,Ze=we.hidden||!we.crossTileID||h.allowVerticalPlacement&&!we.placedOrientation?null:p[we.crossTileID];if(Ze){let He=0,nt=0,Gt=0;if(Z){const Kt=Z?Z.getAtTileOffset(m,ke,Be):0,[jn,di,Pn]=ee.upVector(m.canonical,ke,Be);He=Kt*jn*ce,nt=Kt*di*ce,Gt=Kt*Pn*ce}let[Je,wt,ct,$t]=bi(we.projectedAnchorX+He,we.projectedAnchorY+nt,we.projectedAnchorZ+Gt,l?le:P);const it=ls(C.getCameraToCenterDistance(ee),$t);let vt=w.evaluateSizeForFeature(h.textSizeData,_,we)*it/c.ONE_EM;l&&(vt*=h.tilePixelRatio/y);const Vt=zo(Ze,vt);l?(({x:Je,y:wt,z:ct}=ee.projectTilePoint(ke+Vt.x,Be+Vt.y,m.canonical)),[Je,wt,ct]=bi(Je+He,wt+nt,ct+Gt,P)):(i&&Vt._rotate(-C.angle),Je+=Vt.x,wt+=Vt.y,ct=0);const Rt=h.allowVerticalPlacement&&we.placedOrientation===c.WritingMode.vertical?Math.PI/2:0;for(let Kt=0;Kt<Pe;Kt++)c.addDynamicAttributes(F,Je,wt,ct,Rt);T&&we.associatedIconIndex>=0&&(K[we.associatedIconIndex]={x:Je,y:wt,z:ct,angle:Rt})}else Qi(Pe,F)}if(T){U.clear();const _e=h.icon.placedSymbolArray;for(let we=0;we<_e.length;we++){const ke=_e.get(we),{numGlyphs:Be}=ke,Pe=K[we];if(ke.hidden||!Pe)Qi(Be,U);else{const{x:Ze,y:He,z:nt,angle:Gt}=Pe;for(let Je=0;Je<Be;Je++)c.addDynamicAttributes(U,Ze,He,nt,Gt)}}h.icon.dynamicLayoutVertexBuffer.updateData(U)}h.text.dynamicLayoutVertexBuffer.updateData(F)}function ie(h,i,l){return l.iconsInText&&i?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function R(h,i,l,p,w,C,P,m,y,_,T,M){const F=h.context,U=F.gl,K=h.transform,ee="map"===m,le="map"===y,Z=ee&&"point"!==l.layout.get("symbol-placement"),ce=ee&&!le&&!Z,_e=void 0!==l.layout.get("symbol-sort-key").constantOr(1);let we=!1;const ke=h.depthModeForSublayer(0,c.DepthMode.ReadOnly),Be=[c.mercatorXfromLng(K.center.lng),c.mercatorYfromLat(K.center.lat)],Pe=l.layout.get("text-variable-anchor"),Ze="globe"===K.projection.name,He=[],nt=[0,-1,0];let Gt=nt;!Ze&&!K.mercatorFromTransition||ee||(Gt=function(Je){const wt=Je._camera.getWorldToCamera(Je.worldSize,1),ct=c.multiply([],wt,Je.globeMatrix);c.invert(ct,ct);const $t=[0,0,0],it=[0,1,0,0];return c.transformMat4$1(it,it,ct),$t[0]=it[0],$t[1]=it[1],$t[2]=it[2],c.normalize($t,$t),$t}(K));for(const Je of p){const wt=i.getTile(Je),ct=wt.getBucket(l);if(!ct||"mercator"===ct.projection.name&&Ze)continue;const $t=w?ct.text:ct.icon;if(!$t||ct.fullyClipped||!$t.segments.get().length)continue;const it=$t.programConfigurations.get(l.id),vt=w||ct.sdfIcons,Vt=w?ct.textSizeData:ct.iconSizeData,Rt=le||0!==K.pitch,Kt=c.evaluateSizeForZoom(Vt,K.zoom);let jn,di,Pn,Kn,Ui=[0,0],Fi=null;if(w)di=wt.glyphAtlasTexture,Pn=U.LINEAR,jn=wt.glyphAtlasTexture.size,ct.iconsInText&&(Ui=wt.imageAtlasTexture.size,Fi=wt.imageAtlasTexture,Kn=Rt||h.options.rotating||h.options.zooming||"composite"===Vt.kind||"camera"===Vt.kind?U.LINEAR:U.NEAREST);else{const nl=1!==l.layout.get("icon-size").constantOr(0)||ct.iconsNeedLinear;di=wt.imageAtlasTexture,Pn=vt||h.options.rotating||h.options.zooming||nl||Rt?U.LINEAR:U.NEAREST,jn=wt.imageAtlasTexture.size}const Bn="globe"===ct.projection.name,rr=Bn?Gt:nt,Er=Bn?c.globeToMercatorTransition(K.zoom):0,_r=Li(Je,ct.getProjection(),K),Rr=K.calculatePixelsToTileUnitsMatrix(wt),Os=ft(_r,wt.tileID.canonical,le,ee,K,ct.getProjection(),Rr),Fs=h.terrain&&le&&Z?c.invert(c.create(),Os):oo,Ua=ai(_r,wt.tileID.canonical,le,ee,K,ct.getProjection(),Rr),tl=Pe&&ct.hasTextData(),Ur="none"!==l.layout.get("icon-text-fit")&&tl&&ct.hasIconData();if(Z){const nl=K.elevation,il=nl?nl.getAtTileOffsetFunc(Je,K.center.lat,K.worldSize,ct.getProjection()):null,zl=ti(_r,wt.tileID.canonical,le,ee,K,ct.getProjection(),Rr);Wo(ct,_r,h,w,zl,Ua,le,_,il,Je)}const Lr=Z||w&&Pe||Ur,or=h.translatePosMatrix(_r,wt,C,P),bo=Lr?oo:Os,xa=h.translatePosMatrix(Ua,wt,C,P,!0),Kr=ct.getProjection().createInversionMatrix(K,Je.canonical),Ia=[];h.terrainRenderModeElevated()&&le&&Ia.push("PITCH_WITH_MAP_TERRAIN"),Bn&&Ia.push("PROJECTION_GLOBE_VIEW"),Lr&&Ia.push("PROJECTED_POS_ON_VIEWPORT");const mh=vt&&0!==l.paint.get(w?"text-halo-width":"icon-halo-width").constantOr(1);let xc;xc=vt?ct.iconsInText?wr(Vt.kind,Kt,ce,le,h,or,bo,xa,jn,Ui,Je,Er,Be,Kr,rr,ct.getProjection()):xo(Vt.kind,Kt,ce,le,h,or,bo,xa,w,jn,!0,Je,Er,Be,Kr,rr,ct.getProjection()):es(Vt.kind,Kt,ce,le,h,or,bo,xa,w,jn,Je,Er,Be,Kr,rr,ct.getProjection());const Yc={program:h.useProgram(ie(vt,w,ct),it,Ia),buffers:$t,uniformValues:xc,atlasTexture:di,atlasTextureIcon:Fi,atlasInterpolation:Pn,atlasInterpolationIcon:Kn,isSDF:vt,hasHalo:mh,tile:wt,labelPlaneMatrixInv:Fs};if(_e&&ct.canOverlap){we=!0;const nl=$t.segments.get();for(const il of nl)He.push({segments:new c.SegmentVector([il]),sortKey:il.sortKey,state:Yc})}else He.push({segments:$t.segments,sortKey:0,state:Yc})}we&&He.sort((Je,wt)=>Je.sortKey-wt.sortKey);for(const Je of He){const wt=Je.state;if(h.terrain&&h.terrain.setupElevationDraw(wt.tile,wt.program,{useDepthForOcclusion:!Ze,labelPlaneMatrixInv:wt.labelPlaneMatrixInv}),F.activeTexture.set(U.TEXTURE0),wt.atlasTexture.bind(wt.atlasInterpolation,U.CLAMP_TO_EDGE),wt.atlasTextureIcon&&(F.activeTexture.set(U.TEXTURE1),wt.atlasTextureIcon&&wt.atlasTextureIcon.bind(wt.atlasInterpolationIcon,U.CLAMP_TO_EDGE)),wt.isSDF){const ct=wt.uniformValues;wt.hasHalo&&(ct.u_is_halo=1,L(wt.buffers,Je.segments,l,h,wt.program,ke,T,M,ct)),ct.u_is_halo=0}L(wt.buffers,Je.segments,l,h,wt.program,ke,T,M,wt.uniformValues)}}function L(h,i,l,p,w,C,P,m,y){const _=p.context,T=[h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer,h.globeExtVertexBuffer];w.draw(_,_.gl.TRIANGLES,C,P,m,c.CullFaceMode.disabled,y,l.id,h.layoutVertexBuffer,h.indexBuffer,i,l.paint,p.transform.zoom,h.programConfigurations.get(l.id),T)}function G(h,i,l,p,w,C,P){const m=h.context.gl,y=l.paint.get("fill-pattern"),_=y&&y.constantOr(1);let T,M,F,U,K;P?(M=_&&!l.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",T=m.LINES):(M=_?"fillPattern":"fill",T=m.TRIANGLES);for(const ee of p){const le=i.getTile(ee);if(_&&!le.patternsLoaded())continue;const Z=le.getBucket(l);if(!Z)continue;h.prepareDrawTile();const ce=Z.programConfigurations.get(l.id),_e=h.useProgram(M,ce);_&&(h.context.activeTexture.set(m.TEXTURE0),le.imageAtlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),ce.updatePaintBuffers());const we=y.constantOr(null);if(we&&le.imageAtlas){const Be=le.imageAtlas.patternPositions[we.toString()];Be&&ce.setConstantPatternPositions(Be)}const ke=h.translatePosMatrix(ee.projMatrix,le,l.paint.get("fill-translate"),l.paint.get("fill-translate-anchor"));if(P){U=Z.indexBuffer2,K=Z.segments2;const Be=h.terrain&&h.terrain.renderingToTexture?h.terrain.drapeBufferSize:[m.drawingBufferWidth,m.drawingBufferHeight];F="fillOutlinePattern"===M&&_?pa(ke,h,le,Be):ho(ke,Be)}else U=Z.indexBuffer,K=Z.segments,F=_?Bo(ke,h,le):Fo(ke);h.prepareDrawProgram(h.context,_e,ee.toUnwrapped()),_e.draw(h.context,T,w,h.stencilModeForClipping(ee),C,c.CullFaceMode.disabled,F,l.id,Z.layoutVertexBuffer,U,K,l.paint,h.transform.zoom,ce)}}function se(h,i,l,p,w,C,P){const m=h.context,y=m.gl,_=h.transform,T=l.paint.get("fill-extrusion-pattern"),M=T.constantOr(1),F=l.paint.get("fill-extrusion-opacity"),U=[l.paint.get("fill-extrusion-ambient-occlusion-intensity"),l.paint.get("fill-extrusion-ambient-occlusion-radius")],K=l.layout.get("fill-extrusion-edge-radius"),ee=K>0&&!l.paint.get("fill-extrusion-rounded-roof"),le=ee?0:K,Z="globe"===_.projection.name?c.fillExtrusionHeightLift():0,ce="globe"===_.projection.name,_e=ce?c.globeToMercatorTransition(_.zoom):0,we=[c.mercatorXfromLng(_.center.lng),c.mercatorYfromLat(_.center.lat)],ke=[];ce&&ke.push("PROJECTION_GLOBE_VIEW"),U[0]>0&&ke.push("FAUX_AO"),ee&&ke.push("ZERO_ROOF_RADIUS");for(const Be of p){const Pe=i.getTile(Be),Ze=Pe.getBucket(l);if(!Ze||Ze.projection.name!==_.projection.name)continue;const He=Ze.programConfigurations.get(l.id),nt=h.useProgram(M?"fillExtrusionPattern":"fillExtrusion",He,ke);if(h.terrain){const vt=h.terrain;if(h.style.terrainSetForDrapingOnly())vt.setupElevationDraw(Pe,nt,{useMeterToDem:!0});else{if(!Ze.enableTerrain)continue;if(vt.setupElevationDraw(Pe,nt,{useMeterToDem:!0}),me(m,i,Be,Ze,l,vt),!Ze.centroidVertexBuffer){const Vt=nt.attributes.a_centroid_pos;void 0!==Vt&&y.vertexAttrib2f(Vt,0,0)}}}M&&(h.context.activeTexture.set(y.TEXTURE0),Pe.imageAtlasTexture.bind(y.LINEAR,y.CLAMP_TO_EDGE),He.updatePaintBuffers());const Gt=T.constantOr(null);if(Gt&&Pe.imageAtlas){const vt=Pe.imageAtlas.patternPositions[Gt.toString()];vt&&He.setConstantPatternPositions(vt)}const Je=h.translatePosMatrix(Be.projMatrix,Pe,l.paint.get("fill-extrusion-translate"),l.paint.get("fill-extrusion-translate-anchor")),wt=_.projection.createInversionMatrix(_,Be.canonical),ct=l.paint.get("fill-extrusion-vertical-gradient"),$t=M?Aa(Je,h,ct,F,U,le,Be,Pe,Z,_e,we,wt):xr(Je,h,ct,F,U,le,Be,Z,_e,we,wt);h.prepareDrawProgram(m,nt,Be.toUnwrapped());const it=[];h.terrain&&it.push(Ze.centroidVertexBuffer),ce&&it.push(Ze.layoutVertexExtBuffer),nt.draw(m,m.gl.TRIANGLES,w,C,P,c.CullFaceMode.backCCW,$t,l.id,Ze.layoutVertexBuffer,Ze.indexBuffer,Ze.segments,l.paint,h.transform.zoom,He,it)}}function me(h,i,l,p,w,C){const P=[Z=>{let ce=Z.canonical.x-1,_e=Z.wrap;return ce<0&&(ce=(1<<Z.canonical.z)-1,_e--),new c.OverscaledTileID(Z.overscaledZ,_e,Z.canonical.z,ce,Z.canonical.y)},Z=>{let ce=Z.canonical.x+1,_e=Z.wrap;return ce===1<<Z.canonical.z&&(ce=0,_e++),new c.OverscaledTileID(Z.overscaledZ,_e,Z.canonical.z,ce,Z.canonical.y)},Z=>new c.OverscaledTileID(Z.overscaledZ,Z.wrap,Z.canonical.z,Z.canonical.x,(0===Z.canonical.y?1<<Z.canonical.z:Z.canonical.y)-1),Z=>new c.OverscaledTileID(Z.overscaledZ,Z.wrap,Z.canonical.z,Z.canonical.x,Z.canonical.y===(1<<Z.canonical.z)-1?0:Z.canonical.y+1)],m=Z=>{const ce=i.getSource().minzoom,_e=ke=>{const Be=i.getTileByID(ke);if(Be&&Be.hasData())return Be.getBucket(w)},we=[0,-1,1];for(const ke of we){if(Z.overscaledZ+ke<ce)continue;const Be=_e(Z.calculateScaledKey(Z.overscaledZ+ke));if(Be)return Be}},y=[0,0,0],_=(Z,ce)=>(y[0]=Math.min(Z.min.y,ce.min.y),y[1]=Math.max(Z.max.y,ce.max.y),y[2]=c.EXTENT-ce.min.x>Z.max.x?ce.min.x-c.EXTENT:Z.max.x,y),T=(Z,ce)=>(y[0]=Math.min(Z.min.x,ce.min.x),y[1]=Math.max(Z.max.x,ce.max.x),y[2]=c.EXTENT-ce.min.y>Z.max.y?ce.min.y-c.EXTENT:Z.max.y,y),M=[(Z,ce)=>_(Z,ce),(Z,ce)=>_(ce,Z),(Z,ce)=>T(Z,ce),(Z,ce)=>T(ce,Z)],F=new c.Point(0,0);let U,K,ee;const le=(Z,ce,_e,we,ke)=>{const Be=[[we?_e:Z,we?Z:_e,0],[we?_e:ce,we?ce:_e,0]],Pe=ke<0?c.EXTENT+ke:ke,Ze=[we?Pe:(Z+ce)/2,we?(Z+ce)/2:Pe,0];return 0===_e&&ke<0||0!==_e&&ke>0?C.getForTilePoints(ee,[Ze],!0,K):Be.push(Ze),C.getForTilePoints(l,Be,!0,U),Math.max(Be[0][2],Be[1][2],Ze[2])/C.exaggeration()};for(let Z=0;Z<4;Z++){const ce=(Z<2?1:5)-Z,_e=p.borders[Z];if(0===_e.length)continue;const we=ee=P[Z](l),ke=m(we);if(!(ke&&ke instanceof c.FillExtrusionBucket&&ke.enableTerrain)||p.borderDoneWithNeighborZ[Z]===ke.canonical.z&&ke.borderDoneWithNeighborZ[ce]===p.canonical.z||(K=C.findDEMTileFor(we),!K||!K.dem))continue;if(!U){const He=C.findDEMTileFor(l);if(!He||!He.dem)return;U=He}const Be=ke.borders[ce];let Pe=0;const Ze=ke.borderDoneWithNeighborZ[ce]!==p.canonical.z;if(p.canonical.z===ke.canonical.z){for(let He=0;He<_e.length;He++){const nt=p.featuresOnBorder[_e[He]],Gt=nt.borders[Z];let Je;for(;Pe<Be.length&&(Je=ke.featuresOnBorder[Be[Pe]],!(Je.borders[ce][1]>Gt[0]+3));)Ze&&ke.encodeCentroid(void 0,Je,!1),Pe++;if(Je&&Pe<Be.length){const wt=Pe;let ct=0;for(;!(Je.borders[ce][0]>Gt[1]-3)&&(ct++,++Pe!==Be.length);)Je=ke.featuresOnBorder[Be[Pe]];if(Je=ke.featuresOnBorder[Be[wt]],nt.intersectsCount()>1||Je.intersectsCount()>1||1!==ct){1!==ct&&(Pe=wt),p.encodeCentroid(void 0,nt,!1),Ze&&ke.encodeCentroid(void 0,Je,!1);continue}const $t=M[Z](nt,Je),it=Z%2?c.EXTENT-1:0;F.x=le($t[0],Math.min(c.EXTENT-1,$t[1]),it,Z<2,$t[2]),F.y=0,p.encodeCentroid(F,nt,!1),Ze&&ke.encodeCentroid(F,Je,!1)}else p.encodeCentroid(void 0,nt,!1)}p.borderDoneWithNeighborZ[Z]=ke.canonical.z,p.needsCentroidUpdate=!0,Ze&&(ke.borderDoneWithNeighborZ[ce]=p.canonical.z,ke.needsCentroidUpdate=!0)}else{for(const He of _e)p.encodeCentroid(void 0,p.featuresOnBorder[He],!1);if(Ze){for(const He of Be)ke.encodeCentroid(void 0,ke.featuresOnBorder[He],!1);ke.borderDoneWithNeighborZ[ce]=p.canonical.z,ke.needsCentroidUpdate=!0}p.borderDoneWithNeighborZ[Z]=ke.canonical.z,p.needsCentroidUpdate=!0}}(p.needsCentroidUpdate||!p.centroidVertexBuffer&&0!==p.centroidVertexArray.length)&&p.uploadCentroid(h)}const Oe=new c.Color(1,0,0,1),Ue=new c.Color(0,1,0,1),st=new c.Color(0,0,1,1),mt=new c.Color(1,0,1,1),xn=new c.Color(0,1,1,1);function Sn(h,i,l){const p=h.context,w=h.transform,C=p.gl,P="globe"===w.projection.name,m=P?["PROJECTION_GLOBE_VIEW"]:null;let y=l.projMatrix;if(P&&c.globeToMercatorTransition(w.zoom)>0){const nt=c.transitionTileAABBinECEF(l.canonical,w),Gt=c.globeDenormalizeECEF(nt);y=c.multiply(new Float32Array(16),w.globeMatrix,Gt),c.multiply(y,w.projMatrix,y)}const _=h.useProgram("debug",null,m),T=i.getTileByID(l.key);h.terrain&&h.terrain.setupElevationDraw(T,_);const M=c.DepthMode.disabled,F=c.StencilMode.disabled,U=h.colorModeForRenderPass(),K="$debug";p.activeTexture.set(C.TEXTURE0),h.emptyTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),P?T._makeGlobeTileDebugBuffers(h.context,w):T._makeDebugTileBoundsBuffers(h.context,w.projection);const ee=T._tileDebugBuffer||h.debugBuffer,le=T._tileDebugIndexBuffer||h.debugIndexBuffer,Z=T._tileDebugSegments||h.debugSegments;_.draw(p,C.LINE_STRIP,M,F,U,c.CullFaceMode.disabled,fs(y,c.Color.red),K,ee,le,Z,null,null,null,[T._globeTileDebugBorderBuffer]);const ce=T.latestRawTileData,_e=Math.floor((ce&&ce.byteLength||0)/1024),we=i.getTile(l).tileSize,ke=512/Math.min(we,512)*(l.overscaledZ/w.zoom)*.5;let Be=l.canonical.toString();l.overscaledZ!==l.canonical.z&&(Be+=` => ${l.overscaledZ}`),Be+=` ${_e}kb`,function(nt,Gt){nt.initDebugOverlayCanvas();const Je=nt.debugOverlayCanvas,wt=nt.context.gl,ct=nt.debugOverlayCanvas.getContext("2d");ct.clearRect(0,0,Je.width,Je.height),ct.shadowColor="white",ct.shadowBlur=2,ct.lineWidth=1.5,ct.strokeStyle="white",ct.textBaseline="top",ct.font="bold 36px Open Sans, sans-serif",ct.fillText(Gt,5,5),ct.strokeText(Gt,5,5),nt.debugOverlayTexture.update(Je),nt.debugOverlayTexture.bind(wt.LINEAR,wt.CLAMP_TO_EDGE)}(h,Be);const Pe=T._tileDebugTextBuffer||h.debugBuffer,Ze=T._tileDebugTextIndexBuffer||h.quadTriangleIndexBuffer,He=T._tileDebugTextSegments||h.debugSegments;_.draw(p,C.TRIANGLES,M,F,c.ColorMode.alphaBlended,c.CullFaceMode.disabled,fs(y,c.Color.transparent,ke),K,Pe,Ze,He,null,null,null,[T._globeTileDebugTextBuffer])}function ci(h,i,l,p){Un(h,0,i+l/2,h.transform.width,l,p)}function oi(h,i,l,p){Un(h,i-l/2,0,l,h.transform.height,p)}function Un(h,i,l,p,w,C){const P=h.context,m=P.gl;m.enable(m.SCISSOR_TEST),m.scissor(i*c.exported.devicePixelRatio,l*c.exported.devicePixelRatio,p*c.exported.devicePixelRatio,w*c.exported.devicePixelRatio),P.clear({color:C}),m.disable(m.SCISSOR_TEST)}const Jn=c.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Ni}=Jn;function xi(h,i,l,p){h.emplaceBack(i,l,p)}class gr{constructor(i){this.vertexArray=new c.StructArrayLayout3f12,this.indices=new c.StructArrayLayout3ui6,xi(this.vertexArray,-1,-1,1),xi(this.vertexArray,1,-1,1),xi(this.vertexArray,-1,1,1),xi(this.vertexArray,1,1,1),xi(this.vertexArray,-1,-1,-1),xi(this.vertexArray,1,-1,-1),xi(this.vertexArray,-1,1,-1),xi(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Ni),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=c.SegmentVector.simpleSegment(0,0,36,12)}}function tr(h,i,l,p,w,C){const P=h.gl,m=i.paint.get("sky-atmosphere-color"),y=i.paint.get("sky-atmosphere-halo-color"),_=i.paint.get("sky-atmosphere-sun-intensity"),T={u_matrix_3f:c.fromMat4(c.create$1(),p),u_sun_direction:w,u_sun_intensity:_,u_color_tint_r:[(K=m).r,K.g,K.b,K.a],u_color_tint_m:[(ee=y).r,ee.g,ee.b,ee.a],u_luminance:5e-5};var K,ee;P.framebufferTexture2D(P.FRAMEBUFFER,P.COLOR_ATTACHMENT0,P.TEXTURE_CUBE_MAP_POSITIVE_X+C,i.skyboxTexture,0),l.draw(h,P.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,c.ColorMode.unblended,c.CullFaceMode.frontCW,T,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Wn=c.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class dr{constructor(i){const l=new c.StructArrayLayout5f20;l.emplaceBack(-1,1,1,0,0),l.emplaceBack(1,1,1,1,0),l.emplaceBack(1,-1,1,1,1),l.emplaceBack(-1,-1,1,0,1);const p=new c.StructArrayLayout3ui6;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(l,Wn.members),this.indexBuffer=i.createIndexBuffer(p),this.segments=c.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Si={symbol:function(h,i,l,p,w){if("translucent"!==h.renderPass)return;const C=c.StencilMode.disabled,P=h.colorModeForRenderPass();l.layout.get("text-variable-anchor")&&function(m,y,_,T,M,F,U){const K=y.transform,ee="map"===M,le="map"===F;for(const Z of m){const ce=T.getTile(Z),_e=ce.getBucket(_);if(!_e||!_e.text||!_e.text.segments.get().length)continue;const we=c.evaluateSizeForZoom(_e.textSizeData,K.zoom),ke=Li(Z,_e.getProjection(),K),Be=K.calculatePixelsToTileUnitsMatrix(ce),Pe=ft(ke,ce.tileID.canonical,le,ee,K,_e.getProjection(),Be),Ze="none"!==_.layout.get("icon-text-fit")&&_e.hasIconData();if(we){const He=Math.pow(2,K.zoom-ce.tileID.overscaledZ);ra(_e,ee,le,U,c.symbolSize,K,Pe,Z,He,we,Ze)}}}(p,h,l,i,l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),w),0!==l.paint.get("icon-opacity").constantOr(1)&&R(h,i,l,p,!1,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),l.layout.get("icon-rotation-alignment"),l.layout.get("icon-pitch-alignment"),l.layout.get("icon-keep-upright"),C,P),0!==l.paint.get("text-opacity").constantOr(1)&&R(h,i,l,p,!0,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),l.layout.get("text-rotation-alignment"),l.layout.get("text-pitch-alignment"),l.layout.get("text-keep-upright"),C,P),i.map.showCollisionBoxes&&(ia(h,i,l,p,l.paint.get("text-translate"),l.paint.get("text-translate-anchor"),!0),ia(h,i,l,p,l.paint.get("icon-translate"),l.paint.get("icon-translate-anchor"),!1))},circle:function(h,i,l,p){if("translucent"!==h.renderPass)return;const w=l.paint.get("circle-opacity"),C=l.paint.get("circle-stroke-width"),P=l.paint.get("circle-stroke-opacity"),m=void 0!==l.layout.get("circle-sort-key").constantOr(1);if(0===w.constantOr(1)&&(0===C.constantOr(1)||0===P.constantOr(1)))return;const y=h.context,_=y.gl,T=h.transform,M=h.depthModeForSublayer(0,c.DepthMode.ReadOnly),F=c.StencilMode.disabled,U=h.colorModeForRenderPass(),K="globe"===T.projection.name,ee=[c.mercatorXfromLng(T.center.lng),c.mercatorYfromLat(T.center.lat)],le=[];for(let ce=0;ce<p.length;ce++){const _e=p[ce],we=i.getTile(_e),ke=we.getBucket(l);if(!ke||ke.projection.name!==T.projection.name)continue;const Be=ke.programConfigurations.get(l.id),Pe=Ki(l);K&&Pe.push("PROJECTION_GLOBE_VIEW");const Ze=h.useProgram("circle",Be,Pe),He=ke.layoutVertexBuffer,nt=ke.globeExtVertexBuffer,Gt=ke.indexBuffer,Je=T.projection.createInversionMatrix(T,_e.canonical),wt={programConfiguration:Be,program:Ze,layoutVertexBuffer:He,globeExtVertexBuffer:nt,indexBuffer:Gt,uniformValues:Xn(h,_e,we,Je,ee,l),tile:we};if(m){const ct=ke.segments.get();for(const $t of ct)le.push({segments:new c.SegmentVector([$t]),sortKey:$t.sortKey,state:wt})}else le.push({segments:ke.segments,sortKey:0,state:wt})}m&&le.sort((ce,_e)=>ce.sortKey-_e.sortKey);const Z={useDepthForOcclusion:!K};for(const ce of le){const{programConfiguration:_e,program:we,layoutVertexBuffer:ke,globeExtVertexBuffer:Be,indexBuffer:Pe,uniformValues:Ze,tile:He}=ce.state,nt=ce.segments;h.terrain&&h.terrain.setupElevationDraw(He,we,Z),h.prepareDrawProgram(y,we,He.tileID.toUnwrapped()),we.draw(y,_.TRIANGLES,M,F,U,c.CullFaceMode.disabled,Ze,l.id,ke,Pe,nt,l.paint,T.zoom,_e,[Be])}},heatmap:function(h,i,l,p){if(0!==l.paint.get("heatmap-opacity"))if("offscreen"===h.renderPass){const w=h.context,C=w.gl,P=c.StencilMode.disabled,m=new c.ColorMode([C.ONE,C.ONE],c.Color.transparent,[!0,!0,!0,!0]);(function(U,K,ee,le){const Z=U.gl,ce=K.width*le,_e=K.height*le;U.activeTexture.set(Z.TEXTURE1),U.viewport.set([0,0,ce,_e]);let we=ee.heatmapFbo;if(!we||we&&(we.width!==ce||we.height!==_e)){we&&we.destroy();const ke=Z.createTexture();Z.bindTexture(Z.TEXTURE_2D,ke),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_S,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_WRAP_T,Z.CLAMP_TO_EDGE),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MIN_FILTER,Z.LINEAR),Z.texParameteri(Z.TEXTURE_2D,Z.TEXTURE_MAG_FILTER,Z.LINEAR),we=ee.heatmapFbo=U.createFramebuffer(ce,_e,!1),function(Be,Pe,Ze,He,nt,Gt){const Je=Be.gl;Je.texImage2D(Je.TEXTURE_2D,0,Be.isWebGL2&&Be.extRenderToTextureHalfFloat?Je.RGBA16F:Je.RGBA,nt,Gt,0,Je.RGBA,Be.extRenderToTextureHalfFloat?Be.isWebGL2?Je.HALF_FLOAT:Be.extTextureHalfFloat.HALF_FLOAT_OES:Je.UNSIGNED_BYTE,null),He.colorAttachment.set(Ze)}(U,0,ke,we,ce,_e)}else Z.bindTexture(Z.TEXTURE_2D,we.colorAttachment.get()),U.bindFramebuffer.set(we.framebuffer)})(w,h,l,"globe"===h.transform.projection.name?.5:.25),w.clear({color:c.Color.transparent});const y=h.transform,_="globe"===y.projection.name,T=_?["PROJECTION_GLOBE_VIEW"]:null,M=_?c.CullFaceMode.frontCCW:c.CullFaceMode.disabled,F=[c.mercatorXfromLng(y.center.lng),c.mercatorYfromLat(y.center.lat)];for(let U=0;U<p.length;U++){const K=p[U];if(i.hasRenderableParent(K))continue;const ee=i.getTile(K),le=ee.getBucket(l);if(!le||le.projection.name!==y.projection.name)continue;const Z=le.programConfigurations.get(l.id),ce=h.useProgram("heatmap",Z,T),{zoom:_e}=h.transform;h.terrain&&h.terrain.setupElevationDraw(ee,ce),h.prepareDrawProgram(w,ce,K.toUnwrapped());const we=y.projection.createInversionMatrix(y,K.canonical);ce.draw(w,C.TRIANGLES,c.DepthMode.disabled,P,m,M,na(h,K,ee,we,F,_e,l.paint.get("heatmap-intensity")),l.id,le.layoutVertexBuffer,le.indexBuffer,le.segments,l.paint,h.transform.zoom,Z,_?[le.globeExtVertexBuffer]:null)}w.viewport.set([0,0,h.width,h.height])}else"translucent"===h.renderPass&&(h.context.setColorMode(h.colorModeForRenderPass()),function(w,C){const P=w.context,m=P.gl,y=C.heatmapFbo;if(!y)return;P.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,y.colorAttachment.get()),P.activeTexture.set(m.TEXTURE1);let _=C.colorRampTexture;_||(_=C.colorRampTexture=new c.Texture(P,C.colorRamp,m.RGBA)),_.bind(m.LINEAR,m.CLAMP_TO_EDGE),w.useProgram("heatmapTexture").draw(P,m.TRIANGLES,c.DepthMode.disabled,c.StencilMode.disabled,w.colorModeForRenderPass(),c.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:C.paint.get("heatmap-opacity")},C.id,w.viewportBuffer,w.quadTriangleIndexBuffer,w.viewportSegments,C.paint,w.transform.zoom)}(h,l))},line:function(h,i,l,p){if("translucent"!==h.renderPass)return;const w=l.paint.get("line-opacity"),C=l.paint.get("line-width");if(0===w.constantOr(1)||0===C.constantOr(1))return;const P=h.depthModeForSublayer(0,c.DepthMode.ReadOnly),m=h.colorModeForRenderPass(),y=h.terrain&&h.terrain.renderingToTexture?1:c.exported.devicePixelRatio,_=l.paint.get("line-dasharray"),T=_.constantOr(1),M=l.layout.get("line-cap"),F=l.paint.get("line-pattern"),U=F.constantOr(1),K=l.paint.get("line-gradient"),ee=U?"linePattern":"line",le=h.context,Z=le.gl,ce=(we=>{const ke=[];Pi(we)&&ke.push("RENDER_LINE_DASH"),we.paint.get("line-gradient")&&ke.push("RENDER_LINE_GRADIENT");const Be=we.paint.get("line-trim-offset");0===Be[0]&&0===Be[1]||ke.push("RENDER_LINE_TRIM_OFFSET");const Pe=we.paint.get("line-pattern").constantOr(1),Ze=1!==we.paint.get("line-opacity").constantOr(1);return!Pe&&Ze&&ke.push("RENDER_LINE_ALPHA_DISCARD"),ke})(l);let _e=ce.includes("RENDER_LINE_ALPHA_DISCARD");h.terrain&&h.terrain.clipOrMaskOverlapStencilType()&&(_e=!1);for(const we of p){const ke=i.getTile(we);if(U&&!ke.patternsLoaded())continue;const Be=ke.getBucket(l);if(!Be)continue;h.prepareDrawTile();const Pe=Be.programConfigurations.get(l.id),Ze=h.useProgram(ee,Pe,ce),He=F.constantOr(null);if(He&&ke.imageAtlas){const vt=ke.imageAtlas.patternPositions[He.toString()];vt&&Pe.setConstantPatternPositions(vt)}const nt=_.constantOr(null),Gt=M.constantOr(null);if(!U&&nt&&Gt&&ke.lineAtlas){const vt=ke.lineAtlas.getDash(nt,Gt);vt&&Pe.setConstantPatternPositions(vt)}let[Je,wt]=l.paint.get("line-trim-offset");("round"===Gt||"square"===Gt)&&Je!==wt&&(0===Je&&(Je-=1),1===wt&&(wt+=1));const ct=h.terrain?we.projMatrix:null,$t=U?Zs(h,ke,l,ct,y):Fa(h,ke,l,ct,Be.lineClipsArray.length,y,[Je,wt]);if(K){const vt=Be.gradients[l.id];let Vt=vt.texture;if(l.gradientVersion!==vt.version){let Rt=256;if(l.stepInterpolant){const Kt=i.getSource().maxzoom,jn=we.canonical.z===Kt?Math.ceil(1<<h.transform.maxZoom-we.canonical.z):1;Rt=c.clamp(c.nextPowerOfTwo(Be.maxLineLength/c.EXTENT*1024*jn),256,le.maxTextureSize)}vt.gradient=c.renderColorRamp({expression:l.gradientExpression(),evaluationKey:"lineProgress",resolution:Rt,image:vt.gradient||void 0,clips:Be.lineClipsArray}),vt.texture?vt.texture.update(vt.gradient):vt.texture=new c.Texture(le,vt.gradient,Z.RGBA),vt.version=l.gradientVersion,Vt=vt.texture}le.activeTexture.set(Z.TEXTURE1),Vt.bind(l.stepInterpolant?Z.NEAREST:Z.LINEAR,Z.CLAMP_TO_EDGE)}T&&(le.activeTexture.set(Z.TEXTURE0),ke.lineAtlasTexture.bind(Z.LINEAR,Z.REPEAT),Pe.updatePaintBuffers()),U&&(le.activeTexture.set(Z.TEXTURE0),ke.imageAtlasTexture.bind(Z.LINEAR,Z.CLAMP_TO_EDGE),Pe.updatePaintBuffers()),h.prepareDrawProgram(le,Ze,we.toUnwrapped());const it=vt=>{Ze.draw(le,Z.TRIANGLES,P,vt,m,c.CullFaceMode.disabled,$t,l.id,Be.layoutVertexBuffer,Be.indexBuffer,Be.segments,l.paint,h.transform.zoom,Pe,[Be.layoutVertexBuffer2])};if(_e){const vt=h.stencilModeForClipping(we).ref;0===vt&&h.terrain&&le.clear({stencil:0});const Vt={func:Z.EQUAL,mask:255};$t.u_alpha_discard_threshold=.8,it(new c.StencilMode(Vt,vt,255,Z.KEEP,Z.KEEP,Z.INVERT)),$t.u_alpha_discard_threshold=0,it(new c.StencilMode(Vt,vt,255,Z.KEEP,Z.KEEP,Z.KEEP))}else it(h.stencilModeForClipping(we))}_e&&(h.resetStencilClippingMasks(),h.terrain&&le.clear({stencil:0}))},fill:function(h,i,l,p){const w=l.paint.get("fill-color"),C=l.paint.get("fill-opacity");if(0===C.constantOr(1))return;const P=h.colorModeForRenderPass(),m=l.paint.get("fill-pattern"),y=h.opaquePassEnabledForLayer()&&!m.constantOr(1)&&1===w.constantOr(c.Color.transparent).a&&1===C.constantOr(0)?"opaque":"translucent";if(h.renderPass===y){const _=h.depthModeForSublayer(1,"opaque"===h.renderPass?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly);G(h,i,l,p,_,P,!1)}if("translucent"===h.renderPass&&l.paint.get("fill-antialias")){const _=h.depthModeForSublayer(l.getPaintProperty("fill-outline-color")?2:0,c.DepthMode.ReadOnly);G(h,i,l,p,_,P,!0)}},"fill-extrusion":function(h,i,l,p){const w=l.paint.get("fill-extrusion-opacity");if(0!==w&&"translucent"===h.renderPass){const C=new c.DepthMode(h.context.gl.LEQUAL,c.DepthMode.ReadWrite,h.depthRangeFor3D);if(1!==w||l.paint.get("fill-extrusion-pattern").constantOr(1))se(h,i,l,p,C,c.StencilMode.disabled,c.ColorMode.disabled),se(h,i,l,p,C,h.stencilModeFor3D(),h.colorModeForRenderPass()),h.resetStencilClippingMasks();else{const P=h.colorModeForRenderPass();se(h,i,l,p,C,c.StencilMode.disabled,P)}}},hillshade:function(h,i,l,p){if("offscreen"!==h.renderPass&&"translucent"!==h.renderPass)return;const w=h.context,C=h.depthModeForSublayer(0,c.DepthMode.ReadOnly),P=h.colorModeForRenderPass(),m=h.terrain&&h.terrain.renderingToTexture,[y,_]="translucent"!==h.renderPass||m?[{},p]:h.stencilConfigForOverlap(p);for(const T of _){const M=i.getTile(T);if(M.needsHillshadePrepare&&"offscreen"===h.renderPass)Ms(h,M,l,C,c.StencilMode.disabled,P);else if("translucent"===h.renderPass){const F=m&&h.terrain?h.terrain.stencilModeForRTTOverlap(T):y[T.overscaledZ];Oa(h,T,M,l,C,F,P)}}w.viewport.set([0,0,h.width,h.height]),h.resetStencilClippingMasks()},raster:function(h,i,l,p,w,C){if("translucent"!==h.renderPass||0===l.paint.get("raster-opacity")||!p.length)return;const P=h.context,m=P.gl,y=i.getSource(),_=h.useProgram("raster"),T=h.colorModeForRenderPass(),M=h.terrain&&h.terrain.renderingToTexture,[F,U]=y instanceof cn||M?[{},p]:h.stencilConfigForOverlap(p),K=U[U.length-1].overscaledZ,ee=!h.options.moving;for(const le of U){const Z=M?c.DepthMode.disabled:h.depthModeForSublayer(le.overscaledZ-K,1===l.paint.get("raster-opacity")?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly,m.LESS),ce=le.toUnwrapped(),_e=i.getTile(le);if(M&&(!_e||!_e.hasData()))continue;const we=M?le.projMatrix:h.transform.calculateProjMatrix(ce,ee),ke=h.terrain&&M?h.terrain.stencilModeForRTTOverlap(le):F[le.overscaledZ],Be=C?0:l.paint.get("raster-fade-duration");_e.registerFadeDuration(Be);const Pe=i.findLoadedParent(le,0),Ze=Sa(_e,Pe,i,h.transform,Be);let He,nt;h.terrain&&h.terrain.prepareDrawTile();const Gt="nearest"===l.paint.get("raster-resampling")?m.NEAREST:m.LINEAR;P.activeTexture.set(m.TEXTURE0),_e.texture.bind(Gt,m.CLAMP_TO_EDGE),P.activeTexture.set(m.TEXTURE1),Pe?(Pe.texture.bind(Gt,m.CLAMP_TO_EDGE),He=Math.pow(2,Pe.tileID.overscaledZ-_e.tileID.overscaledZ),nt=[_e.tileID.canonical.x*He%1,_e.tileID.canonical.y*He%1]):_e.texture.bind(Gt,m.CLAMP_TO_EDGE),_e.texture.useMipmap&&P.extTextureFilterAnisotropic&&h.transform.pitch>20&&m.texParameterf(m.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax);const Je=Ba(we,nt||[0,0],He||1,Ze,l,y instanceof cn?y.perspectiveTransform:[0,0]);if(h.prepareDrawProgram(P,_,ce),y instanceof cn)y.boundsBuffer&&y.boundsSegments&&_.draw(P,m.TRIANGLES,Z,c.StencilMode.disabled,T,c.CullFaceMode.disabled,Je,l.id,y.boundsBuffer,h.quadTriangleIndexBuffer,y.boundsSegments);else{const{tileBoundsBuffer:wt,tileBoundsIndexBuffer:ct,tileBoundsSegments:$t}=h.getTileBoundsBuffers(_e);_.draw(P,m.TRIANGLES,Z,ke,T,c.CullFaceMode.disabled,Je,l.id,wt,ct,$t)}}h.resetStencilClippingMasks()},background:function(h,i,l,p){const w=l.paint.get("background-color"),C=l.paint.get("background-opacity");if(0===C)return;const P=h.context,m=P.gl,y=h.transform,_=y.tileSize,T=l.paint.get("background-pattern");if(h.isPatternMissing(T))return;const M=!T&&1===w.a&&1===C&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass!==M)return;const F=c.StencilMode.disabled,U=h.depthModeForSublayer(0,"opaque"===M?c.DepthMode.ReadWrite:c.DepthMode.ReadOnly),K=h.colorModeForRenderPass(),ee=h.useProgram(T?"backgroundPattern":"background");let le,Z=p;Z||(le=h.getBackgroundTiles(),Z=Object.values(le).map(ce=>ce.tileID)),T&&(P.activeTexture.set(m.TEXTURE0),h.imageManager.bind(h.context));for(const ce of Z){const _e=ce.toUnwrapped(),we=p?ce.projMatrix:h.transform.calculateProjMatrix(_e);h.prepareDrawTile();const ke=i?i.getTile(ce):le?le[ce.key]:new c.Tile(ce,_,y.zoom,h),Be=T?ga(we,C,h,T,{tileID:ce,tileSize:_}):ma(we,C,w);h.prepareDrawProgram(P,ee,_e);const{tileBoundsBuffer:Pe,tileBoundsIndexBuffer:Ze,tileBoundsSegments:He}=h.getTileBoundsBuffers(ke);ee.draw(P,m.TRIANGLES,U,F,K,c.CullFaceMode.disabled,Be,l.id,Pe,Ze,He)}},sky:function(h,i,l){const p=h.transform,w="mercator"===p.projection.name||"globe"===p.projection.name?1:c.smoothstep(7,8,p.zoom),C=l.paint.get("sky-opacity")*w;if(0===C)return;const P=h.context,m=l.paint.get("sky-type"),y=new c.DepthMode(P.gl.LEQUAL,c.DepthMode.ReadOnly,[0,1]),_=h.frameCounter/1e3%1;"atmosphere"===m?"offscreen"===h.renderPass?l.needsSkyboxCapture(h)&&(function(T,M,F,U){const K=T.context,ee=K.gl;let le=M.skyboxFbo;if(!le){le=M.skyboxFbo=K.createFramebuffer(32,32,!1),M.skyboxGeometry=new gr(K),M.skyboxTexture=K.gl.createTexture(),ee.bindTexture(ee.TEXTURE_CUBE_MAP,M.skyboxTexture),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_MAG_FILTER,ee.LINEAR);for(let we=0;we<6;++we)ee.texImage2D(ee.TEXTURE_CUBE_MAP_POSITIVE_X+we,0,ee.RGBA,32,32,0,ee.RGBA,ee.UNSIGNED_BYTE,null)}K.bindFramebuffer.set(le.framebuffer),K.viewport.set([0,0,32,32]);const Z=M.getCenter(T,!0),ce=T.useProgram("skyboxCapture"),_e=new Float64Array(16);c.identity(_e),c.rotateY(_e,_e,.5*-Math.PI),tr(K,M,ce,_e,Z,0),c.identity(_e),c.rotateY(_e,_e,.5*Math.PI),tr(K,M,ce,_e,Z,1),c.identity(_e),c.rotateX(_e,_e,.5*-Math.PI),tr(K,M,ce,_e,Z,2),c.identity(_e),c.rotateX(_e,_e,.5*Math.PI),tr(K,M,ce,_e,Z,3),c.identity(_e),tr(K,M,ce,_e,Z,4),c.identity(_e),c.rotateY(_e,_e,Math.PI),tr(K,M,ce,_e,Z,5),K.viewport.set([0,0,T.width,T.height])}(h,l),l.markSkyboxValid(h)):"sky"===h.renderPass&&function(T,M,F,U,K){const ee=T.context,le=ee.gl,Z=T.transform,ce=T.useProgram("skybox");ee.activeTexture.set(le.TEXTURE0),le.bindTexture(le.TEXTURE_CUBE_MAP,M.skyboxTexture);const _e={u_matrix:Z.skyboxMatrix,u_sun_direction:M.getCenter(T,!1),u_cubemap:0,u_opacity:U,u_temporal_offset:K};T.prepareDrawProgram(ee,ce),ce.draw(ee,le.TRIANGLES,F,c.StencilMode.disabled,T.colorModeForRenderPass(),c.CullFaceMode.backCW,_e,"skybox",M.skyboxGeometry.vertexBuffer,M.skyboxGeometry.indexBuffer,M.skyboxGeometry.segment)}(h,l,y,C,_):"gradient"===m&&"sky"===h.renderPass&&function(T,M,F,U,K){const ee=T.context,le=ee.gl,Z=T.transform,ce=T.useProgram("skyboxGradient");M.skyboxGeometry||(M.skyboxGeometry=new gr(ee)),ee.activeTexture.set(le.TEXTURE0);let _e=M.colorRampTexture;_e||(_e=M.colorRampTexture=new c.Texture(ee,M.colorRamp,le.RGBA)),_e.bind(le.LINEAR,le.CLAMP_TO_EDGE);const we=(ke=Z.skyboxMatrix,Be=M.getCenter(T,!1),Pe=M.paint.get("sky-gradient-radius"),Ze=U,He=K,{u_matrix:ke,u_color_ramp:0,u_center_direction:Be,u_radius:c.degToRad(Pe),u_opacity:Ze,u_temporal_offset:He});var ke,Be,Pe,Ze,He;T.prepareDrawProgram(ee,ce),ce.draw(ee,le.TRIANGLES,F,c.StencilMode.disabled,T.colorModeForRenderPass(),c.CullFaceMode.backCW,we,"skyboxGradient",M.skyboxGeometry.vertexBuffer,M.skyboxGeometry.indexBuffer,M.skyboxGeometry.segment)}(h,l,y,C,_)},debug:function(h,i,l){for(let p=0;p<l.length;p++)Sn(h,i,l[p])},custom:function(h,i,l,p){const w=h.context,C=l.implementation;if(!h.transform.projection.unsupportedLayers||!h.transform.projection.unsupportedLayers.includes("custom")||h.terrain&&(h.terrain.renderingToTexture||"offscreen"===h.renderPass)&&l.isLayerDraped()){if("offscreen"===h.renderPass){const P=C.prerender;if(P){if(h.setCustomLayerDefaults(),w.setColorMode(h.colorModeForRenderPass()),"globe"===h.transform.projection.name){const m=h.transform.pointMerc;P.call(C,w.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),c.globeToMercatorTransition(h.transform.zoom),[m.x,m.y],h.transform.pixelsPerMeterRatio)}else P.call(C,w.gl,h.transform.customLayerMatrix());w.setDirty(),h.setBaseState()}}else if("translucent"===h.renderPass){if(h.terrain&&h.terrain.renderingToTexture){const m=C.renderToTile;if(m){const y=p[0].canonical,_=new c.MercatorCoordinate(y.x+p[0].wrap*(1<<y.z),y.y,y.z);w.setDepthMode(c.DepthMode.disabled),w.setStencilMode(c.StencilMode.disabled),w.setColorMode(h.colorModeForRenderPass()),h.setCustomLayerDefaults(),m.call(C,w.gl,_),w.setDirty(),h.setBaseState()}return}h.setCustomLayerDefaults(),w.setColorMode(h.colorModeForRenderPass()),w.setStencilMode(c.StencilMode.disabled);const P="3d"===C.renderingMode?new c.DepthMode(h.context.gl.LEQUAL,c.DepthMode.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,c.DepthMode.ReadOnly);if(w.setDepthMode(P),"globe"===h.transform.projection.name){const m=h.transform.pointMerc;C.render(w.gl,h.transform.customLayerMatrix(),h.transform.getProjection(),h.transform.globeToMercatorMatrix(),c.globeToMercatorTransition(h.transform.zoom),[m.x,m.y],h.transform.pixelsPerMeterRatio)}else C.render(w.gl,h.transform.customLayerMatrix());w.setDirty(),h.setBaseState(),w.bindFramebuffer.set(null)}}else c.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class br{constructor(i,l,p=!1){this.context=new je(i,p),this.transform=l,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=c.SourceCache.maxUnderzooming+c.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(i,l){const p=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Ir(this,i));const w=this._terrain;this.transform.elevation=p?w:null,w.update(i,this.transform,l)}_updateFog(i){const l=i.fog;if(!l||"globe"===this.transform.projection.name||l.getOpacity(this.transform.pitch)<1||l.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,w]=l.getFovAdjustedRange(this.transform._fov);if(p>w)return void(this.transform.fogCullDistSq=null);const C=p+.78*(w-p);this.transform.fogCullDistSq=C*C}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,l){if(this.width=i*c.exported.devicePixelRatio,this.height=l*c.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._layers[p].resize()}setup(){const i=this.context,l=new c.StructArrayLayout2i4;l.emplaceBack(0,0),l.emplaceBack(c.EXTENT,0),l.emplaceBack(0,c.EXTENT),l.emplaceBack(c.EXTENT,c.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(l,c.posAttributes.members),this.tileExtentSegments=c.SegmentVector.simpleSegment(0,0,4,2);const p=new c.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(c.EXTENT,0),p.emplaceBack(0,c.EXTENT),p.emplaceBack(c.EXTENT,c.EXTENT),this.debugBuffer=i.createVertexBuffer(p,c.posAttributes.members),this.debugSegments=c.SegmentVector.simpleSegment(0,0,4,5);const w=new c.StructArrayLayout2i4;w.emplaceBack(-1,-1),w.emplaceBack(1,-1),w.emplaceBack(-1,1),w.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(w,c.posAttributes.members),this.viewportSegments=c.SegmentVector.simpleSegment(0,0,4,2);const C=new c.StructArrayLayout4i8;C.emplaceBack(0,0,0,0),C.emplaceBack(c.EXTENT,0,c.EXTENT,0),C.emplaceBack(0,c.EXTENT,0,c.EXTENT),C.emplaceBack(c.EXTENT,c.EXTENT,c.EXTENT,c.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(C,c.boundsAttributes.members),this.mercatorBoundsSegments=c.SegmentVector.simpleSegment(0,0,4,2);const P=new c.StructArrayLayout3ui6;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(P);const m=new c.StructArrayLayout1ui2;for(const _ of[0,1,3,2,0])m.emplaceBack(_);this.debugIndexBuffer=i.createIndexBuffer(m),this.emptyTexture=new c.Texture(i,new c.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=c.create();const y=this.context.gl;this.stencilClearMode=new c.StencilMode({func:y.ALWAYS,mask:0},0,255,y.ZERO,y.ZERO,y.ZERO),this.loadTimeStamps.push(c.window.performance.now()),this.atmosphereBuffer=new dr(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,l=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(i,l.TRIANGLES,c.DepthMode.disabled,this.stencilClearMode,c.ColorMode.disabled,c.CullFaceMode.disabled,Is(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,l,p){if(!l||this.currentStencilSource===l.id||!i.isTileClipped()||!p||0===p.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let m=!1;for(const y of p)if(void 0===this._tileClippingMaskIDs[y.key]){m=!0;break}if(!m)return}this.currentStencilSource=l.id;const w=this.context,C=w.gl;this.nextStencilID+p.length>256&&this.clearStencil(),w.setColorMode(c.ColorMode.disabled),w.setDepthMode(c.DepthMode.disabled);const P=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const m of p){const y=l.getTile(m),_=this._tileClippingMaskIDs[m.key]=this.nextStencilID++,{tileBoundsBuffer:T,tileBoundsIndexBuffer:M,tileBoundsSegments:F}=this.getTileBoundsBuffers(y);P.draw(w,C.TRIANGLES,c.DepthMode.disabled,new c.StencilMode({func:C.ALWAYS,mask:0},_,255,C.KEEP,C.KEEP,C.REPLACE),c.ColorMode.disabled,c.CullFaceMode.disabled,Is(m.projMatrix),"$clipping",T,M,F)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,l=this.context.gl;return new c.StencilMode({func:l.NOTEQUAL,mask:255},i,255,l.KEEP,l.KEEP,l.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const l=this.context.gl;return new c.StencilMode({func:l.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,l.KEEP,l.KEEP,l.REPLACE)}stencilConfigForOverlap(i){const l=this.context.gl,p=i.sort((P,m)=>m.overscaledZ-P.overscaledZ),w=p[p.length-1].overscaledZ,C=p[0].overscaledZ-w+1;if(C>1){this.currentStencilSource=void 0,this.nextStencilID+C>256&&this.clearStencil();const P={};for(let m=0;m<C;m++)P[m+w]=new c.StencilMode({func:l.GEQUAL,mask:255},m+this.nextStencilID,255,l.KEEP,l.KEEP,l.REPLACE);return this.nextStencilID+=C,[P,p]}return[{[w]:c.StencilMode.disabled},p]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new c.ColorMode([i.CONSTANT_COLOR,i.ONE],new c.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?c.ColorMode.unblended:c.ColorMode.alphaBlended}depthModeForSublayer(i,l,p){if(!this.opaquePassEnabledForLayer())return c.DepthMode.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new c.DepthMode(p||this.context.gl.LEQUAL,l,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,l){this.style=i,this.options=l,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(c.exported.now()),this.imageManager.beginFrame();const p=this.style.order,w=this.style._sourceCaches;for(const _ in w){const T=w[_];T.used&&T.prepare(this.context)}const C={},P={},m={};for(const _ in w){const T=w[_];C[_]=T.getVisibleCoordinates(),P[_]=C[_].slice().reverse(),m[_]=T.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let _=0;_<p.length;_++)if(this.style._layers[p[_]].is3D()){this.opaquePassCutoff=_;break}if(this.terrain&&(this.terrain.updateTileBinding(m),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new c.GlobeSharedBuffers(this.context)),!c.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const _ of p){const T=this.style._layers[_],M=i._getLayerSourceCache(T);if(!T.hasOffscreenPass()||T.isHidden(this.transform.zoom))continue;const F=M?P[M.id]:void 0;("custom"===T.type||T.isSky()||F&&F.length)&&this.renderLayer(this,M,T,F)}this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon];const y=this.terrain;if(y&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&y.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:l.showOverdrawInspector?c.Color.black:c.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=l.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=p.length-1;this.currentLayer>=0;this.currentLayer--){const _=this.style._layers[p[this.currentLayer]],T=i._getLayerSourceCache(_);if(_.isSky())continue;const M=T?P[T.id]:void 0;this._renderTileClippingMasks(_,T,M),this.renderLayer(this,T,_,M)}if(this.style.fog&&this.transform.projection.supportsFog&&function(_,T){const M=_.context,F=M.gl,U=_.transform,K=new c.DepthMode(F.LEQUAL,c.DepthMode.ReadOnly,[0,1]),ee=_.useProgram("globeAtmosphere",null,"globe"===U.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),le=c.globeToMercatorTransition(U.zoom),Z=T.properties.get("color").toArray01(),ce=T.properties.get("high-color").toArray01(),_e=T.properties.get("space-color").toArray01PremultipliedAlpha(),we=c.identity$1([]);c.rotateY$1(we,we,-c.degToRad(U._center.lng)),c.rotateX$1(we,we,c.degToRad(U._center.lat)),c.rotateZ$1(we,we,U.angle),c.rotateX$1(we,we,-U._pitch);const ke=c.fromQuat(new Float32Array(16),we),Be=c.mapValue(T.properties.get("star-intensity"),0,1,0,.25),Ze=c.mapValue(T.properties.get("horizon-blend"),0,1,5e-4,.25),He=c.globeUseCustomAntiAliasing(_,M,U)&&5e-4===Ze?U.worldSize/(2*Math.PI*1.025)-1:U.globeRadius,nt=_.frameCounter/1e3%1,Gt=c.length(U.globeCenterInViewSpace),Je=Math.sqrt(Math.pow(Gt,2)-Math.pow(He,2)),wt=Math.acos(Je/Gt),ct={u_frustum_tl:U.frustumCorners.TL,u_frustum_tr:U.frustumCorners.TR,u_frustum_br:U.frustumCorners.BR,u_frustum_bl:U.frustumCorners.BL,u_horizon:U.frustumCorners.horizon,u_transition:le,u_fadeout_range:Ze,u_color:Z,u_high_color:ce,u_space_color:_e,u_star_intensity:Be,u_star_size:5*c.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:nt,u_horizon_angle:wt,u_rotation_matrix:ke};_.prepareDrawProgram(M,ee);const $t=_.atmosphereBuffer;$t&&ee.draw(M,F.TRIANGLES,K,c.StencilMode.disabled,c.ColorMode.alphaBlended,c.CullFaceMode.backCW,ct,"skybox",$t.vertexBuffer,$t.indexBuffer,$t.segments)}(this,this.style.fog),this.renderPass="sky",(c.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const _=this.style._layers[p[this.currentLayer]],T=i._getLayerSourceCache(_);_.isSky()&&this.renderLayer(this,T,_,T?P[T.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<p.length;){const _=this.style._layers[p[this.currentLayer]],T=i._getLayerSourceCache(_);if(_.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(_)){if(_.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const M=T?("symbol"===_.type?m:P)[T.id]:void 0;this._renderTileClippingMasks(_,T,T?C[T.id]:void 0),this.renderLayer(this,T,_,M),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let _=null;c.values(this.style._layers).forEach(T=>{const M=i._getLayerSourceCache(T);M&&!T.isHidden(this.transform.zoom)&&(!_||_.getSource().maxzoom<M.getSource().maxzoom)&&(_=M)}),_&&this.options.showTileBoundaries&&Si.debug(this,_,_.getVisibleCoordinates())}this.options.showPadding&&function(_){const T=_.transform.padding;ci(_,_.transform.height-(T.top||0),3,Oe),ci(_,T.bottom||0,3,Ue),oi(_,T.left||0,3,st),oi(_,_.transform.width-(T.right||0),3,mt);const M=_.transform.centerPoint;var F,U,K,ee;Un(F=_,(U=M.x)-1,(K=_.transform.height-M.y)-10,2,20,ee=xn),Un(F,U-10,K-1,20,2,ee)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(c.window.performance.now()),this.saveCanvasCopy())}renderLayer(i,l,p,w){p.isHidden(this.transform.zoom)||("background"===p.type||"sky"===p.type||"custom"===p.type||w&&w.length)&&(this.id=p.id,this.gpuTimingStart(p),(!i.transform.projection.unsupportedLayers||!i.transform.projection.unsupportedLayers.includes(p.type)||i.terrain&&"custom"===p.type)&&Si[p.type](i,l,p,w,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const l=this.context.extTimerQuery;let p=this.gpuTimers[i.id];p||(p=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:l.createQueryEXT()}),p.calls++,l.beginQueryEXT(l.TIME_ELAPSED_EXT,p.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,l=i.createQueryEXT();this.deferredRenderGpuTimeQueries.push(l),i.beginQueryEXT(i.TIME_ELAPSED_EXT,l)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const l={};for(const p in i){const w=i[p],C=this.context.extTimerQuery,P=C.getQueryObjectEXT(w.query,C.QUERY_RESULT_EXT)/1e6;C.deleteQueryEXT(w.query),l[p]=P}return l}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const l=this.context.extTimerQuery;let p=0;for(const w of i)p+=l.getQueryObjectEXT(w,l.QUERY_RESULT_EXT)/1e6,l.deleteQueryEXT(w);return p}translatePosMatrix(i,l,p,w,C){if(!p[0]&&!p[1])return i;const P=C?"map"===w?this.transform.angle:0:"viewport"===w?-this.transform.angle:0;if(P){const _=Math.sin(P),T=Math.cos(P);p=[p[0]*T-p[1]*_,p[0]*_+p[1]*T]}const m=[C?p[0]:at(l,p[0],this.transform.zoom),C?p[1]:at(l,p[1],this.transform.zoom),0],y=new Float32Array(16);return c.translate(y,i,m),y}saveTileTexture(i){const l=this._tileTextures[i.size[0]];l?l.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const l=this._tileTextures[i];return l&&l.length>0?l.pop():null}isPatternMissing(i){return null===i||void 0!==i&&!this.imageManager.getPattern(i.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,l=this.terrain&&0===this.terrain.exaggeration(),p=this.style&&this.style.fog,w=[];return this.terrainRenderModeElevated()&&w.push("TERRAIN"),"globe"===this.transform.projection.name&&w.push("GLOBE"),l&&w.push("ZERO_EXAGGERATION"),p&&!i&&0!==p.getOpacity(this.transform.pitch)&&w.push("FOG"),i&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}useProgram(i,l,p){this.cache=this.cache||{};const w=p||[],C=this.currentGlobalDefines().concat(w),P=mi.cacheKey(fa[i],i,C,l);return this.cache[P]||(this.cache[P]=new mi(this.context,i,fa[i],l,Es[i],C)),this.cache[P]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=c.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new c.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(i,l,p){if(this.terrain&&this.terrain.renderingToTexture)return;const w=this.style.fog;if(w){const C=w.getOpacity(this.transform.pitch),P=((m,y,_,T,M,F,U,K,ee,le,Z)=>{const ce=m.transform,_e=y.properties.get("color").toArray01();_e[3]=T;const we=m.frameCounter/1e3%1;return{u_fog_matrix:_?ce.calculateFogTileMatrix(_):m.identityMat,u_fog_range:y.getFovAdjustedRange(ce._fov),u_fog_color:_e,u_fog_horizon_blend:y.properties.get("horizon-blend"),u_fog_temporal_offset:we,u_frustum_tl:M,u_frustum_tr:F,u_frustum_br:U,u_frustum_bl:K,u_globe_pos:ee,u_globe_radius:le,u_viewport:Z,u_globe_transition:c.globeToMercatorTransition(ce.zoom),u_is_globe:+("globe"===ce.projection.name)}})(this,w,p,C,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*c.exported.devicePixelRatio,this.transform.height*c.exported.devicePixelRatio]);l.setFogUniformValues(i,P)}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,l=i.createTexture();return i.bindTexture(i.TEXTURE_2D,l),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),l}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&0!==i.getOpacity(this.transform.pitch)}getBackgroundTiles(){const i=this._backgroundTiles,l=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const w of p)l[w.key]=i[w.key]||new c.Tile(w,512,this.transform.tileZoom,this);return l}clearBackgroundTiles(){this._backgroundTiles={}}}class N{constructor(i=0,l=0,p=0,w=0){if(isNaN(i)||i<0||isNaN(l)||l<0||isNaN(p)||p<0||isNaN(w)||w<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=l,this.left=p,this.right=w}interpolate(i,l,p){return null!=l.top&&null!=i.top&&(this.top=c.number(i.top,l.top,p)),null!=l.bottom&&null!=i.bottom&&(this.bottom=c.number(i.bottom,l.bottom,p)),null!=l.left&&null!=i.left&&(this.left=c.number(i.left,l.left,p)),null!=l.right&&null!=i.right&&(this.right=c.number(i.right,l.right,p)),this}getCenter(i,l){const p=c.clamp((this.left+i-this.right)/2,0,i),w=c.clamp((this.top+l-this.bottom)/2,0,l);return new c.Point(p,w)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new N(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function J(h,i){const l=c.getColumn(h,3);c.fromQuat(h,i),c.setColumn(h,3,l)}function j(h,i){const l=c.identity$1([]);return c.rotateZ$1(l,l,-i),c.rotateX$1(l,l,-h),l}function ue(h,i){const l=[h[0],h[1],0],p=[i[0],i[1],0];if(c.length(l)>=1e-15){const P=c.normalize([],l);c.scale$2(p,P,c.dot(p,P)),i[0]=p[0],i[1]=p[1]}const w=c.cross([],i,h);if(c.len(w)<1e-15)return null;const C=Math.atan2(-w[1],w[0]);return j(Math.atan2(Math.sqrt(h[0]*h[0]+h[1]*h[1]),-h[2]),C)}class Ae{constructor(i,l){this.position=i,this.orientation=l}get position(){return this._position}set position(i){if(i){const l=i instanceof c.MercatorCoordinate?i:new c.MercatorCoordinate(i[0],i[1],i[2]);this._renderWorldCopies&&(l.x=c.wrap(l.x,0,1)),this._position=l}else this._position=null}lookAtPoint(i,l){if(this.orientation=null,!this.position)return;const p=this.position,w=this._elevation?this._elevation.getAtPointOrZero(c.MercatorCoordinate.fromLngLat(i)):0,C=c.MercatorCoordinate.fromLngLat(i,w),P=[C.x-p.x,C.y-p.y,C.z-p.z];l||(l=[0,0,1]),l[2]=Math.abs(l[2]),this.orientation=ue(P,l)}setPitchBearing(i,l){this.orientation=j(c.degToRad(i),c.degToRad(-l))}}class et{constructor(i,l){this._transform=c.identity([]),this.orientation=l,this.position=i}get mercatorPosition(){const i=this.position;return new c.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=c.getColumn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var l;i&&c.setColumn(this._transform,3,[(l=i)[0],l[1],l[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||c.identity$1([]),i&&J(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),l=this.right();return{bearing:Math.atan2(-l[1],l[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,l){this._orientation=j(i,l),J(this._transform,this._orientation)}forward(){const i=c.getColumn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=c.getColumn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=c.getColumn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,l){const p=new Float64Array(16);return c.invert(p,this.getWorldToCamera(i,l)),p}getWorldToCameraPosition(i,l,p){const w=this.position;c.scale$2(w,w,-i);const C=new Float64Array(16);return c.fromScaling(C,[p,p,p]),c.translate(C,C,w),C[10]*=l,C}getWorldToCamera(i,l){const p=new Float64Array(16),w=new Float64Array(4),C=this.position;return c.conjugate(w,this._orientation),c.scale$2(C,C,-i),c.fromQuat(p,w),c.translate(p,p,C),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=l,p[9]*=l,p[10]*=l,p[11]*=l,p}getCameraToClipPerspective(i,l,p,w){const C=new Float64Array(16);return c.perspective(C,i,l,p,w),C}getDistanceToElevation(i,l=!1){const p=0===i?0:c.mercatorZfromAltitude(i,l?c.latFromMercatorY(this.position[1]):this.position[1]),w=this.forward();return(p-this.position[2])/w[2]}clone(){return new et([...this.position],[...this.orientation])}}function x(h,i){const l=I(h.projection,h.zoom,h.width,h.height),p=function(C,P,m,y,_){const T=new c.LngLat(m.lng-180*H,m.lat),M=new c.LngLat(m.lng+180*H,m.lat),F=C.project(T.lng,T.lat),U=C.project(M.lng,M.lat),K=-Math.atan2(U.y-F.y,U.x-F.x),ee=c.MercatorCoordinate.fromLngLat(m);ee.y=c.clamp(ee.y,-1+H,1-H);const le=ee.toLngLat(),Z=C.project(le.lng,le.lat),ce=c.MercatorCoordinate.fromLngLat(le);ce.x+=H;const _e=ce.toLngLat(),we=C.project(_e.lng,_e.lat),ke=We(we.x-Z.x,we.y-Z.y,K),Be=c.MercatorCoordinate.fromLngLat(le);Be.y+=H;const Pe=Be.toLngLat(),Ze=C.project(Pe.lng,Pe.lat),He=We(Ze.x-Z.x,Ze.y-Z.y,K),nt=Math.abs(ke.x)/Math.abs(He.y),Gt=c.identity([]);c.rotateZ(Gt,Gt,-K*(1-(_?0:y)));const Je=c.identity([]);return c.scale(Je,Je,[1,1-(1-nt)*y,1]),Je[4]=-He.x/He.y*y,c.rotateZ(Je,Je,K),c.multiply(Je,Gt,Je),Je}(h.projection,0,h.center,l,i),w=E(h);return c.scale(p,p,[w,w,1]),p}function E(h){const i=h.projection,l=I(h.projection,h.zoom,h.width,h.height),p=pe(i,h.center),w=pe(i,c.LngLat.convert(i.center));return Math.pow(2,p*l+(1-l)*w)}function I(h,i,l,p,w=1/0){const C=h.range;if(!C)return 0;const P=Math.min(w,Math.max(l,p)),m=Math.log(P/1024)/Math.LN2;return c.smoothstep(C[0]+m,C[1]+m,i)}const H=1/4e4;function pe(h,i){const l=c.clamp(i.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),p=new c.LngLat(i.lng-180*H,l),w=new c.LngLat(i.lng+180*H,l),C=h.project(p.lng,l),P=h.project(w.lng,l),m=c.MercatorCoordinate.fromLngLat(p),y=c.MercatorCoordinate.fromLngLat(w),_=P.x-C.x,T=P.y-C.y,M=y.x-m.x,F=y.y-m.y,U=Math.sqrt((M*M+F*F)/(_*_+T*T));return Math.log(U)/Math.LN2}function We(h,i,l){const p=Math.cos(l),w=Math.sin(l);return{x:h*p-i*w,y:h*w+i*p}}class en{constructor(i,l,p,w,C,P,m){this.tileSize=512,this._renderWorldCopies=void 0===C||C,this._minZoom=i||0,this._maxZoom=l||22,this._minPitch=p??0,this._maxPitch=w??60,this.setProjection(P),this.setMaxBounds(m),this.width=0,this.height=0,this._center=new c.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new N,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new et,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const i=new en(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(i,l=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||p)&&this._updateCameraOnTerrain(),(i||p)&&this._constrainCamera(l),this._calcMatrices()}getProjection(){return c.pick(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const l=this.projection?this.getProjection():void 0;this.projection=c.getProjection(this.projectionOptions);const p=!Re(l,this.getProjection());return p&&this._calcMatrices(),this.mercatorFromTransition=!1,p}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=c.getProjection({name:"mercator"});const l=i!==this.projection.name;return l&&this._calcMatrices(),l}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(i){void 0===i?i=!0:null===i&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return c.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new c.Point(this.width,this.height)}get bearing(){return c.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const l=-i*Math.PI/180;var p,w,C,P,m,y,_,T,M,F;this.angle!==l&&(this._unmodified=!1,this.angle=l,this._calcMatrices(),this.rotationMatrix=(p=new c.ARRAY_TYPE(4),c.ARRAY_TYPE!=Float32Array&&(p[1]=0,p[2]=0),p[0]=1,p[3]=1,p),w=this.rotationMatrix,P=this.angle,m=(C=this.rotationMatrix)[0],y=C[1],_=C[2],T=C[3],M=Math.sin(P),F=Math.cos(P),w[0]=m*F+_*M,w[1]=y*F+T*M,w[2]=m*-M+_*F,w[3]=y*-M+T*F)}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const l=c.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==l&&(this._unmodified=!1,this._pitch=l,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=c.degToRad(i),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const l=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==l&&(this._unmodified=!1,this._setZoom(l),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;this._centerAltitude=i.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=i.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,l=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let w=0,C=0;for(let P=0;P<l.length;P++){const m=new c.Point(l[P][0]*this.width,p+l[P][1]*(this.height-p)),y=i.pointCoordinate(m);if(!y)continue;const _=1/Math.hypot(y[0]-this._camera.position[0],y[1]-this._camera.position[1]);w+=y[3]*_,C+=_}return 0===C?NaN:w/C}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const i=this._seaLevelZoom,l=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*l,w=this._mercatorZfromZoom(i),C=this._mercatorZfromZoom(this._maxZoom),P=Math.max(w-p,C);this._setZoom(this._zoomFromMercatorZ(P))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const l=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let p;p=i.z<this._camera.position[2]?[l.x,l.y,l.z]:[i.x,i.y,i.z];const w=c.length(c.sub([],this._camera.position,p));return c.clamp(this._zoomFromMercatorZ(w),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let l=!1;if(i.orientation&&!c.exactEquals(i.orientation,this._camera.orientation)&&(l=this._setCameraOrientation(i.orientation)),i.position){const p=[i.position.x,i.position.y,i.position.z];c.exactEquals$1(p,this._camera.position)||(this._setCameraPosition(p),l=!0)}l&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,l=new Ae;return l.position=new c.MercatorCoordinate(i[0],i[1],i[2]),l.orientation=this._camera.orientation,l._elevation=this.elevation,l._renderWorldCopies=this.renderWorldCopies,l}_setCameraOrientation(i){if(!c.length$1(i))return!1;c.normalize$1(i,i);const l=c.transformQuat([],[0,0,-1],i),p=c.transformQuat([],[0,-1,0],i);if(p[2]<0)return!1;const w=ue(l,p);return!!w&&(this._camera.orientation=w,!0)}_setCameraPosition(i){const l=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,w=this.cameraToCenterDistance;i[2]=c.clamp(i[2],w/p,w/l),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,l,p){this._unmodified=!1,this._edgeInsets.interpolate(i,l,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const l=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,l)}getVisibleUnwrappedCoordinates(i){const l=[new c.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const p=this.pointCoordinate(new c.Point(0,0)),w=this.pointCoordinate(new c.Point(this.width,0)),C=this.pointCoordinate(new c.Point(this.width,this.height)),P=this.pointCoordinate(new c.Point(0,this.height)),m=Math.floor(Math.min(p.x,w.x,C.x,P.x)),y=Math.floor(Math.max(p.x,w.x,C.x,P.x)),_=1;for(let T=m-_;T<=y+_;T++)0!==T&&l.push(new c.UnwrappedTileID(T,i))}return l}coveringTiles(i){let l=this.coveringZoomLevel(i);const p=l,w=this.elevation&&!i.isTerrainDEM,C="mercator"===this.projection.name;if(void 0!==i.minzoom&&l<i.minzoom)return[];void 0!==i.maxzoom&&l>i.maxzoom&&(l=i.maxzoom);const P=this.locationCoordinate(this.center),m=this.center.lat,y=1<<l,_=[y*P.x,y*P.y,0],T="globe"===this.projection.name,M=!T,F=c.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,l,M),U=T?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),K=y*c.mercatorZfromAltitude(1,this.center.lat),ee=this._camera.position[2]/c.mercatorZfromAltitude(1,this.center.lat),le=[y*U.x,y*U.y,ee*(M?1:K)],Z=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),ce=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?l:0,_e=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,we=i.isTerrainDEM?-_e:this._elevation?this._elevation.getMinElevationBelowMSL():0,ke=this.projection.isReprojectedInTileSpace?E(this):1,Be=it=>{const Vt=new c.MercatorCoordinate(it.x+25e-6,it.y,it.z),Rt=new c.MercatorCoordinate(it.x,it.y+25e-6,it.z),Kt=it.toLngLat(),jn=Vt.toLngLat(),di=Rt.toLngLat(),Pn=this.locationCoordinate(Kt),Kn=this.locationCoordinate(jn),Ui=this.locationCoordinate(di),Fi=Math.hypot(Kn.x-Pn.x,Kn.y-Pn.y),Bn=Math.hypot(Ui.x-Pn.x,Ui.y-Pn.y);return Math.sqrt(Fi*Bn)*ke/25e-6},Pe=it=>{const vt=_e,Vt=we;return{aabb:c.tileAABB(this,y,0,0,0,it,Vt,vt,this.projection),zoom:0,x:0,y:0,minZ:Vt,maxZ:vt,wrap:it,fullyVisible:!1}},Ze=[];let He=[];const nt=l,Gt=i.reparseOverscaled?p:l,Je=it=>it*it,wt=Je((ee-this._centerAltitude)*K),ct=it=>{if(!this._elevation||!it.tileID||!C)return;const vt=this._elevation.getMinMaxForTile(it.tileID),Vt=it.aabb;vt?(Vt.min[2]=vt.min,Vt.max[2]=vt.max,Vt.center[2]=(Vt.min[2]+Vt.max[2])/2):(it.shouldSplit=$t(it),it.shouldSplit||(Vt.min[2]=Vt.max[2]=Vt.center[2]=this._centerAltitude))},$t=it=>{if(it.zoom<ce)return!0;if(it.zoom===nt)return!1;if(null!=it.shouldSplit)return it.shouldSplit;const vt=it.aabb.distanceX(le),Vt=it.aabb.distanceY(le);let Rt=wt,Kt=1;if(T){Rt=Je(it.aabb.distanceZ(le));const Pn=Math.pow(2,it.zoom),Kn=c.latFromMercatorY((it.y+1)/Pn),Ui=c.latFromMercatorY(it.y/Pn),Fi=Math.min(Math.max(m,Kn),Ui),Bn=c.circumferenceAtLatitude(Fi)/c.circumferenceAtLatitude(m);if(Kt=Fi===m?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Bn/this._mercatorScaleRatio),this.zoom<=c.GLOBE_ZOOM_THRESHOLD_MIN&&it.zoom===nt-1&&Bn>=.9)return!0}else if(w&&(Rt=Je(it.aabb.distanceZ(le)*K)),this.projection.isReprojectedInTileSpace&&p<=5){const Pn=Math.pow(2,it.zoom),Kn=Be(new c.MercatorCoordinate((it.x+.5)/Pn,(it.y+.5)/Pn));Kt=Kn>.85?1:Kn}const jn=vt*vt+Vt*Vt+Rt;return jn<Je((1<<nt-it.zoom)*Z*Kt*((Pn,Kn)=>{if(Kn*Je(.707)<Pn)return 1;const Ui=Math.sqrt(Kn/Pn);return Ui/(1.4144271570014144+(Math.pow(1.1,Ui-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Rt,wt),jn))};if(this.renderWorldCopies)for(let it=1;it<=3;it++)Ze.push(Pe(-it)),Ze.push(Pe(it));for(Ze.push(Pe(0));Ze.length>0;){const it=Ze.pop(),vt=it.x,Vt=it.y;let Rt=it.fullyVisible;if(!Rt){const Kt=it.aabb.intersects(F);if(0===Kt)continue;Rt=2===Kt}if(it.zoom!==nt&&$t(it))for(let Kt=0;Kt<4;Kt++){const jn=(vt<<1)+Kt%2,di=(Vt<<1)+(Kt>>1),Pn={aabb:C?it.aabb.quadrant(Kt):c.tileAABB(this,y,it.zoom+1,jn,di,it.wrap,it.minZ,it.maxZ,this.projection),zoom:it.zoom+1,x:jn,y:di,wrap:it.wrap,fullyVisible:Rt,tileID:void 0,shouldSplit:void 0,minZ:it.minZ,maxZ:it.maxZ};w&&!T&&(Pn.tileID=new c.OverscaledTileID(it.zoom+1===nt?Gt:it.zoom+1,it.wrap,it.zoom+1,jn,di),ct(Pn)),Ze.push(Pn)}else{const Kt=it.zoom===nt?Gt:it.zoom;if(i.minzoom&&i.minzoom>Kt)continue;const jn=_[0]-(.5+vt+(it.wrap<<it.zoom))*(1<<l-it.zoom),di=_[1]-.5-Vt,Pn=it.tileID?it.tileID:new c.OverscaledTileID(Kt,it.wrap,it.zoom,vt,Vt);He.push({tileID:Pn,distanceSq:jn*jn+di*di})}}if(this.fogCullDistSq){const it=this.fogCullDistSq,vt=this.horizonLineFromTop();He=He.filter(Vt=>{const Rt=[0,0,0,1],Kt=[c.EXTENT,c.EXTENT,0,1],jn=this.calculateFogTileMatrix(Vt.tileID.toUnwrapped());c.transformMat4$1(Rt,Rt,jn),c.transformMat4$1(Kt,Kt,jn);const di=c.getAABBPointSquareDist(Rt,Kt);if(0===di)return!0;let Pn=!1;const Kn=this._elevation;if(Kn&&di>it&&0!==vt){const Ui=this.calculateProjMatrix(Vt.tileID.toUnwrapped());let Fi;i.isTerrainDEM||(Fi=Kn.getMinMaxForTile(Vt.tileID)),Fi||(Fi={min:we,max:_e});const Bn=c.furthestTileCorner(this.rotation),rr=[Bn[0]*c.EXTENT,Bn[1]*c.EXTENT,Fi.max];c.transformMat4(rr,rr,Ui),Pn=(1-rr[1])*this.height*.5<vt}return di<it||Pn})}return He.sort((it,vt)=>it.distanceSq-vt.distanceSq).map(it=>it.tileID)}resize(i,l){this.width=i,this.height=l,this.pixelsToGLUnits=[2/i,-2/l],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const l=c.clamp(i.lat,-c.MAX_MERCATOR_LATITUDE,c.MAX_MERCATOR_LATITUDE),p=this.projection.project(i.lng,l);return new c.Point(p.x*this.worldSize,p.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/c.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,l){let p,w;const C=this.centerPoint;if("globe"===this.projection.name){const m=this.worldSize;p=(l.x-C.x)/m,w=(l.y-C.y)/m}else{const m=this.pointCoordinate(l),y=this.pointCoordinate(C);p=m.x-y.x,w=m.y-y.y}const P=this.locationCoordinate(i);this.setLocation(new c.MercatorCoordinate(P.x-p,P.y-w))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,l){const p=l?c.mercatorZfromAltitude(l,i.lat):void 0,w=this.projection.project(i.lng,i.lat);return new c.MercatorCoordinate(w.x,w.y,p)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,l){const p=l??this._centerAltitude,w=[i.x,i.y,0,1],C=[i.x,i.y,1,1];c.transformMat4$1(w,w,this.pixelMatrixInverse),c.transformMat4$1(C,C,this.pixelMatrixInverse);const P=C[3];c.scale$1(w,w,1/w[3]),c.scale$1(C,C,1/P);const m=w[2],y=C[2];return{p0:w,p1:C,t:m===y?0:(p-m)/(y-m)}}screenPointToMercatorRay(i){const l=[i.x,i.y,0,1],p=[i.x,i.y,1,1];return c.transformMat4$1(l,l,this.pixelMatrixInverse),c.transformMat4$1(p,p,this.pixelMatrixInverse),c.scale$1(l,l,1/l[3]),c.scale$1(p,p,1/p[3]),l[2]=c.mercatorZfromAltitude(l[2],this._center.lat)*this.worldSize,p[2]=c.mercatorZfromAltitude(p[2],this._center.lat)*this.worldSize,c.scale$1(l,l,1/this.worldSize),c.scale$1(p,p,1/this.worldSize),new c.Ray([l[0],l[1],l[2]],c.normalize([],c.sub([],p,l)))}rayIntersectionCoordinate(i){const{p0:l,p1:p,t:w}=i,C=c.mercatorZfromAltitude(l[2],this._center.lat),P=c.mercatorZfromAltitude(p[2],this._center.lat);return new c.MercatorCoordinate(c.number(l[0],p[0],w)/this.worldSize,c.number(l[1],p[1],w)/this.worldSize,c.number(C,P,w))}pointCoordinate(i,l=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,l)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let l=this.projection.pointCoordinate3D(this,i.x,i.y);if(l)return new c.MercatorCoordinate(l[0],l[1],l[2]);let p=0,w=this.horizonLineFromTop();if(i.y>w)return this.pointCoordinate(i);const C=.02*w,P=i.clone();for(let m=0;m<10&&w-p>C;m++){P.y=c.number(p,w,.66);const y=this.projection.pointCoordinate3D(this,P.x,P.y);y?(w=P.y,l=y):p=P.y}return l?new c.MercatorCoordinate(l[0],l[1],l[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=c.GLOBE_ZOOM_THRESHOLD_MAX)return!this.isPointAboveHorizon(i);const l=this.pointCoordinate(i);return l.y>=0&&l.y<=1}_coordinatePoint(i,l){const p=l&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,w=[i.x*this.worldSize,i.y*this.worldSize,p+i.toAltitude(),1];return c.transformMat4$1(w,w,this.pixelMatrix),w[3]>0?new c.Point(w[0]/w[3],w[1]/w[3]):new c.Point(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:l}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,w=this.width-this._edgeInsets.right,C=this.pointLocation3D(new c.Point(l,i)),P=this.pointLocation3D(new c.Point(w,i)),m=this.pointLocation3D(new c.Point(w,p)),y=this.pointLocation3D(new c.Point(l,p));let _=Math.min(C.lng,P.lng,m.lng,y.lng),T=Math.max(C.lng,P.lng,m.lng,y.lng),M=Math.min(C.lat,P.lat,m.lat,y.lat),F=Math.max(C.lat,P.lat,m.lat,y.lat);const U=Math.pow(2,-this.zoom)/16*270,K="globe"===this.projection.name?1:4,ee=(le,Z,ce,_e,we)=>{const ke=(le+ce)/2,Be=(Z+_e)/2,Pe=new c.Point(ke,Be),{lng:Ze,lat:He}=this.pointLocation3D(Pe),nt=Math.max(0,_-Ze,M-He,Ze-T,He-F);_=Math.min(_,Ze),T=Math.max(T,Ze),M=Math.min(M,He),F=Math.max(F,He),(we<K||nt>U)&&(ee(le,Z,ke,Be,we+1),ee(ke,Be,ce,_e,we+1))};if(ee(l,i,w,i,1),ee(w,i,w,p,1),ee(w,p,l,p,1),ee(l,p,l,i,1),"globe"===this.projection.name){const[le,Z]=c.polesInViewport(this);le?(F=90,T=180,_=-180):Z&&(M=-90,T=180,_=-180)}return new c.LngLatBounds(new c.LngLat(_,M),new c.LngLat(T,F))}_getBoundsRectangular(i,l){const{top:p,left:w}=this._edgeInsets,C=this.height-this._edgeInsets.bottom,P=this.width-this._edgeInsets.right,m=new c.Point(w,p),y=new c.Point(P,p),_=new c.Point(P,C),T=new c.Point(w,C);let M=this.pointCoordinate(m,i),F=this.pointCoordinate(y,i);const U=this.pointCoordinate(_,l),K=this.pointCoordinate(T,l),ee=(le,Z)=>(Z.y-le.y)/(Z.x-le.x);return M.y>1&&F.y>=0?M=new c.MercatorCoordinate((1-K.y)/ee(K,M)+K.x,1):M.y<0&&F.y<=1&&(M=new c.MercatorCoordinate(-K.y/ee(K,M)+K.x,0)),F.y>1&&M.y>=0?F=new c.MercatorCoordinate((1-U.y)/ee(U,F)+U.x,1):F.y<0&&M.y<=1&&(F=new c.MercatorCoordinate(-U.y/ee(U,F)+U.x,0)),(new c.LngLatBounds).extend(this.coordinateLocation(M)).extend(this.coordinateLocation(F)).extend(this.coordinateLocation(K)).extend(this.coordinateLocation(U))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const l=i.visibleDemTiles.reduce((p,w)=>{if(w.dem){const C=w.dem.tree;p.min=Math.min(p.min,C.minimums[0]),p.max=Math.max(p.max,C.maximums[0])}return p},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(l.min*i.exaggeration(),l.max*i.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const l=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,p=this.height/2-l*(1-this._horizonShift);return i?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-c.MAX_MERCATOR_LATITUDE,this.maxLat=c.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=c.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=c.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=c.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=c.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,l){return this.projection.createTileMatrix(this,l,i)}calculateDistanceTileData(i){const l=i.key,p=this._distanceTileDataCache;if(p[l])return p[l];const w=i.canonical,C=1/this.height,P=this.cameraWorldSize,m=P/this.zoomScale(w.z),y=(w.x+Math.pow(2,w.z)*i.wrap)*m,_=w.y*m,T=this.point;T.x*=P/this.worldSize,T.y*=P/this.worldSize;const M=this.angle,F=Math.sin(-M),U=-Math.cos(-M);return p[l]={bearing:[F,U],center:[(T.x-y)*C,(T.y-_)*C],scale:m/c.EXTENT*C},p[l]}calculateFogTileMatrix(i){const l=i.key,p=this._fogTileMatrixCache;if(p[l])return p[l];const w=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return c.multiply(w,this.worldToFogMatrix,w),p[l]=new Float32Array(w),p[l]}calculateProjMatrix(i,l=!1){const p=i.key,w=l?this._alignedProjMatrixCache:this._projMatrixCache;if(w[p])return w[p];const C=this.calculatePosMatrix(i,this.worldSize);return c.multiply(C,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:l?this.alignedProjMatrix:this.projMatrix,C),w[p]=new Float32Array(C),w[p]}calculatePixelsToTileUnitsMatrix(i){const l=i.tileID.key,p=this._pixelsToTileUnitsCache;if(p[l])return p[l];const w=function(C,P){const{scale:m}=C.tileTransform,y=m*c.EXTENT/(C.tileSize*Math.pow(2,P.zoom-C.tileID.overscaledZ+C.tileID.canonical.z));return _=new Float32Array(4),F=(T=P.inverseAdjustmentMatrix)[1],U=T[2],K=T[3],le=(M=[y,y])[1],_[0]=T[0]*(ee=M[0]),_[1]=F*ee,_[2]=U*le,_[3]=K*le,_;var _,T,M,F,U,K,ee,le}(i,this);return p[l]=w,p[l]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const i=1/this.worldSize,l=c.fromScaling([],[i,i,i]);return c.multiply(l,l,this.globeMatrix),l}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const i=this._elevation;this._updateCameraState();const l=c.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(l),w=this._camera.forward(),C=c.mercatorZfromAltitude(1,this._center.lat);p[2]/=C,w[2]/=C,c.normalize(w,w);const P=i.raycast(p,w,i.exaggeration());if(P){const m=c.scaleAndAdd([],p,w,P),y=new c.MercatorCoordinate(m[0],m[1],c.mercatorZfromAltitude(m[2],c.latFromMercatorY(m[1]))),_=(y.z+c.length([y.x-p[0],y.y-p[1],y.z-p[2]*C]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(_),this._centerAltitude=y.toAltitude(),this._center=this.coordinateLocation(y),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const l=this._elevation,p=c.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,w=this._computeCameraPosition(p),C=l.getAtPointOrZero(new c.MercatorCoordinate(...w)),P=this.pixelsPerMeter/this.worldSize*C,m=this._minimumHeightOverTerrain(),y=w[2]-P;if(y<=m)if(y<0||i){const _=this.locationCoordinate(this._center,this._centerAltitude),T=[w[0],w[1],_.z-w[2]],M=c.length(T);T[2]-=(m-y)/this._pixelsPerMercatorPixel;const F=c.length(T);if(0===F)return;c.scale$2(T,T,M/F*this._pixelsPerMercatorPixel),this._camera.position=[w[0],w[1],_.z*this._pixelsPerMercatorPixel-T[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const F=this.center;return F.lat=c.clamp(F.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(F.lng=c.clamp(F.lng,this.minLng,this.maxLng)),this.center=F,void(this._constraining=!1)}const l=this._unmodified,{x:p,y:w}=this.point;let C=0,P=p,m=w;const y=this.width/2,_=this.height/2,T=this.worldMinY*this.scale,M=this.worldMaxY*this.scale;if(w-_<T&&(m=T+_),w+_>M&&(m=M-_),M-T<this.height&&(C=Math.max(C,this.height/(M-T)),m=(M+T)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const F=this.worldMinX*this.scale,U=this.worldMaxX*this.scale,K=this.worldSize/2-(F+U)/2;P=(p+K+this.worldSize)%this.worldSize-K,P-y<F&&(P=F+y),P+y>U&&(P=U-y),U-F<this.width&&(C=Math.max(C,this.width/(U-F)),P=(U+F)/2)}P===p&&m===w||(this.center=this.unproject(new c.Point(P,m))),C&&(this.zoom+=this.scaleZoom(C)),this._constrainCamera(),this._unmodified=l,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,l=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=c.mercatorZfromAltitude(1,this.center.lat)/c.mercatorZfromAltitude(1,c.GLOBE_SCALE_MATCH_LATITUDE));const p=I(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,p),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w="meters"===this.projection.zAxisUnit?l:1,C=this._camera.getWorldToCamera(this.worldSize,w),P=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);P[8]=2*-i.x/this.width,P[9]=2*i.y/this.height;let m=c.mul([],P,C);if(this.projection.isReprojectedInTileSpace){const Be=this.locationCoordinate(this.center),Pe=c.identity([]);c.translate(Pe,Pe,[Be.x*this.worldSize,Be.y*this.worldSize,0]),c.multiply(Pe,Pe,x(this)),c.translate(Pe,Pe,[-Be.x*this.worldSize,-Be.y*this.worldSize,0]),c.multiply(m,m,Pe),this.inverseAdjustmentMatrix=function(Ze){const He=x(Ze,!0);return Se([],[He[0],He[1],He[4],He[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=c.scale([],m,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=m,this.invProjMatrix=c.invert(new Float64Array(16),this.projMatrix);const y=c.invert([],P);this.frustumCorners=c.FrustumCorners.fromInvProjectionMatrix(y,this.horizonLineFromTop(),this.height);const _=new Float32Array(16);c.identity(_),c.scale(_,_,[1,-1,1]),c.rotateX(_,_,this._pitch),c.rotateZ(_,_,this.angle);const T=c.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),M=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;T[8]=2*-i.x/this.width,T[9]=2*(i.y+M)/this.height,this.skyboxMatrix=c.multiply(_,T,_);const F=this.point,U=F.x,K=F.y,ee=this.width%2/2,le=this.height%2/2,Z=Math.cos(this.angle),ce=Math.sin(this.angle),_e=U-Math.round(U)+Z*ee+ce*le,we=K-Math.round(K)+Z*le+ce*ee,ke=new Float64Array(m);if(c.translate(ke,ke,[_e>.5?_e-1:_e,we>.5?we-1:we,0]),this.alignedProjMatrix=ke,m=c.create(),c.scale(m,m,[this.width/2,-this.height/2,1]),c.translate(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=c.create(),c.scale(m,m,[1,-1,1]),c.translate(m,m,[-1,-1,0]),c.scale(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m,this.pixelMatrix=c.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},m=c.invert(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=m,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=c.calculateGlobeMatrix(this);const Be=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=c.transformMat4(Be,Be,C),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=m;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,l=this.cameraPixelsPerMeter,p=this._camera.position,w=1/this.height/this._pixelsPerMercatorPixel,C=[i,i,l];c.scale$2(C,C,w),c.scale$2(p,p,-1),c.multiply$2(p,p,C);const P=c.create();c.translate(P,P,p),c.scale(P,P,C),this.mercatorFogMatrix=P,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,l,w)}_computeCameraPosition(i){const l=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),w=this.point,C=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*l-i/this.worldSize*this._centerAltitude;return[w.x/this.worldSize-p[0]*C,w.y/this.worldSize-p[1]*C,i/this.worldSize*this._centerAltitude-p[2]*C]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const l=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],w=i[2];let C=1;this.projection.wrap&&(this.center=this.center.wrap()),w>0&&(C=Math.min((l-p)/w,1)),this._camera.position=c.scaleAndAdd([],this._camera.position,i,C),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,l=this._camera.forward(),{pitch:p,bearing:w}=this._camera.getPitchBearing(),C=c.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,P=this._mercatorZfromZoom(this._maxZoom)*Math.cos(c.degToRad(this._maxPitch)),m=Math.max((i[2]-C)/Math.cos(p),P),y=this._zoomFromMercatorZ(m);c.scaleAndAdd(i,i,l,m),this._pitch=c.clamp(p,c.degToRad(this.minPitch),c.degToRad(this.maxPitch)),this.angle=c.wrap(w,-Math.PI,Math.PI),this._setZoom(c.clamp(y,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new c.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}zoomFromMercatorZAdjusted(i){let l=0,p=c.GLOBE_ZOOM_THRESHOLD_MAX,w=0,C=1/0;for(;p-l>1e-6&&p>l;){const P=l+.5*(p-l),m=this.tileSize*Math.pow(2,P),y=this.getCameraToCenterDistance(this.projection,P,m),_=this.scaleZoom(y/(i*this.tileSize)),T=Math.abs(P-_);T<C&&(C=T,w=P),P<_?l=P:p=P}return w}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(c.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,l){const p=Math.min(i.x,l.x),w=Math.max(i.x,l.x),C=Math.min(i.y,l.y),P=Math.max(i.y,l.y);if(C<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const m=[new c.Point(p,C),new c.Point(w,P),new c.Point(p,P),new c.Point(w,C)],y=this.renderWorldCopies?-3:0,_=this.renderWorldCopies?4:1;for(const T of m){const M=this.pointRayIntersection(T);if(M.t<0)return!0;const F=this.rayIntersectionCoordinate(M);if(F.x<y||F.y<0||F.x>_||F.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+c.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new c.Point(0,0),new c.Point(this.width,this.height))}zoomDeltaToMovement(i,l){const p=c.length(c.sub([],this._camera.position,i)),w=this._zoomFromMercatorZ(p)+l;return p-this._mercatorZfromZoom(w)}getCameraPoint(){if("globe"===this.projection.name){const i=function([l,p,w],C){const P=[l,p,w,1];c.transformMat4$1(P,P,C);const m=P[3]=Math.max(P[3],1e-6);return P[0]/=m,P[1]/=m,P[2]/=m,P}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new c.Point(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new c.Point(0,i))}}getCameraToCenterDistance(i,l=this.zoom,p=this.worldSize){const w=I(i,l,this.width,this.height,1024),C=i.pixelSpaceConversion(this.center.lat,p,w);return.5/Math.tan(.5*this._fov)*this.height*C}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&c.multiply(i,i,this.globeMatrix),i}}function Ln(h,i){let l=!1,p=null;const w=()=>{p=null,l&&(h(),p=setTimeout(w,i),l=!1)};return()=>(l=!0,p||w(),p)}class zn{constructor(i){this._hashName=i&&encodeURIComponent(i),c.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ln(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,c.window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),c.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const l=Gi(i);if(this._hashName){const p=this._hashName;let w=!1;const C=c.window.location.hash.slice(1).split("&").map(P=>{const m=P.split("=")[0];return m===p?(w=!0,`${m}=${l}`):P}).filter(P=>P);return w||C.push(`${p}=${l}`),`#${C.join("&")}`}return`#${l}`}_getCurrentHash(){const i=c.window.location.hash.replace("#","");if(this._hashName){let l;return i.split("&").map(p=>p.split("=")).forEach(p=>{p[0]===this._hashName&&(l=p)}),(l&&l[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const l=this._getCurrentHash();if(l.length>=3&&!l.some(p=>isNaN(p))){const p=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(l[3]||0):i.getBearing();return i.jumpTo({center:[+l[2],+l[1]],zoom:+l[0],bearing:p,pitch:+(l[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=c.window.location.href.replace(/(#.+)?$/,this.getHashString());c.window.history.replaceState(c.window.history.state,null,i)}}function Gi(h,i){const l=h.getCenter(),p=Math.round(100*h.getZoom())/100,w=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),C=Math.pow(10,w),P=Math.round(l.lng*C)/C,m=Math.round(l.lat*C)/C,y=h.getBearing(),_=h.getPitch();let T=i?`/${P}/${m}/${p}`:`${p}/${m}/${P}`;return(y||_)&&(T+="/"+Math.round(10*y)/10),_&&(T+=`/${Math.round(_)}`),T}const Ti={linearity:.3,easing:c.bezier(0,0,.3,1)},Xs=c.extend({deceleration:2500,maxSpeed:1400},Ti),ts=c.extend({deceleration:20,maxSpeed:1400},Ti),Zt=c.extend({deceleration:1e3,maxSpeed:360},Ti),Nr=c.extend({deceleration:1e3,maxSpeed:90},Ti);class qr{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:c.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,l=c.exported.now();for(;i.length>0&&l-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const l={zoom:0,bearing:0,pitch:0,pan:new c.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:C}of this._inertiaBuffer)l.zoom+=C.zoomDelta||0,l.bearing+=C.bearingDelta||0,l.pitch+=C.pitchDelta||0,C.panDelta&&l.pan._add(C.panDelta),C.around&&(l.around=C.around),C.pinchAround&&(l.pinchAround=C.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,w={};if(l.pan.mag()){const C=Ma(l.pan.mag(),p,c.extend({},Xs,i||{}));w.offset=l.pan.mult(C.amount/l.pan.mag()),w.center=this._map.transform.center,oa(w,C)}if(l.zoom){const C=Ma(l.zoom,p,ts);w.zoom=this._map.transform.zoom+C.amount,oa(w,C)}if(l.bearing){const C=Ma(l.bearing,p,Zt);w.bearing=this._map.transform.bearing+c.clamp(C.amount,-179,179),oa(w,C)}if(l.pitch){const C=Ma(l.pitch,p,Nr);w.pitch=this._map.transform.pitch+C.amount,oa(w,C)}if(w.zoom||w.bearing){const C=void 0===l.pinchAround?l.around:l.pinchAround;w.around=C?this._map.unproject(C):this._map.getCenter()}return this.clear(),w.noMoveStart=!0,w}}function oa(h,i){(!h.duration||h.duration<i.duration)&&(h.duration=i.duration,h.easing=i.easing)}function Ma(h,i,l){const{maxSpeed:p,linearity:w,deceleration:C}=l,P=c.clamp(h*w/(i/1e3),-p,p),m=Math.abs(P)/(C*w);return{easing:l.easing,duration:1e3*m,amount:P*(m/2)}}class kr extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,p,w={}){const C=pn(l.getCanvasContainer(),p),P=l.unproject(C);super(i,c.extend({point:C,lngLat:P,originalEvent:p},w)),this._defaultPrevented=!1,this.target=l}}class Ja extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,p){const w="touchend"===i?p.changedTouches:p.touches,C=rn(l.getCanvasContainer(),w),P=C.map(y=>l.unproject(y)),m=C.reduce((y,_,T,M)=>y.add(_.div(M.length)),new c.Point(0,0));super(i,{points:C,point:m,lngLats:P,lngLat:l.unproject(m),originalEvent:p}),this._defaultPrevented=!1}}class Ql extends c.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,l,p){super(i,{originalEvent:p}),this._defaultPrevented=!1}}class pl{constructor(i,l){this._map=i,this._clickTolerance=l.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new Ql(i.type,this._map,i))}mousedown(i,l){return this._mousedownPos=l,this._firePreventable(new kr(i.type,this._map,i))}mouseup(i){this._map.fire(new kr(i.type,this._map,i))}preclick(i){const l=c.extend({},i);l.type="preclick",this._map.fire(new kr(l.type,this._map,l))}click(i,l){this._mousedownPos&&this._mousedownPos.dist(l)>=this._clickTolerance||(this.preclick(i),this._map.fire(new kr(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new kr(i.type,this._map,i))}mouseover(i){this._map.fire(new kr(i.type,this._map,i))}mouseout(i){this._map.fire(new kr(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Ja(i.type,this._map,i))}touchmove(i){this._map.fire(new Ja(i.type,this._map,i))}touchend(i){this._map.fire(new Ja(i.type,this._map,i))}touchcancel(i){this._map.fire(new Ja(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ml{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new kr(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new kr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new kr(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Qa{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=l.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,l){this.isEnabled()&&i.shiftKey&&0===i.button&&(It(),this._startPos=this._lastPos=l,this._active=!0)}mousemoveWindow(i,l){if(!this._active)return;const p=l,w=this._startPos,C=this._lastPos;if(!w||!C||C.equals(p)||!this._box&&p.dist(w)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=Et("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const P=Math.min(w.x,p.x),m=Math.max(w.x,p.x),y=Math.min(w.y,p.y),_=Math.max(w.y,p.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${P}px,${y}px)`,this._box.style.width=m-P+"px",this._box.style.height=_-y+"px")})}mouseupWindow(i,l){if(!this._active)return;const p=this._startPos,w=l;if(p&&0===i.button){if(this.reset(),Nn(),p.x!==w.x||p.y!==w.y)return this._map.fire(new c.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:C=>C.fitScreenCoordinates(p,w,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&27===i.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),bn(),delete this._startPos,delete this._lastPos}_fireEvent(i,l){return this._map.fire(new c.Event(i,{originalEvent:l}))}}function gl(h,i){const l={};for(let p=0;p<h.length;p++)l[h[p].identifier]=i[p];return l}class za{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,l,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=i.timeStamp),p.length===this.numTouches&&(this.centroid=function(w){const C=new c.Point(0,0);for(const P of w)C._add(P);return C.div(w.length)}(l),this.touches=gl(p,l)))}touchmove(i,l,p){if(this.aborted||!this.centroid)return;const w=gl(p,l);for(const C in this.touches){const P=w[C];(!P||P.dist(this.touches[C])>30)&&(this.aborted=!0)}}touchend(i,l,p){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),0===p.length){const w=!this.aborted&&this.centroid;if(this.reset(),w)return w}}}class Eu{constructor(i){this.singleTap=new za(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,l,p){this.singleTap.touchstart(i,l,p)}touchmove(i,l,p){this.singleTap.touchmove(i,l,p)}touchend(i,l,p){const w=this.singleTap.touchend(i,l,p);if(w){const C=i.timeStamp-this.lastTime<500,P=!this.lastTap||this.lastTap.dist(w)<30;if(C&&P||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=w,this.count===this.numTaps)return this.reset(),w}}}class Tu{constructor(){this._zoomIn=new Eu({numTouches:1,numTaps:2}),this._zoomOut=new Eu({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,l,p){this._zoomIn.touchstart(i,l,p),this._zoomOut.touchstart(i,l,p)}touchmove(i,l,p){this._zoomIn.touchmove(i,l,p),this._zoomOut.touchmove(i,l,p)}touchend(i,l,p){const w=this._zoomIn.touchend(i,l,p),C=this._zoomOut.touchend(i,l,p);return w?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:P.getZoom()+1,around:P.unproject(w)},{originalEvent:i})}):C?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:P.getZoom()-1,around:P.unproject(C)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const qc={0:1,2:2};class Il{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,l){return!1}_move(i,l){return{}}mousedown(i,l){if(this._lastPoint)return;const p=an(i);this._correctButton(i,p)&&(this._lastPoint=l,this._eventButton=p)}mousemoveWindow(i,l){const p=this._lastPoint;if(p)if(i.preventDefault(),null!=this._eventButton&&function(w,C){const P=qc[C];return void 0===w.buttons||(w.buttons&P)!==P}(i,this._eventButton))this.reset();else if(this._moved||!(l.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=l,this._move(p,l)}mouseupWindow(i){this._lastPoint&&an(i)===this._eventButton&&(this._moved&&Nn(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ya extends Il{mousedown(i,l){super.mousedown(i,l),this._lastPoint&&(this._active=!0)}_correctButton(i,l){return 0===l&&!i.ctrlKey}_move(i,l){return{around:l,panDelta:l.sub(i)}}}class Pl extends Il{_correctButton(i,l){return 0===l&&i.ctrlKey||2===l}_move(i,l){const p=.8*(l.x-i.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(i){i.preventDefault()}}class kl extends Il{_correctButton(i,l){return 0===l&&i.ctrlKey||2===l}_move(i,l){const p=-.5*(l.y-i.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(i){i.preventDefault()}}class Rl{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=l.clickTolerance||1,this.reset(),c.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new c.Point(0,0)}touchstart(i,l,p){return this._calculateTransform(i,l,p)}touchmove(i,l,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===p.length&&!c.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,l,p)}}touchend(i,l,p){this._calculateTransform(i,l,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,l,p){p.length>0&&(this._active=!0);const w=gl(p,l),C=new c.Point(0,0),P=new c.Point(0,0);let m=0;for(const _ in w){const T=w[_],M=this._touches[_];M&&(C._add(T),P._add(T.sub(M)),m++,w[_]=T)}if(this._touches=w,m<this._minTouches||!P.mag())return;const y=P.div(m);return this._sum._add(y),this._sum.mag()<this._clickTolerance?void 0:{around:C.div(m),panDelta:y}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Et("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class el{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,l,p){return{}}touchstart(i,l,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([l[0],l[1]]))}touchmove(i,l,p){const w=this._firstTwoTouches;if(!w)return;i.preventDefault();const[C,P]=w,m=_l(p,l,C),y=_l(p,l,P);if(!m||!y)return;const _=this._aroundCenter?null:m.add(y).div(2);return this._move([m,y],_,i)}touchend(i,l,p){if(!this._firstTwoTouches)return;const[w,C]=this._firstTwoTouches,P=_l(p,l,w),m=_l(p,l,C);P&&m||(this._active&&Nn(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function _l(h,i,l){for(let p=0;p<h.length;p++)if(h[p].identifier===l)return i[p]}function ec(h,i){return Math.log(h/i)/Math.LN2}class Cu extends el{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,l){const p=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(ec(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:ec(this._distance,p),pinchAround:l}}}function yc(h,i){return 180*h.angleWith(i)/Math.PI}class Ts extends el{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,l){const p=this._vector;if(this._vector=i[0].sub(i[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:yc(this._vector,p),pinchAround:l}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const l=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const w=yc(i,p);return Math.abs(w)<l}}function Ga(h){return Math.abs(h.y)>Math.abs(h.x)}class Ll extends el{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,Ga(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,l,p){const w=this._lastPoints;if(!w)return;const C=i[0].sub(w[0]),P=i[1].sub(w[1]);return this._map._cooperativeGestures&&!c.isFullscreen()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(C,P,p.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(C.y+P.y)/2*-.5})}gestureBeginsVertically(i,l,p){if(void 0!==this._valid)return this._valid;const w=i.mag()>=2,C=l.mag()>=2;if(!w&&!C)return;if(!w||!C)return null==this._firstMove&&(this._firstMove=p),p-this._firstMove<100&&void 0;const P=i.y>0==l.y>0;return Ga(i)&&Ga(l)&&P}}const Du={panStep:100,bearingStep:15,pitchStep:10};class vc{constructor(){const i=Du;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let l=0,p=0,w=0,C=0,P=0;switch(i.keyCode){case 61:case 107:case 171:case 187:l=1;break;case 189:case 109:case 173:l=-1;break;case 37:i.shiftKey?p=-1:(i.preventDefault(),C=-1);break;case 39:i.shiftKey?p=1:(i.preventDefault(),C=1);break;case 38:i.shiftKey?w=1:(i.preventDefault(),P=-1);break;case 40:i.shiftKey?w=-1:(i.preventDefault(),P=1);break;default:return}return this._rotationDisabled&&(p=0,w=0),{cameraAnimation:m=>{const y=m.getZoom();m.easeTo({duration:300,easeId:"keyboardHandler",easing:qa,zoom:l?Math.round(y)+l*(i.shiftKey?2:1):y,bearing:m.getBearing()+p*this._bearingStep,pitch:m.getPitch()+w*this._pitchStep,offset:[-C*this._panStep,-P*this._panStep],center:m.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function qa(h){return h*(2-h)}const Su=4.000244140625;class Au{constructor(i,l){this._map=i,this._el=i.getCanvasContainer(),this._handler=l,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,c.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||c.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let l=i.deltaMode===c.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const p=c.exported.now(),w=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,0!==l&&l%Su==0?this._type="wheel":0!==l&&Math.abs(l)<4?this._type="trackpad":w>400?(this._type=null,this._lastValue=l,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(w*l)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,l+=this._lastValue)),i.shiftKey&&l&&(l/=4),this._type&&(this._lastWheelEvent=i,this._delta-=l,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const l=pn(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:l,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;"wheel"===this._type&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const l=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(0!==this._delta){const y="wheel"===this._type&&Math.abs(this._delta)>Su?this._wheelZoomRate:this._defaultZoomRate;let _=2/(1+Math.exp(-Math.abs(this._delta*y)));this._delta<0&&0!==_&&(_=1/_);const T=l(),M=Math.pow(2,T),F="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):M;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(F*_))),"wheel"===this._type&&(this._startZoom=T,this._easing=this._smoothOutEasing(200)),this._delta=0}const p="number"==typeof this._targetZoom?this._targetZoom:l(),w=this._startZoom,C=this._easing;let P,m=!1;if("wheel"===this._type&&w&&C){const y=Math.min((c.exported.now()-this._lastWheelEventTime)/200,1),_=C(y);P=c.number(w,p,_),y<1?this._frameId||(this._frameId=!0):m=!0}else P=p,m=!0;return this._active=!0,m&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!m,zoomDelta:P-l(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let l=c.ease;if(this._prevEase){const p=this._prevEase,w=(c.exported.now()-p.start)/p.duration,C=p.easing(w+.01)-p.easing(w),P=.27/Math.sqrt(C*C+1e-4)*.01,m=Math.sqrt(.0729-P*P);l=c.bezier(P,m,.25,1)}return this._prevEase={start:c.exported.now(),duration:i,easing:l},l}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Et("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(c.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Wc{constructor(i,l){this._clickZoom=i,this._tapZoom=l}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class so{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,l){return i.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(i.shiftKey?-1:1),around:p.unproject(l)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mu{constructor(){this._tap=new Eu({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,l,p){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=l[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(i,l,p))}touchmove(i,l,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const w=l[0],C=w.y-this._swipePoint.y;return this._swipePoint=w,i.preventDefault(),this._active=!0,{zoomDelta:C/128}}}else this._tap.touchmove(i,l,p)}touchend(i,l,p){this._tapTime?this._swipePoint&&0===p.length&&this.reset():this._tap.touchend(i,l,p)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Rs{constructor(i,l,p){this._el=i,this._mousePan=l,this._touchPan=p}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Zc{constructor(i,l,p){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=l,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Ol{constructor(i,l,p,w){this._el=i,this._touchZoom=l,this._touchRotate=p,this._tapDragZoom=w,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const va=h=>h.zoom||h.drag||h.pitch||h.rotate;class tc extends c.Event{}class sa{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,l){const p=c.sub([],l,i);this.radius=c.length(p[2]<0?c.div([],p,this.constants):[p[0],p[1],0])}projectRay(i){c.div(i,i,this.constants),c.normalize(i,i),c.mul$1(i,i,this.constants);const l=c.scale$2([],i,this.radius);if(l[2]>0){const p=c.scale$2([],[0,0,1],c.dot(l,[0,0,1])),w=c.scale$2([],c.normalize([],[l[0],l[1],0]),this.radius),C=c.add([],l,c.scale$2([],c.sub([],c.add([],w,p),l),2));l[0]=C[0],l[1]=C[1]}return l}}function ns(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}class Ls{constructor(i,l){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new qr(i),this._bearingSnap=l.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new sa,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(l),c.bindAll(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[c.window.document,"mousemove",{capture:!0}],[c.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[c.window,"blur",void 0]];for(const[w,C,P]of this._listeners)w.addEventListener(C,w===c.window.document?this.handleWindowEvent:this.handleEvent,P)}destroy(){for(const[i,l,p]of this._listeners)i.removeEventListener(l,i===c.window.document?this.handleWindowEvent:this.handleEvent,p)}_addDefaultHandlers(i){const l=this._map,p=l.getCanvasContainer();this._add("mapEvent",new pl(l,i));const w=l.boxZoom=new Qa(l,i);this._add("boxZoom",w);const C=new Tu,P=new so;l.doubleClickZoom=new Wc(P,C),this._add("tapZoom",C),this._add("clickZoom",P);const m=new Mu;this._add("tapDragZoom",m);const y=l.touchPitch=new Ll(l);this._add("touchPitch",y);const _=new Pl(i),T=new kl(i);l.dragRotate=new Zc(i,_,T),this._add("mouseRotate",_,["mousePitch"]),this._add("mousePitch",T,["mouseRotate"]);const M=new ya(i),F=new Rl(l,i);l.dragPan=new Rs(p,M,F),this._add("mousePan",M),this._add("touchPan",F,["touchZoom","touchRotate"]);const U=new Ts,K=new Cu;l.touchZoomRotate=new Ol(p,K,U,m),this._add("touchRotate",U,["touchPan","touchZoom"]),this._add("touchZoom",K,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ml(l));const ee=l.scrollZoom=new Au(l,this);this._add("scrollZoom",ee,["mousePan"]);const le=l.keyboard=new vc;this._add("keyboard",le);for(const Z of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[Z]&&l[Z].enable(i[Z])}_add(i,l,p){this._handlers.push({handlerName:i,handler:l,allowed:p}),this._handlersById[i]=l}stop(i){if(!this._updatingCamera){for(const{handler:l}of this._handlers)l.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!va(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,l,p){for(const w in i)if(w!==p&&(!l||l.indexOf(w)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const l=[];for(const p of i)this._el.contains(p.target)&&l.push(p);return l}handleEvent(i,l){this._updatingCamera=!0;const p="renderFrame"===i.type,w=p?void 0:i,C={needsRenderFrame:!1},P={},m={},y=i.touches?this._getMapTouches(i.touches):void 0,_=y?rn(this._el,y):p?void 0:pn(this._el,i);for(const{handlerName:F,handler:U,allowed:K}of this._handlers){if(!U.isEnabled())continue;let ee;this._blockedByActive(m,K,F)?U.reset():U[l||i.type]&&(ee=U[l||i.type](i,_,y),this.mergeHandlerResult(C,P,ee,F,w),ee&&ee.needsRenderFrame&&this._triggerRenderFrame()),(ee||U.isActive())&&(m[F]=U)}const T={};for(const F in this._previousActiveHandlers)m[F]||(T[F]=w);this._previousActiveHandlers=m,(Object.keys(T).length||ns(C))&&(this._changes.push([C,P,T]),this._triggerRenderFrame()),(Object.keys(m).length||ns(C))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:M}=C;M&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],M(this._map))}mergeHandlerResult(i,l,p,w,C){if(!p)return;c.extend(i,p);const P={handlerName:w,originalEvent:p.originalEvent||C};void 0!==p.zoomDelta&&(l.zoom=P),void 0!==p.panDelta&&(l.drag=P),void 0!==p.pitchDelta&&(l.pitch=P),void 0!==p.bearingDelta&&(l.rotate=P)}_applyChanges(){const i={},l={},p={};for(const[w,C,P]of this._changes)w.panDelta&&(i.panDelta=(i.panDelta||new c.Point(0,0))._add(w.panDelta)),w.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+w.zoomDelta),w.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+w.bearingDelta),w.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+w.pitchDelta),void 0!==w.around&&(i.around=w.around),void 0!==w.aroundCoord&&(i.aroundCoord=w.aroundCoord),void 0!==w.pinchAround&&(i.pinchAround=w.pinchAround),w.noInertia&&(i.noInertia=w.noInertia),c.extend(l,C),c.extend(p,P);this._updateMapTransform(i,l,p),this._changes=[]}_updateMapTransform(i,l,p){const w=this._map,C=w.transform,P=ce=>[ce.x,ce.y,ce.z];if((ce=>{const _e=this._eventsInProgress.drag;return _e&&!this._handlersById[_e.handlerName].isActive()})()&&!ns(i)){const ce=C.zoom;C.cameraElevationReference="sea",C.recenterOnTerrain(),C.cameraElevationReference="ground",ce!==C.zoom&&this._map._update(!0)}if(C._isCameraConstrained&&w._stop(!0),!ns(i))return void this._fireEvents(l,p,!0);let{panDelta:m,zoomDelta:y,bearingDelta:_,pitchDelta:T,around:M,aroundCoord:F,pinchAround:U}=i;C._isCameraConstrained&&(y>0&&(y=0),C._isCameraConstrained=!1),void 0!==U&&(M=U),(y||(ce=>l.drag&&!this._eventsInProgress.drag)())&&M&&(this._dragOrigin=P(C.pointCoordinate3D(M)),this._trackingEllipsoid.setup(C._camera.position,this._dragOrigin)),C.cameraElevationReference="sea",w._stop(!0),M=M||w.transform.centerPoint,_&&(C.bearing+=_),T&&(C.pitch+=T),C._updateCameraState();const K=[0,0,0];if(m)if("mercator"===C.projection.name){const ce=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(M).dir),_e=this._trackingEllipsoid.projectRay(C.screenPointToMercatorRay(M.sub(m)).dir);K[0]=_e[0]-ce[0],K[1]=_e[1]-ce[1]}else{const ce=C.pointCoordinate(M);if("globe"===C.projection.name){m=m.rotate(-C.angle);const _e=C._pixelsPerMercatorPixel/C.worldSize;K[0]=-m.x*c.mercatorScale(c.latFromMercatorY(ce.y))*_e,K[1]=-m.y*c.mercatorScale(C.center.lat)*_e}else{const _e=C.pointCoordinate(M.sub(m));ce&&_e&&(K[0]=_e.x-ce.x,K[1]=_e.y-ce.y)}}const ee=C.zoom,le=[0,0,0];if(y){const ce=P(F||C.pointCoordinate3D(M)),_e={dir:c.normalize([],c.sub([],ce,C._camera.position))};if(_e.dir[2]<0){const we=C.zoomDeltaToMovement(ce,y);c.scale$2(le,_e.dir,we)}}const Z=c.add(K,K,le);C._translateCameraConstrained(Z),y&&Math.abs(C.zoom-ee)>1e-4&&C.recenterOnTerrain(),C.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(l,p,!0)}_fireEvents(i,l,p){const w=va(this._eventsInProgress),C=va(i),P={};for(const T in i){const{originalEvent:M}=i[T];this._eventsInProgress[T]||(P[`${T}start`]=M),this._eventsInProgress[T]=i[T]}!w&&C&&this._fireEvent("movestart",C.originalEvent);for(const T in P)this._fireEvent(T,P[T]);C&&this._fireEvent("move",C.originalEvent);for(const T in i){const{originalEvent:M}=i[T];this._fireEvent(T,M)}const m={};let y;for(const T in this._eventsInProgress){const{handlerName:M,originalEvent:F}=this._eventsInProgress[T];this._handlersById[M].isActive()||(delete this._eventsInProgress[T],y=l[M]||F,m[`${T}end`]=y)}for(const T in m)this._fireEvent(T,m[T]);const _=va(this._eventsInProgress);if(p&&(w||C)&&!_){this._updatingCamera=!0;const T=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),M=F=>0!==F&&-this._bearingSnap<F&&F<this._bearingSnap;T?(M(T.bearing||this._map.getBearing())&&(T.bearing=0),this._map.easeTo(T,{originalEvent:y})):(this._map.fire(new c.Event("moveend",{originalEvent:y})),M(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,l){this._map.fire(new c.Event(i,l?{originalEvent:l}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new tc("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const yl="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class nc extends c.Evented{constructor(i,l){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=l.bearingSnap,this._respectPrefersReducedMotion=!1!==l.respectPrefersReducedMotion,c.bindAll(["_renderFrameCallback"],this)}getCenter(){return new c.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,l){return this.jumpTo({center:i},l)}panBy(i,l,p){return i=c.Point.convert(i).mult(-1),this.panTo(this.transform.center,c.extend({offset:i},l),p)}panTo(i,l,p){return this.easeTo(c.extend({center:i},l),p)}getZoom(){return this.transform.zoom}setZoom(i,l){return this.jumpTo({zoom:i},l),this}zoomTo(i,l,p){return this.easeTo(c.extend({zoom:i},l),p)}zoomIn(i,l){return this.zoomTo(this.getZoom()+1,i,l),this}zoomOut(i,l){return this.zoomTo(this.getZoom()-1,i,l),this}getBearing(){return this.transform.bearing}setBearing(i,l){return this.jumpTo({bearing:i},l),this}getPadding(){return this.transform.padding}setPadding(i,l){return this.jumpTo({padding:i},l),this}rotateTo(i,l,p){return this.easeTo(c.extend({bearing:i},l),p)}resetNorth(i,l){return this.rotateTo(0,c.extend({duration:1e3},i),l),this}resetNorthPitch(i,l){return this.easeTo(c.extend({bearing:0,pitch:0,duration:1e3},i),l),this}snapToNorth(i,l){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,l):this}getPitch(){return this.transform.pitch}setPitch(i,l){return this.jumpTo({pitch:i},l),this}cameraForBounds(i,l){i=c.LngLatBounds.convert(i);const p=l&&l.bearing||0,w=l&&l.pitch||0,C=i.getNorthWest(),P=i.getSouthEast();return this._cameraForBounds(this.transform,C,P,p,w,l)}_extendCameraOptions(i){const l={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=c.extend({padding:l,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){const p=i.padding;i.padding={top:p,bottom:p,right:p,left:p}}return i.padding=c.extend(l,i.padding),i}_minimumAABBFrustumDistance(i,l){const p=l.max[0]-l.min[0],w=l.max[1]-l.min[1];return p/w>i.aspect?p/(2*Math.tan(.5*i.fovX)*i.aspect):w/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,l,p,w,C,P){const m=i.clone(),y=this._extendCameraOptions(P);m.bearing=w,m.pitch=C;const _=c.LngLat.convert(l),T=c.LngLat.convert(p),M=.5*(_.lat+T.lat),F=.5*(_.lng+T.lng),U=c.latLngToECEF(M,F),K=c.normalize([],U),ee=c.normalize([],c.cross([],K,[0,1,0])),le=c.cross([],ee,K),Z=[ee[0],ee[1],ee[2],0,le[0],le[1],le[2],0,K[0],K[1],K[2],0,0,0,0,1],ce=[U,c.latLngToECEF(_.lat,_.lng),c.latLngToECEF(T.lat,_.lng),c.latLngToECEF(T.lat,T.lng),c.latLngToECEF(_.lat,T.lng),c.latLngToECEF(M,_.lng),c.latLngToECEF(M,T.lng),c.latLngToECEF(_.lat,F),c.latLngToECEF(T.lat,F)];let _e=c.Aabb.fromPoints(ce.map(Rt=>[c.dot(ee,Rt),c.dot(le,Rt),c.dot(K,Rt)]));const we=c.transformMat4([],_e.center,Z);0===c.squaredLength(we)&&c.set(we,0,0,1),c.normalize(we,we),c.scale$2(we,we,c.GLOBE_RADIUS),m.center=c.ecefToLatLng(we);const ke=m.getWorldToCameraMatrix(),Be=c.invert(new Float64Array(16),ke);_e=c.Aabb.applyTransform(_e,c.multiply([],ke,Z)),c.transformMat4(we,we,ke);const Pe=.5*(_e.max[2]-_e.min[2]),Ze=this._minimumAABBFrustumDistance(m,_e),He=c.scale$2([],[0,0,1],Pe),nt=c.add(He,we,He),Gt=Ze+(0===m.pitch?0:c.distance(we,nt)),Je=m.globeCenterInViewSpace,wt=c.sub([],we,[Je[0],Je[1],Je[2]]);c.normalize(wt,wt),c.scale$2(wt,wt,Gt);const ct=c.add([],we,wt);c.transformMat4(ct,ct,Be);const $t=c.earthRadius/c.GLOBE_RADIUS,it=c.length(ct),vt=c.mercatorZfromAltitude(Math.max(it*$t-c.earthRadius,Number.EPSILON),0),Vt=Math.min(m.zoomFromMercatorZAdjusted(vt),y.maxZoom);return Vt>.5*(c.GLOBE_ZOOM_THRESHOLD_MIN+c.GLOBE_ZOOM_THRESHOLD_MAX)?(m.setProjection({name:"mercator"}),m.zoom=Vt,this._cameraForBounds(m,l,p,w,C,P)):{center:m.center,zoom:Vt,bearing:w,pitch:C}}queryTerrainElevation(i,l){const p=this.transform.elevation;return p?(l=c.extend({},{exaggerated:!0},l),p.getAtPoint(c.MercatorCoordinate.fromLngLat(i),null,l.exaggerated)):null}_cameraForBounds(i,l,p,w,C,P){if("globe"===i.projection.name)return this._cameraForBoundsOnGlobe(i,l,p,w,C,P);const m=i.clone(),y=this._extendCameraOptions(P),_=m.padding;m.bearing=w,m.pitch=C;const T=c.LngLat.convert(l),M=c.LngLat.convert(p),F=new c.LngLat(T.lng,M.lat),U=new c.LngLat(M.lng,T.lat),K=m.project(T),ee=m.project(M),le=this.queryTerrainElevation(T),Z=this.queryTerrainElevation(M),ce=this.queryTerrainElevation(F),_e=this.queryTerrainElevation(U),we=[[K.x,K.y,Math.min(le||0,Z||0,ce||0,_e||0)],[ee.x,ee.y,Math.max(le||0,Z||0,ce||0,_e||0)]];let ke=c.Aabb.fromPoints(we);const Be=m.getWorldToCameraMatrix(),Pe=c.invert(new Float64Array(16),Be);ke=c.Aabb.applyTransform(ke,Be);const Ze=c.sub([],ke.max,ke.min),He=_.left||0,nt=_.right||0,Gt=_.bottom||0,Je=_.top||0,{left:wt,right:ct,top:$t,bottom:it}=y.padding,vt=.5*(He+nt),Vt=.5*(Je+Gt),Rt=Math.min(m.scaleZoom(m.scale*Math.min((m.width-(He+nt+wt+ct))/Ze[0],(m.height-(Gt+Je+it+$t))/Ze[1])),y.maxZoom),Kt=m.scale/m.zoomScale(Rt);ke=new c.Aabb([ke.min[0]-(wt+vt)*Kt,ke.min[1]-(it+Vt)*Kt,ke.min[2]],[ke.max[0]+(ct+vt)*Kt,ke.max[1]+($t+Vt)*Kt,ke.max[2]]);const jn=.5*Ze[2],di=this._minimumAABBFrustumDistance(m,ke),Pn=[0,0,1,0];c.transformMat4$1(Pn,Pn,Be),c.normalize$2(Pn,Pn);const Kn=c.scale$2([],Pn,di+jn),Ui=c.add([],ke.center,Kn),Fi=("number"==typeof y.offset.x&&"number"==typeof y.offset.y?new c.Point(y.offset.x,y.offset.y):c.Point.convert(y.offset)).rotate(-c.degToRad(w));ke.center[0]-=Fi.x*Kt,ke.center[1]+=Fi.y*Kt,c.transformMat4(ke.center,ke.center,Pe),c.transformMat4(Ui,Ui,Pe);const Bn=[ke.center[0],ke.center[1],Ui[2]*m.pixelsPerMeter];c.scale$2(Bn,Bn,1/m.worldSize);const rr=c.lngFromMercatorX(Bn[0]),Er=c.latFromMercatorY(Bn[1]),_r=Math.min(m._zoomFromMercatorZ(Bn[2]),y.maxZoom),Rr=new c.LngLat(rr,Er);return m.mercatorFromTransition&&_r<.5*(c.GLOBE_ZOOM_THRESHOLD_MIN+c.GLOBE_ZOOM_THRESHOLD_MAX)?(m.setProjection({name:"globe"}),m.zoom=_r,this._cameraForBounds(m,l,p,w,C,P)):{center:Rr,zoom:_r,bearing:w,pitch:C}}fitBounds(i,l,p){const w=this.cameraForBounds(i,l);return this._fitInternal(w,l,p)}fitScreenCoordinates(i,l,p,w,C){const P=c.Point.convert(i),m=c.Point.convert(l),y=new c.Point(Math.min(P.x,m.x),Math.min(P.y,m.y)),_=new c.Point(Math.max(P.x,m.x),Math.max(P.y,m.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(P,m))return this;const T=this.transform.pointLocation3D(y),M=this.transform.pointLocation3D(_),F=this.transform.pointLocation3D(new c.Point(y.x,_.y)),U=this.transform.pointLocation3D(new c.Point(_.x,y.y)),K=[Math.min(T.lng,M.lng,F.lng,U.lng),Math.min(T.lat,M.lat,F.lat,U.lat)],ee=[Math.max(T.lng,M.lng,F.lng,U.lng),Math.max(T.lat,M.lat,F.lat,U.lat)],le=w&&w.pitch?w.pitch:this.getPitch(),Z=this._cameraForBounds(this.transform,K,ee,p,le,w);return this._fitInternal(Z,w,C)}_fitInternal(i,l,p){return i?(delete(l=c.extend(i,l)).padding,l.linear?this.easeTo(l,p):this.flyTo(l,p)):this}jumpTo(i,l){this.stop();const p=i.preloadOnly?this.transform.clone():this.transform;let w=!1,C=!1,P=!1;return"zoom"in i&&p.zoom!==+i.zoom&&(w=!0,p.zoom=+i.zoom),void 0!==i.center&&(p.center=c.LngLat.convert(i.center)),"bearing"in i&&p.bearing!==+i.bearing&&(C=!0,p.bearing=+i.bearing),"pitch"in i&&p.pitch!==+i.pitch&&(P=!0,p.pitch=+i.pitch),null==i.padding||p.isPaddingEqual(i.padding)||(p.padding=i.padding),i.preloadOnly?(this._preloadTiles(p),this):(this.fire(new c.Event("movestart",l)).fire(new c.Event("move",l)),w&&this.fire(new c.Event("zoomstart",l)).fire(new c.Event("zoom",l)).fire(new c.Event("zoomend",l)),C&&this.fire(new c.Event("rotatestart",l)).fire(new c.Event("rotate",l)).fire(new c.Event("rotateend",l)),P&&this.fire(new c.Event("pitchstart",l)).fire(new c.Event("pitch",l)).fire(new c.Event("pitchend",l)),this.fire(new c.Event("moveend",l)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||c.warnOnce(yl),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,l){const p=this.transform;if(!p.projection.supportsFreeCamera)return c.warnOnce(yl),this;this.stop();const w=p.zoom,C=p.pitch,P=p.bearing;p.setFreeCameraOptions(i);const m=w!==p.zoom,y=C!==p.pitch,_=P!==p.bearing;return this.fire(new c.Event("movestart",l)).fire(new c.Event("move",l)),m&&this.fire(new c.Event("zoomstart",l)).fire(new c.Event("zoom",l)).fire(new c.Event("zoomend",l)),_&&this.fire(new c.Event("rotatestart",l)).fire(new c.Event("rotate",l)).fire(new c.Event("rotateend",l)),y&&this.fire(new c.Event("pitchstart",l)).fire(new c.Event("pitch",l)).fire(new c.Event("pitchend",l)),this.fire(new c.Event("moveend",l)),this}easeTo(i,l){this._stop(!1,i.easeId),(!1===(i=c.extend({offset:[0,0],duration:500,easing:c.ease},i)).animate||this._prefersReducedMotion(i))&&(i.duration=0);const p=this.transform,w=this.getZoom(),C=this.getBearing(),P=this.getPitch(),m=this.getPadding(),y="zoom"in i?+i.zoom:w,_="bearing"in i?this._normalizeBearing(i.bearing,C):C,T="pitch"in i?+i.pitch:P,M="padding"in i?i.padding:p.padding,F=c.Point.convert(i.offset);let U,K,ee;if("globe"===p.projection.name){const He=c.MercatorCoordinate.fromLngLat(p.center),nt=F.rotate(-p.angle);He.x+=nt.x/p.worldSize,He.y+=nt.y/p.worldSize;const Gt=He.toLngLat(),Je=c.LngLat.convert(i.center||Gt);this._normalizeCenter(Je),U=p.centerPoint.add(nt),K=new c.Point(He.x,He.y).mult(p.worldSize),ee=new c.Point(c.mercatorXfromLng(Je.lng),c.mercatorYfromLat(Je.lat)).mult(p.worldSize).sub(K)}else{U=p.centerPoint.add(F);const He=p.pointLocation(U),nt=c.LngLat.convert(i.center||He);this._normalizeCenter(nt),K=p.project(He),ee=p.project(nt).sub(K)}const le=p.zoomScale(y-w);let Z,ce;i.around&&(Z=c.LngLat.convert(i.around),ce=p.locationPoint(Z));const _e=this._zooming||y!==w,we=this._rotating||C!==_,ke=this._pitching||T!==P,Be=!p.isPaddingEqual(M),Pe=He=>nt=>{if(_e&&(He.zoom=c.number(w,y,nt)),we&&(He.bearing=c.number(C,_,nt)),ke&&(He.pitch=c.number(P,T,nt)),Be&&(He.interpolatePadding(m,M,nt),U=He.centerPoint.add(F)),Z)He.setLocationAtPoint(Z,ce);else{const Gt=He.zoomScale(He.zoom-w),Je=y>w?Math.min(2,le):Math.max(.5,le),wt=Math.pow(Je,1-nt),ct=He.unproject(K.add(ee.mult(nt*wt)).mult(Gt));He.setLocationAtPoint(He.renderWorldCopies?ct.wrap():ct,U)}return i.preloadOnly||this._fireMoveEvents(l),He};if(i.preloadOnly){const He=this._emulate(Pe,i.duration,p);return this._preloadTiles(He),this}const Ze={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=_e,this._rotating=we,this._pitching=ke,this._padding=Be,this._easeId=i.easeId,this._prepareEase(l,i.noMoveStart,Ze),this._ease(Pe(p),He=>{p.recenterOnTerrain(),this._afterEase(l,He)},i),this}_prepareEase(i,l,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",l||p.moving||this.fire(new c.Event("movestart",i)),this._zooming&&!p.zooming&&this.fire(new c.Event("zoomstart",i)),this._rotating&&!p.rotating&&this.fire(new c.Event("rotatestart",i)),this._pitching&&!p.pitching&&this.fire(new c.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new c.Event("move",i)),this._zooming&&this.fire(new c.Event("zoom",i)),this._rotating&&this.fire(new c.Event("rotate",i)),this._pitching&&this.fire(new c.Event("pitch",i))}_afterEase(i,l){if(this._easeId&&l&&this._easeId===l)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,w=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new c.Event("zoomend",i)),w&&this.fire(new c.Event("rotateend",i)),C&&this.fire(new c.Event("pitchend",i)),this.fire(new c.Event("moveend",i))}flyTo(i,l){if(this._prefersReducedMotion(i)){const Rt=c.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Rt,l)}this.stop(),i=c.extend({offset:[0,0],speed:1.2,curve:1.42,easing:c.ease},i);const p=this.transform,w=this.getZoom(),C=this.getBearing(),P=this.getPitch(),m=this.getPadding(),y="zoom"in i?c.clamp(+i.zoom,p.minZoom,p.maxZoom):w,_="bearing"in i?this._normalizeBearing(i.bearing,C):C,T="pitch"in i?+i.pitch:P,M="padding"in i?i.padding:p.padding,F=p.zoomScale(y-w),U=c.Point.convert(i.offset);let K=p.centerPoint.add(U);const ee=p.pointLocation(K),le=c.LngLat.convert(i.center||ee);this._normalizeCenter(le);const Z=p.project(ee),ce=p.project(le).sub(Z);let _e=i.curve;const we=Math.max(p.width,p.height),ke=we/F,Be=ce.mag();if("minZoom"in i){const Rt=c.clamp(Math.min(i.minZoom,w,y),p.minZoom,p.maxZoom),Kt=we/p.zoomScale(Rt-w);_e=Math.sqrt(Kt/Be*2)}const Pe=_e*_e;function Ze(Rt){const Kt=(ke*ke-we*we+(Rt?-1:1)*Pe*Pe*Be*Be)/(2*(Rt?ke:we)*Pe*Be);return Math.log(Math.sqrt(Kt*Kt+1)-Kt)}function He(Rt){return(Math.exp(Rt)-Math.exp(-Rt))/2}function nt(Rt){return(Math.exp(Rt)+Math.exp(-Rt))/2}const Gt=Ze(0);let Je=function(Rt){return nt(Gt)/nt(Gt+_e*Rt)},wt=function(Rt){return we*((nt(Gt)*(He(Kt=Gt+_e*Rt)/nt(Kt))-He(Gt))/Pe)/Be;var Kt},ct=(Ze(1)-Gt)/_e;if(Math.abs(Be)<1e-6||!isFinite(ct)){if(Math.abs(we-ke)<1e-6)return this.easeTo(i,l);const Rt=ke<we?-1:1;ct=Math.abs(Math.log(ke/we))/_e,wt=function(){return 0},Je=function(Kt){return Math.exp(Rt*_e*Kt)}}i.duration="duration"in i?+i.duration:1e3*ct/("screenSpeed"in i?+i.screenSpeed/_e:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const $t=C!==_,it=T!==P,vt=!p.isPaddingEqual(M),Vt=Rt=>Kt=>{const jn=Kt*ct,di=1/Je(jn);Rt.zoom=1===Kt?y:w+Rt.scaleZoom(di),$t&&(Rt.bearing=c.number(C,_,Kt)),it&&(Rt.pitch=c.number(P,T,Kt)),vt&&(Rt.interpolatePadding(m,M,Kt),K=Rt.centerPoint.add(U));const Pn=1===Kt?le:Rt.unproject(Z.add(ce.mult(wt(jn))).mult(di));return Rt.setLocationAtPoint(Rt.renderWorldCopies?Pn.wrap():Pn,K),Rt._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(l),Rt};if(i.preloadOnly){const Rt=this._emulate(Vt,i.duration,p);return this._preloadTiles(Rt),this}return this._zooming=!0,this._rotating=$t,this._pitching=it,this._padding=vt,this._prepareEase(l,!1),this._ease(Vt(p),()=>this._afterEase(l),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,l){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,l)}if(!i){const p=this.handlers;p&&p.stop(!1)}return this}_ease(i,l,p){!1===p.animate||0===p.duration?(i(1),l()):(this._easeStart=c.exported.now(),this._easeOptions=p,this._onEaseFrame=i,this._onEaseEnd=l,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((c.exported.now()-this._easeStart)/this._easeOptions.duration,1),l=this._onEaseFrame;l&&l(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,l){i=c.wrap(i,-180,180);const p=Math.abs(i-l);return Math.abs(i-360-l)<p&&(i-=360),Math.abs(i+360-l)<p&&(i+=360),i}_normalizeCenter(i){const l=this.transform;if(!l.renderWorldCopies||l.maxBounds)return;const p=i.lng-l.center.lng;i.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&c.exported.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,l,p){const w=Math.ceil(15*l/1e3),C=[],P=i(p.clone());for(let m=0;m<=w;m++){const y=P(m/w);C.push(y.clone())}return C}}class wn{constructor(i={}){this.options=i,c.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const l=this.options&&this.options.compact;return this._map=i,this._container=Et("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Et("button","mapboxgl-ctrl-attrib-button",this._container),Et("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Et("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),l&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===l&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,l){const p=this._map._getUIString(`AttributionControl.${l}`);i.setAttribute("aria-label",p),i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",p)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const l=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||c.config.ACCESS_TOKEN}];if(i){const p=l.reduce((w,C,P)=>(C.value&&(w+=`${C.key}=${C.value}${P<l.length-1?"&":""}`),w),"?");i.href=`${c.config.FEEDBACK_URL}/${p}#${Gi(this._map,!0)}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||"metadata"!==i.sourceDataType&&"visibility"!==i.sourceDataType&&"style"!==i.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const w=this._map.style.stylesheet;this.styleOwner=w.owner,this.styleId=w.id}const l=this._map.style._sourceCaches;for(const w in l){const C=l[w];if(C.used){const P=C.getSource();P.attribution&&i.indexOf(P.attribution)<0&&i.push(P.attribution)}}i.sort((w,C)=>w.length-C.length),i=i.filter((w,C)=>{for(let P=C+1;P<i.length;P++)if(i[P].indexOf(w)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const p=i.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,i.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Xc{constructor(){c.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=Et("div","mapboxgl-ctrl");const l=Et("a","mapboxgl-ctrl-logo");return l.target="_blank",l.rel="noopener nofollow",l.href="https://www.mapbox.com/",l.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),l.setAttribute("rel","noopener nofollow"),this._container.appendChild(l),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&"metadata"!==i.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(0===Object.entries(i).length)return!0;for(const l in i){const p=i[l].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const l=i[0];this._map.getCanvasContainer().offsetWidth<250?l.classList.add("mapboxgl-compact"):l.classList.remove("mapboxgl-compact")}}}class ic{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const l=++this._id;return this._queue.push({callback:i,id:l,cancelled:!1}),l}remove(i){const l=this._currentlyRunning,p=l?this._queue.concat(l):this._queue;for(const w of p)if(w.id===i)return void(w.cancelled=!0)}run(i=0){const l=this._currentlyRunning=this._queue;this._queue=[];for(const p of l)if(!p.cancelled&&(p.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function ar(h,i,l){if(h=new c.LngLat(h.lng,h.lat),i){const p=new c.LngLat(h.lng-360,h.lat),w=new c.LngLat(h.lng+360,h.lat),C=360*Math.ceil(Math.abs(h.lng-l.center.lng)/360),P=l.locationPoint(h).distSqr(i),m=i.x<0||i.y<0||i.x>l.width||i.y>l.height;l.locationPoint(p).distSqr(i)<P&&(m||Math.abs(p.lng-l.center.lng)<C)?h=p:l.locationPoint(w).distSqr(i)<P&&(m||Math.abs(w.lng-l.center.lng)<C)&&(h=w)}for(;Math.abs(h.lng-l.center.lng)>180;){const p=l.locationPoint(h);if(p.x>=0&&p.y>=0&&p.x<=l.width&&p.y<=l.height)break;h.lng>l.center.lng?h.lng-=360:h.lng+=360}return h}const Fl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class vn extends c.Evented{constructor(i,l){if(super(),(i instanceof c.window.HTMLElement||l)&&(i=c.extend({element:i},l)),c.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=i&&i.occludedOpacity||.2,i&&i.element)this._element=i.element,this._offset=c.Point.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=Et("div");const w=41,C=27,P=At("svg",{display:"block",height:w*this._scale+"px",width:C*this._scale+"px",viewBox:`0 0 ${C} ${w}`},this._element),m=At("radialGradient",{id:"shadowGradient"},At("defs",{},P));At("stop",{offset:"10%","stop-opacity":.4},m),At("stop",{offset:"100%","stop-opacity":.05},m),At("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},P),At("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},P),At("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},P),At("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},P),this._offset=c.Point.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",w=>{w.preventDefault()}),this._element.addEventListener("mousedown",w=>{w.preventDefault()});const p=this._element.classList;for(const w in Fl)p.remove(`mapboxgl-marker-anchor-${w}`);p.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=c.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const w=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[w,-1*(24.6+w)],"bottom-right":[-w,-1*(24.6+w)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const l=i.code,p=i.charCode||i.keyCode;"Space"!==l&&"Enter"!==l&&32!==p&&13!==p||this.togglePopup()}_onMapClick(i){const l=i.originalEvent.target,p=this._element;this._popup&&(l===p||p.contains(l))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,l=this._pos;if(!i||!l)return!1;const p=i.unproject(l),w=i.getFreeCameraOptions();if(!w.position)return!1;const C=w.position.toLngLat();return C.distanceTo(p)<.9*C.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const l=this._pos;if(!l||l.x<0||l.x>i.transform.width||l.y<0||l.y>i.transform.height)return void this._clearFadeTimer();const p=i.unproject(l);let w;i._showingGlobe()&&c.isLngLatBehindGlobe(i.transform,this._lngLat)?w=0:(w=1-i._queryFogOpacity(p),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(w*=this._occludedOpacity)),this._element.style.opacity=`${w}`,this._element.style.pointerEvents=w>0?"auto":"none",this._popup&&this._popup._setOpacity(w),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const l=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${i.x}px,${i.y}px)\n            ${Fl[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${l.x}px,${l.y}px)\n        `}_calculateXYTransform(){const i=this._pos,l=this._map,p=this.getPitchAlignment();if(!l||!i||"map"!==p)return"";if(!l._showingGlobe()){const y=l.getPitch();return y?`rotateX(${y}deg)`:""}const w=c.radToDeg(c.globeTiltAtLngLat(l.transform,this._lngLat)),C=i.sub(c.globeCenterToScreenPoint(l.transform)),P=Math.abs(C.x)+Math.abs(C.y);if(0===P)return"";const m=w/P;return`rotateX(${-C.y*m}deg) rotateY(${C.x*m}deg)`}_calculateZTransform(){const i=this._pos,l=this._map;if(!l||!i)return"";let p=0;const w=this.getRotationAlignment();if("map"===w)if(l._showingGlobe()){const C=l.project(new c.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),P=l.project(new c.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(C);p=c.radToDeg(Math.atan2(P.y,P.x))-90}else p=-l.getBearing();else if("horizon"===w){const C=c.smoothstep(4,6,l.getZoom()),P=c.globeCenterToScreenPoint(l.transform);P.y+=C*l.transform.height;const m=i.sub(P),y=c.radToDeg(Math.atan2(m.y,m.x));p=(y>90?y-270:y+90)*(1-C)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(i){c.window.cancelAnimationFrame(this._updateFrameId);const l=this._map;l&&(l.transform.renderWorldCopies&&(this._lngLat=ar(this._lngLat,this._pos,l.transform)),this._pos=l.project(this._lngLat),!0===i?this._updateFrameId=c.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),l._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(l._showingGlobe()||l.getTerrain()||l.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=c.Point.convert(i),this._update(),this}_onMove(i){const l=this._map;if(!l)return;const p=this._pointerdownPos,w=this._positionDelta;if(p&&w){if(!this._isDragging){const C=this._clickTolerance||l._clickTolerance;if(i.point.dist(p)<C)return;this._isDragging=!0}this._pos=i.point.sub(w),this._lngLat=l.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new c.Event("dragstart"))),this.fire(new c.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new c.Event("dragend")),this._state="inactive"}_addDragHandler(i){const l=this._map,p=this._pos;l&&p&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(p),this._pointerdownPos=i.point,this._state="pending",l.on("mousemove",this._onMove),l.on("touchmove",this._onMove),l.once("mouseup",this._onUp),l.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const l=this._map;return l&&(i?(l.on("mousedown",this._addDragHandler),l.on("touchstart",this._addDragHandler)):(l.off("mousedown",this._addDragHandler),l.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Kc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ad=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function ld(h=new c.Point(0,0),i="bottom"){if("number"==typeof h){const l=Math.round(Math.sqrt(.5*Math.pow(h,2)));switch(i){case"top":return new c.Point(0,h);case"top-left":return new c.Point(l,l);case"top-right":return new c.Point(-l,l);case"bottom":return new c.Point(0,-h);case"bottom-left":return new c.Point(l,-l);case"bottom-right":return new c.Point(-l,-l);case"left":return new c.Point(h,0);case"right":return new c.Point(-h,0)}return new c.Point(0,0)}return h instanceof c.Point||Array.isArray(h)?c.Point.convert(h):c.Point.convert(h[i]||[0,0])}class fh{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const l=c.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-l)+this._end*l}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,l,p){this._start=this.getValue(l),this._end=i,this._startTime=l,this._endTime=l+p}}const cd={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Na={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0},Tf={showCompass:!0,showZoom:!0,visualizePitch:!1};class ph{constructor(i,l,p=!1){this._clickTolerance=10,this.element=l,this.mouseRotate=new Pl({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,p&&(this.mousePitch=new kl({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),c.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),l.addEventListener("mousedown",this.mousedown),l.addEventListener("touchstart",this.touchstart,{passive:!1}),l.addEventListener("touchmove",this.touchmove),l.addEventListener("touchend",this.touchend),l.addEventListener("touchcancel",this.reset)}down(i,l){this.mouseRotate.mousedown(i,l),this.mousePitch&&this.mousePitch.mousedown(i,l),It()}move(i,l){const p=this.map,w=this.mouseRotate.mousemoveWindow(i,l),C=w&&w.bearingDelta;if(C&&p.setBearing(p.getBearing()+C),this.mousePitch){const P=this.mousePitch.mousemoveWindow(i,l),m=P&&P.pitchDelta;m&&p.setPitch(p.getPitch()+m)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){bn(),c.window.removeEventListener("mousemove",this.mousemove),c.window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(c.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),pn(this.element,i)),c.window.addEventListener("mousemove",this.mousemove),c.window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,pn(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){1!==i.targetTouches.length?this.reset():(this._startPos=this._lastPos=rn(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){1!==i.targetTouches.length?this.reset():(this._lastPos=rn(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){0===i.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const wo={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},rc={maxWidth:100,unit:"metric"},vl={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Bl={version:c.version,supported:nn,setRTLTextPlugin:c.setRTLTextPlugin,getRTLTextPluginStatus:c.getRTLTextPluginStatus,Map:class extends nc{constructor(h){if(c.LivePerformanceUtils.mark(c.PerformanceMarkers.create),null!=(h=c.extend({},Na,h)).minZoom&&null!=h.maxZoom&&h.minZoom>h.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=h.minPitch&&null!=h.maxPitch&&h.minPitch>h.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=h.minPitch&&h.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=h.maxPitch&&h.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(h.antialias&&c.isSafariWithAntialiasingBug(c.window)&&(h.antialias=!1,c.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new en(h.minZoom,h.maxZoom,h.minPitch,h.maxPitch,h.renderWorldCopies),h),this._interactive=h.interactive,this._minTileCacheSize=h.minTileCacheSize,this._maxTileCacheSize=h.maxTileCacheSize,this._failIfMajorPerformanceCaveat=h.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=h.preserveDrawingBuffer,this._antialias=h.antialias,this._useWebGL2=h.useWebGL2,this._trackResize=h.trackResize,this._bearingSnap=h.bearingSnap,this._refreshExpiredTiles=h.refreshExpiredTiles,this._fadeDuration=h.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=h.crossSourceCollisions,this._collectResourceTiming=h.collectResourceTiming,this._optimizeForTerrain=h.optimizeForTerrain,this._language=this._parseLanguage(h.language),this._worldview=h.worldview,this._renderTaskQueue=new ic,this._domRenderTaskQueue=new ic,this._controls=[],this._markers=[],this._popups=[],this._mapId=c.uniqueId(),this._locale=c.extend({},cd,h.locale),this._clickTolerance=h.clickTolerance,this._cooperativeGestures=h.cooperativeGestures,this._performanceMetricsCollection=h.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new fh(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new c.RequestManager(h.transformRequest,h.accessToken,h.testMode),this._silenceAuthErrors=!!h.testMode,"string"==typeof h.container){if(this._container=c.window.document.getElementById(h.container),!this._container)throw new Error(`Container '${h.container}' not found.`)}else{if(!(h.container instanceof c.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=h.container}if(this._container.childNodes.length>0&&c.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),h.maxBounds&&this.setMaxBounds(h.maxBounds),c.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==c.window&&(c.window.addEventListener("online",this._onWindowOnline,!1),c.window.addEventListener("resize",this._onWindowResize,!1),c.window.addEventListener("orientationchange",this._onWindowResize,!1),c.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),c.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new Ls(this,h),this._localFontFamily=h.localFontFamily,this._localIdeographFontFamily=h.localIdeographFontFamily,h.style&&this.setStyle(h.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),h.projection&&this.setProjection(h.projection),this._hash=h.hash&&new zn("string"==typeof h.hash&&h.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:h.center,zoom:h.zoom,bearing:h.bearing,pitch:h.pitch}),h.bounds&&(this.resize(),this.fitBounds(h.bounds,c.extend({},h.fitBoundsOptions,{duration:0})))),this.resize(),h.attributionControl&&this.addControl(new wn({customAttribution:h.customAttribution})),this._logoControl=new Xc,this.addControl(this._logoControl,h.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update("style"===i.dataType),this.fire(new c.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new c.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(h,i){if(void 0===i&&(i=h.getDefaultPosition?h.getDefaultPosition():"top-right"),!h||!h.onAdd)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const l=h.onAdd(this);this._controls.push(h);const p=this._controlPositions[i];return-1!==i.indexOf("bottom")?p.insertBefore(l,p.firstChild):p.appendChild(l),this}removeControl(h){if(!h||!h.onRemove)return this.fire(new c.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(h);return i>-1&&this._controls.splice(i,1),h.onRemove(this),this}hasControl(h){return this._controls.indexOf(h)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(h){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new c.Event("movestart",h)).fire(new c.Event("move",h)),this.fire(new c.Event("resize",h)),i&&this.fire(new c.Event("moveend",h)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(h){return this.transform.setMaxBounds(c.LngLatBounds.convert(h)),this._update()}setMinZoom(h){if((h=h??-2)>=-2&&h<=this.transform.maxZoom)return this.transform.minZoom=h,this._update(),this.getZoom()<h?this.setZoom(h):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(h){if((h=h??22)>=this.transform.minZoom)return this.transform.maxZoom=h,this._update(),this.getZoom()>h?this.setZoom(h):this.fire(new c.Event("zoomstart")).fire(new c.Event("zoom")).fire(new c.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(h){if((h=h??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(h>=0&&h<=this.transform.maxPitch)return this.transform.minPitch=h,this._update(),this.getPitch()<h?this.setPitch(h):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(h){if((h=h??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(h>=this.transform.minPitch)return this.transform.maxPitch=h,this._update(),this.getPitch()>h?this.setPitch(h):this.fire(new c.Event("pitchstart")).fire(new c.Event("pitch")).fire(new c.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(h){return this.transform.renderWorldCopies=h,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(h){return"auto"===h?c.window.navigator.language:Array.isArray(h)?0===h.length?void 0:h.map(i=>"auto"===i?c.window.navigator.language:i):h}setLanguage(h){const i=this._parseLanguage(h);if(!this.style||i===this._language)return this;this._language=i,this.style._reloadSources();for(const l of this._controls)l._setLanguage&&l._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(h){return this.style&&h!==this._worldview?(this._worldview=h,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(h){return this._lazyInitEmptyStyle(),h?"string"==typeof h&&(h={name:h}):h=null,this._useExplicitProjection=!!h,this._prioritizeAndUpdateProjection(h,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const h=this.transform,i=h.projection.name;let l;"globe"===i&&h.zoom>=c.GLOBE_ZOOM_THRESHOLD_MAX?(h.setMercatorFromTransition(),l=!0):"mercator"===i&&h.zoom<c.GLOBE_ZOOM_THRESHOLD_MAX&&(h.setProjection({name:"globe"}),l=!0),l&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(h,i){return this._updateProjection(h||i||{name:"mercator"})}_updateProjection(h){let i;if(i="globe"===h.name&&this.transform.zoom>=c.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(h),this.style.applyProjectionUpdate(),i){this.painter.clearBackgroundTiles();for(const l in this.style._sourceCaches)this.style._sourceCaches[l].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(h){return this.transform.locationPoint3D(c.LngLat.convert(h))}unproject(h){return this.transform.pointLocation3D(c.Point.convert(h))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(h,i,l){if("mouseenter"===h||"mouseover"===h){let p=!1;const w=P=>{const m=i.filter(_=>this.getLayer(_)),y=m.length?this.queryRenderedFeatures(P.point,{layers:m}):[];y.length?p||(p=!0,l.call(this,new kr(h,this,P.originalEvent,{features:y}))):p=!1},C=()=>{p=!1};return{layers:new Set(i),listener:l,delegates:{mousemove:w,mouseout:C}}}if("mouseleave"===h||"mouseout"===h){let p=!1;const w=P=>{const m=i.filter(y=>this.getLayer(y));(m.length?this.queryRenderedFeatures(P.point,{layers:m}):[]).length?p=!0:p&&(p=!1,l.call(this,new kr(h,this,P.originalEvent)))},C=P=>{p&&(p=!1,l.call(this,new kr(h,this,P.originalEvent)))};return{layers:new Set(i),listener:l,delegates:{mousemove:w,mouseout:C}}}{const p=w=>{const C=i.filter(m=>this.getLayer(m)),P=C.length?this.queryRenderedFeatures(w.point,{layers:C}):[];P.length&&(w.features=P,l.call(this,w),delete w.features)};return{layers:new Set(i),listener:l,delegates:{[h]:p}}}}on(h,i,l){if(void 0===l)return super.on(h,i);Array.isArray(i)||(i=[i]);const p=this._createDelegatedListener(h,i,l);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[h]=this._delegatedListeners[h]||[],this._delegatedListeners[h].push(p);for(const w in p.delegates)this.on(w,p.delegates[w]);return this}once(h,i,l){if(void 0===l)return super.once(h,i);Array.isArray(i)||(i=[i]);const p=this._createDelegatedListener(h,i,l);for(const w in p.delegates)this.once(w,p.delegates[w]);return this}off(h,i,l){if(void 0===l)return super.off(h,i);i=new Set(Array.isArray(i)?i:[i]);const p=(C,P)=>{if(C.size!==P.size)return!1;for(const m of C)if(!P.has(m))return!1;return!0},w=this._delegatedListeners?this._delegatedListeners[h]:void 0;return w&&(C=>{for(let P=0;P<C.length;P++){const m=C[P];if(m.listener===l&&p(m.layers,i)){for(const y in m.delegates)this.off(y,m.delegates[y]);return C.splice(P,1),this}}})(w),this}queryRenderedFeatures(h,i){return this.style?(void 0!==i||void 0===h||h instanceof c.Point||Array.isArray(h)||(i=h,h=void 0),this.style.queryRenderedFeatures(h=h||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(h,i){return this.style.querySourceFeatures(h,i)}isPointOnSurface(h){const{name:i}=this.transform.projection;return"globe"!==i&&"mercator"!==i&&c.warnOnce(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(c.Point.convert(h))}setStyle(h,i){return!1!==(i=c.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&h?(this._diffStyle(h,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(h,i))}_getUIString(h){const i=this._locale[h];if(null==i)throw new Error(`Missing UI string '${h}'`);return i}_updateStyle(h,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),h&&(this.style=new ro(this,i||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof h?this.style.loadURL(h):this.style.loadJSON(h)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ro(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(h,i){if("string"==typeof h){const l=this._requestManager.normalizeStyleURL(h),p=this._requestManager.transformRequest(l,c.ResourceType.Style);c.getJSON(p,(w,C)=>{w?this.fire(new c.ErrorEvent(w)):C&&this._updateDiff(C,i)})}else"object"==typeof h&&this._updateDiff(h,i)}_updateDiff(h,i){try{this.style.setState(h)&&this._update(!0)}catch(l){c.warnOnce(`Unable to perform style diff: ${l.message||l.error||l}.  Rebuilding the style from scratch.`),this._updateStyle(h,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(c.warnOnce("There is no style added to the map."),!1)}addSource(h,i){return this._lazyInitEmptyStyle(),this.style.addSource(h,i),this._update(!0)}isSourceLoaded(h){return!!this.style&&this.style._isSourceCacheLoaded(h)}areTilesLoaded(){const h=this.style&&this.style._sourceCaches;for(const i in h){const l=h[i]._tiles;for(const p in l){const w=l[p];if("loaded"!==w.state&&"errored"!==w.state)return!1}}return!0}addSourceType(h,i,l){this._lazyInitEmptyStyle(),this.style.addSourceType(h,i,l)}removeSource(h){return this.style.removeSource(h),this._updateTerrain(),this._update(!0)}getSource(h){return this.style.getSource(h)}addImage(h,i,{pixelRatio:l=1,sdf:p=!1,stretchX:w,stretchY:C,content:P}={}){if(this._lazyInitEmptyStyle(),i instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&i instanceof c.window.ImageBitmap){const{width:m,height:y,data:_}=c.exported.getImageData(i);this.style.addImage(h,{data:new c.RGBAImage({width:m,height:y},_),pixelRatio:l,stretchX:w,stretchY:C,content:P,sdf:p,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:m,height:y}=i,_=i;this.style.addImage(h,{data:new c.RGBAImage({width:m,height:y},new Uint8Array(_.data)),pixelRatio:l,stretchX:w,stretchY:C,content:P,sdf:p,version:0,userImage:_}),_.onAdd&&_.onAdd(this,h)}}updateImage(h,i){const l=this.style.getImage(h);if(!l)return void this.fire(new c.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const p=i instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&i instanceof c.window.ImageBitmap?c.exported.getImageData(i):i,{width:w,height:C}=p;void 0!==w&&void 0!==C?w===l.data.width&&C===l.data.height?(l.data.replace(p.data,!(i instanceof c.window.HTMLImageElement||c.window.ImageBitmap&&i instanceof c.window.ImageBitmap)),this.style.updateImage(h,l)):this.fire(new c.ErrorEvent(new Error(`The width and height of the updated image (${w}, ${C})\n                must be that same as the previous version of the image\n                (${l.data.width}, ${l.data.height})`))):this.fire(new c.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(h){return h?!!this.style.getImage(h):(this.fire(new c.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(h){this.style.removeImage(h)}loadImage(h,i){c.getImage(this._requestManager.transformRequest(h,c.ResourceType.Image),(l,p)=>{i(l,p instanceof c.window.HTMLImageElement?c.exported.getImageData(p):p)})}listImages(){return this.style.listImages()}addLayer(h,i){return this._lazyInitEmptyStyle(),this.style.addLayer(h,i),this._update(!0)}moveLayer(h,i){return this.style.moveLayer(h,i),this._update(!0)}removeLayer(h){return this.style.removeLayer(h),this._update(!0)}getLayer(h){return this.style.getLayer(h)}setLayerZoomRange(h,i,l){return this.style.setLayerZoomRange(h,i,l),this._update(!0)}setFilter(h,i,l={}){return this.style.setFilter(h,i,l),this._update(!0)}getFilter(h){return this.style.getFilter(h)}setPaintProperty(h,i,l,p={}){return this.style.setPaintProperty(h,i,l,p),this._update(!0)}getPaintProperty(h,i){return this.style.getPaintProperty(h,i)}setLayoutProperty(h,i,l,p={}){return this.style.setLayoutProperty(h,i,l,p),this._update(!0)}getLayoutProperty(h,i){return this.style.getLayoutProperty(h,i)}setLight(h,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(h,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(h){return this._lazyInitEmptyStyle(),!h&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(h),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(h){return this._lazyInitEmptyStyle(),this.style.setFog(h),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(h){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(c.LngLat.convert(h),this.transform):0}setFeatureState(h,i){return this.style.setFeatureState(h,i),this._update()}removeFeatureState(h,i){return this.style.removeFeatureState(h,i),this._update()}getFeatureState(h){return this.style.getFeatureState(h)}_updateContainerDimensions(){if(!this._container)return;const h=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let l,p,w,C=this._container;for(;C&&(!p||!w);){const P=c.window.getComputedStyle(C).transform;P&&"none"!==P&&(l=P.match(/matrix.*\((.+)\)/)[1].split(", "),l[0]&&"0"!==l[0]&&"1"!==l[0]&&(p=l[0]),l[3]&&"0"!==l[3]&&"1"!==l[3]&&(w=l[3])),C=C.parentElement}this._containerWidth=p?Math.abs(h/p):h,this._containerHeight=w?Math.abs(i/w):i}_detectMissingCSS(){"rgb(250, 128, 114)"!==c.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&c.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const h=this._container;h.classList.add("mapboxgl-map"),(this._missingCSSCanary=Et("div","mapboxgl-canary",h)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=Et("div","mapboxgl-canvas-container",h);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=Et("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const l=this._controlContainer=Et("div","mapboxgl-control-container",h),p=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(w=>{p[w]=Et("div",`mapboxgl-ctrl-${w}`,l)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(h,i){const l=c.exported.devicePixelRatio||1;this._canvas.width=l*Math.ceil(h),this._canvas.height=l*Math.ceil(i),this._canvas.style.width=`${h}px`,this._canvas.style.height=`${i}px`}_addMarker(h){this._markers.push(h)}_removeMarker(h){const i=this._markers.indexOf(h);-1!==i&&this._markers.splice(i,1)}_addPopup(h){this._popups.push(h)}_removePopup(h){const i=this._popups.indexOf(h);-1!==i&&this._popups.splice(i,1)}_setupPainter(){const h=c.extend({},nn.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._useWebGL2&&this._canvas.getContext("webgl2",h),l=i||this._canvas.getContext("webgl",h)||this._canvas.getContext("experimental-webgl",h);l?(this._useWebGL2&&!i&&c.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),c.storeAuthState(l,!0),this.painter=new br(l,this.transform,!!i),this.on("data",p=>{"source"===p.dataType&&this.painter.setTileLoadedFlag(!0)}),c.exported$1.testSupport(l)):this.fire(new c.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(h){h.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new c.Event("webglcontextlost",{originalEvent:h}))}_contextRestored(h){this._setupPainter(),this.resize(),this._update(),this.fire(new c.Event("webglcontextrestored",{originalEvent:h}))}_onMapScroll(h){if(h.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(h){return this.style?(this._styleDirty=this._styleDirty||h,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(h){return this._update(),this._renderTaskQueue.add(h)}_cancelRenderFrame(h){this._renderTaskQueue.remove(h)}_requestDomTask(h){!this.loaded()||this.loaded()&&!this.isMoving()?h():this._domRenderTaskQueue.add(h)}_render(h){let i;const l=this.painter.context.extTimerQuery,p=c.exported.now();if(this.listens("gpu-timing-frame")&&(i=l.createQueryEXT(),l.beginQueryEXT(l.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],c.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],c.window.performance.now())),this._renderTaskQueue.run(h),this._domRenderTaskQueue.run(h),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,y=this.transform.pitch,_=c.exported.now(),T=new c.EvaluationParameters(m,{now:_,fadeDuration:w,pitch:y,transition:this.style.getTransition()});this.style.update(T)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let C=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),C=this._updateAverageElevation(p),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):C=this._updateAverageElevation(p),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new c.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new c.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const m=c.exported.now()-p;l.endQueryEXT(l.TIME_ELAPSED_EXT,i),setTimeout(()=>{const y=l.getQueryObjectEXT(i,l.QUERY_RESULT_EXT)/1e6;l.deleteQueryEXT(i),this.fire(new c.Event("gpu-timing-frame",{cpuTime:m,gpuTime:y})),c.window.performance.mark("frame-gpu",{startTime:p,detail:{gpuTime:y}})},50)}if(this.listens("gpu-timing-layer")){const m=this.painter.collectGpuTimers();setTimeout(()=>{const y=this.painter.queryGpuTimers(m);this.fire(new c.Event("gpu-timing-layer",{layerTimes:y}))},50)}if(this.listens("gpu-timing-deferred-render")){const m=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const y=this.painter.queryGpuTimeDeferredRender(m);this.fire(new c.Event("gpu-timing-deferred-render",{gpuTime:y}))},50)}const P=this._sourcesDirty||this._styleDirty||this._placementDirty||C;if(P||this._repaint)this.triggerRepaint();else{const m=!this.isMoving()&&this.loaded();if(m&&(C=this._updateAverageElevation(p,!0)),C)this.triggerRepaint();else if(this._triggerFrame(!1),m&&(this.fire(new c.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const y=this._calculateSpeedIndex();this.fire(new c.Event("speedindexcompleted",{speedIndex:y})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||P||(this._fullyLoaded=!0,c.LivePerformanceUtils.mark(c.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&c.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(h){for(const i of this._markers)h&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!h||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(h,i=!1){const l=p=>(this.transform.averageElevation=p,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&l(0);if((i||h-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(h)){const p=this.transform.averageElevation;let w=this.transform.sampleAverageElevation(),C=!1;this.transform.elevation&&(C=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=h;const P=Math.abs(p-w);if(P>1){if(this._isInitialLoad||C)return this._averageElevation.jumpTo(w),l(w);this._averageElevation.easeTo(w,h,300)}else if(P>1e-4)return this._averageElevation.jumpTo(w),l(w)}return!!this._averageElevation.isEasing(h)&&l(this._averageElevation.getValue(h))}_authenticate(){c.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,h=>{if(h&&(h.message===c.AUTH_ERR_MSG||401===h.status)){const i=this.painter.context.gl;c.storeAuthState(i,!1),this._logoControl instanceof Xc&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new c.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),c.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const h=this._isDragging();this.painter.updateTerrain(this.style,h)}_calculateSpeedIndex(){const h=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const l=this.painter.context.gl,p=l.createFramebuffer();function w(C){l.framebufferTexture2D(l.FRAMEBUFFER,l.COLOR_ATTACHMENT0,l.TEXTURE_2D,C,0);const P=new Uint8Array(l.drawingBufferWidth*l.drawingBufferHeight*4);return l.readPixels(0,0,l.drawingBufferWidth,l.drawingBufferHeight,l.RGBA,l.UNSIGNED_BYTE,P),P}return l.bindFramebuffer(l.FRAMEBUFFER,p),this._canvasPixelComparison(w(h),i.canvasCopies.map(w),i.timeStamps)}_canvasPixelComparison(h,i,l){let p=l[1]-l[0];const w=h.length/4;for(let C=0;C<i.length;C++){const P=i[C];let m=0;for(let y=0;y<P.length;y+=4)P[y]===h[y]&&P[y+1]===h[y+1]&&P[y+2]===h[y+2]&&P[y+3]===h[y+3]&&(m+=1);p+=(l[C+2]-l[C+1])*(1-m/w)}return p}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==c.window&&(c.window.removeEventListener("resize",this._onWindowResize,!1),c.window.removeEventListener("orientationchange",this._onWindowResize,!1),c.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),c.window.removeEventListener("online",this._onWindowOnline,!1),c.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const h=this.painter.context.gl.getExtension("WEBGL_lose_context");h&&h.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),c.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new c.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(h){this._renderNextFrame=this._renderNextFrame||h,this.style&&!this._frame&&(this._frame=c.exported.frame(i=>{const l=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,l&&this._render(i)}))}_preloadTiles(h){const i=this.style?Object.values(this.style._sourceCaches):[];return c.asyncAll(i,(l,p)=>l._preloadTiles(h,p),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(h){this._trackResize&&this.resize({originalEvent:h})._update()}_onVisibilityChange(){"hidden"===c.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(h){this._showTileBoundaries!==h&&(this._showTileBoundaries=h,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(h){this._showTerrainWireframe!==h&&(this._showTerrainWireframe=h,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(h){this._speedIndexTiming!==h&&(this._speedIndexTiming=h,this._update())}get showPadding(){return!!this._showPadding}set showPadding(h){this._showPadding!==h&&(this._showPadding=h,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(h){this._showCollisionBoxes!==h&&(this._showCollisionBoxes=h,h?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(h){this._showOverdrawInspector!==h&&(this._showOverdrawInspector=h,this._update())}get repaint(){return!!this._repaint}set repaint(h){this._repaint!==h&&(this._repaint=h,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(h){this._vertices=h,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(h){this._showTileAABBs!==h&&(this._showTileAABBs=h,h&&this._update())}_setCacheLimits(h,i){c.setCacheLimits(h,i)}get version(){return c.version}},NavigationControl:class{constructor(h){this.options=c.extend({},Tf,h),this._container=Et("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(c.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),Et("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),Et("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(c.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const l=this._map;l&&(this.options.visualizePitch?l.resetNorthPitch({},{originalEvent:i}):l.resetNorth({},{originalEvent:i}))}),this._compassIcon=Et("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const h=this._map;if(!h)return;const i=h.getZoom(),l=i===h.getMaxZoom(),p=i===h.getMinZoom();this._zoomInButton.disabled=l,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",l.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const h=this._map;if(!h)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(h.transform.pitch*(Math.PI/180)),.5)}) rotateX(${h.transform.pitch}deg) rotateZ(${h.transform.angle*(180/Math.PI)}deg)`:`rotate(${h.transform.angle*(180/Math.PI)}deg)`;h._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),h.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&h.on("pitch",this._rotateCompassArrow),h.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ph(h,this._compass,this.options.visualizePitch)),this._container}onRemove(){const h=this._map;h&&(this._container.remove(),this.options.showZoom&&h.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&h.off("pitch",this._rotateCompassArrow),h.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(h,i){const l=Et("button",h,this._container);return l.type="button",l.addEventListener("click",i),l}_setButtonTitle(h,i){if(!this._map)return;const l=this._map._getUIString(`NavigationControl.${i}`);h.setAttribute("aria-label",l),h.firstElementChild&&h.firstElementChild.setAttribute("title",l)}},GeolocateControl:class extends c.Evented{constructor(h){super(),this.options=c.extend({geolocation:c.window.navigator.geolocation},wo,h),c.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ln(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(h){return this._map=h,this._container=Et("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(h){const i=(l=!!this.options.geolocation)=>{this._supportsGeolocation=l,h(l)};void 0!==this._supportsGeolocation?h(this._supportsGeolocation):void 0!==c.window.navigator.permissions?c.window.navigator.permissions.query({name:"geolocation"}).then(l=>i("denied"!==l.state)).catch(()=>i()):i()}_isOutOfMapMaxBounds(h){const i=this._map.getMaxBounds(),l=h.coords;return!!i&&(l.longitude<i.getWest()||l.longitude>i.getEast()||l.latitude<i.getSouth()||l.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(h){if(this._map){if(this._isOutOfMapMaxBounds(h))return this._setErrorState(),this.fire(new c.Event("outofmaxbounds",h)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=h,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(h),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(h),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("geolocate",h)),this._finish()}}_updateCamera(h){const i=new c.LngLat(h.coords.longitude,h.coords.latitude),l=h.coords.accuracy,p=this._map.getBearing(),w=c.extend({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(l),w,{geolocateSource:!0})}_updateMarker(h){if(h){const i=new c.LngLat(h.coords.longitude,h.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=h.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const h=this._map.transform,i=c.mercatorZfromAltitude(1,h._center.lat)*h.worldSize,l=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${l}px`,this._circleElement.style.height=`${l}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(h){if(this._map){if(this.options.trackUserLocation)if(1===h.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===h.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new c.Event("error",h)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(h){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=Et("button","mapboxgl-ctrl-geolocate",this._container),Et("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===h){c.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Et("div","mapboxgl-user-location"),this._dotElement.appendChild(Et("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Et("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new vn({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Et("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new vn({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||"ACTIVE_LOCK"!==this._watchState||i.originalEvent&&"resize"===i.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new c.Event("trackuserlocationend")))})}}_onDeviceOrientation(h){this._userLocationDotMarker&&(h.webkitCompassHeading?this._heading=h.webkitCompassHeading:!0===h.absolute&&(this._heading=-1*h.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return c.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new c.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new c.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new c.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let h;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(h={maximumAge:6e5,timeout:0},this._noTimeout=!0):(h=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,h),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const h=()=>{c.window.addEventListener("ondeviceorientationabsolute"in c.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==c.window.DeviceMotionEvent&&"function"==typeof c.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(i=>{"granted"===i&&h()}).catch(console.error):h()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),c.window.removeEventListener("deviceorientation",this._onDeviceOrientation),c.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:wn,ScaleControl:class{constructor(h){this.options=c.extend({},rc,h),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),c.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const h=this.options.maxWidth||100,i=this._map,l=i._containerHeight/2,p=i._containerWidth/2-h/2,w=i.unproject([p,l]),C=i.unproject([p+h,l]),P=w.distanceTo(C);if("imperial"===this.options.unit){const m=3.2808*P;m>5280?this._setScale(h,m/5280,"mile"):this._setScale(h,m,"foot")}else"nautical"===this.options.unit?this._setScale(h,P/1852,"nautical-mile"):P>=1e3?this._setScale(h,P/1e3,"kilometer"):this._setScale(h,P,"meter")}_setScale(h,i,l){this._map._requestDomTask(()=>{const p=function(C){const P=Math.pow(10,`${Math.floor(C)}`.length-1);let m=C/P;return m=m>=10?10:m>=5?5:m>=3?3:m>=2?2:m>=1?1:function(y){const _=Math.pow(10,Math.ceil(-Math.log(y)/Math.LN10));return Math.round(y*_)/_}(m),P*m}(i),w=p/i;this._container.innerHTML=this._isNumberFormatSupported&&"nautical-mile"!==l?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:l}).format(p):`${p}&nbsp;${vl[l]}`,this._container.style.width=h*w+"px"})}onAdd(h){return this._map=h,this._language=h.getLanguage(),this._container=Et("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(h){this._language=h,this._update()}setUnit(h){this.options.unit=h,this._update()}},FullscreenControl:class{constructor(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof c.window.HTMLElement?this._container=h.container:c.warnOnce("Full screen control 'container' must be a DOM element.")),c.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in c.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in c.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=Et("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",c.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,c.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!c.window.document.fullscreenEnabled&&!c.window.document.webkitFullscreenEnabled)}_setupUI(){const h=this._fullscreenButton=Et("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Et("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden","true"),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),c.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",h)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(c.window.document.fullscreenElement||c.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?c.window.document.exitFullscreen?c.window.document.exitFullscreen():c.window.document.webkitCancelFullScreen&&c.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends c.Evented{constructor(h){super(),this.options=c.extend(Object.create(Kc),h),c.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(h&&h.className?h.className.trim().split(/\s+/):[])}addTo(h){return this._map&&this.remove(),this._map=h,this.options.closeOnClick&&h.on("preclick",this._onClose),this.options.closeOnMove&&h.on("move",this._onClose),h.on("remove",this.remove),this._update(),h._addPopup(this),this._focusFirstElement(),this._trackPointer?(h.on("mousemove",this._onMouseEvent),h.on("mouseup",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")):h.on("move",this._update),this.fire(new c.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const h=this._map;return h&&(h.off("move",this._update),h.off("move",this._onClose),h.off("preclick",this._onClose),h.off("click",this._onClose),h.off("remove",this.remove),h.off("mousemove",this._onMouseEvent),h.off("mouseup",this._onMouseEvent),h.off("drag",this._onMouseEvent),h._canvasContainer&&h._canvasContainer.classList.remove("mapboxgl-track-pointer"),h._removePopup(this),this._map=void 0),this.fire(new c.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(h){this._lngLat=c.LngLat.convert(h),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const h=this._map;return h&&(h.off("move",this._update),h.on("mousemove",this._onMouseEvent),h.on("drag",this._onMouseEvent),h._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(h){return this.setDOMContent(c.window.document.createTextNode(h))}setHTML(h){const i=c.window.document.createDocumentFragment(),l=c.window.document.createElement("body");let p;for(l.innerHTML=h;p=l.firstChild,p;)i.appendChild(p);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(h){return this.options.maxWidth=h,this._update(),this}setDOMContent(h){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=Et("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(h),this.options.closeButton){const l=this._closeButton=Et("button","mapboxgl-popup-close-button",i);l.type="button",l.setAttribute("aria-label","Close popup"),l.setAttribute("aria-hidden","true"),l.innerHTML="&#215;",l.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(h){return this._classList.add(h),this._updateClassList(),this}removeClassName(h){return this._classList.delete(h),this._updateClassList(),this}setOffset(h){return this.options.offset=h,this._update(),this}toggleClassName(h){let i;return this._classList.delete(h)?i=!1:(this._classList.add(h),i=!0),this._updateClassList(),i}_onMouseEvent(h){this._update(h.point)}_getAnchor(h){if(this.options.anchor)return this.options.anchor;const i=this._map,l=this._container,p=this._pos;if(!i||!l||!p)return"bottom";const w=l.offsetWidth,C=l.offsetHeight,P=p.x<w/2,m=p.x>i.transform.width-w/2;if(p.y+h<C)return P?"top-left":m?"top-right":"top";if(p.y>i.transform.height-C){if(P)return"bottom-left";if(m)return"bottom-right"}return P?"left":m?"right":"bottom"}_updateClassList(){const h=this._container;if(!h)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),h.className=i.join(" ")}_update(h){const i=this._map,l=this._content;if(!i||!this._lngLat&&!this._trackPointer||!l)return;let p=this._container;if(p||(p=this._container=Et("div","mapboxgl-popup",i.getContainer()),this._tip=Et("div","mapboxgl-popup-tip",p),p.appendChild(l)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ar(this._lngLat,this._pos,i.transform)),!this._trackPointer||h){const w=this._pos=this._trackPointer&&h?h:i.project(this._lngLat),C=ld(this.options.offset),P=this._anchor=this._getAnchor(C.y),m=ld(this.options.offset,P),y=w.add(m).round();i._requestDomTask(()=>{this._container&&P&&(this._container.style.transform=`${Fl[P]} translate(${y.x}px,${y.y}px)`)})}if(!this._marker&&i._showingGlobe()){const w=c.isLngLatBehindGlobe(i.transform,this._lngLat)?0:1;this._setOpacity(w)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const h=this._container.querySelector(ad);h&&h.focus()}_onClose(){this.remove()}_setOpacity(h){this._container&&(this._container.style.opacity=`${h}`),this._content&&(this._content.style.pointerEvents=h?"auto":"none")}},Marker:vn,Style:ro,LngLat:c.LngLat,LngLatBounds:c.LngLatBounds,Point:c.Point,MercatorCoordinate:c.MercatorCoordinate,FreeCameraOptions:Ae,Evented:c.Evented,config:c.config,prewarm:function(){Ai().acquire(on)},clearPrewarmedResources:function(){const h=Tn;h&&(h.isPreloaded()&&1===h.numActive()?(h.release(on),Tn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return c.config.ACCESS_TOKEN},set accessToken(h){c.config.ACCESS_TOKEN=h},get baseApiUrl(){return c.config.API_URL},set baseApiUrl(h){c.config.API_URL=h},get workerCount(){return _n.workerCount},set workerCount(h){_n.workerCount=h},get maxParallelImageRequests(){return c.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){c.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage(h){c.clearTileCache(h)},workerUrl:"",workerClass:null,setNow:c.exported.setNow,restoreNow:c.exported.restoreNow};return Bl}),Y}()},1135:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{X:()=>W});var Y=Te(7579);class W extends Y.x{constructor(c){super(),this._value=c}get value(){return this.getValue()}_subscribe(c){const Re=super._subscribe(c);return!Re.closed&&c.next(this._value),Re}getValue(){const{hasError:c,thrownError:Re,_value:nn}=this;if(c)throw Re;return this._throwIfClosed(),nn}next(c){super.next(this._value=c)}}},9751:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{y:()=>Tt});var Y=Te(2961),W=Te(727),Xe=Te(8822),c=Te(9635),Re=Te(2416),nn=Te(576),xt=Te(2806);let Tt=(()=>{class Qt{constructor(It){It&&(this._subscribe=It)}lift(It){const bn=new Qt;return bn.source=this,bn.operator=It,bn}subscribe(It,bn,Yt){const Nn=function _t(Qt){return Qt&&Qt instanceof Y.Lv||function At(Qt){return Qt&&(0,nn.m)(Qt.next)&&(0,nn.m)(Qt.error)&&(0,nn.m)(Qt.complete)}(Qt)&&(0,W.Nn)(Qt)}(It)?It:new Y.Hp(It,bn,Yt);return(0,xt.x)(()=>{const{operator:pn,source:rn}=this;Nn.add(pn?pn.call(Nn,rn):rn?this._subscribe(Nn):this._trySubscribe(Nn))}),Nn}_trySubscribe(It){try{return this._subscribe(It)}catch(bn){It.error(bn)}}forEach(It,bn){return new(bn=Et(bn))((Yt,Nn)=>{const pn=new Y.Hp({next:rn=>{try{It(rn)}catch(an){Nn(an),pn.unsubscribe()}},error:Nn,complete:Yt});this.subscribe(pn)})}_subscribe(It){var bn;return null===(bn=this.source)||void 0===bn?void 0:bn.subscribe(It)}[Xe.L](){return this}pipe(...It){return(0,c.U)(It)(this)}toPromise(It){return new(It=Et(It))((bn,Yt)=>{let Nn;this.subscribe(pn=>Nn=pn,pn=>Yt(pn),()=>bn(Nn))})}}return Qt.create=An=>new Qt(An),Qt})();function Et(Qt){var An;return null!==(An=Qt??Re.v.Promise)&&void 0!==An?An:Promise}},7579:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{x:()=>xt});var Y=Te(9751),W=Te(727);const c=(0,Te(3888).d)(Et=>function(){Et(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Re=Te(8737),nn=Te(2806);let xt=(()=>{class Et extends Y.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(_t){const Qt=new Tt(this,this);return Qt.operator=_t,Qt}_throwIfClosed(){if(this.closed)throw new c}next(_t){(0,nn.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const Qt of this.currentObservers)Qt.next(_t)}})}error(_t){(0,nn.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=_t;const{observers:Qt}=this;for(;Qt.length;)Qt.shift().error(_t)}})}complete(){(0,nn.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:_t}=this;for(;_t.length;)_t.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var _t;return(null===(_t=this.observers)||void 0===_t?void 0:_t.length)>0}_trySubscribe(_t){return this._throwIfClosed(),super._trySubscribe(_t)}_subscribe(_t){return this._throwIfClosed(),this._checkFinalizedStatuses(_t),this._innerSubscribe(_t)}_innerSubscribe(_t){const{hasError:Qt,isStopped:An,observers:It}=this;return Qt||An?W.Lc:(this.currentObservers=null,It.push(_t),new W.w0(()=>{this.currentObservers=null,(0,Re.P)(It,_t)}))}_checkFinalizedStatuses(_t){const{hasError:Qt,thrownError:An,isStopped:It}=this;Qt?_t.error(An):It&&_t.complete()}asObservable(){const _t=new Y.y;return _t.source=this,_t}}return Et.create=(At,_t)=>new Tt(At,_t),Et})();class Tt extends xt{constructor(At,_t){super(),this.destination=At,this.source=_t}next(At){var _t,Qt;null===(Qt=null===(_t=this.destination)||void 0===_t?void 0:_t.next)||void 0===Qt||Qt.call(_t,At)}error(At){var _t,Qt;null===(Qt=null===(_t=this.destination)||void 0===_t?void 0:_t.error)||void 0===Qt||Qt.call(_t,At)}complete(){var At,_t;null===(_t=null===(At=this.destination)||void 0===At?void 0:At.complete)||void 0===_t||_t.call(At)}_subscribe(At){var _t,Qt;return null!==(Qt=null===(_t=this.source)||void 0===_t?void 0:_t.subscribe(At))&&void 0!==Qt?Qt:W.Lc}}},2961:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{Hp:()=>Yt,Lv:()=>Qt});var Y=Te(576),W=Te(727),Xe=Te(2416),c=Te(7849);function Re(){}const nn=Et("C",void 0,void 0);function Et(Pt,Se,fn){return{kind:Pt,value:Se,error:fn}}var At=Te(3410),_t=Te(2806);class Qt extends W.w0{constructor(Se){super(),this.isStopped=!1,Se?(this.destination=Se,(0,W.Nn)(Se)&&Se.add(this)):this.destination=an}static create(Se,fn,Zn){return new Yt(Se,fn,Zn)}next(Se){this.isStopped?rn(function Tt(Pt){return Et("N",Pt,void 0)}(Se),this):this._next(Se)}error(Se){this.isStopped?rn(function xt(Pt){return Et("E",void 0,Pt)}(Se),this):(this.isStopped=!0,this._error(Se))}complete(){this.isStopped?rn(nn,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(Se){this.destination.next(Se)}_error(Se){try{this.destination.error(Se)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const An=Function.prototype.bind;function It(Pt,Se){return An.call(Pt,Se)}class bn{constructor(Se){this.partialObserver=Se}next(Se){const{partialObserver:fn}=this;if(fn.next)try{fn.next(Se)}catch(Zn){Nn(Zn)}}error(Se){const{partialObserver:fn}=this;if(fn.error)try{fn.error(Se)}catch(Zn){Nn(Zn)}else Nn(Se)}complete(){const{partialObserver:Se}=this;if(Se.complete)try{Se.complete()}catch(fn){Nn(fn)}}}class Yt extends Qt{constructor(Se,fn,Zn){let tt;if(super(),(0,Y.m)(Se)||!Se)tt={next:Se??void 0,error:fn??void 0,complete:Zn??void 0};else{let kt;this&&Xe.v.useDeprecatedNextContext?(kt=Object.create(Se),kt.unsubscribe=()=>this.unsubscribe(),tt={next:Se.next&&It(Se.next,kt),error:Se.error&&It(Se.error,kt),complete:Se.complete&&It(Se.complete,kt)}):tt=Se}this.destination=new bn(tt)}}function Nn(Pt){Xe.v.useDeprecatedSynchronousErrorHandling?(0,_t.O)(Pt):(0,c.h)(Pt)}function rn(Pt,Se){const{onStoppedNotification:fn}=Xe.v;fn&&At.z.setTimeout(()=>fn(Pt,Se))}const an={closed:!0,next:Re,error:function pn(Pt){throw Pt},complete:Re}},727:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{Lc:()=>nn,w0:()=>Re,Nn:()=>xt});var Y=Te(576);const Xe=(0,Te(3888).d)(Et=>function(_t){Et(this),this.message=_t?`${_t.length} errors occurred during unsubscription:\n${_t.map((Qt,An)=>`${An+1}) ${Qt.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=_t});var c=Te(8737);class Re{constructor(At){this.initialTeardown=At,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let At;if(!this.closed){this.closed=!0;const{_parentage:_t}=this;if(_t)if(this._parentage=null,Array.isArray(_t))for(const It of _t)It.remove(this);else _t.remove(this);const{initialTeardown:Qt}=this;if((0,Y.m)(Qt))try{Qt()}catch(It){At=It instanceof Xe?It.errors:[It]}const{_finalizers:An}=this;if(An){this._finalizers=null;for(const It of An)try{Tt(It)}catch(bn){At=At??[],bn instanceof Xe?At=[...At,...bn.errors]:At.push(bn)}}if(At)throw new Xe(At)}}add(At){var _t;if(At&&At!==this)if(this.closed)Tt(At);else{if(At instanceof Re){if(At.closed||At._hasParent(this))return;At._addParent(this)}(this._finalizers=null!==(_t=this._finalizers)&&void 0!==_t?_t:[]).push(At)}}_hasParent(At){const{_parentage:_t}=this;return _t===At||Array.isArray(_t)&&_t.includes(At)}_addParent(At){const{_parentage:_t}=this;this._parentage=Array.isArray(_t)?(_t.push(At),_t):_t?[_t,At]:At}_removeParent(At){const{_parentage:_t}=this;_t===At?this._parentage=null:Array.isArray(_t)&&(0,c.P)(_t,At)}remove(At){const{_finalizers:_t}=this;_t&&(0,c.P)(_t,At),At instanceof Re&&At._removeParent(this)}}Re.EMPTY=(()=>{const Et=new Re;return Et.closed=!0,Et})();const nn=Re.EMPTY;function xt(Et){return Et instanceof Re||Et&&"closed"in Et&&(0,Y.m)(Et.remove)&&(0,Y.m)(Et.add)&&(0,Y.m)(Et.unsubscribe)}function Tt(Et){(0,Y.m)(Et)?Et():Et.unsubscribe()}},2416:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{v:()=>Y});const Y={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},515:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{E:()=>W});const W=new(Te(9751).y)(Re=>Re.complete())},2076:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{D:()=>Zn});var Y=Te(8421),W=Te(9672),Xe=Te(4482),c=Te(5403);function Re(tt,kt=0){return(0,Xe.e)((pt,zt)=>{pt.subscribe((0,c.x)(zt,En=>(0,W.f)(zt,tt,()=>zt.next(En),kt),()=>(0,W.f)(zt,tt,()=>zt.complete(),kt),En=>(0,W.f)(zt,tt,()=>zt.error(En),kt)))})}function nn(tt,kt=0){return(0,Xe.e)((pt,zt)=>{zt.add(tt.schedule(()=>pt.subscribe(zt),kt))})}var Et=Te(9751),_t=Te(2202),Qt=Te(576);function It(tt,kt){if(!tt)throw new Error("Iterable cannot be null");return new Et.y(pt=>{(0,W.f)(pt,kt,()=>{const zt=tt[Symbol.asyncIterator]();(0,W.f)(pt,kt,()=>{zt.next().then(En=>{En.done?pt.complete():pt.next(En.value)})},0,!0)})})}var bn=Te(3670),Yt=Te(8239),Nn=Te(1144),pn=Te(6495),rn=Te(2206),an=Te(4532),Pt=Te(3260);function Zn(tt,kt){return kt?function fn(tt,kt){if(null!=tt){if((0,bn.c)(tt))return function xt(tt,kt){return(0,Y.Xf)(tt).pipe(nn(kt),Re(kt))}(tt,kt);if((0,Nn.z)(tt))return function At(tt,kt){return new Et.y(pt=>{let zt=0;return kt.schedule(function(){zt===tt.length?pt.complete():(pt.next(tt[zt++]),pt.closed||this.schedule())})})}(tt,kt);if((0,Yt.t)(tt))return function Tt(tt,kt){return(0,Y.Xf)(tt).pipe(nn(kt),Re(kt))}(tt,kt);if((0,rn.D)(tt))return It(tt,kt);if((0,pn.T)(tt))return function An(tt,kt){return new Et.y(pt=>{let zt;return(0,W.f)(pt,kt,()=>{zt=tt[_t.h](),(0,W.f)(pt,kt,()=>{let En,yi;try{({value:En,done:yi}=zt.next())}catch(Mt){return void pt.error(Mt)}yi?pt.complete():pt.next(En)},0,!0)}),()=>(0,Qt.m)(zt?.return)&&zt.return()})}(tt,kt);if((0,Pt.L)(tt))return function Se(tt,kt){return It((0,Pt.Q)(tt),kt)}(tt,kt)}throw(0,an.z)(tt)}(tt,kt):(0,Y.Xf)(tt)}},8421:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{Xf:()=>An});var Y=Te(655),W=Te(1144),Xe=Te(8239),c=Te(9751),Re=Te(3670),nn=Te(2206),xt=Te(4532),Tt=Te(6495),Et=Te(3260),At=Te(576),_t=Te(7849),Qt=Te(8822);function An(Pt){if(Pt instanceof c.y)return Pt;if(null!=Pt){if((0,Re.c)(Pt))return function It(Pt){return new c.y(Se=>{const fn=Pt[Qt.L]();if((0,At.m)(fn.subscribe))return fn.subscribe(Se);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(Pt);if((0,W.z)(Pt))return function bn(Pt){return new c.y(Se=>{for(let fn=0;fn<Pt.length&&!Se.closed;fn++)Se.next(Pt[fn]);Se.complete()})}(Pt);if((0,Xe.t)(Pt))return function Yt(Pt){return new c.y(Se=>{Pt.then(fn=>{Se.closed||(Se.next(fn),Se.complete())},fn=>Se.error(fn)).then(null,_t.h)})}(Pt);if((0,nn.D)(Pt))return pn(Pt);if((0,Tt.T)(Pt))return function Nn(Pt){return new c.y(Se=>{for(const fn of Pt)if(Se.next(fn),Se.closed)return;Se.complete()})}(Pt);if((0,Et.L)(Pt))return function rn(Pt){return pn((0,Et.Q)(Pt))}(Pt)}throw(0,xt.z)(Pt)}function pn(Pt){return new c.y(Se=>{(function an(Pt,Se){var fn,Zn,tt,kt;return(0,Y.mG)(this,void 0,void 0,function*(){try{for(fn=(0,Y.KL)(Pt);!(Zn=yield fn.next()).done;)if(Se.next(Zn.value),Se.closed)return}catch(pt){tt={error:pt}}finally{try{Zn&&!Zn.done&&(kt=fn.return)&&(yield kt.call(fn))}finally{if(tt)throw tt.error}}Se.complete()})})(Pt,Se).catch(fn=>Se.error(fn))})}},9646:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{of:()=>Xe});var Y=Te(7669),W=Te(2076);function Xe(...c){const Re=(0,Y.yG)(c);return(0,W.D)(c,Re)}},5403:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{x:()=>W});var Y=Te(2961);function W(c,Re,nn,xt,Tt){return new Xe(c,Re,nn,xt,Tt)}class Xe extends Y.Lv{constructor(Re,nn,xt,Tt,Et,At){super(Re),this.onFinalize=Et,this.shouldUnsubscribe=At,this._next=nn?function(_t){try{nn(_t)}catch(Qt){Re.error(Qt)}}:super._next,this._error=Tt?function(_t){try{Tt(_t)}catch(Qt){Re.error(Qt)}finally{this.unsubscribe()}}:super._error,this._complete=xt?function(){try{xt()}catch(_t){Re.error(_t)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var Re;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:nn}=this;super.unsubscribe(),!nn&&(null===(Re=this.onFinalize)||void 0===Re||Re.call(this))}}}},262:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{K:()=>c});var Y=Te(8421),W=Te(5403),Xe=Te(4482);function c(Re){return(0,Xe.e)((nn,xt)=>{let At,Tt=null,Et=!1;Tt=nn.subscribe((0,W.x)(xt,void 0,void 0,_t=>{At=(0,Y.Xf)(Re(_t,c(Re)(nn))),Tt?(Tt.unsubscribe(),Tt=null,At.subscribe(xt)):Et=!0})),Et&&(Tt.unsubscribe(),Tt=null,At.subscribe(xt))})}},4351:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{b:()=>Xe});var Y=Te(5577),W=Te(576);function Xe(c,Re){return(0,W.m)(Re)?(0,Y.z)(c,Re,1):(0,Y.z)(c,1)}},9300:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{h:()=>Xe});var Y=Te(4482),W=Te(5403);function Xe(c,Re){return(0,Y.e)((nn,xt)=>{let Tt=0;nn.subscribe((0,W.x)(xt,Et=>c.call(Re,Et,Tt++)&&xt.next(Et)))})}},4004:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{U:()=>Xe});var Y=Te(4482),W=Te(5403);function Xe(c,Re){return(0,Y.e)((nn,xt)=>{let Tt=0;nn.subscribe((0,W.x)(xt,Et=>{xt.next(c.call(Re,Et,Tt++))}))})}},8189:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{J:()=>Xe});var Y=Te(5577),W=Te(4671);function Xe(c=1/0){return(0,Y.z)(W.y,c)}},5577:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{z:()=>Tt});var Y=Te(4004),W=Te(8421),Xe=Te(4482),c=Te(9672),Re=Te(5403),xt=Te(576);function Tt(Et,At,_t=1/0){return(0,xt.m)(At)?Tt((Qt,An)=>(0,Y.U)((It,bn)=>At(Qt,It,An,bn))((0,W.Xf)(Et(Qt,An))),_t):("number"==typeof At&&(_t=At),(0,Xe.e)((Qt,An)=>function nn(Et,At,_t,Qt,An,It,bn,Yt){const Nn=[];let pn=0,rn=0,an=!1;const Pt=()=>{an&&!Nn.length&&!pn&&At.complete()},Se=Zn=>pn<Qt?fn(Zn):Nn.push(Zn),fn=Zn=>{It&&At.next(Zn),pn++;let tt=!1;(0,W.Xf)(_t(Zn,rn++)).subscribe((0,Re.x)(At,kt=>{An?.(kt),It?Se(kt):At.next(kt)},()=>{tt=!0},void 0,()=>{if(tt)try{for(pn--;Nn.length&&pn<Qt;){const kt=Nn.shift();bn?(0,c.f)(At,bn,()=>fn(kt)):fn(kt)}Pt()}catch(kt){At.error(kt)}}))};return Et.subscribe((0,Re.x)(At,Se,()=>{an=!0,Pt()})),()=>{Yt?.()}}(Qt,An,Et,_t)))}},8505:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{b:()=>Re});var Y=Te(576),W=Te(4482),Xe=Te(5403),c=Te(4671);function Re(nn,xt,Tt){const Et=(0,Y.m)(nn)||xt||Tt?{next:nn,error:xt,complete:Tt}:nn;return Et?(0,W.e)((At,_t)=>{var Qt;null===(Qt=Et.subscribe)||void 0===Qt||Qt.call(Et);let An=!0;At.subscribe((0,Xe.x)(_t,It=>{var bn;null===(bn=Et.next)||void 0===bn||bn.call(Et,It),_t.next(It)},()=>{var It;An=!1,null===(It=Et.complete)||void 0===It||It.call(Et),_t.complete()},It=>{var bn;An=!1,null===(bn=Et.error)||void 0===bn||bn.call(Et,It),_t.error(It)},()=>{var It,bn;An&&(null===(It=Et.unsubscribe)||void 0===It||It.call(Et)),null===(bn=Et.finalize)||void 0===bn||bn.call(Et)}))}):c.y}},3410:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{z:()=>Y});const Y={setTimeout(W,Xe,...c){const{delegate:Re}=Y;return Re?.setTimeout?Re.setTimeout(W,Xe,...c):setTimeout(W,Xe,...c)},clearTimeout(W){const{delegate:Xe}=Y;return(Xe?.clearTimeout||clearTimeout)(W)},delegate:void 0}},2202:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{h:()=>W});const W=function Y(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},8822:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{L:()=>Y});const Y="function"==typeof Symbol&&Symbol.observable||"@@observable"},7669:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{_6:()=>nn,jO:()=>c,yG:()=>Re});var Y=Te(576);function Xe(xt){return xt[xt.length-1]}function c(xt){return(0,Y.m)(Xe(xt))?xt.pop():void 0}function Re(xt){return function W(xt){return xt&&(0,Y.m)(xt.schedule)}(Xe(xt))?xt.pop():void 0}function nn(xt,Tt){return"number"==typeof Xe(xt)?xt.pop():Tt}},4742:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{D:()=>Re});const{isArray:Y}=Array,{getPrototypeOf:W,prototype:Xe,keys:c}=Object;function Re(xt){if(1===xt.length){const Tt=xt[0];if(Y(Tt))return{args:Tt,keys:null};if(function nn(xt){return xt&&"object"==typeof xt&&W(xt)===Xe}(Tt)){const Et=c(Tt);return{args:Et.map(At=>Tt[At]),keys:Et}}}return{args:xt,keys:null}}},8737:(ii,Ke,Te)=>{"use strict";function Y(W,Xe){if(W){const c=W.indexOf(Xe);0<=c&&W.splice(c,1)}}Te.d(Ke,{P:()=>Y})},3888:(ii,Ke,Te)=>{"use strict";function Y(W){const c=W(Re=>{Error.call(Re),Re.stack=(new Error).stack});return c.prototype=Object.create(Error.prototype),c.prototype.constructor=c,c}Te.d(Ke,{d:()=>Y})},1810:(ii,Ke,Te)=>{"use strict";function Y(W,Xe){return W.reduce((c,Re,nn)=>(c[Re]=Xe[nn],c),{})}Te.d(Ke,{n:()=>Y})},2806:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{O:()=>c,x:()=>Xe});var Y=Te(2416);let W=null;function Xe(Re){if(Y.v.useDeprecatedSynchronousErrorHandling){const nn=!W;if(nn&&(W={errorThrown:!1,error:null}),Re(),nn){const{errorThrown:xt,error:Tt}=W;if(W=null,xt)throw Tt}}else Re()}function c(Re){Y.v.useDeprecatedSynchronousErrorHandling&&W&&(W.errorThrown=!0,W.error=Re)}},9672:(ii,Ke,Te)=>{"use strict";function Y(W,Xe,c,Re=0,nn=!1){const xt=Xe.schedule(function(){c(),nn?W.add(this.schedule(null,Re)):this.unsubscribe()},Re);if(W.add(xt),!nn)return xt}Te.d(Ke,{f:()=>Y})},4671:(ii,Ke,Te)=>{"use strict";function Y(W){return W}Te.d(Ke,{y:()=>Y})},1144:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{z:()=>Y});const Y=W=>W&&"number"==typeof W.length&&"function"!=typeof W},2206:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{D:()=>W});var Y=Te(576);function W(Xe){return Symbol.asyncIterator&&(0,Y.m)(Xe?.[Symbol.asyncIterator])}},576:(ii,Ke,Te)=>{"use strict";function Y(W){return"function"==typeof W}Te.d(Ke,{m:()=>Y})},3670:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{c:()=>Xe});var Y=Te(8822),W=Te(576);function Xe(c){return(0,W.m)(c[Y.L])}},6495:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{T:()=>Xe});var Y=Te(2202),W=Te(576);function Xe(c){return(0,W.m)(c?.[Y.h])}},8239:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{t:()=>W});var Y=Te(576);function W(Xe){return(0,Y.m)(Xe?.then)}},3260:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{L:()=>c,Q:()=>Xe});var Y=Te(655),W=Te(576);function Xe(Re){return(0,Y.FC)(this,arguments,function*(){const xt=Re.getReader();try{for(;;){const{value:Tt,done:Et}=yield(0,Y.qq)(xt.read());if(Et)return yield(0,Y.qq)(void 0);yield yield(0,Y.qq)(Tt)}}finally{xt.releaseLock()}})}function c(Re){return(0,W.m)(Re?.getReader)}},4482:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{A:()=>W,e:()=>Xe});var Y=Te(576);function W(c){return(0,Y.m)(c?.lift)}function Xe(c){return Re=>{if(W(Re))return Re.lift(function(nn){try{return c(nn,this)}catch(xt){this.error(xt)}});throw new TypeError("Unable to lift unknown Observable type")}}},3268:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{Z:()=>c});var Y=Te(4004);const{isArray:W}=Array;function c(Re){return(0,Y.U)(nn=>function Xe(Re,nn){return W(nn)?Re(...nn):Re(nn)}(Re,nn))}},9635:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{U:()=>Xe,z:()=>W});var Y=Te(4671);function W(...c){return Xe(c)}function Xe(c){return 0===c.length?Y.y:1===c.length?c[0]:function(nn){return c.reduce((xt,Tt)=>Tt(xt),nn)}}},7849:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{h:()=>Xe});var Y=Te(2416),W=Te(3410);function Xe(c){W.z.setTimeout(()=>{const{onUnhandledError:Re}=Y.v;if(!Re)throw c;Re(c)})}},4532:(ii,Ke,Te)=>{"use strict";function Y(W){return new TypeError(`You provided ${null!==W&&"object"==typeof W?"an invalid object":`'${W}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}Te.d(Ke,{z:()=>Y})},5226:function(ii){ii.exports=function(){"use strict";var Ke={awaitingPromise:new WeakMap,promise:new WeakMap,innerParams:new WeakMap,domCache:new WeakMap};const Y=x=>{const E={};for(const I in x)E[x[I]]="swal2-"+x[I];return E},W=Y(["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","default-outline","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error"]),Xe=Y(["success","warning","info","question","error"]),c="SweetAlert2:",nn=x=>x.charAt(0).toUpperCase()+x.slice(1),xt=x=>{console.warn(`${c} ${"object"==typeof x?x.join(" "):x}`)},Tt=x=>{console.error(`${c} ${x}`)},Et=[],_t=(x,E)=>{(x=>{Et.includes(x)||(Et.push(x),xt(x))})(`"${x}" is deprecated and will be removed in the next major release. Please use "${E}" instead.`)},Qt=x=>"function"==typeof x?x():x,An=x=>x&&"function"==typeof x.toPromise,It=x=>An(x)?x.toPromise():Promise.resolve(x),bn=x=>x&&Promise.resolve(x)===x,Yt=()=>document.body.querySelector(`.${W.container}`),Nn=x=>{const E=Yt();return E?E.querySelector(x):null},pn=x=>Nn(`.${x}`),rn=()=>pn(W.popup),an=()=>pn(W.icon),Se=()=>pn(W.title),fn=()=>pn(W["html-container"]),Zn=()=>pn(W.image),tt=()=>pn(W["progress-steps"]),kt=()=>pn(W["validation-message"]),pt=()=>Nn(`.${W.actions} .${W.confirm}`),zt=()=>Nn(`.${W.actions} .${W.cancel}`),En=()=>Nn(`.${W.actions} .${W.deny}`),Mt=()=>Nn(`.${W.loader}`),Bi=()=>pn(W.actions),qe=()=>pn(W.footer),at=()=>pn(W["timer-progress-bar"]),bt=()=>pn(W.close),Ut=()=>{const x=Array.from(rn().querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])')).sort((I,H)=>{const pe=parseInt(I.getAttribute("tabindex")),We=parseInt(H.getAttribute("tabindex"));return pe>We?1:pe<We?-1:0}),E=Array.from(rn().querySelectorAll('\n  a[href],\n  area[href],\n  input:not([disabled]),\n  select:not([disabled]),\n  textarea:not([disabled]),\n  button:not([disabled]),\n  iframe,\n  object,\n  embed,\n  [tabindex="0"],\n  [contenteditable],\n  audio[controls],\n  video[controls],\n  summary\n')).filter(I=>"-1"!==I.getAttribute("tabindex"));return(x=>{const E=[];for(let I=0;I<x.length;I++)-1===E.indexOf(x[I])&&E.push(x[I]);return E})(x.concat(E)).filter(I=>ni(I))},Ot=()=>Rn(document.body,W.shown)&&!Rn(document.body,W["toast-shown"])&&!Rn(document.body,W["no-backdrop"]),On=()=>rn()&&Rn(rn(),W.toast),ji={previousBodyPadding:null},ln=(x,E)=>{if(x.textContent="",E){const H=(new DOMParser).parseFromString(E,"text/html");Array.from(H.querySelector("head").childNodes).forEach(pe=>{x.appendChild(pe)}),Array.from(H.querySelector("body").childNodes).forEach(pe=>{pe instanceof HTMLVideoElement||pe instanceof HTMLAudioElement?x.appendChild(pe.cloneNode(!0)):x.appendChild(pe)})}},Rn=(x,E)=>{if(!E)return!1;const I=E.split(/\s+/);for(let H=0;H<I.length;H++)if(!x.classList.contains(I[H]))return!1;return!0},Hn=(x,E,I)=>{if(((x,E)=>{Array.from(x.classList).forEach(I=>{!Object.values(W).includes(I)&&!Object.values(Xe).includes(I)&&!Object.values(E.showClass).includes(I)&&x.classList.remove(I)})})(x,E),E.customClass&&E.customClass[I]){if("string"!=typeof E.customClass[I]&&!E.customClass[I].forEach)return void xt(`Invalid type of customClass.${I}! Expected string or iterable object, got "${typeof E.customClass[I]}"`);Ht(x,E.customClass[I])}},ui=(x,E)=>{if(!E)return null;switch(E){case"select":case"textarea":case"file":return x.querySelector(`.${W.popup} > .${W[E]}`);case"checkbox":return x.querySelector(`.${W.popup} > .${W.checkbox} input`);case"radio":return x.querySelector(`.${W.popup} > .${W.radio} input:checked`)||x.querySelector(`.${W.popup} > .${W.radio} input:first-child`);case"range":return x.querySelector(`.${W.popup} > .${W.range} input`);default:return x.querySelector(`.${W.popup} > .${W.input}`)}},qn=x=>{if(x.focus(),"file"!==x.type){const E=x.value;x.value="",x.value=E}},hi=(x,E,I)=>{!x||!E||("string"==typeof E&&(E=E.split(/\s+/).filter(Boolean)),E.forEach(H=>{Array.isArray(x)?x.forEach(pe=>{I?pe.classList.add(H):pe.classList.remove(H)}):I?x.classList.add(H):x.classList.remove(H)}))},Ht=(x,E)=>{hi(x,E,!0)},zi=(x,E)=>{hi(x,E,!1)},li=(x,E)=>{const I=Array.from(x.children);for(let H=0;H<I.length;H++){const pe=I[H];if(pe instanceof HTMLElement&&Rn(pe,E))return pe}},Wi=(x,E,I)=>{I===`${parseInt(I)}`&&(I=parseInt(I)),I||0===parseInt(I)?x.style[E]="number"==typeof I?`${I}px`:I:x.style.removeProperty(E)},si=function(x){x.style.display=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flex"},Wt=x=>{x.style.display="none"},Ar=(x,E,I,H)=>{const pe=x.querySelector(E);pe&&(pe.style[I]=H)},yr=function(x,E){E?si(x,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"flex"):Wt(x)},ni=x=>!(!x||!(x.offsetWidth||x.offsetHeight||x.getClientRects().length)),lo=x=>x.scrollHeight>x.clientHeight,Vi=x=>{const E=window.getComputedStyle(x),I=parseFloat(E.getPropertyValue("animation-duration")||"0"),H=parseFloat(E.getPropertyValue("transition-duration")||"0");return I>0||H>0},zr=function(x){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const I=at();ni(I)&&(E&&(I.style.transition="none",I.style.width="100%"),setTimeout(()=>{I.style.transition=`width ${x/1e3}s linear`,I.style.width="0%"},10))},ht={},Ri=x=>new Promise(E=>{if(!x)return E();const I=window.scrollX,H=window.scrollY;ht.restoreFocusTimeout=setTimeout(()=>{ht.previousActiveElement instanceof HTMLElement?(ht.previousActiveElement.focus(),ht.previousActiveElement=null):document.body&&document.body.focus(),E()},100),window.scrollTo(I,H)}),Yi=()=>typeof window>"u"||typeof document>"u",Wr=`\n <div aria-labelledby="${W.title}" aria-describedby="${W["html-container"]}" class="${W.popup}" tabindex="-1">\n   <button type="button" class="${W.close}"></button>\n   <ul class="${W["progress-steps"]}"></ul>\n   <div class="${W.icon}"></div>\n   <img class="${W.image}" />\n   <h2 class="${W.title}" id="${W.title}"></h2>\n   <div class="${W["html-container"]}" id="${W["html-container"]}"></div>\n   <input class="${W.input}" />\n   <input type="file" class="${W.file}" />\n   <div class="${W.range}">\n     <input type="range" />\n     <output></output>\n   </div>\n   <select class="${W.select}"></select>\n   <div class="${W.radio}"></div>\n   <label for="${W.checkbox}" class="${W.checkbox}">\n     <input type="checkbox" />\n     <span class="${W.label}"></span>\n   </label>\n   <textarea class="${W.textarea}"></textarea>\n   <div class="${W["validation-message"]}" id="${W["validation-message"]}"></div>\n   <div class="${W.actions}">\n     <div class="${W.loader}"></div>\n     <button type="button" class="${W.confirm}"></button>\n     <button type="button" class="${W.deny}"></button>\n     <button type="button" class="${W.cancel}"></button>\n   </div>\n   <div class="${W.footer}"></div>\n   <div class="${W["timer-progress-bar-container"]}">\n     <div class="${W["timer-progress-bar"]}"></div>\n   </div>\n </div>\n`.replace(/(^|\n)\s*/g,""),cr=()=>{ht.currentInstance.resetValidationMessage()},xe=x=>{const E=(()=>{const x=Yt();return!!x&&(x.remove(),zi([document.documentElement,document.body],[W["no-backdrop"],W["toast-shown"],W["has-column"]]),!0)})();if(Yi())return void Tt("SweetAlert2 requires document to initialize");const I=document.createElement("div");I.className=W.container,E&&Ht(I,W["no-transition"]),ln(I,Wr);const H=(x=>"string"==typeof x?document.querySelector(x):x)(x.target);H.appendChild(I),(x=>{const E=rn();E.setAttribute("role",x.toast?"alert":"dialog"),E.setAttribute("aria-live",x.toast?"polite":"assertive"),x.toast||E.setAttribute("aria-modal","true")})(x),(x=>{"rtl"===window.getComputedStyle(x).direction&&Ht(Yt(),W.rtl)})(H),(()=>{const x=rn(),E=li(x,W.input),I=li(x,W.file),H=x.querySelector(`.${W.range} input`),pe=x.querySelector(`.${W.range} output`),We=li(x,W.select),en=x.querySelector(`.${W.checkbox} input`),Ln=li(x,W.textarea);E.oninput=cr,I.onchange=cr,We.onchange=cr,en.onchange=cr,Ln.oninput=cr,H.oninput=()=>{cr(),pe.value=H.value},H.onchange=()=>{cr(),pe.value=H.value}})()},Me=(x,E)=>{x instanceof HTMLElement?E.appendChild(x):"object"==typeof x?ze(x,E):x&&ln(E,x)},ze=(x,E)=>{x.jquery?fe(E,x):ln(E,x.toString())},fe=(x,E)=>{if(x.textContent="",0 in E)for(let I=0;I in E;I++)x.appendChild(E[I].cloneNode(!0));else x.appendChild(E.cloneNode(!0))},oe=(()=>{if(Yi())return!1;const x=document.createElement("div"),E={WebkitAnimation:"webkitAnimationEnd",animation:"animationend"};for(const I in E)if(Object.prototype.hasOwnProperty.call(E,I)&&typeof x.style[I]<"u")return E[I];return!1})(),Ce=(x,E)=>{const I=Bi(),H=Mt();E.showConfirmButton||E.showDenyButton||E.showCancelButton?si(I):Wt(I),Hn(I,E,"actions"),function je(x,E,I){const H=pt(),pe=En(),We=zt();ut(H,"confirm",I),ut(pe,"deny",I),ut(We,"cancel",I),function Ye(x,E,I,H){H.buttonsStyling?(Ht([x,E,I],W.styled),H.confirmButtonColor&&(x.style.backgroundColor=H.confirmButtonColor,Ht(x,W["default-outline"])),H.denyButtonColor&&(E.style.backgroundColor=H.denyButtonColor,Ht(E,W["default-outline"])),H.cancelButtonColor&&(I.style.backgroundColor=H.cancelButtonColor,Ht(I,W["default-outline"]))):zi([x,E,I],W.styled)}(H,pe,We,I),I.reverseButtons&&(I.toast?(x.insertBefore(We,H),x.insertBefore(pe,H)):(x.insertBefore(We,E),x.insertBefore(pe,E),x.insertBefore(H,E)))}(I,H,E),ln(H,E.loaderHtml),Hn(H,E,"loader")};function ut(x,E,I){yr(x,I[`show${nn(E)}Button`],"inline-block"),ln(x,I[`${E}ButtonText`]),x.setAttribute("aria-label",I[`${E}ButtonAriaLabel`]),x.className=W[E],Hn(x,I,`${E}Button`),Ht(x,I[`${E}ButtonClass`])}const cn=(x,E)=>{const I=Yt();I&&(function gn(x,E){"string"==typeof E?x.style.background=E:E||Ht([document.documentElement,document.body],W["no-backdrop"])}(I,E.backdrop),function Fn(x,E){E in W?Ht(x,W[E]):(xt('The "position" parameter is not valid, defaulting to "center"'),Ht(x,W.center))}(I,E.position),function Ve(x,E){if(E&&"string"==typeof E){const I=`grow-${E}`;I in W&&Ht(x,W[I])}}(I,E.grow),Hn(I,E,"container"))};const Ne=["input","file","range","select","radio","checkbox","textarea"],$e=x=>{if(!Cn[x.input])return void Tt(`Unexpected type of input! Expected "text", "email", "password", "number", "tel", "select", "radio", "checkbox", "textarea", "file" or "url", got "${x.input}"`);const E=po(x.input),I=Cn[x.input](E,x);si(E),x.inputAutoFocus&&setTimeout(()=>{qn(I)})},on=(x,E)=>{const I=ui(rn(),x);if(I){(x=>{for(let E=0;E<x.attributes.length;E++){const I=x.attributes[E].name;["type","value","style"].includes(I)||x.removeAttribute(I)}})(I);for(const H in E)I.setAttribute(H,E[H])}},_n=x=>{const E=po(x.input);"object"==typeof x.customClass&&Ht(E,x.customClass.input)},Tn=(x,E)=>{(!x.placeholder||E.inputPlaceholder)&&(x.placeholder=E.inputPlaceholder)},Ai=(x,E,I)=>{if(I.inputLabel){x.id=W.input;const H=document.createElement("label"),pe=W["input-label"];H.setAttribute("for",x.id),H.className=pe,"object"==typeof I.customClass&&Ht(H,I.customClass.inputLabel),H.innerText=I.inputLabel,E.insertAdjacentElement("beforebegin",H)}},po=x=>li(rn(),W[x]||W.input),Yr=(x,E)=>{["string","number"].includes(typeof E)?x.value=`${E}`:bn(E)||xt(`Unexpected type of inputValue! Expected "string", "number" or "Promise", got "${typeof E}"`)},Cn={};Cn.text=Cn.email=Cn.password=Cn.number=Cn.tel=Cn.url=(x,E)=>(Yr(x,E.inputValue),Ai(x,x,E),Tn(x,E),x.type=E.input,x),Cn.file=(x,E)=>(Ai(x,x,E),Tn(x,E),x),Cn.range=(x,E)=>{const I=x.querySelector("input"),H=x.querySelector("output");return Yr(I,E.inputValue),I.type=E.input,Yr(H,E.inputValue),Ai(I,x,E),x},Cn.select=(x,E)=>{if(x.textContent="",E.inputPlaceholder){const I=document.createElement("option");ln(I,E.inputPlaceholder),I.value="",I.disabled=!0,I.selected=!0,x.appendChild(I)}return Ai(x,x,E),x},Cn.radio=x=>(x.textContent="",x),Cn.checkbox=(x,E)=>{const I=ui(rn(),"checkbox");I.value="1",I.id=W.checkbox,I.checked=Boolean(E.inputValue);const H=x.querySelector("span");return ln(H,E.inputPlaceholder),I},Cn.textarea=(x,E)=>{Yr(x,E.inputValue),Tn(x,E),Ai(x,x,E);return setTimeout(()=>{if("MutationObserver"in window){const H=parseInt(window.getComputedStyle(rn()).width);new MutationObserver(()=>{const We=x.offsetWidth+(H=>parseInt(window.getComputedStyle(H).marginLeft)+parseInt(window.getComputedStyle(H).marginRight))(x);rn().style.width=We>H?`${We}px`:null}).observe(x,{attributes:!0,attributeFilter:["style"]})}}),x};const Co=(x,E)=>{const I=fn();Hn(I,E,"htmlContainer"),E.html?(Me(E.html,I),si(I,"block")):E.text?(I.textContent=E.text,si(I,"block")):Wt(I),((x,E)=>{const I=rn(),H=Ke.innerParams.get(x),pe=!H||E.input!==H.input;Ne.forEach(We=>{const en=li(I,W[We]);on(We,E.inputAttributes),en.className=W[We],pe&&Wt(en)}),E.input&&(pe&&$e(E),_n(E))})(x,E)},ss=(x,E)=>{for(const I in Xe)E.icon!==I&&zi(x,Xe[I]);Ht(x,Xe[E.icon]),qo(x,E),mo(),Hn(x,E,"icon")},mo=()=>{const x=rn(),E=window.getComputedStyle(x).getPropertyValue("background-color"),I=x.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let H=0;H<I.length;H++)I[H].style.backgroundColor=E},Go=(x,E)=>{let H,I=x.innerHTML;E.iconHtml?H=go(E.iconHtml):"success"===E.icon?(H='\n  <div class="swal2-success-circular-line-left"></div>\n  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>\n  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>\n  <div class="swal2-success-circular-line-right"></div>\n',I=I.replace(/ style=".*?"/g,"")):H="error"===E.icon?'\n  <span class="swal2-x-mark">\n    <span class="swal2-x-mark-line-left"></span>\n    <span class="swal2-x-mark-line-right"></span>\n  </span>\n':go({question:"?",warning:"!",info:"i"}[E.icon]),I.trim()!==H.trim()&&ln(x,H)},qo=(x,E)=>{if(E.iconColor){x.style.color=E.iconColor,x.style.borderColor=E.iconColor;for(const I of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])Ar(x,I,"backgroundColor",E.iconColor);Ar(x,".swal2-success-ring","borderColor",E.iconColor)}},go=x=>`<div class="${W["icon-content"]}">${x}</div>`,ti=(x,E)=>{x.className=`${W.popup} ${ni(x)?E.showClass.popup:""}`,E.toast?(Ht([document.documentElement,document.body],W["toast-shown"]),Ht(x,W.toast)):Ht(x,W.modal),Hn(x,E,"popup"),"string"==typeof E.customClass&&Ht(x,E.customClass),E.icon&&Ht(x,W[`icon-${E.icon}`])},bi=x=>{const E=document.createElement("li");return Ht(E,W["progress-step"]),ln(E,x),E},ls=x=>{const E=document.createElement("li");return Ht(E,W["progress-step-line"]),x.progressStepsDistance&&Wi(E,"width",x.progressStepsDistance),E},Wo=(x,E)=>{((x,E)=>{const I=Yt(),H=rn();E.toast?(Wi(I,"width",E.width),H.style.width="100%",H.insertBefore(Mt(),an())):Wi(H,"width",E.width),Wi(H,"padding",E.padding),E.color&&(H.style.color=E.color),E.background&&(H.style.background=E.background),Wt(kt()),ti(H,E)})(0,E),cn(0,E),((x,E)=>{const I=tt();E.progressSteps&&0!==E.progressSteps.length?(si(I),I.textContent="",E.currentProgressStep>=E.progressSteps.length&&xt("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),E.progressSteps.forEach((H,pe)=>{const We=bi(H);if(I.appendChild(We),pe===E.currentProgressStep&&Ht(We,W["active-progress-step"]),pe!==E.progressSteps.length-1){const en=ls(E);I.appendChild(en)}})):Wt(I)})(0,E),((x,E)=>{const I=Ke.innerParams.get(x),H=an();I&&E.icon===I.icon?(Go(H,E),ss(H,E)):E.icon||E.iconHtml?E.icon&&-1===Object.keys(Xe).indexOf(E.icon)?(Tt(`Unknown icon! Expected "success", "error", "warning", "info" or "question", got "${E.icon}"`),Wt(H)):(si(H),Go(H,E),ss(H,E),Ht(H,E.showClass.icon)):Wt(H)})(x,E),((x,E)=>{const I=Zn();E.imageUrl?(si(I,""),I.setAttribute("src",E.imageUrl),I.setAttribute("alt",E.imageAlt),Wi(I,"width",E.imageWidth),Wi(I,"height",E.imageHeight),I.className=W.image,Hn(I,E,"image")):Wt(I)})(0,E),((x,E)=>{const I=Se();yr(I,E.title||E.titleText,"block"),E.title&&Me(E.title,I),E.titleText&&(I.innerText=E.titleText),Hn(I,E,"title")})(0,E),((x,E)=>{const I=bt();ln(I,E.closeButtonHtml),Hn(I,E,"closeButton"),yr(I,E.showCloseButton),I.setAttribute("aria-label",E.closeButtonAriaLabel)})(0,E),Co(x,E),Ce(0,E),((x,E)=>{const I=qe();yr(I,E.footer),E.footer&&Me(E.footer,I),Hn(I,E,"footer")})(0,E),"function"==typeof E.didRender&&E.didRender(rn())};function Po(){const x=Ke.innerParams.get(this);if(!x)return;const E=Ke.domCache.get(this);Wt(E.loader),On()?x.icon&&si(an()):Zo(E),zi([E.popup,E.actions],W.loading),E.popup.removeAttribute("aria-busy"),E.popup.removeAttribute("data-loading"),E.confirmButton.disabled=!1,E.denyButton.disabled=!1,E.cancelButton.disabled=!1}const Zo=x=>{const E=x.popup.getElementsByClassName(x.loader.getAttribute("data-button-to-replace"));E.length?si(E[0],"inline-block"):!ni(pt())&&!ni(En())&&!ni(zt())&&Wt(x.actions)};const hn=()=>pt()&&pt().click(),In=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),Ii=x=>{x.keydownTarget&&x.keydownHandlerAdded&&(x.keydownTarget.removeEventListener("keydown",x.keydownHandler,{capture:x.keydownListenerCapture}),x.keydownHandlerAdded=!1)},ki=(x,E)=>{const I=Ut();if(I.length)return(x+=E)===I.length?x=0:-1===x&&(x=I.length-1),void I[x].focus();rn().focus()},Vr=["ArrowRight","ArrowDown"],Li=["ArrowLeft","ArrowUp"],Yn=(x,E,I)=>{const H=Ke.innerParams.get(x);H&&(E.isComposing||229===E.keyCode||(H.stopKeydownPropagation&&E.stopPropagation(),"Enter"===E.key?co(x,E,H):"Tab"===E.key?Zr(E):[...Vr,...Li].includes(E.key)?Xo(E.key):"Escape"===E.key&&fr(E,H,I)))},co=(x,E,I)=>{if(Qt(I.allowEnterKey)&&E.target&&x.getInput()&&E.target instanceof HTMLElement&&E.target.outerHTML===x.getInput().outerHTML){if(["textarea","file"].includes(I.input))return;hn(),E.preventDefault()}},Zr=x=>{const E=x.target,I=Ut();let H=-1;for(let pe=0;pe<I.length;pe++)if(E===I[pe]){H=pe;break}ki(H,x.shiftKey?-1:1),x.stopPropagation(),x.preventDefault()},Xo=x=>{const E=pt(),I=En(),H=zt();if(document.activeElement instanceof HTMLElement&&![E,I,H].includes(document.activeElement))return;const We=Vr.includes(x)?"nextElementSibling":"previousElementSibling";let en=document.activeElement;for(let Ln=0;Ln<Bi().children.length;Ln++){if(en=en[We],!en)return;if(en instanceof HTMLButtonElement&&ni(en))break}en instanceof HTMLButtonElement&&en.focus()},fr=(x,E,I)=>{Qt(E.allowEscapeKey)&&(x.preventDefault(),I(In.esc))};var Xi={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};const Jr=()=>{Array.from(document.body.children).forEach(E=>{E.hasAttribute("data-previous-aria-hidden")?(E.setAttribute("aria-hidden",E.getAttribute("data-previous-aria-hidden")),E.removeAttribute("data-previous-aria-hidden")):E.removeAttribute("aria-hidden")})},Ro=()=>{const x=navigator.userAgent,E=!!x.match(/iPad/i)||!!x.match(/iPhone/i),I=!!x.match(/WebKit/i);E&&I&&!x.match(/CriOS/i)&&rn().scrollHeight>window.innerHeight-44&&(Yt().style.paddingBottom="44px")},Qr=()=>{const x=Yt();let E;x.ontouchstart=I=>{E=ri(I)},x.ontouchmove=I=>{E&&(I.preventDefault(),I.stopPropagation())}},ri=x=>{const E=x.target,I=Yt();return!ca(x)&&!ua(x)&&(E===I||!lo(I)&&E instanceof HTMLElement&&"INPUT"!==E.tagName&&"TEXTAREA"!==E.tagName&&!(lo(fn())&&fn().contains(E)))},ca=x=>x.touches&&x.touches.length&&"stylus"===x.touches[0].touchType,ua=x=>x.touches&&x.touches.length>1,eo=()=>{if(Rn(document.body,W.iosfix)){const x=parseInt(document.body.style.top,10);zi(document.body,W.iosfix),document.body.style.top="",document.body.scrollTop=-1*x}},to=()=>{null===ji.previousBodyPadding&&document.body.scrollHeight>window.innerHeight&&(ji.previousBodyPadding=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight=`${ji.previousBodyPadding+(()=>{const x=document.createElement("div");x.className=W["scrollbar-measure"],document.body.appendChild(x);const E=x.getBoundingClientRect().width-x.clientWidth;return document.body.removeChild(x),E})()}px`)},Hs=()=>{null!==ji.previousBodyPadding&&(document.body.style.paddingRight=`${ji.previousBodyPadding}px`,ji.previousBodyPadding=null)};function no(x,E,I,H){On()?Ko(x,H):(Ri(I).then(()=>Ko(x,H)),Ii(ht)),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?(E.setAttribute("style","display:none !important"),E.removeAttribute("class"),E.innerHTML=""):E.remove(),Ot()&&(Hs(),eo(),Jr()),function Ei(){zi([document.documentElement,document.body],[W.shown,W["height-auto"],W["no-backdrop"],W["toast-shown"]])}()}function cs(x){x=us(x);const E=Xi.swalPromiseResolve.get(this),I=$r(this);this.isAwaitingPromise()?x.isDismissed||(Xr(this),E(x)):I&&E(x)}const $r=x=>{const E=rn();if(!E)return!1;const I=Ke.innerParams.get(x);if(!I||Rn(E,I.hideClass.popup))return!1;zi(E,I.showClass.popup),Ht(E,I.hideClass.popup);const H=Yt();return zi(H,I.showClass.backdrop),Ht(H,I.hideClass.backdrop),ur(x,E,I),!0};const Xr=x=>{x.isAwaitingPromise()&&(Ke.awaitingPromise.delete(x),Ke.innerParams.get(x)||x._destroy())},us=x=>typeof x>"u"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},x),ur=(x,E,I)=>{const H=Yt(),pe=oe&&Vi(E);"function"==typeof I.willClose&&I.willClose(E),pe?Hr(x,E,H,I.returnFocus,I.didClose):no(x,H,I.returnFocus,I.didClose)},Hr=(x,E,I,H,pe)=>{ht.swalCloseEventFinishedCallback=no.bind(null,x,I,H,pe),E.addEventListener(oe,function(We){We.target===E&&(ht.swalCloseEventFinishedCallback(),delete ht.swalCloseEventFinishedCallback)})},Ko=(x,E)=>{setTimeout(()=>{"function"==typeof E&&E.bind(x.params)(),x._destroy()})};function Gs(x,E,I){const H=Ke.domCache.get(x);E.forEach(pe=>{H[pe].disabled=I})}function hs(x,E){if(x)if("radio"===x.type){const H=x.parentNode.parentNode.querySelectorAll("input");for(let pe=0;pe<H.length;pe++)H[pe].disabled=E}else x.disabled=E}const pr={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0},da=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","willClose"],Gr={},As=["allowOutsideClick","allowEnterKey","backdrop","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],qs=x=>Object.prototype.hasOwnProperty.call(pr,x),Yo=x=>-1!==da.indexOf(x),xs=x=>Gr[x],fa=x=>{qs(x)||xt(`Unknown parameter "${x}"`)},Jo=x=>{As.includes(x)&&xt(`The parameter "${x}" is incompatible with toasts`)},Oi=x=>{xs(x)&&_t(x,xs(x))};const Oa=x=>{const E={};return Object.keys(x).forEach(I=>{Yo(I)?E[I]=x[I]:xt(`Invalid parameter to update: ${I}`)}),E};const Ms=x=>{ds(x),delete x.params,delete ht.keydownHandler,delete ht.keydownTarget,delete ht.currentInstance},ds=x=>{x.isAwaitingPromise()?(sr(Ke,x),Ke.awaitingPromise.set(x,!0)):(sr(Xi,x),sr(Ke,x))},sr=(x,E)=>{for(const I in x)x[I].delete(E)};var Ao=Object.freeze({__proto__:null,_destroy:function ws(){const x=Ke.domCache.get(this),E=Ke.innerParams.get(this);E?(x.popup&&ht.swalCloseEventFinishedCallback&&(ht.swalCloseEventFinishedCallback(),delete ht.swalCloseEventFinishedCallback),"function"==typeof E.didDestroy&&E.didDestroy(),Ms(this)):ds(this)},close:cs,closeModal:cs,closePopup:cs,closeToast:cs,disableButtons:function ro(){Gs(this,["confirmButton","denyButton","cancelButton"],!0)},disableInput:function Ss(){hs(this.getInput(),!0)},disableLoading:Po,enableButtons:function ha(){Gs(this,["confirmButton","denyButton","cancelButton"],!1)},enableInput:function Ca(){hs(this.getInput(),!1)},getInput:function tn(x){const E=Ke.innerParams.get(x||this),I=Ke.domCache.get(x||this);return I?ui(I.popup,E.input):null},handleAwaitingPromise:Xr,hideLoading:Po,isAwaitingPromise:function io(){return!!Ke.awaitingPromise.get(this)},rejectPromise:function Mr(x){const E=Xi.swalPromiseReject.get(this);Xr(this),E&&E(x)},resetValidationMessage:function ea(){const x=Ke.domCache.get(this);x.validationMessage&&Wt(x.validationMessage);const E=this.getInput();E&&(E.removeAttribute("aria-invalid"),E.removeAttribute("aria-describedby"),zi(E,W.inputerror))},showValidationMessage:function Lo(x){const E=Ke.domCache.get(this),I=Ke.innerParams.get(this);ln(E.validationMessage,x),E.validationMessage.className=W["validation-message"],I.customClass&&I.customClass.validationMessage&&Ht(E.validationMessage,I.customClass.validationMessage),si(E.validationMessage);const H=this.getInput();H&&(H.setAttribute("aria-invalid",!0),H.setAttribute("aria-describedby",W["validation-message"]),qn(H),Ht(H,W.inputerror))},update:function yo(x){const E=rn(),I=Ke.innerParams.get(this);if(!E||Rn(E,I.hideClass.popup))return void xt("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");const H=Oa(x),pe=Object.assign({},I,H);Wo(this,pe),Ke.innerParams.set(this,pe),Object.defineProperties(this,{params:{value:Object.assign({},this.params,x),writable:!1,enumerable:!0}})}});const vr=x=>{let E=rn();E||new et,E=rn();const I=Mt();On()?Wt(an()):Oo(E,x),si(I),E.setAttribute("data-loading","true"),E.setAttribute("aria-busy","true"),E.focus()},Oo=(x,E)=>{const I=Bi(),H=Mt();!E&&ni(pt())&&(E=pt()),si(I),E&&(Wt(E),H.setAttribute("data-button-to-replace",E.className)),H.parentNode.insertBefore(H,E),Ht([x,I],W.loading)},vo=x=>x.checked?1:0,Is=x=>x.checked?x.value:null,Sa=x=>x.files.length?null!==x.getAttribute("multiple")?x.files:x.files[0]:null,mr=(x,E)=>{const I=rn(),H=pe=>{Ps[E.input](I,Ir(pe),E)};An(E.inputOptions)||bn(E.inputOptions)?(vr(pt()),It(E.inputOptions).then(pe=>{x.hideLoading(),H(pe)})):"object"==typeof E.inputOptions?H(E.inputOptions):Tt("Unexpected type of inputOptions! Expected object, Map or Promise, got "+typeof E.inputOptions)},Ws=(x,E)=>{const I=x.getInput();Wt(I),It(E.inputValue).then(H=>{I.value="number"===E.input?`${parseFloat(H)||0}`:`${H}`,si(I),I.focus(),x.hideLoading()}).catch(H=>{Tt(`Error in inputValue promise: ${H}`),I.value="",si(I),I.focus(),x.hideLoading()})},Ps={select:(x,E,I)=>{const H=li(x,W.select),pe=(We,en,Ln)=>{const zn=document.createElement("option");zn.value=Ln,ln(zn,en),zn.selected=mi(Ln,I.inputValue),We.appendChild(zn)};E.forEach(We=>{const en=We[0],Ln=We[1];if(Array.isArray(Ln)){const zn=document.createElement("optgroup");zn.label=en,zn.disabled=!1,H.appendChild(zn),Ln.forEach(Gi=>pe(zn,Gi[1],Gi[0]))}else pe(H,Ln,en)}),H.focus()},radio:(x,E,I)=>{const H=li(x,W.radio);E.forEach(We=>{const en=We[0],Ln=We[1],zn=document.createElement("input"),Gi=document.createElement("label");zn.type="radio",zn.name=W.radio,zn.value=en,mi(en,I.inputValue)&&(zn.checked=!0);const Ti=document.createElement("span");ln(Ti,Ln),Ti.className=W.label,Gi.appendChild(zn),Gi.appendChild(Ti),H.appendChild(Gi)});const pe=H.querySelectorAll("input");pe.length&&pe[0].focus()}},Ir=x=>{const E=[];return typeof Map<"u"&&x instanceof Map?x.forEach((I,H)=>{let pe=I;"object"==typeof pe&&(pe=Ir(pe)),E.push([H,pe])}):Object.keys(x).forEach(I=>{let H=x[I];"object"==typeof H&&(H=Ir(H)),E.push([I,H])}),E},mi=(x,E)=>E&&E.toString()===x.toString(),Aa=(x,E)=>{const I=Ke.innerParams.get(x);if(!I.input)return void Tt(`The "input" parameter is needed to be set when using returnInputValueOn${nn(E)}`);const H=((x,E)=>{const I=x.getInput();if(!I)return null;switch(E.input){case"checkbox":return vo(I);case"radio":return Is(I);case"file":return Sa(I);default:return E.inputAutoTrim?I.value.trim():I.value}})(x,I);I.inputValidator?Fo(x,H,E):x.getInput().checkValidity()?"deny"===E?Bo(x,H):ks(x,H):(x.enableButtons(),x.showValidationMessage(I.validationMessage))},Fo=(x,E,I)=>{const H=Ke.innerParams.get(x);x.disableInput(),Promise.resolve().then(()=>It(H.inputValidator(E,H.validationMessage))).then(We=>{x.enableButtons(),x.enableInput(),We?x.showValidationMessage(We):"deny"===I?Bo(x,E):ks(x,E)})},Bo=(x,E)=>{const I=Ke.innerParams.get(x||void 0);I.showLoaderOnDeny&&vr(En()),I.preDeny?(Ke.awaitingPromise.set(x||void 0,!0),Promise.resolve().then(()=>It(I.preDeny(E,I.validationMessage))).then(pe=>{!1===pe?(x.hideLoading(),Xr(x)):x.close({isDenied:!0,value:typeof pe>"u"?E:pe})}).catch(pe=>pa(x||void 0,pe))):x.close({isDenied:!0,value:E})},ho=(x,E)=>{x.close({isConfirmed:!0,value:E})},pa=(x,E)=>{x.rejectPromise(E)},ks=(x,E)=>{const I=Ke.innerParams.get(x||void 0);I.showLoaderOnConfirm&&vr(),I.preConfirm?(x.resetValidationMessage(),Ke.awaitingPromise.set(x||void 0,!0),Promise.resolve().then(()=>It(I.preConfirm(E,I.validationMessage))).then(pe=>{ni(kt())||!1===pe?(x.hideLoading(),Xr(x)):ho(x,typeof pe>"u"?E:pe)}).catch(pe=>pa(x||void 0,pe))):ho(x,E)},Ki=(x,E,I)=>{E.popup.onclick=()=>{const H=Ke.innerParams.get(x);H&&(Ha(H)||H.timer||H.input)||I(In.close)}},Ha=x=>x.showConfirmButton||x.showDenyButton||x.showCancelButton||x.showCloseButton;let fs=!1;const ta=x=>{x.popup.onmousedown=()=>{x.container.onmouseup=function(E){x.container.onmouseup=void 0,E.target===x.container&&(fs=!0)}}},na=x=>{x.container.onmousedown=()=>{x.popup.onmouseup=function(E){x.popup.onmouseup=void 0,(E.target===x.popup||x.popup.contains(E.target))&&(fs=!0)}}},Fa=(x,E,I)=>{E.container.onclick=H=>{const pe=Ke.innerParams.get(x);fs?fs=!1:H.target===E.container&&Qt(pe.allowOutsideClick)&&I(In.backdrop)}},ps=x=>x instanceof Element||(x=>"object"==typeof x&&x.jquery)(x);const hr=()=>{if(ht.timeout)return(()=>{const x=at(),E=parseInt(window.getComputedStyle(x).width);x.style.removeProperty("transition"),x.style.width="100%";const I=parseInt(window.getComputedStyle(x).width);x.style.width=E/I*100+"%"})(),ht.timeout.stop()},es=()=>{if(ht.timeout){const x=ht.timeout.start();return zr(x),x}};let ga=!1;const Es={};const ia=x=>{for(let E=x.target;E&&E!==document;E=E.parentNode)for(const I in Es){const H=E.getAttribute(I);if(H)return void Es[I].fire({template:H})}};var oo=Object.freeze({__proto__:null,argsToParams:x=>{const E={};return"object"!=typeof x[0]||ps(x[0])?["title","html","icon"].forEach((I,H)=>{const pe=x[H];"string"==typeof pe||ps(pe)?E[I]=pe:void 0!==pe&&Tt(`Unexpected type of ${I}! Expected "string" or "Element", got ${typeof pe}`)}):Object.assign(E,x[0]),E},bindClickHandler:function _a(){Es[arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data-swal-template"]=this,ga||(document.body.addEventListener("click",ia),ga=!0)},clickCancel:()=>zt()&&zt().click(),clickConfirm:hn,clickDeny:()=>En()&&En().click(),enableLoading:vr,fire:function Pi(){for(var E=arguments.length,I=new Array(E),H=0;H<E;H++)I[H]=arguments[H];return new this(...I)},getActions:Bi,getCancelButton:zt,getCloseButton:bt,getConfirmButton:pt,getContainer:Yt,getDenyButton:En,getFocusableElements:Ut,getFooter:qe,getHtmlContainer:fn,getIcon:an,getIconContent:()=>pn(W["icon-content"]),getImage:Zn,getInputLabel:()=>pn(W["input-label"]),getLoader:Mt,getPopup:rn,getProgressSteps:tt,getTimerLeft:()=>ht.timeout&&ht.timeout.getTimerLeft(),getTimerProgressBar:at,getTitle:Se,getValidationMessage:kt,increaseTimer:x=>{if(ht.timeout){const E=ht.timeout.increase(x);return zr(E,!0),E}},isDeprecatedParameter:xs,isLoading:()=>rn().hasAttribute("data-loading"),isTimerRunning:()=>ht.timeout&&ht.timeout.isRunning(),isUpdatableParameter:Yo,isValidParameter:qs,isVisible:()=>ni(rn()),mixin:function Ba(x){return class E extends(this){_main(H,pe){return super._main(H,Object.assign({},x,pe))}}},resumeTimer:es,showLoading:vr,stopTimer:hr,toggleTimer:()=>{const x=ht.timeout;return x&&(x.running?hr():es())}});class zo{constructor(E,I){this.callback=E,this.remaining=I,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=(new Date).getTime()-this.started.getTime()),this.remaining}increase(E){const I=this.running;return I&&this.stop(),this.remaining+=E,I&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const ra=["swal-title","swal-html","swal-footer"],R=x=>{const E={};return Array.from(x.querySelectorAll("swal-param")).forEach(H=>{mt(H,["name","value"]);const pe=H.getAttribute("name"),We=H.getAttribute("value");E[pe]="boolean"==typeof pr[pe]?"false"!==We:"object"==typeof pr[pe]?JSON.parse(We):We}),E},L=x=>{const E={};return Array.from(x.querySelectorAll("swal-function-param")).forEach(H=>{const pe=H.getAttribute("name"),We=H.getAttribute("value");E[pe]=new Function(`return ${We}`)()}),E},G=x=>{const E={};return Array.from(x.querySelectorAll("swal-button")).forEach(H=>{mt(H,["type","color","aria-label"]);const pe=H.getAttribute("type");E[`${pe}ButtonText`]=H.innerHTML,E[`show${nn(pe)}Button`]=!0,H.hasAttribute("color")&&(E[`${pe}ButtonColor`]=H.getAttribute("color")),H.hasAttribute("aria-label")&&(E[`${pe}ButtonAriaLabel`]=H.getAttribute("aria-label"))}),E},se=x=>{const E={},I=x.querySelector("swal-image");return I&&(mt(I,["src","width","height","alt"]),I.hasAttribute("src")&&(E.imageUrl=I.getAttribute("src")),I.hasAttribute("width")&&(E.imageWidth=I.getAttribute("width")),I.hasAttribute("height")&&(E.imageHeight=I.getAttribute("height")),I.hasAttribute("alt")&&(E.imageAlt=I.getAttribute("alt"))),E},me=x=>{const E={},I=x.querySelector("swal-icon");return I&&(mt(I,["type","color"]),I.hasAttribute("type")&&(E.icon=I.getAttribute("type")),I.hasAttribute("color")&&(E.iconColor=I.getAttribute("color")),E.iconHtml=I.innerHTML),E},Oe=x=>{const E={},I=x.querySelector("swal-input");I&&(mt(I,["type","label","placeholder","value"]),E.input=I.getAttribute("type")||"text",I.hasAttribute("label")&&(E.inputLabel=I.getAttribute("label")),I.hasAttribute("placeholder")&&(E.inputPlaceholder=I.getAttribute("placeholder")),I.hasAttribute("value")&&(E.inputValue=I.getAttribute("value")));const H=Array.from(x.querySelectorAll("swal-input-option"));return H.length&&(E.inputOptions={},H.forEach(pe=>{mt(pe,["value"]);const We=pe.getAttribute("value");E.inputOptions[We]=pe.innerHTML})),E},Ue=(x,E)=>{const I={};for(const H in E){const pe=E[H],We=x.querySelector(pe);We&&(mt(We,[]),I[pe.replace(/^swal-/,"")]=We.innerHTML.trim())}return I},st=x=>{const E=ra.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(x.children).forEach(I=>{const H=I.tagName.toLowerCase();E.includes(H)||xt(`Unrecognized element <${H}>`)})},mt=(x,E)=>{Array.from(x.attributes).forEach(I=>{-1===E.indexOf(I.name)&&xt([`Unrecognized attribute "${I.name}" on <${x.tagName.toLowerCase()}>.`,E.length?`Allowed attributes are: ${E.join(", ")}`:"To set the value, use HTML within the element."])})},Sn=x=>{const E=Yt(),I=rn();"function"==typeof x.willOpen&&x.willOpen(I);const pe=window.getComputedStyle(document.body).overflowY;Jn(E,I,x),setTimeout(()=>{oi(E,I)},10),Ot()&&(Un(E,x.scrollbarPadding,pe),Array.from(document.body.children).forEach(E=>{E===Yt()||E.contains(Yt())||(E.hasAttribute("aria-hidden")&&E.setAttribute("data-previous-aria-hidden",E.getAttribute("aria-hidden")),E.setAttribute("aria-hidden","true"))})),!On()&&!ht.previousActiveElement&&(ht.previousActiveElement=document.activeElement),"function"==typeof x.didOpen&&setTimeout(()=>x.didOpen(I)),zi(E,W["no-transition"])},ci=x=>{const E=rn();if(x.target!==E)return;const I=Yt();E.removeEventListener(oe,ci),I.style.overflowY="auto"},oi=(x,E)=>{oe&&Vi(E)?(x.style.overflowY="hidden",E.addEventListener(oe,ci)):x.style.overflowY="auto"},Un=(x,E,I)=>{(()=>{if((/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!Rn(document.body,W.iosfix)){const E=document.body.scrollTop;document.body.style.top=-1*E+"px",Ht(document.body,W.iosfix),Qr(),Ro()}})(),E&&"hidden"!==I&&to(),setTimeout(()=>{x.scrollTop=0})},Jn=(x,E,I)=>{Ht(x,I.showClass.backdrop),E.style.setProperty("opacity","0","important"),si(E,"grid"),setTimeout(()=>{Ht(E,I.showClass.popup),E.style.removeProperty("opacity")},10),Ht([document.documentElement,document.body],W.shown),I.heightAuto&&I.backdrop&&!I.toast&&Ht([document.documentElement,document.body],W["height-auto"])};var Ni={email:(x,E)=>/^[a-zA-Z0-9.+_-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]{2,24}$/.test(x)?Promise.resolve():Promise.resolve(E||"Invalid email address"),url:(x,E)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(x)?Promise.resolve():Promise.resolve(E||"Invalid URL")};function tr(x){(function xi(x){x.inputValidator||Object.keys(Ni).forEach(E=>{x.input===E&&(x.inputValidator=Ni[E])})})(x),x.showLoaderOnConfirm&&!x.preConfirm&&xt("showLoaderOnConfirm is set to true, but preConfirm is not defined.\nshowLoaderOnConfirm should be used together with preConfirm, see usage example:\nhttps://sweetalert2.github.io/#ajax-request"),function gr(x){(!x.target||"string"==typeof x.target&&!document.querySelector(x.target)||"string"!=typeof x.target&&!x.target.appendChild)&&(xt('Target parameter is not valid, defaulting to "body"'),x.target="body")}(x),"string"==typeof x.title&&(x.title=x.title.split("\n").join("<br />")),xe(x)}let Wn;class dr{constructor(){if(typeof window>"u")return;Wn=this;for(var E=arguments.length,I=new Array(E),H=0;H<E;H++)I[H]=arguments[H];const pe=Object.freeze(this.constructor.argsToParams(I));Object.defineProperties(this,{params:{value:pe,writable:!1,enumerable:!0,configurable:!0}});const We=Wn._main(Wn.params);Ke.promise.set(this,We)}_main(E){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(x=>{!1===x.backdrop&&x.allowOutsideClick&&xt('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`');for(const E in x)fa(E),x.toast&&Jo(E),Oi(E)})(Object.assign({},I,E)),ht.currentInstance&&(ht.currentInstance._destroy(),Ot()&&Jr()),ht.currentInstance=Wn;const H=br(E,I);tr(H),Object.freeze(H),ht.timeout&&(ht.timeout.stop(),delete ht.timeout),clearTimeout(ht.restoreFocusTimeout);const pe=N(Wn);return Wo(Wn,H),Ke.innerParams.set(Wn,H),Si(Wn,pe,H)}then(E){return Ke.promise.get(this).then(E)}finally(E){return Ke.promise.get(this).finally(E)}}const Si=(x,E,I)=>new Promise((H,pe)=>{const We=en=>{x.close({isDismissed:!0,dismiss:en})};Xi.swalPromiseResolve.set(x,H),Xi.swalPromiseReject.set(x,pe),E.confirmButton.onclick=()=>{(x=>{const E=Ke.innerParams.get(x);x.disableButtons(),E.input?Aa(x,"confirm"):ks(x,!0)})(x)},E.denyButton.onclick=()=>{(x=>{const E=Ke.innerParams.get(x);x.disableButtons(),E.returnInputValueOnDeny?Aa(x,"deny"):Bo(x,!1)})(x)},E.cancelButton.onclick=()=>{((x,E)=>{x.disableButtons(),E(In.cancel)})(x,We)},E.closeButton.onclick=()=>{We(In.close)},((x,E,I)=>{Ke.innerParams.get(x).toast?Ki(x,E,I):(ta(E),na(E),Fa(x,E,I))})(x,E,We),((x,E,I,H)=>{Ii(E),I.toast||(E.keydownHandler=pe=>Yn(x,pe,H),E.keydownTarget=I.keydownListenerCapture?window:rn(),E.keydownListenerCapture=I.keydownListenerCapture,E.keydownTarget.addEventListener("keydown",E.keydownHandler,{capture:E.keydownListenerCapture}),E.keydownHandlerAdded=!0)})(x,ht,I,We),((x,E)=>{"select"===E.input||"radio"===E.input?mr(x,E):["text","email","number","tel","textarea"].includes(E.input)&&(An(E.inputValue)||bn(E.inputValue))&&(vr(pt()),Ws(x,E))})(x,I),Sn(I),J(ht,I,We),j(E,I),setTimeout(()=>{E.container.scrollTop=0})}),br=(x,E)=>{const I=(x=>{const E="string"==typeof x.template?document.querySelector(x.template):x.template;if(!E)return{};const I=E.content;return st(I),Object.assign(R(I),L(I),G(I),se(I),me(I),Oe(I),Ue(I,ra))})(x),H=Object.assign({},pr,E,I,x);return H.showClass=Object.assign({},pr.showClass,H.showClass),H.hideClass=Object.assign({},pr.hideClass,H.hideClass),H},N=x=>{const E={popup:rn(),container:Yt(),actions:Bi(),confirmButton:pt(),denyButton:En(),cancelButton:zt(),loader:Mt(),closeButton:bt(),validationMessage:kt(),progressSteps:tt()};return Ke.domCache.set(x,E),E},J=(x,E,I)=>{const H=at();Wt(H),E.timer&&(x.timeout=new zo(()=>{I("timer"),delete x.timeout},E.timer),E.timerProgressBar&&(si(H),Hn(H,E,"timerProgressBar"),setTimeout(()=>{x.timeout&&x.timeout.running&&zr(E.timer)})))},j=(x,E)=>{if(!E.toast){if(!Qt(E.allowEnterKey))return void Ae();ue(x,E)||ki(-1,1)}},ue=(x,E)=>E.focusDeny&&ni(x.denyButton)?(x.denyButton.focus(),!0):E.focusCancel&&ni(x.cancelButton)?(x.cancelButton.focus(),!0):!(!E.focusConfirm||!ni(x.confirmButton)||(x.confirmButton.focus(),0)),Ae=()=>{document.activeElement instanceof HTMLElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur()};if(typeof window<"u"&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|xn--p1ai)$/)){const x=new Date,E=localStorage.getItem("swal-initiation");E?(x.getTime()-Date.parse(E))/864e5>3&&setTimeout(()=>{document.body.style.pointerEvents="none";const I=document.createElement("audio");I.src="https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3",I.loop=!0,document.body.appendChild(I),setTimeout(()=>{I.play().catch(()=>{})},2500)},500):localStorage.setItem("swal-initiation",`${x}`)}Object.assign(dr.prototype,Ao),Object.assign(dr,oo),Object.keys(Ao).forEach(x=>{dr[x]=function(){if(Wn)return Wn[x](...arguments)}}),dr.DismissReason=In,dr.version="11.7.5";const et=dr;return et.default=et,et}(),typeof this<"u"&&this.Sweetalert2&&(this.swal=this.sweetAlert=this.Swal=this.SweetAlert=this.Sweetalert2),typeof document<"u"&&function(Ke,Te){var Y=Ke.createElement("style");if(Ke.getElementsByTagName("head")[0].appendChild(Y),Y.styleSheet)Y.styleSheet.disabled||(Y.styleSheet.cssText=Te);else try{Y.innerHTML=Te}catch{Y.innerText=Te}}(document,'.swal2-popup.swal2-toast{box-sizing:border-box;grid-column:1/4 !important;grid-row:1/4 !important;grid-template-columns:min-content auto min-content;padding:1em;overflow-y:hidden;background:#fff;box-shadow:0 0 1px rgba(0,0,0,.075),0 1px 2px rgba(0,0,0,.075),1px 2px 4px rgba(0,0,0,.075),1px 3px 8px rgba(0,0,0,.075),2px 4px 16px rgba(0,0,0,.075);pointer-events:all}.swal2-popup.swal2-toast>*{grid-column:2}.swal2-popup.swal2-toast .swal2-title{margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-loading{justify-content:center}.swal2-popup.swal2-toast .swal2-input{height:2em;margin:.5em;font-size:1em}.swal2-popup.swal2-toast .swal2-validation-message{font-size:1em}.swal2-popup.swal2-toast .swal2-footer{margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-popup.swal2-toast .swal2-close{grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-popup.swal2-toast .swal2-html-container{margin:.5em 1em;padding:0;overflow:initial;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-html-container:empty{padding:0}.swal2-popup.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-popup.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-popup.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:bold}.swal2-popup.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-popup.swal2-toast .swal2-actions{justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-popup.swal2-toast .swal2-styled{margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-popup.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;transform:rotate(45deg);border-radius:50%}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.8em;left:-0.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-popup.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-toast-animate-success-line-tip .75s}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-toast-animate-success-line-long .75s}.swal2-popup.swal2-toast.swal2-show{animation:swal2-toast-show .5s}.swal2-popup.swal2-toast.swal2-hide{animation:swal2-toast-hide .1s forwards}.swal2-container{display:grid;position:fixed;z-index:1060;inset:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(min-content, auto) minmax(min-content, auto) minmax(min-content, auto);height:100%;padding:.625em;overflow-x:hidden;transition:background-color .1s;-webkit-overflow-scrolling:touch}.swal2-container.swal2-backdrop-show,.swal2-container.swal2-noanimation{background:rgba(0,0,0,.4)}.swal2-container.swal2-backdrop-hide{background:rgba(0,0,0,0) !important}.swal2-container.swal2-top-start,.swal2-container.swal2-center-start,.swal2-container.swal2-bottom-start{grid-template-columns:minmax(0, 1fr) auto auto}.swal2-container.swal2-top,.swal2-container.swal2-center,.swal2-container.swal2-bottom{grid-template-columns:auto minmax(0, 1fr) auto}.swal2-container.swal2-top-end,.swal2-container.swal2-center-end,.swal2-container.swal2-bottom-end{grid-template-columns:auto auto minmax(0, 1fr)}.swal2-container.swal2-top-start>.swal2-popup{align-self:start}.swal2-container.swal2-top>.swal2-popup{grid-column:2;align-self:start;justify-self:center}.swal2-container.swal2-top-end>.swal2-popup,.swal2-container.swal2-top-right>.swal2-popup{grid-column:3;align-self:start;justify-self:end}.swal2-container.swal2-center-start>.swal2-popup,.swal2-container.swal2-center-left>.swal2-popup{grid-row:2;align-self:center}.swal2-container.swal2-center>.swal2-popup{grid-column:2;grid-row:2;align-self:center;justify-self:center}.swal2-container.swal2-center-end>.swal2-popup,.swal2-container.swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;align-self:center;justify-self:end}.swal2-container.swal2-bottom-start>.swal2-popup,.swal2-container.swal2-bottom-left>.swal2-popup{grid-column:1;grid-row:3;align-self:end}.swal2-container.swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;justify-self:center;align-self:end}.swal2-container.swal2-bottom-end>.swal2-popup,.swal2-container.swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;align-self:end;justify-self:end}.swal2-container.swal2-grow-row>.swal2-popup,.swal2-container.swal2-grow-fullscreen>.swal2-popup{grid-column:1/4;width:100%}.swal2-container.swal2-grow-column>.swal2-popup,.swal2-container.swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}.swal2-container.swal2-no-transition{transition:none !important}.swal2-popup{display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0, 100%);width:32em;max-width:100%;padding:0 0 1.25em;border:none;border-radius:5px;background:#fff;color:#545454;font-family:inherit;font-size:1rem}.swal2-popup:focus{outline:none}.swal2-popup.swal2-loading{overflow-y:hidden}.swal2-title{position:relative;max-width:100%;margin:0;padding:.8em 1em 0;color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word}.swal2-actions{display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:center;width:auto;margin:1.25em auto 0;padding:0}.swal2-actions:not(.swal2-loading) .swal2-styled[disabled]{opacity:.4}.swal2-actions:not(.swal2-loading) .swal2-styled:hover{background-image:linear-gradient(rgba(0, 0, 0, 0.1), rgba(0, 0, 0, 0.1))}.swal2-actions:not(.swal2-loading) .swal2-styled:active{background-image:linear-gradient(rgba(0, 0, 0, 0.2), rgba(0, 0, 0, 0.2))}.swal2-loader{display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 rgba(0,0,0,0) #2778c4 rgba(0,0,0,0)}.swal2-styled{margin:.3125em;padding:.625em 1.1em;transition:box-shadow .1s;box-shadow:0 0 0 3px rgba(0,0,0,0);font-weight:500}.swal2-styled:not([disabled]){cursor:pointer}.swal2-styled.swal2-confirm{border:0;border-radius:.25em;background:initial;background-color:#7066e0;color:#fff;font-size:1em}.swal2-styled.swal2-confirm:focus{box-shadow:0 0 0 3px rgba(112,102,224,.5)}.swal2-styled.swal2-deny{border:0;border-radius:.25em;background:initial;background-color:#dc3741;color:#fff;font-size:1em}.swal2-styled.swal2-deny:focus{box-shadow:0 0 0 3px rgba(220,55,65,.5)}.swal2-styled.swal2-cancel{border:0;border-radius:.25em;background:initial;background-color:#6e7881;color:#fff;font-size:1em}.swal2-styled.swal2-cancel:focus{box-shadow:0 0 0 3px rgba(110,120,129,.5)}.swal2-styled.swal2-default-outline:focus{box-shadow:0 0 0 3px rgba(100,150,200,.5)}.swal2-styled:focus{outline:none}.swal2-styled::-moz-focus-inner{border:0}.swal2-footer{justify-content:center;margin:1em 0 0;padding:1em 1em 0;border-top:1px solid #eee;color:inherit;font-size:1em}.swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto !important;overflow:hidden;border-bottom-right-radius:5px;border-bottom-left-radius:5px}.swal2-timer-progress-bar{width:100%;height:.25em;background:rgba(0,0,0,.2)}.swal2-image{max-width:100%;margin:2em auto 1em}.swal2-close{z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:color .1s,box-shadow .1s;border:none;border-radius:5px;background:rgba(0,0,0,0);color:#ccc;font-family:monospace;font-size:2.5em;cursor:pointer;justify-self:end}.swal2-close:hover{transform:none;background:rgba(0,0,0,0);color:#f27474}.swal2-close:focus{outline:none;box-shadow:inset 0 0 0 3px rgba(100,150,200,.5)}.swal2-close::-moz-focus-inner{border:0}.swal2-html-container{z-index:1;justify-content:center;margin:1em 1.6em .3em;padding:0;overflow:auto;color:inherit;font-size:1.125em;font-weight:normal;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word}.swal2-input,.swal2-file,.swal2-textarea,.swal2-select,.swal2-radio,.swal2-checkbox{margin:1em 2em 3px}.swal2-input,.swal2-file,.swal2-textarea{box-sizing:border-box;width:auto;transition:border-color .1s,box-shadow .1s;border:1px solid #d9d9d9;border-radius:.1875em;background:rgba(0,0,0,0);box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(0,0,0,0);color:inherit;font-size:1.125em}.swal2-input.swal2-inputerror,.swal2-file.swal2-inputerror,.swal2-textarea.swal2-inputerror{border-color:#f27474 !important;box-shadow:0 0 2px #f27474 !important}.swal2-input:focus,.swal2-file:focus,.swal2-textarea:focus{border:1px solid #b4dbed;outline:none;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(100,150,200,.5)}.swal2-input::placeholder,.swal2-file::placeholder,.swal2-textarea::placeholder{color:#ccc}.swal2-range{margin:1em 2em 3px;background:#fff}.swal2-range input{width:80%}.swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}.swal2-range input,.swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}.swal2-input{height:2.625em;padding:0 .75em}.swal2-file{width:75%;margin-right:auto;margin-left:auto;background:rgba(0,0,0,0);font-size:1.125em}.swal2-textarea{height:6.75em;padding:.75em}.swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:rgba(0,0,0,0);color:inherit;font-size:1.125em}.swal2-radio,.swal2-checkbox{align-items:center;justify-content:center;background:#fff;color:inherit}.swal2-radio label,.swal2-checkbox label{margin:0 .6em;font-size:1.125em}.swal2-radio input,.swal2-checkbox input{flex-shrink:0;margin:0 .4em}.swal2-input-label{display:flex;justify-content:center;margin:1em auto 0}.swal2-validation-message{align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:#f0f0f0;color:#666;font-size:1em;font-weight:300}.swal2-validation-message::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}.swal2-icon{position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;border:0.25em solid rgba(0,0,0,0);border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;user-select:none}.swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}.swal2-icon.swal2-error{border-color:#f27474;color:#f27474}.swal2-icon.swal2-error .swal2-x-mark{position:relative;flex-grow:1}.swal2-icon.swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}.swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}.swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}.swal2-icon.swal2-error.swal2-icon-show{animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-error.swal2-icon-show .swal2-x-mark{animation:swal2-animate-error-x-mark .5s}.swal2-icon.swal2-warning{border-color:#facea8;color:#f8bb86}.swal2-icon.swal2-warning.swal2-icon-show{animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-warning.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .5s}.swal2-icon.swal2-info{border-color:#9de0f6;color:#3fc3ee}.swal2-icon.swal2-info.swal2-icon-show{animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-info.swal2-icon-show .swal2-icon-content{animation:swal2-animate-i-mark .8s}.swal2-icon.swal2-question{border-color:#c9dae1;color:#87adbd}.swal2-icon.swal2-question.swal2-icon-show{animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-question.swal2-icon-show .swal2-icon-content{animation:swal2-animate-question-mark .8s}.swal2-icon.swal2-success{border-color:#a5dc86;color:#a5dc86}.swal2-icon.swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;transform:rotate(45deg);border-radius:50%}.swal2-icon.swal2-success [class^=swal2-success-circular-line][class$=left]{top:-0.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}.swal2-icon.swal2-success [class^=swal2-success-circular-line][class$=right]{top:-0.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}.swal2-icon.swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-0.25em;left:-0.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}.swal2-icon.swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}.swal2-icon.swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}.swal2-icon.swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}.swal2-icon.swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-line-tip{animation:swal2-animate-success-line-tip .75s}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-line-long{animation:swal2-animate-success-line-long .75s}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-circular-line-right{animation:swal2-rotate-success-circular-line 4.25s ease-in}.swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:rgba(0,0,0,0);font-weight:600}.swal2-progress-steps li{display:inline-block;position:relative}.swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:#add8e6;color:#fff}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:#add8e6}.swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}[class^=swal2]{-webkit-tap-highlight-color:rgba(0,0,0,0)}.swal2-show{animation:swal2-show .3s}.swal2-hide{animation:swal2-hide .15s forwards}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}@keyframes swal2-toast-show{0%{transform:translateY(-0.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(0.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0deg)}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-0.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}@keyframes swal2-show{0%{transform:scale(0.7)}45%{transform:scale(1.05)}80%{transform:scale(0.95)}100%{transform:scale(1)}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(0.5);opacity:0}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-0.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(0.4);opacity:0}50%{margin-top:1.625em;transform:scale(0.4);opacity:0}80%{margin-top:-0.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0deg);opacity:1}}@keyframes swal2-rotate-loading{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto !important}body.swal2-no-backdrop .swal2-container{background-color:rgba(0,0,0,0) !important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px rgba(0,0,0,.4)}@media print{body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow-y:scroll !important}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown) .swal2-container{position:static !important}}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:rgba(0,0,0,0);pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{inset:0 auto auto 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{inset:0 0 auto auto}body.swal2-toast-shown .swal2-container.swal2-top-start,body.swal2-toast-shown .swal2-container.swal2-top-left{inset:0 auto auto 0}body.swal2-toast-shown .swal2-container.swal2-center-start,body.swal2-toast-shown .swal2-container.swal2-center-left{inset:50% auto auto 0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{inset:50% auto auto 50%;transform:translate(-50%, -50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{inset:50% 0 auto auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-start,body.swal2-toast-shown .swal2-container.swal2-bottom-left{inset:auto auto 0 0}body.swal2-toast-shown .swal2-container.swal2-bottom{inset:auto auto 0 50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{inset:auto 0 0 auto}')},2454:function(ii){ii.exports=function(){"use strict";var Ke={awaitingPromise:new WeakMap,promise:new WeakMap,innerParams:new WeakMap,domCache:new WeakMap};const Y=x=>{const E={};for(const I in x)E[x[I]]="swal2-"+x[I];return E},W=Y(["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","default-outline","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error"]),Xe=Y(["success","warning","info","question","error"]),c="SweetAlert2:",nn=x=>x.charAt(0).toUpperCase()+x.slice(1),xt=x=>{console.warn(`${c} ${"object"==typeof x?x.join(" "):x}`)},Tt=x=>{console.error(`${c} ${x}`)},Et=[],_t=(x,E)=>{(x=>{Et.includes(x)||(Et.push(x),xt(x))})(`"${x}" is deprecated and will be removed in the next major release. Please use "${E}" instead.`)},Qt=x=>"function"==typeof x?x():x,An=x=>x&&"function"==typeof x.toPromise,It=x=>An(x)?x.toPromise():Promise.resolve(x),bn=x=>x&&Promise.resolve(x)===x,Yt=()=>document.body.querySelector(`.${W.container}`),Nn=x=>{const E=Yt();return E?E.querySelector(x):null},pn=x=>Nn(`.${x}`),rn=()=>pn(W.popup),an=()=>pn(W.icon),Se=()=>pn(W.title),fn=()=>pn(W["html-container"]),Zn=()=>pn(W.image),tt=()=>pn(W["progress-steps"]),kt=()=>pn(W["validation-message"]),pt=()=>Nn(`.${W.actions} .${W.confirm}`),zt=()=>Nn(`.${W.actions} .${W.cancel}`),En=()=>Nn(`.${W.actions} .${W.deny}`),Mt=()=>Nn(`.${W.loader}`),Bi=()=>pn(W.actions),qe=()=>pn(W.footer),at=()=>pn(W["timer-progress-bar"]),bt=()=>pn(W.close),Ut=()=>{const x=Array.from(rn().querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])')).sort((I,H)=>{const pe=parseInt(I.getAttribute("tabindex")),We=parseInt(H.getAttribute("tabindex"));return pe>We?1:pe<We?-1:0}),E=Array.from(rn().querySelectorAll('\n  a[href],\n  area[href],\n  input:not([disabled]),\n  select:not([disabled]),\n  textarea:not([disabled]),\n  button:not([disabled]),\n  iframe,\n  object,\n  embed,\n  [tabindex="0"],\n  [contenteditable],\n  audio[controls],\n  video[controls],\n  summary\n')).filter(I=>"-1"!==I.getAttribute("tabindex"));return(x=>{const E=[];for(let I=0;I<x.length;I++)-1===E.indexOf(x[I])&&E.push(x[I]);return E})(x.concat(E)).filter(I=>ni(I))},Ot=()=>Rn(document.body,W.shown)&&!Rn(document.body,W["toast-shown"])&&!Rn(document.body,W["no-backdrop"]),On=()=>rn()&&Rn(rn(),W.toast),ji={previousBodyPadding:null},ln=(x,E)=>{if(x.textContent="",E){const H=(new DOMParser).parseFromString(E,"text/html");Array.from(H.querySelector("head").childNodes).forEach(pe=>{x.appendChild(pe)}),Array.from(H.querySelector("body").childNodes).forEach(pe=>{pe instanceof HTMLVideoElement||pe instanceof HTMLAudioElement?x.appendChild(pe.cloneNode(!0)):x.appendChild(pe)})}},Rn=(x,E)=>{if(!E)return!1;const I=E.split(/\s+/);for(let H=0;H<I.length;H++)if(!x.classList.contains(I[H]))return!1;return!0},Hn=(x,E,I)=>{if(((x,E)=>{Array.from(x.classList).forEach(I=>{!Object.values(W).includes(I)&&!Object.values(Xe).includes(I)&&!Object.values(E.showClass).includes(I)&&x.classList.remove(I)})})(x,E),E.customClass&&E.customClass[I]){if("string"!=typeof E.customClass[I]&&!E.customClass[I].forEach)return void xt(`Invalid type of customClass.${I}! Expected string or iterable object, got "${typeof E.customClass[I]}"`);Ht(x,E.customClass[I])}},ui=(x,E)=>{if(!E)return null;switch(E){case"select":case"textarea":case"file":return x.querySelector(`.${W.popup} > .${W[E]}`);case"checkbox":return x.querySelector(`.${W.popup} > .${W.checkbox} input`);case"radio":return x.querySelector(`.${W.popup} > .${W.radio} input:checked`)||x.querySelector(`.${W.popup} > .${W.radio} input:first-child`);case"range":return x.querySelector(`.${W.popup} > .${W.range} input`);default:return x.querySelector(`.${W.popup} > .${W.input}`)}},qn=x=>{if(x.focus(),"file"!==x.type){const E=x.value;x.value="",x.value=E}},hi=(x,E,I)=>{!x||!E||("string"==typeof E&&(E=E.split(/\s+/).filter(Boolean)),E.forEach(H=>{Array.isArray(x)?x.forEach(pe=>{I?pe.classList.add(H):pe.classList.remove(H)}):I?x.classList.add(H):x.classList.remove(H)}))},Ht=(x,E)=>{hi(x,E,!0)},zi=(x,E)=>{hi(x,E,!1)},li=(x,E)=>{const I=Array.from(x.children);for(let H=0;H<I.length;H++){const pe=I[H];if(pe instanceof HTMLElement&&Rn(pe,E))return pe}},Wi=(x,E,I)=>{I===`${parseInt(I)}`&&(I=parseInt(I)),I||0===parseInt(I)?x.style[E]="number"==typeof I?`${I}px`:I:x.style.removeProperty(E)},si=function(x){x.style.display=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flex"},Wt=x=>{x.style.display="none"},Ar=(x,E,I,H)=>{const pe=x.querySelector(E);pe&&(pe.style[I]=H)},yr=function(x,E){E?si(x,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"flex"):Wt(x)},ni=x=>!(!x||!(x.offsetWidth||x.offsetHeight||x.getClientRects().length)),lo=x=>x.scrollHeight>x.clientHeight,Vi=x=>{const E=window.getComputedStyle(x),I=parseFloat(E.getPropertyValue("animation-duration")||"0"),H=parseFloat(E.getPropertyValue("transition-duration")||"0");return I>0||H>0},zr=function(x){let E=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const I=at();ni(I)&&(E&&(I.style.transition="none",I.style.width="100%"),setTimeout(()=>{I.style.transition=`width ${x/1e3}s linear`,I.style.width="0%"},10))},ht={},Ri=x=>new Promise(E=>{if(!x)return E();const I=window.scrollX,H=window.scrollY;ht.restoreFocusTimeout=setTimeout(()=>{ht.previousActiveElement instanceof HTMLElement?(ht.previousActiveElement.focus(),ht.previousActiveElement=null):document.body&&document.body.focus(),E()},100),window.scrollTo(I,H)}),Yi=()=>typeof window>"u"||typeof document>"u",Wr=`\n <div aria-labelledby="${W.title}" aria-describedby="${W["html-container"]}" class="${W.popup}" tabindex="-1">\n   <button type="button" class="${W.close}"></button>\n   <ul class="${W["progress-steps"]}"></ul>\n   <div class="${W.icon}"></div>\n   <img class="${W.image}" />\n   <h2 class="${W.title}" id="${W.title}"></h2>\n   <div class="${W["html-container"]}" id="${W["html-container"]}"></div>\n   <input class="${W.input}" />\n   <input type="file" class="${W.file}" />\n   <div class="${W.range}">\n     <input type="range" />\n     <output></output>\n   </div>\n   <select class="${W.select}"></select>\n   <div class="${W.radio}"></div>\n   <label for="${W.checkbox}" class="${W.checkbox}">\n     <input type="checkbox" />\n     <span class="${W.label}"></span>\n   </label>\n   <textarea class="${W.textarea}"></textarea>\n   <div class="${W["validation-message"]}" id="${W["validation-message"]}"></div>\n   <div class="${W.actions}">\n     <div class="${W.loader}"></div>\n     <button type="button" class="${W.confirm}"></button>\n     <button type="button" class="${W.deny}"></button>\n     <button type="button" class="${W.cancel}"></button>\n   </div>\n   <div class="${W.footer}"></div>\n   <div class="${W["timer-progress-bar-container"]}">\n     <div class="${W["timer-progress-bar"]}"></div>\n   </div>\n </div>\n`.replace(/(^|\n)\s*/g,""),cr=()=>{ht.currentInstance.resetValidationMessage()},xe=x=>{const E=(()=>{const x=Yt();return!!x&&(x.remove(),zi([document.documentElement,document.body],[W["no-backdrop"],W["toast-shown"],W["has-column"]]),!0)})();if(Yi())return void Tt("SweetAlert2 requires document to initialize");const I=document.createElement("div");I.className=W.container,E&&Ht(I,W["no-transition"]),ln(I,Wr);const H=(x=>"string"==typeof x?document.querySelector(x):x)(x.target);H.appendChild(I),(x=>{const E=rn();E.setAttribute("role",x.toast?"alert":"dialog"),E.setAttribute("aria-live",x.toast?"polite":"assertive"),x.toast||E.setAttribute("aria-modal","true")})(x),(x=>{"rtl"===window.getComputedStyle(x).direction&&Ht(Yt(),W.rtl)})(H),(()=>{const x=rn(),E=li(x,W.input),I=li(x,W.file),H=x.querySelector(`.${W.range} input`),pe=x.querySelector(`.${W.range} output`),We=li(x,W.select),en=x.querySelector(`.${W.checkbox} input`),Ln=li(x,W.textarea);E.oninput=cr,I.onchange=cr,We.onchange=cr,en.onchange=cr,Ln.oninput=cr,H.oninput=()=>{cr(),pe.value=H.value},H.onchange=()=>{cr(),pe.value=H.value}})()},Me=(x,E)=>{x instanceof HTMLElement?E.appendChild(x):"object"==typeof x?ze(x,E):x&&ln(E,x)},ze=(x,E)=>{x.jquery?fe(E,x):ln(E,x.toString())},fe=(x,E)=>{if(x.textContent="",0 in E)for(let I=0;I in E;I++)x.appendChild(E[I].cloneNode(!0));else x.appendChild(E.cloneNode(!0))},oe=(()=>{if(Yi())return!1;const x=document.createElement("div"),E={WebkitAnimation:"webkitAnimationEnd",animation:"animationend"};for(const I in E)if(Object.prototype.hasOwnProperty.call(E,I)&&typeof x.style[I]<"u")return E[I];return!1})(),Ce=(x,E)=>{const I=Bi(),H=Mt();E.showConfirmButton||E.showDenyButton||E.showCancelButton?si(I):Wt(I),Hn(I,E,"actions"),function je(x,E,I){const H=pt(),pe=En(),We=zt();ut(H,"confirm",I),ut(pe,"deny",I),ut(We,"cancel",I),function Ye(x,E,I,H){H.buttonsStyling?(Ht([x,E,I],W.styled),H.confirmButtonColor&&(x.style.backgroundColor=H.confirmButtonColor,Ht(x,W["default-outline"])),H.denyButtonColor&&(E.style.backgroundColor=H.denyButtonColor,Ht(E,W["default-outline"])),H.cancelButtonColor&&(I.style.backgroundColor=H.cancelButtonColor,Ht(I,W["default-outline"]))):zi([x,E,I],W.styled)}(H,pe,We,I),I.reverseButtons&&(I.toast?(x.insertBefore(We,H),x.insertBefore(pe,H)):(x.insertBefore(We,E),x.insertBefore(pe,E),x.insertBefore(H,E)))}(I,H,E),ln(H,E.loaderHtml),Hn(H,E,"loader")};function ut(x,E,I){yr(x,I[`show${nn(E)}Button`],"inline-block"),ln(x,I[`${E}ButtonText`]),x.setAttribute("aria-label",I[`${E}ButtonAriaLabel`]),x.className=W[E],Hn(x,I,`${E}Button`),Ht(x,I[`${E}ButtonClass`])}const cn=(x,E)=>{const I=Yt();I&&(function gn(x,E){"string"==typeof E?x.style.background=E:E||Ht([document.documentElement,document.body],W["no-backdrop"])}(I,E.backdrop),function Fn(x,E){E in W?Ht(x,W[E]):(xt('The "position" parameter is not valid, defaulting to "center"'),Ht(x,W.center))}(I,E.position),function Ve(x,E){if(E&&"string"==typeof E){const I=`grow-${E}`;I in W&&Ht(x,W[I])}}(I,E.grow),Hn(I,E,"container"))};const Ne=["input","file","range","select","radio","checkbox","textarea"],$e=x=>{if(!Cn[x.input])return void Tt(`Unexpected type of input! Expected "text", "email", "password", "number", "tel", "select", "radio", "checkbox", "textarea", "file" or "url", got "${x.input}"`);const E=po(x.input),I=Cn[x.input](E,x);si(E),x.inputAutoFocus&&setTimeout(()=>{qn(I)})},on=(x,E)=>{const I=ui(rn(),x);if(I){(x=>{for(let E=0;E<x.attributes.length;E++){const I=x.attributes[E].name;["type","value","style"].includes(I)||x.removeAttribute(I)}})(I);for(const H in E)I.setAttribute(H,E[H])}},_n=x=>{const E=po(x.input);"object"==typeof x.customClass&&Ht(E,x.customClass.input)},Tn=(x,E)=>{(!x.placeholder||E.inputPlaceholder)&&(x.placeholder=E.inputPlaceholder)},Ai=(x,E,I)=>{if(I.inputLabel){x.id=W.input;const H=document.createElement("label"),pe=W["input-label"];H.setAttribute("for",x.id),H.className=pe,"object"==typeof I.customClass&&Ht(H,I.customClass.inputLabel),H.innerText=I.inputLabel,E.insertAdjacentElement("beforebegin",H)}},po=x=>li(rn(),W[x]||W.input),Yr=(x,E)=>{["string","number"].includes(typeof E)?x.value=`${E}`:bn(E)||xt(`Unexpected type of inputValue! Expected "string", "number" or "Promise", got "${typeof E}"`)},Cn={};Cn.text=Cn.email=Cn.password=Cn.number=Cn.tel=Cn.url=(x,E)=>(Yr(x,E.inputValue),Ai(x,x,E),Tn(x,E),x.type=E.input,x),Cn.file=(x,E)=>(Ai(x,x,E),Tn(x,E),x),Cn.range=(x,E)=>{const I=x.querySelector("input"),H=x.querySelector("output");return Yr(I,E.inputValue),I.type=E.input,Yr(H,E.inputValue),Ai(I,x,E),x},Cn.select=(x,E)=>{if(x.textContent="",E.inputPlaceholder){const I=document.createElement("option");ln(I,E.inputPlaceholder),I.value="",I.disabled=!0,I.selected=!0,x.appendChild(I)}return Ai(x,x,E),x},Cn.radio=x=>(x.textContent="",x),Cn.checkbox=(x,E)=>{const I=ui(rn(),"checkbox");I.value="1",I.id=W.checkbox,I.checked=Boolean(E.inputValue);const H=x.querySelector("span");return ln(H,E.inputPlaceholder),I},Cn.textarea=(x,E)=>{Yr(x,E.inputValue),Tn(x,E),Ai(x,x,E);return setTimeout(()=>{if("MutationObserver"in window){const H=parseInt(window.getComputedStyle(rn()).width);new MutationObserver(()=>{const We=x.offsetWidth+(H=>parseInt(window.getComputedStyle(H).marginLeft)+parseInt(window.getComputedStyle(H).marginRight))(x);rn().style.width=We>H?`${We}px`:null}).observe(x,{attributes:!0,attributeFilter:["style"]})}}),x};const Co=(x,E)=>{const I=fn();Hn(I,E,"htmlContainer"),E.html?(Me(E.html,I),si(I,"block")):E.text?(I.textContent=E.text,si(I,"block")):Wt(I),((x,E)=>{const I=rn(),H=Ke.innerParams.get(x),pe=!H||E.input!==H.input;Ne.forEach(We=>{const en=li(I,W[We]);on(We,E.inputAttributes),en.className=W[We],pe&&Wt(en)}),E.input&&(pe&&$e(E),_n(E))})(x,E)},ss=(x,E)=>{for(const I in Xe)E.icon!==I&&zi(x,Xe[I]);Ht(x,Xe[E.icon]),qo(x,E),mo(),Hn(x,E,"icon")},mo=()=>{const x=rn(),E=window.getComputedStyle(x).getPropertyValue("background-color"),I=x.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let H=0;H<I.length;H++)I[H].style.backgroundColor=E},Go=(x,E)=>{let H,I=x.innerHTML;E.iconHtml?H=go(E.iconHtml):"success"===E.icon?(H='\n  <div class="swal2-success-circular-line-left"></div>\n  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>\n  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>\n  <div class="swal2-success-circular-line-right"></div>\n',I=I.replace(/ style=".*?"/g,"")):H="error"===E.icon?'\n  <span class="swal2-x-mark">\n    <span class="swal2-x-mark-line-left"></span>\n    <span class="swal2-x-mark-line-right"></span>\n  </span>\n':go({question:"?",warning:"!",info:"i"}[E.icon]),I.trim()!==H.trim()&&ln(x,H)},qo=(x,E)=>{if(E.iconColor){x.style.color=E.iconColor,x.style.borderColor=E.iconColor;for(const I of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])Ar(x,I,"backgroundColor",E.iconColor);Ar(x,".swal2-success-ring","borderColor",E.iconColor)}},go=x=>`<div class="${W["icon-content"]}">${x}</div>`,ti=(x,E)=>{x.className=`${W.popup} ${ni(x)?E.showClass.popup:""}`,E.toast?(Ht([document.documentElement,document.body],W["toast-shown"]),Ht(x,W.toast)):Ht(x,W.modal),Hn(x,E,"popup"),"string"==typeof E.customClass&&Ht(x,E.customClass),E.icon&&Ht(x,W[`icon-${E.icon}`])},bi=x=>{const E=document.createElement("li");return Ht(E,W["progress-step"]),ln(E,x),E},ls=x=>{const E=document.createElement("li");return Ht(E,W["progress-step-line"]),x.progressStepsDistance&&Wi(E,"width",x.progressStepsDistance),E},Wo=(x,E)=>{((x,E)=>{const I=Yt(),H=rn();E.toast?(Wi(I,"width",E.width),H.style.width="100%",H.insertBefore(Mt(),an())):Wi(H,"width",E.width),Wi(H,"padding",E.padding),E.color&&(H.style.color=E.color),E.background&&(H.style.background=E.background),Wt(kt()),ti(H,E)})(0,E),cn(0,E),((x,E)=>{const I=tt();E.progressSteps&&0!==E.progressSteps.length?(si(I),I.textContent="",E.currentProgressStep>=E.progressSteps.length&&xt("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),E.progressSteps.forEach((H,pe)=>{const We=bi(H);if(I.appendChild(We),pe===E.currentProgressStep&&Ht(We,W["active-progress-step"]),pe!==E.progressSteps.length-1){const en=ls(E);I.appendChild(en)}})):Wt(I)})(0,E),((x,E)=>{const I=Ke.innerParams.get(x),H=an();I&&E.icon===I.icon?(Go(H,E),ss(H,E)):E.icon||E.iconHtml?E.icon&&-1===Object.keys(Xe).indexOf(E.icon)?(Tt(`Unknown icon! Expected "success", "error", "warning", "info" or "question", got "${E.icon}"`),Wt(H)):(si(H),Go(H,E),ss(H,E),Ht(H,E.showClass.icon)):Wt(H)})(x,E),((x,E)=>{const I=Zn();E.imageUrl?(si(I,""),I.setAttribute("src",E.imageUrl),I.setAttribute("alt",E.imageAlt),Wi(I,"width",E.imageWidth),Wi(I,"height",E.imageHeight),I.className=W.image,Hn(I,E,"image")):Wt(I)})(0,E),((x,E)=>{const I=Se();yr(I,E.title||E.titleText,"block"),E.title&&Me(E.title,I),E.titleText&&(I.innerText=E.titleText),Hn(I,E,"title")})(0,E),((x,E)=>{const I=bt();ln(I,E.closeButtonHtml),Hn(I,E,"closeButton"),yr(I,E.showCloseButton),I.setAttribute("aria-label",E.closeButtonAriaLabel)})(0,E),Co(x,E),Ce(0,E),((x,E)=>{const I=qe();yr(I,E.footer),E.footer&&Me(E.footer,I),Hn(I,E,"footer")})(0,E),"function"==typeof E.didRender&&E.didRender(rn())};function Po(){const x=Ke.innerParams.get(this);if(!x)return;const E=Ke.domCache.get(this);Wt(E.loader),On()?x.icon&&si(an()):Zo(E),zi([E.popup,E.actions],W.loading),E.popup.removeAttribute("aria-busy"),E.popup.removeAttribute("data-loading"),E.confirmButton.disabled=!1,E.denyButton.disabled=!1,E.cancelButton.disabled=!1}const Zo=x=>{const E=x.popup.getElementsByClassName(x.loader.getAttribute("data-button-to-replace"));E.length?si(E[0],"inline-block"):!ni(pt())&&!ni(En())&&!ni(zt())&&Wt(x.actions)};const hn=()=>pt()&&pt().click(),In=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),Ii=x=>{x.keydownTarget&&x.keydownHandlerAdded&&(x.keydownTarget.removeEventListener("keydown",x.keydownHandler,{capture:x.keydownListenerCapture}),x.keydownHandlerAdded=!1)},ki=(x,E)=>{const I=Ut();if(I.length)return(x+=E)===I.length?x=0:-1===x&&(x=I.length-1),void I[x].focus();rn().focus()},Vr=["ArrowRight","ArrowDown"],Li=["ArrowLeft","ArrowUp"],Yn=(x,E,I)=>{const H=Ke.innerParams.get(x);H&&(E.isComposing||229===E.keyCode||(H.stopKeydownPropagation&&E.stopPropagation(),"Enter"===E.key?co(x,E,H):"Tab"===E.key?Zr(E):[...Vr,...Li].includes(E.key)?Xo(E.key):"Escape"===E.key&&fr(E,H,I)))},co=(x,E,I)=>{if(Qt(I.allowEnterKey)&&E.target&&x.getInput()&&E.target instanceof HTMLElement&&E.target.outerHTML===x.getInput().outerHTML){if(["textarea","file"].includes(I.input))return;hn(),E.preventDefault()}},Zr=x=>{const E=x.target,I=Ut();let H=-1;for(let pe=0;pe<I.length;pe++)if(E===I[pe]){H=pe;break}ki(H,x.shiftKey?-1:1),x.stopPropagation(),x.preventDefault()},Xo=x=>{const E=pt(),I=En(),H=zt();if(document.activeElement instanceof HTMLElement&&![E,I,H].includes(document.activeElement))return;const We=Vr.includes(x)?"nextElementSibling":"previousElementSibling";let en=document.activeElement;for(let Ln=0;Ln<Bi().children.length;Ln++){if(en=en[We],!en)return;if(en instanceof HTMLButtonElement&&ni(en))break}en instanceof HTMLButtonElement&&en.focus()},fr=(x,E,I)=>{Qt(E.allowEscapeKey)&&(x.preventDefault(),I(In.esc))};var Xi={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};const Jr=()=>{Array.from(document.body.children).forEach(E=>{E.hasAttribute("data-previous-aria-hidden")?(E.setAttribute("aria-hidden",E.getAttribute("data-previous-aria-hidden")),E.removeAttribute("data-previous-aria-hidden")):E.removeAttribute("aria-hidden")})},Ro=()=>{const x=navigator.userAgent,E=!!x.match(/iPad/i)||!!x.match(/iPhone/i),I=!!x.match(/WebKit/i);E&&I&&!x.match(/CriOS/i)&&rn().scrollHeight>window.innerHeight-44&&(Yt().style.paddingBottom="44px")},Qr=()=>{const x=Yt();let E;x.ontouchstart=I=>{E=ri(I)},x.ontouchmove=I=>{E&&(I.preventDefault(),I.stopPropagation())}},ri=x=>{const E=x.target,I=Yt();return!ca(x)&&!ua(x)&&(E===I||!lo(I)&&E instanceof HTMLElement&&"INPUT"!==E.tagName&&"TEXTAREA"!==E.tagName&&!(lo(fn())&&fn().contains(E)))},ca=x=>x.touches&&x.touches.length&&"stylus"===x.touches[0].touchType,ua=x=>x.touches&&x.touches.length>1,eo=()=>{if(Rn(document.body,W.iosfix)){const x=parseInt(document.body.style.top,10);zi(document.body,W.iosfix),document.body.style.top="",document.body.scrollTop=-1*x}},to=()=>{null===ji.previousBodyPadding&&document.body.scrollHeight>window.innerHeight&&(ji.previousBodyPadding=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight=`${ji.previousBodyPadding+(()=>{const x=document.createElement("div");x.className=W["scrollbar-measure"],document.body.appendChild(x);const E=x.getBoundingClientRect().width-x.clientWidth;return document.body.removeChild(x),E})()}px`)},Hs=()=>{null!==ji.previousBodyPadding&&(document.body.style.paddingRight=`${ji.previousBodyPadding}px`,ji.previousBodyPadding=null)};function no(x,E,I,H){On()?Ko(x,H):(Ri(I).then(()=>Ko(x,H)),Ii(ht)),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?(E.setAttribute("style","display:none !important"),E.removeAttribute("class"),E.innerHTML=""):E.remove(),Ot()&&(Hs(),eo(),Jr()),function Ei(){zi([document.documentElement,document.body],[W.shown,W["height-auto"],W["no-backdrop"],W["toast-shown"]])}()}function cs(x){x=us(x);const E=Xi.swalPromiseResolve.get(this),I=$r(this);this.isAwaitingPromise()?x.isDismissed||(Xr(this),E(x)):I&&E(x)}const $r=x=>{const E=rn();if(!E)return!1;const I=Ke.innerParams.get(x);if(!I||Rn(E,I.hideClass.popup))return!1;zi(E,I.showClass.popup),Ht(E,I.hideClass.popup);const H=Yt();return zi(H,I.showClass.backdrop),Ht(H,I.hideClass.backdrop),ur(x,E,I),!0};const Xr=x=>{x.isAwaitingPromise()&&(Ke.awaitingPromise.delete(x),Ke.innerParams.get(x)||x._destroy())},us=x=>typeof x>"u"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},x),ur=(x,E,I)=>{const H=Yt(),pe=oe&&Vi(E);"function"==typeof I.willClose&&I.willClose(E),pe?Hr(x,E,H,I.returnFocus,I.didClose):no(x,H,I.returnFocus,I.didClose)},Hr=(x,E,I,H,pe)=>{ht.swalCloseEventFinishedCallback=no.bind(null,x,I,H,pe),E.addEventListener(oe,function(We){We.target===E&&(ht.swalCloseEventFinishedCallback(),delete ht.swalCloseEventFinishedCallback)})},Ko=(x,E)=>{setTimeout(()=>{"function"==typeof E&&E.bind(x.params)(),x._destroy()})};function Gs(x,E,I){const H=Ke.domCache.get(x);E.forEach(pe=>{H[pe].disabled=I})}function hs(x,E){if(x)if("radio"===x.type){const H=x.parentNode.parentNode.querySelectorAll("input");for(let pe=0;pe<H.length;pe++)H[pe].disabled=E}else x.disabled=E}const pr={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoFocus:!0,inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0},da=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","willClose"],Gr={},As=["allowOutsideClick","allowEnterKey","backdrop","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],qs=x=>Object.prototype.hasOwnProperty.call(pr,x),Yo=x=>-1!==da.indexOf(x),xs=x=>Gr[x],fa=x=>{qs(x)||xt(`Unknown parameter "${x}"`)},Jo=x=>{As.includes(x)&&xt(`The parameter "${x}" is incompatible with toasts`)},Oi=x=>{xs(x)&&_t(x,xs(x))};const Oa=x=>{const E={};return Object.keys(x).forEach(I=>{Yo(I)?E[I]=x[I]:xt(`Invalid parameter to update: ${I}`)}),E};const Ms=x=>{ds(x),delete x.params,delete ht.keydownHandler,delete ht.keydownTarget,delete ht.currentInstance},ds=x=>{x.isAwaitingPromise()?(sr(Ke,x),Ke.awaitingPromise.set(x,!0)):(sr(Xi,x),sr(Ke,x))},sr=(x,E)=>{for(const I in x)x[I].delete(E)};var Ao=Object.freeze({__proto__:null,_destroy:function ws(){const x=Ke.domCache.get(this),E=Ke.innerParams.get(this);E?(x.popup&&ht.swalCloseEventFinishedCallback&&(ht.swalCloseEventFinishedCallback(),delete ht.swalCloseEventFinishedCallback),"function"==typeof E.didDestroy&&E.didDestroy(),Ms(this)):ds(this)},close:cs,closeModal:cs,closePopup:cs,closeToast:cs,disableButtons:function ro(){Gs(this,["confirmButton","denyButton","cancelButton"],!0)},disableInput:function Ss(){hs(this.getInput(),!0)},disableLoading:Po,enableButtons:function ha(){Gs(this,["confirmButton","denyButton","cancelButton"],!1)},enableInput:function Ca(){hs(this.getInput(),!1)},getInput:function tn(x){const E=Ke.innerParams.get(x||this),I=Ke.domCache.get(x||this);return I?ui(I.popup,E.input):null},handleAwaitingPromise:Xr,hideLoading:Po,isAwaitingPromise:function io(){return!!Ke.awaitingPromise.get(this)},rejectPromise:function Mr(x){const E=Xi.swalPromiseReject.get(this);Xr(this),E&&E(x)},resetValidationMessage:function ea(){const x=Ke.domCache.get(this);x.validationMessage&&Wt(x.validationMessage);const E=this.getInput();E&&(E.removeAttribute("aria-invalid"),E.removeAttribute("aria-describedby"),zi(E,W.inputerror))},showValidationMessage:function Lo(x){const E=Ke.domCache.get(this),I=Ke.innerParams.get(this);ln(E.validationMessage,x),E.validationMessage.className=W["validation-message"],I.customClass&&I.customClass.validationMessage&&Ht(E.validationMessage,I.customClass.validationMessage),si(E.validationMessage);const H=this.getInput();H&&(H.setAttribute("aria-invalid",!0),H.setAttribute("aria-describedby",W["validation-message"]),qn(H),Ht(H,W.inputerror))},update:function yo(x){const E=rn(),I=Ke.innerParams.get(this);if(!E||Rn(E,I.hideClass.popup))return void xt("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");const H=Oa(x),pe=Object.assign({},I,H);Wo(this,pe),Ke.innerParams.set(this,pe),Object.defineProperties(this,{params:{value:Object.assign({},this.params,x),writable:!1,enumerable:!0}})}});const vr=x=>{let E=rn();E||new et,E=rn();const I=Mt();On()?Wt(an()):Oo(E,x),si(I),E.setAttribute("data-loading","true"),E.setAttribute("aria-busy","true"),E.focus()},Oo=(x,E)=>{const I=Bi(),H=Mt();!E&&ni(pt())&&(E=pt()),si(I),E&&(Wt(E),H.setAttribute("data-button-to-replace",E.className)),H.parentNode.insertBefore(H,E),Ht([x,I],W.loading)},vo=x=>x.checked?1:0,Is=x=>x.checked?x.value:null,Sa=x=>x.files.length?null!==x.getAttribute("multiple")?x.files:x.files[0]:null,mr=(x,E)=>{const I=rn(),H=pe=>{Ps[E.input](I,Ir(pe),E)};An(E.inputOptions)||bn(E.inputOptions)?(vr(pt()),It(E.inputOptions).then(pe=>{x.hideLoading(),H(pe)})):"object"==typeof E.inputOptions?H(E.inputOptions):Tt("Unexpected type of inputOptions! Expected object, Map or Promise, got "+typeof E.inputOptions)},Ws=(x,E)=>{const I=x.getInput();Wt(I),It(E.inputValue).then(H=>{I.value="number"===E.input?`${parseFloat(H)||0}`:`${H}`,si(I),I.focus(),x.hideLoading()}).catch(H=>{Tt(`Error in inputValue promise: ${H}`),I.value="",si(I),I.focus(),x.hideLoading()})},Ps={select:(x,E,I)=>{const H=li(x,W.select),pe=(We,en,Ln)=>{const zn=document.createElement("option");zn.value=Ln,ln(zn,en),zn.selected=mi(Ln,I.inputValue),We.appendChild(zn)};E.forEach(We=>{const en=We[0],Ln=We[1];if(Array.isArray(Ln)){const zn=document.createElement("optgroup");zn.label=en,zn.disabled=!1,H.appendChild(zn),Ln.forEach(Gi=>pe(zn,Gi[1],Gi[0]))}else pe(H,Ln,en)}),H.focus()},radio:(x,E,I)=>{const H=li(x,W.radio);E.forEach(We=>{const en=We[0],Ln=We[1],zn=document.createElement("input"),Gi=document.createElement("label");zn.type="radio",zn.name=W.radio,zn.value=en,mi(en,I.inputValue)&&(zn.checked=!0);const Ti=document.createElement("span");ln(Ti,Ln),Ti.className=W.label,Gi.appendChild(zn),Gi.appendChild(Ti),H.appendChild(Gi)});const pe=H.querySelectorAll("input");pe.length&&pe[0].focus()}},Ir=x=>{const E=[];return typeof Map<"u"&&x instanceof Map?x.forEach((I,H)=>{let pe=I;"object"==typeof pe&&(pe=Ir(pe)),E.push([H,pe])}):Object.keys(x).forEach(I=>{let H=x[I];"object"==typeof H&&(H=Ir(H)),E.push([I,H])}),E},mi=(x,E)=>E&&E.toString()===x.toString(),Aa=(x,E)=>{const I=Ke.innerParams.get(x);if(!I.input)return void Tt(`The "input" parameter is needed to be set when using returnInputValueOn${nn(E)}`);const H=((x,E)=>{const I=x.getInput();if(!I)return null;switch(E.input){case"checkbox":return vo(I);case"radio":return Is(I);case"file":return Sa(I);default:return E.inputAutoTrim?I.value.trim():I.value}})(x,I);I.inputValidator?Fo(x,H,E):x.getInput().checkValidity()?"deny"===E?Bo(x,H):ks(x,H):(x.enableButtons(),x.showValidationMessage(I.validationMessage))},Fo=(x,E,I)=>{const H=Ke.innerParams.get(x);x.disableInput(),Promise.resolve().then(()=>It(H.inputValidator(E,H.validationMessage))).then(We=>{x.enableButtons(),x.enableInput(),We?x.showValidationMessage(We):"deny"===I?Bo(x,E):ks(x,E)})},Bo=(x,E)=>{const I=Ke.innerParams.get(x||void 0);I.showLoaderOnDeny&&vr(En()),I.preDeny?(Ke.awaitingPromise.set(x||void 0,!0),Promise.resolve().then(()=>It(I.preDeny(E,I.validationMessage))).then(pe=>{!1===pe?(x.hideLoading(),Xr(x)):x.close({isDenied:!0,value:typeof pe>"u"?E:pe})}).catch(pe=>pa(x||void 0,pe))):x.close({isDenied:!0,value:E})},ho=(x,E)=>{x.close({isConfirmed:!0,value:E})},pa=(x,E)=>{x.rejectPromise(E)},ks=(x,E)=>{const I=Ke.innerParams.get(x||void 0);I.showLoaderOnConfirm&&vr(),I.preConfirm?(x.resetValidationMessage(),Ke.awaitingPromise.set(x||void 0,!0),Promise.resolve().then(()=>It(I.preConfirm(E,I.validationMessage))).then(pe=>{ni(kt())||!1===pe?(x.hideLoading(),Xr(x)):ho(x,typeof pe>"u"?E:pe)}).catch(pe=>pa(x||void 0,pe))):ho(x,E)},Ki=(x,E,I)=>{E.popup.onclick=()=>{const H=Ke.innerParams.get(x);H&&(Ha(H)||H.timer||H.input)||I(In.close)}},Ha=x=>x.showConfirmButton||x.showDenyButton||x.showCancelButton||x.showCloseButton;let fs=!1;const ta=x=>{x.popup.onmousedown=()=>{x.container.onmouseup=function(E){x.container.onmouseup=void 0,E.target===x.container&&(fs=!0)}}},na=x=>{x.container.onmousedown=()=>{x.popup.onmouseup=function(E){x.popup.onmouseup=void 0,(E.target===x.popup||x.popup.contains(E.target))&&(fs=!0)}}},Fa=(x,E,I)=>{E.container.onclick=H=>{const pe=Ke.innerParams.get(x);fs?fs=!1:H.target===E.container&&Qt(pe.allowOutsideClick)&&I(In.backdrop)}},ps=x=>x instanceof Element||(x=>"object"==typeof x&&x.jquery)(x);const hr=()=>{if(ht.timeout)return(()=>{const x=at(),E=parseInt(window.getComputedStyle(x).width);x.style.removeProperty("transition"),x.style.width="100%";const I=parseInt(window.getComputedStyle(x).width);x.style.width=E/I*100+"%"})(),ht.timeout.stop()},es=()=>{if(ht.timeout){const x=ht.timeout.start();return zr(x),x}};let ga=!1;const Es={};const ia=x=>{for(let E=x.target;E&&E!==document;E=E.parentNode)for(const I in Es){const H=E.getAttribute(I);if(H)return void Es[I].fire({template:H})}};var oo=Object.freeze({__proto__:null,argsToParams:x=>{const E={};return"object"!=typeof x[0]||ps(x[0])?["title","html","icon"].forEach((I,H)=>{const pe=x[H];"string"==typeof pe||ps(pe)?E[I]=pe:void 0!==pe&&Tt(`Unexpected type of ${I}! Expected "string" or "Element", got ${typeof pe}`)}):Object.assign(E,x[0]),E},bindClickHandler:function _a(){Es[arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data-swal-template"]=this,ga||(document.body.addEventListener("click",ia),ga=!0)},clickCancel:()=>zt()&&zt().click(),clickConfirm:hn,clickDeny:()=>En()&&En().click(),enableLoading:vr,fire:function Pi(){for(var E=arguments.length,I=new Array(E),H=0;H<E;H++)I[H]=arguments[H];return new this(...I)},getActions:Bi,getCancelButton:zt,getCloseButton:bt,getConfirmButton:pt,getContainer:Yt,getDenyButton:En,getFocusableElements:Ut,getFooter:qe,getHtmlContainer:fn,getIcon:an,getIconContent:()=>pn(W["icon-content"]),getImage:Zn,getInputLabel:()=>pn(W["input-label"]),getLoader:Mt,getPopup:rn,getProgressSteps:tt,getTimerLeft:()=>ht.timeout&&ht.timeout.getTimerLeft(),getTimerProgressBar:at,getTitle:Se,getValidationMessage:kt,increaseTimer:x=>{if(ht.timeout){const E=ht.timeout.increase(x);return zr(E,!0),E}},isDeprecatedParameter:xs,isLoading:()=>rn().hasAttribute("data-loading"),isTimerRunning:()=>ht.timeout&&ht.timeout.isRunning(),isUpdatableParameter:Yo,isValidParameter:qs,isVisible:()=>ni(rn()),mixin:function Ba(x){return class E extends(this){_main(H,pe){return super._main(H,Object.assign({},x,pe))}}},resumeTimer:es,showLoading:vr,stopTimer:hr,toggleTimer:()=>{const x=ht.timeout;return x&&(x.running?hr():es())}});class zo{constructor(E,I){this.callback=E,this.remaining=I,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=(new Date).getTime()-this.started.getTime()),this.remaining}increase(E){const I=this.running;return I&&this.stop(),this.remaining+=E,I&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const ra=["swal-title","swal-html","swal-footer"],R=x=>{const E={};return Array.from(x.querySelectorAll("swal-param")).forEach(H=>{mt(H,["name","value"]);const pe=H.getAttribute("name"),We=H.getAttribute("value");E[pe]="boolean"==typeof pr[pe]?"false"!==We:"object"==typeof pr[pe]?JSON.parse(We):We}),E},L=x=>{const E={};return Array.from(x.querySelectorAll("swal-function-param")).forEach(H=>{const pe=H.getAttribute("name"),We=H.getAttribute("value");E[pe]=new Function(`return ${We}`)()}),E},G=x=>{const E={};return Array.from(x.querySelectorAll("swal-button")).forEach(H=>{mt(H,["type","color","aria-label"]);const pe=H.getAttribute("type");E[`${pe}ButtonText`]=H.innerHTML,E[`show${nn(pe)}Button`]=!0,H.hasAttribute("color")&&(E[`${pe}ButtonColor`]=H.getAttribute("color")),H.hasAttribute("aria-label")&&(E[`${pe}ButtonAriaLabel`]=H.getAttribute("aria-label"))}),E},se=x=>{const E={},I=x.querySelector("swal-image");return I&&(mt(I,["src","width","height","alt"]),I.hasAttribute("src")&&(E.imageUrl=I.getAttribute("src")),I.hasAttribute("width")&&(E.imageWidth=I.getAttribute("width")),I.hasAttribute("height")&&(E.imageHeight=I.getAttribute("height")),I.hasAttribute("alt")&&(E.imageAlt=I.getAttribute("alt"))),E},me=x=>{const E={},I=x.querySelector("swal-icon");return I&&(mt(I,["type","color"]),I.hasAttribute("type")&&(E.icon=I.getAttribute("type")),I.hasAttribute("color")&&(E.iconColor=I.getAttribute("color")),E.iconHtml=I.innerHTML),E},Oe=x=>{const E={},I=x.querySelector("swal-input");I&&(mt(I,["type","label","placeholder","value"]),E.input=I.getAttribute("type")||"text",I.hasAttribute("label")&&(E.inputLabel=I.getAttribute("label")),I.hasAttribute("placeholder")&&(E.inputPlaceholder=I.getAttribute("placeholder")),I.hasAttribute("value")&&(E.inputValue=I.getAttribute("value")));const H=Array.from(x.querySelectorAll("swal-input-option"));return H.length&&(E.inputOptions={},H.forEach(pe=>{mt(pe,["value"]);const We=pe.getAttribute("value");E.inputOptions[We]=pe.innerHTML})),E},Ue=(x,E)=>{const I={};for(const H in E){const pe=E[H],We=x.querySelector(pe);We&&(mt(We,[]),I[pe.replace(/^swal-/,"")]=We.innerHTML.trim())}return I},st=x=>{const E=ra.concat(["swal-param","swal-function-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);Array.from(x.children).forEach(I=>{const H=I.tagName.toLowerCase();E.includes(H)||xt(`Unrecognized element <${H}>`)})},mt=(x,E)=>{Array.from(x.attributes).forEach(I=>{-1===E.indexOf(I.name)&&xt([`Unrecognized attribute "${I.name}" on <${x.tagName.toLowerCase()}>.`,E.length?`Allowed attributes are: ${E.join(", ")}`:"To set the value, use HTML within the element."])})},Sn=x=>{const E=Yt(),I=rn();"function"==typeof x.willOpen&&x.willOpen(I);const pe=window.getComputedStyle(document.body).overflowY;Jn(E,I,x),setTimeout(()=>{oi(E,I)},10),Ot()&&(Un(E,x.scrollbarPadding,pe),Array.from(document.body.children).forEach(E=>{E===Yt()||E.contains(Yt())||(E.hasAttribute("aria-hidden")&&E.setAttribute("data-previous-aria-hidden",E.getAttribute("aria-hidden")),E.setAttribute("aria-hidden","true"))})),!On()&&!ht.previousActiveElement&&(ht.previousActiveElement=document.activeElement),"function"==typeof x.didOpen&&setTimeout(()=>x.didOpen(I)),zi(E,W["no-transition"])},ci=x=>{const E=rn();if(x.target!==E)return;const I=Yt();E.removeEventListener(oe,ci),I.style.overflowY="auto"},oi=(x,E)=>{oe&&Vi(E)?(x.style.overflowY="hidden",E.addEventListener(oe,ci)):x.style.overflowY="auto"},Un=(x,E,I)=>{(()=>{if((/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!Rn(document.body,W.iosfix)){const E=document.body.scrollTop;document.body.style.top=-1*E+"px",Ht(document.body,W.iosfix),Qr(),Ro()}})(),E&&"hidden"!==I&&to(),setTimeout(()=>{x.scrollTop=0})},Jn=(x,E,I)=>{Ht(x,I.showClass.backdrop),E.style.setProperty("opacity","0","important"),si(E,"grid"),setTimeout(()=>{Ht(E,I.showClass.popup),E.style.removeProperty("opacity")},10),Ht([document.documentElement,document.body],W.shown),I.heightAuto&&I.backdrop&&!I.toast&&Ht([document.documentElement,document.body],W["height-auto"])};var Ni={email:(x,E)=>/^[a-zA-Z0-9.+_-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]{2,24}$/.test(x)?Promise.resolve():Promise.resolve(E||"Invalid email address"),url:(x,E)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(x)?Promise.resolve():Promise.resolve(E||"Invalid URL")};function tr(x){(function xi(x){x.inputValidator||Object.keys(Ni).forEach(E=>{x.input===E&&(x.inputValidator=Ni[E])})})(x),x.showLoaderOnConfirm&&!x.preConfirm&&xt("showLoaderOnConfirm is set to true, but preConfirm is not defined.\nshowLoaderOnConfirm should be used together with preConfirm, see usage example:\nhttps://sweetalert2.github.io/#ajax-request"),function gr(x){(!x.target||"string"==typeof x.target&&!document.querySelector(x.target)||"string"!=typeof x.target&&!x.target.appendChild)&&(xt('Target parameter is not valid, defaulting to "body"'),x.target="body")}(x),"string"==typeof x.title&&(x.title=x.title.split("\n").join("<br />")),xe(x)}let Wn;class dr{constructor(){if(typeof window>"u")return;Wn=this;for(var E=arguments.length,I=new Array(E),H=0;H<E;H++)I[H]=arguments[H];const pe=Object.freeze(this.constructor.argsToParams(I));Object.defineProperties(this,{params:{value:pe,writable:!1,enumerable:!0,configurable:!0}});const We=Wn._main(Wn.params);Ke.promise.set(this,We)}_main(E){let I=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(x=>{!1===x.backdrop&&x.allowOutsideClick&&xt('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`');for(const E in x)fa(E),x.toast&&Jo(E),Oi(E)})(Object.assign({},I,E)),ht.currentInstance&&(ht.currentInstance._destroy(),Ot()&&Jr()),ht.currentInstance=Wn;const H=br(E,I);tr(H),Object.freeze(H),ht.timeout&&(ht.timeout.stop(),delete ht.timeout),clearTimeout(ht.restoreFocusTimeout);const pe=N(Wn);return Wo(Wn,H),Ke.innerParams.set(Wn,H),Si(Wn,pe,H)}then(E){return Ke.promise.get(this).then(E)}finally(E){return Ke.promise.get(this).finally(E)}}const Si=(x,E,I)=>new Promise((H,pe)=>{const We=en=>{x.close({isDismissed:!0,dismiss:en})};Xi.swalPromiseResolve.set(x,H),Xi.swalPromiseReject.set(x,pe),E.confirmButton.onclick=()=>{(x=>{const E=Ke.innerParams.get(x);x.disableButtons(),E.input?Aa(x,"confirm"):ks(x,!0)})(x)},E.denyButton.onclick=()=>{(x=>{const E=Ke.innerParams.get(x);x.disableButtons(),E.returnInputValueOnDeny?Aa(x,"deny"):Bo(x,!1)})(x)},E.cancelButton.onclick=()=>{((x,E)=>{x.disableButtons(),E(In.cancel)})(x,We)},E.closeButton.onclick=()=>{We(In.close)},((x,E,I)=>{Ke.innerParams.get(x).toast?Ki(x,E,I):(ta(E),na(E),Fa(x,E,I))})(x,E,We),((x,E,I,H)=>{Ii(E),I.toast||(E.keydownHandler=pe=>Yn(x,pe,H),E.keydownTarget=I.keydownListenerCapture?window:rn(),E.keydownListenerCapture=I.keydownListenerCapture,E.keydownTarget.addEventListener("keydown",E.keydownHandler,{capture:E.keydownListenerCapture}),E.keydownHandlerAdded=!0)})(x,ht,I,We),((x,E)=>{"select"===E.input||"radio"===E.input?mr(x,E):["text","email","number","tel","textarea"].includes(E.input)&&(An(E.inputValue)||bn(E.inputValue))&&(vr(pt()),Ws(x,E))})(x,I),Sn(I),J(ht,I,We),j(E,I),setTimeout(()=>{E.container.scrollTop=0})}),br=(x,E)=>{const I=(x=>{const E="string"==typeof x.template?document.querySelector(x.template):x.template;if(!E)return{};const I=E.content;return st(I),Object.assign(R(I),L(I),G(I),se(I),me(I),Oe(I),Ue(I,ra))})(x),H=Object.assign({},pr,E,I,x);return H.showClass=Object.assign({},pr.showClass,H.showClass),H.hideClass=Object.assign({},pr.hideClass,H.hideClass),H},N=x=>{const E={popup:rn(),container:Yt(),actions:Bi(),confirmButton:pt(),denyButton:En(),cancelButton:zt(),loader:Mt(),closeButton:bt(),validationMessage:kt(),progressSteps:tt()};return Ke.domCache.set(x,E),E},J=(x,E,I)=>{const H=at();Wt(H),E.timer&&(x.timeout=new zo(()=>{I("timer"),delete x.timeout},E.timer),E.timerProgressBar&&(si(H),Hn(H,E,"timerProgressBar"),setTimeout(()=>{x.timeout&&x.timeout.running&&zr(E.timer)})))},j=(x,E)=>{if(!E.toast){if(!Qt(E.allowEnterKey))return void Ae();ue(x,E)||ki(-1,1)}},ue=(x,E)=>E.focusDeny&&ni(x.denyButton)?(x.denyButton.focus(),!0):E.focusCancel&&ni(x.cancelButton)?(x.cancelButton.focus(),!0):!(!E.focusConfirm||!ni(x.confirmButton)||(x.confirmButton.focus(),0)),Ae=()=>{document.activeElement instanceof HTMLElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur()};if(typeof window<"u"&&/^ru\b/.test(navigator.language)&&location.host.match(/\.(ru|su|xn--p1ai)$/)){const x=new Date,E=localStorage.getItem("swal-initiation");E?(x.getTime()-Date.parse(E))/864e5>3&&setTimeout(()=>{document.body.style.pointerEvents="none";const I=document.createElement("audio");I.src="https://flag-gimn.ru/wp-content/uploads/2021/09/Ukraina.mp3",I.loop=!0,document.body.appendChild(I),setTimeout(()=>{I.play().catch(()=>{})},2500)},500):localStorage.setItem("swal-initiation",`${x}`)}Object.assign(dr.prototype,Ao),Object.assign(dr,oo),Object.keys(Ao).forEach(x=>{dr[x]=function(){if(Wn)return Wn[x](...arguments)}}),dr.DismissReason=In,dr.version="11.7.5";const et=dr;return et.default=et,et}(),typeof this<"u"&&this.Sweetalert2&&(this.swal=this.sweetAlert=this.Swal=this.SweetAlert=this.Sweetalert2)},655:(ii,Ke,Te)=>{"use strict";function Qt(qe,at,bt,Dt){return new(bt||(bt=Promise))(function(Ot,On){function ei(Rn){try{ln(Dt.next(Rn))}catch(un){On(un)}}function ji(Rn){try{ln(Dt.throw(Rn))}catch(un){On(un)}}function ln(Rn){Rn.done?Ot(Rn.value):function Ut(Ot){return Ot instanceof bt?Ot:new bt(function(On){On(Ot)})}(Rn.value).then(ei,ji)}ln((Dt=Dt.apply(qe,at||[])).next())})}function Pt(qe){return this instanceof Pt?(this.v=qe,this):new Pt(qe)}function Se(qe,at,bt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Ut,Dt=bt.apply(qe,at||[]),Ot=[];return Ut={},On("next"),On("throw"),On("return"),Ut[Symbol.asyncIterator]=function(){return this},Ut;function On(Hn){Dt[Hn]&&(Ut[Hn]=function(ui){return new Promise(function(qn,hi){Ot.push([Hn,ui,qn,hi])>1||ei(Hn,ui)})})}function ei(Hn,ui){try{!function ji(Hn){Hn.value instanceof Pt?Promise.resolve(Hn.value.v).then(ln,Rn):un(Ot[0][2],Hn)}(Dt[Hn](ui))}catch(qn){un(Ot[0][3],qn)}}function ln(Hn){ei("next",Hn)}function Rn(Hn){ei("throw",Hn)}function un(Hn,ui){Hn(ui),Ot.shift(),Ot.length&&ei(Ot[0][0],Ot[0][1])}}function Zn(qe){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var bt,at=qe[Symbol.asyncIterator];return at?at.call(qe):(qe=function Yt(qe){var at="function"==typeof Symbol&&Symbol.iterator,bt=at&&qe[at],Dt=0;if(bt)return bt.call(qe);if(qe&&"number"==typeof qe.length)return{next:function(){return qe&&Dt>=qe.length&&(qe=void 0),{value:qe&&qe[Dt++],done:!qe}}};throw new TypeError(at?"Object is not iterable.":"Symbol.iterator is not defined.")}(qe),bt={},Dt("next"),Dt("throw"),Dt("return"),bt[Symbol.asyncIterator]=function(){return this},bt);function Dt(Ot){bt[Ot]=qe[Ot]&&function(On){return new Promise(function(ei,ji){!function Ut(Ot,On,ei,ji){Promise.resolve(ji).then(function(ln){Ot({value:ln,done:ei})},On)}(ei,ji,(On=qe[Ot](On)).done,On.value)})}}}Te.d(Ke,{FC:()=>Se,KL:()=>Zn,mG:()=>Qt,qq:()=>Pt})},7340:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{LC:()=>W,X$:()=>c,ZE:()=>rn,ZN:()=>pn,_7:()=>It,_j:()=>Y,eR:()=>_t,jt:()=>Re,k1:()=>an,l3:()=>Xe,oB:()=>Tt,oQ:()=>Qt,vP:()=>xt});class Y{}class W{}const Xe="*";function c(Pt,Se){return{type:7,name:Pt,definitions:Se,options:{}}}function Re(Pt,Se=null){return{type:4,styles:Se,timings:Pt}}function xt(Pt,Se=null){return{type:2,steps:Pt,options:Se}}function Tt(Pt){return{type:6,styles:Pt,offset:null}}function _t(Pt,Se,fn=null){return{type:1,expr:Pt,animation:Se,options:fn}}function Qt(Pt,Se=null){return{type:8,animation:Pt,options:Se}}function It(Pt,Se=null){return{type:10,animation:Pt,options:Se}}function Nn(Pt){Promise.resolve().then(Pt)}class pn{constructor(Se=0,fn=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=Se+fn}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(Se=>Se()),this._onDoneFns=[])}onStart(Se){this._originalOnStartFns.push(Se),this._onStartFns.push(Se)}onDone(Se){this._originalOnDoneFns.push(Se),this._onDoneFns.push(Se)}onDestroy(Se){this._onDestroyFns.push(Se)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){Nn(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(Se=>Se()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(Se=>Se()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(Se){this._position=this.totalTime?Se*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(Se){const fn="start"==Se?this._onStartFns:this._onDoneFns;fn.forEach(Zn=>Zn()),fn.length=0}}class rn{constructor(Se){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=Se;let fn=0,Zn=0,tt=0;const kt=this.players.length;0==kt?Nn(()=>this._onFinish()):this.players.forEach(pt=>{pt.onDone(()=>{++fn==kt&&this._onFinish()}),pt.onDestroy(()=>{++Zn==kt&&this._onDestroy()}),pt.onStart(()=>{++tt==kt&&this._onStart()})}),this.totalTime=this.players.reduce((pt,zt)=>Math.max(pt,zt.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(Se=>Se()),this._onDoneFns=[])}init(){this.players.forEach(Se=>Se.init())}onStart(Se){this._onStartFns.push(Se)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(Se=>Se()),this._onStartFns=[])}onDone(Se){this._onDoneFns.push(Se)}onDestroy(Se){this._onDestroyFns.push(Se)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(Se=>Se.play())}pause(){this.players.forEach(Se=>Se.pause())}restart(){this.players.forEach(Se=>Se.restart())}finish(){this._onFinish(),this.players.forEach(Se=>Se.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(Se=>Se.destroy()),this._onDestroyFns.forEach(Se=>Se()),this._onDestroyFns=[])}reset(){this.players.forEach(Se=>Se.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(Se){const fn=Se*this.totalTime;this.players.forEach(Zn=>{const tt=Zn.totalTime?Math.min(1,fn/Zn.totalTime):1;Zn.setPosition(tt)})}getPosition(){const Se=this.players.reduce((fn,Zn)=>null===fn||Zn.totalTime>fn.totalTime?Zn:fn,null);return null!=Se?Se.getPosition():0}beforeDestroy(){this.players.forEach(Se=>{Se.beforeDestroy&&Se.beforeDestroy()})}triggerCallback(Se){const fn="start"==Se?this._onStartFns:this._onDoneFns;fn.forEach(Zn=>Zn()),fn.length=0}}const an="!"},6895:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{Do:()=>rn,EM:()=>xs,HT:()=>c,JF:()=>yo,JJ:()=>ur,K0:()=>nn,Mx:()=>ft,NF:()=>da,O5:()=>hn,PC:()=>co,S$:()=>Yt,V_:()=>Et,Ye:()=>an,b0:()=>pn,bD:()=>Ss,ez:()=>Ca,mk:()=>bi,q:()=>Xe,sg:()=>Zo,tP:()=>Zr,w_:()=>Re});var Y=Te(8256);let W=null;function Xe(){return W}function c(N){W||(W=N)}class Re{}const nn=new Y.OlP("DocumentToken");let xt=(()=>{class N{historyGo(j){throw new Error("Not implemented")}}return N.\u0275fac=function(j){return new(j||N)},N.\u0275prov=Y.Yz7({token:N,factory:function(){return function Tt(){return(0,Y.LFG)(At)}()},providedIn:"platform"}),N})();const Et=new Y.OlP("Location Initialized");let At=(()=>{class N extends xt{constructor(j){super(),this._doc=j,this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return Xe().getBaseHref(this._doc)}onPopState(j){const ue=Xe().getGlobalEventTarget(this._doc,"window");return ue.addEventListener("popstate",j,!1),()=>ue.removeEventListener("popstate",j)}onHashChange(j){const ue=Xe().getGlobalEventTarget(this._doc,"window");return ue.addEventListener("hashchange",j,!1),()=>ue.removeEventListener("hashchange",j)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(j){this._location.pathname=j}pushState(j,ue,Ae){_t()?this._history.pushState(j,ue,Ae):this._location.hash=Ae}replaceState(j,ue,Ae){_t()?this._history.replaceState(j,ue,Ae):this._location.hash=Ae}forward(){this._history.forward()}back(){this._history.back()}historyGo(j=0){this._history.go(j)}getState(){return this._history.state}}return N.\u0275fac=function(j){return new(j||N)(Y.LFG(nn))},N.\u0275prov=Y.Yz7({token:N,factory:function(){return function Qt(){return new At((0,Y.LFG)(nn))}()},providedIn:"platform"}),N})();function _t(){return!!window.history.pushState}function An(N,J){if(0==N.length)return J;if(0==J.length)return N;let j=0;return N.endsWith("/")&&j++,J.startsWith("/")&&j++,2==j?N+J.substring(1):1==j?N+J:N+"/"+J}function It(N){const J=N.match(/#|\?|$/),j=J&&J.index||N.length;return N.slice(0,j-("/"===N[j-1]?1:0))+N.slice(j)}function bn(N){return N&&"?"!==N[0]?"?"+N:N}let Yt=(()=>{class N{historyGo(j){throw new Error("Not implemented")}}return N.\u0275fac=function(j){return new(j||N)},N.\u0275prov=Y.Yz7({token:N,factory:function(){return(0,Y.f3M)(pn)},providedIn:"root"}),N})();const Nn=new Y.OlP("appBaseHref");let pn=(()=>{class N extends Yt{constructor(j,ue){super(),this._platformLocation=j,this._removeListenerFns=[],this._baseHref=ue??this._platformLocation.getBaseHrefFromDOM()??(0,Y.f3M)(nn).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(j){this._removeListenerFns.push(this._platformLocation.onPopState(j),this._platformLocation.onHashChange(j))}getBaseHref(){return this._baseHref}prepareExternalUrl(j){return An(this._baseHref,j)}path(j=!1){const ue=this._platformLocation.pathname+bn(this._platformLocation.search),Ae=this._platformLocation.hash;return Ae&&j?`${ue}${Ae}`:ue}pushState(j,ue,Ae,et){const x=this.prepareExternalUrl(Ae+bn(et));this._platformLocation.pushState(j,ue,x)}replaceState(j,ue,Ae,et){const x=this.prepareExternalUrl(Ae+bn(et));this._platformLocation.replaceState(j,ue,x)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(j=0){this._platformLocation.historyGo?.(j)}}return N.\u0275fac=function(j){return new(j||N)(Y.LFG(xt),Y.LFG(Nn,8))},N.\u0275prov=Y.Yz7({token:N,factory:N.\u0275fac,providedIn:"root"}),N})(),rn=(()=>{class N extends Yt{constructor(j,ue){super(),this._platformLocation=j,this._baseHref="",this._removeListenerFns=[],null!=ue&&(this._baseHref=ue)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(j){this._removeListenerFns.push(this._platformLocation.onPopState(j),this._platformLocation.onHashChange(j))}getBaseHref(){return this._baseHref}path(j=!1){let ue=this._platformLocation.hash;return null==ue&&(ue="#"),ue.length>0?ue.substring(1):ue}prepareExternalUrl(j){const ue=An(this._baseHref,j);return ue.length>0?"#"+ue:ue}pushState(j,ue,Ae,et){let x=this.prepareExternalUrl(Ae+bn(et));0==x.length&&(x=this._platformLocation.pathname),this._platformLocation.pushState(j,ue,x)}replaceState(j,ue,Ae,et){let x=this.prepareExternalUrl(Ae+bn(et));0==x.length&&(x=this._platformLocation.pathname),this._platformLocation.replaceState(j,ue,x)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(j=0){this._platformLocation.historyGo?.(j)}}return N.\u0275fac=function(j){return new(j||N)(Y.LFG(xt),Y.LFG(Nn,8))},N.\u0275prov=Y.Yz7({token:N,factory:N.\u0275fac}),N})(),an=(()=>{class N{constructor(j){this._subject=new Y.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=j;const ue=this._locationStrategy.getBaseHref();this._basePath=function Zn(N){if(new RegExp("^(https?:)?//").test(N)){const[,j]=N.split(/\/\/[^\/]+/);return j}return N}(It(fn(ue))),this._locationStrategy.onPopState(Ae=>{this._subject.emit({url:this.path(!0),pop:!0,state:Ae.state,type:Ae.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(j=!1){return this.normalize(this._locationStrategy.path(j))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(j,ue=""){return this.path()==this.normalize(j+bn(ue))}normalize(j){return N.stripTrailingSlash(function Se(N,J){if(!N||!J.startsWith(N))return J;const j=J.substring(N.length);return""===j||["/",";","?","#"].includes(j[0])?j:J}(this._basePath,fn(j)))}prepareExternalUrl(j){return j&&"/"!==j[0]&&(j="/"+j),this._locationStrategy.prepareExternalUrl(j)}go(j,ue="",Ae=null){this._locationStrategy.pushState(Ae,"",j,ue),this._notifyUrlChangeListeners(this.prepareExternalUrl(j+bn(ue)),Ae)}replaceState(j,ue="",Ae=null){this._locationStrategy.replaceState(Ae,"",j,ue),this._notifyUrlChangeListeners(this.prepareExternalUrl(j+bn(ue)),Ae)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(j=0){this._locationStrategy.historyGo?.(j)}onUrlChange(j){return this._urlChangeListeners.push(j),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(ue=>{this._notifyUrlChangeListeners(ue.url,ue.state)})),()=>{const ue=this._urlChangeListeners.indexOf(j);this._urlChangeListeners.splice(ue,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(j="",ue){this._urlChangeListeners.forEach(Ae=>Ae(j,ue))}subscribe(j,ue,Ae){return this._subject.subscribe({next:j,error:ue,complete:Ae})}}return N.normalizeQueryParams=bn,N.joinWithSlash=An,N.stripTrailingSlash=It,N.\u0275fac=function(j){return new(j||N)(Y.LFG(Yt))},N.\u0275prov=Y.Yz7({token:N,factory:function(){return function Pt(){return new an((0,Y.LFG)(Yt))}()},providedIn:"root"}),N})();function fn(N){return N.replace(/\/index.html$/,"")}var kt=(()=>((kt=kt||{})[kt.Decimal=0]="Decimal",kt[kt.Percent=1]="Percent",kt[kt.Currency=2]="Currency",kt[kt.Scientific=3]="Scientific",kt))(),Mt=(()=>((Mt=Mt||{})[Mt.Decimal=0]="Decimal",Mt[Mt.Group=1]="Group",Mt[Mt.List=2]="List",Mt[Mt.PercentSign=3]="PercentSign",Mt[Mt.PlusSign=4]="PlusSign",Mt[Mt.MinusSign=5]="MinusSign",Mt[Mt.Exponential=6]="Exponential",Mt[Mt.SuperscriptingExponent=7]="SuperscriptingExponent",Mt[Mt.PerMille=8]="PerMille",Mt[Mt.Infinity=9]="Infinity",Mt[Mt.NaN=10]="NaN",Mt[Mt.TimeSeparator=11]="TimeSeparator",Mt[Mt.CurrencyDecimal=12]="CurrencyDecimal",Mt[Mt.CurrencyGroup=13]="CurrencyGroup",Mt))();function Rn(N,J){const j=(0,Y.cg1)(N),ue=j[Y.wAp.NumberSymbols][J];if(typeof ue>"u"){if(J===Mt.CurrencyDecimal)return j[Y.wAp.NumberSymbols][Mt.Decimal];if(J===Mt.CurrencyGroup)return j[Y.wAp.NumberSymbols][Mt.Group]}return ue}const Ne=/^(\d+)?\.((\d+)(-(\d+))?)?$/,ge=22,$e=".",dt="0",on=";",_n=",",Tn="#";function Ho(N){const J=parseInt(N);if(isNaN(J))throw new Error("Invalid integer literal when parsing "+N);return J}function ft(N,J){J=encodeURIComponent(J);for(const j of N.split(";")){const ue=j.indexOf("="),[Ae,et]=-1==ue?[j,""]:[j.slice(0,ue),j.slice(ue+1)];if(Ae.trim()===J)return decodeURIComponent(et)}return null}const ti=/\s+/,ai=[];let bi=(()=>{class N{constructor(j,ue,Ae,et){this._iterableDiffers=j,this._keyValueDiffers=ue,this._ngEl=Ae,this._renderer=et,this.initialClasses=ai,this.stateMap=new Map}set klass(j){this.initialClasses=null!=j?j.trim().split(ti):ai}set ngClass(j){this.rawClass="string"==typeof j?j.trim().split(ti):j}ngDoCheck(){for(const ue of this.initialClasses)this._updateState(ue,!0);const j=this.rawClass;if(Array.isArray(j)||j instanceof Set)for(const ue of j)this._updateState(ue,!0);else if(null!=j)for(const ue of Object.keys(j))this._updateState(ue,Boolean(j[ue]));this._applyStateDiff()}_updateState(j,ue){const Ae=this.stateMap.get(j);void 0!==Ae?(Ae.enabled!==ue&&(Ae.changed=!0,Ae.enabled=ue),Ae.touched=!0):this.stateMap.set(j,{enabled:ue,changed:!0,touched:!0})}_applyStateDiff(){for(const j of this.stateMap){const ue=j[0],Ae=j[1];Ae.changed?(this._toggleClass(ue,Ae.enabled),Ae.changed=!1):Ae.touched||(Ae.enabled&&this._toggleClass(ue,!1),this.stateMap.delete(ue)),Ae.touched=!1}}_toggleClass(j,ue){(j=j.trim()).length>0&&j.split(ti).forEach(Ae=>{ue?this._renderer.addClass(this._ngEl.nativeElement,Ae):this._renderer.removeClass(this._ngEl.nativeElement,Ae)})}}return N.\u0275fac=function(j){return new(j||N)(Y.Y36(Y.ZZ4),Y.Y36(Y.aQg),Y.Y36(Y.SBq),Y.Y36(Y.Qsj))},N.\u0275dir=Y.lG2({type:N,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),N})();class Po{constructor(J,j,ue,Ae){this.$implicit=J,this.ngForOf=j,this.index=ue,this.count=Ae}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Zo=(()=>{class N{set ngForOf(j){this._ngForOf=j,this._ngForOfDirty=!0}set ngForTrackBy(j){this._trackByFn=j}get ngForTrackBy(){return this._trackByFn}constructor(j,ue,Ae){this._viewContainer=j,this._template=ue,this._differs=Ae,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(j){j&&(this._template=j)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const j=this._ngForOf;!this._differ&&j&&(this._differ=this._differs.find(j).create(this.ngForTrackBy))}if(this._differ){const j=this._differ.diff(this._ngForOf);j&&this._applyChanges(j)}}_applyChanges(j){const ue=this._viewContainer;j.forEachOperation((Ae,et,x)=>{if(null==Ae.previousIndex)ue.createEmbeddedView(this._template,new Po(Ae.item,this._ngForOf,-1,-1),null===x?void 0:x);else if(null==x)ue.remove(null===et?void 0:et);else if(null!==et){const E=ue.get(et);ue.move(E,x),tn(E,Ae)}});for(let Ae=0,et=ue.length;Ae<et;Ae++){const E=ue.get(Ae).context;E.index=Ae,E.count=et,E.ngForOf=this._ngForOf}j.forEachIdentityChange(Ae=>{tn(ue.get(Ae.currentIndex),Ae)})}static ngTemplateContextGuard(j,ue){return!0}}return N.\u0275fac=function(j){return new(j||N)(Y.Y36(Y.s_b),Y.Y36(Y.Rgc),Y.Y36(Y.ZZ4))},N.\u0275dir=Y.lG2({type:N,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),N})();function tn(N,J){N.context.$implicit=J.item}let hn=(()=>{class N{constructor(j,ue){this._viewContainer=j,this._context=new Mi,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=ue}set ngIf(j){this._context.$implicit=this._context.ngIf=j,this._updateView()}set ngIfThen(j){Qi("ngIfThen",j),this._thenTemplateRef=j,this._thenViewRef=null,this._updateView()}set ngIfElse(j){Qi("ngIfElse",j),this._elseTemplateRef=j,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(j,ue){return!0}}return N.\u0275fac=function(j){return new(j||N)(Y.Y36(Y.s_b),Y.Y36(Y.Rgc))},N.\u0275dir=Y.lG2({type:N,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),N})();class Mi{constructor(){this.$implicit=null,this.ngIf=null}}function Qi(N,J){if(J&&!J.createEmbeddedView)throw new Error(`${N} must be a TemplateRef, but received '${(0,Y.AaK)(J)}'.`)}let co=(()=>{class N{constructor(j,ue,Ae){this._ngEl=j,this._differs=ue,this._renderer=Ae,this._ngStyle=null,this._differ=null}set ngStyle(j){this._ngStyle=j,!this._differ&&j&&(this._differ=this._differs.find(j).create())}ngDoCheck(){if(this._differ){const j=this._differ.diff(this._ngStyle);j&&this._applyChanges(j)}}_setStyle(j,ue){const[Ae,et]=j.split("."),x=-1===Ae.indexOf("-")?void 0:Y.JOm.DashCase;null!=ue?this._renderer.setStyle(this._ngEl.nativeElement,Ae,et?`${ue}${et}`:ue,x):this._renderer.removeStyle(this._ngEl.nativeElement,Ae,x)}_applyChanges(j){j.forEachRemovedItem(ue=>this._setStyle(ue.key,null)),j.forEachAddedItem(ue=>this._setStyle(ue.key,ue.currentValue)),j.forEachChangedItem(ue=>this._setStyle(ue.key,ue.currentValue))}}return N.\u0275fac=function(j){return new(j||N)(Y.Y36(Y.SBq),Y.Y36(Y.aQg),Y.Y36(Y.Qsj))},N.\u0275dir=Y.lG2({type:N,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),N})(),Zr=(()=>{class N{constructor(j){this._viewContainerRef=j,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(j){if(j.ngTemplateOutlet||j.ngTemplateOutletInjector){const ue=this._viewContainerRef;if(this._viewRef&&ue.remove(ue.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:Ae,ngTemplateOutletContext:et,ngTemplateOutletInjector:x}=this;this._viewRef=ue.createEmbeddedView(Ae,et,x?{injector:x}:void 0)}else this._viewRef=null}else this._viewRef&&j.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return N.\u0275fac=function(j){return new(j||N)(Y.Y36(Y.s_b))},N.\u0275dir=Y.lG2({type:N,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[Y.TTD]}),N})();let ur=(()=>{class N{constructor(j){this._locale=j}transform(j,ue,Ae){if(!function Gs(N){return!(null==N||""===N||N!=N)}(j))return null;Ae=Ae||this._locale;try{return function Do(N,J,j){return function Yr(N,J,j,ue,Ae,et,x=!1){let E="",I=!1;if(isFinite(N)){let H=function mo(N){let ue,Ae,et,x,E,J=Math.abs(N)+"",j=0;for((Ae=J.indexOf($e))>-1&&(J=J.replace($e,"")),(et=J.search(/e/i))>0?(Ae<0&&(Ae=et),Ae+=+J.slice(et+1),J=J.substring(0,et)):Ae<0&&(Ae=J.length),et=0;J.charAt(et)===dt;et++);if(et===(E=J.length))ue=[0],Ae=1;else{for(E--;J.charAt(E)===dt;)E--;for(Ae-=et,ue=[],x=0;et<=E;et++,x++)ue[x]=Number(J.charAt(et))}return Ae>ge&&(ue=ue.splice(0,ge-1),j=Ae-1,Ae=1),{digits:ue,exponent:j,integerLen:Ae}}(N);x&&(H=function ss(N){if(0===N.digits[0])return N;const J=N.digits.length-N.integerLen;return N.exponent?N.exponent+=2:(0===J?N.digits.push(0,0):1===J&&N.digits.push(0),N.integerLen+=2),N}(H));let pe=J.minInt,We=J.minFrac,en=J.maxFrac;if(et){const ts=et.match(Ne);if(null===ts)throw new Error(`${et} is not a valid digit info`);const Zt=ts[1],Nr=ts[3],qr=ts[5];null!=Zt&&(pe=Ho(Zt)),null!=Nr&&(We=Ho(Nr)),null!=qr?en=Ho(qr):null!=Nr&&We>en&&(en=We)}!function as(N,J,j){if(J>j)throw new Error(`The minimum number of digits after fraction (${J}) is higher than the maximum (${j}).`);let ue=N.digits,Ae=ue.length-N.integerLen;const et=Math.min(Math.max(J,Ae),j);let x=et+N.integerLen,E=ue[x];if(x>0){ue.splice(Math.max(N.integerLen,x));for(let We=x;We<ue.length;We++)ue[We]=0}else{Ae=Math.max(0,Ae),N.integerLen=1,ue.length=Math.max(1,x=et+1),ue[0]=0;for(let We=1;We<x;We++)ue[We]=0}if(E>=5)if(x-1<0){for(let We=0;We>x;We--)ue.unshift(0),N.integerLen++;ue.unshift(1),N.integerLen++}else ue[x-1]++;for(;Ae<Math.max(0,et);Ae++)ue.push(0);let I=0!==et;const H=J+N.integerLen,pe=ue.reduceRight(function(We,en,Ln,zn){return zn[Ln]=(en+=We)<10?en:en-10,I&&(0===zn[Ln]&&Ln>=H?zn.pop():I=!1),en>=10?1:0},0);pe&&(ue.unshift(pe),N.integerLen++)}(H,We,en);let Ln=H.digits,zn=H.integerLen;const Gi=H.exponent;let Ti=[];for(I=Ln.every(ts=>!ts);zn<pe;zn++)Ln.unshift(0);for(;zn<0;zn++)Ln.unshift(0);zn>0?Ti=Ln.splice(zn,Ln.length):(Ti=Ln,Ln=[0]);const Xs=[];for(Ln.length>=J.lgSize&&Xs.unshift(Ln.splice(-J.lgSize,Ln.length).join(""));Ln.length>J.gSize;)Xs.unshift(Ln.splice(-J.gSize,Ln.length).join(""));Ln.length&&Xs.unshift(Ln.join("")),E=Xs.join(Rn(j,ue)),Ti.length&&(E+=Rn(j,Ae)+Ti.join("")),Gi&&(E+=Rn(j,Mt.Exponential)+"+"+Gi)}else E=Rn(j,Mt.Infinity);return E=N<0&&!I?J.negPre+E+J.negSuf:J.posPre+E+J.posSuf,E}(N,function vs(N,J="-"){const j={minInt:1,minFrac:0,maxFrac:0,posPre:"",posSuf:"",negPre:"",negSuf:"",gSize:0,lgSize:0},ue=N.split(on),Ae=ue[0],et=ue[1],x=-1!==Ae.indexOf($e)?Ae.split($e):[Ae.substring(0,Ae.lastIndexOf(dt)+1),Ae.substring(Ae.lastIndexOf(dt)+1)],E=x[0],I=x[1]||"";j.posPre=E.substring(0,E.indexOf(Tn));for(let pe=0;pe<I.length;pe++){const We=I.charAt(pe);We===dt?j.minFrac=j.maxFrac=pe+1:We===Tn?j.maxFrac=pe+1:j.posSuf+=We}const H=E.split(_n);if(j.gSize=H[1]?H[1].length:0,j.lgSize=H[2]||H[1]?(H[2]||H[1]).length:0,et){const pe=Ae.length-j.posPre.length-j.posSuf.length,We=et.indexOf(Tn);j.negPre=et.substring(0,We).replace(/'/g,""),j.negSuf=et.slice(We+pe).replace(/'/g,"")}else j.negPre=J+j.posPre,j.negSuf=j.posSuf;return j}(function un(N,J){return(0,Y.cg1)(N)[Y.wAp.NumberFormats][J]}(J,kt.Decimal),Rn(J,Mt.MinusSign)),J,Mt.Group,Mt.Decimal,j)}(function hs(N){if("string"==typeof N&&!isNaN(Number(N)-parseFloat(N)))return Number(N);if("number"!=typeof N)throw new Error(`${N} is not a number`);return N}(j),Ae,ue)}catch(et){throw function fr(N,J){return new Y.vHH(2100,!1)}()}}}return N.\u0275fac=function(j){return new(j||N)(Y.Y36(Y.soG,16))},N.\u0275pipe=Y.Yjl({name:"number",type:N,pure:!0,standalone:!0}),N})();let Ca=(()=>{class N{}return N.\u0275fac=function(j){return new(j||N)},N.\u0275mod=Y.oAB({type:N}),N.\u0275inj=Y.cJS({}),N})();const Ss="browser";function da(N){return N===Ss}let xs=(()=>{class N{}return N.\u0275prov=(0,Y.Yz7)({token:N,providedIn:"root",factory:()=>new fa((0,Y.LFG)(nn),window)}),N})();class fa{constructor(J,j){this.document=J,this.window=j,this.offset=()=>[0,0]}setOffset(J){this.offset=Array.isArray(J)?()=>J:J}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(J){this.supportsScrolling()&&this.window.scrollTo(J[0],J[1])}scrollToAnchor(J){if(!this.supportsScrolling())return;const j=function Oi(N,J){const j=N.getElementById(J)||N.getElementsByName(J)[0];if(j)return j;if("function"==typeof N.createTreeWalker&&N.body&&(N.body.createShadowRoot||N.body.attachShadow)){const ue=N.createTreeWalker(N.body,NodeFilter.SHOW_ELEMENT);let Ae=ue.currentNode;for(;Ae;){const et=Ae.shadowRoot;if(et){const x=et.getElementById(J)||et.querySelector(`[name="${J}"]`);if(x)return x}Ae=ue.nextNode()}}return null}(this.document,J);j&&(this.scrollToElement(j),j.focus())}setHistoryScrollRestoration(J){if(this.supportScrollRestoration()){const j=this.window.history;j&&j.scrollRestoration&&(j.scrollRestoration=J)}}scrollToElement(J){const j=J.getBoundingClientRect(),ue=j.left+this.window.pageXOffset,Ae=j.top+this.window.pageYOffset,et=this.offset();this.window.scrollTo(ue-et[0],Ae-et[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const J=Jo(this.window.history)||Jo(Object.getPrototypeOf(this.window.history));return!(!J||!J.writable&&!J.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function Jo(N){return Object.getOwnPropertyDescriptor(N,"scrollRestoration")}class yo{}},529:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{JF:()=>xe,PG:()=>Tt,WM:()=>At,eN:()=>qe});var Y=Te(6895),W=Te(8256),Xe=Te(9646),c=Te(9751),Re=Te(4351),nn=Te(9300),xt=Te(4004);class Tt{}class Et{}class At{constructor(oe){this.normalizedNames=new Map,this.lazyUpdate=null,oe?this.lazyInit="string"==typeof oe?()=>{this.headers=new Map,oe.split("\n").forEach(re=>{const Ce=re.indexOf(":");if(Ce>0){const je=re.slice(0,Ce),Ye=je.toLowerCase(),ut=re.slice(Ce+1).trim();this.maybeSetNormalizedName(je,Ye),this.headers.has(Ye)?this.headers.get(Ye).push(ut):this.headers.set(Ye,[ut])}})}:()=>{this.headers=new Map,Object.entries(oe).forEach(([re,Ce])=>{let je;if(je="string"==typeof Ce?[Ce]:"number"==typeof Ce?[Ce.toString()]:Ce.map(Ye=>Ye.toString()),je.length>0){const Ye=re.toLowerCase();this.headers.set(Ye,je),this.maybeSetNormalizedName(re,Ye)}})}:this.headers=new Map}has(oe){return this.init(),this.headers.has(oe.toLowerCase())}get(oe){this.init();const re=this.headers.get(oe.toLowerCase());return re&&re.length>0?re[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(oe){return this.init(),this.headers.get(oe.toLowerCase())||null}append(oe,re){return this.clone({name:oe,value:re,op:"a"})}set(oe,re){return this.clone({name:oe,value:re,op:"s"})}delete(oe,re){return this.clone({name:oe,value:re,op:"d"})}maybeSetNormalizedName(oe,re){this.normalizedNames.has(re)||this.normalizedNames.set(re,oe)}init(){this.lazyInit&&(this.lazyInit instanceof At?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(oe=>this.applyUpdate(oe)),this.lazyUpdate=null))}copyFrom(oe){oe.init(),Array.from(oe.headers.keys()).forEach(re=>{this.headers.set(re,oe.headers.get(re)),this.normalizedNames.set(re,oe.normalizedNames.get(re))})}clone(oe){const re=new At;return re.lazyInit=this.lazyInit&&this.lazyInit instanceof At?this.lazyInit:this,re.lazyUpdate=(this.lazyUpdate||[]).concat([oe]),re}applyUpdate(oe){const re=oe.name.toLowerCase();switch(oe.op){case"a":case"s":let Ce=oe.value;if("string"==typeof Ce&&(Ce=[Ce]),0===Ce.length)return;this.maybeSetNormalizedName(oe.name,re);const je=("a"===oe.op?this.headers.get(re):void 0)||[];je.push(...Ce),this.headers.set(re,je);break;case"d":const Ye=oe.value;if(Ye){let ut=this.headers.get(re);if(!ut)return;ut=ut.filter(Dn=>-1===Ye.indexOf(Dn)),0===ut.length?(this.headers.delete(re),this.normalizedNames.delete(re)):this.headers.set(re,ut)}else this.headers.delete(re),this.normalizedNames.delete(re)}}forEach(oe){this.init(),Array.from(this.normalizedNames.keys()).forEach(re=>oe(this.normalizedNames.get(re),this.headers.get(re)))}}class Qt{encodeKey(oe){return Yt(oe)}encodeValue(oe){return Yt(oe)}decodeKey(oe){return decodeURIComponent(oe)}decodeValue(oe){return decodeURIComponent(oe)}}const It=/%(\d[a-f0-9])/gi,bn={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function Yt(fe){return encodeURIComponent(fe).replace(It,(oe,re)=>bn[re]??oe)}function Nn(fe){return`${fe}`}class pn{constructor(oe={}){if(this.updates=null,this.cloneFrom=null,this.encoder=oe.encoder||new Qt,oe.fromString){if(oe.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function An(fe,oe){const re=new Map;return fe.length>0&&fe.replace(/^\?/,"").split("&").forEach(je=>{const Ye=je.indexOf("="),[ut,Dn]=-1==Ye?[oe.decodeKey(je),""]:[oe.decodeKey(je.slice(0,Ye)),oe.decodeValue(je.slice(Ye+1))],cn=re.get(ut)||[];cn.push(Dn),re.set(ut,cn)}),re}(oe.fromString,this.encoder)}else oe.fromObject?(this.map=new Map,Object.keys(oe.fromObject).forEach(re=>{const Ce=oe.fromObject[re],je=Array.isArray(Ce)?Ce.map(Nn):[Nn(Ce)];this.map.set(re,je)})):this.map=null}has(oe){return this.init(),this.map.has(oe)}get(oe){this.init();const re=this.map.get(oe);return re?re[0]:null}getAll(oe){return this.init(),this.map.get(oe)||null}keys(){return this.init(),Array.from(this.map.keys())}append(oe,re){return this.clone({param:oe,value:re,op:"a"})}appendAll(oe){const re=[];return Object.keys(oe).forEach(Ce=>{const je=oe[Ce];Array.isArray(je)?je.forEach(Ye=>{re.push({param:Ce,value:Ye,op:"a"})}):re.push({param:Ce,value:je,op:"a"})}),this.clone(re)}set(oe,re){return this.clone({param:oe,value:re,op:"s"})}delete(oe,re){return this.clone({param:oe,value:re,op:"d"})}toString(){return this.init(),this.keys().map(oe=>{const re=this.encoder.encodeKey(oe);return this.map.get(oe).map(Ce=>re+"="+this.encoder.encodeValue(Ce)).join("&")}).filter(oe=>""!==oe).join("&")}clone(oe){const re=new pn({encoder:this.encoder});return re.cloneFrom=this.cloneFrom||this,re.updates=(this.updates||[]).concat(oe),re}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(oe=>this.map.set(oe,this.cloneFrom.map.get(oe))),this.updates.forEach(oe=>{switch(oe.op){case"a":case"s":const re=("a"===oe.op?this.map.get(oe.param):void 0)||[];re.push(Nn(oe.value)),this.map.set(oe.param,re);break;case"d":if(void 0===oe.value){this.map.delete(oe.param);break}{let Ce=this.map.get(oe.param)||[];const je=Ce.indexOf(Nn(oe.value));-1!==je&&Ce.splice(je,1),Ce.length>0?this.map.set(oe.param,Ce):this.map.delete(oe.param)}}}),this.cloneFrom=this.updates=null)}}class an{constructor(){this.map=new Map}set(oe,re){return this.map.set(oe,re),this}get(oe){return this.map.has(oe)||this.map.set(oe,oe.defaultValue()),this.map.get(oe)}delete(oe){return this.map.delete(oe),this}has(oe){return this.map.has(oe)}keys(){return this.map.keys()}}function Se(fe){return typeof ArrayBuffer<"u"&&fe instanceof ArrayBuffer}function fn(fe){return typeof Blob<"u"&&fe instanceof Blob}function Zn(fe){return typeof FormData<"u"&&fe instanceof FormData}class kt{constructor(oe,re,Ce,je){let Ye;if(this.url=re,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=oe.toUpperCase(),function Pt(fe){switch(fe){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||je?(this.body=void 0!==Ce?Ce:null,Ye=je):Ye=Ce,Ye&&(this.reportProgress=!!Ye.reportProgress,this.withCredentials=!!Ye.withCredentials,Ye.responseType&&(this.responseType=Ye.responseType),Ye.headers&&(this.headers=Ye.headers),Ye.context&&(this.context=Ye.context),Ye.params&&(this.params=Ye.params)),this.headers||(this.headers=new At),this.context||(this.context=new an),this.params){const ut=this.params.toString();if(0===ut.length)this.urlWithParams=re;else{const Dn=re.indexOf("?");this.urlWithParams=re+(-1===Dn?"?":Dn<re.length-1?"&":"")+ut}}else this.params=new pn,this.urlWithParams=re}serializeBody(){return null===this.body?null:Se(this.body)||fn(this.body)||Zn(this.body)||function tt(fe){return typeof URLSearchParams<"u"&&fe instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof pn?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||Zn(this.body)?null:fn(this.body)?this.body.type||null:Se(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof pn?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(oe={}){const re=oe.method||this.method,Ce=oe.url||this.url,je=oe.responseType||this.responseType,Ye=void 0!==oe.body?oe.body:this.body,ut=void 0!==oe.withCredentials?oe.withCredentials:this.withCredentials,Dn=void 0!==oe.reportProgress?oe.reportProgress:this.reportProgress;let cn=oe.headers||this.headers,gn=oe.params||this.params;const Fn=oe.context??this.context;return void 0!==oe.setHeaders&&(cn=Object.keys(oe.setHeaders).reduce((Ve,Ne)=>Ve.set(Ne,oe.setHeaders[Ne]),cn)),oe.setParams&&(gn=Object.keys(oe.setParams).reduce((Ve,Ne)=>Ve.set(Ne,oe.setParams[Ne]),gn)),new kt(re,Ce,Ye,{params:gn,headers:cn,context:Fn,reportProgress:Dn,responseType:je,withCredentials:ut})}}var pt=(()=>((pt=pt||{})[pt.Sent=0]="Sent",pt[pt.UploadProgress=1]="UploadProgress",pt[pt.ResponseHeader=2]="ResponseHeader",pt[pt.DownloadProgress=3]="DownloadProgress",pt[pt.Response=4]="Response",pt[pt.User=5]="User",pt))();class zt{constructor(oe,re=200,Ce="OK"){this.headers=oe.headers||new At,this.status=void 0!==oe.status?oe.status:re,this.statusText=oe.statusText||Ce,this.url=oe.url||null,this.ok=this.status>=200&&this.status<300}}class En extends zt{constructor(oe={}){super(oe),this.type=pt.ResponseHeader}clone(oe={}){return new En({headers:oe.headers||this.headers,status:void 0!==oe.status?oe.status:this.status,statusText:oe.statusText||this.statusText,url:oe.url||this.url||void 0})}}class yi extends zt{constructor(oe={}){super(oe),this.type=pt.Response,this.body=void 0!==oe.body?oe.body:null}clone(oe={}){return new yi({body:void 0!==oe.body?oe.body:this.body,headers:oe.headers||this.headers,status:void 0!==oe.status?oe.status:this.status,statusText:oe.statusText||this.statusText,url:oe.url||this.url||void 0})}}class Mt extends zt{constructor(oe){super(oe,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${oe.url||"(unknown url)"}`:`Http failure response for ${oe.url||"(unknown url)"}: ${oe.status} ${oe.statusText}`,this.error=oe.error||null}}function Bi(fe,oe){return{body:oe,headers:fe.headers,context:fe.context,observe:fe.observe,params:fe.params,reportProgress:fe.reportProgress,responseType:fe.responseType,withCredentials:fe.withCredentials}}let qe=(()=>{class fe{constructor(re){this.handler=re}request(re,Ce,je={}){let Ye;if(re instanceof kt)Ye=re;else{let cn,gn;cn=je.headers instanceof At?je.headers:new At(je.headers),je.params&&(gn=je.params instanceof pn?je.params:new pn({fromObject:je.params})),Ye=new kt(re,Ce,void 0!==je.body?je.body:null,{headers:cn,context:je.context,params:gn,reportProgress:je.reportProgress,responseType:je.responseType||"json",withCredentials:je.withCredentials})}const ut=(0,Xe.of)(Ye).pipe((0,Re.b)(cn=>this.handler.handle(cn)));if(re instanceof kt||"events"===je.observe)return ut;const Dn=ut.pipe((0,nn.h)(cn=>cn instanceof yi));switch(je.observe||"body"){case"body":switch(Ye.responseType){case"arraybuffer":return Dn.pipe((0,xt.U)(cn=>{if(null!==cn.body&&!(cn.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return cn.body}));case"blob":return Dn.pipe((0,xt.U)(cn=>{if(null!==cn.body&&!(cn.body instanceof Blob))throw new Error("Response is not a Blob.");return cn.body}));case"text":return Dn.pipe((0,xt.U)(cn=>{if(null!==cn.body&&"string"!=typeof cn.body)throw new Error("Response is not a string.");return cn.body}));default:return Dn.pipe((0,xt.U)(cn=>cn.body))}case"response":return Dn;default:throw new Error(`Unreachable: unhandled observe type ${je.observe}}`)}}delete(re,Ce={}){return this.request("DELETE",re,Ce)}get(re,Ce={}){return this.request("GET",re,Ce)}head(re,Ce={}){return this.request("HEAD",re,Ce)}jsonp(re,Ce){return this.request("JSONP",re,{params:(new pn).append(Ce,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(re,Ce={}){return this.request("OPTIONS",re,Ce)}patch(re,Ce,je={}){return this.request("PATCH",re,Bi(je,Ce))}post(re,Ce,je={}){return this.request("POST",re,Bi(je,Ce))}put(re,Ce,je={}){return this.request("PUT",re,Bi(je,Ce))}}return fe.\u0275fac=function(re){return new(re||fe)(W.LFG(Tt))},fe.\u0275prov=W.Yz7({token:fe,factory:fe.\u0275fac}),fe})();function at(fe,oe){return oe(fe)}function bt(fe,oe){return(re,Ce)=>oe.intercept(re,{handle:je=>fe(je,Ce)})}const Ut=new W.OlP("HTTP_INTERCEPTORS"),Ot=new W.OlP("HTTP_INTERCEPTOR_FNS");function On(){let fe=null;return(oe,re)=>(null===fe&&(fe=((0,W.f3M)(Ut,{optional:!0})??[]).reduceRight(bt,at)),fe(oe,re))}let ei=(()=>{class fe extends Tt{constructor(re,Ce){super(),this.backend=re,this.injector=Ce,this.chain=null}handle(re){if(null===this.chain){const Ce=Array.from(new Set(this.injector.get(Ot)));this.chain=Ce.reduceRight((je,Ye)=>function Dt(fe,oe,re){return(Ce,je)=>re.runInContext(()=>oe(Ce,Ye=>fe(Ye,je)))}(je,Ye,this.injector),at)}return this.chain(re,Ce=>this.backend.handle(Ce))}}return fe.\u0275fac=function(re){return new(re||fe)(W.LFG(Et),W.LFG(W.lqb))},fe.\u0275prov=W.Yz7({token:fe,factory:fe.\u0275fac}),fe})();const Wi=/^\)\]\}',?\n/;let Wt=(()=>{class fe{constructor(re){this.xhrFactory=re}handle(re){if("JSONP"===re.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new c.y(Ce=>{const je=this.xhrFactory.build();if(je.open(re.method,re.urlWithParams),re.withCredentials&&(je.withCredentials=!0),re.headers.forEach((ge,$e)=>je.setRequestHeader(ge,$e.join(","))),re.headers.has("Accept")||je.setRequestHeader("Accept","application/json, text/plain, */*"),!re.headers.has("Content-Type")){const ge=re.detectContentTypeHeader();null!==ge&&je.setRequestHeader("Content-Type",ge)}if(re.responseType){const ge=re.responseType.toLowerCase();je.responseType="json"!==ge?ge:"text"}const Ye=re.serializeBody();let ut=null;const Dn=()=>{if(null!==ut)return ut;const ge=je.statusText||"OK",$e=new At(je.getAllResponseHeaders()),dt=function si(fe){return"responseURL"in fe&&fe.responseURL?fe.responseURL:/^X-Request-URL:/m.test(fe.getAllResponseHeaders())?fe.getResponseHeader("X-Request-URL"):null}(je)||re.url;return ut=new En({headers:$e,status:je.status,statusText:ge,url:dt}),ut},cn=()=>{let{headers:ge,status:$e,statusText:dt,url:on}=Dn(),_n=null;204!==$e&&(_n=typeof je.response>"u"?je.responseText:je.response),0===$e&&($e=_n?200:0);let Tn=$e>=200&&$e<300;if("json"===re.responseType&&"string"==typeof _n){const Ai=_n;_n=_n.replace(Wi,"");try{_n=""!==_n?JSON.parse(_n):null}catch(po){_n=Ai,Tn&&(Tn=!1,_n={error:po,text:_n})}}Tn?(Ce.next(new yi({body:_n,headers:ge,status:$e,statusText:dt,url:on||void 0})),Ce.complete()):Ce.error(new Mt({error:_n,headers:ge,status:$e,statusText:dt,url:on||void 0}))},gn=ge=>{const{url:$e}=Dn(),dt=new Mt({error:ge,status:je.status||0,statusText:je.statusText||"Unknown Error",url:$e||void 0});Ce.error(dt)};let Fn=!1;const Ve=ge=>{Fn||(Ce.next(Dn()),Fn=!0);let $e={type:pt.DownloadProgress,loaded:ge.loaded};ge.lengthComputable&&($e.total=ge.total),"text"===re.responseType&&je.responseText&&($e.partialText=je.responseText),Ce.next($e)},Ne=ge=>{let $e={type:pt.UploadProgress,loaded:ge.loaded};ge.lengthComputable&&($e.total=ge.total),Ce.next($e)};return je.addEventListener("load",cn),je.addEventListener("error",gn),je.addEventListener("timeout",gn),je.addEventListener("abort",gn),re.reportProgress&&(je.addEventListener("progress",Ve),null!==Ye&&je.upload&&je.upload.addEventListener("progress",Ne)),je.send(Ye),Ce.next({type:pt.Sent}),()=>{je.removeEventListener("error",gn),je.removeEventListener("abort",gn),je.removeEventListener("load",cn),je.removeEventListener("timeout",gn),re.reportProgress&&(je.removeEventListener("progress",Ve),null!==Ye&&je.upload&&je.upload.removeEventListener("progress",Ne)),je.readyState!==je.DONE&&je.abort()}})}}return fe.\u0275fac=function(re){return new(re||fe)(W.LFG(Y.JF))},fe.\u0275prov=W.Yz7({token:fe,factory:fe.\u0275fac}),fe})();const Ar=new W.OlP("XSRF_ENABLED"),ni=new W.OlP("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),lo=new W.OlP("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class Vi{}let zr=(()=>{class fe{constructor(re,Ce,je){this.doc=re,this.platform=Ce,this.cookieName=je,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const re=this.doc.cookie||"";return re!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,Y.Mx)(re,this.cookieName),this.lastCookieString=re),this.lastToken}}return fe.\u0275fac=function(re){return new(re||fe)(W.LFG(Y.K0),W.LFG(W.Lbi),W.LFG(ni))},fe.\u0275prov=W.Yz7({token:fe,factory:fe.\u0275fac}),fe})();function Zi(fe,oe){const re=fe.url.toLowerCase();if(!(0,W.f3M)(Ar)||"GET"===fe.method||"HEAD"===fe.method||re.startsWith("http://")||re.startsWith("https://"))return oe(fe);const Ce=(0,W.f3M)(Vi).getToken(),je=(0,W.f3M)(lo);return null!=Ce&&!fe.headers.has(je)&&(fe=fe.clone({headers:fe.headers.set(je,Ce)})),oe(fe)}var ht=(()=>((ht=ht||{})[ht.Interceptors=0]="Interceptors",ht[ht.LegacyInterceptors=1]="LegacyInterceptors",ht[ht.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",ht[ht.NoXsrfProtection=3]="NoXsrfProtection",ht[ht.JsonpSupport=4]="JsonpSupport",ht[ht.RequestsMadeViaParent=5]="RequestsMadeViaParent",ht))();function Hi(fe,oe){return{\u0275kind:fe,\u0275providers:oe}}function Ri(...fe){const oe=[qe,Wt,ei,{provide:Tt,useExisting:ei},{provide:Et,useExisting:Wt},{provide:Ot,useValue:Zi,multi:!0},{provide:Ar,useValue:!0},{provide:Vi,useClass:zr}];for(const re of fe)oe.push(...re.\u0275providers);return(0,W.MR2)(oe)}const Wr=new W.OlP("LEGACY_INTERCEPTOR_FN");let xe=(()=>{class fe{}return fe.\u0275fac=function(re){return new(re||fe)},fe.\u0275mod=W.oAB({type:fe}),fe.\u0275inj=W.cJS({providers:[Ri(Hi(ht.LegacyInterceptors,[{provide:Wr,useFactory:On},{provide:Ot,useExisting:Wr,multi:!0}]))]}),fe})()},8256:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{QbO:()=>Hw,tb:()=>I0,AFp:()=>v0,ip1:()=>y0,CZH:()=>Vg,hGG:()=>Mb,z2F:()=>Hg,sBO:()=>fb,Sil:()=>Xw,_Vd:()=>Oh,EJc:()=>Ww,Xts:()=>Ih,SBq:()=>Wl,lqb:()=>Cs,qLn:()=>uu,vpe:()=>Gc,XFs:()=>jt,OlP:()=>ar,zs3:()=>hu,ZZ4:()=>Oy,aQg:()=>Fy,soG:()=>$g,YKP:()=>xv,h0i:()=>wf,PXZ:()=>lb,R0b:()=>Jl,FiY:()=>Pe,Lbi:()=>$w,g9A:()=>w0,Qsj:()=>Rd,FYo:()=>Mo,JOm:()=>ja,tp0:()=>He,Rgc:()=>Qp,dDg:()=>rb,eoX:()=>A0,GfV:()=>Fh,s_b:()=>Ng,ifc:()=>on,MMx:()=>cy,Lck:()=>Hx,eFA:()=>k0,Gpc:()=>rn,f3M:()=>Dn,$WT:()=>ls,MR2:()=>bm,_c5:()=>Ab,c2e:()=>Gw,zSh:()=>Pd,wAp:()=>fi,vHH:()=>tt,lri:()=>D0,rWj:()=>S0,D6c:()=>Ib,cg1:()=>od,kL8:()=>Hp,dqk:()=>vi,Z0I:()=>Ar,eJc:()=>vy,CqO:()=>Rp,QGY:()=>oh,F4k:()=>kp,RDi:()=>iu,AaK:()=>Yt,qOj:()=>Qh,TTD:()=>ws,_Bn:()=>vv,jDz:()=>bv,xp6:()=>Hu,uIk:()=>sf,Tol:()=>A,ekj:()=>g,Suo:()=>Zv,Xpm:()=>ss,lG2:()=>$s,Yz7:()=>li,cJS:()=>si,oAB:()=>Go,Yjl:()=>ft,Y36:()=>Cl,_UZ:()=>hf,GkF:()=>dl,BQk:()=>Sl,ynx:()=>Xa,qZA:()=>uf,TgZ:()=>id,EpF:()=>mc,n5z:()=>Rs,LFG:()=>Ye,$8M:()=>tc,$Z:()=>Km,NdJ:()=>df,CRH:()=>Xv,O4$:()=>br,oxw:()=>Bp,ALo:()=>zv,lcZ:()=>Nv,Dn7:()=>Uv,Hsn:()=>Np,F$t:()=>zp,Q6J:()=>gu,s9C:()=>Kl,DdM:()=>Mv,VKq:()=>Iv,WLB:()=>Pv,HTZ:()=>kv,iGM:()=>qv,MAs:()=>bg,KtG:()=>Qo,CHM:()=>Ba,P3R:()=>Zf,Akn:()=>b,YNc:()=>wg,W1O:()=>Qv,_uU:()=>Bt,Oqu:()=>Xt,hij:()=>gt,AsE:()=>mn,Gf:()=>Wv});var Y=Te(7579),W=Te(727),Xe=Te(9751),c=Te(8189),Re=Te(8421),nn=Te(515),xt=Te(7669),Tt=Te(2076),At=Te(2961),_t=Te(4482);function An(r,o,...a){if(!0===o)return void r();if(!1===o)return;const d=new At.Hp({next:()=>{d.unsubscribe(),r()}});return(0,Re.Xf)(o(...a)).subscribe(d)}function It(r){for(let o in r)if(r[o]===It)return o;throw Error("Could not find renamed property on target object.")}function bn(r,o){for(const a in o)o.hasOwnProperty(a)&&!r.hasOwnProperty(a)&&(r[a]=o[a])}function Yt(r){if("string"==typeof r)return r;if(Array.isArray(r))return"["+r.map(Yt).join(", ")+"]";if(null==r)return""+r;if(r.overriddenName)return`${r.overriddenName}`;if(r.name)return`${r.name}`;const o=r.toString();if(null==o)return""+o;const a=o.indexOf("\n");return-1===a?o:o.substring(0,a)}function Nn(r,o){return null==r||""===r?null===o?"":o:null==o||""===o?r:r+" "+o}const pn=It({__forward_ref__:It});function rn(r){return r.__forward_ref__=rn,r.toString=function(){return Yt(this())},r}function an(r){return Pt(r)?r():r}function Pt(r){return"function"==typeof r&&r.hasOwnProperty(pn)&&r.__forward_ref__===rn}function Se(r){return r&&!!r.\u0275providers}const Zn="https://g.co/ng/security#xss";class tt extends Error{constructor(o,a){super(kt(o,a)),this.code=o}}function kt(r,o){return`NG0${Math.abs(r)}${o?": "+o.trim():""}`}function pt(r){return"string"==typeof r?r:null==r?"":String(r)}function Bi(r,o){throw new tt(-201,!1)}function ui(r,o){null==r&&function qn(r,o,a,d){throw new Error(`ASSERTION ERROR: ${r}`+(null==d?"":` [Expected=> ${a} ${d} ${o} <=Actual]`))}(o,r,null,"!=")}function li(r){return{token:r.token,providedIn:r.providedIn||null,factory:r.factory,value:void 0}}function si(r){return{providers:r.providers||[],imports:r.imports||[]}}function Wt(r){return yr(r,lo)||yr(r,zr)}function Ar(r){return null!==Wt(r)}function yr(r,o){return r.hasOwnProperty(o)?r[o]:null}function os(r){return r&&(r.hasOwnProperty(Vi)||r.hasOwnProperty(Zi))?r[Vi]:null}const lo=It({\u0275prov:It}),Vi=It({\u0275inj:It}),zr=It({ngInjectableDef:It}),Zi=It({ngInjectorDef:It});var jt=(()=>((jt=jt||{})[jt.Default=0]="Default",jt[jt.Host=1]="Host",jt[jt.Self=2]="Self",jt[jt.SkipSelf=4]="SkipSelf",jt[jt.Optional=8]="Optional",jt))();let ht;function Ri(r){const o=ht;return ht=r,o}function Yi(r,o,a){const d=Wt(r);return d&&"root"==d.providedIn?void 0===d.value?d.value=d.factory():d.value:a&jt.Optional?null:void 0!==o?o:void Bi(Yt(r))}const vi=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),ne={},ae="__NG_DI_FLAG__",xe="ngTempTokenPath",Me="ngTokenPath",ze=/\n/gm,fe="\u0275",oe="__source";let re;function Ce(r){const o=re;return re=r,o}function je(r,o=jt.Default){if(void 0===re)throw new tt(-203,!1);return null===re?Yi(r,void 0,o):re.get(r,o&jt.Optional?null:void 0,o)}function Ye(r,o=jt.Default){return(function Hi(){return ht}()||je)(an(r),o)}function Dn(r,o=jt.Default){return Ye(r,cn(o))}function cn(r){return typeof r>"u"||"number"==typeof r?r:0|(r.optional&&8)|(r.host&&1)|(r.self&&2)|(r.skipSelf&&4)}function gn(r){const o=[];for(let a=0;a<r.length;a++){const d=an(r[a]);if(Array.isArray(d)){if(0===d.length)throw new tt(900,!1);let v,D=jt.Default;for(let k=0;k<d.length;k++){const B=d[k],$=Ve(B);"number"==typeof $?-1===$?v=B.token:D|=$:v=B}o.push(Ye(v,D))}else o.push(Ye(d))}return o}function Fn(r,o){return r[ae]=o,r.prototype[ae]=o,r}function Ve(r){return r[ae]}function $e(r){return{toString:r}.toString()}var dt=(()=>((dt=dt||{})[dt.OnPush=0]="OnPush",dt[dt.Default=1]="Default",dt))(),on=(()=>{return(r=on||(on={}))[r.Emulated=0]="Emulated",r[r.None=2]="None",r[r.ShadowDom=3]="ShadowDom",on;var r})();const _n={},Tn=[],Ai=It({\u0275cmp:It}),po=It({\u0275dir:It}),Yr=It({\u0275pipe:It}),Cn=It({\u0275mod:It}),Co=It({\u0275fac:It}),Do=It({__NG_ELEMENT_ID__:It});let vs=0;function ss(r){return $e(()=>{const o=Wo(r),a={...o,decls:r.decls,vars:r.vars,template:r.template,consts:r.consts||null,ngContentSelectors:r.ngContentSelectors,onPush:r.changeDetection===dt.OnPush,directiveDefs:null,pipeDefs:null,dependencies:o.standalone&&r.dependencies||null,getStandaloneInjector:null,data:r.data||{},encapsulation:r.encapsulation||on.Emulated,id:"c"+vs++,styles:r.styles||Tn,_:null,schemas:r.schemas||null,tView:null};Po(a);const d=r.dependencies;return a.directiveDefs=Zo(d,!1),a.pipeDefs=Zo(d,!0),a})}function as(r){return ti(r)||ai(r)}function Ho(r){return null!==r}function Go(r){return $e(()=>({type:r.type,bootstrap:r.bootstrap||Tn,declarations:r.declarations||Tn,imports:r.imports||Tn,exports:r.exports||Tn,transitiveCompileScopes:null,schemas:r.schemas||null,id:r.id||null}))}function go(r,o){if(null==r)return _n;const a={};for(const d in r)if(r.hasOwnProperty(d)){let v=r[d],D=v;Array.isArray(v)&&(D=v[1],v=v[0]),a[v]=d,o&&(o[v]=D)}return a}function $s(r){return $e(()=>{const o=Wo(r);return Po(o),o})}function ft(r){return{type:r.type,name:r.name,factory:null,pure:!1!==r.pure,standalone:!0===r.standalone,onDestroy:r.type.prototype.ngOnDestroy||null}}function ti(r){return r[Ai]||null}function ai(r){return r[po]||null}function bi(r){return r[Yr]||null}function ls(r){const o=ti(r)||ai(r)||bi(r);return null!==o&&o.standalone}function ir(r,o){const a=r[Cn]||null;if(!a&&!0===o)throw new Error(`Type ${Yt(r)} does not have '\u0275mod' property.`);return a}function Wo(r){const o={};return{type:r.type,providersResolver:null,factory:null,hostBindings:r.hostBindings||null,hostVars:r.hostVars||0,hostAttrs:r.hostAttrs||null,contentQueries:r.contentQueries||null,declaredInputs:o,exportAs:r.exportAs||null,standalone:!0===r.standalone,selectors:r.selectors||Tn,viewQuery:r.viewQuery||null,features:r.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:go(r.inputs,o),outputs:go(r.outputs)}}function Po(r){r.features?.forEach(o=>o(r))}function Zo(r,o){if(!r)return null;const a=o?bi:as;return()=>("function"==typeof r?r():r).map(d=>a(d)).filter(Ho)}const tn=0,Ft=1,hn=2,Mi=3,Qi=4,In=5,Ii=6,So=7,ki=8,Vr=9,Li=10,Yn=11,co=12,Zr=13,Xo=14,fr=15,Xi=16,ko=17,Jr=18,_o=19,Ro=20,Qr=21,ri=22,ua=1,eo=2,to=7,Hs=8,no=9,Ei=10;function io(r){return Array.isArray(r)&&"object"==typeof r[ua]}function $r(r){return Array.isArray(r)&&!0===r[ua]}function Mr(r){return 0!=(4&r.flags)}function Xr(r){return r.componentOffset>-1}function us(r){return 1==(1&r.flags)}function ur(r){return!!r.template}function Hr(r){return 0!=(256&r[hn])}function yo(r,o){return r.hasOwnProperty(Co)?r[Co]:null}class Oa{constructor(o,a,d){this.previousValue=o,this.currentValue=a,this.firstChange=d}isFirstChange(){return this.firstChange}}function ws(){return Ms}function Ms(r){return r.type.prototype.ngOnChanges&&(r.setInput=sr),ds}function ds(){const r=vr(this),o=r?.current;if(o){const a=r.previous;if(a===_n)r.previous=o;else for(let d in o)a[d]=o[d];r.current=null,this.ngOnChanges(o)}}function sr(r,o,a,d){const v=this.declaredInputs[a],D=vr(r)||function Oo(r,o){return r[Ao]=o}(r,{previous:_n,current:null}),k=D.current||(D.current={}),B=D.previous,$=B[v];k[v]=new Oa($&&$.currentValue,o,B===_n),r[d]=o}ws.ngInherit=!0;const Ao="__ngSimpleChanges__";function vr(r){return r[Ao]||null}const vo=function(r,o,a){},Is="svg";function mr(r){for(;Array.isArray(r);)r=r[tn];return r}function Ps(r,o){return mr(o[r])}function Ir(r,o){return mr(o[r.index])}function Pr(r,o){return r.data[o]}function bs(r,o){return r[o]}function xr(r,o){const a=o[r];return io(a)?a:a[tn]}function Fo(r){return 64==(64&r[hn])}function ho(r,o){return null==o?null:r[o]}function pa(r){r[Jr]=0}function ks(r,o){r[In]+=o;let a=r,d=r[Mi];for(;null!==d&&(1===o&&1===a[In]||-1===o&&0===a[In]);)d[In]+=o,a=d,d=d[Mi]}const Xn={lFrame:Un(null),bindingsEnabled:!0};function Fa(){return Xn.bindingsEnabled}function Nt(){return Xn.lFrame.lView}function Pi(){return Xn.lFrame.tView}function Ba(r){return Xn.lFrame.contextLView=r,r[ki]}function Qo(r){return Xn.lFrame.contextLView=null,r}function hr(){let r=es();for(;null!==r&&64===r.type;)r=r.parent;return r}function es(){return Xn.lFrame.currentTNode}function wr(r,o){const a=Xn.lFrame;a.currentTNode=r,a.isParent=o}function ma(){return Xn.lFrame.isParent}function ga(){Xn.lFrame.isParent=!1}function oo(){const r=Xn.lFrame;let o=r.bindingRootIndex;return-1===o&&(o=r.bindingRootIndex=r.tView.bindingStartIndex),o}function ie(){return Xn.lFrame.bindingIndex++}function R(r){const o=Xn.lFrame,a=o.bindingIndex;return o.bindingIndex=o.bindingIndex+r,a}function se(r,o){const a=Xn.lFrame;a.bindingIndex=a.bindingRootIndex=r,Oe(o)}function Oe(r){Xn.lFrame.currentDirectiveIndex=r}function st(){return Xn.lFrame.currentQueryIndex}function mt(r){Xn.lFrame.currentQueryIndex=r}function xn(r){const o=r[Ft];return 2===o.type?o.declTNode:1===o.type?r[Ii]:null}function Sn(r,o,a){if(a&jt.SkipSelf){let v=o,D=r;for(;!(v=v.parent,null!==v||a&jt.Host||(v=xn(D),null===v||(D=D[fr],10&v.type))););if(null===v)return!1;o=v,r=D}const d=Xn.lFrame=oi();return d.currentTNode=o,d.lView=r,!0}function ci(r){const o=oi(),a=r[Ft];Xn.lFrame=o,o.currentTNode=a.firstChild,o.lView=r,o.tView=a,o.contextLView=r,o.bindingIndex=a.bindingStartIndex,o.inI18n=!1}function oi(){const r=Xn.lFrame,o=null===r?null:r.child;return null===o?Un(r):o}function Un(r){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:r,child:null,inI18n:!1};return null!==r&&(r.child=o),o}function Jn(){const r=Xn.lFrame;return Xn.lFrame=r.parent,r.currentTNode=null,r.lView=null,r}const Ni=Jn;function xi(){const r=Jn();r.isParent=!0,r.tView=null,r.selectedIndex=-1,r.contextLView=null,r.elementDepthCount=0,r.currentDirectiveIndex=-1,r.currentNamespace=null,r.bindingRootIndex=-1,r.bindingIndex=-1,r.currentQueryIndex=0}function Wn(){return Xn.lFrame.selectedIndex}function dr(r){Xn.lFrame.selectedIndex=r}function Si(){const r=Xn.lFrame;return Pr(r.tView,r.selectedIndex)}function br(){Xn.lFrame.currentNamespace=Is}function et(r,o){for(let a=o.directiveStart,d=o.directiveEnd;a<d;a++){const D=r.data[a].type.prototype,{ngAfterContentInit:k,ngAfterContentChecked:B,ngAfterViewInit:$,ngAfterViewChecked:Q,ngOnDestroy:he}=D;k&&(r.contentHooks??(r.contentHooks=[])).push(-a,k),B&&((r.contentHooks??(r.contentHooks=[])).push(a,B),(r.contentCheckHooks??(r.contentCheckHooks=[])).push(a,B)),$&&(r.viewHooks??(r.viewHooks=[])).push(-a,$),Q&&((r.viewHooks??(r.viewHooks=[])).push(a,Q),(r.viewCheckHooks??(r.viewCheckHooks=[])).push(a,Q)),null!=he&&(r.destroyHooks??(r.destroyHooks=[])).push(a,he)}}function x(r,o,a){H(r,o,3,a)}function E(r,o,a,d){(3&r[hn])===a&&H(r,o,a,d)}function I(r,o){let a=r[hn];(3&a)===o&&(a&=2047,a+=1,r[hn]=a)}function H(r,o,a,d){const D=d??-1,k=o.length-1;let B=0;for(let $=void 0!==d?65535&r[Jr]:0;$<k;$++)if("number"==typeof o[$+1]){if(B=o[$],null!=d&&B>=d)break}else o[$]<0&&(r[Jr]+=65536),(B<D||-1==D)&&(pe(r,a,o,$),r[Jr]=(4294901760&r[Jr])+$+2),$++}function pe(r,o,a,d){const v=a[d]<0,D=a[d+1],B=r[v?-a[d]:a[d]];if(v){if(r[hn]>>11<r[Jr]>>16&&(3&r[hn])===o){r[hn]+=2048,vo(4,B,D);try{D.call(B)}finally{vo(5,B,D)}}}else{vo(4,B,D);try{D.call(B)}finally{vo(5,B,D)}}}const We=-1;class en{constructor(o,a,d){this.factory=o,this.resolving=!1,this.canSeeViewProviders=a,this.injectImpl=d}}function qr(r,o,a){let d=0;for(;d<a.length;){const v=a[d];if("number"==typeof v){if(0!==v)break;d++;const D=a[d++],k=a[d++],B=a[d++];r.setAttribute(o,k,B,D)}else{const D=v,k=a[++d];Ma(D)?r.setProperty(o,D,k):r.setAttribute(o,D,k),d++}}return d}function oa(r){return 3===r||4===r||6===r}function Ma(r){return 64===r.charCodeAt(0)}function kr(r,o){if(null!==o&&0!==o.length)if(null===r||0===r.length)r=o.slice();else{let a=-1;for(let d=0;d<o.length;d++){const v=o[d];"number"==typeof v?a=v:0===a||Ja(r,a,v,null,-1===a||2===a?o[++d]:null)}}return r}function Ja(r,o,a,d,v){let D=0,k=r.length;if(-1===o)k=-1;else for(;D<r.length;){const B=r[D++];if("number"==typeof B){if(B===o){k=-1;break}if(B>o){k=D-1;break}}}for(;D<r.length;){const B=r[D];if("number"==typeof B)break;if(B===a){if(null===d)return void(null!==v&&(r[D+1]=v));if(d===r[D+1])return void(r[D+2]=v)}D++,null!==d&&D++,null!==v&&D++}-1!==k&&(r.splice(k,0,o),D=k+1),r.splice(D++,0,a),null!==d&&r.splice(D++,0,d),null!==v&&r.splice(D++,0,v)}function Ql(r){return r!==We}function pl(r){return 32767&r}function Qa(r,o){let a=function ml(r){return r>>16}(r),d=o;for(;a>0;)d=d[fr],a--;return d}let gl=!0;function za(r){const o=gl;return gl=r,o}const Tu=255,qc=5;let Il=0;const ya={};function kl(r,o){const a=el(r,o);if(-1!==a)return a;const d=o[Ft];d.firstCreatePass&&(r.injectorIndex=o.length,Rl(d.data,r),Rl(o,null),Rl(d.blueprint,null));const v=_l(r,o),D=r.injectorIndex;if(Ql(v)){const k=pl(v),B=Qa(v,o),$=B[Ft].data;for(let Q=0;Q<8;Q++)o[D+Q]=B[k+Q]|$[k+Q]}return o[D+8]=v,D}function Rl(r,o){r.push(0,0,0,0,0,0,0,0,o)}function el(r,o){return-1===r.injectorIndex||r.parent&&r.parent.injectorIndex===r.injectorIndex||null===o[r.injectorIndex+8]?-1:r.injectorIndex}function _l(r,o){if(r.parent&&-1!==r.parent.injectorIndex)return r.parent.injectorIndex;let a=0,d=null,v=o;for(;null!==v;){if(d=va(v),null===d)return We;if(a++,v=v[fr],-1!==d.injectorIndex)return d.injectorIndex|a<<16}return We}function ec(r,o,a){!function Pl(r,o,a){let d;"string"==typeof a?d=a.charCodeAt(0)||0:a.hasOwnProperty(Do)&&(d=a[Do]),null==d&&(d=a[Do]=Il++);const v=d&Tu;o.data[r+(v>>qc)]|=1<<v}(r,o,a)}function yc(r,o,a){if(a&jt.Optional||void 0!==r)return r;Bi()}function Ts(r,o,a,d){if(a&jt.Optional&&void 0===d&&(d=null),!(a&(jt.Self|jt.Host))){const v=r[Vr],D=Ri(void 0);try{return v?v.get(o,d,a&jt.Optional):Yi(o,d,a&jt.Optional)}finally{Ri(D)}}return yc(d,0,a)}function Ga(r,o,a,d=jt.Default,v){if(null!==r){if(1024&o[hn]){const k=function Ol(r,o,a,d,v){let D=r,k=o;for(;null!==D&&null!==k&&1024&k[hn]&&!(256&k[hn]);){const B=Ll(D,k,a,d|jt.Self,ya);if(B!==ya)return B;let $=D.parent;if(!$){const Q=k[Qr];if(Q){const he=Q.get(a,ya,d);if(he!==ya)return he}$=va(k),k=k[fr]}D=$}return v}(r,o,a,d,ya);if(k!==ya)return k}const D=Ll(r,o,a,d,ya);if(D!==ya)return D}return Ts(o,a,d,v)}function Ll(r,o,a,d,v){const D=function Su(r){if("string"==typeof r)return r.charCodeAt(0)||0;const o=r.hasOwnProperty(Do)?r[Do]:void 0;return"number"==typeof o?o>=0?o&Tu:Mu:o}(a);if("function"==typeof D){if(!Sn(o,r,d))return d&jt.Host?yc(v,0,d):Ts(o,a,d,v);try{const k=D(d);if(null!=k||d&jt.Optional)return k;Bi()}finally{Ni()}}else if("number"==typeof D){let k=null,B=el(r,o),$=We,Q=d&jt.Host?o[Xi][Ii]:null;for((-1===B||d&jt.SkipSelf)&&($=-1===B?_l(r,o):o[B+8],$!==We&&Wc(d,!1)?(k=o[Ft],B=pl($),o=Qa($,o)):B=-1);-1!==B;){const he=o[Ft];if(Au(D,B,he.data)){const be=Du(B,o,a,k,d,Q);if(be!==ya)return be}$=o[B+8],$!==We&&Wc(d,o[Ft].data[B+8]===Q)&&Au(D,B,o)?(k=he,B=pl($),o=Qa($,o)):B=-1}}return v}function Du(r,o,a,d,v,D){const k=o[Ft],B=k.data[r+8],he=vc(B,k,a,null==d?Xr(B)&&gl:d!=k&&0!=(3&B.type),v&jt.Host&&D===B);return null!==he?qa(o,k,he,B):ya}function vc(r,o,a,d,v){const D=r.providerIndexes,k=o.data,B=1048575&D,$=r.directiveStart,he=D>>20,Ge=v?B+he:r.directiveEnd;for(let ot=d?B:B+he;ot<Ge;ot++){const Lt=k[ot];if(ot<$&&a===Lt||ot>=$&&Lt.type===a)return ot}if(v){const ot=k[$];if(ot&&ur(ot)&&ot.type===a)return $}return null}function qa(r,o,a,d){let v=r[a];const D=o.data;if(function Ln(r){return r instanceof en}(v)){const k=v;k.resolving&&function En(r,o){const a=o?`. Dependency path: ${o.join(" > ")} > ${r}`:"";throw new tt(-200,`Circular dependency in DI detected for ${r}${a}`)}(function zt(r){return"function"==typeof r?r.name||r.toString():"object"==typeof r&&null!=r&&"function"==typeof r.type?r.type.name||r.type.toString():pt(r)}(D[a]));const B=za(k.canSeeViewProviders);k.resolving=!0;const $=k.injectImpl?Ri(k.injectImpl):null;Sn(r,d,jt.Default);try{v=r[a]=k.factory(void 0,D,r,d),o.firstCreatePass&&a>=d.directiveStart&&function Ae(r,o,a){const{ngOnChanges:d,ngOnInit:v,ngDoCheck:D}=o.type.prototype;if(d){const k=Ms(o);(a.preOrderHooks??(a.preOrderHooks=[])).push(r,k),(a.preOrderCheckHooks??(a.preOrderCheckHooks=[])).push(r,k)}v&&(a.preOrderHooks??(a.preOrderHooks=[])).push(0-r,v),D&&((a.preOrderHooks??(a.preOrderHooks=[])).push(r,D),(a.preOrderCheckHooks??(a.preOrderCheckHooks=[])).push(r,D))}(a,D[a],o)}finally{null!==$&&Ri($),za(B),k.resolving=!1,Ni()}}return v}function Au(r,o,a){return!!(a[o+(r>>qc)]&1<<r)}function Wc(r,o){return!(r&jt.Self||r&jt.Host&&o)}class so{constructor(o,a){this._tNode=o,this._lView=a}get(o,a,d){return Ga(this._tNode,this._lView,o,cn(d),a)}}function Mu(){return new so(hr(),Nt())}function Rs(r){return $e(()=>{const o=r.prototype.constructor,a=o[Co]||Zc(o),d=Object.prototype;let v=Object.getPrototypeOf(r.prototype).constructor;for(;v&&v!==d;){const D=v[Co]||Zc(v);if(D&&D!==a)return D;v=Object.getPrototypeOf(v)}return D=>new D})}function Zc(r){return Pt(r)?()=>{const o=Zc(an(r));return o&&o()}:yo(r)}function va(r){const o=r[Ft],a=o.type;return 2===a?o.declTNode:1===a?r[Ii]:null}function tc(r){return function Cu(r,o){if("class"===o)return r.classes;if("style"===o)return r.styles;const a=r.attrs;if(a){const d=a.length;let v=0;for(;v<d;){const D=a[v];if(oa(D))break;if(0===D)v+=2;else if("number"==typeof D)for(v++;v<d&&"string"==typeof a[v];)v++;else{if(D===o)return a[v+1];v+=2}}}return null}(hr(),r)}const ns="__parameters__";function wn(r,o,a){return $e(()=>{const d=function nc(r){return function(...a){if(r){const d=r(...a);for(const v in d)this[v]=d[v]}}}(o);function v(...D){if(this instanceof v)return d.apply(this,D),this;const k=new v(...D);return B.annotation=k,B;function B($,Q,he){const be=$.hasOwnProperty(ns)?$[ns]:Object.defineProperty($,ns,{value:[]})[ns];for(;be.length<=he;)be.push(null);return(be[he]=be[he]||[]).push(k),$}}return a&&(v.prototype=Object.create(a.prototype)),v.prototype.ngMetadataName=r,v.annotationCls=v,v})}class ar{constructor(o,a){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof a?this.__NG_ELEMENT_ID__=a:void 0!==a&&(this.\u0275prov=li({token:this,providedIn:a.providedIn||"root",factory:a.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function i(r,o){r.forEach(a=>Array.isArray(a)?i(a,o):o(a))}function l(r,o,a){o>=r.length?r.push(a):r.splice(o,0,a)}function p(r,o){return o>=r.length-1?r.pop():r.splice(o,1)[0]}function w(r,o){const a=[];for(let d=0;d<r;d++)a.push(o);return a}function _(r,o,a){let d=M(r,o);return d>=0?r[1|d]=a:(d=~d,function m(r,o,a,d){let v=r.length;if(v==o)r.push(a,d);else if(1===v)r.push(d,r[0]),r[0]=a;else{for(v--,r.push(r[v-1],r[v]);v>o;)r[v]=r[v-2],v--;r[o]=a,r[o+1]=d}}(r,d,o,a)),d}function T(r,o){const a=M(r,o);if(a>=0)return r[1|a]}function M(r,o){return function U(r,o,a){let d=0,v=r.length>>a;for(;v!==d;){const D=d+(v-d>>1),k=r[D<<a];if(o===k)return D<<a;k>o?v=D:d=D+1}return~(v<<a)}(r,o,1)}const Pe=Fn(wn("Optional"),8),He=Fn(wn("SkipSelf"),4);var ja=(()=>((ja=ja||{})[ja.Important=1]="Important",ja[ja.DashCase=2]="DashCase",ja))();const Iu=new Map;let im=0;const Sf="__ngContext__";function Ks(r,o){io(o)?(r[Sf]=o[Ro],function hd(r){Iu.set(r[Ro],r)}(o)):r[Sf]=o}let fd;function pd(r,o){return fd(r,o)}function gh(r){const o=r[Mi];return $r(o)?o[Mi]:o}function Gn(r){return _h(r[Zr])}function jl(r){return _h(r[Qi])}function _h(r){for(;null!==r&&!$r(r);)r=r[Qi];return r}function Bs(r,o,a,d,v){if(null!=d){let D,k=!1;$r(d)?D=d:io(d)&&(k=!0,d=d[tn]);const B=mr(d);0===r&&null!==a?null==v?ku(o,a,B):Tc(o,a,B,v||null,!0):1===r&&null!==a?Tc(o,a,B,v||null,!0):2===r?function ac(r,o,a){const d=zs(r,o);d&&function Wa(r,o,a,d){r.removeChild(o,a,d)}(r,d,o,a)}(o,B,k):3===r&&o.destroyNode(B),null!=D&&function Qg(r,o,a,d,v){const D=a[to];D!==mr(a)&&Bs(o,r,d,D,v);for(let B=Ei;B<a.length;B++){const $=a[B];Lu($[Ft],$,r,o,d,D)}}(o,r,D,a,v)}}function yh(r,o,a){return r.createElement(o,a)}function If(r,o){const a=r[no],d=a.indexOf(o),v=o[Mi];512&o[hn]&&(o[hn]&=-513,ks(v,-1)),a.splice(d,1)}function Pf(r,o){if(r.length<=Ei)return;const a=Ei+o,d=r[a];if(d){const v=d[ko];null!==v&&v!==r&&If(v,d),o>0&&(r[a-1][Qi]=d[Qi]);const D=p(r,Ei+o);!function eu(r,o){Lu(r,o,o[Yn],2,null,null),o[tn]=null,o[Ii]=null}(d[Ft],d);const k=D[_o];null!==k&&k.detachView(D[Ft]),d[Mi]=null,d[Qi]=null,d[hn]&=-65}return d}function _d(r,o){if(!(128&o[hn])){const a=o[Yn];a.destroyNode&&Lu(r,o,a,3,null,null),function Mf(r){let o=r[Zr];if(!o)return yd(r[Ft],r);for(;o;){let a=null;if(io(o))a=o[Zr];else{const d=o[Ei];d&&(a=d)}if(!a){for(;o&&!o[Qi]&&o!==r;)io(o)&&yd(o[Ft],o),o=o[Mi];null===o&&(o=r),io(o)&&yd(o[Ft],o),a=o&&o[Qi]}o=a}}(o)}}function yd(r,o){if(!(128&o[hn])){o[hn]&=-65,o[hn]|=128,function Pu(r,o){let a;if(null!=r&&null!=(a=r.destroyHooks))for(let d=0;d<a.length;d+=2){const v=o[a[d]];if(!(v instanceof en)){const D=a[d+1];if(Array.isArray(D))for(let k=0;k<D.length;k+=2){const B=v[D[k]],$=D[k+1];vo(4,B,$);try{$.call(B)}finally{vo(5,B,$)}}else{vo(4,v,D);try{D.call(v)}finally{vo(5,v,D)}}}}}(r,o),function xh(r,o){const a=r.cleanup,d=o[So];let v=-1;if(null!==a)for(let D=0;D<a.length-1;D+=2)if("string"==typeof a[D]){const k=a[D+3];k>=0?d[v=k]():d[v=-k].unsubscribe(),D+=2}else{const k=d[v=a[D+1]];a[D].call(k)}if(null!==d){for(let D=v+1;D<d.length;D++)(0,d[D])();o[So]=null}}(r,o),1===o[Ft].type&&o[Yn].destroy();const a=o[ko];if(null!==a&&$r(o[Mi])){a!==o[Mi]&&If(a,o);const d=o[_o];null!==d&&d.detachView(r)}!function dd(r){Iu.delete(r[Ro])}(o)}}function Vl(r,o,a){return function vd(r,o,a){let d=o;for(;null!==d&&40&d.type;)d=(o=d).parent;if(null===d)return a[tn];{const{componentOffset:v}=d;if(v>-1){const{encapsulation:D}=r.data[d.directiveStart+v];if(D===on.None||D===on.Emulated)return null}return Ir(d,a)}}(r,o.parent,a)}function Tc(r,o,a,d,v){r.insertBefore(o,a,d,v)}function ku(r,o,a){r.appendChild(o,a)}function Ru(r,o,a,d,v){null!==d?Tc(r,o,a,d,v):ku(r,o,a)}function zs(r,o){return r.parentNode(o)}function wd(r,o,a){return kf(r,o,a)}let nu,Bf,ka,kf=function Eo(r,o,a){return 40&r.type?Ir(r,a):null};function bd(r,o,a,d){const v=Vl(r,d,o),D=o[Yn],B=wd(d.parent||o[Ii],d,o);if(null!=v)if(Array.isArray(a))for(let $=0;$<a.length;$++)Ru(D,v,a[$],B,!1);else Ru(D,v,a,B,!1);void 0!==nu&&nu(D,d,o,a,v)}function Ed(r,o){if(null!==o){const a=o.type;if(3&a)return Ir(o,r);if(4&a)return Td(-1,r[o.index]);if(8&a){const d=o.child;if(null!==d)return Ed(r,d);{const v=r[o.index];return $r(v)?Td(-1,v):mr(v)}}if(32&a)return pd(o,r)()||mr(r[o.index]);{const d=Rf(r,o);return null!==d?Array.isArray(d)?d[0]:Ed(gh(r[Xi]),d):Ed(r,o.next)}}return null}function Rf(r,o){return null!==o?r[Xi][Ii].projection[o.projection]:null}function Td(r,o){const a=Ei+r+1;if(a<o.length){const d=o[a],v=d[Ft].firstChild;if(null!==v)return Ed(d,v)}return o[to]}function Cd(r,o,a,d,v,D,k){for(;null!=a;){const B=d[a.index],$=a.type;if(k&&0===o&&(B&&Ks(mr(B),d),a.flags|=2),32!=(32&a.flags))if(8&$)Cd(r,o,a.child,d,v,D,!1),Bs(o,r,v,B,D);else if(32&$){const Q=pd(a,d);let he;for(;he=Q();)Bs(o,r,v,he,D);Bs(o,r,v,B,D)}else 16&$?Lf(r,o,d,a,v,D):Bs(o,r,v,B,D);a=k?a.projectionNext:a.next}}function Lu(r,o,a,d,v,D){Cd(a,d,r.firstChild,o,v,D,!1)}function Lf(r,o,a,d,v,D){const k=a[Xi],$=k[Ii].projection[d.projection];if(Array.isArray($))for(let Q=0;Q<$.length;Q++)Bs(o,r,v,$[Q],D);else Cd(r,o,$,k[Mi],v,D,!0)}function Of(r,o,a){""===a?r.removeAttribute(o,"class"):r.setAttribute(o,"class",a)}function Ou(r,o,a){const{mergedAttrs:d,classes:v,styles:D}=a;null!==d&&qr(r,o,d),null!==v&&Of(r,o,v),null!==D&&function cm(r,o,a){r.setAttribute(o,"style",a)}(r,o,D)}function iu(r){Bf=r}function zf(r){return function Va(){if(void 0===ka&&(ka=null,vi.trustedTypes))try{ka=vi.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:r=>r,createScript:r=>r,createScriptURL:r=>r})}catch{}return ka}()?.createScriptURL(r)||r}class hm{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Zn})`}}function Dc(r){return r instanceof hm?r.changingThisBreaksApplicationSecurity:r}function Sc(r,o){const a=function Uf(r){return r instanceof hm&&r.getTypeName()||null}(r);if(null!=a&&a!==o){if("ResourceURL"===a&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${a} (see ${Zn})`)}return a===o}const mm=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:\/?#]*(?:[\/?#]|$))/i;var ms=(()=>((ms=ms||{})[ms.NONE=0]="NONE",ms[ms.HTML=1]="HTML",ms[ms.STYLE=2]="STYLE",ms[ms.SCRIPT=3]="SCRIPT",ms[ms.URL=4]="URL",ms[ms.RESOURCE_URL=5]="RESOURCE_URL",ms))();function Ac(r){const o=Mh();return o?o.sanitize(ms.URL,r)||"":Sc(r,"URL")?Dc(r):function Ch(r){return(r=String(r)).match(mm)?r:"unsafe:"+r}(pt(r))}function Ah(r){const o=Mh();if(o)return zf(o.sanitize(ms.RESOURCE_URL,r)||"");if(Sc(r,"ResourceURL"))return zf(Dc(r));throw new tt(904,!1)}function Zf(r,o,a){return function r_(r,o){return"src"===o&&("embed"===r||"frame"===r||"iframe"===r||"media"===r||"script"===r)||"href"===o&&("base"===r||"link"===r)?Ah:Ac}(o,a)(r)}function Mh(){const r=Nt();return r&&r[co]}const Ih=new ar("ENVIRONMENT_INITIALIZER"),Xf=new ar("INJECTOR",-1),Kf=new ar("INJECTOR_DEF_TYPES");class Mc{get(o,a=ne){if(a===ne){const d=new Error(`NullInjectorError: No provider for ${Yt(o)}!`);throw d.name="NullInjectorError",d}return a}}function bm(r){return{\u0275providers:r}}function o_(...r){return{\u0275providers:su(0,r),\u0275fromNgModule:!0}}function su(r,...o){const a=[],d=new Set;let v;return i(o,D=>{const k=D;Md(k,a,[],d)&&(v||(v=[]),v.push(k))}),void 0!==v&&Ph(v,a),a}function Ph(r,o){for(let a=0;a<r.length;a++){const{providers:v}=r[a];Yf(v,D=>{o.push(D)})}}function Md(r,o,a,d){if(!(r=an(r)))return!1;let v=null,D=os(r);const k=!D&&ti(r);if(D||k){if(k&&!k.standalone)return!1;v=r}else{const $=r.ngModule;if(D=os($),!D)return!1;v=$}const B=d.has(v);if(k){if(B)return!1;if(d.add(v),k.dependencies){const $="function"==typeof k.dependencies?k.dependencies():k.dependencies;for(const Q of $)Md(Q,o,a,d)}}else{if(!D)return!1;{if(null!=D.imports&&!B){let Q;d.add(v);try{i(D.imports,he=>{Md(he,o,a,d)&&(Q||(Q=[]),Q.push(he))})}finally{}void 0!==Q&&Ph(Q,o)}if(!B){const Q=yo(v)||(()=>new v);o.push({provide:v,useFactory:Q,deps:Tn},{provide:Kf,useValue:v,multi:!0},{provide:Ih,useValue:()=>Ye(v),multi:!0})}const $=D.providers;null==$||B||Yf($,he=>{o.push(he)})}}return v!==r&&void 0!==r.providers}function Yf(r,o){for(let a of r)Se(a)&&(a=a.\u0275providers),Array.isArray(a)?Yf(a,o):o(a)}const a_=It({provide:String,useValue:It});function Id(r){return null!==r&&"object"==typeof r&&a_ in r}function au(r){return"function"==typeof r}const Pd=new ar("Set Injector scope."),kh={},Tm={};let Rh;function cl(){return void 0===Rh&&(Rh=new Mc),Rh}class Cs{}class Cm extends Cs{get destroyed(){return this._destroyed}constructor(o,a,d,v){super(),this.parent=a,this.source=d,this.scopes=v,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,cu(o,k=>this.processProvider(k)),this.records.set(Xf,Ic(void 0,this)),v.has("environment")&&this.records.set(Cs,Ic(void 0,this));const D=this.records.get(Pd);null!=D&&"string"==typeof D.value&&this.scopes.add(D.value),this.injectorDefTypes=new Set(this.get(Kf.multi,Tn,jt.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const o of this._ngOnDestroyHooks)o.ngOnDestroy();for(const o of this._onDestroyHooks)o()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(o){this._onDestroyHooks.push(o)}runInContext(o){this.assertNotDestroyed();const a=Ce(this),d=Ri(void 0);try{return o()}finally{Ce(a),Ri(d)}}get(o,a=ne,d=jt.Default){this.assertNotDestroyed(),d=cn(d);const v=Ce(this),D=Ri(void 0);try{if(!(d&jt.SkipSelf)){let B=this.records.get(o);if(void 0===B){const $=function lu(r){return"function"==typeof r||"object"==typeof r&&r instanceof ar}(o)&&Wt(o);B=$&&this.injectableDefInScope($)?Ic(Lh(o),kh):null,this.records.set(o,B)}if(null!=B)return this.hydrate(o,B)}return(d&jt.Self?cl():this.parent).get(o,a=d&jt.Optional&&a===ne?null:a)}catch(k){if("NullInjectorError"===k.name){if((k[xe]=k[xe]||[]).unshift(Yt(o)),v)throw k;return function Ne(r,o,a,d){const v=r[xe];throw o[oe]&&v.unshift(o[oe]),r.message=function ge(r,o,a,d=null){r=r&&"\n"===r.charAt(0)&&r.charAt(1)==fe?r.slice(2):r;let v=Yt(o);if(Array.isArray(o))v=o.map(Yt).join(" -> ");else if("object"==typeof o){let D=[];for(let k in o)if(o.hasOwnProperty(k)){let B=o[k];D.push(k+":"+("string"==typeof B?JSON.stringify(B):Yt(B)))}v=`{${D.join(", ")}}`}return`${a}${d?"("+d+")":""}[${v}]: ${r.replace(ze,"\n  ")}`}("\n"+r.message,v,a,d),r[Me]=v,r[xe]=null,r}(k,o,"R3InjectorError",this.source)}throw k}finally{Ri(D),Ce(v)}}resolveInjectorInitializers(){const o=Ce(this),a=Ri(void 0);try{const d=this.get(Ih.multi,Tn,jt.Self);for(const v of d)v()}finally{Ce(o),Ri(a)}}toString(){const o=[],a=this.records;for(const d of a.keys())o.push(Yt(d));return`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new tt(205,!1)}processProvider(o){let a=au(o=an(o))?o:an(o&&o.provide);const d=function u_(r){return Id(r)?Ic(void 0,r.useValue):Ic(Dm(r),kh)}(o);if(au(o)||!0!==o.multi)this.records.get(a);else{let v=this.records.get(a);v||(v=Ic(void 0,kh,!0),v.factory=()=>gn(v.multi),this.records.set(a,v)),a=o,v.multi.push(o)}this.records.set(a,d)}hydrate(o,a){return a.value===kh&&(a.value=Tm,a.value=a.factory()),"object"==typeof a.value&&a.value&&function Sm(r){return null!==r&&"object"==typeof r&&"function"==typeof r.ngOnDestroy}(a.value)&&this._ngOnDestroyHooks.add(a.value),a.value}injectableDefInScope(o){if(!o.providedIn)return!1;const a=an(o.providedIn);return"string"==typeof a?"any"===a||this.scopes.has(a):this.injectorDefTypes.has(a)}}function Lh(r){const o=Wt(r),a=null!==o?o.factory:yo(r);if(null!==a)return a;if(r instanceof ar)throw new tt(204,!1);if(r instanceof Function)return function c_(r){const o=r.length;if(o>0)throw w(o,"?"),new tt(204,!1);const a=function ni(r){return r&&(r[lo]||r[zr])||null}(r);return null!==a?()=>a.factory(r):()=>new r}(r);throw new tt(204,!1)}function Dm(r,o,a){let d;if(au(r)){const v=an(r);return yo(v)||Lh(v)}if(Id(r))d=()=>an(r.useValue);else if(function Jf(r){return!(!r||!r.useFactory)}(r))d=()=>r.useFactory(...gn(r.deps||[]));else if(function Em(r){return!(!r||!r.useExisting)}(r))d=()=>Ye(an(r.useExisting));else{const v=an(r&&(r.useClass||r.provide));if(!function kd(r){return!!r.deps}(r))return yo(v)||Lh(v);d=()=>new v(...gn(r.deps))}return d}function Ic(r,o,a=!1){return{factory:r,value:o,multi:a?[]:void 0}}function cu(r,o){for(const a of r)Array.isArray(a)?cu(a,o):a&&Se(a)?cu(a.\u0275providers,o):o(a)}class h_{}class Am{}class f_{resolveComponentFactory(o){throw function d_(r){const o=Error(`No component factory found for ${Yt(r)}. Did you add it to @NgModule.entryComponents?`);return o.ngComponent=r,o}(o)}}let Oh=(()=>{class r{}return r.NULL=new f_,r})();function Qf(){return Vu(hr(),Nt())}function Vu(r,o){return new Wl(Ir(r,o))}let Wl=(()=>{class r{constructor(a){this.nativeElement=a}}return r.__NG_ELEMENT_ID__=Qf,r})();function p_(r){return r instanceof Wl?r.nativeElement:r}class Mo{}let Rd=(()=>{class r{}return r.__NG_ELEMENT_ID__=()=>function Im(){const r=Nt(),a=xr(hr().index,r);return(io(a)?a:r)[Yn]}(),r})(),Ld=(()=>{class r{}return r.\u0275prov=li({token:r,providedIn:"root",factory:()=>null}),r})();class Fh{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const Bh=new Fh("15.2.9"),Od={},Fd="ngOriginalError";function Nh(r){return r[Fd]}class uu{constructor(){this._console=console}handleError(o){const a=this._findOriginalError(o);this._console.error("ERROR",o),a&&this._console.error("ORIGINAL ERROR",a)}_findOriginalError(o){let a=o&&Nh(o);for(;a&&Nh(a);)a=Nh(a);return a||null}}function El(r){return r instanceof Function?r():r}function Rm(r,o,a){let d=r.length;for(;;){const v=r.indexOf(o,a);if(-1===v)return v;if(0===v||r.charCodeAt(v-1)<=32){const D=o.length;if(v+D===d||r.charCodeAt(v+D)<=32)return v}a=v+1}}const jh="ng-template";function v_(r,o,a){let d=0,v=!0;for(;d<r.length;){let D=r[d++];if("string"==typeof D&&v){const k=r[d++];if(a&&"class"===D&&-1!==Rm(k.toLowerCase(),o,0))return!0}else{if(1===D){for(;d<r.length&&"string"==typeof(D=r[d++]);)if(D.toLowerCase()===o)return!0;return!1}"number"==typeof D&&(v=!1)}}return!1}function np(r){return 4===r.type&&r.value!==jh}function $u(r,o,a){return o===(4!==r.type||a?r.value:jh)}function x_(r,o,a){let d=4;const v=r.attrs||[],D=function b_(r){for(let o=0;o<r.length;o++)if(oa(r[o]))return o;return r.length}(v);let k=!1;for(let B=0;B<o.length;B++){const $=o[B];if("number"!=typeof $){if(!k)if(4&d){if(d=2|1&d,""!==$&&!$u(r,$,a)||""===$&&1===o.length){if(Tl(d))return!1;k=!0}}else{const Q=8&d?$:o[++B];if(8&d&&null!==r.attrs){if(!v_(r.attrs,Q,a)){if(Tl(d))return!1;k=!0}continue}const be=w_(8&d?"class":$,v,np(r),a);if(-1===be){if(Tl(d))return!1;k=!0;continue}if(""!==Q){let Ge;Ge=be>D?"":v[be+1].toLowerCase();const ot=8&d?Ge:null;if(ot&&-1!==Rm(ot,Q,0)||2&d&&Q!==Ge){if(Tl(d))return!1;k=!0}}}}else{if(!k&&!Tl(d)&&!Tl($))return!1;if(k&&Tl($))continue;k=!1,d=$|1&d}}return Tl(d)||k}function Tl(r){return 0==(1&r)}function w_(r,o,a,d){if(null===o)return-1;let v=0;if(d||!a){let D=!1;for(;v<o.length;){const k=o[v];if(k===r)return v;if(3===k||6===k)D=!0;else{if(1===k||2===k){let B=o[++v];for(;"string"==typeof B;)B=o[++v];continue}if(4===k)break;if(0===k){v+=4;continue}}v+=D?1:2}return-1}return function E_(r,o){let a=r.indexOf(4);if(a>-1)for(a++;a<r.length;){const d=r[a];if("number"==typeof d)return-1;if(d===o)return a;a++}return-1}(o,r)}function ip(r,o,a=!1){for(let d=0;d<o.length;d++)if(x_(r,o[d],a))return!0;return!1}function T_(r,o){e:for(let a=0;a<o.length;a++){const d=o[a];if(r.length===d.length){for(let v=0;v<r.length;v++)if(r[v]!==d[v])continue e;return!0}}return!1}function zd(r,o){return r?":not("+o.trim()+")":o}function Nd(r){let o=r[0],a=1,d=2,v="",D=!1;for(;a<r.length;){let k=r[a];if("string"==typeof k)if(2&d){const B=r[++a];v+="["+k+(B.length>0?'="'+B+'"':"")+"]"}else 8&d?v+="."+k:4&d&&(v+=" "+k);else""!==v&&!Tl(k)&&(o+=zd(D,v),v=""),d=k,D=D||!Tl(d);a++}return""!==v&&(o+=zd(D,v)),o}const $i={};function Hu(r){Gu(Pi(),Nt(),Wn()+r,!1)}function Gu(r,o,a,d){if(!d)if(3==(3&o[hn])){const D=r.preOrderCheckHooks;null!==D&&x(o,D,a)}else{const D=r.preOrderHooks;null!==D&&E(o,D,0,a)}dr(a)}function sp(r,o=null,a=null,d){const v=Um(r,o,a,d);return v.resolveInjectorInitializers(),v}function Um(r,o=null,a=null,d,v=new Set){const D=[a||Tn,o_(r)];return d=d||("object"==typeof r?void 0:Yt(r)),new Cm(D,o||cl(),d||null,v)}let hu=(()=>{class r{static create(a,d){if(Array.isArray(a))return sp({name:""},d,a,"");{const v=a.name??"";return sp({name:v},a.parent,a.providers,v)}}}return r.THROW_IF_NOT_FOUND=ne,r.NULL=new Mc,r.\u0275prov=li({token:r,providedIn:"any",factory:()=>Ye(Xf)}),r.__NG_ELEMENT_ID__=-1,r})();function Cl(r,o=jt.Default){const a=Nt();return null===a?Ye(r,o):Ga(hr(),a,an(r),o)}function Km(){throw new Error("invalid")}function Zu(r,o){const a=r.contentQueries;if(null!==a)for(let d=0;d<a.length;d+=2){const D=a[d+1];if(-1!==D){const k=r.data[D];mt(a[d]),k.contentQueries(2,o[D],D)}}}function Hh(r,o,a,d,v,D,k,B,$,Q,he){const be=o.blueprint.slice();return be[tn]=v,be[hn]=76|d,(null!==he||r&&1024&r[hn])&&(be[hn]|=1024),pa(be),be[Mi]=be[fr]=r,be[ki]=a,be[Li]=k||r&&r[Li],be[Yn]=B||r&&r[Yn],be[co]=$||r&&r[co]||null,be[Vr]=Q||r&&r[Vr]||null,be[Ii]=D,be[Ro]=function Cf(){return im++}(),be[Qr]=he,be[Xi]=2==o.type?r[Xi]:be,be}function du(r,o,a,d,v){let D=r.data[o];if(null===D)D=function qd(r,o,a,d,v){const D=es(),k=ma(),$=r.data[o]=function B_(r,o,a,d,v,D){return{type:a,index:d,insertBeforeIndex:null,injectorIndex:o?o.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:v,attrs:D,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,k?D:D&&D.parent,a,o,d,v);return null===r.firstChild&&(r.firstChild=$),null!==D&&(k?null==D.child&&null!==$.parent&&(D.child=$):null===D.next&&(D.next=$,$.prev=D)),$}(r,o,a,d,v),function L(){return Xn.lFrame.inI18n}()&&(D.flags|=32);else if(64&D.type){D.type=a,D.value=d,D.attrs=v;const k=function xo(){const r=Xn.lFrame,o=r.currentTNode;return r.isParent?o:o.parent}();D.injectorIndex=null===k?-1:k.injectorIndex}return wr(D,!0),D}function lr(r,o,a,d){if(0===a)return-1;const v=o.length;for(let D=0;D<a;D++)o.push(d),r.blueprint.push(d),r.data.push(null);return v}function Gh(r,o,a){ci(o);try{const d=r.viewQuery;null!==d&&wp(1,d,a);const v=r.template;null!==v&&dp(r,o,v,1,a),r.firstCreatePass&&(r.firstCreatePass=!1),r.staticContentQueries&&Zu(r,o),r.staticViewQueries&&wp(2,r.viewQuery,a);const D=r.components;null!==D&&function L_(r,o){for(let a=0;a<o.length;a++)ug(r,o[a])}(o,D)}catch(d){throw r.firstCreatePass&&(r.incompleteFirstPass=!0,r.firstCreatePass=!1),d}finally{o[hn]&=-5,xi()}}function qh(r,o,a,d){const v=o[hn];if(128!=(128&v)){ci(o);try{pa(o),function ra(r){return Xn.lFrame.bindingIndex=r}(r.bindingStartIndex),null!==a&&dp(r,o,a,2,d);const k=3==(3&v);if(k){const Q=r.preOrderCheckHooks;null!==Q&&x(o,Q,null)}else{const Q=r.preOrderHooks;null!==Q&&E(o,Q,0,null),I(o,0)}if(function vp(r){for(let o=Gn(r);null!==o;o=jl(o)){if(!o[eo])continue;const a=o[no];for(let d=0;d<a.length;d++){const v=a[d];512&v[hn]||ks(v[Mi],1),v[hn]|=512}}}(o),function lg(r){for(let o=Gn(r);null!==o;o=jl(o))for(let a=Ei;a<o.length;a++){const d=o[a],v=d[Ft];Fo(d)&&qh(v,d,v.template,d[ki])}}(o),null!==r.contentQueries&&Zu(r,o),k){const Q=r.contentCheckHooks;null!==Q&&x(o,Q)}else{const Q=r.contentHooks;null!==Q&&E(o,Q,1),I(o,1)}!function k_(r,o){const a=r.hostBindingOpCodes;if(null!==a)try{for(let d=0;d<a.length;d++){const v=a[d];if(v<0)dr(~v);else{const D=v,k=a[++d],B=a[++d];se(k,D),B(2,o[D])}}}finally{dr(-1)}}(r,o);const B=r.components;null!==B&&function R_(r,o){for(let a=0;a<o.length;a++)cg(r,o[a])}(o,B);const $=r.viewQuery;if(null!==$&&wp(2,$,d),k){const Q=r.viewCheckHooks;null!==Q&&x(o,Q)}else{const Q=r.viewHooks;null!==Q&&E(o,Q,2),I(o,2)}!0===r.firstUpdatePass&&(r.firstUpdatePass=!1),o[hn]&=-41,512&o[hn]&&(o[hn]&=-513,ks(o[Mi],-1))}finally{xi()}}}function dp(r,o,a,d,v){const D=Wn(),k=2&d;try{dr(-1),k&&o.length>ri&&Gu(r,o,ri,!1),vo(k?2:0,v),a(d,v)}finally{dr(D),vo(k?3:1,v)}}function Dl(r,o,a){if(Mr(o)){const v=o.directiveEnd;for(let D=o.directiveStart;D<v;D++){const k=r.data[D];k.contentQueries&&k.contentQueries(1,a[D],D)}}}function kc(r,o,a){Fa()&&(function mp(r,o,a,d){const v=a.directiveStart,D=a.directiveEnd;Xr(a)&&function Kd(r,o,a){const d=Ir(o,r),v=Ym(a),D=r[Li],k=Zh(r,Hh(r,v,null,a.onPush?32:16,d,o,D,D.createRenderer(d,a),null,null,null));r[o.index]=k}(o,a,r.data[v+a.componentOffset]),r.firstCreatePass||kl(a,o),Ks(d,o);const k=a.initialInputs;for(let B=v;B<D;B++){const $=r.data[B],Q=qa(o,r,B,a);Ks(Q,o),null!==k&&ag(0,B-v,Q,$,0,k),ur($)&&(xr(a.index,o)[ki]=qa(o,r,B,a))}}(r,o,a,Ir(a,o)),64==(64&a.flags)&&Ea(r,o,a))}function Wd(r,o,a=Ir){const d=o.localNames;if(null!==d){let v=o.index+1;for(let D=0;D<d.length;D+=2){const k=d[D+1],B=-1===k?a(o,r):r[k];r[v++]=B}}}function Ym(r){const o=r.tView;return null===o||o.incompleteFirstPass?r.tView=fp(1,null,r.template,r.decls,r.vars,r.directiveDefs,r.pipeDefs,r.viewQuery,r.schemas,r.consts):o}function fp(r,o,a,d,v,D,k,B,$,Q){const he=ri+d,be=he+v,Ge=function O_(r,o){const a=[];for(let d=0;d<o;d++)a.push(d<r?null:$i);return a}(he,be),ot="function"==typeof Q?Q():Q;return Ge[Ft]={type:r,blueprint:Ge,template:a,queries:null,viewQuery:B,declTNode:o,data:Ge.slice().fill(null,he),bindingStartIndex:he,expandoStartIndex:be,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof D?D():D,pipeRegistry:"function"==typeof k?k():k,firstChild:null,schemas:$,consts:ot,incompleteFirstPass:!1}}function Jm(r,o,a,d){const v=bp(o);null===a?v.push(d):(v.push(a),r.firstCreatePass&&Ep(r).push(d,v.length-1))}function Qm(r,o,a,d){for(let v in r)if(r.hasOwnProperty(v)){a=null===a?{}:a;const D=r[v];null===d?eg(a,o,v,D):d.hasOwnProperty(v)&&eg(a,o,d[v],D)}return a}function eg(r,o,a,d){r.hasOwnProperty(a)?r[a].push(o,d):r[a]=[o,d]}function Qs(r,o,a,d,v,D,k,B){const $=Ir(o,a);let he,Q=o.inputs;!B&&null!=Q&&(he=Q[d])?(Jd(r,a,he,d,v),Xr(o)&&function tg(r,o){const a=xr(o,r);16&a[hn]||(a[hn]|=32)}(a,o.index)):3&o.type&&(d=function Zd(r){return"class"===r?"className":"for"===r?"htmlFor":"formaction"===r?"formAction":"innerHtml"===r?"innerHTML":"readonly"===r?"readOnly":"tabindex"===r?"tabIndex":r}(d),v=null!=k?k(v,o.value||"",d):v,D.setProperty($,d,v))}function pp(r,o,a,d){if(Fa()){const v=null===d?null:{"":-1},D=function og(r,o){const a=r.directiveRegistry;let d=null,v=null;if(a)for(let D=0;D<a.length;D++){const k=a[D];if(ip(o,k.selectors,!1))if(d||(d=[]),ur(k))if(null!==k.findHostDirectiveDefs){const B=[];v=v||new Map,k.findHostDirectiveDefs(k,B,v),d.unshift(...B,k),Ra(r,o,B.length)}else d.unshift(k),Ra(r,o,0);else v=v||new Map,k.findHostDirectiveDefs?.(k,d,v),d.push(k)}return null===d?null:[d,v]}(r,a);let k,B;null===D?k=B=null:[k,B]=D,null!==k&&ig(r,o,a,k,v,B),v&&function sg(r,o,a){if(o){const d=r.localNames=[];for(let v=0;v<o.length;v+=2){const D=a[o[v+1]];if(null==D)throw new tt(-301,!1);d.push(o[v],D)}}}(a,d,v)}a.mergedAttrs=kr(a.mergedAttrs,a.attrs)}function ig(r,o,a,d,v,D){for(let Q=0;Q<d.length;Q++)ec(kl(a,o),r,d[Q].type);!function Xu(r,o,a){r.flags|=1,r.directiveStart=o,r.directiveEnd=o+a,r.providerIndexes=o}(a,r.data.length,d.length);for(let Q=0;Q<d.length;Q++){const he=d[Q];he.providersResolver&&he.providersResolver(he)}let k=!1,B=!1,$=lr(r,o,d.length,null);for(let Q=0;Q<d.length;Q++){const he=d[Q];a.mergedAttrs=kr(a.mergedAttrs,he.hostAttrs),_p(r,a,o,$,he),Wh($,he,v),null!==he.contentQueries&&(a.flags|=4),(null!==he.hostBindings||null!==he.hostAttrs||0!==he.hostVars)&&(a.flags|=64);const be=he.type.prototype;!k&&(be.ngOnChanges||be.ngOnInit||be.ngDoCheck)&&((r.preOrderHooks??(r.preOrderHooks=[])).push(a.index),k=!0),!B&&(be.ngOnChanges||be.ngDoCheck)&&((r.preOrderCheckHooks??(r.preOrderCheckHooks=[])).push(a.index),B=!0),$++}!function z_(r,o,a){const v=o.directiveEnd,D=r.data,k=o.attrs,B=[];let $=null,Q=null;for(let he=o.directiveStart;he<v;he++){const be=D[he],Ge=a?a.get(be):null,Lt=Ge?Ge.outputs:null;$=Qm(be.inputs,he,$,Ge?Ge.inputs:null),Q=Qm(be.outputs,he,Q,Lt);const dn=null===$||null===k||np(o)?null:U_($,he,k);B.push(dn)}null!==$&&($.hasOwnProperty("class")&&(o.flags|=8),$.hasOwnProperty("style")&&(o.flags|=16)),o.initialInputs=B,o.inputs=$,o.outputs=Q}(r,a,D)}function Ea(r,o,a){const d=a.directiveStart,v=a.directiveEnd,D=a.index,k=function me(){return Xn.lFrame.currentDirectiveIndex}();try{dr(D);for(let B=d;B<v;B++){const $=r.data[B],Q=o[B];Oe(B),(null!==$.hostBindings||0!==$.hostVars||null!==$.hostAttrs)&&gp($,Q)}}finally{dr(-1),Oe(k)}}function gp(r,o){null!==r.hostBindings&&r.hostBindings(1,o)}function Ra(r,o,a){o.componentOffset=a,(r.components??(r.components=[])).push(o.index)}function Wh(r,o,a){if(a){if(o.exportAs)for(let d=0;d<o.exportAs.length;d++)a[o.exportAs[d]]=r;ur(o)&&(a[""]=r)}}function _p(r,o,a,d,v){r.data[d]=v;const D=v.factory||(v.factory=yo(v.type)),k=new en(D,ur(v),Cl);r.blueprint[d]=k,a[d]=k,function N_(r,o,a,d,v){const D=v.hostBindings;if(D){let k=r.hostBindingOpCodes;null===k&&(k=r.hostBindingOpCodes=[]);const B=~o.index;(function rg(r){let o=r.length;for(;o>0;){const a=r[--o];if("number"==typeof a&&a<0)return a}return 0})(k)!=B&&k.push(B),k.push(a,d,D)}}(r,o,d,lr(r,a,v.hostVars,$i),v)}function Zl(r,o,a,d,v,D){const k=Ir(r,o);!function Yd(r,o,a,d,v,D,k){if(null==D)r.removeAttribute(o,v,a);else{const B=null==k?pt(D):k(D,d||"",v);r.setAttribute(o,v,B,a)}}(o[Yn],k,D,r.value,a,d,v)}function ag(r,o,a,d,v,D){const k=D[o];if(null!==k){const B=d.setInput;for(let $=0;$<k.length;){const Q=k[$++],he=k[$++],be=k[$++];null!==B?d.setInput(a,be,Q,he):a[he]=be}}}function U_(r,o,a){let d=null,v=0;for(;v<a.length;){const D=a[v];if(0!==D)if(5!==D){if("number"==typeof D)break;if(r.hasOwnProperty(D)){null===d&&(d=[]);const k=r[D];for(let B=0;B<k.length;B+=2)if(k[B]===o){d.push(D,k[B+1],a[v+1]);break}}v+=2}else v+=2;else v+=4}return d}function yp(r,o,a,d){return[r,!0,!1,o,null,0,d,a,null,null]}function cg(r,o){const a=xr(o,r);if(Fo(a)){const d=a[Ft];48&a[hn]?qh(d,a,d.template,a[ki]):a[In]>0&&xp(a)}}function xp(r){for(let d=Gn(r);null!==d;d=jl(d))for(let v=Ei;v<d.length;v++){const D=d[v];if(Fo(D))if(512&D[hn]){const k=D[Ft];qh(k,D,k.template,D[ki])}else D[In]>0&&xp(D)}const a=r[Ft].components;if(null!==a)for(let d=0;d<a.length;d++){const v=xr(a[d],r);Fo(v)&&v[In]>0&&xp(v)}}function ug(r,o){const a=xr(o,r),d=a[Ft];(function cc(r,o){for(let a=o.length;a<r.blueprint.length;a++)o.push(r.blueprint[a])})(d,a),Gh(d,a,a[ki])}function Zh(r,o){return r[Zr]?r[Xo][Qi]=o:r[Zr]=o,r[Xo]=o,o}function Xh(r){for(;r;){r[hn]|=32;const o=gh(r);if(Hr(r)&&!o)return r;r=o}return null}function Kh(r,o,a,d=!0){const v=o[Li];v.begin&&v.begin();try{qh(r,o,r.template,a)}catch(k){throw d&&Tp(o,k),k}finally{v.end&&v.end()}}function wp(r,o,a){mt(0),o(r,a)}function bp(r){return r[So]||(r[So]=[])}function Ep(r){return r.cleanup||(r.cleanup=[])}function Tp(r,o){const a=r[Vr],d=a?a.get(uu,null):null;d&&d.handleError(o)}function Jd(r,o,a,d,v){for(let D=0;D<a.length;){const k=a[D++],B=a[D++],$=o[k],Q=r.data[k];null!==Q.setInput?Q.setInput($,v,d,B):$[B]=v}}function Us(r,o,a){const d=Ps(o,r);!function Af(r,o,a){r.setValue(o,a)}(r[Yn],d,a)}function Yu(r,o,a){let d=a?r.styles:null,v=a?r.classes:null,D=0;if(null!==o)for(let k=0;k<o.length;k++){const B=o[k];"number"==typeof B?D=B:1==D?v=Nn(v,B):2==D&&(d=Nn(d,B+": "+o[++k]+";"))}a?r.styles=d:r.stylesWithoutHost=d,a?r.classes=v:r.classesWithoutHost=v}function uc(r,o,a,d,v=!1){for(;null!==a;){const D=o[a.index];if(null!==D&&d.push(mr(D)),$r(D))for(let B=Ei;B<D.length;B++){const $=D[B],Q=$[Ft].firstChild;null!==Q&&uc($[Ft],$,Q,d)}const k=a.type;if(8&k)uc(r,o,a.child,d);else if(32&k){const B=pd(a,o);let $;for(;$=B();)d.push($)}else if(16&k){const B=Rf(o,a);if(Array.isArray(B))d.push(...B);else{const $=gh(o[Xi]);uc($[Ft],$,B,d,!0)}}a=v?a.projectionNext:a.next}return d}class Xl{get rootNodes(){const o=this._lView,a=o[Ft];return uc(a,o,a.firstChild,[])}constructor(o,a){this._lView=o,this._cdRefInjectingView=a,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[ki]}set context(o){this._lView[ki]=o}get destroyed(){return 128==(128&this._lView[hn])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[Mi];if($r(o)){const a=o[Hs],d=a?a.indexOf(this):-1;d>-1&&(Pf(o,d),p(a,d))}this._attachedToViewContainer=!1}_d(this._lView[Ft],this._lView)}onDestroy(o){Jm(this._lView[Ft],this._lView,null,o)}markForCheck(){Xh(this._cdRefInjectingView||this._lView)}detach(){this._lView[hn]&=-65}reattach(){this._lView[hn]|=64}detectChanges(){Kh(this._lView[Ft],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new tt(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function tu(r,o){Lu(r,o,o[Yn],2,null,null)}(this._lView[Ft],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new tt(902,!1);this._appRef=o}}class hg extends Xl{constructor(o){super(o),this._view=o}detectChanges(){const o=this._view;Kh(o[Ft],o,o[ki],!1)}checkNoChanges(){}get context(){return null}}class Yh extends Oh{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const a=ti(o);return new Jh(a,this.ngModule)}}function Cp(r){const o=[];for(let a in r)r.hasOwnProperty(a)&&o.push({propName:r[a],templateName:a});return o}class ef{constructor(o,a){this.injector=o,this.parentInjector=a}get(o,a,d){d=cn(d);const v=this.injector.get(o,Od,d);return v!==Od||a===Od?v:this.parentInjector.get(o,a,d)}}class Jh extends Am{get inputs(){return Cp(this.componentDef.inputs)}get outputs(){return Cp(this.componentDef.outputs)}constructor(o,a){super(),this.componentDef=o,this.ngModule=a,this.componentType=o.type,this.selector=function Ud(r){return r.map(Nd).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!a}create(o,a,d,v){let D=(v=v||this.ngModule)instanceof Cs?v:v?.injector;D&&null!==this.componentDef.getStandaloneInjector&&(D=this.componentDef.getStandaloneInjector(D)||D);const k=D?new ef(o,D):o,B=k.get(Mo,null);if(null===B)throw new tt(407,!1);const $=k.get(Ld,null),Q=B.createRenderer(null,this.componentDef),he=this.componentDef.selectors[0][0]||"div",be=d?function F_(r,o,a){return r.selectRootElement(o,a===on.ShadowDom)}(Q,d,this.componentDef.encapsulation):yh(Q,he,function Qd(r){const o=r.toLowerCase();return"svg"===o?Is:"math"===o?"math":null}(he)),Ge=this.componentDef.onPush?288:272,ot=fp(0,null,null,1,0,null,null,null,null,null),Lt=Hh(null,ot,null,Ge,null,null,B,Q,$,k,null);let dn,kn;ci(Lt);try{const $n=this.componentDef;let pi,sn=null;$n.findHostDirectiveDefs?(pi=[],sn=new Map,$n.findHostDirectiveDefs($n,pi,sn),pi.push($n)):pi=[$n];const qi=function $_(r,o){const a=r[Ft],d=ri;return r[d]=o,du(a,d,2,"#host",null)}(Lt,be),rs=function H_(r,o,a,d,v,D,k,B){const $=v[Ft];!function Ju(r,o,a,d){for(const v of r)o.mergedAttrs=kr(o.mergedAttrs,v.hostAttrs);null!==o.mergedAttrs&&(Yu(o,o.mergedAttrs,!0),null!==a&&Ou(d,a,o))}(d,r,o,k);const Q=D.createRenderer(o,a),he=Hh(v,Ym(a),null,a.onPush?32:16,v[r.index],r,D,Q,B||null,null,null);return $.firstCreatePass&&Ra($,r,d.length-1),Zh(v,he),v[r.index]=he}(qi,be,$n,pi,Lt,B,Q);kn=Pr(ot,ri),be&&function Dp(r,o,a,d){if(d)qr(r,a,["ng-version",Bh.full]);else{const{attrs:v,classes:D}=function C_(r){const o=[],a=[];let d=1,v=2;for(;d<r.length;){let D=r[d];if("string"==typeof D)2===v?""!==D&&o.push(D,r[++d]):8===v&&a.push(D);else{if(!Tl(v))break;v=D}d++}return{attrs:o,classes:a}}(o.selectors[0]);v&&qr(r,a,v),D&&D.length>0&&Of(r,a,D.join(" "))}}(Q,$n,be,d),void 0!==a&&function G_(r,o,a){const d=r.projection=[];for(let v=0;v<o.length;v++){const D=a[v];d.push(null!=D?Array.from(D):null)}}(kn,this.ngContentSelectors,a),dn=function Qu(r,o,a,d,v,D){const k=hr(),B=v[Ft],$=Ir(k,v);ig(B,v,k,a,null,d);for(let he=0;he<a.length;he++)Ks(qa(v,B,k.directiveStart+he,k),v);Ea(B,v,k),$&&Ks($,v);const Q=qa(v,B,k.directiveStart+k.componentOffset,k);if(r[ki]=v[ki]=Q,null!==D)for(const he of D)he(Q,o);return Dl(B,k,r),Q}(rs,$n,pi,sn,Lt,[dg]),Gh(ot,Lt,null)}finally{xi()}return new V_(this.componentType,dn,Vu(kn,Lt),Lt,kn)}}class V_ extends h_{constructor(o,a,d,v,D){super(),this.location=d,this._rootLView=v,this._tNode=D,this.instance=a,this.hostView=this.changeDetectorRef=new hg(v),this.componentType=o}setInput(o,a){const d=this._tNode.inputs;let v;if(null!==d&&(v=d[o])){const D=this._rootLView;Jd(D[Ft],D,v,o,a),Xh(xr(this._tNode.index,D))}}get injector(){return new so(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}function dg(){const r=hr();et(Nt()[Ft],r)}function Qh(r){let o=function fg(r){return Object.getPrototypeOf(r.prototype).constructor}(r.type),a=!0;const d=[r];for(;o;){let v;if(ur(r))v=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new tt(903,!1);v=o.\u0275dir}if(v){if(a){d.push(v);const k=r;k.inputs=fu(r.inputs),k.declaredInputs=fu(r.declaredInputs),k.outputs=fu(r.outputs);const B=v.hostBindings;B&&mg(r,B);const $=v.viewQuery,Q=v.contentQueries;if($&&Rc(r,$),Q&&pg(r,Q),bn(r.inputs,v.inputs),bn(r.declaredInputs,v.declaredInputs),bn(r.outputs,v.outputs),ur(v)&&v.data.animation){const he=r.data;he.animation=(he.animation||[]).concat(v.data.animation)}}const D=v.features;if(D)for(let k=0;k<D.length;k++){const B=D[k];B&&B.ngInherit&&B(r),B===Qh&&(a=!1)}}o=Object.getPrototypeOf(o)}!function q_(r){let o=0,a=null;for(let d=r.length-1;d>=0;d--){const v=r[d];v.hostVars=o+=v.hostVars,v.hostAttrs=kr(v.hostAttrs,a=kr(a,v.hostAttrs))}}(d)}function fu(r){return r===_n?{}:r===Tn?[]:r}function Rc(r,o){const a=r.viewQuery;r.viewQuery=a?(d,v)=>{o(d,v),a(d,v)}:o}function pg(r,o){const a=r.contentQueries;r.contentQueries=a?(d,v,D)=>{o(d,v,D),a(d,v,D)}:o}function mg(r,o){const a=r.hostBindings;r.hostBindings=a?(d,v)=>{o(d,v),a(d,v)}:o}function Fc(r){return!!Ap(r)&&(Array.isArray(r)||!(r instanceof Map)&&Symbol.iterator in r)}function Ap(r){return null!==r&&("function"==typeof r||"object"==typeof r)}function La(r,o,a){return r[o]=a}function Bc(r,o){return r[o]}function Ta(r,o,a){return!Object.is(r[o],a)&&(r[o]=a,!0)}function zc(r,o,a,d){const v=Ta(r,o,a);return Ta(r,o+1,d)||v}function sf(r,o,a,d){const v=Nt();return Ta(v,ie(),o)&&(Pi(),Zl(Si(),v,r,o,a,d)),sf}function pu(r,o,a,d){return Ta(r,ie(),a)?o+pt(a)+d:$i}function nh(r,o,a,d,v,D){const B=zc(r,function zo(){return Xn.lFrame.bindingIndex}(),a,v);return R(2),B?o+pt(a)+d+pt(v)+D:$i}function wg(r,o,a,d,v,D,k,B){const $=Nt(),Q=Pi(),he=r+ri,be=Q.firstCreatePass?function K_(r,o,a,d,v,D,k,B,$){const Q=o.consts,he=du(o,r,4,k||null,ho(Q,B));pp(o,a,he,ho(Q,$)),et(o,he);const be=he.tView=fp(2,he,d,v,D,o.directiveRegistry,o.pipeRegistry,null,o.schemas,Q);return null!==o.queries&&(o.queries.template(o,he),be.queries=o.queries.embeddedTView(he)),he}(he,Q,$,o,a,d,v,D,k):Q.data[he];wr(be,!1);const Ge=$[Yn].createComment("");bd(Q,$,Ge,be),Ks(Ge,$),Zh($,$[he]=yp(Ge,$,Ge,be)),us(be)&&kc(Q,$,be),null!=k&&Wd($,be,B)}function bg(r){return bs(function Es(){return Xn.lFrame.contextLView}(),ri+r)}function gu(r,o,a){const d=Nt();return Ta(d,ie(),o)&&Qs(Pi(),Si(),d,r,o,d[Yn],a,!1),gu}function Pp(r,o,a,d,v){const k=v?"class":"style";Jd(r,a,o.inputs[k],k,d)}function id(r,o,a,d){const v=Nt(),D=Pi(),k=ri+r,B=v[Yn],$=D.firstCreatePass?function Y_(r,o,a,d,v,D){const k=o.consts,$=du(o,r,2,d,ho(k,v));return pp(o,a,$,ho(k,D)),null!==$.attrs&&Yu($,$.attrs,!1),null!==$.mergedAttrs&&Yu($,$.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,$),$}(k,D,v,o,a,d):D.data[k],Q=v[k]=yh(B,o,function ue(){return Xn.lFrame.currentNamespace}()),he=us($);return wr($,!0),Ou(B,Q,$),32!=(32&$.flags)&&bd(D,v,Q,$),0===function fs(){return Xn.lFrame.elementDepthCount}()&&Ks(Q,v),function ta(){Xn.lFrame.elementDepthCount++}(),he&&(kc(D,v,$),Dl(D,$,v)),null!==d&&Wd(v,$),id}function uf(){let r=hr();ma()?ga():(r=r.parent,wr(r,!1));const o=r;!function na(){Xn.lFrame.elementDepthCount--}();const a=Pi();return a.firstCreatePass&&(et(a,r),Mr(r)&&a.queries.elementEnd(r)),null!=o.classesWithoutHost&&function Xs(r){return 0!=(8&r.flags)}(o)&&Pp(a,o,Nt(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function ts(r){return 0!=(16&r.flags)}(o)&&Pp(a,o,Nt(),o.stylesWithoutHost,!1),uf}function hf(r,o,a,d){return id(r,o,a,d),uf(),hf}function Xa(r,o,a){const d=Nt(),v=Pi(),D=r+ri,k=v.firstCreatePass?function hl(r,o,a,d,v){const D=o.consts,k=ho(D,d),B=du(o,r,8,"ng-container",k);return null!==k&&Yu(B,k,!0),pp(o,a,B,ho(D,v)),null!==o.queries&&o.queries.elementStart(o,B),B}(D,v,d,o,a):v.data[D];wr(k,!0);const B=d[D]=d[Yn].createComment("");return bd(v,d,B,k),Ks(B,d),us(k)&&(kc(v,d,k),Dl(v,k,d)),null!=a&&Wd(d,k),Xa}function Sl(){let r=hr();const o=Pi();return ma()?ga():(r=r.parent,wr(r,!1)),o.firstCreatePass&&(et(o,r),Mr(r)&&o.queries.elementEnd(r)),Sl}function dl(r,o,a){return Xa(r,o,a),Sl(),dl}function mc(){return Nt()}function oh(r){return!!r&&"function"==typeof r.then}function kp(r){return!!r&&"function"==typeof r.subscribe}const Rp=kp;function df(r,o,a,d){const v=Nt(),D=Pi(),k=hr();return function Lp(r,o,a,d,v,D,k){const B=us(d),Q=r.firstCreatePass&&Ep(r),he=o[ki],be=bp(o);let Ge=!0;if(3&d.type||k){const dn=Ir(d,o),kn=k?k(dn):dn,$n=be.length,pi=k?qi=>k(mr(qi[d.index])):d.index;let sn=null;if(!k&&B&&(sn=function J_(r,o,a,d){const v=r.cleanup;if(null!=v)for(let D=0;D<v.length-1;D+=2){const k=v[D];if(k===a&&v[D+1]===d){const B=o[So],$=v[D+2];return B.length>$?B[$]:null}"string"==typeof k&&(D+=2)}return null}(r,o,v,d.index)),null!==sn)(sn.__ngLastListenerFn__||sn).__ngNextListenerFn__=D,sn.__ngLastListenerFn__=D,Ge=!1;else{D=Fp(d,o,he,D,!1);const qi=a.listen(kn,v,D);be.push(D,qi),Q&&Q.push(v,pi,$n,$n+1)}}else D=Fp(d,o,he,D,!1);const ot=d.outputs;let Lt;if(Ge&&null!==ot&&(Lt=ot[v])){const dn=Lt.length;if(dn)for(let kn=0;kn<dn;kn+=2){const rs=o[Lt[kn]][Lt[kn+1]].subscribe(D),Vs=be.length;be.push(D,rs),Q&&Q.push(v,d.index,Vs,-(Vs+1))}}}(D,v,v[Yn],k,r,o,d),df}function Op(r,o,a,d){try{return vo(6,o,a),!1!==a(d)}catch(v){return Tp(r,v),!1}finally{vo(7,o,a)}}function Fp(r,o,a,d,v){return function D(k){if(k===Function)return d;Xh(r.componentOffset>-1?xr(r.index,o):o);let $=Op(o,a,d,k),Q=D.__ngNextListenerFn__;for(;Q;)$=Op(o,a,Q,k)&&$,Q=Q.__ngNextListenerFn__;return v&&!1===$&&(k.preventDefault(),k.returnValue=!1),$}}function Bp(r=1){return function gr(r){return(Xn.lFrame.contextLView=function tr(r,o){for(;r>0;)o=o[fr],r--;return o}(r,Xn.lFrame.contextLView))[ki]}(r)}function Eg(r,o){let a=null;const d=function Lm(r){const o=r.attrs;if(null!=o){const a=o.indexOf(5);if(!(1&a))return o[a+1]}return null}(r);for(let v=0;v<o.length;v++){const D=o[v];if("*"!==D){if(null===d?ip(r,D,!0):T_(d,D))return v}else a=v}return a}function zp(r){const o=Nt()[Xi][Ii];if(!o.projection){const d=o.projection=w(r?r.length:1,null),v=d.slice();let D=o.child;for(;null!==D;){const k=r?Eg(D,r):0;null!==k&&(v[k]?v[k].projectionNext=D:d[k]=D,v[k]=D),D=D.next}}}function Np(r,o=0,a){const d=Nt(),v=Pi(),D=du(v,ri+r,16,null,a||null);null===D.projection&&(D.projection=o),ga(),32!=(32&D.flags)&&function lm(r,o,a){Lf(o[Yn],0,o,a,Vl(r,a,o),wd(a.parent||o[Ii],a,o))}(v,d,D)}function Kl(r,o,a){return pf(r,"",o,"",a),Kl}function pf(r,o,a,d,v){const D=Nt(),k=pu(D,o,a,d);return k!==$i&&Qs(Pi(),Si(),D,r,k,D[Yn],v,!1),pf}function sh(r,o){return r<<17|o<<2}function Yl(r){return r>>17&32767}function _f(r){return 2|r}function Nc(r){return(131068&r)>>2}function vu(r,o){return-131069&r|o<<2}function vf(r){return 1|r}function Up(r,o,a,d,v){const D=r[a+1],k=null===o;let B=d?Yl(D):Nc(D),$=!1;for(;0!==B&&(!1===$||k);){const he=r[B+1];ey(r[B],o)&&($=!0,r[B+1]=d?vf(he):_f(he)),B=d?Yl(he):Nc(he)}$&&(r[a+1]=d?_f(D):vf(D))}function ey(r,o){return null===r||null==o||(Array.isArray(r)?r[1]:r)===o||!(!Array.isArray(r)||"string"!=typeof o)&&M(r,o)>=0}const gs={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function jp(r){return r.substring(gs.key,gs.keyEnd)}function Mg(r){return r.substring(gs.value,gs.valueEnd)}function xf(r,o){const a=gs.textEnd;return a===o?-1:(o=gs.keyEnd=function Pg(r,o,a){for(;o<a&&r.charCodeAt(o)>32;)o++;return o}(r,gs.key=o,a),Uc(r,o,a))}function $p(r,o){const a=gs.textEnd;let d=gs.key=Uc(r,o,a);return a===d?-1:(d=gs.keyEnd=function t(r,o,a){let d;for(;o<a&&(45===(d=r.charCodeAt(o))||95===d||(-33&d)>=65&&(-33&d)<=90||d>=48&&d<=57);)o++;return o}(r,d,a),d=e(r,d,a),d=gs.value=Uc(r,d,a),d=gs.valueEnd=function n(r,o,a){let d=-1,v=-1,D=-1,k=o,B=k;for(;k<a;){const $=r.charCodeAt(k++);if(59===$)return B;34===$||39===$?B=k=s(r,$,k,a):o===k-4&&85===D&&82===v&&76===d&&40===$?B=k=s(r,41,k,a):$>32&&(B=k),D=v,v=d,d=-33&$}return B}(r,d,a),e(r,d,a))}function ah(r){gs.key=0,gs.keyEnd=0,gs.value=0,gs.valueEnd=0,gs.textEnd=r.length}function Uc(r,o,a){for(;o<a&&r.charCodeAt(o)<=32;)o++;return o}function e(r,o,a,d){return(o=Uc(r,o,a))<a&&o++,o}function s(r,o,a,d){let v=-1,D=a;for(;D<d;){const k=r.charCodeAt(D++);if(k==o&&92!==v)return D;v=92==k&&92===v?0:k}throw new Error}function g(r,o){return function z(r,o,a,d){const v=Nt(),D=Pi(),k=R(2);D.firstUpdatePass&&X(D,r,k,d),o!==$i&&Ta(v,k,o)&&yt(D,D.data[Wn()],v,v[Yn],r,v[k+1]=function St(r,o){return null==r||""===r||("string"==typeof o?r+=o:"object"==typeof r&&(r=Yt(Dc(r)))),r}(o,a),d,k)}(r,o,null,!0),g}function b(r){V(Le,S,r,!1)}function S(r,o){for(let a=function Vp(r){return ah(r),$p(r,Uc(r,0,gs.textEnd))}(o);a>=0;a=$p(o,a))Le(r,jp(o),Mg(o))}function A(r){V(rt,O,r,!0)}function O(r,o){for(let a=function Ig(r){return ah(r),xf(r,Uc(r,0,gs.textEnd))}(o);a>=0;a=xf(o,a))_(r,jp(o),!0)}function V(r,o,a,d){const v=Pi(),D=R(2);v.firstUpdatePass&&X(v,null,D,d);const k=Nt();if(a!==$i&&Ta(k,D,a)){const B=v.data[Wn()];if(Ct(B,d)&&!q(v,D)){let $=d?B.classesWithoutHost:B.stylesWithoutHost;null!==$&&(a=Nn($,a||"")),Pp(v,B,k,a,d)}else!function Qe(r,o,a,d,v,D,k,B){v===$i&&(v=Tn);let $=0,Q=0,he=0<v.length?v[0]:null,be=0<D.length?D[0]:null;for(;null!==he||null!==be;){const Ge=$<v.length?v[$+1]:void 0,ot=Q<D.length?D[Q+1]:void 0;let dn,Lt=null;he===be?($+=2,Q+=2,Ge!==ot&&(Lt=be,dn=ot)):null===be||null!==he&&he<be?($+=2,Lt=he):(Q+=2,Lt=be,dn=ot),null!==Lt&&yt(r,o,a,d,Lt,dn,k,B),he=$<v.length?v[$]:null,be=Q<D.length?D[Q]:null}}(v,B,k,k[Yn],k[D+1],k[D+1]=function Fe(r,o,a){if(null==a||""===a)return Tn;const d=[],v=Dc(a);if(Array.isArray(v))for(let D=0;D<v.length;D++)r(d,v[D],!0);else if("object"==typeof v)for(const D in v)v.hasOwnProperty(D)&&r(d,D,v[D]);else"string"==typeof v&&o(d,v);return d}(r,o,a),d,D)}}function q(r,o){return o>=r.expandoStartIndex}function X(r,o,a,d){const v=r.data;if(null===v[a+1]){const D=v[Wn()],k=q(r,a);Ct(D,d)&&null===o&&!k&&(o=!1),o=function te(r,o,a,d){const v=function Ue(r){const o=Xn.lFrame.currentDirectiveIndex;return-1===o?null:r[o]}(r);let D=d?o.residualClasses:o.residualStyles;if(null===v)0===(d?o.classBindings:o.styleBindings)&&(a=De(a=ve(null,r,o,a,d),o.attrs,d),D=null);else{const k=o.directiveStylingLast;if(-1===k||r[k]!==v)if(a=ve(v,r,o,a,d),null===D){let $=function de(r,o,a){const d=a?o.classBindings:o.styleBindings;if(0!==Nc(d))return r[Yl(d)]}(r,o,d);void 0!==$&&Array.isArray($)&&($=ve(null,r,o,$[1],d),$=De($,o.attrs,d),function ye(r,o,a,d){r[Yl(a?o.classBindings:o.styleBindings)]=d}(r,o,d,$))}else D=function Ie(r,o,a){let d;const v=o.directiveEnd;for(let D=1+o.directiveStylingLast;D<v;D++)d=De(d,r[D].hostAttrs,a);return De(d,o.attrs,a)}(r,o,d)}return void 0!==D&&(d?o.residualClasses=D:o.residualStyles=D),a}(v,D,o,d),function Sg(r,o,a,d,v,D){let k=D?o.classBindings:o.styleBindings,B=Yl(k),$=Nc(k);r[d]=a;let he,Q=!1;if(Array.isArray(a)?(he=a[1],(null===he||M(a,he)>0)&&(Q=!0)):he=a,v)if(0!==$){const Ge=Yl(r[B+1]);r[d+1]=sh(Ge,B),0!==Ge&&(r[Ge+1]=vu(r[Ge+1],d)),r[B+1]=function yu(r,o){return 131071&r|o<<17}(r[B+1],d)}else r[d+1]=sh(B,0),0!==B&&(r[B+1]=vu(r[B+1],d)),B=d;else r[d+1]=sh($,0),0===B?B=d:r[$+1]=vu(r[$+1],d),$=d;Q&&(r[d+1]=_f(r[d+1])),Up(r,he,d,!0),Up(r,he,d,!1),function Ag(r,o,a,d,v){const D=v?r.residualClasses:r.residualStyles;null!=D&&"string"==typeof o&&M(D,o)>=0&&(a[d+1]=vf(a[d+1]))}(o,he,r,d,D),k=sh(B,$),D?o.classBindings=k:o.styleBindings=k}(v,D,o,a,k,d)}}function ve(r,o,a,d,v){let D=null;const k=a.directiveEnd;let B=a.directiveStylingLast;for(-1===B?B=a.directiveStart:B++;B<k&&(D=o[B],d=De(d,D.hostAttrs,v),D!==r);)B++;return null!==r&&(a.directiveStylingLast=B),d}function De(r,o,a){const d=a?1:2;let v=-1;if(null!==o)for(let D=0;D<o.length;D++){const k=o[D];"number"==typeof k?v=k:v===d&&(Array.isArray(r)||(r=void 0===r?[]:["",r]),_(r,k,!!a||o[++D]))}return void 0===r?null:r}function Le(r,o,a){_(r,o,Dc(a))}function rt(r,o,a){const d=String(o);""!==d&&!d.includes(" ")&&_(r,d,a)}function yt(r,o,a,d,v,D,k,B){if(!(3&o.type))return;const $=r.data,Q=$[B+1],he=function yf(r){return 1==(1&r)}(Q)?qt($,o,a,v,Nc(Q),k):void 0;lt(he)||(lt(D)||function Ml(r){return 2==(2&r)}(Q)&&(D=qt($,null,a,v,B,k)),function e_(r,o,a,d,v){if(o)v?r.addClass(a,d):r.removeClass(a,d);else{let D=-1===d.indexOf("-")?void 0:ja.DashCase;null==v?r.removeStyle(a,d,D):("string"==typeof v&&v.endsWith("!important")&&(v=v.slice(0,-10),D|=ja.Important),r.setStyle(a,d,v,D))}}(d,k,Ps(Wn(),a),v,D))}function qt(r,o,a,d,v,D){const k=null===o;let B;for(;v>0;){const $=r[v],Q=Array.isArray($),he=Q?$[1]:$,be=null===he;let Ge=a[v+1];Ge===$i&&(Ge=be?Tn:void 0);let ot=be?T(Ge,d):he===d?Ge:void 0;if(Q&&!lt(ot)&&(ot=T($,d)),lt(ot)&&(B=ot,k))return B;const Lt=r[v+1];v=k?Yl(Lt):Nc(Lt)}if(null!==o){let $=D?o.residualClasses:o.residualStyles;null!=$&&(B=T($,d))}return B}function lt(r){return void 0!==r}function Ct(r,o){return 0!=(r.flags&(o?8:16))}function Bt(r,o=""){const a=Nt(),d=Pi(),v=r+ri,D=d.firstCreatePass?du(d,v,1,o,null):d.data[v],k=a[v]=function md(r,o){return r.createText(o)}(a[Yn],o);bd(d,a,k,D),wr(D,!1)}function Xt(r){return gt("",r,""),Xt}function gt(r,o,a){const d=Nt(),v=pu(d,r,o,a);return v!==$i&&Us(d,Wn(),v),gt}function mn(r,o,a,d,v){const D=Nt(),k=nh(D,r,o,a,d,v);return k!==$i&&Us(D,Wn(),k),mn}const jc=void 0;var Rg=["en",[["a","p"],["AM","PM"],jc],[["AM","PM"],jc,jc],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],jc,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],jc,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",jc,"{1} 'at' {0}",jc],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function kg(r){const a=Math.floor(Math.abs(r)),d=r.toString().replace(/^[^.]*\.?/,"").length;return 1===a&&0===d?1:5}];let wu={};function od(r){const o=function $c(r){return r.toLowerCase().replace(/_/g,"-")}(r);let a=Vc(o);if(a)return a;const d=o.split("-")[0];if(a=Vc(d),a)return a;if("en"===d)return Rg;throw new tt(701,!1)}function Hp(r){return od(r)[fi.PluralCase]}function Vc(r){return r in wu||(wu[r]=vi.ng&&vi.ng.common&&vi.ng.common.locales&&vi.ng.common.locales[r]),wu[r]}var fi=(()=>((fi=fi||{})[fi.LocaleId=0]="LocaleId",fi[fi.DayPeriodsFormat=1]="DayPeriodsFormat",fi[fi.DayPeriodsStandalone=2]="DayPeriodsStandalone",fi[fi.DaysFormat=3]="DaysFormat",fi[fi.DaysStandalone=4]="DaysStandalone",fi[fi.MonthsFormat=5]="MonthsFormat",fi[fi.MonthsStandalone=6]="MonthsStandalone",fi[fi.Eras=7]="Eras",fi[fi.FirstDayOfWeek=8]="FirstDayOfWeek",fi[fi.WeekendRange=9]="WeekendRange",fi[fi.DateFormat=10]="DateFormat",fi[fi.TimeFormat=11]="TimeFormat",fi[fi.DateTimeFormat=12]="DateTimeFormat",fi[fi.NumberSymbols=13]="NumberSymbols",fi[fi.NumberFormats=14]="NumberFormats",fi[fi.CurrencyCode=15]="CurrencyCode",fi[fi.CurrencySymbol=16]="CurrencySymbol",fi[fi.CurrencyName=17]="CurrencyName",fi[fi.Currencies=18]="Currencies",fi[fi.Directionality=19]="Directionality",fi[fi.PluralCase=20]="PluralCase",fi[fi.ExtraData=21]="ExtraData",fi))();const js="en-US";let Wy=js;function ry(r,o,a,d,v){if(r=an(r),Array.isArray(r))for(let D=0;D<r.length;D++)ry(r[D],o,a,d,v);else{const D=Pi(),k=Nt();let B=au(r)?r:an(r.provide),$=Dm(r);const Q=hr(),he=1048575&Q.providerIndexes,be=Q.directiveStart,Ge=Q.providerIndexes>>20;if(au(r)||!r.multi){const ot=new en($,v,Cl),Lt=sy(B,o,v?he:he+Ge,be);-1===Lt?(ec(kl(Q,k),D,B),oy(D,r,o.length),o.push(B),Q.directiveStart++,Q.directiveEnd++,v&&(Q.providerIndexes+=1048576),a.push(ot),k.push(ot)):(a[Lt]=ot,k[Lt]=ot)}else{const ot=sy(B,o,he+Ge,be),Lt=sy(B,o,he,he+Ge),kn=Lt>=0&&a[Lt];if(v&&!kn||!v&&!(ot>=0&&a[ot])){ec(kl(Q,k),D,B);const $n=function $x(r,o,a,d,v){const D=new en(r,a,Cl);return D.multi=[],D.index=o,D.componentProviders=0,yv(D,v,d&&!a),D}(v?Vx:jx,a.length,v,d,$);!v&&kn&&(a[Lt].providerFactory=$n),oy(D,r,o.length,0),o.push(B),Q.directiveStart++,Q.directiveEnd++,v&&(Q.providerIndexes+=1048576),a.push($n),k.push($n)}else oy(D,r,ot>-1?ot:Lt,yv(a[v?Lt:ot],$,!v&&d));!v&&d&&kn&&a[Lt].componentProviders++}}}function oy(r,o,a,d){const v=au(o),D=function l_(r){return!!r.useClass}(o);if(v||D){const $=(D?an(o.useClass):o).prototype.ngOnDestroy;if($){const Q=r.destroyHooks||(r.destroyHooks=[]);if(!v&&o.multi){const he=Q.indexOf(a);-1===he?Q.push(a,[d,$]):Q[he+1].push(d,$)}else Q.push(a,$)}}}function yv(r,o,a){return a&&r.componentProviders++,r.multi.push(o)-1}function sy(r,o,a,d){for(let v=a;v<d;v++)if(o[v]===r)return v;return-1}function jx(r,o,a,d){return ay(this.multi,[])}function Vx(r,o,a,d){const v=this.multi;let D;if(this.providerFactory){const k=this.providerFactory.componentProviders,B=qa(a,a[Ft],this.providerFactory.index,d);D=B.slice(0,k),ay(v,D);for(let $=k;$<B.length;$++)D.push(B[$])}else D=[],ay(v,D);return D}function ay(r,o){for(let a=0;a<r.length;a++)o.push((0,r[a])());return o}function vv(r,o=[]){return a=>{a.providersResolver=(d,v)=>function Ux(r,o,a){const d=Pi();if(d.firstCreatePass){const v=ur(r);ry(a,d.data,d.blueprint,v,!0),ry(o,d.data,d.blueprint,v,!1)}}(d,v?v(r):r,o)}}class wf{}class xv{}function Hx(r,o){return new wv(r,o??null)}class wv extends wf{constructor(o,a){super(),this._parent=a,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new Yh(this);const d=ir(o);this._bootstrapComponents=El(d.bootstrap),this._r3Injector=Um(o,a,[{provide:wf,useValue:this},{provide:Oh,useValue:this.componentFactoryResolver}],Yt(o),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(o)}get injector(){return this._r3Injector}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(a=>a()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class ly extends xv{constructor(o){super(),this.moduleType=o}create(o){return new wv(this.moduleType,o)}}class Gx extends wf{constructor(o,a,d){super(),this.componentFactoryResolver=new Yh(this),this.instance=null;const v=new Cm([...o,{provide:wf,useValue:this},{provide:Oh,useValue:this.componentFactoryResolver}],a||cl(),d,new Set(["environment"]));this.injector=v,v.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(o){this.injector.onDestroy(o)}}function cy(r,o,a=null){return new Gx(r,o,a).injector}let qx=(()=>{class r{constructor(a){this._injector=a,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(a){if(!a.standalone)return null;if(!this.cachedInjectors.has(a.id)){const d=su(0,a.type),v=d.length>0?cy([d],this._injector,`Standalone[${a.type.name}]`):null;this.cachedInjectors.set(a.id,v)}return this.cachedInjectors.get(a.id)}ngOnDestroy(){try{for(const a of this.cachedInjectors.values())null!==a&&a.destroy()}finally{this.cachedInjectors.clear()}}}return r.\u0275prov=li({token:r,providedIn:"environment",factory:()=>new r(Ye(Cs))}),r})();function bv(r){r.getStandaloneInjector=o=>o.get(qx).getOrCreateStandaloneInjector(r)}function Mv(r,o,a){const d=oo()+r,v=Nt();return v[d]===$i?La(v,d,a?o.call(a):o()):Bc(v,d)}function Iv(r,o,a,d){return Rv(Nt(),oo(),r,o,a,d)}function Pv(r,o,a,d,v){return function Lv(r,o,a,d,v,D,k){const B=o+a;return zc(r,B,v,D)?La(r,B+2,k?d.call(k,v,D):d(v,D)):Yp(r,B+2)}(Nt(),oo(),r,o,a,d,v)}function kv(r,o,a,d,v,D,k,B,$){const Q=oo()+r,he=Nt(),be=function ul(r,o,a,d,v,D){const k=zc(r,o,a,d);return zc(r,o+2,v,D)||k}(he,Q,a,d,v,D);return zc(he,Q+4,k,B)||be?La(he,Q+6,$?o.call($,a,d,v,D,k,B):o(a,d,v,D,k,B)):Bc(he,Q+6)}function Yp(r,o){const a=r[o];return a===$i?void 0:a}function Rv(r,o,a,d,v,D){const k=o+a;return Ta(r,k,v)?La(r,k+1,D?d.call(D,v):d(v)):Yp(r,k+1)}function Ov(r,o,a,d,v,D,k,B){const $=o+a;return function td(r,o,a,d,v){const D=zc(r,o,a,d);return Ta(r,o+2,v)||D}(r,$,v,D,k)?La(r,$+3,B?d.call(B,v,D,k):d(v,D,k)):Yp(r,$+3)}function zv(r,o){const a=Pi();let d;const v=r+ri;a.firstCreatePass?(d=function aw(r,o){if(o)for(let a=o.length-1;a>=0;a--){const d=o[a];if(r===d.name)return d}}(o,a.pipeRegistry),a.data[v]=d,d.onDestroy&&(a.destroyHooks??(a.destroyHooks=[])).push(v,d.onDestroy)):d=a.data[v];const D=d.factory||(d.factory=yo(d.type)),k=Ri(Cl);try{const B=za(!1),$=D();return za(B),function Ip(r,o,a,d){a>=r.data.length&&(r.data[a]=null,r.blueprint[a]=null),o[a]=d}(a,Nt(),v,$),$}finally{Ri(k)}}function Nv(r,o,a){const d=r+ri,v=Nt(),D=bs(v,d);return Jp(v,d)?Rv(v,oo(),o,D.transform,a,D):D.transform(a)}function Uv(r,o,a,d,v){const D=r+ri,k=Nt(),B=bs(k,D);return Jp(k,D)?Ov(k,oo(),o,B.transform,a,d,v,B):B.transform(a,d,v)}function Jp(r,o){return r[Ft].data[o].pure}function hy(r){return o=>{setTimeout(r,void 0,o)}}const Gc=class hw extends Y.x{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,a,d){let v=o,D=a||(()=>null),k=d;if(o&&"object"==typeof o){const $=o;v=$.next?.bind($),D=$.error?.bind($),k=$.complete?.bind($)}this.__isAsync&&(D=hy(D),v&&(v=hy(v)),k&&(k=hy(k)));const B=super.subscribe({next:v,error:D,complete:k});return o instanceof W.w0&&o.add(B),B}};function dw(){return this._results[Symbol.iterator]()}class dy{get changes(){return this._changes||(this._changes=new Gc)}constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const a=dy.prototype;a[Symbol.iterator]||(a[Symbol.iterator]=dw)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,a){return this._results.reduce(o,a)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,a){const d=this;d.dirty=!1;const v=function h(r){return r.flat(Number.POSITIVE_INFINITY)}(o);(this._changesDetected=!function Bl(r,o,a){if(r.length!==o.length)return!1;for(let d=0;d<r.length;d++){let v=r[d],D=o[d];if(a&&(v=a(v),D=a(D)),D!==v)return!1}return!0}(d._results,v,a))&&(d._results=v,d.length=v.length,d.last=v[this.length-1],d.first=v[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Qp=(()=>{class r{}return r.__NG_ELEMENT_ID__=mw,r})();const fw=Qp,pw=class extends fw{constructor(o,a,d){super(),this._declarationLView=o,this._declarationTContainer=a,this.elementRef=d}createEmbeddedView(o,a){const d=this._declarationTContainer.tView,v=Hh(this._declarationLView,d,o,16,null,d.declTNode,null,null,null,null,a||null);v[ko]=this._declarationLView[this._declarationTContainer.index];const k=this._declarationLView[_o];return null!==k&&(v[_o]=k.createEmbeddedView(d)),Gh(d,v,o),new Xl(v)}};function mw(){return zg(hr(),Nt())}function zg(r,o){return 4&r.type?new pw(o,r,Vu(r,o)):null}let Ng=(()=>{class r{}return r.__NG_ELEMENT_ID__=gw,r})();function gw(){return $v(hr(),Nt())}const _w=Ng,jv=class extends _w{constructor(o,a,d){super(),this._lContainer=o,this._hostTNode=a,this._hostLView=d}get element(){return Vu(this._hostTNode,this._hostLView)}get injector(){return new so(this._hostTNode,this._hostLView)}get parentInjector(){const o=_l(this._hostTNode,this._hostLView);if(Ql(o)){const a=Qa(o,this._hostLView),d=pl(o);return new so(a[Ft].data[d+8],a)}return new so(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const a=Vv(this._lContainer);return null!==a&&a[o]||null}get length(){return this._lContainer.length-Ei}createEmbeddedView(o,a,d){let v,D;"number"==typeof d?v=d:null!=d&&(v=d.index,D=d.injector);const k=o.createEmbeddedView(a||{},D);return this.insert(k,v),k}createComponent(o,a,d,v,D){const k=o&&!function vl(r){return"function"==typeof r}(o);let B;if(k)B=a;else{const be=a||{};B=be.index,d=be.injector,v=be.projectableNodes,D=be.environmentInjector||be.ngModuleRef}const $=k?o:new Jh(ti(o)),Q=d||this.parentInjector;if(!D&&null==$.ngModule){const Ge=(k?Q:this.parentInjector).get(Cs,null);Ge&&(D=Ge)}const he=$.create(Q,v,void 0,D);return this.insert(he.hostView,B),he}insert(o,a){const d=o._lView,v=d[Ft];if(function Bo(r){return $r(r[Mi])}(d)){const he=this.indexOf(o);if(-1!==he)this.detach(he);else{const be=d[Mi],Ge=new jv(be,be[Ii],be[Mi]);Ge.detach(Ge.indexOf(o))}}const D=this._adjustIndex(a),k=this._lContainer;!function gd(r,o,a,d){const v=Ei+d,D=a.length;d>0&&(a[v-1][Qi]=o),d<D-Ei?(o[Qi]=a[v],l(a,Ei+d,o)):(a.push(o),o[Qi]=null),o[Mi]=a;const k=o[ko];null!==k&&a!==k&&function am(r,o){const a=r[no];o[Xi]!==o[Mi][Mi][Xi]&&(r[eo]=!0),null===a?r[no]=[o]:a.push(o)}(k,o);const B=o[_o];null!==B&&B.insertView(r),o[hn]|=64}(v,d,k,D);const B=Td(D,k),$=d[Yn],Q=zs($,k[to]);return null!==Q&&function vh(r,o,a,d,v,D){d[tn]=v,d[Ii]=o,Lu(r,d,a,1,v,D)}(v,k[Ii],$,d,Q,B),o.attachToViewContainerRef(),l(fy(k),D,o),o}move(o,a){return this.insert(o,a)}indexOf(o){const a=Vv(this._lContainer);return null!==a?a.indexOf(o):-1}remove(o){const a=this._adjustIndex(o,-1),d=Pf(this._lContainer,a);d&&(p(fy(this._lContainer),a),_d(d[Ft],d))}detach(o){const a=this._adjustIndex(o,-1),d=Pf(this._lContainer,a);return d&&null!=p(fy(this._lContainer),a)?new Xl(d):null}_adjustIndex(o,a=0){return o??this.length+a}};function Vv(r){return r[Hs]}function fy(r){return r[Hs]||(r[Hs]=[])}function $v(r,o){let a;const d=o[r.index];if($r(d))a=d;else{let v;if(8&r.type)v=mr(d);else{const D=o[Yn];v=D.createComment("");const k=Ir(r,o);Tc(D,zs(D,k),v,function rl(r,o){return r.nextSibling(o)}(D,k),!1)}o[r.index]=a=yp(d,o,v,r),Zh(o,a)}return new jv(a,r,o)}class py{constructor(o){this.queryList=o,this.matches=null}clone(){return new py(this.queryList)}setDirty(){this.queryList.setDirty()}}class my{constructor(o=[]){this.queries=o}createEmbeddedView(o){const a=o.queries;if(null!==a){const d=null!==o.contentQueries?o.contentQueries[0]:a.length,v=[];for(let D=0;D<d;D++){const k=a.getByIndex(D);v.push(this.queries[k.indexInDeclarationView].clone())}return new my(v)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let a=0;a<this.queries.length;a++)null!==Jv(o,a).matches&&this.queries[a].setDirty()}}class Hv{constructor(o,a,d=null){this.predicate=o,this.flags=a,this.read=d}}class gy{constructor(o=[]){this.queries=o}elementStart(o,a){for(let d=0;d<this.queries.length;d++)this.queries[d].elementStart(o,a)}elementEnd(o){for(let a=0;a<this.queries.length;a++)this.queries[a].elementEnd(o)}embeddedTView(o){let a=null;for(let d=0;d<this.length;d++){const v=null!==a?a.length:0,D=this.getByIndex(d).embeddedTView(o,v);D&&(D.indexInDeclarationView=d,null!==a?a.push(D):a=[D])}return null!==a?new gy(a):null}template(o,a){for(let d=0;d<this.queries.length;d++)this.queries[d].template(o,a)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class _y{constructor(o,a=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=a}elementStart(o,a){this.isApplyingToNode(a)&&this.matchTNode(o,a)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,a){this.elementStart(o,a)}embeddedTView(o,a){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,a),new _y(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const a=this._declarationNodeIndex;let d=o.parent;for(;null!==d&&8&d.type&&d.index!==a;)d=d.parent;return a===(null!==d?d.index:-1)}return this._appliesToNextNode}matchTNode(o,a){const d=this.metadata.predicate;if(Array.isArray(d))for(let v=0;v<d.length;v++){const D=d[v];this.matchTNodeWithReadOption(o,a,yw(a,D)),this.matchTNodeWithReadOption(o,a,vc(a,o,D,!1,!1))}else d===Qp?4&a.type&&this.matchTNodeWithReadOption(o,a,-1):this.matchTNodeWithReadOption(o,a,vc(a,o,d,!1,!1))}matchTNodeWithReadOption(o,a,d){if(null!==d){const v=this.metadata.read;if(null!==v)if(v===Wl||v===Ng||v===Qp&&4&a.type)this.addMatch(a.index,-2);else{const D=vc(a,o,v,!1,!1);null!==D&&this.addMatch(a.index,D)}else this.addMatch(a.index,d)}}addMatch(o,a){null===this.matches?this.matches=[o,a]:this.matches.push(o,a)}}function yw(r,o){const a=r.localNames;if(null!==a)for(let d=0;d<a.length;d+=2)if(a[d]===o)return a[d+1];return null}function xw(r,o,a,d){return-1===a?function vw(r,o){return 11&r.type?Vu(r,o):4&r.type?zg(r,o):null}(o,r):-2===a?function ww(r,o,a){return a===Wl?Vu(o,r):a===Qp?zg(o,r):a===Ng?$v(o,r):void 0}(r,o,d):qa(r,r[Ft],a,o)}function Gv(r,o,a,d){const v=o[_o].queries[d];if(null===v.matches){const D=r.data,k=a.matches,B=[];for(let $=0;$<k.length;$+=2){const Q=k[$];B.push(Q<0?null:xw(o,D[Q],k[$+1],a.metadata.read))}v.matches=B}return v.matches}function yy(r,o,a,d){const v=r.queries.getByIndex(a),D=v.matches;if(null!==D){const k=Gv(r,o,v,a);for(let B=0;B<D.length;B+=2){const $=D[B];if($>0)d.push(k[B/2]);else{const Q=D[B+1],he=o[-$];for(let be=Ei;be<he.length;be++){const Ge=he[be];Ge[ko]===Ge[Mi]&&yy(Ge[Ft],Ge,Q,d)}if(null!==he[no]){const be=he[no];for(let Ge=0;Ge<be.length;Ge++){const ot=be[Ge];yy(ot[Ft],ot,Q,d)}}}}}return d}function qv(r){const o=Nt(),a=Pi(),d=st();mt(d+1);const v=Jv(a,d);if(r.dirty&&function Aa(r){return 4==(4&r[hn])}(o)===(2==(2&v.metadata.flags))){if(null===v.matches)r.reset([]);else{const D=v.crossesNgTemplate?yy(a,o,d,[]):Gv(a,o,v,d);r.reset(D,p_),r.notifyOnChanges()}return!0}return!1}function Wv(r,o,a){const d=Pi();d.firstCreatePass&&(Yv(d,new Hv(r,o,a),-1),2==(2&o)&&(d.staticViewQueries=!0)),Kv(d,Nt(),o)}function Zv(r,o,a,d){const v=Pi();if(v.firstCreatePass){const D=hr();Yv(v,new Hv(o,a,d),D.index),function Ew(r,o){const a=r.contentQueries||(r.contentQueries=[]);o!==(a.length?a[a.length-1]:-1)&&a.push(r.queries.length-1,o)}(v,r),2==(2&a)&&(v.staticContentQueries=!0)}Kv(v,Nt(),a)}function Xv(){return function bw(r,o){return r[_o].queries[o].queryList}(Nt(),st())}function Kv(r,o,a){const d=new dy(4==(4&a));Jm(r,o,d,d.destroy),null===o[_o]&&(o[_o]=new my),o[_o].queries.push(new py(d))}function Yv(r,o,a){null===r.queries&&(r.queries=new gy),r.queries.track(new _y(o,a))}function Jv(r,o){return r.queries.getByIndex(o)}function Qv(r,o){return zg(r,o)}function vy(r){return!!ir(r)}function jg(...r){}const y0=new ar("Application Initializer");let Vg=(()=>{class r{constructor(a){this.appInits=a,this.resolve=jg,this.reject=jg,this.initialized=!1,this.done=!1,this.donePromise=new Promise((d,v)=>{this.resolve=d,this.reject=v})}runInitializers(){if(this.initialized)return;const a=[],d=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let v=0;v<this.appInits.length;v++){const D=this.appInits[v]();if(oh(D))a.push(D);else if(Rp(D)){const k=new Promise((B,$)=>{D.subscribe({complete:B,error:$})});a.push(k)}}Promise.all(a).then(()=>{d()}).catch(v=>{this.reject(v)}),0===a.length&&d(),this.initialized=!0}}return r.\u0275fac=function(a){return new(a||r)(Ye(y0,8))},r.\u0275prov=li({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const v0=new ar("AppId",{providedIn:"root",factory:function x0(){return`${Ty()}${Ty()}${Ty()}`}});function Ty(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const w0=new ar("Platform Initializer"),$w=new ar("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Hw=new ar("AnimationModuleType");let Gw=(()=>{class r{log(a){console.log(a)}warn(a){console.warn(a)}}return r.\u0275fac=function(a){return new(a||r)},r.\u0275prov=li({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})();const $g=new ar("LocaleId",{providedIn:"root",factory:()=>Dn($g,jt.Optional|jt.SkipSelf)||function qw(){return typeof $localize<"u"&&$localize.locale||js}()}),Ww=new ar("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});class Zw{constructor(o,a){this.ngModuleFactory=o,this.componentFactories=a}}let Xw=(()=>{class r{compileModuleSync(a){return new ly(a)}compileModuleAsync(a){return Promise.resolve(this.compileModuleSync(a))}compileModuleAndAllComponentsSync(a){const d=this.compileModuleSync(a),D=El(ir(a).declarations).reduce((k,B)=>{const $=ti(B);return $&&k.push(new Jh($)),k},[]);return new Zw(d,D)}compileModuleAndAllComponentsAsync(a){return Promise.resolve(this.compileModuleAndAllComponentsSync(a))}clearCache(){}clearCacheFor(a){}getModuleId(a){}}return r.\u0275fac=function(a){return new(a||r)},r.\u0275prov=li({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();const Jw=(()=>Promise.resolve(0))();function Cy(r){typeof Zone>"u"?Jw.then(()=>{r&&r.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",r)}class Jl{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:a=!1,shouldCoalesceRunChangeDetection:d=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Gc(!1),this.onMicrotaskEmpty=new Gc(!1),this.onStable=new Gc(!1),this.onError=new Gc(!1),typeof Zone>"u")throw new tt(908,!1);Zone.assertZonePatched();const v=this;v._nesting=0,v._outer=v._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(v._inner=v._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(v._inner=v._inner.fork(Zone.longStackTraceZoneSpec)),v.shouldCoalesceEventChangeDetection=!d&&a,v.shouldCoalesceRunChangeDetection=d,v.lastRequestAnimationFrameId=-1,v.nativeRequestAnimationFrame=function Qw(){let r=vi.requestAnimationFrame,o=vi.cancelAnimationFrame;if(typeof Zone<"u"&&r&&o){const a=r[Zone.__symbol__("OriginalDelegate")];a&&(r=a);const d=o[Zone.__symbol__("OriginalDelegate")];d&&(o=d)}return{nativeRequestAnimationFrame:r,nativeCancelAnimationFrame:o}}().nativeRequestAnimationFrame,function nb(r){const o=()=>{!function tb(r){r.isCheckStableRunning||-1!==r.lastRequestAnimationFrameId||(r.lastRequestAnimationFrameId=r.nativeRequestAnimationFrame.call(vi,()=>{r.fakeTopEventTask||(r.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{r.lastRequestAnimationFrameId=-1,Sy(r),r.isCheckStableRunning=!0,Dy(r),r.isCheckStableRunning=!1},void 0,()=>{},()=>{})),r.fakeTopEventTask.invoke()}),Sy(r))}(r)};r._inner=r._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(a,d,v,D,k,B)=>{try{return T0(r),a.invokeTask(v,D,k,B)}finally{(r.shouldCoalesceEventChangeDetection&&"eventTask"===D.type||r.shouldCoalesceRunChangeDetection)&&o(),C0(r)}},onInvoke:(a,d,v,D,k,B,$)=>{try{return T0(r),a.invoke(v,D,k,B,$)}finally{r.shouldCoalesceRunChangeDetection&&o(),C0(r)}},onHasTask:(a,d,v,D)=>{a.hasTask(v,D),d===v&&("microTask"==D.change?(r._hasPendingMicrotasks=D.microTask,Sy(r),Dy(r)):"macroTask"==D.change&&(r.hasPendingMacrotasks=D.macroTask))},onHandleError:(a,d,v,D)=>(a.handleError(v,D),r.runOutsideAngular(()=>r.onError.emit(D)),!1)})}(v)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Jl.isInAngularZone())throw new tt(909,!1)}static assertNotInAngularZone(){if(Jl.isInAngularZone())throw new tt(909,!1)}run(o,a,d){return this._inner.run(o,a,d)}runTask(o,a,d,v){const D=this._inner,k=D.scheduleEventTask("NgZoneEvent: "+v,o,eb,jg,jg);try{return D.runTask(k,a,d)}finally{D.cancelTask(k)}}runGuarded(o,a,d){return this._inner.runGuarded(o,a,d)}runOutsideAngular(o){return this._outer.run(o)}}const eb={};function Dy(r){if(0==r._nesting&&!r.hasPendingMicrotasks&&!r.isStable)try{r._nesting++,r.onMicrotaskEmpty.emit(null)}finally{if(r._nesting--,!r.hasPendingMicrotasks)try{r.runOutsideAngular(()=>r.onStable.emit(null))}finally{r.isStable=!0}}}function Sy(r){r.hasPendingMicrotasks=!!(r._hasPendingMicrotasks||(r.shouldCoalesceEventChangeDetection||r.shouldCoalesceRunChangeDetection)&&-1!==r.lastRequestAnimationFrameId)}function T0(r){r._nesting++,r.isStable&&(r.isStable=!1,r.onUnstable.emit(null))}function C0(r){r._nesting--,Dy(r)}class ib{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Gc,this.onMicrotaskEmpty=new Gc,this.onStable=new Gc,this.onError=new Gc}run(o,a,d){return o.apply(a,d)}runGuarded(o,a,d){return o.apply(a,d)}runOutsideAngular(o){return o()}runTask(o,a,d,v){return o.apply(a,d)}}const D0=new ar(""),S0=new ar("");let Ay,rb=(()=>{class r{constructor(a,d,v){this._ngZone=a,this.registry=d,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,Ay||(function ob(r){Ay=r}(v),v.addToWindow(d)),this._watchAngularEvents(),a.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Jl.assertNotInAngularZone(),Cy(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Cy(()=>{for(;0!==this._callbacks.length;){let a=this._callbacks.pop();clearTimeout(a.timeoutId),a.doneCb(this._didWork)}this._didWork=!1});else{let a=this.getPendingTasks();this._callbacks=this._callbacks.filter(d=>!d.updateCb||!d.updateCb(a)||(clearTimeout(d.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(a=>({source:a.source,creationLocation:a.creationLocation,data:a.data})):[]}addCallback(a,d,v){let D=-1;d&&d>0&&(D=setTimeout(()=>{this._callbacks=this._callbacks.filter(k=>k.timeoutId!==D),a(this._didWork,this.getPendingTasks())},d)),this._callbacks.push({doneCb:a,timeoutId:D,updateCb:v})}whenStable(a,d,v){if(v&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(a,d,v),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(a){this.registry.registerApplication(a,this)}unregisterApplication(a){this.registry.unregisterApplication(a)}findProviders(a,d,v){return[]}}return r.\u0275fac=function(a){return new(a||r)(Ye(Jl),Ye(A0),Ye(S0))},r.\u0275prov=li({token:r,factory:r.\u0275fac}),r})(),A0=(()=>{class r{constructor(){this._applications=new Map}registerApplication(a,d){this._applications.set(a,d)}unregisterApplication(a){this._applications.delete(a)}unregisterAllApplications(){this._applications.clear()}getTestability(a){return this._applications.get(a)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(a,d=!0){return Ay?.findTestabilityInTree(this,a,d)??null}}return r.\u0275fac=function(a){return new(a||r)},r.\u0275prov=li({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})();const bu=!1;let dh=null;const M0=new ar("AllowMultipleToken"),My=new ar("PlatformDestroyListeners"),I0=new ar("appBootstrapListener");class lb{constructor(o,a){this.name=o,this.token=a}}function k0(r,o,a=[]){const d=`Platform: ${o}`,v=new ar(d);return(D=[])=>{let k=Iy();if(!k||k.injector.get(M0,!1)){const B=[...a,...D,{provide:v,useValue:!0}];r?r(B):function cb(r){if(dh&&!dh.get(M0,!1))throw new tt(400,!1);dh=r;const o=r.get(L0);(function P0(r){const o=r.get(w0,null);o&&o.forEach(a=>a())})(r)}(function R0(r=[],o){return hu.create({name:o,providers:[{provide:Pd,useValue:"platform"},{provide:My,useValue:new Set([()=>dh=null])},...r]})}(B,d))}return function hb(r){const o=Iy();if(!o)throw new tt(401,!1);return o}()}}function Iy(){return dh?.get(L0)??null}let L0=(()=>{class r{constructor(a){this._injector=a,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(a,d){const v=function F0(r,o){let a;return a="noop"===r?new ib:("zone.js"===r?void 0:r)||new Jl(o),a}(d?.ngZone,function O0(r){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!r||!r.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!r||!r.ngZoneRunCoalescing)||!1}}(d)),D=[{provide:Jl,useValue:v}];return v.run(()=>{const k=hu.create({providers:D,parent:this.injector,name:a.moduleType.name}),B=a.create(k),$=B.injector.get(uu,null);if(!$)throw new tt(402,!1);return v.runOutsideAngular(()=>{const Q=v.onError.subscribe({next:he=>{$.handleError(he)}});B.onDestroy(()=>{Gg(this._modules,B),Q.unsubscribe()})}),function B0(r,o,a){try{const d=a();return oh(d)?d.catch(v=>{throw o.runOutsideAngular(()=>r.handleError(v)),v}):d}catch(d){throw o.runOutsideAngular(()=>r.handleError(d)),d}}($,v,()=>{const Q=B.injector.get(Vg);return Q.runInitializers(),Q.donePromise.then(()=>(function Zy(r){ui(r,"Expected localeId to be defined"),"string"==typeof r&&(Wy=r.toLowerCase().replace(/_/g,"-"))}(B.injector.get($g,js)||js),this._moduleDoBootstrap(B),B))})})}bootstrapModule(a,d=[]){const v=z0({},d);return function sb(r,o,a){const d=new ly(a);return Promise.resolve(d)}(0,0,a).then(D=>this.bootstrapModuleFactory(D,v))}_moduleDoBootstrap(a){const d=a.injector.get(Hg);if(a._bootstrapComponents.length>0)a._bootstrapComponents.forEach(v=>d.bootstrap(v));else{if(!a.instance.ngDoBootstrap)throw new tt(-403,!1);a.instance.ngDoBootstrap(d)}this._modules.push(a)}onDestroy(a){this._destroyListeners.push(a)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new tt(404,!1);this._modules.slice().forEach(d=>d.destroy()),this._destroyListeners.forEach(d=>d());const a=this._injector.get(My,null);a&&(a.forEach(d=>d()),a.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return r.\u0275fac=function(a){return new(a||r)(Ye(hu))},r.\u0275prov=li({token:r,factory:r.\u0275fac,providedIn:"platform"}),r})();function z0(r,o){return Array.isArray(o)?o.reduce(z0,r):{...r,...o}}let Hg=(()=>{class r{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(a,d,v){this._zone=a,this._injector=d,this._exceptionHandler=v,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const D=new Xe.y(B=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{B.next(this._stable),B.complete()})}),k=new Xe.y(B=>{let $;this._zone.runOutsideAngular(()=>{$=this._zone.onStable.subscribe(()=>{Jl.assertNotInAngularZone(),Cy(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,B.next(!0))})})});const Q=this._zone.onUnstable.subscribe(()=>{Jl.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{B.next(!1)}))});return()=>{$.unsubscribe(),Q.unsubscribe()}});this.isStable=function Et(...r){const o=(0,xt.yG)(r),a=(0,xt._6)(r,1/0),d=r;return d.length?1===d.length?(0,Re.Xf)(d[0]):(0,c.J)(a)((0,Tt.D)(d,o)):nn.E}(D,k.pipe(function Qt(r={}){const{connector:o=(()=>new Y.x),resetOnError:a=!0,resetOnComplete:d=!0,resetOnRefCountZero:v=!0}=r;return D=>{let k,B,$,Q=0,he=!1,be=!1;const Ge=()=>{B?.unsubscribe(),B=void 0},ot=()=>{Ge(),k=$=void 0,he=be=!1},Lt=()=>{const dn=k;ot(),dn?.unsubscribe()};return(0,_t.e)((dn,kn)=>{Q++,!be&&!he&&Ge();const $n=$=$??o();kn.add(()=>{Q--,0===Q&&!be&&!he&&(B=An(Lt,v))}),$n.subscribe(kn),!k&&Q>0&&(k=new At.Hp({next:pi=>$n.next(pi),error:pi=>{be=!0,Ge(),B=An(ot,a,pi),$n.error(pi)},complete:()=>{he=!0,Ge(),B=An(ot,d),$n.complete()}}),(0,Re.Xf)(dn).subscribe(k))})(D)}}()))}bootstrap(a,d){const v=a instanceof Am;if(!this._injector.get(Vg).done){!v&&ls(a);throw new tt(405,bu)}let k;k=v?a:this._injector.get(Oh).resolveComponentFactory(a),this.componentTypes.push(k.componentType);const B=function ab(r){return r.isBoundToModule}(k)?void 0:this._injector.get(wf),Q=k.create(hu.NULL,[],d||k.selector,B),he=Q.location.nativeElement,be=Q.injector.get(D0,null);return be?.registerApplication(he),Q.onDestroy(()=>{this.detachView(Q.hostView),Gg(this.components,Q),be?.unregisterApplication(he)}),this._loadComponent(Q),Q}tick(){if(this._runningTick)throw new tt(101,!1);try{this._runningTick=!0;for(let a of this._views)a.detectChanges()}catch(a){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(a))}finally{this._runningTick=!1}}attachView(a){const d=a;this._views.push(d),d.attachToAppRef(this)}detachView(a){const d=a;Gg(this._views,d),d.detachFromAppRef()}_loadComponent(a){this.attachView(a.hostView),this.tick(),this.components.push(a);const d=this._injector.get(I0,[]);d.push(...this._bootstrapListeners),d.forEach(v=>v(a))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(a=>a()),this._views.slice().forEach(a=>a.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(a){return this._destroyListeners.push(a),()=>Gg(this._destroyListeners,a)}destroy(){if(this._destroyed)throw new tt(406,!1);const a=this._injector;a.destroy&&!a.destroyed&&a.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return r.\u0275fac=function(a){return new(a||r)(Ye(Jl),Ye(Cs),Ye(uu))},r.\u0275prov=li({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();function Gg(r,o){const a=r.indexOf(o);a>-1&&r.splice(a,1)}let fb=(()=>{class r{}return r.__NG_ELEMENT_ID__=pb,r})();function pb(r){return function mb(r,o,a){if(Xr(r)&&!a){const d=xr(r.index,o);return new Xl(d,d)}return 47&r.type?new Xl(o[Xi],o):null}(hr(),Nt(),16==(16&r))}class $0{constructor(){}supports(o){return Fc(o)}create(o){return new wb(o)}}const xb=(r,o)=>o;class wb{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||xb}forEachItem(o){let a;for(a=this._itHead;null!==a;a=a._next)o(a)}forEachOperation(o){let a=this._itHead,d=this._removalsHead,v=0,D=null;for(;a||d;){const k=!d||a&&a.currentIndex<G0(d,v,D)?a:d,B=G0(k,v,D),$=k.currentIndex;if(k===d)v--,d=d._nextRemoved;else if(a=a._next,null==k.previousIndex)v++;else{D||(D=[]);const Q=B-v,he=$-v;if(Q!=he){for(let Ge=0;Ge<Q;Ge++){const ot=Ge<D.length?D[Ge]:D[Ge]=0,Lt=ot+Ge;he<=Lt&&Lt<Q&&(D[Ge]=ot+1)}D[k.previousIndex]=he-Q}}B!==$&&o(k,B,$)}}forEachPreviousItem(o){let a;for(a=this._previousItHead;null!==a;a=a._nextPrevious)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachMovedItem(o){let a;for(a=this._movesHead;null!==a;a=a._nextMoved)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}forEachIdentityChange(o){let a;for(a=this._identityChangesHead;null!==a;a=a._nextIdentityChange)o(a)}diff(o){if(null==o&&(o=[]),!Fc(o))throw new tt(900,!1);return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let v,D,k,a=this._itHead,d=!1;if(Array.isArray(o)){this.length=o.length;for(let B=0;B<this.length;B++)D=o[B],k=this._trackByFn(B,D),null!==a&&Object.is(a.trackById,k)?(d&&(a=this._verifyReinsertion(a,D,k,B)),Object.is(a.item,D)||this._addIdentityChange(a,D)):(a=this._mismatch(a,D,k,B),d=!0),a=a._next}else v=0,function rf(r,o){if(Array.isArray(r))for(let a=0;a<r.length;a++)o(r[a]);else{const a=r[Symbol.iterator]();let d;for(;!(d=a.next()).done;)o(d.value)}}(o,B=>{k=this._trackByFn(v,B),null!==a&&Object.is(a.trackById,k)?(d&&(a=this._verifyReinsertion(a,B,k,v)),Object.is(a.item,B)||this._addIdentityChange(a,B)):(a=this._mismatch(a,B,k,v),d=!0),a=a._next,v++}),this.length=v;return this._truncate(a),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,a,d,v){let D;return null===o?D=this._itTail:(D=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(d,null))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._reinsertAfter(o,D,v)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(d,v))?(Object.is(o.item,a)||this._addIdentityChange(o,a),this._moveAfter(o,D,v)):o=this._addAfter(new bb(a,d),D,v),o}_verifyReinsertion(o,a,d,v){let D=null===this._unlinkedRecords?null:this._unlinkedRecords.get(d,null);return null!==D?o=this._reinsertAfter(D,o._prev,v):o.currentIndex!=v&&(o.currentIndex=v,this._addToMoves(o,v)),o}_truncate(o){for(;null!==o;){const a=o._next;this._addToRemovals(this._unlink(o)),o=a}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,a,d){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const v=o._prevRemoved,D=o._nextRemoved;return null===v?this._removalsHead=D:v._nextRemoved=D,null===D?this._removalsTail=v:D._prevRemoved=v,this._insertAfter(o,a,d),this._addToMoves(o,d),o}_moveAfter(o,a,d){return this._unlink(o),this._insertAfter(o,a,d),this._addToMoves(o,d),o}_addAfter(o,a,d){return this._insertAfter(o,a,d),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,a,d){const v=null===a?this._itHead:a._next;return o._next=v,o._prev=a,null===v?this._itTail=o:v._prev=o,null===a?this._itHead=o:a._next=o,null===this._linkedRecords&&(this._linkedRecords=new H0),this._linkedRecords.put(o),o.currentIndex=d,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const a=o._prev,d=o._next;return null===a?this._itHead=d:a._next=d,null===d?this._itTail=a:d._prev=a,o}_addToMoves(o,a){return o.previousIndex===a||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new H0),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,a){return o.item=a,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class bb{constructor(o,a){this.item=o,this.trackById=a,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Eb{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,a){let d;for(d=this._head;null!==d;d=d._nextDup)if((null===a||a<=d.currentIndex)&&Object.is(d.trackById,o))return d;return null}remove(o){const a=o._prevDup,d=o._nextDup;return null===a?this._head=d:a._nextDup=d,null===d?this._tail=a:d._prevDup=a,null===this._head}}class H0{constructor(){this.map=new Map}put(o){const a=o.trackById;let d=this.map.get(a);d||(d=new Eb,this.map.set(a,d)),d.add(o)}get(o,a){const v=this.map.get(o);return v?v.get(o,a):null}remove(o){const a=o.trackById;return this.map.get(a).remove(o)&&this.map.delete(a),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function G0(r,o,a){const d=r.previousIndex;if(null===d)return d;let v=0;return a&&d<a.length&&(v=a[d]),d+o+v}class q0{constructor(){}supports(o){return o instanceof Map||Ap(o)}create(){return new Tb}}class Tb{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let a;for(a=this._mapHead;null!==a;a=a._next)o(a)}forEachPreviousItem(o){let a;for(a=this._previousMapHead;null!==a;a=a._nextPrevious)o(a)}forEachChangedItem(o){let a;for(a=this._changesHead;null!==a;a=a._nextChanged)o(a)}forEachAddedItem(o){let a;for(a=this._additionsHead;null!==a;a=a._nextAdded)o(a)}forEachRemovedItem(o){let a;for(a=this._removalsHead;null!==a;a=a._nextRemoved)o(a)}diff(o){if(o){if(!(o instanceof Map||Ap(o)))throw new tt(900,!1)}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let a=this._mapHead;if(this._appendAfter=null,this._forEach(o,(d,v)=>{if(a&&a.key===v)this._maybeAddToChanges(a,d),this._appendAfter=a,a=a._next;else{const D=this._getOrCreateRecordForKey(v,d);a=this._insertBeforeOrAppend(a,D)}}),a){a._prev&&(a._prev._next=null),this._removalsHead=a;for(let d=a;null!==d;d=d._nextRemoved)d===this._mapHead&&(this._mapHead=null),this._records.delete(d.key),d._nextRemoved=d._next,d.previousValue=d.currentValue,d.currentValue=null,d._prev=null,d._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,a){if(o){const d=o._prev;return a._next=o,a._prev=d,o._prev=a,d&&(d._next=a),o===this._mapHead&&(this._mapHead=a),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=a,a._prev=this._appendAfter):this._mapHead=a,this._appendAfter=a,null}_getOrCreateRecordForKey(o,a){if(this._records.has(o)){const v=this._records.get(o);this._maybeAddToChanges(v,a);const D=v._prev,k=v._next;return D&&(D._next=k),k&&(k._prev=D),v._next=null,v._prev=null,v}const d=new Cb(o);return this._records.set(o,d),d.currentValue=a,this._addToAdditions(d),d}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,a){Object.is(a,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=a,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,a){o instanceof Map?o.forEach(a):Object.keys(o).forEach(d=>a(o[d],d))}}class Cb{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function W0(){return new Oy([new $0])}let Oy=(()=>{class r{constructor(a){this.factories=a}static create(a,d){if(null!=d){const v=d.factories.slice();a=a.concat(v)}return new r(a)}static extend(a){return{provide:r,useFactory:d=>r.create(a,d||W0()),deps:[[r,new He,new Pe]]}}find(a){const d=this.factories.find(v=>v.supports(a));if(null!=d)return d;throw new tt(901,!1)}}return r.\u0275prov=li({token:r,providedIn:"root",factory:W0}),r})();function Z0(){return new Fy([new q0])}let Fy=(()=>{class r{constructor(a){this.factories=a}static create(a,d){if(d){const v=d.factories.slice();a=a.concat(v)}return new r(a)}static extend(a){return{provide:r,useFactory:d=>r.create(a,d||Z0()),deps:[[r,new He,new Pe]]}}find(a){const d=this.factories.find(v=>v.supports(a));if(d)return d;throw new tt(901,!1)}}return r.\u0275prov=li({token:r,providedIn:"root",factory:Z0}),r})();const Ab=k0(null,"core",[]);let Mb=(()=>{class r{constructor(a){}}return r.\u0275fac=function(a){return new(a||r)(Ye(Hg))},r.\u0275mod=Go({type:r}),r.\u0275inj=si({}),r})();function Ib(r){return"boolean"==typeof r?r:null!=r&&"false"!==r}},1481:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{Dx:()=>Zi,b2:()=>ni,q6:()=>si,se:()=>Mt});var Y=Te(6895),W=Te(8256);class Xe extends Y.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class c extends Xe{static makeCurrent(){(0,Y.HT)(new c)}onAndCancel(Ne,ge,$e){return Ne.addEventListener(ge,$e,!1),()=>{Ne.removeEventListener(ge,$e,!1)}}dispatchEvent(Ne,ge){Ne.dispatchEvent(ge)}remove(Ne){Ne.parentNode&&Ne.parentNode.removeChild(Ne)}createElement(Ne,ge){return(ge=ge||this.getDefaultDocument()).createElement(Ne)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(Ne){return Ne.nodeType===Node.ELEMENT_NODE}isShadowRoot(Ne){return Ne instanceof DocumentFragment}getGlobalEventTarget(Ne,ge){return"window"===ge?window:"document"===ge?Ne:"body"===ge?Ne.body:null}getBaseHref(Ne){const ge=function nn(){return Re=Re||document.querySelector("base"),Re?Re.getAttribute("href"):null}();return null==ge?null:function Tt(Ve){xt=xt||document.createElement("a"),xt.setAttribute("href",Ve);const Ne=xt.pathname;return"/"===Ne.charAt(0)?Ne:`/${Ne}`}(ge)}resetBaseElement(){Re=null}getUserAgent(){return window.navigator.userAgent}getCookie(Ne){return(0,Y.Mx)(document.cookie,Ne)}}let xt,Re=null;const Et=new W.OlP("TRANSITION_ID"),_t=[{provide:W.ip1,useFactory:function At(Ve,Ne,ge){return()=>{ge.get(W.CZH).donePromise.then(()=>{const $e=(0,Y.q)(),dt=Ne.querySelectorAll(`style[ng-transition="${Ve}"]`);for(let on=0;on<dt.length;on++)$e.remove(dt[on])})}},deps:[Et,Y.K0,W.zs3],multi:!0}];let An=(()=>{class Ve{build(){return new XMLHttpRequest}}return Ve.\u0275fac=function(ge){return new(ge||Ve)},Ve.\u0275prov=W.Yz7({token:Ve,factory:Ve.\u0275fac}),Ve})();const It=new W.OlP("EventManagerPlugins");let bn=(()=>{class Ve{constructor(ge,$e){this._zone=$e,this._eventNameToPlugin=new Map,ge.forEach(dt=>{dt.manager=this}),this._plugins=ge.slice().reverse()}addEventListener(ge,$e,dt){return this._findPluginFor($e).addEventListener(ge,$e,dt)}addGlobalEventListener(ge,$e,dt){return this._findPluginFor($e).addGlobalEventListener(ge,$e,dt)}getZone(){return this._zone}_findPluginFor(ge){const $e=this._eventNameToPlugin.get(ge);if($e)return $e;const dt=this._plugins;for(let on=0;on<dt.length;on++){const _n=dt[on];if(_n.supports(ge))return this._eventNameToPlugin.set(ge,_n),_n}throw new Error(`No event manager plugin found for event ${ge}`)}}return Ve.\u0275fac=function(ge){return new(ge||Ve)(W.LFG(It),W.LFG(W.R0b))},Ve.\u0275prov=W.Yz7({token:Ve,factory:Ve.\u0275fac}),Ve})();class Yt{constructor(Ne){this._doc=Ne}addGlobalEventListener(Ne,ge,$e){const dt=(0,Y.q)().getGlobalEventTarget(this._doc,Ne);if(!dt)throw new Error(`Unsupported event target ${dt} for event ${ge}`);return this.addEventListener(dt,ge,$e)}}let Nn=(()=>{class Ve{constructor(){this.usageCount=new Map}addStyles(ge){for(const $e of ge)1===this.changeUsageCount($e,1)&&this.onStyleAdded($e)}removeStyles(ge){for(const $e of ge)0===this.changeUsageCount($e,-1)&&this.onStyleRemoved($e)}onStyleRemoved(ge){}onStyleAdded(ge){}getAllStyles(){return this.usageCount.keys()}changeUsageCount(ge,$e){const dt=this.usageCount;let on=dt.get(ge)??0;return on+=$e,on>0?dt.set(ge,on):dt.delete(ge),on}ngOnDestroy(){for(const ge of this.getAllStyles())this.onStyleRemoved(ge);this.usageCount.clear()}}return Ve.\u0275fac=function(ge){return new(ge||Ve)},Ve.\u0275prov=W.Yz7({token:Ve,factory:Ve.\u0275fac}),Ve})(),pn=(()=>{class Ve extends Nn{constructor(ge){super(),this.doc=ge,this.styleRef=new Map,this.hostNodes=new Set,this.resetHostNodes()}onStyleAdded(ge){for(const $e of this.hostNodes)this.addStyleToHost($e,ge)}onStyleRemoved(ge){const $e=this.styleRef;$e.get(ge)?.forEach(on=>on.remove()),$e.delete(ge)}ngOnDestroy(){super.ngOnDestroy(),this.styleRef.clear(),this.resetHostNodes()}addHost(ge){this.hostNodes.add(ge);for(const $e of this.getAllStyles())this.addStyleToHost(ge,$e)}removeHost(ge){this.hostNodes.delete(ge)}addStyleToHost(ge,$e){const dt=this.doc.createElement("style");dt.textContent=$e,ge.appendChild(dt);const on=this.styleRef.get($e);on?on.push(dt):this.styleRef.set($e,[dt])}resetHostNodes(){const ge=this.hostNodes;ge.clear(),ge.add(this.doc.head)}}return Ve.\u0275fac=function(ge){return new(ge||Ve)(W.LFG(Y.K0))},Ve.\u0275prov=W.Yz7({token:Ve,factory:Ve.\u0275fac}),Ve})();const rn={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},an=/%COMP%/g,kt=new W.OlP("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function En(Ve,Ne){return Ne.flat(100).map(ge=>ge.replace(an,Ve))}function yi(Ve){return Ne=>{if("__ngUnwrap__"===Ne)return Ve;!1===Ve(Ne)&&(Ne.preventDefault(),Ne.returnValue=!1)}}let Mt=(()=>{class Ve{constructor(ge,$e,dt,on){this.eventManager=ge,this.sharedStylesHost=$e,this.appId=dt,this.removeStylesOnCompDestory=on,this.rendererByCompId=new Map,this.defaultRenderer=new Bi(ge)}createRenderer(ge,$e){if(!ge||!$e)return this.defaultRenderer;const dt=this.getOrCreateRenderer(ge,$e);return dt instanceof Ot?dt.applyToHost(ge):dt instanceof Ut&&dt.applyStyles(),dt}getOrCreateRenderer(ge,$e){const dt=this.rendererByCompId;let on=dt.get($e.id);if(!on){const _n=this.eventManager,Tn=this.sharedStylesHost,Ai=this.removeStylesOnCompDestory;switch($e.encapsulation){case W.ifc.Emulated:on=new Ot(_n,Tn,$e,this.appId,Ai);break;case W.ifc.ShadowDom:return new Dt(_n,Tn,ge,$e);default:on=new Ut(_n,Tn,$e,Ai)}on.onDestroy=()=>dt.delete($e.id),dt.set($e.id,on)}return on}ngOnDestroy(){this.rendererByCompId.clear()}begin(){}end(){}}return Ve.\u0275fac=function(ge){return new(ge||Ve)(W.LFG(bn),W.LFG(pn),W.LFG(W.AFp),W.LFG(kt))},Ve.\u0275prov=W.Yz7({token:Ve,factory:Ve.\u0275fac}),Ve})();class Bi{constructor(Ne){this.eventManager=Ne,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(Ne,ge){return ge?document.createElementNS(rn[ge]||ge,Ne):document.createElement(Ne)}createComment(Ne){return document.createComment(Ne)}createText(Ne){return document.createTextNode(Ne)}appendChild(Ne,ge){(bt(Ne)?Ne.content:Ne).appendChild(ge)}insertBefore(Ne,ge,$e){Ne&&(bt(Ne)?Ne.content:Ne).insertBefore(ge,$e)}removeChild(Ne,ge){Ne&&Ne.removeChild(ge)}selectRootElement(Ne,ge){let $e="string"==typeof Ne?document.querySelector(Ne):Ne;if(!$e)throw new Error(`The selector "${Ne}" did not match any elements`);return ge||($e.textContent=""),$e}parentNode(Ne){return Ne.parentNode}nextSibling(Ne){return Ne.nextSibling}setAttribute(Ne,ge,$e,dt){if(dt){ge=dt+":"+ge;const on=rn[dt];on?Ne.setAttributeNS(on,ge,$e):Ne.setAttribute(ge,$e)}else Ne.setAttribute(ge,$e)}removeAttribute(Ne,ge,$e){if($e){const dt=rn[$e];dt?Ne.removeAttributeNS(dt,ge):Ne.removeAttribute(`${$e}:${ge}`)}else Ne.removeAttribute(ge)}addClass(Ne,ge){Ne.classList.add(ge)}removeClass(Ne,ge){Ne.classList.remove(ge)}setStyle(Ne,ge,$e,dt){dt&(W.JOm.DashCase|W.JOm.Important)?Ne.style.setProperty(ge,$e,dt&W.JOm.Important?"important":""):Ne.style[ge]=$e}removeStyle(Ne,ge,$e){$e&W.JOm.DashCase?Ne.style.removeProperty(ge):Ne.style[ge]=""}setProperty(Ne,ge,$e){Ne[ge]=$e}setValue(Ne,ge){Ne.nodeValue=ge}listen(Ne,ge,$e){return"string"==typeof Ne?this.eventManager.addGlobalEventListener(Ne,ge,yi($e)):this.eventManager.addEventListener(Ne,ge,yi($e))}}function bt(Ve){return"TEMPLATE"===Ve.tagName&&void 0!==Ve.content}class Dt extends Bi{constructor(Ne,ge,$e,dt){super(Ne),this.sharedStylesHost=ge,this.hostEl=$e,this.shadowRoot=$e.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const on=En(dt.id,dt.styles);for(const _n of on){const Tn=document.createElement("style");Tn.textContent=_n,this.shadowRoot.appendChild(Tn)}}nodeOrShadowRoot(Ne){return Ne===this.hostEl?this.shadowRoot:Ne}appendChild(Ne,ge){return super.appendChild(this.nodeOrShadowRoot(Ne),ge)}insertBefore(Ne,ge,$e){return super.insertBefore(this.nodeOrShadowRoot(Ne),ge,$e)}removeChild(Ne,ge){return super.removeChild(this.nodeOrShadowRoot(Ne),ge)}parentNode(Ne){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(Ne)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Ut extends Bi{constructor(Ne,ge,$e,dt,on=$e.id){super(Ne),this.sharedStylesHost=ge,this.removeStylesOnCompDestory=dt,this.rendererUsageCount=0,this.styles=En(on,$e.styles)}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class Ot extends Ut{constructor(Ne,ge,$e,dt,on){const _n=dt+"-"+$e.id;super(Ne,ge,$e,on,_n),this.contentAttr=function pt(Ve){return"_ngcontent-%COMP%".replace(an,Ve)}(_n),this.hostAttr=function zt(Ve){return"_nghost-%COMP%".replace(an,Ve)}(_n)}applyToHost(Ne){this.applyStyles(),this.setAttribute(Ne,this.hostAttr,"")}createElement(Ne,ge){const $e=super.createElement(Ne,ge);return super.setAttribute($e,this.contentAttr,""),$e}}let On=(()=>{class Ve extends Yt{constructor(ge){super(ge)}supports(ge){return!0}addEventListener(ge,$e,dt){return ge.addEventListener($e,dt,!1),()=>this.removeEventListener(ge,$e,dt)}removeEventListener(ge,$e,dt){return ge.removeEventListener($e,dt)}}return Ve.\u0275fac=function(ge){return new(ge||Ve)(W.LFG(Y.K0))},Ve.\u0275prov=W.Yz7({token:Ve,factory:Ve.\u0275fac}),Ve})();const ei=["alt","control","meta","shift"],ji={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},ln={alt:Ve=>Ve.altKey,control:Ve=>Ve.ctrlKey,meta:Ve=>Ve.metaKey,shift:Ve=>Ve.shiftKey};let Rn=(()=>{class Ve extends Yt{constructor(ge){super(ge)}supports(ge){return null!=Ve.parseEventName(ge)}addEventListener(ge,$e,dt){const on=Ve.parseEventName($e),_n=Ve.eventCallback(on.fullKey,dt,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,Y.q)().onAndCancel(ge,on.domEventName,_n))}static parseEventName(ge){const $e=ge.toLowerCase().split("."),dt=$e.shift();if(0===$e.length||"keydown"!==dt&&"keyup"!==dt)return null;const on=Ve._normalizeKey($e.pop());let _n="",Tn=$e.indexOf("code");if(Tn>-1&&($e.splice(Tn,1),_n="code."),ei.forEach(po=>{const Yr=$e.indexOf(po);Yr>-1&&($e.splice(Yr,1),_n+=po+".")}),_n+=on,0!=$e.length||0===on.length)return null;const Ai={};return Ai.domEventName=dt,Ai.fullKey=_n,Ai}static matchEventFullKeyCode(ge,$e){let dt=ji[ge.key]||ge.key,on="";return $e.indexOf("code.")>-1&&(dt=ge.code,on="code."),!(null==dt||!dt)&&(dt=dt.toLowerCase()," "===dt?dt="space":"."===dt&&(dt="dot"),ei.forEach(_n=>{_n!==dt&&(0,ln[_n])(ge)&&(on+=_n+".")}),on+=dt,on===$e)}static eventCallback(ge,$e,dt){return on=>{Ve.matchEventFullKeyCode(on,ge)&&dt.runGuarded(()=>$e(on))}}static _normalizeKey(ge){return"esc"===ge?"escape":ge}}return Ve.\u0275fac=function(ge){return new(ge||Ve)(W.LFG(Y.K0))},Ve.\u0275prov=W.Yz7({token:Ve,factory:Ve.\u0275fac}),Ve})();const si=(0,W.eFA)(W._c5,"browser",[{provide:W.Lbi,useValue:Y.bD},{provide:W.g9A,useValue:function Ht(){c.makeCurrent()},multi:!0},{provide:Y.K0,useFactory:function li(){return(0,W.RDi)(document),document},deps:[]}]),Wt=new W.OlP(""),Ar=[{provide:W.rWj,useClass:class Qt{addToWindow(Ne){W.dqk.getAngularTestability=($e,dt=!0)=>{const on=Ne.findTestabilityInTree($e,dt);if(null==on)throw new Error("Could not find testability for element.");return on},W.dqk.getAllAngularTestabilities=()=>Ne.getAllTestabilities(),W.dqk.getAllAngularRootElements=()=>Ne.getAllRootElements(),W.dqk.frameworkStabilizers||(W.dqk.frameworkStabilizers=[]),W.dqk.frameworkStabilizers.push($e=>{const dt=W.dqk.getAllAngularTestabilities();let on=dt.length,_n=!1;const Tn=function(Ai){_n=_n||Ai,on--,0==on&&$e(_n)};dt.forEach(function(Ai){Ai.whenStable(Tn)})})}findTestabilityInTree(Ne,ge,$e){return null==ge?null:Ne.getTestability(ge)??($e?(0,Y.q)().isShadowRoot(ge)?this.findTestabilityInTree(Ne,ge.host,!0):this.findTestabilityInTree(Ne,ge.parentElement,!0):null)}},deps:[]},{provide:W.lri,useClass:W.dDg,deps:[W.R0b,W.eoX,W.rWj]},{provide:W.dDg,useClass:W.dDg,deps:[W.R0b,W.eoX,W.rWj]}],yr=[{provide:W.zSh,useValue:"root"},{provide:W.qLn,useFactory:function zi(){return new W.qLn},deps:[]},{provide:It,useClass:On,multi:!0,deps:[Y.K0,W.R0b,W.Lbi]},{provide:It,useClass:Rn,multi:!0,deps:[Y.K0]},{provide:Mt,useClass:Mt,deps:[bn,pn,W.AFp,kt]},{provide:W.FYo,useExisting:Mt},{provide:Nn,useExisting:pn},{provide:pn,useClass:pn,deps:[Y.K0]},{provide:bn,useClass:bn,deps:[It,W.R0b]},{provide:Y.JF,useClass:An,deps:[]},[]];let ni=(()=>{class Ve{constructor(ge){}static withServerTransition(ge){return{ngModule:Ve,providers:[{provide:W.AFp,useValue:ge.appId},{provide:Et,useExisting:W.AFp},_t]}}}return Ve.\u0275fac=function(ge){return new(ge||Ve)(W.LFG(Wt,12))},Ve.\u0275mod=W.oAB({type:Ve}),Ve.\u0275inj=W.cJS({providers:[...yr,...Ar],imports:[Y.ez,W.hGG]}),Ve})(),Zi=(()=>{class Ve{constructor(ge){this._doc=ge}getTitle(){return this._doc.title}setTitle(ge){this._doc.title=ge||""}}return Ve.\u0275fac=function(ge){return new(ge||Ve)(W.LFG(Y.K0))},Ve.\u0275prov=W.Yz7({token:Ve,factory:function(ge){let $e=null;return $e=ge?new ge:function zr(){return new Zi((0,W.LFG)(Y.K0))}(),$e},providedIn:"root"}),Ve})();typeof window<"u"&&window},346:(ii,Ke,Te)=>{"use strict";Te.d(Ke,{F0:()=>Ts,rH:()=>Ll,Bz:()=>vl,lC:()=>sr});var Y=Te(8256),W=Te(2076),Xe=Te(9646),c=Te(1135);const nn=(0,Te(3888).d)(m=>function(){m(this),this.name="EmptyError",this.message="no elements in sequence"});var xt=Te(9751),Tt=Te(4742),Et=Te(4671),At=Te(3268),_t=Te(7669),Qt=Te(1810),An=Te(5403),It=Te(9672);function bn(...m){const y=(0,_t.yG)(m),_=(0,_t.jO)(m),{args:T,keys:M}=(0,Tt.D)(m);if(0===T.length)return(0,W.D)([],y);const F=new xt.y(function Yt(m,y,_=Et.y){return T=>{Nn(y,()=>{const{length:M}=m,F=new Array(M);let U=M,K=M;for(let ee=0;ee<M;ee++)Nn(y,()=>{const le=(0,W.D)(m[ee],y);let Z=!1;le.subscribe((0,An.x)(T,ce=>{F[ee]=ce,Z||(Z=!0,K--),K||T.next(_(F.slice()))},()=>{--U||T.complete()}))},T)},T)}}(T,y,M?U=>(0,Qt.n)(M,U):Et.y));return _?F.pipe((0,At.Z)(_)):F}function Nn(m,y,_){m?(0,It.f)(_,m,y):y()}var pn=Te(8189);function an(...m){return function rn(){return(0,pn.J)(1)}()((0,W.D)(m,(0,_t.yG)(m)))}var Pt=Te(8421);function Se(m){return new xt.y(y=>{(0,Pt.Xf)(m()).subscribe(y)})}var fn=Te(9635),Zn=Te(576);function tt(m,y){const _=(0,Zn.m)(m)?m:()=>m,T=M=>M.error(_());return new xt.y(y?M=>y.schedule(T,0,M):T)}var kt=Te(515),pt=Te(727),zt=Te(4482);function En(){return(0,zt.e)((m,y)=>{let _=null;m._refCount++;const T=(0,An.x)(y,void 0,void 0,void 0,()=>{if(!m||m._refCount<=0||0<--m._refCount)return void(_=null);const M=m._connection,F=_;_=null,M&&(!F||M===F)&&M.unsubscribe(),y.unsubscribe()});m.subscribe(T),T.closed||(_=m.connect())})}class yi extends xt.y{constructor(y,_){super(),this.source=y,this.subjectFactory=_,this._subject=null,this._refCount=0,this._connection=null,(0,zt.A)(y)&&(this.lift=y.lift)}_subscribe(y){return this.getSubject().subscribe(y)}getSubject(){const y=this._subject;return(!y||y.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:y}=this;this._subject=this._connection=null,y?.unsubscribe()}connect(){let y=this._connection;if(!y){y=this._connection=new pt.w0;const _=this.getSubject();y.add(this.source.subscribe((0,An.x)(_,void 0,()=>{this._teardown(),_.complete()},T=>{this._teardown(),_.error(T)},()=>this._teardown()))),y.closed&&(this._connection=null,y=pt.w0.EMPTY)}return y}refCount(){return En()(this)}}var Mt=Te(7579),Bi=Te(6895),qe=Te(4004);function at(m,y){return(0,zt.e)((_,T)=>{let M=null,F=0,U=!1;const K=()=>U&&!M&&T.complete();_.subscribe((0,An.x)(T,ee=>{M?.unsubscribe();let le=0;const Z=F++;(0,Pt.Xf)(m(ee,Z)).subscribe(M=(0,An.x)(T,ce=>T.next(y?y(ee,ce,Z,le++):ce),()=>{M=null,K()}))},()=>{U=!0,K()}))})}function bt(m){return m<=0?()=>kt.E:(0,zt.e)((y,_)=>{let T=0;y.subscribe((0,An.x)(_,M=>{++T<=m&&(_.next(M),m<=T&&_.complete())}))})}var Ut=Te(9300),Ot=Te(5577);function On(m){return(0,zt.e)((y,_)=>{let T=!1;y.subscribe((0,An.x)(_,M=>{T=!0,_.next(M)},()=>{T||_.next(m),_.complete()}))})}function ei(m=ji){return(0,zt.e)((y,_)=>{let T=!1;y.subscribe((0,An.x)(_,M=>{T=!0,_.next(M)},()=>T?_.complete():_.error(m())))})}function ji(){return new nn}function ln(m,y){const _=arguments.length>=2;return T=>T.pipe(m?(0,Ut.h)((M,F)=>m(M,F,T)):Et.y,bt(1),_?On(y):ei(()=>new nn))}var Rn=Te(4351),un=Te(8505),Hn=Te(262);function qn(m,y){return(0,zt.e)(function ui(m,y,_,T,M){return(F,U)=>{let K=_,ee=y,le=0;F.subscribe((0,An.x)(U,Z=>{const ce=le++;ee=K?m(ee,Z,ce):(K=!0,Z),T&&U.next(ee)},M&&(()=>{K&&U.next(ee),U.complete()})))}}(m,y,arguments.length>=2,!0))}function hi(m){return m<=0?()=>kt.E:(0,zt.e)((y,_)=>{let T=[];y.subscribe((0,An.x)(_,M=>{T.push(M),m<T.length&&T.shift()},()=>{for(const M of T)_.next(M);_.complete()},void 0,()=>{T=null}))})}function Ht(m,y){const _=arguments.length>=2;return T=>T.pipe(m?(0,Ut.h)((M,F)=>m(M,F,T)):Et.y,hi(1),_?On(y):ei(()=>new nn))}function Wi(m){return(0,zt.e)((y,_)=>{try{y.subscribe(_)}finally{_.add(m)}})}var si=Te(1481);const Wt="primary",Ar=Symbol("RouteTitle");class yr{constructor(y){this.params=y||{}}has(y){return Object.prototype.hasOwnProperty.call(this.params,y)}get(y){if(this.has(y)){const _=this.params[y];return Array.isArray(_)?_[0]:_}return null}getAll(y){if(this.has(y)){const _=this.params[y];return Array.isArray(_)?_:[_]}return[]}get keys(){return Object.keys(this.params)}}function ni(m){return new yr(m)}function os(m,y,_){const T=_.path.split("/");if(T.length>m.length||"full"===_.pathMatch&&(y.hasChildren()||T.length<m.length))return null;const M={};for(let F=0;F<T.length;F++){const U=T[F],K=m[F];if(U.startsWith(":"))M[U.substring(1)]=K;else if(U!==K.path)return null}return{consumed:m.slice(0,T.length),posParams:M}}function Vi(m,y){const _=m?Object.keys(m):void 0,T=y?Object.keys(y):void 0;if(!_||!T||_.length!=T.length)return!1;let M;for(let F=0;F<_.length;F++)if(M=_[F],!zr(m[M],y[M]))return!1;return!0}function zr(m,y){if(Array.isArray(m)&&Array.isArray(y)){if(m.length!==y.length)return!1;const _=[...m].sort(),T=[...y].sort();return _.every((M,F)=>T[F]===M)}return m===y}function Zi(m){return Array.prototype.concat.apply([],m)}function jt(m){return m.length>0?m[m.length-1]:null}function Hi(m,y){for(const _ in m)m.hasOwnProperty(_)&&y(m[_],_)}function Ri(m){return(0,Y.CqO)(m)?m:(0,Y.QGY)(m)?(0,W.D)(Promise.resolve(m)):(0,Xe.of)(m)}const Yi=!1,Wr={exact:function Ee(m,y,_){if(!Ce(m.segments,y.segments)||!Me(m.segments,y.segments,_)||m.numberOfChildren!==y.numberOfChildren)return!1;for(const T in y.children)if(!m.children[T]||!Ee(m.children[T],y.children[T],_))return!1;return!0},subset:ae},vi={exact:function Ji(m,y){return Vi(m,y)},subset:function ne(m,y){return Object.keys(y).length<=Object.keys(m).length&&Object.keys(y).every(_=>zr(m[_],y[_]))},ignored:()=>!0};function cr(m,y,_){return Wr[_.paths](m.root,y.root,_.matrixParams)&&vi[_.queryParams](m.queryParams,y.queryParams)&&!("exact"===_.fragment&&m.fragment!==y.fragment)}function ae(m,y,_){return xe(m,y,y.segments,_)}function xe(m,y,_,T){if(m.segments.length>_.length){const M=m.segments.slice(0,_.length);return!(!Ce(M,_)||y.hasChildren()||!Me(M,_,T))}if(m.segments.length===_.length){if(!Ce(m.segments,_)||!Me(m.segments,_,T))return!1;for(const M in y.children)if(!m.children[M]||!ae(m.children[M],y.children[M],T))return!1;return!0}{const M=_.slice(0,m.segments.length),F=_.slice(m.segments.length);return!!(Ce(m.segments,M)&&Me(m.segments,M,T)&&m.children[Wt])&&xe(m.children[Wt],y,F,T)}}function Me(m,y,_){return y.every((T,M)=>vi[_](m[M].parameters,T.parameters))}class ze{constructor(y=new fe([],{}),_={},T=null){this.root=y,this.queryParams=_,this.fragment=T}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=ni(this.queryParams)),this._queryParamMap}toString(){return Dn.serialize(this)}}class fe{constructor(y,_){this.segments=y,this.children=_,this.parent=null,Hi(_,(T,M)=>T.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return cn(this)}}class oe{constructor(y,_){this.path=y,this.parameters=_}get parameterMap(){return this._parameterMap||(this._parameterMap=ni(this.parameters)),this._parameterMap}toString(){return on(this)}}function Ce(m,y){return m.length===y.length&&m.every((_,T)=>_.path===y[T].path)}let Ye=(()=>{class m{}return m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Y.Yz7({token:m,factory:function(){return new ut},providedIn:"root"}),m})();class ut{parse(y){const _=new vs(y);return new ze(_.parseRootSegment(),_.parseQueryParams(),_.parseFragment())}serialize(y){const _=`/${gn(y.root,!0)}`,T=function Tn(m){const y=Object.keys(m).map(_=>{const T=m[_];return Array.isArray(T)?T.map(M=>`${Ve(_)}=${Ve(M)}`).join("&"):`${Ve(_)}=${Ve(T)}`}).filter(_=>!!_);return y.length?`?${y.join("&")}`:""}(y.queryParams);return`${_}${T}${"string"==typeof y.fragment?`#${function Ne(m){return encodeURI(m)}(y.fragment)}`:""}`}}const Dn=new ut;function cn(m){return m.segments.map(y=>on(y)).join("/")}function gn(m,y){if(!m.hasChildren())return cn(m);if(y){const _=m.children[Wt]?gn(m.children[Wt],!1):"",T=[];return Hi(m.children,(M,F)=>{F!==Wt&&T.push(`${F}:${gn(M,!1)}`)}),T.length>0?`${_}(${T.join("//")})`:_}{const _=function je(m,y){let _=[];return Hi(m.children,(T,M)=>{M===Wt&&(_=_.concat(y(T,M)))}),Hi(m.children,(T,M)=>{M!==Wt&&(_=_.concat(y(T,M)))}),_}(m,(T,M)=>M===Wt?[gn(m.children[Wt],!1)]:[`${M}:${gn(T,!1)}`]);return 1===Object.keys(m.children).length&&null!=m.children[Wt]?`${cn(m)}/${_[0]}`:`${cn(m)}/(${_.join("//")})`}}function Fn(m){return encodeURIComponent(m).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ve(m){return Fn(m).replace(/%3B/gi,";")}function ge(m){return Fn(m).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function $e(m){return decodeURIComponent(m)}function dt(m){return $e(m.replace(/\+/g,"%20"))}function on(m){return`${ge(m.path)}${function _n(m){return Object.keys(m).map(y=>`;${ge(y)}=${ge(m[y])}`).join("")}(m.parameters)}`}const Ai=/^[^\/()?;=#]+/;function po(m){const y=m.match(Ai);return y?y[0]:""}const Yr=/^[^=?&#]+/,Co=/^[^&#]+/;class vs{constructor(y){this.url=y,this.remaining=y}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new fe([],{}):new fe([],this.parseChildren())}parseQueryParams(){const y={};if(this.consumeOptional("?"))do{this.parseQueryParam(y)}while(this.consumeOptional("&"));return y}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const y=[];for(this.peekStartsWith("(")||y.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),y.push(this.parseSegment());let _={};this.peekStartsWith("/(")&&(this.capture("/"),_=this.parseParens(!0));let T={};return this.peekStartsWith("(")&&(T=this.parseParens(!1)),(y.length>0||Object.keys(_).length>0)&&(T[Wt]=new fe(y,_)),T}parseSegment(){const y=po(this.remaining);if(""===y&&this.peekStartsWith(";"))throw new Y.vHH(4009,Yi);return this.capture(y),new oe($e(y),this.parseMatrixParams())}parseMatrixParams(){const y={};for(;this.consumeOptional(";");)this.parseParam(y);return y}parseParam(y){const _=po(this.remaining);if(!_)return;this.capture(_);let T="";if(this.consumeOptional("=")){const M=po(this.remaining);M&&(T=M,this.capture(T))}y[$e(_)]=$e(T)}parseQueryParam(y){const _=function Cn(m){const y=m.match(Yr);return y?y[0]:""}(this.remaining);if(!_)return;this.capture(_);let T="";if(this.consumeOptional("=")){const U=function Do(m){const y=m.match(Co);return y?y[0]:""}(this.remaining);U&&(T=U,this.capture(T))}const M=dt(_),F=dt(T);if(y.hasOwnProperty(M)){let U=y[M];Array.isArray(U)||(U=[U],y[M]=U),U.push(F)}else y[M]=F}parseParens(y){const _={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const T=po(this.remaining),M=this.remaining[T.length];if("/"!==M&&")"!==M&&";"!==M)throw new Y.vHH(4010,Yi);let F;T.indexOf(":")>-1?(F=T.slice(0,T.indexOf(":")),this.capture(F),this.capture(":")):y&&(F=Wt);const U=this.parseChildren();_[F]=1===Object.keys(U).length?U[Wt]:new fe([],U),this.consumeOptional("//")}return _}peekStartsWith(y){return this.remaining.startsWith(y)}consumeOptional(y){return!!this.peekStartsWith(y)&&(this.remaining=this.remaining.substring(y.length),!0)}capture(y){if(!this.consumeOptional(y))throw new Y.vHH(4011,Yi)}}function ss(m){return m.segments.length>0?new fe([],{[Wt]:m}):m}function mo(m){const y={};for(const T of Object.keys(m.children)){const F=mo(m.children[T]);(F.segments.length>0||F.hasChildren())&&(y[T]=F)}return function as(m){if(1===m.numberOfChildren&&m.children[Wt]){const y=m.children[Wt];return new fe(m.segments.concat(y.segments),y.children)}return m}(new fe(m.segments,y))}function Ho(m){return m instanceof ze}const Go=!1;function ft(m,y,_,T,M){if(0===_.length)return bi(y.root,y.root,y.root,T,M);const F=function Wo(m){if("string"==typeof m[0]&&1===m.length&&"/"===m[0])return new ir(!0,0,m);let y=0,_=!1;const T=m.reduce((M,F,U)=>{if("object"==typeof F&&null!=F){if(F.outlets){const K={};return Hi(F.outlets,(ee,le)=>{K[le]="string"==typeof ee?ee.split("/"):ee}),[...M,{outlets:K}]}if(F.segmentPath)return[...M,F.segmentPath]}return"string"!=typeof F?[...M,F]:0===U?(F.split("/").forEach((K,ee)=>{0==ee&&"."===K||(0==ee&&""===K?_=!0:".."===K?y++:""!=K&&M.push(K))}),M):[...M,F]},[]);return new ir(_,y,T)}(_);return F.toRoot()?bi(y.root,y.root,new fe([],{}),T,M):function U(ee){const le=function tn(m,y,_,T){if(m.isAbsolute)return new Po(y.root,!0,0);if(-1===T)return new Po(_,_===y.root,0);return function Ft(m,y,_){let T=m,M=y,F=_;for(;F>M;){if(F-=M,T=T.parent,!T)throw new Y.vHH(4005,Go&&"Invalid number of '../'");M=T.segments.length}return new Po(T,!1,M-F)}(_,T+(ti(m.commands[0])?0:1),m.numberOfDoubleDots)}(F,y,m.snapshot?._urlSegment,ee),Z=le.processChildren?Qi(le.segmentGroup,le.index,F.commands):Mi(le.segmentGroup,le.index,F.commands);return bi(y.root,le.segmentGroup,Z,T,M)}(m.snapshot?._lastPathIndex)}function ti(m){return"object"==typeof m&&null!=m&&!m.outlets&&!m.segmentPath}function ai(m){return"object"==typeof m&&null!=m&&m.outlets}function bi(m,y,_,T,M){let U,F={};T&&Hi(T,(ee,le)=>{F[le]=Array.isArray(ee)?ee.map(Z=>`${Z}`):`${ee}`}),U=m===y?_:ls(m,y,_);const K=ss(mo(U));return new ze(K,F,M)}function ls(m,y,_){const T={};return Hi(m.children,(M,F)=>{T[F]=M===y?_:ls(M,y,_)}),new fe(m.segments,T)}class ir{constructor(y,_,T){if(this.isAbsolute=y,this.numberOfDoubleDots=_,this.commands=T,y&&T.length>0&&ti(T[0]))throw new Y.vHH(4003,Go&&"Root segment cannot have matrix parameters");const M=T.find(ai);if(M&&M!==jt(T))throw new Y.vHH(4004,Go&&"{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Po{constructor(y,_,T){this.segmentGroup=y,this.processChildren=_,this.index=T}}function Mi(m,y,_){if(m||(m=new fe([],{})),0===m.segments.length&&m.hasChildren())return Qi(m,y,_);const T=function In(m,y,_){let T=0,M=y;const F={match:!1,pathIndex:0,commandIndex:0};for(;M<m.segments.length;){if(T>=_.length)return F;const U=m.segments[M],K=_[T];if(ai(K))break;const ee=`${K}`,le=T<_.length-1?_[T+1]:null;if(M>0&&void 0===ee)break;if(ee&&le&&"object"==typeof le&&void 0===le.outlets){if(!Vr(ee,le,U))return F;T+=2}else{if(!Vr(ee,{},U))return F;T++}M++}return{match:!0,pathIndex:M,commandIndex:T}}(m,y,_),M=_.slice(T.commandIndex);if(T.match&&T.pathIndex<m.segments.length){const F=new fe(m.segments.slice(0,T.pathIndex),{});return F.children[Wt]=new fe(m.segments.slice(T.pathIndex),m.children),Qi(F,0,M)}return T.match&&0===M.length?new fe(m.segments,{}):T.match&&!m.hasChildren()?Ii(m,y,_):T.match?Qi(m,0,M):Ii(m,y,_)}function Qi(m,y,_){if(0===_.length)return new fe(m.segments,{});{const T=function hn(m){return ai(m[0])?m[0].outlets:{[Wt]:m}}(_),M={};if(!T[Wt]&&m.children[Wt]&&1===m.numberOfChildren&&0===m.children[Wt].segments.length){const F=Qi(m.children[Wt],y,_);return new fe(m.segments,F.children)}return Hi(T,(F,U)=>{"string"==typeof F&&(F=[F]),null!==F&&(M[U]=Mi(m.children[U],y,F))}),Hi(m.children,(F,U)=>{void 0===T[U]&&(M[U]=F)}),new fe(m.segments,M)}}function Ii(m,y,_){const T=m.segments.slice(0,y);let M=0;for(;M<_.length;){const F=_[M];if(ai(F)){const ee=So(F.outlets);return new fe(T,ee)}if(0===M&&ti(_[0])){T.push(new oe(m.segments[y].path,ki(_[0]))),M++;continue}const U=ai(F)?F.outlets[Wt]:`${F}`,K=M<_.length-1?_[M+1]:null;U&&K&&ti(K)?(T.push(new oe(U,ki(K))),M+=2):(T.push(new oe(U,{})),M++)}return new fe(T,{})}function So(m){const y={};return Hi(m,(_,T)=>{"string"==typeof _&&(_=[_]),null!==_&&(y[T]=Ii(new fe([],{}),0,_))}),y}function ki(m){const y={};return Hi(m,(_,T)=>y[T]=`${_}`),y}function Vr(m,y,_){return m==_.path&&Vi(y,_.parameters)}const Li="imperative";class Yn{constructor(y,_){this.id=y,this.url=_}}class co extends Yn{constructor(y,_,T="imperative",M=null){super(y,_),this.type=0,this.navigationTrigger=T,this.restoredState=M}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Zr extends Yn{constructor(y,_,T){super(y,_),this.urlAfterRedirects=T,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Xo extends Yn{constructor(y,_,T,M){super(y,_),this.reason=T,this.code=M,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class fr extends Yn{constructor(y,_,T,M){super(y,_),this.reason=T,this.code=M,this.type=16}}class Xi extends Yn{constructor(y,_,T,M){super(y,_),this.error=T,this.target=M,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class ko extends Yn{constructor(y,_,T,M){super(y,_),this.urlAfterRedirects=T,this.state=M,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Jr extends Yn{constructor(y,_,T,M){super(y,_),this.urlAfterRedirects=T,this.state=M,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _o extends Yn{constructor(y,_,T,M,F){super(y,_),this.urlAfterRedirects=T,this.state=M,this.shouldActivate=F,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Ro extends Yn{constructor(y,_,T,M){super(y,_),this.urlAfterRedirects=T,this.state=M,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Qr extends Yn{constructor(y,_,T,M){super(y,_),this.urlAfterRedirects=T,this.state=M,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ri{constructor(y){this.route=y,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class ca{constructor(y){this.route=y,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class ua{constructor(y){this.snapshot=y,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class eo{constructor(y){this.snapshot=y,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class to{constructor(y){this.snapshot=y,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Hs{constructor(y){this.snapshot=y,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class no{constructor(y,_,T){this.routerEvent=y,this.position=_,this.anchor=T,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let io=(()=>{class m{createUrlTree(_,T,M,F,U,K){return ft(_||T.root,M,F,U,K)}}return m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Y.Yz7({token:m,factory:m.\u0275fac}),m})(),Mr=(()=>{class m{}return m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Y.Yz7({token:m,factory:function(y){return io.\u0275fac(y)},providedIn:"root"}),m})();class Xr{constructor(y){this._root=y}get root(){return this._root.value}parent(y){const _=this.pathFromRoot(y);return _.length>1?_[_.length-2]:null}children(y){const _=us(y,this._root);return _?_.children.map(T=>T.value):[]}firstChild(y){const _=us(y,this._root);return _&&_.children.length>0?_.children[0].value:null}siblings(y){const _=ur(y,this._root);return _.length<2?[]:_[_.length-2].children.map(M=>M.value).filter(M=>M!==y)}pathFromRoot(y){return ur(y,this._root).map(_=>_.value)}}function us(m,y){if(m===y.value)return y;for(const _ of y.children){const T=us(m,_);if(T)return T}return null}function ur(m,y){if(m===y.value)return[y];for(const _ of y.children){const T=ur(m,_);if(T.length)return T.unshift(y),T}return[]}class Hr{constructor(y,_){this.value=y,this.children=_}toString(){return`TreeNode(${this.value})`}}function Ko(m){const y={};return m&&m.children.forEach(_=>y[_.value.outlet]=_),y}class Gs extends Xr{constructor(y,_){super(y),this.snapshot=_,pr(this,y)}toString(){return this.snapshot.toString()}}function hs(m,y){const _=function ha(m,y){const U=new Lo([],{},{},"",{},Wt,y,null,m.root,-1,{});return new ea("",new Hr(U,[]))}(m,y),T=new c.X([new oe("",{})]),M=new c.X({}),F=new c.X({}),U=new c.X({}),K=new c.X(""),ee=new ro(T,M,U,K,F,Wt,y,_.root);return ee.snapshot=_.root,new Gs(new Hr(ee,[]),_)}class ro{constructor(y,_,T,M,F,U,K,ee){this.url=y,this.params=_,this.queryParams=T,this.fragment=M,this.data=F,this.outlet=U,this.component=K,this.title=this.data?.pipe((0,qe.U)(le=>le[Ar]))??(0,Xe.of)(void 0),this._futureSnapshot=ee}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,qe.U)(y=>ni(y)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,qe.U)(y=>ni(y)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Ca(m,y="emptyOnly"){const _=m.pathFromRoot;let T=0;if("always"!==y)for(T=_.length-1;T>=1;){const M=_[T],F=_[T-1];if(M.routeConfig&&""===M.routeConfig.path)T--;else{if(F.component)break;T--}}return function Ss(m){return m.reduce((y,_)=>({params:{...y.params,..._.params},data:{...y.data,..._.data},resolve:{..._.data,...y.resolve,..._.routeConfig?.data,..._._resolvedData}}),{params:{},data:{},resolve:{}})}(_.slice(T))}class Lo{get title(){return this.data?.[Ar]}constructor(y,_,T,M,F,U,K,ee,le,Z,ce){this.url=y,this.params=_,this.queryParams=T,this.fragment=M,this.data=F,this.outlet=U,this.component=K,this.routeConfig=ee,this._urlSegment=le,this._lastPathIndex=Z,this._resolve=ce}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=ni(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=ni(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(T=>T.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class ea extends Xr{constructor(y,_){super(_),this.url=y,pr(this,_)}toString(){return da(this._root)}}function pr(m,y){y.value._routerState=m,y.children.forEach(_=>pr(m,_))}function da(m){const y=m.children.length>0?` { ${m.children.map(da).join(", ")} } `:"";return`${m.value}${y}`}function Gr(m){if(m.snapshot){const y=m.snapshot,_=m._futureSnapshot;m.snapshot=_,Vi(y.queryParams,_.queryParams)||m.queryParams.next(_.queryParams),y.fragment!==_.fragment&&m.fragment.next(_.fragment),Vi(y.params,_.params)||m.params.next(_.params),function lo(m,y){if(m.length!==y.length)return!1;for(let _=0;_<m.length;++_)if(!Vi(m[_],y[_]))return!1;return!0}(y.url,_.url)||m.url.next(_.url),Vi(y.data,_.data)||m.data.next(_.data)}else m.snapshot=m._futureSnapshot,m.data.next(m._futureSnapshot.data)}function As(m,y){const _=Vi(m.params,y.params)&&function re(m,y){return Ce(m,y)&&m.every((_,T)=>Vi(_.parameters,y[T].parameters))}(m.url,y.url);return _&&!(!m.parent!=!y.parent)&&(!m.parent||As(m.parent,y.parent))}function Yo(m,y,_){if(_&&m.shouldReuseRoute(y.value,_.value.snapshot)){const T=_.value;T._futureSnapshot=y.value;const M=function xs(m,y,_){return y.children.map(T=>{for(const M of _.children)if(m.shouldReuseRoute(T.value,M.value.snapshot))return Yo(m,T,M);return Yo(m,T)})}(m,y,_);return new Hr(T,M)}{if(m.shouldAttach(y.value)){const F=m.retrieve(y.value);if(null!==F){const U=F.route;return U.value._futureSnapshot=y.value,U.children=y.children.map(K=>Yo(m,K)),U}}const T=function fa(m){return new ro(new c.X(m.url),new c.X(m.params),new c.X(m.queryParams),new c.X(m.fragment),new c.X(m.data),m.outlet,m.component,m)}(y.value),M=y.children.map(F=>Yo(m,F));return new Hr(T,M)}}const Jo="ngNavigationCancelingError";function Oi(m,y){const{redirectTo:_,navigationBehaviorOptions:T}=Ho(y)?{redirectTo:y,navigationBehaviorOptions:void 0}:y,M=Ya(!1,0,y);return M.url=_,M.navigationBehaviorOptions=T,M}function Ya(m,y,_){const T=new Error("NavigationCancelingError: "+(m||""));return T[Jo]=!0,T.cancellationCode=y,_&&(T.url=_),T}function yo(m){return Oa(m)&&Ho(m.url)}function Oa(m){return m&&m[Jo]}class ws{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new Ms,this.attachRef=null}}let Ms=(()=>{class m{constructor(){this.contexts=new Map}onChildOutletCreated(_,T){const M=this.getOrCreateContext(_);M.outlet=T,this.contexts.set(_,M)}onChildOutletDestroyed(_){const T=this.getContext(_);T&&(T.outlet=null,T.attachRef=null)}onOutletDeactivated(){const _=this.contexts;return this.contexts=new Map,_}onOutletReAttached(_){this.contexts=_}getOrCreateContext(_){let T=this.getContext(_);return T||(T=new ws,this.contexts.set(_,T)),T}getContext(_){return this.contexts.get(_)||null}}return m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Y.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})();const ds=!1;let sr=(()=>{class m{constructor(){this.activated=null,this._activatedRoute=null,this.name=Wt,this.activateEvents=new Y.vpe,this.deactivateEvents=new Y.vpe,this.attachEvents=new Y.vpe,this.detachEvents=new Y.vpe,this.parentContexts=(0,Y.f3M)(Ms),this.location=(0,Y.f3M)(Y.s_b),this.changeDetector=(0,Y.f3M)(Y.sBO),this.environmentInjector=(0,Y.f3M)(Y.lqb)}ngOnChanges(_){if(_.name){const{firstChange:T,previousValue:M}=_.name;if(T)return;this.isTrackedInParentContexts(M)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(M)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(_){return this.parentContexts.getContext(_)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const _=this.parentContexts.getContext(this.name);_?.route&&(_.attachRef?this.attach(_.attachRef,_.route):this.activateWith(_.route,_.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Y.vHH(4012,ds);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Y.vHH(4012,ds);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Y.vHH(4012,ds);this.location.detach();const _=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(_.instance),_}attach(_,T){this.activated=_,this._activatedRoute=T,this.location.insert(_.hostView),this.attachEvents.emit(_.instance)}deactivate(){if(this.activated){const _=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(_)}}activateWith(_,T){if(this.isActivated)throw new Y.vHH(4013,ds);this._activatedRoute=_;const M=this.location,U=_.snapshot.component,K=this.parentContexts.getOrCreateContext(this.name).children,ee=new Ao(_,K,M.injector);if(T&&function vr(m){return!!m.resolveComponentFactory}(T)){const le=T.resolveComponentFactory(U);this.activated=M.createComponent(le,M.length,ee)}else this.activated=M.createComponent(U,{index:M.length,injector:ee,environmentInjector:T??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return m.\u0275fac=function(_){return new(_||m)},m.\u0275dir=Y.lG2({type:m,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[Y.TTD]}),m})();class Ao{constructor(y,_,T){this.route=y,this.childContexts=_,this.parent=T}get(y,_){return y===ro?this.route:y===Ms?this.childContexts:this.parent.get(y,_)}}let Oo=(()=>{class m{}return m.\u0275fac=function(_){return new(_||m)},m.\u0275cmp=Y.Xpm({type:m,selectors:[["ng-component"]],standalone:!0,features:[Y.jDz],decls:1,vars:0,template:function(_,T){1&_&&Y._UZ(0,"router-outlet")},dependencies:[sr],encapsulation:2}),m})();function uo(m,y){return m.providers&&!m._injector&&(m._injector=(0,Y.MMx)(m.providers,y,`Route: ${m.path}`)),m._injector??y}function mi(m){const y=m.children&&m.children.map(mi),_=y?{...m,children:y}:{...m};return!_.component&&!_.loadComponent&&(y||_.loadChildren)&&_.outlet&&_.outlet!==Wt&&(_.component=Oo),_}function Pr(m){return m.outlet||Wt}function bs(m,y){const _=m.filter(T=>Pr(T)===y);return _.push(...m.filter(T=>Pr(T)!==y)),_}function xr(m){if(!m)return null;if(m.routeConfig?._injector)return m.routeConfig._injector;for(let y=m.parent;y;y=y.parent){const _=y.routeConfig;if(_?._loadedInjector)return _._loadedInjector;if(_?._injector)return _._injector}return null}class Fo{constructor(y,_,T,M){this.routeReuseStrategy=y,this.futureState=_,this.currState=T,this.forwardEvent=M}activate(y){const _=this.futureState._root,T=this.currState?this.currState._root:null;this.deactivateChildRoutes(_,T,y),Gr(this.futureState.root),this.activateChildRoutes(_,T,y)}deactivateChildRoutes(y,_,T){const M=Ko(_);y.children.forEach(F=>{const U=F.value.outlet;this.deactivateRoutes(F,M[U],T),delete M[U]}),Hi(M,(F,U)=>{this.deactivateRouteAndItsChildren(F,T)})}deactivateRoutes(y,_,T){const M=y.value,F=_?_.value:null;if(M===F)if(M.component){const U=T.getContext(M.outlet);U&&this.deactivateChildRoutes(y,_,U.children)}else this.deactivateChildRoutes(y,_,T);else F&&this.deactivateRouteAndItsChildren(_,T)}deactivateRouteAndItsChildren(y,_){y.value.component&&this.routeReuseStrategy.shouldDetach(y.value.snapshot)?this.detachAndStoreRouteSubtree(y,_):this.deactivateRouteAndOutlet(y,_)}detachAndStoreRouteSubtree(y,_){const T=_.getContext(y.value.outlet),M=T&&y.value.component?T.children:_,F=Ko(y);for(const U of Object.keys(F))this.deactivateRouteAndItsChildren(F[U],M);if(T&&T.outlet){const U=T.outlet.detach(),K=T.children.onOutletDeactivated();this.routeReuseStrategy.store(y.value.snapshot,{componentRef:U,route:y,contexts:K})}}deactivateRouteAndOutlet(y,_){const T=_.getContext(y.value.outlet),M=T&&y.value.component?T.children:_,F=Ko(y);for(const U of Object.keys(F))this.deactivateRouteAndItsChildren(F[U],M);T&&(T.outlet&&(T.outlet.deactivate(),T.children.onOutletDeactivated()),T.attachRef=null,T.resolver=null,T.route=null)}activateChildRoutes(y,_,T){const M=Ko(_);y.children.forEach(F=>{this.activateRoutes(F,M[F.value.outlet],T),this.forwardEvent(new Hs(F.value.snapshot))}),y.children.length&&this.forwardEvent(new eo(y.value.snapshot))}activateRoutes(y,_,T){const M=y.value,F=_?_.value:null;if(Gr(M),M===F)if(M.component){const U=T.getOrCreateContext(M.outlet);this.activateChildRoutes(y,_,U.children)}else this.activateChildRoutes(y,_,T);else if(M.component){const U=T.getOrCreateContext(M.outlet);if(this.routeReuseStrategy.shouldAttach(M.snapshot)){const K=this.routeReuseStrategy.retrieve(M.snapshot);this.routeReuseStrategy.store(M.snapshot,null),U.children.onOutletReAttached(K.contexts),U.attachRef=K.componentRef,U.route=K.route.value,U.outlet&&U.outlet.attach(K.componentRef,K.route.value),Gr(K.route.value),this.activateChildRoutes(y,null,U.children)}else{const K=xr(M.snapshot),ee=K?.get(Y._Vd)??null;U.attachRef=null,U.route=M,U.resolver=ee,U.injector=K,U.outlet&&U.outlet.activateWith(M,U.injector),this.activateChildRoutes(y,null,U.children)}}else this.activateChildRoutes(y,null,T)}}class Bo{constructor(y){this.path=y,this.route=this.path[this.path.length-1]}}class ho{constructor(y,_){this.component=y,this.route=_}}function pa(m,y,_){const T=m._root;return Ki(T,y?y._root:null,_,[T.value])}function Xn(m,y){const _=Symbol(),T=y.get(m,_);return T===_?"function"!=typeof m||(0,Y.Z0I)(m)?y.get(m):m:T}function Ki(m,y,_,T,M={canDeactivateChecks:[],canActivateChecks:[]}){const F=Ko(y);return m.children.forEach(U=>{(function Ha(m,y,_,T,M={canDeactivateChecks:[],canActivateChecks:[]}){const F=m.value,U=y?y.value:null,K=_?_.getContext(m.value.outlet):null;if(U&&F.routeConfig===U.routeConfig){const ee=function fs(m,y,_){if("function"==typeof _)return _(m,y);switch(_){case"pathParamsChange":return!Ce(m.url,y.url);case"pathParamsOrQueryParamsChange":return!Ce(m.url,y.url)||!Vi(m.queryParams,y.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!As(m,y)||!Vi(m.queryParams,y.queryParams);default:return!As(m,y)}}(U,F,F.routeConfig.runGuardsAndResolvers);ee?M.canActivateChecks.push(new Bo(T)):(F.data=U.data,F._resolvedData=U._resolvedData),Ki(m,y,F.component?K?K.children:null:_,T,M),ee&&K&&K.outlet&&K.outlet.isActivated&&M.canDeactivateChecks.push(new ho(K.outlet.component,U))}else U&&ta(y,K,M),M.canActivateChecks.push(new Bo(T)),Ki(m,null,F.component?K?K.children:null:_,T,M)})(U,F[U.value.outlet],_,T.concat([U.value]),M),delete F[U.value.outlet]}),Hi(F,(U,K)=>ta(U,_.getContext(K),M)),M}function ta(m,y,_){const T=Ko(m),M=m.value;Hi(T,(F,U)=>{ta(F,M.component?y?y.children.getContext(U):null:y,_)}),_.canDeactivateChecks.push(new ho(M.component&&y&&y.outlet&&y.outlet.isActivated?y.outlet.component:null,M))}function na(m){return"function"==typeof m}function es(m){return m instanceof nn||"EmptyError"===m?.name}const xo=Symbol("INITIAL_VALUE");function wr(){return at(m=>bn(m.map(y=>y.pipe(bt(1),function Dt(...m){const y=(0,_t.yG)(m);return(0,zt.e)((_,T)=>{(y?an(m,_,y):an(m,_)).subscribe(T)})}(xo)))).pipe((0,qe.U)(y=>{for(const _ of y)if(!0!==_){if(_===xo)return xo;if(!1===_||_ instanceof ze)return _}return!0}),(0,Ut.h)(y=>y!==xo),bt(1)))}function R(m){return(0,fn.z)((0,un.b)(y=>{if(Ho(y))throw Oi(0,y)}),(0,qe.U)(y=>!0===y))}const G={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function se(m,y,_,T,M){const F=me(m,y,_);return F.matched?function L(m,y,_,T){const M=y.canMatch;if(!M||0===M.length)return(0,Xe.of)(!0);const F=M.map(U=>{const K=Xn(U,m);return Ri(function Ba(m){return m&&na(m.canMatch)}(K)?K.canMatch(y,_):m.runInContext(()=>K(y,_)))});return(0,Xe.of)(F).pipe(wr(),R())}(T=uo(y,T),y,_).pipe((0,qe.U)(U=>!0===U?F:{...G})):(0,Xe.of)(F)}function me(m,y,_){if(""===y.path)return"full"===y.pathMatch&&(m.hasChildren()||_.length>0)?{...G}:{matched:!0,consumedSegments:[],remainingSegments:_,parameters:{},positionalParamSegments:{}};const M=(y.matcher||os)(_,m,y);if(!M)return{...G};const F={};Hi(M.posParams,(K,ee)=>{F[ee]=K.path});const U=M.consumed.length>0?{...F,...M.consumed[M.consumed.length-1].parameters}:F;return{matched:!0,consumedSegments:M.consumed,remainingSegments:_.slice(M.consumed.length),parameters:U,positionalParamSegments:M.posParams??{}}}function Oe(m,y,_,T){if(_.length>0&&function mt(m,y,_){return _.some(T=>Sn(m,y,T)&&Pr(T)!==Wt)}(m,_,T)){const F=new fe(y,function st(m,y,_,T){const M={};M[Wt]=T,T._sourceSegment=m,T._segmentIndexShift=y.length;for(const F of _)if(""===F.path&&Pr(F)!==Wt){const U=new fe([],{});U._sourceSegment=m,U._segmentIndexShift=y.length,M[Pr(F)]=U}return M}(m,y,T,new fe(_,m.children)));return F._sourceSegment=m,F._segmentIndexShift=y.length,{segmentGroup:F,slicedSegments:[]}}if(0===_.length&&function xn(m,y,_){return _.some(T=>Sn(m,y,T))}(m,_,T)){const F=new fe(m.segments,function Ue(m,y,_,T,M){const F={};for(const U of T)if(Sn(m,_,U)&&!M[Pr(U)]){const K=new fe([],{});K._sourceSegment=m,K._segmentIndexShift=y.length,F[Pr(U)]=K}return{...M,...F}}(m,y,_,T,m.children));return F._sourceSegment=m,F._segmentIndexShift=y.length,{segmentGroup:F,slicedSegments:_}}const M=new fe(m.segments,m.children);return M._sourceSegment=m,M._segmentIndexShift=y.length,{segmentGroup:M,slicedSegments:_}}function Sn(m,y,_){return(!(m.hasChildren()||y.length>0)||"full"!==_.pathMatch)&&""===_.path}function ci(m,y,_,T){return!!(Pr(m)===T||T!==Wt&&Sn(y,_,m))&&("**"===m.path||me(y,m,_).matched)}function oi(m,y,_){return 0===y.length&&!m.children[_]}const Un=!1;class Jn{constructor(y){this.segmentGroup=y||null}}class Ni{constructor(y){this.urlTree=y}}function xi(m){return tt(new Jn(m))}function gr(m){return tt(new Ni(m))}class Si{constructor(y,_,T,M,F){this.injector=y,this.configLoader=_,this.urlSerializer=T,this.urlTree=M,this.config=F,this.allowRedirects=!0}apply(){const y=Oe(this.urlTree.root,[],[],this.config).segmentGroup,_=new fe(y.segments,y.children);return this.expandSegmentGroup(this.injector,this.config,_,Wt).pipe((0,qe.U)(F=>this.createUrlTree(mo(F),this.urlTree.queryParams,this.urlTree.fragment))).pipe((0,Hn.K)(F=>{if(F instanceof Ni)return this.allowRedirects=!1,this.match(F.urlTree);throw F instanceof Jn?this.noMatchError(F):F}))}match(y){return this.expandSegmentGroup(this.injector,this.config,y.root,Wt).pipe((0,qe.U)(M=>this.createUrlTree(mo(M),y.queryParams,y.fragment))).pipe((0,Hn.K)(M=>{throw M instanceof Jn?this.noMatchError(M):M}))}noMatchError(y){return new Y.vHH(4002,Un)}createUrlTree(y,_,T){const M=ss(y);return new ze(M,_,T)}expandSegmentGroup(y,_,T,M){return 0===T.segments.length&&T.hasChildren()?this.expandChildren(y,_,T).pipe((0,qe.U)(F=>new fe([],F))):this.expandSegment(y,T,_,T.segments,M,!0)}expandChildren(y,_,T){const M=[];for(const F of Object.keys(T.children))"primary"===F?M.unshift(F):M.push(F);return(0,W.D)(M).pipe((0,Rn.b)(F=>{const U=T.children[F],K=bs(_,F);return this.expandSegmentGroup(y,K,U,F).pipe((0,qe.U)(ee=>({segment:ee,outlet:F})))}),qn((F,U)=>(F[U.outlet]=U.segment,F),{}),Ht())}expandSegment(y,_,T,M,F,U){return(0,W.D)(T).pipe((0,Rn.b)(K=>this.expandSegmentAgainstRoute(y,_,T,K,M,F,U).pipe((0,Hn.K)(le=>{if(le instanceof Jn)return(0,Xe.of)(null);throw le}))),ln(K=>!!K),(0,Hn.K)((K,ee)=>{if(es(K))return oi(_,M,F)?(0,Xe.of)(new fe([],{})):xi(_);throw K}))}expandSegmentAgainstRoute(y,_,T,M,F,U,K){return ci(M,_,F,U)?void 0===M.redirectTo?this.matchSegmentAgainstRoute(y,_,M,F,U):K&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(y,_,T,M,F,U):xi(_):xi(_)}expandSegmentAgainstRouteUsingRedirect(y,_,T,M,F,U){return"**"===M.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(y,T,M,U):this.expandRegularSegmentAgainstRouteUsingRedirect(y,_,T,M,F,U)}expandWildCardWithParamsAgainstRouteUsingRedirect(y,_,T,M){const F=this.applyRedirectCommands([],T.redirectTo,{});return T.redirectTo.startsWith("/")?gr(F):this.lineralizeSegments(T,F).pipe((0,Ot.z)(U=>{const K=new fe(U,{});return this.expandSegment(y,K,_,U,M,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(y,_,T,M,F,U){const{matched:K,consumedSegments:ee,remainingSegments:le,positionalParamSegments:Z}=me(_,M,F);if(!K)return xi(_);const ce=this.applyRedirectCommands(ee,M.redirectTo,Z);return M.redirectTo.startsWith("/")?gr(ce):this.lineralizeSegments(M,ce).pipe((0,Ot.z)(_e=>this.expandSegment(y,_,T,_e.concat(le),U,!1)))}matchSegmentAgainstRoute(y,_,T,M,F){return"**"===T.path?(y=uo(T,y),T.loadChildren?(T._loadedRoutes?(0,Xe.of)({routes:T._loadedRoutes,injector:T._loadedInjector}):this.configLoader.loadChildren(y,T)).pipe((0,qe.U)(K=>(T._loadedRoutes=K.routes,T._loadedInjector=K.injector,new fe(M,{})))):(0,Xe.of)(new fe(M,{}))):se(_,T,M,y).pipe(at(({matched:U,consumedSegments:K,remainingSegments:ee})=>U?this.getChildConfig(y=T._injector??y,T,M).pipe((0,Ot.z)(Z=>{const ce=Z.injector??y,_e=Z.routes,{segmentGroup:we,slicedSegments:ke}=Oe(_,K,ee,_e),Be=new fe(we.segments,we.children);if(0===ke.length&&Be.hasChildren())return this.expandChildren(ce,_e,Be).pipe((0,qe.U)(nt=>new fe(K,nt)));if(0===_e.length&&0===ke.length)return(0,Xe.of)(new fe(K,{}));const Pe=Pr(T)===F;return this.expandSegment(ce,Be,_e,ke,Pe?Wt:F,!0).pipe((0,qe.U)(He=>new fe(K.concat(He.segments),He.children)))})):xi(_)))}getChildConfig(y,_,T){return _.children?(0,Xe.of)({routes:_.children,injector:y}):_.loadChildren?void 0!==_._loadedRoutes?(0,Xe.of)({routes:_._loadedRoutes,injector:_._loadedInjector}):function ie(m,y,_,T){const M=y.canLoad;if(void 0===M||0===M.length)return(0,Xe.of)(!0);const F=M.map(U=>{const K=Xn(U,m);return Ri(function Zs(m){return m&&na(m.canLoad)}(K)?K.canLoad(y,_):m.runInContext(()=>K(y,_)))});return(0,Xe.of)(F).pipe(wr(),R())}(y,_,T).pipe((0,Ot.z)(M=>M?this.configLoader.loadChildren(y,_).pipe((0,un.b)(F=>{_._loadedRoutes=F.routes,_._loadedInjector=F.injector})):function Wn(m){return tt(Ya(Un,3))}())):(0,Xe.of)({routes:[],injector:y})}lineralizeSegments(y,_){let T=[],M=_.root;for(;;){if(T=T.concat(M.segments),0===M.numberOfChildren)return(0,Xe.of)(T);if(M.numberOfChildren>1||!M.children[Wt])return y.redirectTo,tt(new Y.vHH(4e3,Un));M=M.children[Wt]}}applyRedirectCommands(y,_,T){return this.applyRedirectCreateUrlTree(_,this.urlSerializer.parse(_),y,T)}applyRedirectCreateUrlTree(y,_,T,M){const F=this.createSegmentGroup(y,_.root,T,M);return new ze(F,this.createQueryParams(_.queryParams,this.urlTree.queryParams),_.fragment)}createQueryParams(y,_){const T={};return Hi(y,(M,F)=>{if("string"==typeof M&&M.startsWith(":")){const K=M.substring(1);T[F]=_[K]}else T[F]=M}),T}createSegmentGroup(y,_,T,M){const F=this.createSegments(y,_.segments,T,M);let U={};return Hi(_.children,(K,ee)=>{U[ee]=this.createSegmentGroup(y,K,T,M)}),new fe(F,U)}createSegments(y,_,T,M){return _.map(F=>F.path.startsWith(":")?this.findPosParam(y,F,M):this.findOrReturn(F,T))}findPosParam(y,_,T){const M=T[_.path.substring(1)];if(!M)throw new Y.vHH(4001,Un);return M}findOrReturn(y,_){let T=0;for(const M of _){if(M.path===y.path)return _.splice(T),M;T++}return y}}class J{}class Ae{constructor(y,_,T,M,F,U,K){this.injector=y,this.rootComponentType=_,this.config=T,this.urlTree=M,this.url=F,this.paramsInheritanceStrategy=U,this.urlSerializer=K}recognize(){const y=Oe(this.urlTree.root,[],[],this.config.filter(_=>void 0===_.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,y,Wt).pipe((0,qe.U)(_=>{if(null===_)return null;const T=new Lo([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Wt,this.rootComponentType,null,this.urlTree.root,-1,{}),M=new Hr(T,_),F=new ea(this.url,M);return this.inheritParamsAndData(F._root),F}))}inheritParamsAndData(y){const _=y.value,T=Ca(_,this.paramsInheritanceStrategy);_.params=Object.freeze(T.params),_.data=Object.freeze(T.data),y.children.forEach(M=>this.inheritParamsAndData(M))}processSegmentGroup(y,_,T,M){return 0===T.segments.length&&T.hasChildren()?this.processChildren(y,_,T):this.processSegment(y,_,T,T.segments,M)}processChildren(y,_,T){return(0,W.D)(Object.keys(T.children)).pipe((0,Rn.b)(M=>{const F=T.children[M],U=bs(_,M);return this.processSegmentGroup(y,U,F,M)}),qn((M,F)=>M&&F?(M.push(...F),M):null),function zi(m,y=!1){return(0,zt.e)((_,T)=>{let M=0;_.subscribe((0,An.x)(T,F=>{const U=m(F,M++);(U||y)&&T.next(F),!U&&T.complete()}))})}(M=>null!==M),On(null),Ht(),(0,qe.U)(M=>{if(null===M)return null;const F=I(M);return function et(m){m.sort((y,_)=>y.value.outlet===Wt?-1:_.value.outlet===Wt?1:y.value.outlet.localeCompare(_.value.outlet))}(F),F}))}processSegment(y,_,T,M,F){return(0,W.D)(_).pipe((0,Rn.b)(U=>this.processSegmentAgainstRoute(U._injector??y,U,T,M,F)),ln(U=>!!U),(0,Hn.K)(U=>{if(es(U))return oi(T,M,F)?(0,Xe.of)([]):(0,Xe.of)(null);throw U}))}processSegmentAgainstRoute(y,_,T,M,F){if(_.redirectTo||!ci(_,T,M,F))return(0,Xe.of)(null);let U;if("**"===_.path){const K=M.length>0?jt(M).parameters:{},ee=We(T)+M.length,le=new Lo(M,K,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Ln(_),Pr(_),_.component??_._loadedComponent??null,_,pe(T),ee,zn(_));U=(0,Xe.of)({snapshot:le,consumedSegments:[],remainingSegments:[]})}else U=se(T,_,M,y).pipe((0,qe.U)(({matched:K,consumedSegments:ee,remainingSegments:le,parameters:Z})=>{if(!K)return null;const ce=We(T)+ee.length;return{snapshot:new Lo(ee,Z,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Ln(_),Pr(_),_.component??_._loadedComponent??null,_,pe(T),ce,zn(_)),consumedSegments:ee,remainingSegments:le}}));return U.pipe(at(K=>{if(null===K)return(0,Xe.of)(null);const{snapshot:ee,consumedSegments:le,remainingSegments:Z}=K;y=_._injector??y;const ce=_._loadedInjector??y,_e=function x(m){return m.children?m.children:m.loadChildren?m._loadedRoutes:[]}(_),{segmentGroup:we,slicedSegments:ke}=Oe(T,le,Z,_e.filter(Pe=>void 0===Pe.redirectTo));if(0===ke.length&&we.hasChildren())return this.processChildren(ce,_e,we).pipe((0,qe.U)(Pe=>null===Pe?null:[new Hr(ee,Pe)]));if(0===_e.length&&0===ke.length)return(0,Xe.of)([new Hr(ee,[])]);const Be=Pr(_)===F;return this.processSegment(ce,_e,we,ke,Be?Wt:F).pipe((0,qe.U)(Pe=>null===Pe?null:[new Hr(ee,Pe)]))}))}}function E(m){const y=m.value.routeConfig;return y&&""===y.path&&void 0===y.redirectTo}function I(m){const y=[],_=new Set;for(const T of m){if(!E(T)){y.push(T);continue}const M=y.find(F=>T.value.routeConfig===F.value.routeConfig);void 0!==M?(M.children.push(...T.children),_.add(M)):y.push(T)}for(const T of _){const M=I(T.children);y.push(new Hr(T.value,M))}return y.filter(T=>!_.has(T))}function pe(m){let y=m;for(;y._sourceSegment;)y=y._sourceSegment;return y}function We(m){let y=m,_=y._segmentIndexShift??0;for(;y._sourceSegment;)y=y._sourceSegment,_+=y._segmentIndexShift??0;return _-1}function Ln(m){return m.data||{}}function zn(m){return m.resolve||{}}function qr(m){return"string"==typeof m.title||null===m.title}function oa(m){return at(y=>{const _=m(y);return _?(0,W.D)(_).pipe((0,qe.U)(()=>y)):(0,Xe.of)(y)})}const kr=new Y.OlP("ROUTES");let Ja=(()=>{class m{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=(0,Y.f3M)(Y.Sil)}loadComponent(_){if(this.componentLoaders.get(_))return this.componentLoaders.get(_);if(_._loadedComponent)return(0,Xe.of)(_._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(_);const T=Ri(_.loadComponent()).pipe((0,qe.U)(pl),(0,un.b)(F=>{this.onLoadEndListener&&this.onLoadEndListener(_),_._loadedComponent=F}),Wi(()=>{this.componentLoaders.delete(_)})),M=new yi(T,()=>new Mt.x).pipe(En());return this.componentLoaders.set(_,M),M}loadChildren(_,T){if(this.childrenLoaders.get(T))return this.childrenLoaders.get(T);if(T._loadedRoutes)return(0,Xe.of)({routes:T._loadedRoutes,injector:T._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(T);const F=this.loadModuleFactoryOrRoutes(T.loadChildren).pipe((0,qe.U)(K=>{this.onLoadEndListener&&this.onLoadEndListener(T);let ee,le,Z=!1;Array.isArray(K)?le=K:(ee=K.create(_).injector,le=Zi(ee.get(kr,[],Y.XFs.Self|Y.XFs.Optional)));return{routes:le.map(mi),injector:ee}}),Wi(()=>{this.childrenLoaders.delete(T)})),U=new yi(F,()=>new Mt.x).pipe(En());return this.childrenLoaders.set(T,U),U}loadModuleFactoryOrRoutes(_){return Ri(_()).pipe((0,qe.U)(pl),(0,Ot.z)(T=>T instanceof Y.YKP||Array.isArray(T)?(0,Xe.of)(T):(0,W.D)(this.compiler.compileModuleAsync(T))))}}return m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Y.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})();function pl(m){return function Ql(m){return m&&"object"==typeof m&&"default"in m}(m)?m.default:m}let Qa=(()=>{class m{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new Mt.x,this.configLoader=(0,Y.f3M)(Ja),this.environmentInjector=(0,Y.f3M)(Y.lqb),this.urlSerializer=(0,Y.f3M)(Ye),this.rootContexts=(0,Y.f3M)(Ms),this.navigationId=0,this.afterPreactivation=()=>(0,Xe.of)(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=M=>this.events.next(new ca(M)),this.configLoader.onLoadStartListener=M=>this.events.next(new ri(M))}complete(){this.transitions?.complete()}handleNavigationRequest(_){const T=++this.navigationId;this.transitions?.next({...this.transitions.value,..._,id:T})}setupNavigations(_){return this.transitions=new c.X({id:0,targetPageId:0,currentUrlTree:_.currentUrlTree,currentRawUrl:_.currentUrlTree,extractedUrl:_.urlHandlingStrategy.extract(_.currentUrlTree),urlAfterRedirects:_.urlHandlingStrategy.extract(_.currentUrlTree),rawUrl:_.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Li,restoredState:null,currentSnapshot:_.routerState.snapshot,targetSnapshot:null,currentRouterState:_.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe((0,Ut.h)(T=>0!==T.id),(0,qe.U)(T=>({...T,extractedUrl:_.urlHandlingStrategy.extract(T.rawUrl)})),at(T=>{let M=!1,F=!1;return(0,Xe.of)(T).pipe((0,un.b)(U=>{this.currentNavigation={id:U.id,initialUrl:U.rawUrl,extractedUrl:U.extractedUrl,trigger:U.source,extras:U.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),at(U=>{const K=_.browserUrlTree.toString(),ee=!_.navigated||U.extractedUrl.toString()!==K||K!==_.currentUrlTree.toString();if(!ee&&"reload"!==(U.extras.onSameUrlNavigation??_.onSameUrlNavigation)){const Z="";return this.events.next(new fr(U.id,_.serializeUrl(T.rawUrl),Z,0)),_.rawUrlTree=U.rawUrl,U.resolve(null),kt.E}if(_.urlHandlingStrategy.shouldProcessUrl(U.rawUrl))return gl(U.source)&&(_.browserUrlTree=U.extractedUrl),(0,Xe.of)(U).pipe(at(Z=>{const ce=this.transitions?.getValue();return this.events.next(new co(Z.id,this.urlSerializer.serialize(Z.extractedUrl),Z.source,Z.restoredState)),ce!==this.transitions?.getValue()?kt.E:Promise.resolve(Z)}),function br(m,y,_,T){return at(M=>function dr(m,y,_,T,M){return new Si(m,y,_,T,M).apply()}(m,y,_,M.extractedUrl,T).pipe((0,qe.U)(F=>({...M,urlAfterRedirects:F}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,_.config),(0,un.b)(Z=>{this.currentNavigation={...this.currentNavigation,finalUrl:Z.urlAfterRedirects},T.urlAfterRedirects=Z.urlAfterRedirects}),function Gi(m,y,_,T,M){return(0,Ot.z)(F=>function ue(m,y,_,T,M,F,U="emptyOnly"){return new Ae(m,y,_,T,M,U,F).recognize().pipe(at(K=>null===K?function j(m){return new xt.y(y=>y.error(m))}(new J):(0,Xe.of)(K)))}(m,y,_,F.urlAfterRedirects,T.serialize(F.urlAfterRedirects),T,M).pipe((0,qe.U)(U=>({...F,targetSnapshot:U}))))}(this.environmentInjector,this.rootComponentType,_.config,this.urlSerializer,_.paramsInheritanceStrategy),(0,un.b)(Z=>{if(T.targetSnapshot=Z.targetSnapshot,"eager"===_.urlUpdateStrategy){if(!Z.extras.skipLocationChange){const _e=_.urlHandlingStrategy.merge(Z.urlAfterRedirects,Z.rawUrl);_.setBrowserUrl(_e,Z)}_.browserUrlTree=Z.urlAfterRedirects}const ce=new ko(Z.id,this.urlSerializer.serialize(Z.extractedUrl),this.urlSerializer.serialize(Z.urlAfterRedirects),Z.targetSnapshot);this.events.next(ce)}));if(ee&&_.urlHandlingStrategy.shouldProcessUrl(_.rawUrlTree)){const{id:Z,extractedUrl:ce,source:_e,restoredState:we,extras:ke}=U,Be=new co(Z,this.urlSerializer.serialize(ce),_e,we);this.events.next(Be);const Pe=hs(ce,this.rootComponentType).snapshot;return T={...U,targetSnapshot:Pe,urlAfterRedirects:ce,extras:{...ke,skipLocationChange:!1,replaceUrl:!1}},(0,Xe.of)(T)}{const Z="";return this.events.next(new fr(U.id,_.serializeUrl(T.extractedUrl),Z,1)),_.rawUrlTree=U.rawUrl,U.resolve(null),kt.E}}),(0,un.b)(U=>{const K=new Jr(U.id,this.urlSerializer.serialize(U.extractedUrl),this.urlSerializer.serialize(U.urlAfterRedirects),U.targetSnapshot);this.events.next(K)}),(0,qe.U)(U=>T={...U,guards:pa(U.targetSnapshot,U.currentSnapshot,this.rootContexts)}),function ma(m,y){return(0,Ot.z)(_=>{const{targetSnapshot:T,currentSnapshot:M,guards:{canActivateChecks:F,canDeactivateChecks:U}}=_;return 0===U.length&&0===F.length?(0,Xe.of)({..._,guardsResult:!0}):function ga(m,y,_,T){return(0,W.D)(m).pipe((0,Ot.z)(M=>function ra(m,y,_,T,M){const F=y&&y.routeConfig?y.routeConfig.canDeactivate:null;if(!F||0===F.length)return(0,Xe.of)(!0);const U=F.map(K=>{const ee=xr(y)??M,le=Xn(K,ee);return Ri(function Pi(m){return m&&na(m.canDeactivate)}(le)?le.canDeactivate(m,y,_,T):ee.runInContext(()=>le(m,y,_,T))).pipe(ln())});return(0,Xe.of)(U).pipe(wr())}(M.component,M.route,_,y,T)),ln(M=>!0!==M,!0))}(U,T,M,m).pipe((0,Ot.z)(K=>K&&function Fa(m){return"boolean"==typeof m}(K)?function Es(m,y,_,T){return(0,W.D)(y).pipe((0,Rn.b)(M=>an(function ia(m,y){return null!==m&&y&&y(new ua(m)),(0,Xe.of)(!0)}(M.route.parent,T),function _a(m,y){return null!==m&&y&&y(new to(m)),(0,Xe.of)(!0)}(M.route,T),function zo(m,y,_){const T=y[y.length-1],F=y.slice(0,y.length-1).reverse().map(U=>function ks(m){const y=m.routeConfig?m.routeConfig.canActivateChild:null;return y&&0!==y.length?{node:m,guards:y}:null}(U)).filter(U=>null!==U).map(U=>Se(()=>{const K=U.guards.map(ee=>{const le=xr(U.node)??_,Z=Xn(ee,le);return Ri(function Nt(m){return m&&na(m.canActivateChild)}(Z)?Z.canActivateChild(T,m):le.runInContext(()=>Z(T,m))).pipe(ln())});return(0,Xe.of)(K).pipe(wr())}));return(0,Xe.of)(F).pipe(wr())}(m,M.path,_),function oo(m,y,_){const T=y.routeConfig?y.routeConfig.canActivate:null;if(!T||0===T.length)return(0,Xe.of)(!0);const M=T.map(F=>Se(()=>{const U=xr(y)??_,K=Xn(F,U);return Ri(function ps(m){return m&&na(m.canActivate)}(K)?K.canActivate(y,m):U.runInContext(()=>K(y,m))).pipe(ln())}));return(0,Xe.of)(M).pipe(wr())}(m,M.route,_))),ln(M=>!0!==M,!0))}(T,F,m,y):(0,Xe.of)(K)),(0,qe.U)(K=>({..._,guardsResult:K})))})}(this.environmentInjector,U=>this.events.next(U)),(0,un.b)(U=>{if(T.guardsResult=U.guardsResult,Ho(U.guardsResult))throw Oi(0,U.guardsResult);const K=new _o(U.id,this.urlSerializer.serialize(U.extractedUrl),this.urlSerializer.serialize(U.urlAfterRedirects),U.targetSnapshot,!!U.guardsResult);this.events.next(K)}),(0,Ut.h)(U=>!!U.guardsResult||(_.restoreHistory(U),this.cancelNavigationTransition(U,"",3),!1)),oa(U=>{if(U.guards.canActivateChecks.length)return(0,Xe.of)(U).pipe((0,un.b)(K=>{const ee=new Ro(K.id,this.urlSerializer.serialize(K.extractedUrl),this.urlSerializer.serialize(K.urlAfterRedirects),K.targetSnapshot);this.events.next(ee)}),at(K=>{let ee=!1;return(0,Xe.of)(K).pipe(function Ti(m,y){return(0,Ot.z)(_=>{const{targetSnapshot:T,guards:{canActivateChecks:M}}=_;if(!M.length)return(0,Xe.of)(_);let F=0;return(0,W.D)(M).pipe((0,Rn.b)(U=>function Xs(m,y,_,T){const M=m.routeConfig,F=m._resolve;return void 0!==M?.title&&!qr(M)&&(F[Ar]=M.title),function ts(m,y,_,T){const M=function Zt(m){return[...Object.keys(m),...Object.getOwnPropertySymbols(m)]}(m);if(0===M.length)return(0,Xe.of)({});const F={};return(0,W.D)(M).pipe((0,Ot.z)(U=>function Nr(m,y,_,T){const M=xr(y)??T,F=Xn(m,M);return Ri(F.resolve?F.resolve(y,_):M.runInContext(()=>F(y,_)))}(m[U],y,_,T).pipe(ln(),(0,un.b)(K=>{F[U]=K}))),hi(1),function li(m){return(0,qe.U)(()=>m)}(F),(0,Hn.K)(U=>es(U)?kt.E:tt(U)))}(F,m,y,T).pipe((0,qe.U)(U=>(m._resolvedData=U,m.data=Ca(m,_).resolve,M&&qr(M)&&(m.data[Ar]=M.title),null)))}(U.route,T,m,y)),(0,un.b)(()=>F++),hi(1),(0,Ot.z)(U=>F===M.length?(0,Xe.of)(_):kt.E))})}(_.paramsInheritanceStrategy,this.environmentInjector),(0,un.b)({next:()=>ee=!0,complete:()=>{ee||(_.restoreHistory(K),this.cancelNavigationTransition(K,"",2))}}))}),(0,un.b)(K=>{const ee=new Qr(K.id,this.urlSerializer.serialize(K.extractedUrl),this.urlSerializer.serialize(K.urlAfterRedirects),K.targetSnapshot);this.events.next(ee)}))}),oa(U=>{const K=ee=>{const le=[];ee.routeConfig?.loadComponent&&!ee.routeConfig._loadedComponent&&le.push(this.configLoader.loadComponent(ee.routeConfig).pipe((0,un.b)(Z=>{ee.component=Z}),(0,qe.U)(()=>{})));for(const Z of ee.children)le.push(...K(Z));return le};return bn(K(U.targetSnapshot.root)).pipe(On(),bt(1))}),oa(()=>this.afterPreactivation()),(0,qe.U)(U=>{const K=function qs(m,y,_){const T=Yo(m,y._root,_?_._root:void 0);return new Gs(T,y)}(_.routeReuseStrategy,U.targetSnapshot,U.currentRouterState);return T={...U,targetRouterState:K}}),(0,un.b)(U=>{_.currentUrlTree=U.urlAfterRedirects,_.rawUrlTree=_.urlHandlingStrategy.merge(U.urlAfterRedirects,U.rawUrl),_.routerState=U.targetRouterState,"deferred"===_.urlUpdateStrategy&&(U.extras.skipLocationChange||_.setBrowserUrl(_.rawUrlTree,U),_.browserUrlTree=U.urlAfterRedirects)}),((m,y,_)=>(0,qe.U)(T=>(new Fo(y,T.targetRouterState,T.currentRouterState,_).activate(m),T)))(this.rootContexts,_.routeReuseStrategy,U=>this.events.next(U)),bt(1),(0,un.b)({next:U=>{M=!0,this.lastSuccessfulNavigation=this.currentNavigation,_.navigated=!0,this.events.next(new Zr(U.id,this.urlSerializer.serialize(U.extractedUrl),this.urlSerializer.serialize(_.currentUrlTree))),_.titleStrategy?.updateTitle(U.targetRouterState.snapshot),U.resolve(!0)},complete:()=>{M=!0}}),Wi(()=>{M||F||this.cancelNavigationTransition(T,"",1),this.currentNavigation?.id===T.id&&(this.currentNavigation=null)}),(0,Hn.K)(U=>{if(F=!0,Oa(U)){yo(U)||(_.navigated=!0,_.restoreHistory(T,!0));const K=new Xo(T.id,this.urlSerializer.serialize(T.extractedUrl),U.message,U.cancellationCode);if(this.events.next(K),yo(U)){const ee=_.urlHandlingStrategy.merge(U.url,_.rawUrlTree),le={skipLocationChange:T.extras.skipLocationChange,replaceUrl:"eager"===_.urlUpdateStrategy||gl(T.source)};_.scheduleNavigation(ee,Li,null,le,{resolve:T.resolve,reject:T.reject,promise:T.promise})}else T.resolve(!1)}else{_.restoreHistory(T,!0);const K=new Xi(T.id,this.urlSerializer.serialize(T.extractedUrl),U,T.targetSnapshot??void 0);this.events.next(K);try{T.resolve(_.errorHandler(U))}catch(ee){T.reject(ee)}}return kt.E}))}))}cancelNavigationTransition(_,T,M){const F=new Xo(_.id,this.urlSerializer.serialize(_.extractedUrl),T,M);this.events.next(F),_.resolve(!1)}}return m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Y.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})();function gl(m){return m!==Li}let za=(()=>{class m{buildTitle(_){let T,M=_.root;for(;void 0!==M;)T=this.getResolvedTitleForRoute(M)??T,M=M.children.find(F=>F.outlet===Wt);return T}getResolvedTitleForRoute(_){return _.data[Ar]}}return m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Y.Yz7({token:m,factory:function(){return(0,Y.f3M)(Eu)},providedIn:"root"}),m})(),Eu=(()=>{class m extends za{constructor(_){super(),this.title=_}updateTitle(_){const T=this.buildTitle(_);void 0!==T&&this.title.setTitle(T)}}return m.\u0275fac=function(_){return new(_||m)(Y.LFG(si.Dx))},m.\u0275prov=Y.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})(),Tu=(()=>{class m{}return m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Y.Yz7({token:m,factory:function(){return(0,Y.f3M)(Il)},providedIn:"root"}),m})();class qc{shouldDetach(y){return!1}store(y,_){}shouldAttach(y){return!1}retrieve(y){return null}shouldReuseRoute(y,_){return y.routeConfig===_.routeConfig}}let Il=(()=>{class m extends qc{}return m.\u0275fac=function(){let y;return function(T){return(y||(y=Y.n5z(m)))(T||m)}}(),m.\u0275prov=Y.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})();const Pl=new Y.OlP("",{providedIn:"root",factory:()=>({})});let kl=(()=>{class m{}return m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Y.Yz7({token:m,factory:function(){return(0,Y.f3M)(Rl)},providedIn:"root"}),m})(),Rl=(()=>{class m{shouldProcessUrl(_){return!0}extract(_){return _}merge(_,T){return _}}return m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Y.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})();function _l(m){throw m}function ec(m,y,_){return y.parse("/")}const Cu={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},yc={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Ts=(()=>{class m{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){if("computed"===this.canceledNavigationResolution)return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=(0,Y.f3M)(Y.c2e),this.isNgZoneEnabled=!1,this.options=(0,Y.f3M)(Pl,{optional:!0})||{},this.errorHandler=this.options.errorHandler||_l,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||ec,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=(0,Y.f3M)(kl),this.routeReuseStrategy=(0,Y.f3M)(Tu),this.urlCreationStrategy=(0,Y.f3M)(Mr),this.titleStrategy=(0,Y.f3M)(za),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=Zi((0,Y.f3M)(kr,{optional:!0})??[]),this.navigationTransitions=(0,Y.f3M)(Qa),this.urlSerializer=(0,Y.f3M)(Ye),this.location=(0,Y.f3M)(Bi.Ye),this.isNgZoneEnabled=(0,Y.f3M)(Y.R0b)instanceof Y.R0b&&Y.R0b.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new ze,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=hs(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe(_=>{this.lastSuccessfulId=_.id,this.currentPageId=this.browserPageId??0},_=>{this.console.warn(`Unhandled Navigation Error: ${_}`)})}resetRootComponentType(_){this.routerState.root.component=_,this.navigationTransitions.rootComponentType=_}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const _=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),Li,_)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(_=>{const T="popstate"===_.type?"popstate":"hashchange";"popstate"===T&&setTimeout(()=>{this.navigateToSyncWithBrowser(_.url,T,_.state)},0)}))}navigateToSyncWithBrowser(_,T,M){const F={replaceUrl:!0},U=M?.navigationId?M:null;if(M){const ee={...M};delete ee.navigationId,delete ee.\u0275routerPageId,0!==Object.keys(ee).length&&(F.state=ee)}const K=this.parseUrl(_);this.scheduleNavigation(K,T,U,F)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(_){this.config=_.map(mi),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(_,T={}){const{relativeTo:M,queryParams:F,fragment:U,queryParamsHandling:K,preserveFragment:ee}=T,le=ee?this.currentUrlTree.fragment:U;let Z=null;switch(K){case"merge":Z={...this.currentUrlTree.queryParams,...F};break;case"preserve":Z=this.currentUrlTree.queryParams;break;default:Z=F||null}return null!==Z&&(Z=this.removeEmptyProps(Z)),this.urlCreationStrategy.createUrlTree(M,this.routerState,this.currentUrlTree,_,Z,le??null)}navigateByUrl(_,T={skipLocationChange:!1}){const M=Ho(_)?_:this.parseUrl(_),F=this.urlHandlingStrategy.merge(M,this.rawUrlTree);return this.scheduleNavigation(F,Li,null,T)}navigate(_,T={skipLocationChange:!1}){return function Ga(m){for(let y=0;y<m.length;y++){const _=m[y];if(null==_)throw new Y.vHH(4008,false)}}(_),this.navigateByUrl(this.createUrlTree(_,T),T)}serializeUrl(_){return this.urlSerializer.serialize(_)}parseUrl(_){let T;try{T=this.urlSerializer.parse(_)}catch(M){T=this.malformedUriErrorHandler(M,this.urlSerializer,_)}return T}isActive(_,T){let M;if(M=!0===T?{...Cu}:!1===T?{...yc}:T,Ho(_))return cr(this.currentUrlTree,_,M);const F=this.parseUrl(_);return cr(this.currentUrlTree,F,M)}removeEmptyProps(_){return Object.keys(_).reduce((T,M)=>{const F=_[M];return null!=F&&(T[M]=F),T},{})}scheduleNavigation(_,T,M,F,U){if(this.disposed)return Promise.resolve(!1);let K,ee,le,Z;return U?(K=U.resolve,ee=U.reject,le=U.promise):le=new Promise((ce,_e)=>{K=ce,ee=_e}),Z="computed"===this.canceledNavigationResolution?M&&M.\u0275routerPageId?M.\u0275routerPageId:(this.browserPageId??0)+1:0,this.navigationTransitions.handleNavigationRequest({targetPageId:Z,source:T,restoredState:M,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:_,extras:F,resolve:K,reject:ee,promise:le,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),le.catch(ce=>Promise.reject(ce))}setBrowserUrl(_,T){const M=this.urlSerializer.serialize(_);if(this.location.isCurrentPathEqualTo(M)||T.extras.replaceUrl){const U={...T.extras.state,...this.generateNgRouterState(T.id,this.browserPageId)};this.location.replaceState(M,"",U)}else{const F={...T.extras.state,...this.generateNgRouterState(T.id,T.targetPageId)};this.location.go(M,"",F)}}restoreHistory(_,T=!1){if("computed"===this.canceledNavigationResolution){const F=this.currentPageId-(this.browserPageId??this.currentPageId);0!==F?this.location.historyGo(F):this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===F&&(this.resetState(_),this.browserUrlTree=_.currentUrlTree,this.resetUrlToCurrentUrlTree())}else"replace"===this.canceledNavigationResolution&&(T&&this.resetState(_),this.resetUrlToCurrentUrlTree())}resetState(_){this.routerState=_.currentRouterState,this.currentUrlTree=_.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,_.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(_,T){return"computed"===this.canceledNavigationResolution?{navigationId:_,\u0275routerPageId:T}:{navigationId:_}}}return m.\u0275fac=function(_){return new(_||m)},m.\u0275prov=Y.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})(),Ll=(()=>{class m{constructor(_,T,M,F,U,K){this.router=_,this.route=T,this.tabIndexAttribute=M,this.renderer=F,this.el=U,this.locationStrategy=K,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.href=null,this.commands=null,this.onChanges=new Mt.x;const ee=U.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===ee||"area"===ee,this.isAnchorElement?this.subscription=_.events.subscribe(le=>{le instanceof Zr&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(_){this._preserveFragment=(0,Y.D6c)(_)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(_){this._skipLocationChange=(0,Y.D6c)(_)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(_){this._replaceUrl=(0,Y.D6c)(_)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(_){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",_)}ngOnChanges(_){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(_){null!=_?(this.commands=Array.isArray(_)?_:[_],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(_,T,M,F,U){return!!(null===this.urlTree||this.isAnchorElement&&(0!==_||T||M||F||U||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const _=null===this.href?null:(0,Y.P3R)(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",_)}applyAttributeValue(_,T){const M=this.renderer,F=this.el.nativeElement;null!==T?M.setAttribute(F,_,T):M.removeAttribute(F,_)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return m.\u0275fac=function(_){return new(_||m)(Y.Y36(Ts),Y.Y36(ro),Y.$8M("tabindex"),Y.Y36(Y.Qsj),Y.Y36(Y.SBq),Y.Y36(Bi.S$))},m.\u0275dir=Y.lG2({type:m,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(_,T){1&_&&Y.NdJ("click",function(F){return T.onClick(F.button,F.ctrlKey,F.shiftKey,F.altKey,F.metaKey)}),2&_&&Y.uIk("target",T.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[Y.TTD]}),m})();class qa{}let Wc=(()=>{class m{constructor(_,T,M,F,U){this.router=_,this.injector=M,this.preloadingStrategy=F,this.loader=U}setUpPreloading(){this.subscription=this.router.events.pipe((0,Ut.h)(_=>_ instanceof Zr),(0,Rn.b)(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(_,T){const M=[];for(const F of T){F.providers&&!F._injector&&(F._injector=(0,Y.MMx)(F.providers,_,`Route: ${F.path}`));const U=F._injector??_,K=F._loadedInjector??U;(F.loadChildren&&!F._loadedRoutes&&void 0===F.canLoad||F.loadComponent&&!F._loadedComponent)&&M.push(this.preloadConfig(U,F)),(F.children||F._loadedRoutes)&&M.push(this.processRoutes(K,F.children??F._loadedRoutes))}return(0,W.D)(M).pipe((0,pn.J)())}preloadConfig(_,T){return this.preloadingStrategy.preload(T,()=>{let M;M=T.loadChildren&&void 0===T.canLoad?this.loader.loadChildren(_,T):(0,Xe.of)(null);const F=M.pipe((0,Ot.z)(U=>null===U?(0,Xe.of)(void 0):(T._loadedRoutes=U.routes,T._loadedInjector=U.injector,this.processRoutes(U.injector??_,U.routes))));if(T.loadComponent&&!T._loadedComponent){const U=this.loader.loadComponent(T);return(0,W.D)([F,U]).pipe((0,pn.J)())}return F})}}return m.\u0275fac=function(_){return new(_||m)(Y.LFG(Ts),Y.LFG(Y.Sil),Y.LFG(Y.lqb),Y.LFG(qa),Y.LFG(Ja))},m.\u0275prov=Y.Yz7({token:m,factory:m.\u0275fac,providedIn:"root"}),m})();const so=new Y.OlP("");let Mu=(()=>{class m{constructor(_,T,M,F,U={}){this.urlSerializer=_,this.transitions=T,this.viewportScroller=M,this.zone=F,this.options=U,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},U.scrollPositionRestoration=U.scrollPositionRestoration||"disabled",U.anchorScrolling=U.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(_=>{_ instanceof co?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=_.navigationTrigger,this.restoredId=_.restoredState?_.restoredState.navigationId:0):_ instanceof Zr&&(this.lastId=_.id,this.scheduleScrollEvent(_,this.urlSerializer.parse(_.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(_=>{_ instanceof no&&(_.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(_.position):_.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(_.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(_,T){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new no(_,"popstate"===this.lastSource?this.store[this.restoredId]:null,T))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return m.\u0275fac=function(_){Y.$Z()},m.\u0275prov=Y.Yz7({token:m,factory:m.\u0275fac}),m})();var Rs=(()=>((Rs=Rs||{})[Rs.COMPLETE=0]="COMPLETE",Rs[Rs.FAILED=1]="FAILED",Rs[Rs.REDIRECTING=2]="REDIRECTING",Rs))();const Ol=!1;function sa(m,y){return{\u0275kind:m,\u0275providers:y}}const ns=new Y.OlP("",{providedIn:"root",factory:()=>!1});function wn(){const m=(0,Y.f3M)(Y.zs3);return y=>{const _=m.get(Y.z2F);if(y!==_.components[0])return;const T=m.get(Ts),M=m.get(Xc);1===m.get(ic)&&T.initialNavigation(),m.get(Kc,null,Y.XFs.Optional)?.setUpPreloading(),m.get(so,null,Y.XFs.Optional)?.init(),T.resetRootComponentType(_.componentTypes[0]),M.closed||(M.next(),M.complete(),M.unsubscribe())}}const Xc=new Y.OlP(Ol?"bootstrap done indicator":"",{factory:()=>new Mt.x}),ic=new Y.OlP(Ol?"initial navigation":"",{providedIn:"root",factory:()=>1});function vn(){let m=[];return m=Ol?[{provide:Y.Xts,multi:!0,useFactory:()=>{const y=(0,Y.f3M)(Ts);return()=>y.events.subscribe(_=>{console.group?.(`Router Event: ${_.constructor.name}`),console.log(function Ei(m){if(!("type"in m))return`Unknown Router Event: ${m.constructor.name}`;switch(m.type){case 14:return`ActivationEnd(path: '${m.snapshot.routeConfig?.path||""}')`;case 13:return`ActivationStart(path: '${m.snapshot.routeConfig?.path||""}')`;case 12:return`ChildActivationEnd(path: '${m.snapshot.routeConfig?.path||""}')`;case 11:return`ChildActivationStart(path: '${m.snapshot.routeConfig?.path||""}')`;case 8:return`GuardsCheckEnd(id: ${m.id}, url: '${m.url}', urlAfterRedirects: '${m.urlAfterRedirects}', state: ${m.state}, shouldActivate: ${m.shouldActivate})`;case 7:return`GuardsCheckStart(id: ${m.id}, url: '${m.url}', urlAfterRedirects: '${m.urlAfterRedirects}', state: ${m.state})`;case 2:return`NavigationCancel(id: ${m.id}, url: '${m.url}')`;case 16:return`NavigationSkipped(id: ${m.id}, url: '${m.url}')`;case 1:return`NavigationEnd(id: ${m.id}, url: '${m.url}', urlAfterRedirects: '${m.urlAfterRedirects}')`;case 3:return`NavigationError(id: ${m.id}, url: '${m.url}', error: ${m.error})`;case 0:return`NavigationStart(id: ${m.id}, url: '${m.url}')`;case 6:return`ResolveEnd(id: ${m.id}, url: '${m.url}', urlAfterRedirects: '${m.urlAfterRedirects}', state: ${m.state})`;case 5:return`ResolveStart(id: ${m.id}, url: '${m.url}', urlAfterRedirects: '${m.urlAfterRedirects}', state: ${m.state})`;case 10:return`RouteConfigLoadEnd(path: ${m.route.path})`;case 9:return`RouteConfigLoadStart(path: ${m.route.path})`;case 4:return`RoutesRecognized(id: ${m.id}, url: '${m.url}', urlAfterRedirects: '${m.urlAfterRedirects}', state: ${m.state})`;case 15:return`Scroll(anchor: '${m.anchor}', position: '${m.position?`${m.position[0]}, ${m.position[1]}`:null}')`}}(_)),console.log(_),console.groupEnd?.()})}}]:[],sa(1,m)}const Kc=new Y.OlP(Ol?"router preloader":"");function ad(m){return sa(0,[{provide:Kc,useExisting:Wc},{provide:qa,useExisting:m}])}const Na=!1,ph=new Y.OlP(Na?"router duplicate forRoot guard":"ROUTER_FORROOT_GUARD"),wo=[Bi.Ye,{provide:Ye,useClass:ut},Ts,Ms,{provide:ro,useFactory:function tc(m){return m.routerState.root},deps:[Ts]},Ja,Na?{provide:ns,useValue:!0}:[]];function rc(){return new Y.PXZ("Router",Ts)}let vl=(()=>{class m{constructor(_){}static forRoot(_,T){return{ngModule:m,providers:[wo,Na&&T?.enableTracing?vn().\u0275providers:[],{provide:kr,multi:!0,useValue:_},{provide:ph,useFactory:l,deps:[[Ts,new Y.FiY,new Y.tp0]]},{provide:Pl,useValue:T||{}},T?.useHash?{provide:Bi.S$,useClass:Bi.Do}:{provide:Bi.S$,useClass:Bi.b0},{provide:so,useFactory:()=>{const m=(0,Y.f3M)(Bi.EM),y=(0,Y.f3M)(Y.R0b),_=(0,Y.f3M)(Pl),T=(0,Y.f3M)(Qa),M=(0,Y.f3M)(Ye);return _.scrollOffset&&m.setOffset(_.scrollOffset),new Mu(M,T,m,y,_)}},T?.preloadingStrategy?ad(T.preloadingStrategy).\u0275providers:[],{provide:Y.PXZ,multi:!0,useFactory:rc},T?.initialNavigation?p(T):[],[{provide:w,useFactory:wn},{provide:Y.tb,multi:!0,useExisting:w}]]}}static forChild(_){return{ngModule:m,providers:[{provide:kr,multi:!0,useValue:_}]}}}return m.\u0275fac=function(_){return new(_||m)(Y.LFG(ph,8))},m.\u0275mod=Y.oAB({type:m}),m.\u0275inj=Y.cJS({imports:[Oo]}),m})();function l(m){if(Na&&m)throw new Y.vHH(4007,"The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function p(m){return["disabled"===m.initialNavigation?sa(3,[{provide:Y.ip1,multi:!0,useFactory:()=>{const y=(0,Y.f3M)(Ts);return()=>{y.setUpLocationChangeListener()}}},{provide:ic,useValue:2}]).\u0275providers:[],"enabledBlocking"===m.initialNavigation?sa(2,[{provide:ic,useValue:0},{provide:Y.ip1,multi:!0,deps:[Y.zs3],useFactory:y=>{const _=y.get(Bi.V_,Promise.resolve());return()=>_.then(()=>new Promise(T=>{const M=y.get(Ts),F=y.get(Xc);(function Zc(m,y){m.events.pipe((0,Ut.h)(_=>_ instanceof Zr||_ instanceof Xo||_ instanceof Xi||_ instanceof fr),(0,qe.U)(_=>_ instanceof Zr||_ instanceof fr?Rs.COMPLETE:_ instanceof Xo&&(0===_.code||1===_.code)?Rs.REDIRECTING:Rs.FAILED),(0,Ut.h)(_=>_!==Rs.REDIRECTING),bt(1)).subscribe(()=>{y()})})(M,()=>{T(!0)}),y.get(Qa).afterPreactivation=()=>(T(!0),F.closed?(0,Xe.of)(void 0):F),M.initialNavigation()}))}}]).\u0275providers:[]]}const w=new Y.OlP(Na?"Router Initializer":"")}},ii=>{ii(ii.s=8697)}]);
