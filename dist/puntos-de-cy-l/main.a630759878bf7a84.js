(self.webpackChunkPuntos_de_CyL=self.webpackChunkPuntos_de_CyL||[]).push([[179],{2340:(Yn,At,we)=>{"use strict";we.d(At,{N:()=>W});const W={mapboxToken:"pk.eyJ1IjoianVuY2EyMzUiLCJhIjoiY2xmdjBpa2VnMDJrYzNrbzMwMmEyOXlmZiJ9.GJ8cigJUn2cUWxd_Wx_5VQ",mongoUrl:"http://puntos-recarga-cyl-production.up.railway.app/api",jcylUrl:"https://analisis.datosabiertos.jcyl.es/api/records/1.0/search/?dataset=puntos-de-recarga-del-vehiculo-electrico&rows=123"}},4066:(Yn,At,we)=>{"use strict";var W=we(1481),_e=we(1571),$e=we(7340);function Ie(Q){return new _e.vHH(3e3,!1)}function In(){return typeof window<"u"&&typeof window.document<"u"}function cn(){return typeof process<"u"&&"[object process]"==={}.toString.call(process)}function pr(Q){switch(Q.length){case 0:return new $e.ZN;case 1:return Q[0];default:return new $e.ZE(Q)}}function vr(Q,M,P,j,te=new Map,ge=new Map){const Oe=[],ze=[];let et=-1,xt=null;if(j.forEach(gn=>{const _n=gn.get("offset"),cr=_n==et,ur=cr&&xt||new Map;gn.forEach((Un,Zn)=>{let fr=Zn,Fr=Un;if("offset"!==Zn)switch(fr=M.normalizePropertyName(fr,Oe),Fr){case $e.k1:Fr=te.get(Zn);break;case $e.l3:Fr=ge.get(Zn);break;default:Fr=M.normalizeStyleValue(Zn,fr,Fr,Oe)}ur.set(fr,Fr)}),cr||ze.push(ur),xt=ur,et=_n}),Oe.length)throw function an(Q){return new _e.vHH(3502,!1)}();return ze}function si(Q,M,P,j){switch(M){case"start":Q.onStart(()=>j(P&&bn(P,"start",Q)));break;case"done":Q.onDone(()=>j(P&&bn(P,"done",Q)));break;case"destroy":Q.onDestroy(()=>j(P&&bn(P,"destroy",Q)))}}function bn(Q,M,P){const ge=ni(Q.element,Q.triggerName,Q.fromState,Q.toState,M||Q.phaseName,P.totalTime??Q.totalTime,!!P.disabled),Oe=Q._data;return null!=Oe&&(ge._data=Oe),ge}function ni(Q,M,P,j,te="",ge=0,Oe){return{element:Q,triggerName:M,fromState:P,toState:j,phaseName:te,totalTime:ge,disabled:!!Oe}}function wr(Q,M,P){let j=Q.get(M);return j||Q.set(M,j=P),j}function Yi(Q){const M=Q.indexOf(":");return[Q.substring(1,M),Q.slice(M+1)]}let yi=(Q,M)=>!1,Xr=(Q,M,P)=>[],Pn=null;function jr(Q){const M=Q.parentNode||Q.host;return M===Pn?null:M}(cn()||typeof Element<"u")&&(In()?(Pn=(()=>document.documentElement)(),yi=(Q,M)=>{for(;M;){if(M===Q)return!0;M=jr(M)}return!1}):yi=(Q,M)=>Q.contains(M),Xr=(Q,M,P)=>{if(P)return Array.from(Q.querySelectorAll(M));const j=Q.querySelector(M);return j?[j]:[]});let Pi=null,So=!1;const Mr=yi,on=Xr;let vi=(()=>{class Q{validateStyleProperty(P){return function Vn(Q){Pi||(Pi=function Ri(){return typeof document<"u"?document.body:null}()||{},So=!!Pi.style&&"WebkitAppearance"in Pi.style);let M=!0;return Pi.style&&!function ri(Q){return"ebkit"==Q.substring(1,6)}(Q)&&(M=Q in Pi.style,!M&&So&&(M="Webkit"+Q.charAt(0).toUpperCase()+Q.slice(1)in Pi.style)),M}(P)}matchesElement(P,j){return!1}containsElement(P,j){return Mr(P,j)}getParentElement(P){return jr(P)}query(P,j,te){return on(P,j,te)}computeStyle(P,j,te){return te||""}animate(P,j,te,ge,Oe,ze=[],et){return new $e.ZN(te,ge)}}return Q.\u0275fac=function(P){return new(P||Q)},Q.\u0275prov=_e.Yz7({token:Q,factory:Q.\u0275fac}),Q})(),dr=(()=>{class Q{}return Q.NOOP=new vi,Q})();const Nr=1e3,oo="ng-enter",Dr="ng-leave",po="ng-trigger",gr=".ng-trigger",so="ng-animating",kn=".ng-animating";function xi(Q){if("number"==typeof Q)return Q;const M=Q.match(/^(-?[\.\d]+)(m?s)/);return!M||M.length<2?0:$n(parseFloat(M[1]),M[2])}function $n(Q,M){return"s"===M?Q*Nr:Q}function pt(Q,M,P){return Q.hasOwnProperty("duration")?Q:function Fe(Q,M,P){let te,ge=0,Oe="";if("string"==typeof Q){const ze=Q.match(/^(-?[\.\d]+)(m?s)(?:\s+(-?[\.\d]+)(m?s))?(?:\s+([-a-z]+(?:\(.+?\))?))?$/i);if(null===ze)return M.push(Ie()),{duration:0,delay:0,easing:""};te=$n(parseFloat(ze[1]),ze[2]);const et=ze[3];null!=et&&(ge=$n(parseFloat(et),ze[4]));const xt=ze[5];xt&&(Oe=xt)}else te=Q;if(!P){let ze=!1,et=M.length;te<0&&(M.push(function Kt(){return new _e.vHH(3100,!1)}()),ze=!0),ge<0&&(M.push(function Ut(){return new _e.vHH(3101,!1)}()),ze=!0),ze&&M.splice(et,0,Ie())}return{duration:te,delay:ge,easing:Oe}}(Q,M,P)}function Re(Q,M={}){return Object.keys(Q).forEach(P=>{M[P]=Q[P]}),M}function Wt(Q){const M=new Map;return Object.keys(Q).forEach(P=>{M.set(P,Q[P])}),M}function ue(Q,M=new Map,P){if(P)for(let[j,te]of P)M.set(j,te);for(let[j,te]of Q)M.set(j,te);return M}function H(Q,M,P){return P?M+":"+P+";":""}function K(Q){let M="";for(let P=0;P<Q.style.length;P++){const j=Q.style.item(P);M+=H(0,j,Q.style.getPropertyValue(j))}for(const P in Q.style)Q.style.hasOwnProperty(P)&&!P.startsWith("_")&&(M+=H(0,sn(P),Q.style[P]));Q.setAttribute("style",M)}function de(Q,M,P){Q.style&&(M.forEach((j,te)=>{const ge=ut(te);P&&!P.has(te)&&P.set(te,Q.style[ge]),Q.style[ge]=j}),cn()&&K(Q))}function Ee(Q,M){Q.style&&(M.forEach((P,j)=>{const te=ut(j);Q.style[te]=""}),cn()&&K(Q))}function ne(Q){return Array.isArray(Q)?1==Q.length?Q[0]:(0,$e.vP)(Q):Q}const q=new RegExp("{{\\s*(.+?)\\s*}}","g");function re(Q){let M=[];if("string"==typeof Q){let P;for(;P=q.exec(Q);)M.push(P[1]);q.lastIndex=0}return M}function pe(Q,M,P){const j=Q.toString(),te=j.replace(q,(ge,Oe)=>{let ze=M[Oe];return null==ze&&(P.push(function gt(Q){return new _e.vHH(3003,!1)}()),ze=""),ze.toString()});return te==j?Q:te}function je(Q){const M=[];let P=Q.next();for(;!P.done;)M.push(P.value),P=Q.next();return M}const ht=/-+([a-z0-9])/g;function ut(Q){return Q.replace(ht,(...M)=>M[1].toUpperCase())}function sn(Q){return Q.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase()}function xn(Q,M,P){switch(M.type){case 7:return Q.visitTrigger(M,P);case 0:return Q.visitState(M,P);case 1:return Q.visitTransition(M,P);case 2:return Q.visitSequence(M,P);case 3:return Q.visitGroup(M,P);case 4:return Q.visitAnimate(M,P);case 5:return Q.visitKeyframes(M,P);case 6:return Q.visitStyle(M,P);case 8:return Q.visitReference(M,P);case 9:return Q.visitAnimateChild(M,P);case 10:return Q.visitAnimateRef(M,P);case 11:return Q.visitQuery(M,P);case 12:return Q.visitStagger(M,P);default:throw function nt(Q){return new _e.vHH(3004,!1)}()}}function rr(Q,M){return window.getComputedStyle(Q)[M]}const $r="*";function qn(Q,M){const P=[];return"string"==typeof Q?Q.split(/\s*,\s*/).forEach(j=>function wi(Q,M,P){if(":"==Q[0]){const et=function Bi(Q,M){switch(Q){case":enter":return"void => *";case":leave":return"* => void";case":increment":return(P,j)=>parseFloat(j)>parseFloat(P);case":decrement":return(P,j)=>parseFloat(j)<parseFloat(P);default:return M.push(function Ue(Q){return new _e.vHH(3016,!1)}()),"* => *"}}(Q,P);if("function"==typeof et)return void M.push(et);Q=et}const j=Q.match(/^(\*|[-\w]+)\s*(<?[=-]>)\s*(\*|[-\w]+)$/);if(null==j||j.length<4)return P.push(function ln(Q){return new _e.vHH(3015,!1)}()),M;const te=j[1],ge=j[2],Oe=j[3];M.push(Ks(te,Oe));"<"==ge[0]&&!(te==$r&&Oe==$r)&&M.push(Ks(Oe,te))}(j,P,M)):P.push(Q),P}const ai=new Set(["true","1"]),Gr=new Set(["false","0"]);function Ks(Q,M){const P=ai.has(Q)||Gr.has(Q),j=ai.has(M)||Gr.has(M);return(te,ge)=>{let Oe=Q==$r||Q==te,ze=M==$r||M==ge;return!Oe&&P&&"boolean"==typeof te&&(Oe=te?ai.has(Q):Gr.has(Q)),!ze&&j&&"boolean"==typeof ge&&(ze=ge?ai.has(M):Gr.has(M)),Oe&&ze}}const Zt=new RegExp("s*:selfs*,?","g");function On(Q,M,P,j){return new Gn(Q).build(M,P,j)}class Gn{constructor(M){this._driver=M}build(M,P,j){const te=new mo(P);return this._resetContextStyleTimingState(te),xn(this,ne(M),te)}_resetContextStyleTimingState(M){M.currentQuerySelector="",M.collectedStyles=new Map,M.collectedStyles.set("",new Map),M.currentTime=0}visitTrigger(M,P){let j=P.queryCount=0,te=P.depCount=0;const ge=[],Oe=[];return"@"==M.name.charAt(0)&&P.errors.push(function Et(){return new _e.vHH(3006,!1)}()),M.definitions.forEach(ze=>{if(this._resetContextStyleTimingState(P),0==ze.type){const et=ze,xt=et.name;xt.toString().split(/\s*,\s*/).forEach(gn=>{et.name=gn,ge.push(this.visitState(et,P))}),et.name=xt}else if(1==ze.type){const et=this.visitTransition(ze,P);j+=et.queryCount,te+=et.depCount,Oe.push(et)}else P.errors.push(function jn(){return new _e.vHH(3007,!1)}())}),{type:7,name:M.name,states:ge,transitions:Oe,queryCount:j,depCount:te,options:null}}visitState(M,P){const j=this.visitStyle(M.styles,P),te=M.options&&M.options.params||null;if(j.containsDynamicStyles){const ge=new Set,Oe=te||{};j.styles.forEach(ze=>{ze instanceof Map&&ze.forEach(et=>{re(et).forEach(xt=>{Oe.hasOwnProperty(xt)||ge.add(xt)})})}),ge.size&&(je(ge.values()),P.errors.push(function Jt(Q,M){return new _e.vHH(3008,!1)}()))}return{type:0,name:M.name,style:j,options:te?{params:te}:null}}visitTransition(M,P){P.queryCount=0,P.depCount=0;const j=xn(this,ne(M.animation),P);return{type:1,matchers:qn(M.expr,P.errors),animation:j,queryCount:P.queryCount,depCount:P.depCount,options:ir(M.options)}}visitSequence(M,P){return{type:2,steps:M.steps.map(j=>xn(this,j,P)),options:ir(M.options)}}visitGroup(M,P){const j=P.currentTime;let te=0;const ge=M.steps.map(Oe=>{P.currentTime=j;const ze=xn(this,Oe,P);return te=Math.max(te,P.currentTime),ze});return P.currentTime=te,{type:3,steps:ge,options:ir(M.options)}}visitAnimate(M,P){const j=function Mo(Q,M){if(Q.hasOwnProperty("duration"))return Q;if("number"==typeof Q)return Cr(pt(Q,M).duration,0,"");const P=Q;if(P.split(/\s+/).some(ge=>"{"==ge.charAt(0)&&"{"==ge.charAt(1))){const ge=Cr(0,0,"");return ge.dynamic=!0,ge.strValue=P,ge}const te=pt(P,M);return Cr(te.duration,te.delay,te.easing)}(M.timings,P.errors);P.currentAnimateTimings=j;let te,ge=M.styles?M.styles:(0,$e.oB)({});if(5==ge.type)te=this.visitKeyframes(ge,P);else{let Oe=M.styles,ze=!1;if(!Oe){ze=!0;const xt={};j.easing&&(xt.easing=j.easing),Oe=(0,$e.oB)(xt)}P.currentTime+=j.duration+j.delay;const et=this.visitStyle(Oe,P);et.isEmptyStep=ze,te=et}return P.currentAnimateTimings=null,{type:4,timings:j,style:te,options:null}}visitStyle(M,P){const j=this._makeStyleAst(M,P);return this._validateStyleAst(j,P),j}_makeStyleAst(M,P){const j=[],te=Array.isArray(M.styles)?M.styles:[M.styles];for(let ze of te)"string"==typeof ze?ze===$e.l3?j.push(ze):P.errors.push(new _e.vHH(3002,!1)):j.push(Wt(ze));let ge=!1,Oe=null;return j.forEach(ze=>{if(ze instanceof Map&&(ze.has("easing")&&(Oe=ze.get("easing"),ze.delete("easing")),!ge))for(let et of ze.values())if(et.toString().indexOf("{{")>=0){ge=!0;break}}),{type:6,styles:j,easing:Oe,offset:M.offset,containsDynamicStyles:ge,options:null}}_validateStyleAst(M,P){const j=P.currentAnimateTimings;let te=P.currentTime,ge=P.currentTime;j&&ge>0&&(ge-=j.duration+j.delay),M.styles.forEach(Oe=>{"string"!=typeof Oe&&Oe.forEach((ze,et)=>{const xt=P.collectedStyles.get(P.currentQuerySelector),gn=xt.get(et);let _n=!0;gn&&(ge!=te&&ge>=gn.startTime&&te<=gn.endTime&&(P.errors.push(function tr(Q,M,P,j,te){return new _e.vHH(3010,!1)}()),_n=!1),ge=gn.startTime),_n&&xt.set(et,{startTime:ge,endTime:te}),P.options&&function ie(Q,M,P){const j=M.params||{},te=re(Q);te.length&&te.forEach(ge=>{j.hasOwnProperty(ge)||P.push(function bt(Q){return new _e.vHH(3001,!1)}())})}(ze,P.options,P.errors)})})}visitKeyframes(M,P){const j={type:5,styles:[],options:null};if(!P.currentAnimateTimings)return P.errors.push(function dt(){return new _e.vHH(3011,!1)}()),j;let ge=0;const Oe=[];let ze=!1,et=!1,xt=0;const gn=M.steps.map(Fr=>{const oi=this._makeStyleAst(Fr,P);let Rr=null!=oi.offset?oi.offset:function Jr(Q){if("string"==typeof Q)return null;let M=null;if(Array.isArray(Q))Q.forEach(P=>{if(P instanceof Map&&P.has("offset")){const j=P;M=parseFloat(j.get("offset")),j.delete("offset")}});else if(Q instanceof Map&&Q.has("offset")){const P=Q;M=parseFloat(P.get("offset")),P.delete("offset")}return M}(oi.styles),Kr=0;return null!=Rr&&(ge++,Kr=oi.offset=Rr),et=et||Kr<0||Kr>1,ze=ze||Kr<xt,xt=Kr,Oe.push(Kr),oi});et&&P.errors.push(function Lr(){return new _e.vHH(3012,!1)}()),ze&&P.errors.push(function Zr(){return new _e.vHH(3200,!1)}());const _n=M.steps.length;let cr=0;ge>0&&ge<_n?P.errors.push(function Je(){return new _e.vHH(3202,!1)}()):0==ge&&(cr=1/(_n-1));const ur=_n-1,Un=P.currentTime,Zn=P.currentAnimateTimings,fr=Zn.duration;return gn.forEach((Fr,oi)=>{const Rr=cr>0?oi==ur?1:cr*oi:Oe[oi],Kr=Rr*fr;P.currentTime=Un+Zn.delay+Kr,Zn.duration=Kr,this._validateStyleAst(Fr,P),Fr.offset=Rr,j.styles.push(Fr)}),j}visitReference(M,P){return{type:8,animation:xn(this,ne(M.animation),P),options:ir(M.options)}}visitAnimateChild(M,P){return P.depCount++,{type:9,options:ir(M.options)}}visitAnimateRef(M,P){return{type:10,animation:this.visitReference(M.animation,P),options:ir(M.options)}}visitQuery(M,P){const j=P.currentQuerySelector,te=M.options||{};P.queryCount++,P.currentQuery=M;const[ge,Oe]=function Ur(Q){const M=!!Q.split(/\s*,\s*/).find(P=>":self"==P);return M&&(Q=Q.replace(Zt,"")),Q=Q.replace(/@\*/g,gr).replace(/@\w+/g,P=>gr+"-"+P.slice(1)).replace(/:animating/g,kn),[Q,M]}(M.selector);P.currentQuerySelector=j.length?j+" "+ge:ge,wr(P.collectedStyles,P.currentQuerySelector,new Map);const ze=xn(this,ne(M.animation),P);return P.currentQuery=null,P.currentQuerySelector=j,{type:11,selector:ge,limit:te.limit||0,optional:!!te.optional,includeSelf:Oe,animation:ze,originalSelector:M.selector,options:ir(M.options)}}visitStagger(M,P){P.currentQuery||P.errors.push(function Ne(){return new _e.vHH(3013,!1)}());const j="full"===M.timings?{duration:0,delay:0,easing:"full"}:pt(M.timings,P.errors,!0);return{type:12,animation:xn(this,ne(M.animation),P),timings:j,options:null}}}class mo{constructor(M){this.errors=M,this.queryCount=0,this.depCount=0,this.currentTransition=null,this.currentQuery=null,this.currentQuerySelector=null,this.currentAnimateTimings=null,this.currentTime=0,this.collectedStyles=new Map,this.options=null,this.unsupportedCSSPropertiesFound=new Set}}function ir(Q){return Q?(Q=Re(Q)).params&&(Q.params=function Nn(Q){return Q?Re(Q):null}(Q.params)):Q={},Q}function Cr(Q,M,P){return{duration:Q,delay:M,easing:P}}function os(Q,M,P,j,te,ge,Oe=null,ze=!1){return{type:1,element:Q,keyframes:M,preStyleProps:P,postStyleProps:j,duration:te,delay:ge,totalTime:te+ge,easing:Oe,subTimeline:ze}}class An{constructor(){this._map=new Map}get(M){return this._map.get(M)||[]}append(M,P){let j=this._map.get(M);j||this._map.set(M,j=[]),j.push(...P)}has(M){return this._map.has(M)}clear(){this._map.clear()}}const Bs=new RegExp(":enter","g"),li=new RegExp(":leave","g");function ao(Q,M,P,j,te,ge=new Map,Oe=new Map,ze,et,xt=[]){return(new hi).buildKeyframes(Q,M,P,j,te,ge,Oe,ze,et,xt)}class hi{buildKeyframes(M,P,j,te,ge,Oe,ze,et,xt,gn=[]){xt=xt||new An;const _n=new Li(M,P,xt,te,ge,gn,[]);_n.options=et;const cr=et.delay?xi(et.delay):0;_n.currentTimeline.delayNextStep(cr),_n.currentTimeline.setStyles([Oe],null,_n.errors,et),xn(this,j,_n);const ur=_n.timelines.filter(Un=>Un.containsAnimation());if(ur.length&&ze.size){let Un;for(let Zn=ur.length-1;Zn>=0;Zn--){const fr=ur[Zn];if(fr.element===P){Un=fr;break}}Un&&!Un.allowOnlyTimelineStyles()&&Un.setStyles([ze],null,_n.errors,et)}return ur.length?ur.map(Un=>Un.buildKeyframes()):[os(P,[],[],[],0,cr,"",!1)]}visitTrigger(M,P){}visitState(M,P){}visitTransition(M,P){}visitAnimateChild(M,P){const j=P.subInstructions.get(P.element);if(j){const te=P.createSubContext(M.options),ge=P.currentTimeline.currentTime,Oe=this._visitSubInstructions(j,te,te.options);ge!=Oe&&P.transformIntoNewTimeline(Oe)}P.previousNode=M}visitAnimateRef(M,P){const j=P.createSubContext(M.options);j.transformIntoNewTimeline(),this._applyAnimationRefDelays([M.options,M.animation.options],P,j),this.visitReference(M.animation,j),P.transformIntoNewTimeline(j.currentTimeline.currentTime),P.previousNode=M}_applyAnimationRefDelays(M,P,j){for(const te of M){const ge=te?.delay;if(ge){const Oe="number"==typeof ge?ge:xi(pe(ge,te?.params??{},P.errors));j.delayNextStep(Oe)}}}_visitSubInstructions(M,P,j){let ge=P.currentTimeline.currentTime;const Oe=null!=j.duration?xi(j.duration):null,ze=null!=j.delay?xi(j.delay):null;return 0!==Oe&&M.forEach(et=>{const xt=P.appendInstructionToTimeline(et,Oe,ze);ge=Math.max(ge,xt.duration+xt.delay)}),ge}visitReference(M,P){P.updateOptions(M.options,!0),xn(this,M.animation,P),P.previousNode=M}visitSequence(M,P){const j=P.subContextCount;let te=P;const ge=M.options;if(ge&&(ge.params||ge.delay)&&(te=P.createSubContext(ge),te.transformIntoNewTimeline(),null!=ge.delay)){6==te.previousNode.type&&(te.currentTimeline.snapshotCurrentStyles(),te.previousNode=lo);const Oe=xi(ge.delay);te.delayNextStep(Oe)}M.steps.length&&(M.steps.forEach(Oe=>xn(this,Oe,te)),te.currentTimeline.applyStylesToKeyframe(),te.subContextCount>j&&te.transformIntoNewTimeline()),P.previousNode=M}visitGroup(M,P){const j=[];let te=P.currentTimeline.currentTime;const ge=M.options&&M.options.delay?xi(M.options.delay):0;M.steps.forEach(Oe=>{const ze=P.createSubContext(M.options);ge&&ze.delayNextStep(ge),xn(this,Oe,ze),te=Math.max(te,ze.currentTimeline.currentTime),j.push(ze.currentTimeline)}),j.forEach(Oe=>P.currentTimeline.mergeTimelineCollectedStyles(Oe)),P.transformIntoNewTimeline(te),P.previousNode=M}_visitTiming(M,P){if(M.dynamic){const j=M.strValue;return pt(P.params?pe(j,P.params,P.errors):j,P.errors)}return{duration:M.duration,delay:M.delay,easing:M.easing}}visitAnimate(M,P){const j=P.currentAnimateTimings=this._visitTiming(M.timings,P),te=P.currentTimeline;j.delay&&(P.incrementTime(j.delay),te.snapshotCurrentStyles());const ge=M.style;5==ge.type?this.visitKeyframes(ge,P):(P.incrementTime(j.duration),this.visitStyle(ge,P),te.applyStylesToKeyframe()),P.currentAnimateTimings=null,P.previousNode=M}visitStyle(M,P){const j=P.currentTimeline,te=P.currentAnimateTimings;!te&&j.hasCurrentStyleProperties()&&j.forwardFrame();const ge=te&&te.easing||M.easing;M.isEmptyStep?j.applyEmptyStep(ge):j.setStyles(M.styles,ge,P.errors,P.options),P.previousNode=M}visitKeyframes(M,P){const j=P.currentAnimateTimings,te=P.currentTimeline.duration,ge=j.duration,ze=P.createSubContext().currentTimeline;ze.easing=j.easing,M.styles.forEach(et=>{ze.forwardTime((et.offset||0)*ge),ze.setStyles(et.styles,et.easing,P.errors,P.options),ze.applyStylesToKeyframe()}),P.currentTimeline.mergeTimelineCollectedStyles(ze),P.transformIntoNewTimeline(te+ge),P.previousNode=M}visitQuery(M,P){const j=P.currentTimeline.currentTime,te=M.options||{},ge=te.delay?xi(te.delay):0;ge&&(6===P.previousNode.type||0==j&&P.currentTimeline.hasCurrentStyleProperties())&&(P.currentTimeline.snapshotCurrentStyles(),P.previousNode=lo);let Oe=j;const ze=P.invokeQuery(M.selector,M.originalSelector,M.limit,M.includeSelf,!!te.optional,P.errors);P.currentQueryTotal=ze.length;let et=null;ze.forEach((xt,gn)=>{P.currentQueryIndex=gn;const _n=P.createSubContext(M.options,xt);ge&&_n.delayNextStep(ge),xt===P.element&&(et=_n.currentTimeline),xn(this,M.animation,_n),_n.currentTimeline.applyStylesToKeyframe(),Oe=Math.max(Oe,_n.currentTimeline.currentTime)}),P.currentQueryIndex=0,P.currentQueryTotal=0,P.transformIntoNewTimeline(Oe),et&&(P.currentTimeline.mergeTimelineCollectedStyles(et),P.currentTimeline.snapshotCurrentStyles()),P.previousNode=M}visitStagger(M,P){const j=P.parentContext,te=P.currentTimeline,ge=M.timings,Oe=Math.abs(ge.duration),ze=Oe*(P.currentQueryTotal-1);let et=Oe*P.currentQueryIndex;switch(ge.duration<0?"reverse":ge.easing){case"reverse":et=ze-et;break;case"full":et=j.currentStaggerTime}const gn=P.currentTimeline;et&&gn.delayNextStep(et);const _n=gn.currentTime;xn(this,M.animation,P),P.previousNode=M,j.currentStaggerTime=te.currentTime-_n+(te.startTime-j.currentTimeline.startTime)}}const lo={};class Li{constructor(M,P,j,te,ge,Oe,ze,et){this._driver=M,this.element=P,this.subInstructions=j,this._enterClassName=te,this._leaveClassName=ge,this.errors=Oe,this.timelines=ze,this.parentContext=null,this.currentAnimateTimings=null,this.previousNode=lo,this.subContextCount=0,this.options={},this.currentQueryIndex=0,this.currentQueryTotal=0,this.currentStaggerTime=0,this.currentTimeline=et||new Qr(this._driver,P,0),ze.push(this.currentTimeline)}get params(){return this.options.params}updateOptions(M,P){if(!M)return;const j=M;let te=this.options;null!=j.duration&&(te.duration=xi(j.duration)),null!=j.delay&&(te.delay=xi(j.delay));const ge=j.params;if(ge){let Oe=te.params;Oe||(Oe=this.options.params={}),Object.keys(ge).forEach(ze=>{(!P||!Oe.hasOwnProperty(ze))&&(Oe[ze]=pe(ge[ze],Oe,this.errors))})}}_copyOptions(){const M={};if(this.options){const P=this.options.params;if(P){const j=M.params={};Object.keys(P).forEach(te=>{j[te]=P[te]})}}return M}createSubContext(M=null,P,j){const te=P||this.element,ge=new Li(this._driver,te,this.subInstructions,this._enterClassName,this._leaveClassName,this.errors,this.timelines,this.currentTimeline.fork(te,j||0));return ge.previousNode=this.previousNode,ge.currentAnimateTimings=this.currentAnimateTimings,ge.options=this._copyOptions(),ge.updateOptions(M),ge.currentQueryIndex=this.currentQueryIndex,ge.currentQueryTotal=this.currentQueryTotal,ge.parentContext=this,this.subContextCount++,ge}transformIntoNewTimeline(M){return this.previousNode=lo,this.currentTimeline=this.currentTimeline.fork(this.element,M),this.timelines.push(this.currentTimeline),this.currentTimeline}appendInstructionToTimeline(M,P,j){const te={duration:P??M.duration,delay:this.currentTimeline.currentTime+(j??0)+M.delay,easing:""},ge=new Hr(this._driver,M.element,M.keyframes,M.preStyleProps,M.postStyleProps,te,M.stretchStartingKeyframe);return this.timelines.push(ge),te}incrementTime(M){this.currentTimeline.forwardTime(this.currentTimeline.duration+M)}delayNextStep(M){M>0&&this.currentTimeline.delayNextStep(M)}invokeQuery(M,P,j,te,ge,Oe){let ze=[];if(te&&ze.push(this.element),M.length>0){M=(M=M.replace(Bs,"."+this._enterClassName)).replace(li,"."+this._leaveClassName);let xt=this._driver.query(this.element,M,1!=j);0!==j&&(xt=j<0?xt.slice(xt.length+j,xt.length):xt.slice(0,j)),ze.push(...xt)}return!ge&&0==ze.length&&Oe.push(function mt(Q){return new _e.vHH(3014,!1)}()),ze}}class Qr{constructor(M,P,j,te){this._driver=M,this.element=P,this.startTime=j,this._elementTimelineStylesLookup=te,this.duration=0,this.easing=null,this._previousKeyframe=new Map,this._currentKeyframe=new Map,this._keyframes=new Map,this._styleSummary=new Map,this._localTimelineStyles=new Map,this._pendingStyles=new Map,this._backFill=new Map,this._currentEmptyStepKeyframe=null,this._elementTimelineStylesLookup||(this._elementTimelineStylesLookup=new Map),this._globalTimelineStyles=this._elementTimelineStylesLookup.get(P),this._globalTimelineStyles||(this._globalTimelineStyles=this._localTimelineStyles,this._elementTimelineStylesLookup.set(P,this._localTimelineStyles)),this._loadKeyframe()}containsAnimation(){switch(this._keyframes.size){case 0:return!1;case 1:return this.hasCurrentStyleProperties();default:return!0}}hasCurrentStyleProperties(){return this._currentKeyframe.size>0}get currentTime(){return this.startTime+this.duration}delayNextStep(M){const P=1===this._keyframes.size&&this._pendingStyles.size;this.duration||P?(this.forwardTime(this.currentTime+M),P&&this.snapshotCurrentStyles()):this.startTime+=M}fork(M,P){return this.applyStylesToKeyframe(),new Qr(this._driver,M,P||this.currentTime,this._elementTimelineStylesLookup)}_loadKeyframe(){this._currentKeyframe&&(this._previousKeyframe=this._currentKeyframe),this._currentKeyframe=this._keyframes.get(this.duration),this._currentKeyframe||(this._currentKeyframe=new Map,this._keyframes.set(this.duration,this._currentKeyframe))}forwardFrame(){this.duration+=1,this._loadKeyframe()}forwardTime(M){this.applyStylesToKeyframe(),this.duration=M,this._loadKeyframe()}_updateStyle(M,P){this._localTimelineStyles.set(M,P),this._globalTimelineStyles.set(M,P),this._styleSummary.set(M,{time:this.currentTime,value:P})}allowOnlyTimelineStyles(){return this._currentEmptyStepKeyframe!==this._currentKeyframe}applyEmptyStep(M){M&&this._previousKeyframe.set("easing",M);for(let[P,j]of this._globalTimelineStyles)this._backFill.set(P,j||$e.l3),this._currentKeyframe.set(P,$e.l3);this._currentEmptyStepKeyframe=this._currentKeyframe}setStyles(M,P,j,te){P&&this._previousKeyframe.set("easing",P);const ge=te&&te.params||{},Oe=function Wi(Q,M){const P=new Map;let j;return Q.forEach(te=>{if("*"===te){j=j||M.keys();for(let ge of j)P.set(ge,$e.l3)}else ue(te,P)}),P}(M,this._globalTimelineStyles);for(let[ze,et]of Oe){const xt=pe(et,ge,j);this._pendingStyles.set(ze,xt),this._localTimelineStyles.has(ze)||this._backFill.set(ze,this._globalTimelineStyles.get(ze)??$e.l3),this._updateStyle(ze,xt)}}applyStylesToKeyframe(){0!=this._pendingStyles.size&&(this._pendingStyles.forEach((M,P)=>{this._currentKeyframe.set(P,M)}),this._pendingStyles.clear(),this._localTimelineStyles.forEach((M,P)=>{this._currentKeyframe.has(P)||this._currentKeyframe.set(P,M)}))}snapshotCurrentStyles(){for(let[M,P]of this._localTimelineStyles)this._pendingStyles.set(M,P),this._updateStyle(M,P)}getFinalKeyframe(){return this._keyframes.get(this.duration)}get properties(){const M=[];for(let P in this._currentKeyframe)M.push(P);return M}mergeTimelineCollectedStyles(M){M._styleSummary.forEach((P,j)=>{const te=this._styleSummary.get(j);(!te||P.time>te.time)&&this._updateStyle(j,P.value)})}buildKeyframes(){this.applyStylesToKeyframe();const M=new Set,P=new Set,j=1===this._keyframes.size&&0===this.duration;let te=[];this._keyframes.forEach((ze,et)=>{const xt=ue(ze,new Map,this._backFill);xt.forEach((gn,_n)=>{gn===$e.k1?M.add(_n):gn===$e.l3&&P.add(_n)}),j||xt.set("offset",et/this.duration),te.push(xt)});const ge=M.size?je(M.values()):[],Oe=P.size?je(P.values()):[];if(j){const ze=te[0],et=new Map(ze);ze.set("offset",0),et.set("offset",1),te=[ze,et]}return os(this.element,te,ge,Oe,this.duration,this.startTime,this.easing,!1)}}class Hr extends Qr{constructor(M,P,j,te,ge,Oe,ze=!1){super(M,P,Oe.delay),this.keyframes=j,this.preStyleProps=te,this.postStyleProps=ge,this._stretchStartingKeyframe=ze,this.timings={duration:Oe.duration,delay:Oe.delay,easing:Oe.easing}}containsAnimation(){return this.keyframes.length>1}buildKeyframes(){let M=this.keyframes,{delay:P,duration:j,easing:te}=this.timings;if(this._stretchStartingKeyframe&&P){const ge=[],Oe=j+P,ze=P/Oe,et=ue(M[0]);et.set("offset",0),ge.push(et);const xt=ue(M[0]);xt.set("offset",Bo(ze)),ge.push(xt);const gn=M.length-1;for(let _n=1;_n<=gn;_n++){let cr=ue(M[_n]);const ur=cr.get("offset");cr.set("offset",Bo((P+ur*j)/Oe)),ge.push(cr)}j=Oe,P=0,te="",M=ge}return os(this.element,M,this.preStyleProps,this.postStyleProps,j,P,te,!0)}}function Bo(Q,M=3){const P=Math.pow(10,M-1);return Math.round(Q*P)/P}class Ns{}const ii=new Set(["width","height","minWidth","minHeight","maxWidth","maxHeight","left","top","bottom","right","fontSize","outlineWidth","outlineOffset","paddingTop","paddingLeft","paddingBottom","paddingRight","marginTop","marginLeft","marginBottom","marginRight","borderRadius","borderWidth","borderTopWidth","borderLeftWidth","borderRightWidth","borderBottomWidth","textIndent","perspective"]);class Ni extends Ns{normalizePropertyName(M,P){return ut(M)}normalizeStyleValue(M,P,j,te){let ge="";const Oe=j.toString().trim();if(ii.has(P)&&0!==j&&"0"!==j)if("number"==typeof j)ge="px";else{const ze=j.match(/^[+-]?[\d\.]+([a-z]*)$/);ze&&0==ze[1].length&&te.push(function ft(Q,M){return new _e.vHH(3005,!1)}())}return Oe+ge}}function xa(Q,M,P,j,te,ge,Oe,ze,et,xt,gn,_n,cr){return{type:0,element:Q,triggerName:M,isRemovalTransition:te,fromState:P,fromStyles:ge,toState:j,toStyles:Oe,timelines:ze,queriedElements:et,preStyleProps:xt,postStyleProps:gn,totalTime:_n,errors:cr}}const Ui={};class Wr{constructor(M,P,j){this._triggerName=M,this.ast=P,this._stateStyles=j}match(M,P,j,te){return function Wo(Q,M,P,j,te){return Q.some(ge=>ge(M,P,j,te))}(this.ast.matchers,M,P,j,te)}buildStyles(M,P,j){let te=this._stateStyles.get("*");return void 0!==M&&(te=this._stateStyles.get(M?.toString())||te),te?te.buildStyles(P,j):new Map}build(M,P,j,te,ge,Oe,ze,et,xt,gn){const _n=[],cr=this.ast.options&&this.ast.options.params||Ui,Un=this.buildStyles(j,ze&&ze.params||Ui,_n),Zn=et&&et.params||Ui,fr=this.buildStyles(te,Zn,_n),Fr=new Set,oi=new Map,Rr=new Map,Kr="void"===te,br={params:Io(Zn,cr),delay:this.ast.options?.delay},Xi=gn?[]:ao(M,P,this.ast.animation,ge,Oe,Un,fr,br,xt,_n);let Hn=0;if(Xi.forEach(fs=>{Hn=Math.max(fs.duration+fs.delay,Hn)}),_n.length)return xa(P,this._triggerName,j,te,Kr,Un,fr,[],[],oi,Rr,Hn,_n);Xi.forEach(fs=>{const F=fs.element,X=wr(oi,F,new Set);fs.preStyleProps.forEach(se=>X.add(se));const N=wr(Rr,F,new Set);fs.postStyleProps.forEach(se=>N.add(se)),F!==P&&Fr.add(F)});const jo=je(Fr.values());return xa(P,this._triggerName,j,te,Kr,Un,fr,Xi,jo,oi,Rr,Hn)}}function Io(Q,M){const P=Re(M);for(const j in Q)Q.hasOwnProperty(j)&&null!=Q[j]&&(P[j]=Q[j]);return P}class eo{constructor(M,P,j){this.styles=M,this.defaultParams=P,this.normalizer=j}buildStyles(M,P){const j=new Map,te=Re(this.defaultParams);return Object.keys(M).forEach(ge=>{const Oe=M[ge];null!==Oe&&(te[ge]=Oe)}),this.styles.styles.forEach(ge=>{"string"!=typeof ge&&ge.forEach((Oe,ze)=>{Oe&&(Oe=pe(Oe,te,P));const et=this.normalizer.normalizePropertyName(ze,P);Oe=this.normalizer.normalizeStyleValue(ze,et,Oe,P),j.set(ze,Oe)})}),j}}class wa{constructor(M,P,j){this.name=M,this.ast=P,this._normalizer=j,this.transitionFactories=[],this.states=new Map,P.states.forEach(te=>{this.states.set(te.name,new eo(te.style,te.options&&te.options.params||{},j))}),wo(this.states,"true","1"),wo(this.states,"false","0"),P.transitions.forEach(te=>{this.transitionFactories.push(new Wr(M,te,this.states))}),this.fallbackTransition=function No(Q,M,P){return new Wr(Q,{type:1,animation:{type:2,steps:[],options:null},matchers:[(Oe,ze)=>!0],options:null,queryCount:0,depCount:0},M)}(M,this.states)}get containsQueries(){return this.ast.queryCount>0}matchTransition(M,P,j,te){return this.transitionFactories.find(Oe=>Oe.match(M,P,j,te))||null}matchStyles(M,P,j){return this.fallbackTransition.buildStyles(M,P,j)}}function wo(Q,M,P){Q.has(M)?Q.has(P)||Q.set(P,Q.get(M)):Q.has(P)&&Q.set(M,Q.get(P))}const Ja=new An;class Us{constructor(M,P,j){this.bodyNode=M,this._driver=P,this._normalizer=j,this._animations=new Map,this._playersById=new Map,this.players=[]}register(M,P){const j=[],te=[],ge=On(this._driver,P,j,te);if(j.length)throw function mn(Q){return new _e.vHH(3503,!1)}();this._animations.set(M,ge)}_buildPlayer(M,P,j){const te=M.element,ge=vr(0,this._normalizer,0,M.keyframes,P,j);return this._driver.animate(te,ge,M.duration,M.delay,M.easing,[],!0)}create(M,P,j={}){const te=[],ge=this._animations.get(M);let Oe;const ze=new Map;if(ge?(Oe=ao(this._driver,P,ge,oo,Dr,new Map,new Map,j,Ja,te),Oe.forEach(gn=>{const _n=wr(ze,gn.element,new Map);gn.postStyleProps.forEach(cr=>_n.set(cr,null))})):(te.push(function Gt(){return new _e.vHH(3300,!1)}()),Oe=[]),te.length)throw function lt(Q){return new _e.vHH(3504,!1)}();ze.forEach((gn,_n)=>{gn.forEach((cr,ur)=>{gn.set(ur,this._driver.computeStyle(_n,ur,$e.l3))})});const xt=pr(Oe.map(gn=>{const _n=ze.get(gn.element);return this._buildPlayer(gn,new Map,_n)}));return this._playersById.set(M,xt),xt.onDestroy(()=>this.destroy(M)),this.players.push(xt),xt}destroy(M){const P=this._getPlayer(M);P.destroy(),this._playersById.delete(M);const j=this.players.indexOf(P);j>=0&&this.players.splice(j,1)}_getPlayer(M){const P=this._playersById.get(M);if(!P)throw function rt(Q){return new _e.vHH(3301,!1)}();return P}listen(M,P,j,te){const ge=ni(P,"","","");return si(this._getPlayer(M),j,ge,te),()=>{}}command(M,P,j,te){if("register"==j)return void this.register(M,te[0]);if("create"==j)return void this.create(M,P,te[0]||{});const ge=this._getPlayer(M);switch(j){case"play":ge.play();break;case"pause":ge.pause();break;case"reset":ge.reset();break;case"restart":ge.restart();break;case"finish":ge.finish();break;case"init":ge.init();break;case"setPosition":ge.setPosition(parseFloat(te[0]));break;case"destroy":this.destroy(M)}}}const Ts="ng-animate-queued",ia="ng-animate-disabled",Fa=[],za={namespaceId:"",setForRemoval:!1,setForMove:!1,hasAnimation:!1,removedBeforeQueried:!1},sa={namespaceId:"",setForMove:!1,setForRemoval:!1,hasAnimation:!1,removedBeforeQueried:!0},bo="__ng_removed";class aa{get params(){return this.options.params}constructor(M,P=""){this.namespaceId=P;const j=M&&M.hasOwnProperty("value");if(this.value=function ss(Q){return Q??null}(j?M.value:M),j){const ge=Re(M);delete ge.value,this.options=ge}else this.options={};this.options.params||(this.options.params={})}absorbOptions(M){const P=M.params;if(P){const j=this.options.params;Object.keys(P).forEach(te=>{null==j[te]&&(j[te]=P[te])})}}}const Eo="void",Vs=new aa(Eo);class Qa{constructor(M,P,j){this.id=M,this.hostElement=P,this._engine=j,this.players=[],this._triggers=new Map,this._queue=[],this._elementListeners=new Map,this._hostClassName="ng-tns-"+M,qi(P,this._hostClassName)}listen(M,P,j,te){if(!this._triggers.has(P))throw function Dt(Q,M){return new _e.vHH(3302,!1)}();if(null==j||0==j.length)throw function It(Q){return new _e.vHH(3303,!1)}();if(!function ba(Q){return"start"==Q||"done"==Q}(j))throw function Ht(Q,M){return new _e.vHH(3400,!1)}();const ge=wr(this._elementListeners,M,[]),Oe={name:P,phase:j,callback:te};ge.push(Oe);const ze=wr(this._engine.statesByElement,M,new Map);return ze.has(P)||(qi(M,po),qi(M,po+"-"+P),ze.set(P,Vs)),()=>{this._engine.afterFlush(()=>{const et=ge.indexOf(Oe);et>=0&&ge.splice(et,1),this._triggers.has(P)||ze.delete(P)})}}register(M,P){return!this._triggers.has(M)&&(this._triggers.set(M,P),!0)}_getTrigger(M){const P=this._triggers.get(M);if(!P)throw function Nt(Q){return new _e.vHH(3401,!1)}();return P}trigger(M,P,j,te=!0){const ge=this._getTrigger(P),Oe=new go(this.id,P,M);let ze=this._engine.statesByElement.get(M);ze||(qi(M,po),qi(M,po+"-"+P),this._engine.statesByElement.set(M,ze=new Map));let et=ze.get(P);const xt=new aa(j,this.id);if(!(j&&j.hasOwnProperty("value"))&&et&&xt.absorbOptions(et.options),ze.set(P,xt),et||(et=Vs),xt.value!==Eo&&et.value===xt.value){if(!function Ss(Q,M){const P=Object.keys(Q),j=Object.keys(M);if(P.length!=j.length)return!1;for(let te=0;te<P.length;te++){const ge=P[te];if(!M.hasOwnProperty(ge)||Q[ge]!==M[ge])return!1}return!0}(et.params,xt.params)){const Zn=[],fr=ge.matchStyles(et.value,et.params,Zn),Fr=ge.matchStyles(xt.value,xt.params,Zn);Zn.length?this._engine.reportError(Zn):this._engine.afterFlush(()=>{Ee(M,fr),de(M,Fr)})}return}const cr=wr(this._engine.playersByElement,M,[]);cr.forEach(Zn=>{Zn.namespaceId==this.id&&Zn.triggerName==P&&Zn.queued&&Zn.destroy()});let ur=ge.matchTransition(et.value,xt.value,M,xt.params),Un=!1;if(!ur){if(!te)return;ur=ge.fallbackTransition,Un=!0}return this._engine.totalQueuedPlayers++,this._queue.push({element:M,triggerName:P,transition:ur,fromState:et,toState:xt,player:Oe,isFallbackTransition:Un}),Un||(qi(M,Ts),Oe.onStart(()=>{Ao(M,Ts)})),Oe.onDone(()=>{let Zn=this.players.indexOf(Oe);Zn>=0&&this.players.splice(Zn,1);const fr=this._engine.playersByElement.get(M);if(fr){let Fr=fr.indexOf(Oe);Fr>=0&&fr.splice(Fr,1)}}),this.players.push(Oe),cr.push(Oe),Oe}deregister(M){this._triggers.delete(M),this._engine.statesByElement.forEach(P=>P.delete(M)),this._elementListeners.forEach((P,j)=>{this._elementListeners.set(j,P.filter(te=>te.name!=M))})}clearElementCache(M){this._engine.statesByElement.delete(M),this._elementListeners.delete(M);const P=this._engine.playersByElement.get(M);P&&(P.forEach(j=>j.destroy()),this._engine.playersByElement.delete(M))}_signalRemovalForInnerTriggers(M,P){const j=this._engine.driver.query(M,gr,!0);j.forEach(te=>{if(te[bo])return;const ge=this._engine.fetchNamespacesByElement(te);ge.size?ge.forEach(Oe=>Oe.triggerLeaveAnimation(te,P,!1,!0)):this.clearElementCache(te)}),this._engine.afterFlushAnimationsDone(()=>j.forEach(te=>this.clearElementCache(te)))}triggerLeaveAnimation(M,P,j,te){const ge=this._engine.statesByElement.get(M),Oe=new Map;if(ge){const ze=[];if(ge.forEach((et,xt)=>{if(Oe.set(xt,et.value),this._triggers.has(xt)){const gn=this.trigger(M,xt,Eo,te);gn&&ze.push(gn)}}),ze.length)return this._engine.markElementAsRemoved(this.id,M,!0,P,Oe),j&&pr(ze).onDone(()=>this._engine.processLeaveNode(M)),!0}return!1}prepareLeaveAnimationListeners(M){const P=this._elementListeners.get(M),j=this._engine.statesByElement.get(M);if(P&&j){const te=new Set;P.forEach(ge=>{const Oe=ge.name;if(te.has(Oe))return;te.add(Oe);const et=this._triggers.get(Oe).fallbackTransition,xt=j.get(Oe)||Vs,gn=new aa(Eo),_n=new go(this.id,Oe,M);this._engine.totalQueuedPlayers++,this._queue.push({element:M,triggerName:Oe,transition:et,fromState:xt,toState:gn,player:_n,isFallbackTransition:!0})})}}removeNode(M,P){const j=this._engine;if(M.childElementCount&&this._signalRemovalForInnerTriggers(M,P),this.triggerLeaveAnimation(M,P,!0))return;let te=!1;if(j.totalAnimations){const ge=j.players.length?j.playersByQueriedElement.get(M):[];if(ge&&ge.length)te=!0;else{let Oe=M;for(;Oe=Oe.parentNode;)if(j.statesByElement.get(Oe)){te=!0;break}}}if(this.prepareLeaveAnimationListeners(M),te)j.markElementAsRemoved(this.id,M,!1,P);else{const ge=M[bo];(!ge||ge===za)&&(j.afterFlush(()=>this.clearElementCache(M)),j.destroyInnerAnimations(M),j._onRemovalComplete(M,P))}}insertNode(M,P){qi(M,this._hostClassName)}drainQueuedTransitions(M){const P=[];return this._queue.forEach(j=>{const te=j.player;if(te.destroyed)return;const ge=j.element,Oe=this._elementListeners.get(ge);Oe&&Oe.forEach(ze=>{if(ze.name==j.triggerName){const et=ni(ge,j.triggerName,j.fromState.value,j.toState.value);et._data=M,si(j.player,ze.phase,et,ze.callback)}}),te.markedForDestroy?this._engine.afterFlush(()=>{te.destroy()}):P.push(j)}),this._queue=[],P.sort((j,te)=>{const ge=j.transition.ast.depCount,Oe=te.transition.ast.depCount;return 0==ge||0==Oe?ge-Oe:this._engine.driver.containsElement(j.element,te.element)?1:-1})}destroy(M){this.players.forEach(P=>P.destroy()),this._signalRemovalForInnerTriggers(this.hostElement,M)}elementContainsData(M){let P=!1;return this._elementListeners.has(M)&&(P=!0),P=!!this._queue.find(j=>j.element===M)||P,P}}class la{_onRemovalComplete(M,P){this.onRemovalComplete(M,P)}constructor(M,P,j){this.bodyNode=M,this.driver=P,this._normalizer=j,this.players=[],this.newHostElements=new Map,this.playersByElement=new Map,this.playersByQueriedElement=new Map,this.statesByElement=new Map,this.disabledNodes=new Set,this.totalAnimations=0,this.totalQueuedPlayers=0,this._namespaceLookup={},this._namespaceList=[],this._flushFns=[],this._whenQuietFns=[],this.namespacesByHostElement=new Map,this.collectedEnterElements=[],this.collectedLeaveElements=[],this.onRemovalComplete=(te,ge)=>{}}get queuedPlayers(){const M=[];return this._namespaceList.forEach(P=>{P.players.forEach(j=>{j.queued&&M.push(j)})}),M}createNamespace(M,P){const j=new Qa(M,P,this);return this.bodyNode&&this.driver.containsElement(this.bodyNode,P)?this._balanceNamespaceList(j,P):(this.newHostElements.set(P,j),this.collectEnterElement(P)),this._namespaceLookup[M]=j}_balanceNamespaceList(M,P){const j=this._namespaceList,te=this.namespacesByHostElement;if(j.length-1>=0){let Oe=!1,ze=this.driver.getParentElement(P);for(;ze;){const et=te.get(ze);if(et){const xt=j.indexOf(et);j.splice(xt+1,0,M),Oe=!0;break}ze=this.driver.getParentElement(ze)}Oe||j.unshift(M)}else j.push(M);return te.set(P,M),M}register(M,P){let j=this._namespaceLookup[M];return j||(j=this.createNamespace(M,P)),j}registerTrigger(M,P,j){let te=this._namespaceLookup[M];te&&te.register(P,j)&&this.totalAnimations++}destroy(M,P){if(!M)return;const j=this._fetchNamespace(M);this.afterFlush(()=>{this.namespacesByHostElement.delete(j.hostElement),delete this._namespaceLookup[M];const te=this._namespaceList.indexOf(j);te>=0&&this._namespaceList.splice(te,1)}),this.afterFlushAnimationsDone(()=>j.destroy(P))}_fetchNamespace(M){return this._namespaceLookup[M]}fetchNamespacesByElement(M){const P=new Set,j=this.statesByElement.get(M);if(j)for(let te of j.values())if(te.namespaceId){const ge=this._fetchNamespace(te.namespaceId);ge&&P.add(ge)}return P}trigger(M,P,j,te){if(mr(P)){const ge=this._fetchNamespace(M);if(ge)return ge.trigger(P,j,te),!0}return!1}insertNode(M,P,j,te){if(!mr(P))return;const ge=P[bo];if(ge&&ge.setForRemoval){ge.setForRemoval=!1,ge.setForMove=!0;const Oe=this.collectedLeaveElements.indexOf(P);Oe>=0&&this.collectedLeaveElements.splice(Oe,1)}if(M){const Oe=this._fetchNamespace(M);Oe&&Oe.insertNode(P,j)}te&&this.collectEnterElement(P)}collectEnterElement(M){this.collectedEnterElements.push(M)}markElementAsDisabled(M,P){P?this.disabledNodes.has(M)||(this.disabledNodes.add(M),qi(M,ia)):this.disabledNodes.has(M)&&(this.disabledNodes.delete(M),Ao(M,ia))}removeNode(M,P,j,te){if(mr(P)){const ge=M?this._fetchNamespace(M):null;if(ge?ge.removeNode(P,te):this.markElementAsRemoved(M,P,!1,te),j){const Oe=this.namespacesByHostElement.get(P);Oe&&Oe.id!==M&&Oe.removeNode(P,te)}}else this._onRemovalComplete(P,te)}markElementAsRemoved(M,P,j,te,ge){this.collectedLeaveElements.push(P),P[bo]={namespaceId:M,setForRemoval:te,hasAnimation:j,removedBeforeQueried:!1,previousTriggersValues:ge}}listen(M,P,j,te,ge){return mr(P)?this._fetchNamespace(M).listen(P,j,te,ge):()=>{}}_buildInstruction(M,P,j,te,ge){return M.transition.build(this.driver,M.element,M.fromState.value,M.toState.value,j,te,M.fromState.options,M.toState.options,P,ge)}destroyInnerAnimations(M){let P=this.driver.query(M,gr,!0);P.forEach(j=>this.destroyActiveAnimationsForElement(j)),0!=this.playersByQueriedElement.size&&(P=this.driver.query(M,kn,!0),P.forEach(j=>this.finishActiveQueriedAnimationOnElement(j)))}destroyActiveAnimationsForElement(M){const P=this.playersByElement.get(M);P&&P.forEach(j=>{j.queued?j.markedForDestroy=!0:j.destroy()})}finishActiveQueriedAnimationOnElement(M){const P=this.playersByQueriedElement.get(M);P&&P.forEach(j=>j.finish())}whenRenderingDone(){return new Promise(M=>{if(this.players.length)return pr(this.players).onDone(()=>M());M()})}processLeaveNode(M){const P=M[bo];if(P&&P.setForRemoval){if(M[bo]=za,P.namespaceId){this.destroyInnerAnimations(M);const j=this._fetchNamespace(P.namespaceId);j&&j.clearElementCache(M)}this._onRemovalComplete(M,P.setForRemoval)}M.classList?.contains(ia)&&this.markElementAsDisabled(M,!1),this.driver.query(M,".ng-animate-disabled",!0).forEach(j=>{this.markElementAsDisabled(j,!1)})}flush(M=-1){let P=[];if(this.newHostElements.size&&(this.newHostElements.forEach((j,te)=>this._balanceNamespaceList(j,te)),this.newHostElements.clear()),this.totalAnimations&&this.collectedEnterElements.length)for(let j=0;j<this.collectedEnterElements.length;j++)qi(this.collectedEnterElements[j],"ng-star-inserted");if(this._namespaceList.length&&(this.totalQueuedPlayers||this.collectedLeaveElements.length)){const j=[];try{P=this._flushAnimations(j,M)}finally{for(let te=0;te<j.length;te++)j[te]()}}else for(let j=0;j<this.collectedLeaveElements.length;j++)this.processLeaveNode(this.collectedLeaveElements[j]);if(this.totalQueuedPlayers=0,this.collectedEnterElements.length=0,this.collectedLeaveElements.length=0,this._flushFns.forEach(j=>j()),this._flushFns=[],this._whenQuietFns.length){const j=this._whenQuietFns;this._whenQuietFns=[],P.length?pr(P).onDone(()=>{j.forEach(te=>te())}):j.forEach(te=>te())}}reportError(M){throw function Dn(Q){return new _e.vHH(3402,!1)}()}_flushAnimations(M,P){const j=new An,te=[],ge=new Map,Oe=[],ze=new Map,et=new Map,xt=new Map,gn=new Set;this.disabledNodes.forEach(A=>{gn.add(A);const $=this.driver.query(A,".ng-animate-queued",!0);for(let fe=0;fe<$.length;fe++)gn.add($[fe])});const _n=this.bodyNode,cr=Array.from(this.statesByElement.keys()),ur=as(cr,this.collectedEnterElements),Un=new Map;let Zn=0;ur.forEach((A,$)=>{const fe=oo+Zn++;Un.set($,fe),A.forEach(We=>qi(We,fe))});const fr=[],Fr=new Set,oi=new Set;for(let A=0;A<this.collectedLeaveElements.length;A++){const $=this.collectedLeaveElements[A],fe=$[bo];fe&&fe.setForRemoval&&(fr.push($),Fr.add($),fe.hasAnimation?this.driver.query($,".ng-star-inserted",!0).forEach(We=>Fr.add(We)):oi.add($))}const Rr=new Map,Kr=as(cr,Array.from(Fr));Kr.forEach((A,$)=>{const fe=Dr+Zn++;Rr.set($,fe),A.forEach(We=>qi(We,fe))}),M.push(()=>{ur.forEach((A,$)=>{const fe=Un.get($);A.forEach(We=>Ao(We,fe))}),Kr.forEach((A,$)=>{const fe=Rr.get($);A.forEach(We=>Ao(We,fe))}),fr.forEach(A=>{this.processLeaveNode(A)})});const br=[],Xi=[];for(let A=this._namespaceList.length-1;A>=0;A--)this._namespaceList[A].drainQueuedTransitions(P).forEach(fe=>{const We=fe.player,Ft=fe.element;if(br.push(We),this.collectedEnterElements.length){const Ci=Ft[bo];if(Ci&&Ci.setForMove){if(Ci.previousTriggersValues&&Ci.previousTriggersValues.has(fe.triggerName)){const $i=Ci.previousTriggersValues.get(fe.triggerName),ji=this.statesByElement.get(fe.element);if(ji&&ji.has(fe.triggerName)){const Hs=ji.get(fe.triggerName);Hs.value=$i,ji.set(fe.triggerName,Hs)}}return void We.destroy()}}const En=!_n||!this.driver.containsElement(_n,Ft),Qn=Rr.get(Ft),Xn=Un.get(Ft),yt=this._buildInstruction(fe,j,Xn,Qn,En);if(yt.errors&&yt.errors.length)return void Xi.push(yt);if(En)return We.onStart(()=>Ee(Ft,yt.fromStyles)),We.onDestroy(()=>de(Ft,yt.toStyles)),void te.push(We);if(fe.isFallbackTransition)return We.onStart(()=>Ee(Ft,yt.fromStyles)),We.onDestroy(()=>de(Ft,yt.toStyles)),void te.push(We);const Di=[];yt.timelines.forEach(Ci=>{Ci.stretchStartingKeyframe=!0,this.disabledNodes.has(Ci.element)||Di.push(Ci)}),yt.timelines=Di,j.append(Ft,yt.timelines),Oe.push({instruction:yt,player:We,element:Ft}),yt.queriedElements.forEach(Ci=>wr(ze,Ci,[]).push(We)),yt.preStyleProps.forEach((Ci,$i)=>{if(Ci.size){let ji=et.get($i);ji||et.set($i,ji=new Set),Ci.forEach((Hs,Vo)=>ji.add(Vo))}}),yt.postStyleProps.forEach((Ci,$i)=>{let ji=xt.get($i);ji||xt.set($i,ji=new Set),Ci.forEach((Hs,Vo)=>ji.add(Vo))})});if(Xi.length){const A=[];Xi.forEach($=>{A.push(function or(Q,M){return new _e.vHH(3505,!1)}())}),br.forEach($=>$.destroy()),this.reportError(A)}const Hn=new Map,jo=new Map;Oe.forEach(A=>{const $=A.element;j.has($)&&(jo.set($,$),this._beforeAnimationBuild(A.player.namespaceId,A.instruction,Hn))}),te.forEach(A=>{const $=A.element;this._getPreviousPlayers($,!1,A.namespaceId,A.triggerName,null).forEach(We=>{wr(Hn,$,[]).push(We),We.destroy()})});const fs=fr.filter(A=>di(A,et,xt)),F=new Map;Zo(F,this.driver,oi,xt,$e.l3).forEach(A=>{di(A,et,xt)&&fs.push(A)});const N=new Map;ur.forEach((A,$)=>{Zo(N,this.driver,new Set(A),et,$e.k1)}),fs.forEach(A=>{const $=F.get(A),fe=N.get(A);F.set(A,new Map([...Array.from($?.entries()??[]),...Array.from(fe?.entries()??[])]))});const se=[],Ce=[],I={};Oe.forEach(A=>{const{element:$,player:fe,instruction:We}=A;if(j.has($)){if(gn.has($))return fe.onDestroy(()=>de($,We.toStyles)),fe.disabled=!0,fe.overrideTotalTime(We.totalTime),void te.push(fe);let Ft=I;if(jo.size>1){let Qn=$;const Xn=[];for(;Qn=Qn.parentNode;){const yt=jo.get(Qn);if(yt){Ft=yt;break}Xn.push(Qn)}Xn.forEach(yt=>jo.set(yt,Ft))}const En=this._buildAnimation(fe.namespaceId,We,Hn,ge,N,F);if(fe.setRealPlayer(En),Ft===I)se.push(fe);else{const Qn=this.playersByElement.get(Ft);Qn&&Qn.length&&(fe.parentPlayer=pr(Qn)),te.push(fe)}}else Ee($,We.fromStyles),fe.onDestroy(()=>de($,We.toStyles)),Ce.push(fe),gn.has($)&&te.push(fe)}),Ce.forEach(A=>{const $=ge.get(A.element);if($&&$.length){const fe=pr($);A.setRealPlayer(fe)}}),te.forEach(A=>{A.parentPlayer?A.syncPlayerEvents(A.parentPlayer):A.destroy()});for(let A=0;A<fr.length;A++){const $=fr[A],fe=$[bo];if(Ao($,Dr),fe&&fe.hasAnimation)continue;let We=[];if(ze.size){let En=ze.get($);En&&En.length&&We.push(...En);let Qn=this.driver.query($,kn,!0);for(let Xn=0;Xn<Qn.length;Xn++){let yt=ze.get(Qn[Xn]);yt&&yt.length&&We.push(...yt)}}const Ft=We.filter(En=>!En.destroyed);Ft.length?Cs(this,$,Ft):this.processLeaveNode($)}return fr.length=0,se.forEach(A=>{this.players.push(A),A.onDone(()=>{A.destroy();const $=this.players.indexOf(A);this.players.splice($,1)}),A.play()}),se}elementContainsData(M,P){let j=!1;const te=P[bo];return te&&te.setForRemoval&&(j=!0),this.playersByElement.has(P)&&(j=!0),this.playersByQueriedElement.has(P)&&(j=!0),this.statesByElement.has(P)&&(j=!0),this._fetchNamespace(M).elementContainsData(P)||j}afterFlush(M){this._flushFns.push(M)}afterFlushAnimationsDone(M){this._whenQuietFns.push(M)}_getPreviousPlayers(M,P,j,te,ge){let Oe=[];if(P){const ze=this.playersByQueriedElement.get(M);ze&&(Oe=ze)}else{const ze=this.playersByElement.get(M);if(ze){const et=!ge||ge==Eo;ze.forEach(xt=>{xt.queued||!et&&xt.triggerName!=te||Oe.push(xt)})}}return(j||te)&&(Oe=Oe.filter(ze=>!(j&&j!=ze.namespaceId||te&&te!=ze.triggerName))),Oe}_beforeAnimationBuild(M,P,j){const ge=P.element,Oe=P.isRemovalTransition?void 0:M,ze=P.isRemovalTransition?void 0:P.triggerName;for(const et of P.timelines){const xt=et.element,gn=xt!==ge,_n=wr(j,xt,[]);this._getPreviousPlayers(xt,gn,Oe,ze,P.toState).forEach(ur=>{const Un=ur.getRealPlayer();Un.beforeDestroy&&Un.beforeDestroy(),ur.destroy(),_n.push(ur)})}Ee(ge,P.fromStyles)}_buildAnimation(M,P,j,te,ge,Oe){const ze=P.triggerName,et=P.element,xt=[],gn=new Set,_n=new Set,cr=P.timelines.map(Un=>{const Zn=Un.element;gn.add(Zn);const fr=Zn[bo];if(fr&&fr.removedBeforeQueried)return new $e.ZN(Un.duration,Un.delay);const Fr=Zn!==et,oi=function no(Q){const M=[];return $s(Q,M),M}((j.get(Zn)||Fa).map(Hn=>Hn.getRealPlayer())).filter(Hn=>!!Hn.element&&Hn.element===Zn),Rr=ge.get(Zn),Kr=Oe.get(Zn),br=vr(0,this._normalizer,0,Un.keyframes,Rr,Kr),Xi=this._buildPlayer(Un,br,oi);if(Un.subTimeline&&te&&_n.add(Zn),Fr){const Hn=new go(M,ze,Zn);Hn.setRealPlayer(Xi),xt.push(Hn)}return Xi});xt.forEach(Un=>{wr(this.playersByQueriedElement,Un.element,[]).push(Un),Un.onDone(()=>function Ds(Q,M,P){let j=Q.get(M);if(j){if(j.length){const te=j.indexOf(P);j.splice(te,1)}0==j.length&&Q.delete(M)}return j}(this.playersByQueriedElement,Un.element,Un))}),gn.forEach(Un=>qi(Un,so));const ur=pr(cr);return ur.onDestroy(()=>{gn.forEach(Un=>Ao(Un,so)),de(et,P.toStyles)}),_n.forEach(Un=>{wr(te,Un,[]).push(ur)}),ur}_buildPlayer(M,P,j){return P.length>0?this.driver.animate(M.element,P,M.duration,M.delay,M.easing,j):new $e.ZN(M.duration,M.delay)}}class go{constructor(M,P,j){this.namespaceId=M,this.triggerName=P,this.element=j,this._player=new $e.ZN,this._containsRealPlayer=!1,this._queuedCallbacks=new Map,this.destroyed=!1,this.parentPlayer=null,this.markedForDestroy=!1,this.disabled=!1,this.queued=!0,this.totalTime=0}setRealPlayer(M){this._containsRealPlayer||(this._player=M,this._queuedCallbacks.forEach((P,j)=>{P.forEach(te=>si(M,j,void 0,te))}),this._queuedCallbacks.clear(),this._containsRealPlayer=!0,this.overrideTotalTime(M.totalTime),this.queued=!1)}getRealPlayer(){return this._player}overrideTotalTime(M){this.totalTime=M}syncPlayerEvents(M){const P=this._player;P.triggerCallback&&M.onStart(()=>P.triggerCallback("start")),M.onDone(()=>this.finish()),M.onDestroy(()=>this.destroy())}_queueEvent(M,P){wr(this._queuedCallbacks,M,[]).push(P)}onDone(M){this.queued&&this._queueEvent("done",M),this._player.onDone(M)}onStart(M){this.queued&&this._queueEvent("start",M),this._player.onStart(M)}onDestroy(M){this.queued&&this._queueEvent("destroy",M),this._player.onDestroy(M)}init(){this._player.init()}hasStarted(){return!this.queued&&this._player.hasStarted()}play(){!this.queued&&this._player.play()}pause(){!this.queued&&this._player.pause()}restart(){!this.queued&&this._player.restart()}finish(){this._player.finish()}destroy(){this.destroyed=!0,this._player.destroy()}reset(){!this.queued&&this._player.reset()}setPosition(M){this.queued||this._player.setPosition(M)}getPosition(){return this.queued?0:this._player.getPosition()}triggerCallback(M){const P=this._player;P.triggerCallback&&P.triggerCallback(M)}}function mr(Q){return Q&&1===Q.nodeType}function qo(Q,M){const P=Q.style.display;return Q.style.display=M??"none",P}function Zo(Q,M,P,j,te){const ge=[];P.forEach(et=>ge.push(qo(et)));const Oe=[];j.forEach((et,xt)=>{const gn=new Map;et.forEach(_n=>{const cr=M.computeStyle(xt,_n,te);gn.set(_n,cr),(!cr||0==cr.length)&&(xt[bo]=sa,Oe.push(xt))}),Q.set(xt,gn)});let ze=0;return P.forEach(et=>qo(et,ge[ze++])),Oe}function as(Q,M){const P=new Map;if(Q.forEach(ze=>P.set(ze,[])),0==M.length)return P;const j=1,te=new Set(M),ge=new Map;function Oe(ze){if(!ze)return j;let et=ge.get(ze);if(et)return et;const xt=ze.parentNode;return et=P.has(xt)?xt:te.has(xt)?j:Oe(xt),ge.set(ze,et),et}return M.forEach(ze=>{const et=Oe(ze);et!==j&&P.get(et).push(ze)}),P}function qi(Q,M){Q.classList?.add(M)}function Ao(Q,M){Q.classList?.remove(M)}function Cs(Q,M,P){pr(P).onDone(()=>Q.processLeaveNode(M))}function $s(Q,M){for(let P=0;P<Q.length;P++){const j=Q[P];j instanceof $e.ZE?$s(j.players,M):M.push(j)}}function di(Q,M,P){const j=P.get(Q);if(!j)return!1;let te=M.get(Q);return te?j.forEach(ge=>te.add(ge)):M.set(Q,j),P.delete(Q),!0}class ca{constructor(M,P,j){this.bodyNode=M,this._driver=P,this._normalizer=j,this._triggerCache={},this.onRemovalComplete=(te,ge)=>{},this._transitionEngine=new la(M,P,j),this._timelineEngine=new Us(M,P,j),this._transitionEngine.onRemovalComplete=(te,ge)=>this.onRemovalComplete(te,ge)}registerTrigger(M,P,j,te,ge){const Oe=M+"-"+te;let ze=this._triggerCache[Oe];if(!ze){const et=[],xt=[],gn=On(this._driver,ge,et,xt);if(et.length)throw function $t(Q,M){return new _e.vHH(3404,!1)}();ze=function Js(Q,M,P){return new wa(Q,M,P)}(te,gn,this._normalizer),this._triggerCache[Oe]=ze}this._transitionEngine.registerTrigger(P,te,ze)}register(M,P){this._transitionEngine.register(M,P)}destroy(M,P){this._transitionEngine.destroy(M,P)}onInsert(M,P,j,te){this._transitionEngine.insertNode(M,P,j,te)}onRemove(M,P,j,te){this._transitionEngine.removeNode(M,P,te||!1,j)}disableAnimations(M,P){this._transitionEngine.markElementAsDisabled(M,P)}process(M,P,j,te){if("@"==j.charAt(0)){const[ge,Oe]=Yi(j);this._timelineEngine.command(ge,P,Oe,te)}else this._transitionEngine.trigger(M,P,j,te)}listen(M,P,j,te,ge){if("@"==j.charAt(0)){const[Oe,ze]=Yi(j);return this._timelineEngine.listen(Oe,P,ze,ge)}return this._transitionEngine.listen(M,P,j,te,ge)}flush(M=-1){this._transitionEngine.flush(M)}get players(){return this._transitionEngine.players.concat(this._timelineEngine.players)}whenRenderingDone(){return this._transitionEngine.whenRenderingDone()}}let Jn=(()=>{class Q{constructor(P,j,te){this._element=P,this._startStyles=j,this._endStyles=te,this._state=0;let ge=Q.initialStylesByElement.get(P);ge||Q.initialStylesByElement.set(P,ge=new Map),this._initialStyles=ge}start(){this._state<1&&(this._startStyles&&de(this._element,this._startStyles,this._initialStyles),this._state=1)}finish(){this.start(),this._state<2&&(de(this._element,this._initialStyles),this._endStyles&&(de(this._element,this._endStyles),this._endStyles=null),this._state=1)}destroy(){this.finish(),this._state<3&&(Q.initialStylesByElement.delete(this._element),this._startStyles&&(Ee(this._element,this._startStyles),this._endStyles=null),this._endStyles&&(Ee(this._element,this._endStyles),this._endStyles=null),de(this._element,this._initialStyles),this._state=3)}}return Q.initialStylesByElement=new WeakMap,Q})();function Xo(Q){let M=null;return Q.forEach((P,j)=>{(function Ba(Q){return"display"===Q||"position"===Q})(j)&&(M=M||new Map,M.set(j,P))}),M}class cs{constructor(M,P,j,te){this.element=M,this.keyframes=P,this.options=j,this._specialStyles=te,this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._initialized=!1,this._finished=!1,this._started=!1,this._destroyed=!1,this._originalOnDoneFns=[],this._originalOnStartFns=[],this.time=0,this.parentPlayer=null,this.currentSnapshot=new Map,this._duration=j.duration,this._delay=j.delay||0,this.time=this._duration+this._delay}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(M=>M()),this._onDoneFns=[])}init(){this._buildPlayer(),this._preparePlayerBeforeStart()}_buildPlayer(){if(this._initialized)return;this._initialized=!0;const M=this.keyframes;this.domPlayer=this._triggerWebAnimation(this.element,M,this.options),this._finalKeyframe=M.length?M[M.length-1]:new Map,this.domPlayer.addEventListener("finish",()=>this._onFinish())}_preparePlayerBeforeStart(){this._delay?this._resetDomPlayerState():this.domPlayer.pause()}_convertKeyframesToObject(M){const P=[];return M.forEach(j=>{P.push(Object.fromEntries(j))}),P}_triggerWebAnimation(M,P,j){return M.animate(this._convertKeyframesToObject(P),j)}onStart(M){this._originalOnStartFns.push(M),this._onStartFns.push(M)}onDone(M){this._originalOnDoneFns.push(M),this._onDoneFns.push(M)}onDestroy(M){this._onDestroyFns.push(M)}play(){this._buildPlayer(),this.hasStarted()||(this._onStartFns.forEach(M=>M()),this._onStartFns=[],this._started=!0,this._specialStyles&&this._specialStyles.start()),this.domPlayer.play()}pause(){this.init(),this.domPlayer.pause()}finish(){this.init(),this._specialStyles&&this._specialStyles.finish(),this._onFinish(),this.domPlayer.finish()}reset(){this._resetDomPlayerState(),this._destroyed=!1,this._finished=!1,this._started=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}_resetDomPlayerState(){this.domPlayer&&this.domPlayer.cancel()}restart(){this.reset(),this.play()}hasStarted(){return this._started}destroy(){this._destroyed||(this._destroyed=!0,this._resetDomPlayerState(),this._onFinish(),this._specialStyles&&this._specialStyles.destroy(),this._onDestroyFns.forEach(M=>M()),this._onDestroyFns=[])}setPosition(M){void 0===this.domPlayer&&this.init(),this.domPlayer.currentTime=M*this.time}getPosition(){return this.domPlayer.currentTime/this.time}get totalTime(){return this._delay+this._duration}beforeDestroy(){const M=new Map;this.hasStarted()&&this._finalKeyframe.forEach((j,te)=>{"offset"!==te&&M.set(te,this._finished?j:rr(this.element,te))}),this.currentSnapshot=M}triggerCallback(M){const P="start"===M?this._onStartFns:this._onDoneFns;P.forEach(j=>j()),P.length=0}}class ei{validateStyleProperty(M){return!0}validateAnimatableStyleProperty(M){return!0}matchesElement(M,P){return!1}containsElement(M,P){return Mr(M,P)}getParentElement(M){return jr(M)}query(M,P,j){return on(M,P,j)}computeStyle(M,P,j){return window.getComputedStyle(M)[P]}animate(M,P,j,te,ge,Oe=[]){const et={duration:j,delay:te,fill:0==te?"both":"forwards"};ge&&(et.easing=ge);const xt=new Map,gn=Oe.filter(ur=>ur instanceof cs);(function dn(Q,M){return 0===Q||0===M})(j,te)&&gn.forEach(ur=>{ur.currentSnapshot.forEach((Un,Zn)=>xt.set(Zn,Un))});let _n=function Pt(Q){return Q.length?Q[0]instanceof Map?Q:Q.map(M=>Wt(M)):[]}(P).map(ur=>ue(ur));_n=function Rt(Q,M,P){if(P.size&&M.length){let j=M[0],te=[];if(P.forEach((ge,Oe)=>{j.has(Oe)||te.push(Oe),j.set(Oe,ge)}),te.length)for(let ge=1;ge<M.length;ge++){let Oe=M[ge];te.forEach(ze=>Oe.set(ze,rr(Q,ze)))}}return M}(M,_n,xt);const cr=function ls(Q,M){let P=null,j=null;return Array.isArray(M)&&M.length?(P=Xo(M[0]),M.length>1&&(j=Xo(M[M.length-1]))):M instanceof Map&&(P=Xo(M)),P||j?new Jn(Q,P,j):null}(M,_n);return new cs(M,_n,et,cr)}}var us=we(6895);let Ko=(()=>{class Q extends $e._j{constructor(P,j){super(),this._nextAnimationId=0,this._renderer=P.createRenderer(j.body,{id:"0",encapsulation:_e.ifc.None,styles:[],data:{animation:[]}})}build(P){const j=this._nextAnimationId.toString();this._nextAnimationId++;const te=Array.isArray(P)?(0,$e.vP)(P):P;return Ms(this._renderer,null,j,"register",[te]),new el(j,this._renderer)}}return Q.\u0275fac=function(P){return new(P||Q)(_e.LFG(_e.FYo),_e.LFG(us.K0))},Q.\u0275prov=_e.Yz7({token:Q,factory:Q.\u0275fac}),Q})();class el extends $e.LC{constructor(M,P){super(),this._id=M,this._renderer=P}create(M,P){return new Gs(this._id,M,P||{},this._renderer)}}class Gs{constructor(M,P,j,te){this.id=M,this.element=P,this._renderer=te,this.parentPlayer=null,this._started=!1,this.totalTime=0,this._command("create",j)}_listen(M,P){return this._renderer.listen(this.element,`@@${this.id}:${M}`,P)}_command(M,...P){return Ms(this._renderer,this.element,this.id,M,P)}onDone(M){this._listen("done",M)}onStart(M){this._listen("start",M)}onDestroy(M){this._listen("destroy",M)}init(){this._command("init")}hasStarted(){return this._started}play(){this._command("play"),this._started=!0}pause(){this._command("pause")}restart(){this._command("restart")}finish(){this._command("finish")}destroy(){this._command("destroy")}reset(){this._command("reset"),this._started=!1}setPosition(M){this._command("setPosition",M)}getPosition(){return this._renderer.engine.players[+this.id]?.getPosition()??0}}function Ms(Q,M,P,j,te){return Q.setProperty(M,`@@${P}:${j}`,te)}const nr="@.disabled";let ua=(()=>{class Q{constructor(P,j,te){this.delegate=P,this.engine=j,this._zone=te,this._currentId=0,this._microtaskId=1,this._animationCallbacksBuffer=[],this._rendererCache=new Map,this._cdRecurDepth=0,this.promise=Promise.resolve(0),j.onRemovalComplete=(ge,Oe)=>{const ze=Oe?.parentNode(ge);ze&&Oe.removeChild(ze,ge)}}createRenderer(P,j){const ge=this.delegate.createRenderer(P,j);if(!(P&&j&&j.data&&j.data.animation)){let gn=this._rendererCache.get(ge);return gn||(gn=new Qs("",ge,this.engine,()=>this._rendererCache.delete(ge)),this._rendererCache.set(ge,gn)),gn}const Oe=j.id,ze=j.id+"-"+this._currentId;this._currentId++,this.engine.register(ze,P);const et=gn=>{Array.isArray(gn)?gn.forEach(et):this.engine.registerTrigger(Oe,ze,P,gn.name,gn)};return j.data.animation.forEach(et),new ea(this,ze,ge,this.engine)}begin(){this._cdRecurDepth++,this.delegate.begin&&this.delegate.begin()}_scheduleCountTask(){this.promise.then(()=>{this._microtaskId++})}scheduleListenerCallback(P,j,te){P>=0&&P<this._microtaskId?this._zone.run(()=>j(te)):(0==this._animationCallbacksBuffer.length&&Promise.resolve(null).then(()=>{this._zone.run(()=>{this._animationCallbacksBuffer.forEach(ge=>{const[Oe,ze]=ge;Oe(ze)}),this._animationCallbacksBuffer=[]})}),this._animationCallbacksBuffer.push([j,te]))}end(){this._cdRecurDepth--,0==this._cdRecurDepth&&this._zone.runOutsideAngular(()=>{this._scheduleCountTask(),this.engine.flush(this._microtaskId)}),this.delegate.end&&this.delegate.end()}whenRenderingDone(){return this.engine.whenRenderingDone()}}return Q.\u0275fac=function(P){return new(P||Q)(_e.LFG(_e.FYo),_e.LFG(ca),_e.LFG(_e.R0b))},Q.\u0275prov=_e.Yz7({token:Q,factory:Q.\u0275fac}),Q})();class Qs{constructor(M,P,j,te){this.namespaceId=M,this.delegate=P,this.engine=j,this._onDestroy=te,this.destroyNode=this.delegate.destroyNode?ge=>P.destroyNode(ge):null}get data(){return this.delegate.data}destroy(){this.engine.destroy(this.namespaceId,this.delegate),this.delegate.destroy(),this._onDestroy?.()}createElement(M,P){return this.delegate.createElement(M,P)}createComment(M){return this.delegate.createComment(M)}createText(M){return this.delegate.createText(M)}appendChild(M,P){this.delegate.appendChild(M,P),this.engine.onInsert(this.namespaceId,P,M,!1)}insertBefore(M,P,j,te=!0){this.delegate.insertBefore(M,P,j),this.engine.onInsert(this.namespaceId,P,M,te)}removeChild(M,P,j){this.engine.onRemove(this.namespaceId,P,this.delegate,j)}selectRootElement(M,P){return this.delegate.selectRootElement(M,P)}parentNode(M){return this.delegate.parentNode(M)}nextSibling(M){return this.delegate.nextSibling(M)}setAttribute(M,P,j,te){this.delegate.setAttribute(M,P,j,te)}removeAttribute(M,P,j){this.delegate.removeAttribute(M,P,j)}addClass(M,P){this.delegate.addClass(M,P)}removeClass(M,P){this.delegate.removeClass(M,P)}setStyle(M,P,j,te){this.delegate.setStyle(M,P,j,te)}removeStyle(M,P,j){this.delegate.removeStyle(M,P,j)}setProperty(M,P,j){"@"==P.charAt(0)&&P==nr?this.disableAnimations(M,!!j):this.delegate.setProperty(M,P,j)}setValue(M,P){this.delegate.setValue(M,P)}listen(M,P,j){return this.delegate.listen(M,P,j)}disableAnimations(M,P){this.engine.disableAnimations(M,P)}}class ea extends Qs{constructor(M,P,j,te,ge){super(P,j,te,ge),this.factory=M,this.namespaceId=P}setProperty(M,P,j){"@"==P.charAt(0)?"."==P.charAt(1)&&P==nr?this.disableAnimations(M,j=void 0===j||!!j):this.engine.process(this.namespaceId,M,P.slice(1),j):this.delegate.setProperty(M,P,j)}listen(M,P,j){if("@"==P.charAt(0)){const te=function Ti(Q){switch(Q){case"body":return document.body;case"document":return document;case"window":return window;default:return Q}}(M);let ge=P.slice(1),Oe="";return"@"!=ge.charAt(0)&&([ge,Oe]=function Ea(Q){const M=Q.indexOf(".");return[Q.substring(0,M),Q.slice(M+1)]}(ge)),this.engine.listen(this.namespaceId,te,ge,Oe,ze=>{this.factory.scheduleListenerCallback(ze._data||-1,j,ze)})}return this.delegate.listen(M,P,j)}}const zt=[{provide:$e._j,useClass:Ko},{provide:Ns,useFactory:function ha(){return new Ni}},{provide:ca,useClass:(()=>{class Q extends ca{constructor(P,j,te,ge){super(P.body,j,te)}ngOnDestroy(){this.flush()}}return Q.\u0275fac=function(P){return new(P||Q)(_e.LFG(us.K0),_e.LFG(dr),_e.LFG(Ns),_e.LFG(_e.z2F))},Q.\u0275prov=_e.Yz7({token:Q,factory:Q.\u0275fac}),Q})()},{provide:_e.FYo,useFactory:function Ta(Q,M,P){return new ua(Q,M,P)},deps:[W.se,ca,_e.R0b]}],sr=[{provide:dr,useFactory:()=>new ei},{provide:_e.QbO,useValue:"BrowserAnimations"},...zt],da=[{provide:dr,useClass:vi},{provide:_e.QbO,useValue:"NoopAnimations"},...zt];let Na=(()=>{class Q{static withConfig(P){return{ngModule:Q,providers:P.disableAnimations?da:sr}}}return Q.\u0275fac=function(P){return new(P||Q)},Q.\u0275mod=_e.oAB({type:Q}),Q.\u0275inj=_e.cJS({providers:sr,imports:[W.b2]}),Q})();var Ro=we(529),Yo=we(8750);const ko=[{path:"mapas",loadChildren:()=>Promise.all([we.e(592),we.e(420)]).then(we.bind(we,5420)).then(Q=>Q.MapasModule)},{path:"auth",loadChildren:()=>Promise.all([we.e(592),we.e(152)]).then(we.bind(we,7152)).then(Q=>Q.AuthModule)},{path:"**",redirectTo:"mapas"}];let ds=(()=>{class Q{}return Q.\u0275fac=function(P){return new(P||Q)},Q.\u0275mod=_e.oAB({type:Q}),Q.\u0275inj=_e.cJS({imports:[Yo.Bz.forRoot(ko,{useHash:!1}),Yo.Bz]}),Q})();var nl=we(9898),Da=we(2340);let Zi=(()=>{class Q{constructor(){this.title="Puntos_de_CyL"}ngOnInit(){nl.accessToken=Da.N.mapboxToken}}return Q.\u0275fac=function(P){return new(P||Q)},Q.\u0275cmp=_e.Xpm({type:Q,selectors:[["app-root"]],decls:1,vars:0,template:function(P,j){1&P&&_e._UZ(0,"router-outlet")},dependencies:[Yo.lC]}),Q})(),_o=(()=>{class Q{}return Q.\u0275fac=function(P){return new(P||Q)},Q.\u0275mod=_e.oAB({type:Q,bootstrap:[Zi]}),Q.\u0275inj=_e.cJS({imports:[W.b2,ds,Na,Ro.JF]}),Q})();var pl=we(5226);if(!navigator.geolocation)throw we.n(pl)().fire("Error","El navegador no soporta la Geolocalizaci\xf3n","error"),new Error("El navegador no soporta la Geolocalizaci\xf3n");W.q6().bootstrapModule(_o).catch(Q=>console.error(Q))},9898:function(Yn){Yn.exports=function(){"use strict";var At,we,W;function _e(u,Ie){if(At)if(we){var Kt="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+At+")(sharedChunk); ("+we+")(sharedChunk); self.onerror = null;",Ut={};At(Ut),W=Ie(Ut),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(W.workerUrl=window.URL.createObjectURL(new Blob([Kt],{type:"text/javascript"})))}else we=Ie;else At=Ie}return _e(0,function(u){var Ie=typeof self<"u"?self:{},Kt="2.13.0";let Ut;const bt={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Ut){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Ut=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch{Ut=t}}return Ut},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},gt={supported:!1,testSupport:function(t){!Et&&ft&&(jn?Jt(t):nt=t)}};let nt,ft,Et=!1,jn=!1;function Jt(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,ft),t.isContextLost())return;gt.supported=!0}catch{}t.deleteTexture(e),Et=!0}Ie.document&&(ft=Ie.document.createElement("img"),ft.onload=function(){nt&&Jt(nt),nt=null,jn=!0},ft.onerror=function(){Et=!0,nt=null},ft.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const hn="01";var Qt=tr;function tr(t,e,n,s){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(s-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=e,this.p2x=n,this.p2y=s}tr.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,e){if(void 0===e&&(e=1e-6),t<0)return 0;if(t>1)return 1;for(var n=t,s=0;s<8;s++){var h=this.sampleCurveX(n)-t;if(Math.abs(h)<e)return n;var g=this.sampleCurveDerivativeX(n);if(Math.abs(g)<1e-6)break;n-=h/g}var _=0,w=1;for(n=t,s=0;s<20&&(h=this.sampleCurveX(n),!(Math.abs(h-t)<e));s++)t>h?_=n:w=n,n=.5*(w-_)+_;return n},solve:function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}};var dt=Lr;function Lr(t,e){this.x=t,this.y=e}Lr.prototype={clone:function(){return new Lr(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),s=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=s,this},_rotateAround:function(t,e){var n=Math.cos(t),s=Math.sin(t),h=e.y+s*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-s*(this.y-e.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Lr.convert=function(t){return t instanceof Lr?t:Array.isArray(t)?new Lr(t[0],t[1]):t};const Zr=Math.PI/180,Je=180/Math.PI;function Ne(t){return t*Zr}function mt(t){return t*Je}const ln=[[0,0],[1,0],[1,1],[0,1]];function Ue(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function en(t,e,n,s){const h=new Qt(t,e,n,s);return function(g){return h.solve(g)}}const Xt=en(.25,.1,.25,1);function $t(t,e,n){return Math.min(n,Math.max(e,t))}function an(t,e,n){return(n=$t((n-t)/(e-t),0,1))*n*(3-2*n)}function mn(t,e,n){const s=n-e,h=((t-e)%s+s)%s+e;return h===e?n:h}function Gt(t,e,n){if(!t.length)return n(null,[]);let s=t.length;const h=new Array(t.length);let g=null;t.forEach((_,w)=>{e(_,(T,D)=>{T&&(g=T),h[w]=D,0==--s&&n(g,h)})})}function lt(t){const e=[];for(const n in t)e.push(t[n]);return e}function rt(t,...e){for(const n of e)for(const s in n)t[s]=n[s];return t}let Dt=1;function It(){return Dt++}function Ht(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function Nt(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function Dn(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function yr(t,e){t.forEach(n=>{e[n]&&(e[n]=e[n].bind(e))})}function or(t,e){return-1!==t.indexOf(e,t.length-e.length)}function vn(t,e,n){const s={};for(const h in t)s[h]=e.call(n||this,t[h],h,t);return s}function In(t,e,n){const s={};for(const h in t)e.call(n||this,t[h],h,t)&&(s[h]=t[h]);return s}function cn(t){return Array.isArray(t)?t.map(cn):"object"==typeof t&&t?vn(t,cn):t}const pr={};function vr(t){pr[t]||(typeof console<"u"&&console.warn(t),pr[t]=!0)}function si(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function bn(t){let e=0;for(let n,s,h=0,g=t.length,_=g-1;h<g;_=h++)n=t[h],s=t[_],e+=(s.x-n.x)*(n.y+s.y);return e}function ni(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}function wr(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(n,s,h,g)=>{const _=h||g;return e[s]=!_||_.toLowerCase(),""}),e["max-age"]){const n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}let Yi=null;function yi(t){if(null==Yi){const e=t.navigator?t.navigator.userAgent:null;Yi=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return Yi}function Xr(t){try{const e=Ie[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch{return!1}}function Pn(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]}const jr="mapbox-tiles";let Br,ri,Pi=500,So=50;function Vn(){try{return Ie.caches}catch{}}function yn(){Vn()&&!Br&&(Br=Ie.caches.open(jr))}function Ri(t){const e=t.indexOf("?");if(e<0)return t;const s=function(h){const g=h.indexOf("?");return g>0?h.slice(g+1).split("&"):[]}(t).filter(h=>{const g=h.split("=");return"language"===g[0]||"worldview"===g[0]});return s.length?`${t.slice(0,e)}?${s.join("&")}`:t.slice(0,e)}let Mr=1/0;const on={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(on);class St extends Error{constructor(e,n,s){401===n&&kn(s)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=n,this.url=s}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const vi=ni()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Ie.location.protocol?Ie.parent:Ie).location.href,dr=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(vi())&&!/^\w+:/.test(n))){if(Ie.fetch&&Ie.Request&&Ie.AbortController&&Ie.Request.prototype.hasOwnProperty("signal"))return function(s,h){const g=new Ie.AbortController,_=new Ie.Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:vi(),signal:g.signal});let w=!1,T=!1;const D=(R=_.url).indexOf("sku=")>0&&kn(R);var R;"json"===s.type&&_.headers.set("Accept","application/json");const O=(V,G,J)=>{if(T)return;if(V&&"SecurityError"!==V.message&&vr(V),G&&J)return B(G);const ce=Date.now();Ie.fetch(_).then(xe=>{if(xe.ok){const Me=D?xe.clone():null;return B(xe,Me,ce)}return h(new St(xe.statusText,xe.status,s.url))}).catch(xe=>{"AbortError"!==xe.name&&h(new Error(`${xe.message} ${s.url}`))})},B=(V,G,J)=>{("arrayBuffer"===s.type?V.arrayBuffer():"json"===s.type?V.json():V.text()).then(ce=>{T||(G&&J&&function(xe,Me,ve){if(yn(),!Br)return;const Se={status:Me.status,statusText:Me.statusText,headers:new Ie.Headers};Me.headers.forEach((Ke,Ze)=>Se.headers.set(Ze,Ke));const Le=wr(Me.headers.get("Cache-Control")||"");if(Le["no-store"])return;Le["max-age"]&&Se.headers.set("Expires",new Date(ve+1e3*Le["max-age"]).toUTCString());const Pe=Se.headers.get("Expires");Pe&&(new Date(Pe).getTime()-ve<42e4||function(Ke,Ze){if(void 0===ri)try{new Response(new ReadableStream),ri=!0}catch{ri=!1}ri?Ze(Ke.body):Ke.blob().then(Ze)}(Me,Ke=>{const Ze=new Ie.Response(Ke,Se);yn(),Br&&Br.then(_t=>_t.put(Ri(xe.url),Ze)).catch(_t=>vr(_t.message))}))}(_,G,J),w=!0,h(null,ce,V.headers.get("Cache-Control"),V.headers.get("Expires")))}).catch(ce=>{T||h(new Error(ce.message))})};return D?function(V,G){if(yn(),!Br)return G(null);const J=Ri(V.url);Br.then(ce=>{ce.match(J).then(xe=>{const Me=function(ve){if(!ve)return!1;const Se=new Date(ve.headers.get("Expires")||0),Le=wr(ve.headers.get("Cache-Control")||"");return Se>Date.now()&&!Le["no-cache"]}(xe);ce.delete(J),Me&&ce.put(J,xe.clone()),G(null,xe,Me)}).catch(G)}).catch(G)}(_,O):O(null,null),{cancel:()=>{T=!0,w||g.abort()}}}(t,e);if(ni()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(s,h){const g=new Ie.XMLHttpRequest;g.open(s.method||"GET",s.url,!0),"arrayBuffer"===s.type&&(g.responseType="arraybuffer");for(const _ in s.headers)g.setRequestHeader(_,s.headers[_]);return"json"===s.type&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials="include"===s.credentials,g.onerror=()=>{h(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||0===g.status)&&null!==g.response){let _=g.response;if("json"===s.type)try{_=JSON.parse(g.response)}catch(w){return h(w)}h(null,_,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else h(new St(g.statusText,g.status,s.url))},g.send(s.body),{cancel:()=>g.abort()}}(t,e)},Nr=function(t,e){return dr(rt(t,{type:"arrayBuffer"}),e)};function io(t){const e=Ie.document.createElement("a");return e.href=t,e.protocol===Ie.document.location.protocol&&e.host===Ie.document.location.host}const ki="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let oo,Dr;oo=[],Dr=0;const po=function(t,e){if(gt.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Dr>=bt.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return oo.push(g),g}Dr++;let n=!1;const s=()=>{if(!n)for(n=!0,Dr--;oo.length&&Dr<bt.MAX_PARALLEL_IMAGE_REQUESTS;){const g=oo.shift(),{requestParameters:_,callback:w,cancelled:T}=g;T||(g.cancel=po(_,w).cancel)}},h=Nr(t,(g,_,w,T)=>{s(),g?e(g):_&&(Ie.createImageBitmap?function(D,R){const O=new Ie.Blob([new Uint8Array(D)],{type:"image/png"});Ie.createImageBitmap(O).then(B=>{R(null,B)}).catch(B=>{R(new Error(`Could not load image because of ${B.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(D,R)=>e(D,R,w,T)):function(D,R){const O=new Ie.Image,B=Ie.URL;O.onload=()=>{R(null,O),B.revokeObjectURL(O.src),O.onload=null,Ie.requestAnimationFrame(()=>{O.src=ki})},O.onerror=()=>R(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const V=new Ie.Blob([new Uint8Array(D)],{type:"image/png"});O.src=D.byteLength?B.createObjectURL(V):ki}(_,(D,R)=>e(D,R,w,T)))});return{cancel:()=>{h.cancel(),s()}}},gr="NO_ACCESS_TOKEN";function so(t){return 0===t.indexOf("mapbox:")}function kn(t){return bt.API_URL_REGEX.test(t)}function xi(t){return bt.API_CDN_URL_REGEX.test(t)}function $n(t){return bt.API_STYLE_REGEX.test(t)&&!pt(t)}function pt(t){return bt.API_SPRITE_REGEX.test(t)}const Fe=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Re(t){const e=t.match(Fe);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function Wt(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function Pt(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(Ie.atob(e[1]).split("").map(n=>"%"+("00"+n.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch{return null}}class Ln{constructor(e){this.type=e,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(e){const n=Pt(bt.ACCESS_TOKEN);let s="";return s=n&&n.u?Ie.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(h,g)=>String.fromCharCode(Number("0x"+g)))):bt.ACCESS_TOKEN||"",e?`mapbox.eventData.${e}:${s}`:`mapbox.eventData:${s}`}fetchEventData(){const e=Xr("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{const h=Ie.localStorage.getItem(n);h&&(this.eventData=JSON.parse(h));const g=Ie.localStorage.getItem(s);g&&(this.anonId=g)}catch{vr("Unable to read from LocalStorage")}}saveEventData(){const e=Xr("localStorage"),n=this.getStorageKey(),s=this.getStorageKey("uuid");if(e)try{Ie.localStorage.setItem(s,this.anonId),Object.keys(this.eventData).length>=1&&Ie.localStorage.setItem(n,JSON.stringify(this.eventData))}catch{vr("Unable to write to LocalStorage")}}processRequests(e){}postEvent(e,n,s,h){if(!bt.EVENTS_URL)return;const g=Re(bt.EVENTS_URL);g.params.push(`access_token=${h||bt.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(e).toISOString()},w=n?rt(_,n):_,T={url:Wt(g),headers:{"Content-Type":"text/plain"},body:JSON.stringify([w])};var R;this.pendingRequest=(R=D=>{this.pendingRequest=null,s(D),this.saveEventData(),this.processRequests(h)},dr(rt(T,{method:"POST"}),R))}queueRequest(e,n){this.queue.push(e),this.processRequests(n)}}const ue=new class extends Ln{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){bt.EVENTS_URL&&bt.ACCESS_TOKEN&&Array.isArray(t)&&t.some(n=>so(n)||kn(n))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=Pt(bt.ACCESS_TOKEN),n=e?e.u:bt.ACCESS_TOKEN;let s=n!==this.eventData.tokenU;Dn(this.anonId)||(this.anonId=Ht(),s=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const g=new Date(this.eventData.lastSuccess),_=new Date(h),w=(h-this.eventData.lastSuccess)/864e5;s=s||w>=1||w<-1||g.getDate()!==_.getDate()}else s=!0;s?this.postEvent(h,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Kt,skuId:hn,"enabled.telemetry":!1,userId:this.anonId},g=>{g||(this.eventData.lastSuccess=h,this.eventData.tokenU=n)},t):this.processRequests()}},H=ue.postTurnstileEvent.bind(ue),K=new class extends Ln{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,s){this.skuToken=e,this.errorCb=s,bt.EVENTS_URL&&(n||bt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(gr)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),Dn(this.anonId)||(this.anonId=Ht()),this.postEvent(n,{sdkIdentifier:"mapbox-gl-js",sdkVersion:Kt,skuId:hn,skuToken:this.skuToken,userId:this.anonId},s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t))}},de=K.postMapLoadEvent.bind(K),Ee=new class extends Ln{constructor(){super("gljs.performance")}postPerformanceEvent(t,e){bt.EVENTS_URL&&(t||bt.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:e},t)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:e,performanceData:n}=this.queue.shift(),s=function(h){const g=Ie.performance.getEntriesByType("resource"),_=Ie.performance.getEntriesByType("mark"),w=function(B){const V={};if(B)for(const G in B)if("other"!==G)for(const J of B[G]){const ce=`${G}ResolveRangeMin`,xe=`${G}ResolveRangeMax`,Me=`${G}RequestCount`,ve=`${G}RequestCachedCount`;V[ce]=Math.min(V[ce]||1/0,J.startTime),V[xe]=Math.max(V[xe]||-1/0,J.responseEnd);const Se=Le=>{void 0===V[Le]&&(V[Le]=0),++V[Le]};void 0!==J.transferSize&&0===J.transferSize&&Se(ve),Se(Me)}return V}(function(B,V){const G={};if(B)for(const J of B){const ce=V(J);void 0===G[ce]&&(G[ce]=[]),G[ce].push(J)}return G}(g,ht)),T=Ie.devicePixelRatio,D=Ie.navigator.connection||Ie.navigator.mozConnection||Ie.navigator.webkitConnection,R={counters:[],metadata:[],attributes:[]},O=(B,V,G)=>{null!=G&&B.push({name:V,value:G.toString()})};for(const B in w)O(R.counters,B,w[B]);if(h.interactionRange[0]!==1/0&&h.interactionRange[1]!==-1/0&&(O(R.counters,"interactionRangeMin",h.interactionRange[0]),O(R.counters,"interactionRangeMax",h.interactionRange[1])),_)for(const B of Object.keys(pe)){const V=pe[B],G=_.find(J=>J.name===V);G&&O(R.counters,V,G.startTime)}return O(R.counters,"visibilityHidden",h.visibilityHidden),O(R.attributes,"style",function(B){if(B)for(const V of B){const G=V.name.split("?")[0];if($n(G)){const J=G.split("/").slice(-2);if(2===J.length)return`mapbox://styles/${J[0]}/${J[1]}`}}}(g)),O(R.attributes,"terrainEnabled",h.terrainEnabled?"true":"false"),O(R.attributes,"fogEnabled",h.fogEnabled?"true":"false"),O(R.attributes,"projection",h.projection),O(R.attributes,"zoom",h.zoom),O(R.metadata,"devicePixelRatio",T),O(R.metadata,"connectionEffectiveType",D?D.effectiveType:void 0),O(R.metadata,"navigatorUserAgent",Ie.navigator.userAgent),O(R.metadata,"screenWidth",Ie.screen.width),O(R.metadata,"screenHeight",Ie.screen.height),O(R.metadata,"windowWidth",Ie.innerWidth),O(R.metadata,"windowHeight",Ie.innerHeight),O(R.metadata,"mapWidth",h.width/T),O(R.metadata,"mapHeight",h.height/T),O(R.metadata,"webglRenderer",h.renderer),O(R.metadata,"webglVendor",h.vendor),O(R.metadata,"sdkVersion",Kt),O(R.metadata,"sdkIdentifier","mapbox-gl-js"),R}(n);for(const h of s.metadata);for(const h of s.counters);for(const h of s.attributes);this.postEvent(e,s,()=>{},t)}},ne=Ee.postPerformanceEvent.bind(Ee),ie=new class extends Ln{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,s){if(!bt.API_URL||!bt.SESSION_PATH)return;const h=Re(bt.API_URL+bt.SESSION_PATH);h.params.push(`sku=${e||""}`),h.params.push(`access_token=${s||bt.ACCESS_TOKEN||""}`);const g={url:Wt(h),headers:{"Content-Type":"text/plain"}};var w;this.pendingRequest=(w=_=>{this.pendingRequest=null,n(_),this.saveEventData(),this.processRequests(s)},dr(rt(g,{method:"GET"}),w))}getSessionAPI(t,e,n,s){this.skuToken=e,this.errorCb=s,bt.SESSION_PATH&&bt.API_URL&&(n||bt.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(gr)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,s=>{s?this.errorCb(s):e&&(this.success[e]=!0)},t)}},q=ie.getSessionAPI.bind(ie),re=new Set,pe={create:"create",load:"load",fullLoad:"fullLoad"},je={mark(t){Ie.performance.mark(t)},measure(t,e,n){Ie.performance.measure(t,e,n)}};function ht(t){const e=t.name.split("?")[0];return xi(e)&&e.includes("mapbox-gl.js")?"javascript":xi(e)&&e.includes("mapbox-gl.css")?"css":bt.API_FONTS_REGEX.test(e)?"fontRange":pt(e)?"sprite":$n(e)?"style":bt.API_TILEJSON_REGEX.test(e)?"tilejson":"other"}const ut=Ie.performance;function sn(t){const e=t?t.url.toString():void 0;return ut.getEntriesByName(e)}let dn,Rt,xn,rr;const xr={now:()=>void 0!==xn?xn:Ie.performance.now(),setNow(t){xn=t},restoreNow(){xn=void 0},frame(t){const e=Ie.requestAnimationFrame(t);return{cancel:()=>Ie.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:n,height:s}=t;rr||(rr=Ie.document.createElement("canvas"));const h=rr.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(n>rr.width||s>rr.height)&&(rr.width=n,rr.height=s),h.clearRect(-e,-e,n+2*e,s+2*e),h.drawImage(t,0,0,n,s),h.getImageData(-e,-e,n+2*e,s+2*e)},resolveURL:t=>(dn||(dn=Ie.document.createElement("a")),dn.href=t,dn.href),get devicePixelRatio(){return Ie.devicePixelRatio},get prefersReducedMotion(){return!!Ie.matchMedia&&(null==Rt&&(Rt=Ie.matchMedia("(prefers-reduced-motion: reduce)")),Rt.matches)}};function Sn(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function Pr(t,e,n){if(n&&n[t]){const s=n[t].indexOf(e);-1!==s&&n[t].splice(s,1)}}class Or{constructor(e,n={}){rt(this,n),this.type=e}}class Ji extends Or{constructor(e,n={}){super("error",rt({error:e},n))}}class Hi{on(e,n){return this._listeners=this._listeners||{},Sn(e,n,this._listeners),this}off(e,n){return Pr(e,n,this._listeners),Pr(e,n,this._oneTimeListeners),this}once(e,n){return n?(this._oneTimeListeners=this._oneTimeListeners||{},Sn(e,n,this._oneTimeListeners),this):new Promise(s=>this.once(e,s))}fire(e,n){"string"==typeof e&&(e=new Or(e,n||{}));const s=e.type;if(this.listens(s)){e.target=this;const h=this._listeners&&this._listeners[s]?this._listeners[s].slice():[];for(const w of h)w.call(this,e);const g=this._oneTimeListeners&&this._oneTimeListeners[s]?this._oneTimeListeners[s].slice():[];for(const w of g)Pr(s,w,this._oneTimeListeners),w.call(this,e);const _=this._eventedParent;_&&(rt(e,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(e))}else e instanceof Ji&&console.error(e.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,n){return this._eventedParent=e,this._eventedParentData=n,this}}var ct=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"},"fill-extrusion-edge-radius":{"type":"number","private":true,"default":0,"minimum":0,"maximum":1,"property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant","type":"number","private":true,"default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant","type":"number","private":true,"default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["fill-extrusion-edge-radius"]}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":false,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function $r(t,...e){for(const n of e)for(const s in n)t[s]=n[s];return t}function qn(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function wi(t){if(Array.isArray(t))return t.map(wi);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=wi(t[n]);return e}return qn(t)}class Bi extends Error{constructor(e,n){super(n),this.message=n,this.key=e}}var ai=Bi;class Gr{constructor(e,n=[]){this.parent=e,this.bindings={};for(const[s,h]of n)this.bindings[s]=h}concat(e){return new Gr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error(`${e} not found in scope.`)}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}var Ks=Gr;const is={kind:"null"},Zt={kind:"number"},On={kind:"string"},Ot={kind:"boolean"},Gn={kind:"color"},Ur={kind:"object"},Nn={kind:"value"},mo={kind:"collator"},Jr={kind:"formatted"},Mo={kind:"resolvedImage"};function ir(t,e){return{kind:"array",itemType:t,N:e}}function Cr(t){if("array"===t.kind){const e=Cr(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const os=[is,Zt,On,Ot,Gn,Jr,Ur,ir(Nn),Mo];function An(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!An(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const n of os)if(!An(n,e))return null}return`Expected ${Cr(t)} but found ${Cr(e)} instead.`}function Es(t,e){return e.some(n=>n.kind===t.kind)}function bi(t,e){return e.some(n=>"null"===n?null===t:"array"===n?Array.isArray(t):"object"===n?t&&!Array.isArray(t)&&"object"==typeof t:n===typeof t)}var Bs,Qi={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function li(t){return(t=Math.round(t))<0?0:t>255?255:t}function ao(t){return li("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function hi(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function lo(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{Bs={}.parseCSSColor=function(t){var e,n=t.replace(/ /g,"").toLowerCase();if(n in Qi)return Qi[n].slice();if("#"===n[0])return 4===n.length?(e=parseInt(n.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===n.length&&(e=parseInt(n.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var s=n.indexOf("("),h=n.indexOf(")");if(-1!==s&&h+1===n.length){var g=n.substr(0,s),_=n.substr(s+1,h-(s+1)).split(","),w=1;switch(g){case"rgba":if(4!==_.length)return null;w=hi(_.pop());case"rgb":return 3!==_.length?null:[ao(_[0]),ao(_[1]),ao(_[2]),w];case"hsla":if(4!==_.length)return null;w=hi(_.pop());case"hsl":if(3!==_.length)return null;var T=(parseFloat(_[0])%360+360)%360/360,D=hi(_[1]),R=hi(_[2]),O=R<=.5?R*(D+1):R+D-R*D,B=2*R-O;return[li(255*lo(B,O,T+1/3)),li(255*lo(B,O,T)),li(255*lo(B,O,T-1/3)),w];default:return null}}return null}}catch{}class Li{constructor(e,n,s,h=1){this.r=e,this.g=n,this.b=s,this.a=h}static parse(e){if(!e)return;if(e instanceof Li)return e;if("string"!=typeof e)return;const n=Bs(e);return n?new Li(n[0]/255*n[3],n[1]/255*n[3],n[2]/255*n[3],n[3]):void 0}toString(){const[e,n,s,h]=this.toArray();return`rgba(${Math.round(e)},${Math.round(n)},${Math.round(s)},${h})`}toArray(){const{r:e,g:n,b:s,a:h}=this;return 0===h?[0,0,0,0]:[255*e/h,255*n/h,255*s/h,h]}toArray01(){const{r:e,g:n,b:s,a:h}=this;return 0===h?[0,0,0,0]:[e/h,n/h,s/h,h]}toArray01PremultipliedAlpha(){const{r:e,g:n,b:s,a:h}=this;return[e,n,s,h]}}Li.black=new Li(0,0,0,1),Li.white=new Li(1,1,1,1),Li.transparent=new Li(0,0,0,0),Li.red=new Li(1,0,0,1),Li.blue=new Li(0,0,1,1);var Qr=Li;class Hr{constructor(e,n,s){this.sensitivity=e?n?"variant":"case":n?"accent":"base",this.locale=s,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,n){return this.collator.compare(e,n)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Bo{constructor(e,n,s,h,g){this.text=e.normalize?e.normalize():e,this.image=n,this.scale=s,this.fontStack=h,this.textColor=g}}class Wi{constructor(e){this.sections=e}static fromString(e){return new Wi([new Bo(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||e.image&&0!==e.image.name.length)}static factory(e){return e instanceof Wi?e:Wi.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const n of this.sections){if(n.image){e.push(["image",n.image.name]);continue}e.push(n.text);const s={};n.fontStack&&(s["text-font"]=["literal",n.fontStack.split(",")]),n.scale&&(s["font-scale"]=n.scale),n.textColor&&(s["text-color"]=["rgba"].concat(n.textColor.toArray())),e.push(s)}return e}}class co{constructor(e){this.name=e.name,this.available=e.available}toString(){return this.name}static fromString(e){return e?new co({name:e,available:!1}):null}serialize(){return["image",this.name]}}function Ns(t,e,n,s){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===s||"number"==typeof s&&s>=0&&s<=1?null:`Invalid rgba value [${[t,e,n,s].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof s?[t,e,n,s]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ys(t){if(null===t||"string"==typeof t||"boolean"==typeof t||"number"==typeof t||t instanceof Qr||t instanceof Hr||t instanceof Wi||t instanceof co)return!0;if(Array.isArray(t)){for(const e of t)if(!Ys(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!Ys(t[e]))return!1;return!0}return!1}function ii(t){if(null===t)return is;if("string"==typeof t)return On;if("boolean"==typeof t)return Ot;if("number"==typeof t)return Zt;if(t instanceof Qr)return Gn;if(t instanceof Hr)return mo;if(t instanceof Wi)return Jr;if(t instanceof co)return Mo;if(Array.isArray(t)){const e=t.length;let n;for(const s of t){const h=ii(s);if(n){if(n===h)continue;n=Nn;break}n=h}return ir(n||Nn,e)}return Ur}function Ni(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof Qr||t instanceof Wi||t instanceof co?t.toString():JSON.stringify(t)}class xa{constructor(e,n){this.type=e,this.value=n}static parse(e,n){if(2!==e.length)return n.error(`'literal' expression requires exactly one argument, but found ${e.length-1} instead.`);if(!Ys(e[1]))return n.error("invalid value");const s=e[1];let h=ii(s);const g=n.expectedType;return"array"!==h.kind||0!==h.N||!g||"array"!==g.kind||"number"==typeof g.N&&0!==g.N||(h=g),new xa(h,s)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Qr?["rgba"].concat(this.value.toArray()):this.value instanceof Wi?this.value.serialize():this.value}}var Ui=xa,Wr=class{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}};const ra={string:On,number:Zt,boolean:Ot,object:Ur};class Wo{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");let s,h=1;const g=e[0];if("array"===g){let w,T;if(e.length>2){const D=e[1];if("string"!=typeof D||!(D in ra)||"object"===D)return n.error('The item type argument of "array" must be one of string, number, boolean',1);w=ra[D],h++}else w=Nn;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return n.error('The length argument to "array" must be a positive integer literal',2);T=e[2],h++}s=ir(w,T)}else s=ra[g];const _=[];for(;h<e.length;h++){const w=n.parse(e[h],h,Nn);if(!w)return null;_.push(w)}return new Wo(s,_)}evaluate(e){for(let n=0;n<this.args.length;n++){const s=this.args[n].evaluate(e);if(!An(this.type,ii(s)))return s;if(n===this.args.length-1)throw new Wr(`Expected value to be of type ${Cr(this.type)}, but found ${Cr(ii(s))} instead.`)}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,n=[e.kind];if("array"===e.kind){const s=e.itemType;if("string"===s.kind||"number"===s.kind||"boolean"===s.kind){n.push(s.kind);const h=e.N;("number"==typeof h||this.args.length>1)&&n.push(h)}}return n.concat(this.args.map(s=>s.serialize()))}}var Io=Wo;class eo{constructor(e){this.type=Jr,this.sections=e}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[1];if(!Array.isArray(s)&&"object"==typeof s)return n.error("First argument must be an image or text section.");const h=[];let g=!1;for(let _=1;_<=e.length-1;++_){const w=e[_];if(g&&"object"==typeof w&&!Array.isArray(w)){g=!1;let T=null;if(w["font-scale"]&&(T=n.parse(w["font-scale"],1,Zt),!T))return null;let D=null;if(w["text-font"]&&(D=n.parse(w["text-font"],1,ir(On)),!D))return null;let R=null;if(w["text-color"]&&(R=n.parse(w["text-color"],1,Gn),!R))return null;const O=h[h.length-1];O.scale=T,O.font=D,O.textColor=R}else{const T=n.parse(e[_],1,Nn);if(!T)return null;const D=T.type.kind;if("string"!==D&&"value"!==D&&"null"!==D&&"resolvedImage"!==D)return n.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:T,scale:null,font:null,textColor:null})}}return new eo(h)}evaluate(e){return new Wi(this.sections.map(n=>{const s=n.content.evaluate(e);return ii(s)===Mo?new Bo("",s,null,null,null):new Bo(Ni(s),null,n.scale?n.scale.evaluate(e):null,n.font?n.font.evaluate(e).join(","):null,n.textColor?n.textColor.evaluate(e):null)}))}eachChild(e){for(const n of this.sections)e(n.content),n.scale&&e(n.scale),n.font&&e(n.font),n.textColor&&e(n.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const n of this.sections){e.push(n.content.serialize());const s={};n.scale&&(s["font-scale"]=n.scale.serialize()),n.font&&(s["text-font"]=n.font.serialize()),n.textColor&&(s["text-color"]=n.textColor.serialize()),e.push(s)}return e}}class Js{constructor(e){this.type=Mo,this.input=e}static parse(e,n){if(2!==e.length)return n.error("Expected two arguments.");const s=n.parse(e[1],1,On);return s?new Js(s):n.error("No image name provided.")}evaluate(e){const n=this.input.evaluate(e),s=co.fromString(n);return s&&e.availableImages&&(s.available=e.availableImages.indexOf(n)>-1),s}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const wa={"to-boolean":Ot,"to-color":Gn,"to-number":Zt,"to-string":On};class No{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expected at least one argument.");const s=e[0];if(("to-boolean"===s||"to-string"===s)&&2!==e.length)return n.error("Expected one argument.");const h=wa[s],g=[];for(let _=1;_<e.length;_++){const w=n.parse(e[_],_,Nn);if(!w)return null;g.push(w)}return new No(h,g)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let n,s;for(const h of this.args){if(n=h.evaluate(e),s=null,n instanceof Qr)return n;if("string"==typeof n){const g=e.parseColor(n);if(g)return g}else if(Array.isArray(n)&&(s=n.length<3||n.length>4?`Invalid rbga value ${JSON.stringify(n)}: expected an array containing either three or four numeric values.`:Ns(n[0],n[1],n[2],n[3]),!s))return new Qr(n[0]/255,n[1]/255,n[2]/255,n[3])}throw new Wr(s||`Could not parse color from value '${"string"==typeof n?n:String(JSON.stringify(n))}'`)}if("number"===this.type.kind){let n=null;for(const s of this.args){if(n=s.evaluate(e),null===n)return 0;const h=Number(n);if(!isNaN(h))return h}throw new Wr(`Could not convert ${JSON.stringify(n)} to number.`)}return"formatted"===this.type.kind?Wi.fromString(Ni(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?co.fromString(Ni(this.args[0].evaluate(e))):Ni(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new eo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Js(this.args[0]).serialize();const e=[`to-${this.type.kind}`];return this.eachChild(n=>{e.push(n.serialize())}),e}}var wo=No;const Ja=["Unknown","Point","LineString","Polygon"];var Us=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ja[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:s}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(s*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=Qr.parse(t)),e}};class Ts{constructor(e,n,s,h){this.name=e,this.type=n,this._evaluate=s,this.args=h}evaluate(e){return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,n){const s=e[0],h=Ts.definitions[s];if(!h)return n.error(`Unknown expression "${s}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,w=_.filter(([D])=>!Array.isArray(D)||D.length===e.length-1);let T=null;for(const[D,R]of w){T=new $s(n.registry,n.path,null,n.scope);const O=[];let B=!1;for(let V=1;V<e.length;V++){const G=e[V],J=Array.isArray(D)?D[V-1]:D.type,ce=T.parse(G,1+O.length,J);if(!ce){B=!0;break}O.push(ce)}if(!B)if(Array.isArray(D)&&D.length!==O.length)T.error(`Expected ${D.length} arguments, but found ${O.length} instead.`);else{for(let V=0;V<O.length;V++){const G=Array.isArray(D)?D[V]:D.type,J=O[V];T.concat(V+1).checkSubtype(G,J.type)}if(0===T.errors.length)return new Ts(s,g,R,O)}}if(1===w.length)n.errors.push(...T.errors);else{const D=(w.length?w:_).map(([O])=>{return B=O,Array.isArray(B)?`(${B.map(Cr).join(", ")})`:`(${Cr(B.type)}...)`;var B}).join(" | "),R=[];for(let O=1;O<e.length;O++){const B=n.parse(e[O],1+R.length);if(!B)return null;R.push(Cr(B.type))}n.error(`Expected arguments of type ${D}, but found (${R.join(", ")}) instead.`)}return null}static register(e,n){Ts.definitions=n;for(const s in n)e[s]=Ts}}var to=Ts;class ia{constructor(e,n,s){this.type=mo,this.locale=s,this.caseSensitive=e,this.diacriticSensitive=n}static parse(e,n){if(2!==e.length)return n.error("Expected one argument.");const s=e[1];if("object"!=typeof s||Array.isArray(s))return n.error("Collator options argument must be an object.");const h=n.parse(void 0!==s["case-sensitive"]&&s["case-sensitive"],1,Ot);if(!h)return null;const g=n.parse(void 0!==s["diacritic-sensitive"]&&s["diacritic-sensitive"],1,Ot);if(!g)return null;let _=null;return s.locale&&(_=n.parse(s.locale,1,On),!_)?null:new ia(h,g,_)}evaluate(e){return new Hr(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}const js=8192;function uo(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function oa(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Fa(t,e){const n=(180+t[0])/360,s=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,h=Math.pow(2,e.z);return[Math.round(n*h*js),Math.round(s*h*js)]}function za(t,e,n){const s=t[0]-e[0],h=t[1]-e[1],g=t[0]-n[0],_=t[1]-n[1];return s*_-g*h==0&&s*g<=0&&h*_<=0}function sa(t,e){let n=!1;for(let _=0,w=e.length;_<w;_++){const T=e[_];for(let D=0,R=T.length;D<R-1;D++){if(za(t,T[D],T[D+1]))return!1;(h=T[D])[1]>(s=t)[1]!=(g=T[D+1])[1]>s[1]&&s[0]<(g[0]-h[0])*(s[1]-h[1])/(g[1]-h[1])+h[0]&&(n=!n)}}var s,h,g;return n}function bo(t,e){for(let n=0;n<e.length;n++)if(sa(t,e[n]))return!0;return!1}function aa(t,e,n,s){const h=s[0]-n[0],g=s[1]-n[1],_=(t[0]-n[0])*g-h*(t[1]-n[1]),w=(e[0]-n[0])*g-h*(e[1]-n[1]);return _>0&&w<0||_<0&&w>0}function Eo(t,e,n){for(const D of n)for(let R=0;R<D.length-1;++R)if((w=[(_=D[R+1])[0]-(g=D[R])[0],_[1]-g[1]])[0]*(T=[(h=e)[0]-(s=t)[0],h[1]-s[1]])[1]-w[1]*T[0]!=0&&aa(s,h,g,_)&&aa(g,_,s,h))return!0;var s,h,g,_,w,T;return!1}function Vs(t,e){for(let n=0;n<t.length;++n)if(!sa(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Eo(t[n],t[n+1],e))return!1;return!0}function Qa(t,e){for(let n=0;n<e.length;n++)if(Vs(t,e[n]))return!0;return!1}function la(t,e,n){const s=[];for(let h=0;h<t.length;h++){const g=[];for(let _=0;_<t[h].length;_++){const w=Fa(t[h][_],n);uo(e,w),g.push(w)}s.push(g)}return s}function go(t,e,n){const s=[];for(let h=0;h<t.length;h++){const g=la(t[h],e,n);s.push(g)}return s}function Ds(t,e,n,s){if(t[0]<n[0]||t[0]>n[2]){const h=.5*s;let g=t[0]-n[0]>h?-s:n[0]-t[0]>h?s:0;0===g&&(g=t[0]-n[2]>h?-s:n[2]-t[0]>h?s:0),t[0]+=g}uo(e,t)}function ss(t,e,n,s){const h=Math.pow(2,s.z)*js,g=[s.x*js,s.y*js],_=[];if(!t)return _;for(const w of t)for(const T of w){const D=[T.x+g[0],T.y+g[1]];Ds(D,e,n,h),_.push(D)}return _}function mr(t,e,n,s){const h=Math.pow(2,s.z)*js,g=[s.x*js,s.y*js],_=[];if(!t)return _;for(const T of t){const D=[];for(const R of T){const O=[R.x+g[0],R.y+g[1]];uo(e,O),D.push(O)}_.push(D)}if(e[2]-e[0]<=h/2){(w=e)[0]=w[1]=1/0,w[2]=w[3]=-1/0;for(const T of _)for(const D of T)Ds(D,e,n,h)}var w;return _}class ba{constructor(e,n){this.type=Ot,this.geojson=e,this.geometries=n}static parse(e,n){if(2!==e.length)return n.error(`'within' expression requires exactly one argument, but found ${e.length-1} instead.`);if(Ys(e[1])){const s=e[1];if("FeatureCollection"===s.type)for(let h=0;h<s.features.length;++h){const g=s.features[h].geometry.type;if("Polygon"===g||"MultiPolygon"===g)return new ba(s,s.features[h].geometry)}else if("Feature"===s.type){const h=s.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new ba(s,s.geometry)}else if("Polygon"===s.type||"MultiPolygon"===s.type)return new ba(s,s)}return n.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(n,s){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(!_)return!1;if("Polygon"===s.type){const w=la(s.coordinates,g,_),T=ss(n.geometry(),h,g,_);if(!oa(h,g))return!1;for(const D of T)if(!sa(D,w))return!1}if("MultiPolygon"===s.type){const w=go(s.coordinates,g,_),T=ss(n.geometry(),h,g,_);if(!oa(h,g))return!1;for(const D of T)if(!bo(D,w))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(n,s){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],_=n.canonicalID();if(!_)return!1;if("Polygon"===s.type){const w=la(s.coordinates,g,_),T=mr(n.geometry(),h,g,_);if(!oa(h,g))return!1;for(const D of T)if(!Vs(D,w))return!1}if("MultiPolygon"===s.type){const w=go(s.coordinates,g,_),T=mr(n.geometry(),h,g,_);if(!oa(h,g))return!1;for(const D of T)if(!Qa(D,w))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var qo=ba;function Zo(t){if(t instanceof to&&("get"===t.name&&1===t.args.length||"feature-state"===t.name||"has"===t.name&&1===t.args.length||"properties"===t.name||"geometry-type"===t.name||"id"===t.name||/^filter-/.test(t.name))||t instanceof qo)return!1;let e=!0;return t.eachChild(n=>{e&&!Zo(n)&&(e=!1)}),e}function as(t){if(t instanceof to&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(n=>{e&&!as(n)&&(e=!1)}),e}function qi(t,e){if(t instanceof to&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(s=>{n&&!qi(s,e)&&(n=!1)}),n}class Ao{constructor(e,n){this.type=n.type,this.name=e,this.boundExpression=n}static parse(e,n){if(2!==e.length||"string"!=typeof e[1])return n.error("'var' expression requires exactly one string literal argument.");const s=e[1];return n.scope.has(s)?new Ao(s,n.scope.get(s)):n.error(`Unknown variable "${s}". Make sure "${s}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Cs=Ao;class no{constructor(e,n=[],s,h=new Ks,g=[]){this.registry=e,this.path=n,this.key=n.map(_=>`[${_}]`).join(""),this.scope=h,this.errors=g,this.expectedType=s}parse(e,n,s,h,g={}){return n?this.concat(n,s,h)._parse(e,g):this._parse(e,g)}_parse(e,n){function s(h,g,_){return"assert"===_?new Io(g,[h]):"coerce"===_?new wo(g,[h]):h}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=e[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const g=this.registry[h];if(g){let _=g.parse(e,this);if(!_)return null;if(this.expectedType){const w=this.expectedType,T=_.type;if("string"!==w.kind&&"number"!==w.kind&&"boolean"!==w.kind&&"object"!==w.kind&&"array"!==w.kind||"value"!==T.kind)if("color"!==w.kind&&"formatted"!==w.kind&&"resolvedImage"!==w.kind||"value"!==T.kind&&"string"!==T.kind){if(this.checkSubtype(w,T))return null}else _=s(_,w,n.typeAnnotation||"coerce");else _=s(_,w,n.typeAnnotation||"assert")}if(!(_ instanceof Ui)&&"resolvedImage"!==_.type.kind&&Ss(_)){const w=new Us;try{_=new Ui(_.type,_.evaluate(w))}catch(T){return this.error(T.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof e} instead.`)}concat(e,n,s){const h="number"==typeof e?this.path.concat(e):this.path,g=s?this.scope.concat(s):this.scope;return new no(this.registry,h,n||null,g,this.errors)}error(e,...n){const s=`${this.key}${n.map(h=>`[${h}]`).join("")}`;this.errors.push(new ai(s,e))}checkSubtype(e,n){const s=An(e,n);return s&&this.error(s),s}}var $s=no;function Ss(t){if(t instanceof Cs)return Ss(t.boundExpression);if(t instanceof to&&"error"===t.name||t instanceof ia||t instanceof qo)return!1;const e=t instanceof wo||t instanceof Io;let n=!0;return t.eachChild(s=>{n=e?n&&Ss(s):n&&s instanceof Ui}),!!n&&Zo(t)&&qi(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function di(t,e){const n=t.length-1;let s,h,g=0,_=n,w=0;for(;g<=_;)if(w=Math.floor((g+_)/2),s=t[w],h=t[w+1],s<=e){if(w===n||e<h)return w;g=w+1}else{if(!(s>e))throw new Wr("Input is not a number.");_=w-1}return 0}class ca{constructor(e,n,s){this.type=e,this.input=n,this.labels=[],this.outputs=[];for(const[h,g]of s)this.labels.push(h),this.outputs.push(g)}static parse(e,n){if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");const s=n.parse(e[1],1,Zt);if(!s)return null;const h=[];let g=null;n.expectedType&&"value"!==n.expectedType.kind&&(g=n.expectedType);for(let _=1;_<e.length;_+=2){const w=1===_?-1/0:e[_],T=e[_+1],D=_,R=_+1;if("number"!=typeof w)return n.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',D);if(h.length&&h[h.length-1][0]>=w)return n.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',D);const O=n.parse(T,R,g);if(!O)return null;g=g||O.type,h.push([w,O])}return new ca(g,s,h)}evaluate(e){const n=this.labels,s=this.outputs;if(1===n.length)return s[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return s[0].evaluate(e);const g=n.length;return h>=n[g-1]?s[g-1].evaluate(e):s[di(n,h)].evaluate(e)}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let n=0;n<this.labels.length;n++)n>0&&e.push(this.labels[n]),e.push(this.outputs[n].serialize());return e}}var ls=ca;function Jn(t,e,n){return t*(1-n)+e*n}var Xo=Object.freeze({__proto__:null,number:Jn,color:function(t,e,n){return new Qr(Jn(t.r,e.r,n),Jn(t.g,e.g,n),Jn(t.b,e.b,n),Jn(t.a,e.a,n))},array:function(t,e,n){return t.map((s,h)=>Jn(s,e[h],n))}});const Ba=.95047,cs=1.08883,ei=4/29,us=6/29,Ko=3*us*us,el=Math.PI/180,Gs=180/Math.PI;function Ms(t){return t>.008856451679035631?Math.pow(t,1/3):t/Ko+ei}function Po(t){return t>us?t*t*t:Ko*(t-ei)}function nr(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function ua(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function Qs(t){const e=ua(t.r),n=ua(t.g),s=ua(t.b),h=Ms((.4124564*e+.3575761*n+.1804375*s)/Ba),g=Ms((.2126729*e+.7151522*n+.072175*s)/1);return{l:116*g-16,a:500*(h-g),b:200*(g-Ms((.0193339*e+.119192*n+.9503041*s)/cs)),alpha:t.a}}function ea(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,s=isNaN(t.b)?e:e-t.b/200;return e=1*Po(e),n=Ba*Po(n),s=cs*Po(s),new Qr(nr(3.2404542*n-1.5371385*e-.4985314*s),nr(-.969266*n+1.8760108*e+.041556*s),nr(.0556434*n-.2040259*e+1.0572252*s),t.alpha)}function Ti(t,e,n){const s=e-t;return t+n*(s>180||s<-180?s-360*Math.round(s/360):s)}const Ea={forward:Qs,reverse:ea,interpolate:function(t,e,n){return{l:Jn(t.l,e.l,n),a:Jn(t.a,e.a,n),b:Jn(t.b,e.b,n),alpha:Jn(t.alpha,e.alpha,n)}}},hs={forward:function(t){const{l:e,a:n,b:s}=Qs(t),h=Math.atan2(s,n)*Gs;return{h:h<0?h+360:h,c:Math.sqrt(n*n+s*s),l:e,alpha:t.a}},reverse:function(t){const e=t.h*el,n=t.c;return ea({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:Ti(t.h,e.h,n),c:Jn(t.c,e.c,n),l:Jn(t.l,e.l,n),alpha:Jn(t.alpha,e.alpha,n)}}};var ha=Object.freeze({__proto__:null,lab:Ea,hcl:hs});class Ta{constructor(e,n,s,h,g){this.type=e,this.operator=n,this.interpolation=s,this.input=h,this.labels=[],this.outputs=[];for(const[_,w]of g)this.labels.push(_),this.outputs.push(w)}static interpolationFactor(e,n,s,h){let g=0;if("exponential"===e.name)g=zt(n,e.base,s,h);else if("linear"===e.name)g=zt(n,1,s,h);else if("cubic-bezier"===e.name){const _=e.controlPoints;g=new Qt(_[0],_[1],_[2],_[3]).solve(zt(n,1,s,h))}return g}static parse(e,n){let[s,h,g,..._]=e;if(!Array.isArray(h)||0===h.length)return n.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const D=h[1];if("number"!=typeof D)return n.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:D}}else{if("cubic-bezier"!==h[0])return n.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const D=h.slice(1);if(4!==D.length||D.some(R=>"number"!=typeof R||R<0||R>1))return n.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:D}}}if(e.length-1<4)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if((e.length-1)%2!=0)return n.error("Expected an even number of arguments.");if(g=n.parse(g,2,Zt),!g)return null;const w=[];let T=null;"interpolate-hcl"===s||"interpolate-lab"===s?T=Gn:n.expectedType&&"value"!==n.expectedType.kind&&(T=n.expectedType);for(let D=0;D<_.length;D+=2){const R=_[D],O=_[D+1],B=D+3,V=D+4;if("number"!=typeof R)return n.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',B);if(w.length&&w[w.length-1][0]>=R)return n.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',B);const G=n.parse(O,V,T);if(!G)return null;T=T||G.type,w.push([R,G])}return"number"===T.kind||"color"===T.kind||"array"===T.kind&&"number"===T.itemType.kind&&"number"==typeof T.N?new Ta(T,s,h,g,w):n.error(`Type ${Cr(T)} is not interpolatable.`)}evaluate(e){const n=this.labels,s=this.outputs;if(1===n.length)return s[0].evaluate(e);const h=this.input.evaluate(e);if(h<=n[0])return s[0].evaluate(e);const g=n.length;if(h>=n[g-1])return s[g-1].evaluate(e);const _=di(n,h),w=Ta.interpolationFactor(this.interpolation,h,n[_],n[_+1]),T=s[_].evaluate(e),D=s[_+1].evaluate(e);return"interpolate"===this.operator?Xo[this.type.kind.toLowerCase()](T,D,w):"interpolate-hcl"===this.operator?hs.reverse(hs.interpolate(hs.forward(T),hs.forward(D),w)):Ea.reverse(Ea.interpolate(Ea.forward(T),Ea.forward(D),w))}eachChild(e){e(this.input);for(const n of this.outputs)e(n)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const n=[this.operator,e,this.input.serialize()];for(let s=0;s<this.labels.length;s++)n.push(this.labels[s],this.outputs[s].serialize());return n}}function zt(t,e,n,s){const h=s-n,g=t-n;return 0===h?0:1===e?g/h:(Math.pow(e,g)-1)/(Math.pow(e,h)-1)}var sr=Ta;class da{constructor(e,n){this.type=e,this.args=n}static parse(e,n){if(e.length<2)return n.error("Expectected at least one argument.");let s=null;const h=n.expectedType;h&&"value"!==h.kind&&(s=h);const g=[];for(const w of e.slice(1)){const T=n.parse(w,1+g.length,s,void 0,{typeAnnotation:"omit"});if(!T)return null;s=s||T.type,g.push(T)}const _=h&&g.some(w=>An(h,w.type));return new da(_?Nn:s,g)}evaluate(e){let n,s=null,h=0;for(const g of this.args){if(h++,s=g.evaluate(e),s&&s instanceof co&&!s.available&&(n||(n=s),s=null,h===this.args.length))return n;if(null!==s)break}return s}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var Na=da;class Oi{constructor(e,n){this.type=n.type,this.bindings=[].concat(e),this.result=n}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const n of this.bindings)e(n[1]);e(this.result)}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found ${e.length-1} instead.`);const s=[];for(let g=1;g<e.length-1;g+=2){const _=e[g];if("string"!=typeof _)return n.error(`Expected string, but found ${typeof _} instead.`,g);if(/[^a-zA-Z0-9_]/.test(_))return n.error("Variable names must contain only alphanumeric characters or '_'.",g);const w=n.parse(e[g+1],g+1);if(!w)return null;s.push([_,w])}const h=n.parse(e[e.length-1],e.length-1,n.expectedType,s);return h?new Oi(s,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[n,s]of this.bindings)e.push(n,s.serialize());return e.push(this.result.serialize()),e}}var tl=Oi;class Is{constructor(e,n,s){this.type=e,this.index=n,this.input=s}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,Zt),h=n.parse(e[2],2,ir(n.expectedType||Nn));return s&&h?new Is(h.type.itemType,s,h):null}evaluate(e){const n=this.index.evaluate(e),s=this.input.evaluate(e);if(n<0)throw new Wr(`Array index out of bounds: ${n} < 0.`);if(n>=s.length)throw new Wr(`Array index out of bounds: ${n} > ${s.length-1}.`);if(n!==Math.floor(n))throw new Wr(`Array index must be an integer, but found ${n} instead.`);return s[n]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Ro=Is;class Yo{constructor(e,n){this.type=Ot,this.needle=e,this.haystack=n}static parse(e,n){if(3!==e.length)return n.error(`Expected 2 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,Nn),h=n.parse(e[2],2,Nn);return s&&h?Es(s.type,[Ot,On,Zt,is,Nn])?new Yo(s,h):n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Cr(s.type)} instead`):null}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(null==s)return!1;if(!bi(n,["boolean","string","number","null"]))throw new Wr(`Expected first argument to be of type boolean, string, number or null, but found ${Cr(ii(n))} instead.`);if(!bi(s,["string","array"]))throw new Wr(`Expected second argument to be of type array or string, but found ${Cr(ii(s))} instead.`);return s.indexOf(n)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var ko=Yo;class ds{constructor(e,n,s){this.type=Zt,this.needle=e,this.haystack=n,this.fromIndex=s}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,Nn),h=n.parse(e[2],2,Nn);if(!s||!h)return null;if(!Es(s.type,[Ot,On,Zt,is,Nn]))return n.error(`Expected first argument to be of type boolean, string, number or null, but found ${Cr(s.type)} instead`);if(4===e.length){const g=n.parse(e[3],3,Zt);return g?new ds(s,h,g):null}return new ds(s,h)}evaluate(e){const n=this.needle.evaluate(e),s=this.haystack.evaluate(e);if(!bi(n,["boolean","string","number","null"]))throw new Wr(`Expected first argument to be of type boolean, string, number or null, but found ${Cr(ii(n))} instead.`);if(!bi(s,["string","array"]))throw new Wr(`Expected second argument to be of type array or string, but found ${Cr(ii(s))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(e);return s.indexOf(n,h)}return s.indexOf(n)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var nl=ds;class Da{constructor(e,n,s,h,g,_){this.inputType=e,this.type=n,this.input=s,this.cases=h,this.outputs=g,this.otherwise=_}static parse(e,n){if(e.length<5)return n.error(`Expected at least 4 arguments, but found only ${e.length-1}.`);if(e.length%2!=1)return n.error("Expected an even number of arguments.");let s,h;n.expectedType&&"value"!==n.expectedType.kind&&(h=n.expectedType);const g={},_=[];for(let D=2;D<e.length-1;D+=2){let R=e[D];const O=e[D+1];Array.isArray(R)||(R=[R]);const B=n.concat(D);if(0===R.length)return B.error("Expected at least one branch label.");for(const G of R){if("number"!=typeof G&&"string"!=typeof G)return B.error("Branch labels must be numbers or strings.");if("number"==typeof G&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return B.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof G&&Math.floor(G)!==G)return B.error("Numeric branch labels must be integer values.");if(s){if(B.checkSubtype(s,ii(G)))return null}else s=ii(G);if(void 0!==g[String(G)])return B.error("Branch labels must be unique.");g[String(G)]=_.length}const V=n.parse(O,D,h);if(!V)return null;h=h||V.type,_.push(V)}const w=n.parse(e[1],1,Nn);if(!w)return null;const T=n.parse(e[e.length-1],e.length-1,h);return T?"value"!==w.type.kind&&n.concat(1).checkSubtype(s,w.type)?null:new Da(s,h,w,g,_,T):null}evaluate(e){const n=this.input.evaluate(e);return(ii(n)===this.inputType&&this.outputs[this.cases[n]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],n=Object.keys(this.cases).sort(),s=[],h={};for(const _ of n){const w=h[this.cases[_]];void 0===w?(h[this.cases[_]]=s.length,s.push([this.cases[_],[_]])):s[w][1].push(_)}const g=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,w]of s)e.push(1===w.length?g(w[0]):w.map(g)),e.push(this.outputs[_].serialize());return e.push(this.otherwise.serialize()),e}}var Zi=Da;class _o{constructor(e,n,s){this.type=e,this.branches=n,this.otherwise=s}static parse(e,n){if(e.length<4)return n.error(`Expected at least 3 arguments, but found only ${e.length-1}.`);if(e.length%2!=0)return n.error("Expected an odd number of arguments.");let s;n.expectedType&&"value"!==n.expectedType.kind&&(s=n.expectedType);const h=[];for(let _=1;_<e.length-1;_+=2){const w=n.parse(e[_],_,Ot);if(!w)return null;const T=n.parse(e[_+1],_+1,s);if(!T)return null;h.push([w,T]),s=s||T.type}const g=n.parse(e[e.length-1],e.length-1,s);return g?new _o(s,h,g):null}evaluate(e){for(const[n,s]of this.branches)if(n.evaluate(e))return s.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[n,s]of this.branches)e(n),e(s);e(this.otherwise)}outputDefined(){return this.branches.every(([e,n])=>n.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(n=>{e.push(n.serialize())}),e}}var pl=_o;class Uo{constructor(e,n,s,h){this.type=e,this.input=n,this.beginIndex=s,this.endIndex=h}static parse(e,n){if(e.length<=2||e.length>=5)return n.error(`Expected 3 or 4 arguments, but found ${e.length-1} instead.`);const s=n.parse(e[1],1,Nn),h=n.parse(e[2],2,Zt);if(!s||!h)return null;if(!Es(s.type,[ir(Nn),On,Nn]))return n.error(`Expected first argument to be of type array or string, but found ${Cr(s.type)} instead`);if(4===e.length){const g=n.parse(e[3],3,Zt);return g?new Uo(s.type,s,h,g):null}return new Uo(s.type,s,h)}evaluate(e){const n=this.input.evaluate(e),s=this.beginIndex.evaluate(e);if(!bi(n,["string","array"]))throw new Wr(`Expected first argument to be of type array or string, but found ${Cr(ii(n))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(e);return n.slice(s,h)}return n.slice(s)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Q=Uo;function M(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function P(t,e,n,s){return 0===s.compare(e,n)}function j(t,e,n){const s="=="!==t&&"!="!==t;return class $0{constructor(g,_,w){this.type=Ot,this.lhs=g,this.rhs=_,this.collator=w,this.hasUntypedArgument="value"===g.type.kind||"value"===_.type.kind}static parse(g,_){if(3!==g.length&&4!==g.length)return _.error("Expected two or three arguments.");const w=g[0];let T=_.parse(g[1],1,Nn);if(!T)return null;if(!M(w,T.type))return _.concat(1).error(`"${w}" comparisons are not supported for type '${Cr(T.type)}'.`);let D=_.parse(g[2],2,Nn);if(!D)return null;if(!M(w,D.type))return _.concat(2).error(`"${w}" comparisons are not supported for type '${Cr(D.type)}'.`);if(T.type.kind!==D.type.kind&&"value"!==T.type.kind&&"value"!==D.type.kind)return _.error(`Cannot compare types '${Cr(T.type)}' and '${Cr(D.type)}'.`);s&&("value"===T.type.kind&&"value"!==D.type.kind?T=new Io(D.type,[T]):"value"!==T.type.kind&&"value"===D.type.kind&&(D=new Io(T.type,[D])));let R=null;if(4===g.length){if("string"!==T.type.kind&&"string"!==D.type.kind&&"value"!==T.type.kind&&"value"!==D.type.kind)return _.error("Cannot use collator to compare non-string types.");if(R=_.parse(g[3],3,mo),!R)return null}return new $0(T,D,R)}evaluate(g){const _=this.lhs.evaluate(g),w=this.rhs.evaluate(g);if(s&&this.hasUntypedArgument){const T=ii(_),D=ii(w);if(T.kind!==D.kind||"string"!==T.kind&&"number"!==T.kind)throw new Wr(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${T.kind}, ${D.kind}) instead.`)}if(this.collator&&!s&&this.hasUntypedArgument){const T=ii(_),D=ii(w);if("string"!==T.kind||"string"!==D.kind)return e(g,_,w)}return this.collator?n(g,_,w,this.collator.evaluate(g)):e(g,_,w)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[t];return this.eachChild(_=>{g.push(_.serialize())}),g}}}const te=j("==",function(t,e,n){return e===n},P),ge=j("!=",function(t,e,n){return e!==n},function(t,e,n,s){return!P(0,e,n,s)}),Oe=j("<",function(t,e,n){return e<n},function(t,e,n,s){return s.compare(e,n)<0}),ze=j(">",function(t,e,n){return e>n},function(t,e,n,s){return s.compare(e,n)>0}),et=j("<=",function(t,e,n){return e<=n},function(t,e,n,s){return s.compare(e,n)<=0}),xt=j(">=",function(t,e,n){return e>=n},function(t,e,n,s){return s.compare(e,n)>=0});class gn{constructor(e,n,s,h,g,_){this.type=On,this.number=e,this.locale=n,this.currency=s,this.unit=h,this.minFractionDigits=g,this.maxFractionDigits=_}static parse(e,n){if(3!==e.length)return n.error("Expected two arguments.");const s=n.parse(e[1],1,Zt);if(!s)return null;const h=e[2];if("object"!=typeof h||Array.isArray(h))return n.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=n.parse(h.locale,1,On),!g))return null;let _=null;if(h.currency&&(_=n.parse(h.currency,1,On),!_))return null;let w=null;if(h.unit&&(w=n.parse(h.unit,1,On),!w))return null;let T=null;if(h["min-fraction-digits"]&&(T=n.parse(h["min-fraction-digits"],1,Zt),!T))return null;let D=null;return h["max-fraction-digits"]&&(D=n.parse(h["max-fraction-digits"],1,Zt),!D)?null:new gn(s,g,_,w,T,D)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class _n{constructor(e){this.type=Zt,this.input=e}static parse(e,n){if(2!==e.length)return n.error(`Expected 1 argument, but found ${e.length-1} instead.`);const s=n.parse(e[1],1);return s?"array"!==s.type.kind&&"string"!==s.type.kind&&"value"!==s.type.kind?n.error(`Expected argument of type string or array, but found ${Cr(s.type)} instead.`):new _n(s):null}evaluate(e){const n=this.input.evaluate(e);if("string"==typeof n||Array.isArray(n))return n.length;throw new Wr(`Expected value to be of type string or array, but found ${Cr(ii(n))} instead.`)}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(n=>{e.push(n.serialize())}),e}}const cr={"==":te,"!=":ge,">":ze,"<":Oe,">=":xt,"<=":et,array:Io,at:Ro,boolean:Io,case:pl,coalesce:Na,collator:ia,format:eo,image:Js,in:ko,"index-of":nl,interpolate:sr,"interpolate-hcl":sr,"interpolate-lab":sr,length:_n,let:tl,literal:Ui,match:Zi,number:Io,"number-format":gn,object:Io,slice:Q,step:ls,string:Io,"to-boolean":wo,"to-color":wo,"to-number":wo,"to-string":wo,var:Cs,within:qo};function ur(t,[e,n,s,h]){e=e.evaluate(t),n=n.evaluate(t),s=s.evaluate(t);const g=h?h.evaluate(t):1,_=Ns(e,n,s,g);if(_)throw new Wr(_);return new Qr(e/255*g,n/255*g,s/255*g,g)}function Un(t,e){return t in e}function Zn(t,e){const n=e[t];return void 0===n?null:n}function fr(t){return{type:t}}to.register(cr,{error:[{kind:"error"},[On],(t,[e])=>{throw new Wr(e.evaluate(t))}],typeof:[On,[Nn],(t,[e])=>Cr(ii(e.evaluate(t)))],"to-rgba":[ir(Zt,4),[Gn],(t,[e])=>e.evaluate(t).toArray()],rgb:[Gn,[Zt,Zt,Zt],ur],rgba:[Gn,[Zt,Zt,Zt,Zt],ur],has:{type:Ot,overloads:[[[On],(t,[e])=>Un(e.evaluate(t),t.properties())],[[On,Ur],(t,[e,n])=>Un(e.evaluate(t),n.evaluate(t))]]},get:{type:Nn,overloads:[[[On],(t,[e])=>Zn(e.evaluate(t),t.properties())],[[On,Ur],(t,[e,n])=>Zn(e.evaluate(t),n.evaluate(t))]]},"feature-state":[Nn,[On],(t,[e])=>Zn(e.evaluate(t),t.featureState||{})],properties:[Ur,[],t=>t.properties()],"geometry-type":[On,[],t=>t.geometryType()],id:[Nn,[],t=>t.id()],zoom:[Zt,[],t=>t.globals.zoom],pitch:[Zt,[],t=>t.globals.pitch||0],"distance-from-center":[Zt,[],t=>t.distanceFromCenter()],"heatmap-density":[Zt,[],t=>t.globals.heatmapDensity||0],"line-progress":[Zt,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Zt,[],t=>t.globals.skyRadialProgress||0],accumulated:[Nn,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Zt,fr(Zt),(t,e)=>{let n=0;for(const s of e)n+=s.evaluate(t);return n}],"*":[Zt,fr(Zt),(t,e)=>{let n=1;for(const s of e)n*=s.evaluate(t);return n}],"-":{type:Zt,overloads:[[[Zt,Zt],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[Zt],(t,[e])=>-e.evaluate(t)]]},"/":[Zt,[Zt,Zt],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[Zt,[Zt,Zt],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[Zt,[],()=>Math.LN2],pi:[Zt,[],()=>Math.PI],e:[Zt,[],()=>Math.E],"^":[Zt,[Zt,Zt],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[Zt,[Zt],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Zt,[Zt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Zt,[Zt],(t,[e])=>Math.log(e.evaluate(t))],log2:[Zt,[Zt],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Zt,[Zt],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Zt,[Zt],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Zt,[Zt],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Zt,[Zt],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Zt,[Zt],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Zt,[Zt],(t,[e])=>Math.atan(e.evaluate(t))],min:[Zt,fr(Zt),(t,e)=>Math.min(...e.map(n=>n.evaluate(t)))],max:[Zt,fr(Zt),(t,e)=>Math.max(...e.map(n=>n.evaluate(t)))],abs:[Zt,[Zt],(t,[e])=>Math.abs(e.evaluate(t))],round:[Zt,[Zt],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Zt,[Zt],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Zt,[Zt],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Ot,[On,Nn],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Ot,[Nn],(t,[e])=>t.id()===e.value],"filter-type-==":[Ot,[On],(t,[e])=>t.geometryType()===e.value],"filter-<":[Ot,[On,Nn],(t,[e,n])=>{const s=t.properties()[e.value],h=n.value;return typeof s==typeof h&&s<h}],"filter-id-<":[Ot,[Nn],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n<s}],"filter->":[Ot,[On,Nn],(t,[e,n])=>{const s=t.properties()[e.value],h=n.value;return typeof s==typeof h&&s>h}],"filter-id->":[Ot,[Nn],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n>s}],"filter-<=":[Ot,[On,Nn],(t,[e,n])=>{const s=t.properties()[e.value],h=n.value;return typeof s==typeof h&&s<=h}],"filter-id-<=":[Ot,[Nn],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n<=s}],"filter->=":[Ot,[On,Nn],(t,[e,n])=>{const s=t.properties()[e.value],h=n.value;return typeof s==typeof h&&s>=h}],"filter-id->=":[Ot,[Nn],(t,[e])=>{const n=t.id(),s=e.value;return typeof n==typeof s&&n>=s}],"filter-has":[Ot,[Nn],(t,[e])=>e.value in t.properties()],"filter-has-id":[Ot,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Ot,[ir(On)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Ot,[ir(Nn)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Ot,[On,ir(Nn)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Ot,[On,ir(Nn)],(t,[e,n])=>function(s,h,g,_){for(;g<=_;){const w=g+_>>1;if(h[w]===s)return!0;h[w]>s?_=w-1:g=w+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Ot,overloads:[[[Ot,Ot],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[fr(Ot),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Ot,overloads:[[[Ot,Ot],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[fr(Ot),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Ot,[Ot],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Ot,[On],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[On,[On],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[On,[On],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[On,fr(Nn),(t,e)=>e.map(n=>Ni(n.evaluate(t))).join("")],"resolved-locale":[On,[mo],(t,[e])=>e.evaluate(t).resolvedLocale()]});var Fr=cr;function oi(t){return{result:"success",value:t}}function Rr(t){return{result:"error",value:t}}function Kr(t){return"data-driven"===t["property-type"]}function br(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Xi(t){return!!t.expression&&t.expression.interpolated}function Hn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function jo(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function fs(t){return t}function F(t,e){const n="color"===e.type,s=t.stops&&"object"==typeof t.stops[0][0],h=s||!(s||void 0!==t.property),g=t.type||(Xi(e)?"exponential":"interval");if(n&&((t=$r({},t)).stops&&(t.stops=t.stops.map(D=>[D[0],Qr.parse(D[1])])),t.default=Qr.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!ha[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let _,w,T;if("exponential"===g)_=Ce;else if("interval"===g)_=se;else if("categorical"===g){_=N,w=Object.create(null);for(const D of t.stops)w[D[0]]=D[1];T=typeof t.stops[0][0]}else{if("identity"!==g)throw new Error(`Unknown function type "${g}"`);_=I}if(s){const D={},R=[];for(let V=0;V<t.stops.length;V++){const G=t.stops[V],J=G[0].zoom;void 0===D[J]&&(D[J]={zoom:J,type:t.type,property:t.property,default:t.default,stops:[]},R.push(J)),D[J].stops.push([G[0].value,G[1]])}const O=[];for(const V of R)O.push([D[V].zoom,F(D[V],e)]);const B={name:"linear"};return{kind:"composite",interpolationType:B,interpolationFactor:sr.interpolationFactor.bind(void 0,B),zoomStops:O.map(V=>V[0]),evaluate:({zoom:V},G)=>Ce({stops:O,base:t.base},e,V).evaluate(V,G)}}if(h){const D="exponential"===g?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:D,interpolationFactor:sr.interpolationFactor.bind(void 0,D),zoomStops:t.stops.map(R=>R[0]),evaluate:({zoom:R})=>_(t,e,R,w,T)}}return{kind:"source",evaluate(D,R){const O=R&&R.properties?R.properties[t.property]:void 0;return void 0===O?X(t.default,e.default):_(t,e,O,w,T)}}}function X(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function N(t,e,n,s,h){return X(typeof n===h?s[n]:void 0,t.default,e.default)}function se(t,e,n){if("number"!==Hn(n))return X(t.default,e.default);const s=t.stops.length;if(1===s||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[s-1][0])return t.stops[s-1][1];const h=di(t.stops.map(g=>g[0]),n);return t.stops[h][1]}function Ce(t,e,n){const s=void 0!==t.base?t.base:1;if("number"!==Hn(n))return X(t.default,e.default);const h=t.stops.length;if(1===h||n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[h-1][0])return t.stops[h-1][1];const g=di(t.stops.map(R=>R[0]),n),_=function(R,O,B,V){const G=V-B,J=R-B;return 0===G?0:1===O?J/G:(Math.pow(O,J)-1)/(Math.pow(O,G)-1)}(n,s,t.stops[g][0],t.stops[g+1][0]),w=t.stops[g][1],T=t.stops[g+1][1];let D=Xo[e.type]||fs;if(t.colorSpace&&"rgb"!==t.colorSpace){const R=ha[t.colorSpace];D=(O,B)=>R.reverse(R.interpolate(R.forward(O),R.forward(B),_))}return"function"==typeof w.evaluate?{evaluate(...R){const O=w.evaluate.apply(void 0,R),B=T.evaluate.apply(void 0,R);if(void 0!==O&&void 0!==B)return D(O,B,_)}}:D(w,T,_)}function I(t,e,n){return"color"===e.type?n=Qr.parse(n):"formatted"===e.type?n=Wi.fromString(n.toString()):"resolvedImage"===e.type?n=co.fromString(n.toString()):Hn(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),X(n,t.default,e.default)}class A{constructor(e,n){var s;this.expression=e,this._warningHistory={},this._evaluator=new Us,this._defaultValue=n?"color"===(s=n).type&&(jo(s.default)||Array.isArray(s.default))?new Qr(0,0,0,0):"color"===s.type?Qr.parse(s.default)||null:void 0===s.default?null:s.default:null,this._enumValues=n&&"enum"===n.type?n.values:null}evaluateWithoutErrorHandling(e,n,s,h,g,_,w,T){return this._evaluator.globals=e,this._evaluator.feature=n,this._evaluator.featureState=s,this._evaluator.canonical=h||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null,this.expression.evaluate(this._evaluator)}evaluate(e,n,s,h,g,_,w,T){this._evaluator.globals=e,this._evaluator.feature=n||null,this._evaluator.featureState=s||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=w||null,this._evaluator.featureDistanceData=T||null;try{const D=this.expression.evaluate(this._evaluator);if(null==D||"number"==typeof D&&D!=D)return this._defaultValue;if(this._enumValues&&!(D in this._enumValues))throw new Wr(`Expected value to be one of ${Object.keys(this._enumValues).map(R=>JSON.stringify(R)).join(", ")}, but found ${JSON.stringify(D)} instead.`);return D}catch(D){return this._warningHistory[D.message]||(this._warningHistory[D.message]=!0,typeof console<"u"&&console.warn(D.message)),this._defaultValue}}}function $(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in Fr}function fe(t,e){const n=new $s(Fr,[],e?function(h){const g={color:Gn,string:On,number:Zt,enum:On,boolean:Ot,formatted:Jr,resolvedImage:Mo};return"array"===h.type?ir(g[h.value]||Nn,h.length):g[h.type]}(e):void 0),s=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return s?oi(new A(s,e)):Rr(n.errors)}class We{constructor(e,n){this.kind=e,this._styleExpression=n,this.isStateDependent="constant"!==e&&!as(n.expression)}evaluateWithoutErrorHandling(e,n,s,h,g,_){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,h,g,_)}evaluate(e,n,s,h,g,_){return this._styleExpression.evaluate(e,n,s,h,g,_)}}class Ft{constructor(e,n,s,h){this.kind=e,this.zoomStops=s,this._styleExpression=n,this.isStateDependent="camera"!==e&&!as(n.expression),this.interpolationType=h}evaluateWithoutErrorHandling(e,n,s,h,g,_){return this._styleExpression.evaluateWithoutErrorHandling(e,n,s,h,g,_)}evaluate(e,n,s,h,g,_){return this._styleExpression.evaluate(e,n,s,h,g,_)}interpolationFactor(e,n,s){return this.interpolationType?sr.interpolationFactor(this.interpolationType,e,n,s):0}}function En(t,e){if("error"===(t=fe(t,e)).result)return t;const n=t.value.expression,s=Zo(n);if(!s&&!Kr(e))return Rr([new ai("","data expressions not supported")]);const h=qi(n,["zoom","pitch","distance-from-center"]);if(!h&&!br(e))return Rr([new ai("","zoom expressions not supported")]);const g=Xn(n);return g||h?g instanceof ai?Rr([g]):g instanceof sr&&!Xi(e)?Rr([new ai("",'"interpolate" expressions cannot be used with this property')]):oi(g?new Ft(s?"camera":"composite",t.value,g.labels,g instanceof sr?g.interpolation:void 0):new We(s?"constant":"source",t.value)):Rr([new ai("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Qn{constructor(e,n){this._parameters=e,this._specification=n,$r(this,F(this._parameters,this._specification))}static deserialize(e){return new Qn(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Xn(t){let e=null;if(t instanceof tl)e=Xn(t.result);else if(t instanceof Na){for(const n of t.args)if(e=Xn(n),e)break}else(t instanceof ls||t instanceof sr)&&t.input instanceof to&&"zoom"===t.input.name&&(e=t);return e instanceof ai||t.eachChild(n=>{const s=Xn(n);s instanceof ai?e=s:!e&&s?e=new ai("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&s&&e!==s&&(e=new ai("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class yt{constructor(e,n,s,h){this.message=(e?`${e}: `:"")+s,h&&(this.identifier=h),null!=n&&n.__line__&&(this.line=n.__line__)}}function Di(t){const e=t.key,n=t.value,s=t.valueSpec||{},h=t.objectElementValidators||{},g=t.style,_=t.styleSpec;let w=[];const T=Hn(n);if("object"!==T)return[new yt(e,n,`object expected, ${T} found`)];for(const D in n){const R=D.split(".")[0];let B;h[R]?B=h[R]:s[R]?B=Lo:h["*"]?B=h["*"]:s["*"]&&(B=Lo),B?w=w.concat(B({key:(e&&`${e}.`)+D,value:n[D],valueSpec:s[R]||s["*"],style:g,styleSpec:_,object:n,objectKey:D},n)):w.push(new yt(e,n[D],`unknown property "${D}"`))}for(const D in s)h[D]||s[D].required&&void 0===s[D].default&&void 0===n[D]&&w.push(new yt(e,n,`missing required property "${D}"`));return w}function As(t){const e=t.value,n=t.valueSpec,s=t.style,h=t.styleSpec,g=t.key,_=t.arrayElementValidator||Lo;if("array"!==Hn(e))return[new yt(g,e,`array expected, ${Hn(e)} found`)];if(n.length&&e.length!==n.length)return[new yt(g,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new yt(g,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let w={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};h.$version<7&&(w.function=n.function),"object"===Hn(n.value)&&(w=n.value);let T=[];for(let D=0;D<e.length;D++)T=T.concat(_({array:e,arrayIndex:D,value:e[D],valueSpec:w,style:s,styleSpec:h,key:`${g}[${D}]`}));return T}function Ci(t){const e=t.key,n=t.value,s=t.valueSpec;let h=Hn(n);if("number"===h&&n!=n&&(h="NaN"),"number"!==h)return[new yt(e,n,`number expected, ${h} found`)];if("minimum"in s){let g=s.minimum;if("array"===Hn(s.minimum)&&(g=s.minimum[t.arrayIndex]),n<g)return[new yt(e,n,`${n} is less than the minimum value ${g}`)]}if("maximum"in s){let g=s.maximum;if("array"===Hn(s.maximum)&&(g=s.maximum[t.arrayIndex]),n>g)return[new yt(e,n,`${n} is greater than the maximum value ${g}`)]}return[]}function $i(t){const e=t.valueSpec,n=qn(t.value.type);let s,h,g,_={};const w="categorical"!==n&&void 0===t.value.property,T=!w,D="array"===Hn(t.value.stops)&&"array"===Hn(t.value.stops[0])&&"object"===Hn(t.value.stops[0][0]),R=Di({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(V){if("identity"===n)return[new yt(V.key,V.value,'identity function may not have a "stops" property')];let G=[];const J=V.value;return G=G.concat(As({key:V.key,value:J,valueSpec:V.valueSpec,style:V.style,styleSpec:V.styleSpec,arrayElementValidator:O})),"array"===Hn(J)&&0===J.length&&G.push(new yt(V.key,J,"array must have at least one stop")),G},default:function(V){return Lo({key:V.key,value:V.value,valueSpec:e,style:V.style,styleSpec:V.styleSpec})}}});return"identity"===n&&w&&R.push(new yt(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||R.push(new yt(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!Xi(t.valueSpec)&&R.push(new yt(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(T&&!Kr(t.valueSpec)?R.push(new yt(t.key,t.value,"property functions not supported")):w&&!br(t.valueSpec)&&R.push(new yt(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!D||void 0!==t.value.property||R.push(new yt(t.key,t.value,'"property" property is required')),R;function O(V){let G=[];const J=V.value,ce=V.key;if("array"!==Hn(J))return[new yt(ce,J,`array expected, ${Hn(J)} found`)];if(2!==J.length)return[new yt(ce,J,`array length 2 expected, length ${J.length} found`)];if(D){if("object"!==Hn(J[0]))return[new yt(ce,J,`object expected, ${Hn(J[0])} found`)];if(void 0===J[0].zoom)return[new yt(ce,J,"object stop key must have zoom")];if(void 0===J[0].value)return[new yt(ce,J,"object stop key must have value")];const xe=qn(J[0].zoom);if("number"!=typeof xe)return[new yt(ce,J[0].zoom,"stop zoom values must be numbers")];if(g&&g>xe)return[new yt(ce,J[0].zoom,"stop zoom values must appear in ascending order")];xe!==g&&(g=xe,h=void 0,_={}),G=G.concat(Di({key:`${ce}[0]`,value:J[0],valueSpec:{zoom:{}},style:V.style,styleSpec:V.styleSpec,objectElementValidators:{zoom:Ci,value:B}}))}else G=G.concat(B({key:`${ce}[0]`,value:J[0],valueSpec:{},style:V.style,styleSpec:V.styleSpec},J));return $(wi(J[1]))?G.concat([new yt(`${ce}[1]`,J[1],"expressions are not allowed in function stops.")]):G.concat(Lo({key:`${ce}[1]`,value:J[1],valueSpec:e,style:V.style,styleSpec:V.styleSpec}))}function B(V,G){const J=Hn(V.value),ce=qn(V.value),xe=null!==V.value?V.value:G;if(s){if(J!==s)return[new yt(V.key,xe,`${J} stop domain type must match previous stop domain type ${s}`)]}else s=J;if("number"!==J&&"string"!==J&&"boolean"!==J&&"number"!=typeof ce&&"string"!=typeof ce&&"boolean"!=typeof ce)return[new yt(V.key,xe,"stop domain value must be a number, string, or boolean")];if("number"!==J&&"categorical"!==n){let Me=`number expected, ${J} found`;return Kr(e)&&void 0===n&&(Me+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new yt(V.key,xe,Me)]}return"categorical"!==n||"number"!==J||"number"==typeof ce&&isFinite(ce)&&Math.floor(ce)===ce?"categorical"!==n&&"number"===J&&"number"==typeof ce&&"number"==typeof h&&void 0!==h&&ce<h?[new yt(V.key,xe,"stop domain values must appear in ascending order")]:(h=ce,"categorical"===n&&ce in _?[new yt(V.key,xe,"stop domain values must be unique")]:(_[ce]=!0,[])):[new yt(V.key,xe,`integer expected, found ${String(ce)}`)]}}function ji(t){const e=("property"===t.expressionContext?En:fe)(wi(t.value),t.valueSpec);if("error"===e.result)return e.value.map(s=>new yt(`${t.key}${s.key}`,t.value,s.message));const n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new yt(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!as(n))return[new yt(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return Hs(n,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!qi(n,["zoom","feature-state"]))return[new yt(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Zo(n))return[new yt(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Hs(t,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const h of e.valueSpec.expression.parameters)n.delete(h);if(0===n.size)return[];const s=[];return t instanceof to&&n.has(t.name)?[new yt(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(h=>{s.push(...Hs(h,e))}),s)}function Vo(t){const e=t.key,n=t.value,s=t.valueSpec,h=[];return Array.isArray(s.values)?-1===s.values.indexOf(qn(n))&&h.push(new yt(e,n,`expected one of [${s.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(s.values).indexOf(qn(n))&&h.push(new yt(e,n,`expected one of [${Object.keys(s.values).join(", ")}], ${JSON.stringify(n)} found`)),h}function ec(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!ec(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Ca(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ec(t)||(t=Ll(t));const n=t;let s=!0;try{s=function(D){if(!ro(D))return D;let R=wi(D);return tc(R),R=Sa(R),R}(n)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const h=ct[`filter_${e}`],g=fe(s,h);let _=null;if("error"===g.result)throw new Error(g.value.map(D=>`${D.key}: ${D.message}`).join(", "));_=(D,R,O)=>g.value.evaluate(D,R,{},O);let w=null,T=null;if(s!==n){const D=fe(n,h);if("error"===D.result)throw new Error(D.value.map(R=>`${R.key}: ${R.message}`).join(", "));w=(R,O,B,V,G)=>D.value.evaluate(R,O,{},B,void 0,void 0,V,G),T=!Zo(D.value.expression)}return{filter:_,dynamicFilter:w||void 0,needGeometry:Pu(s),needFeature:!!T}}function Sa(t){if(!Array.isArray(t))return t;const e=function(n){if(Ua.has(n[0]))for(let s=1;s<n.length;s++)if(ro(n[s]))return!0;return n}(t);return!0===e?e:e.map(n=>Sa(n))}function tc(t){let e=!1;const n=[];if("case"===t[0]){for(let s=1;s<t.length-1;s+=2)e=e||ro(t[s]),n.push(t[s+1]);n.push(t[t.length-1])}else if("match"===t[0]){e=e||ro(t[1]);for(let s=2;s<t.length-1;s+=2)n.push(t[s+1]);n.push(t[t.length-1])}else if("step"===t[0]){e=e||ro(t[1]);for(let s=1;s<t.length-1;s+=2)n.push(t[s+1])}e&&(t.length=0,t.push("any",...n));for(let s=1;s<t.length;s++)tc(t[s])}function ro(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let n=1;n<t.length;n++)if(ro(t[n]))return!0;return!1}const Ua=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function ml(t,e){return t<e?-1:t>e?1:0}function Pu(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(Pu(t[e]))return!0;return!1}function Ll(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?Pc(t[1],t[2],"=="):"!="===e?Ol(Pc(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Pc(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map(Ll))):"all"===e?["all"].concat(t.slice(1).map(Ll)):"none"===e?["all"].concat(t.slice(1).map(Ll).map(Ol)):"in"===e?Rc(t[1],t.slice(2)):"!in"===e?Ol(Rc(t[1],t.slice(2))):"has"===e?fa(t[1]):"!has"===e?Ol(fa(t[1])):"within"!==e||t;var n}function Pc(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function Rc(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(n=>typeof n!=typeof e[0])?["filter-in-large",t,["literal",e.sort(ml)]]:["filter-in-small",t,["literal",e]]}}function fa(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Ol(t){return["!",t]}function Fl(t){return ec(wi(t.value))?ji($r({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):gl(t)}function gl(t){const e=t.value,n=t.key;if("array"!==Hn(e))return[new yt(n,e,`array expected, ${Hn(e)} found`)];const s=t.styleSpec;let h,g=[];if(e.length<1)return[new yt(n,e,"filter array must have at least 1 element")];switch(g=g.concat(Vo({key:`${n}[0]`,value:e[0],valueSpec:s.filter_operator,style:t.style,styleSpec:t.styleSpec})),qn(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===qn(e[1])&&g.push(new yt(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&g.push(new yt(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(h=Hn(e[1]),"string"!==h&&g.push(new yt(`${n}[1]`,e[1],`string expected, ${h} found`)));for(let _=2;_<e.length;_++)h=Hn(e[_]),"$type"===qn(e[1])?g=g.concat(Vo({key:`${n}[${_}]`,value:e[_],valueSpec:s.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&g.push(new yt(`${n}[${_}]`,e[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<e.length;_++)g=g.concat(gl({key:`${n}[${_}]`,value:e[_],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":h=Hn(e[1]),2!==e.length?g.push(new yt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==h&&g.push(new yt(`${n}[1]`,e[1],`string expected, ${h} found`));break;case"within":h=Hn(e[1]),2!==e.length?g.push(new yt(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==h&&g.push(new yt(`${n}[1]`,e[1],`object expected, ${h} found`))}return g}function nc(t,e){const n=t.key,s=t.style,h=t.styleSpec,g=t.value,_=t.objectKey,w=h[`${e}_${t.layerType}`];if(!w)return[];const T=_.match(/^(.*)-transition$/);if("paint"===e&&T&&w[T[1]]&&w[T[1]].transition)return Lo({key:n,value:g,valueSpec:h.transition,style:s,styleSpec:h});const D=t.valueSpec||w[_];if(!D)return[new yt(n,g,`unknown property "${_}"`)];let R;if("string"===Hn(g)&&Kr(D)&&!D.tokens&&(R=/^{([^}]+)}$/.exec(g)))return[new yt(n,g,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(R[1])} }\`.`)];const O=[];return"symbol"===t.layerType&&("text-field"===_&&s&&!s.glyphs&&O.push(new yt(n,g,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&jo(wi(g))&&"identity"===qn(g.type)&&O.push(new yt(n,g,'"text-font" does not support identity functions'))),O.concat(Lo({key:t.key,value:g,valueSpec:D,style:s,styleSpec:h,expressionContext:"property",propertyType:e,propertyKey:_}))}function kc(t){return nc(t,"paint")}function _l(t){return nc(t,"layout")}function nu(t){let e=[];const n=t.value,s=t.key,h=t.style,g=t.styleSpec;n.type||n.ref||e.push(new yt(s,n,'either "type" or "ref" is required'));let _=qn(n.type);const w=qn(n.ref);if(n.id){const T=qn(n.id);for(let D=0;D<t.arrayIndex;D++){const R=h.layers[D];qn(R.id)===T&&e.push(new yt(s,n.id,`duplicate layer id "${n.id}", previously used at line ${R.id.__line__}`))}}if("ref"in n){let T;["type","source","source-layer","filter","layout"].forEach(D=>{D in n&&e.push(new yt(s,n[D],`"${D}" is prohibited for ref layers`))}),h.layers.forEach(D=>{qn(D.id)===w&&(T=D)}),T?T.ref?e.push(new yt(s,n.ref,"ref cannot reference another ref layer")):_=qn(T.type):"string"==typeof w&&e.push(new yt(s,n.ref,`ref layer "${w}" not found`))}else if("background"!==_&&"sky"!==_)if(n.source){const T=h.sources&&h.sources[n.source],D=T&&qn(T.type);T?"vector"===D&&"raster"===_?e.push(new yt(s,n.source,`layer "${n.id}" requires a raster source`)):"raster"===D&&"raster"!==_?e.push(new yt(s,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==D||n["source-layer"]?"raster-dem"===D&&"hillshade"!==_?e.push(new yt(s,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!n.paint||!n.paint["line-gradient"]&&!n.paint["line-trim-offset"]||"geojson"===D&&T.lineMetrics||e.push(new yt(s,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new yt(s,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new yt(s,n.source,`source "${n.source}" not found`))}else e.push(new yt(s,n,'missing required property "source"'));return e=e.concat(Di({key:s,value:n,valueSpec:g.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Lo({key:`${s}.type`,value:n.type,valueSpec:g.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:T=>Fl($r({layerType:_},T)),layout:T=>Di({layer:n,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":D=>_l($r({layerType:_},D))}}),paint:T=>Di({layer:n,key:T.key,value:T.value,valueSpec:{},style:T.style,styleSpec:T.styleSpec,objectElementValidators:{"*":D=>kc($r({layerType:_},D))}})}})),e}function yl(t){const e=t.value,n=t.key,s=Hn(e);return"string"!==s?[new yt(n,e,`string expected, ${s} found`)]:[]}const rc={promoteId:function({key:t,value:e}){if("string"===Hn(e))return yl({key:t,value:e});{const n=[];for(const s in e)n.push(...yl({key:`${t}.${s}`,value:e[s]}));return n}}};function zl(t){const e=t.value,n=t.key,s=t.styleSpec,h=t.style;if(!e.type)return[new yt(n,e,'"type" is required')];const g=qn(e.type);let _;switch(g){case"vector":case"raster":case"raster-dem":return _=Di({key:n,value:e,valueSpec:s[`source_${g.replace("-","_")}`],style:t.style,styleSpec:s,objectElementValidators:rc}),_;case"geojson":if(_=Di({key:n,value:e,valueSpec:s.source_geojson,style:h,styleSpec:s,objectElementValidators:rc}),e.cluster)for(const w in e.clusterProperties){const[T,D]=e.clusterProperties[w],R="string"==typeof T?[T,["accumulated"],["get",w]]:T;_.push(...ji({key:`${n}.${w}.map`,value:D,expressionContext:"cluster-map"})),_.push(...ji({key:`${n}.${w}.reduce`,value:R,expressionContext:"cluster-reduce"}))}return _;case"video":return Di({key:n,value:e,valueSpec:s.source_video,style:h,styleSpec:s});case"image":return Di({key:n,value:e,valueSpec:s.source_image,style:h,styleSpec:s});case"canvas":return[new yt(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Vo({key:`${n}.type`,value:e.type,valueSpec:{values:Jo(s)},style:h,styleSpec:s})}}function Jo(t){return t.source.reduce((e,n)=>{const s=t[n];return"enum"===s.type.type&&(e=e.concat(Object.keys(s.type.values))),e},[])}function Ru(t){const e=t.value,n=t.styleSpec,s=n.light,h=t.style;let g=[];const _=Hn(e);if(void 0===e)return g;if("object"!==_)return g=g.concat([new yt("light",e,`object expected, ${_} found`)]),g;for(const w in e){const T=w.match(/^(.*)-transition$/);g=g.concat(T&&s[T[1]]&&s[T[1]].transition?Lo({key:w,value:e[w],valueSpec:n.transition,style:h,styleSpec:n}):s[w]?Lo({key:w,value:e[w],valueSpec:s[w],style:h,styleSpec:n}):[new yt(w,e[w],`unknown property "${w}"`)])}return g}function ja(t){const e=t.value,n=t.key,s=t.style,h=t.styleSpec,g=h.terrain;let _=[];const w=Hn(e);if(void 0===e)return _;if("object"!==w)return _=_.concat([new yt("terrain",e,`object expected, ${w} found`)]),_;for(const T in e){const D=T.match(/^(.*)-transition$/);_=_.concat(D&&g[D[1]]&&g[D[1]].transition?Lo({key:T,value:e[T],valueSpec:h.transition,style:s,styleSpec:h}):g[T]?Lo({key:T,value:e[T],valueSpec:g[T],style:s,styleSpec:h}):[new yt(T,e[T],`unknown property "${T}"`)])}if(e.source){const T=s.sources&&s.sources[e.source],D=T&&qn(T.type);T?"raster-dem"!==D&&_.push(new yt(n,e.source,`terrain cannot be used with a source of type ${String(D)}, it only be used with a "raster-dem" source type`)):_.push(new yt(n,e.source,`source "${e.source}" not found`))}else _.push(new yt(n,e,'terrain is missing required property "source"'));return _}function rl(t){const e=t.value,n=t.style,s=t.styleSpec,h=s.fog;let g=[];const _=Hn(e);if(void 0===e)return g;if("object"!==_)return g=g.concat([new yt("fog",e,`object expected, ${_} found`)]),g;for(const w in e){const T=w.match(/^(.*)-transition$/);g=g.concat(T&&h[T[1]]&&h[T[1]].transition?Lo({key:w,value:e[w],valueSpec:s.transition,style:n,styleSpec:s}):h[w]?Lo({key:w,value:e[w],valueSpec:h[w],style:n,styleSpec:s}):[new yt(w,e[w],`unknown property "${w}"`)])}return g}const Lc={"*":()=>[],array:As,boolean:function(t){const e=t.value,n=t.key,s=Hn(e);return"boolean"!==s?[new yt(n,e,`boolean expected, ${s} found`)]:[]},number:Ci,color:function(t){const e=t.key,n=t.value,s=Hn(n);return"string"!==s?[new yt(e,n,`color expected, ${s} found`)]:null===Bs(n)?[new yt(e,n,`color expected, "${n}" found`)]:[]},enum:Vo,filter:Fl,function:$i,layer:nu,object:Di,source:zl,light:Ru,terrain:ja,fog:rl,string:yl,formatted:function(t){return 0===yl(t).length?[]:ji(t)},resolvedImage:function(t){return 0===yl(t).length?[]:ji(t)},projection:function(t){const e=t.value,n=t.styleSpec,s=n.projection,h=t.style;let g=[];const _=Hn(e);if("object"===_)for(const w in e)g=g.concat(Lo({key:w,value:e[w],valueSpec:s[w],style:h,styleSpec:n}));else"string"!==_&&(g=g.concat([new yt("projection",e,`object or string expected, ${_} found`)]));return g}};function Lo(t){const e=t.value,n=t.valueSpec,s=t.styleSpec;return n.expression&&jo(qn(e))?$i(t):n.expression&&$(wi(e))?ji(t):n.type&&Lc[n.type]?Lc[n.type](t):Di($r({},t,{valueSpec:n.type?s[n.type]:n}))}function hh(t){const e=t.value,n=t.key,s=yl(t);return s.length||(-1===e.indexOf("{fontstack}")&&s.push(new yt(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&s.push(new yt(n,e,'"glyphs" url must include a "{range}" token'))),s}function Bl(t,e=ct){return ta(Lo({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:hh,"*":()=>[]}}))}const dh=t=>ta(kc(t)),ic=t=>ta(_l(t));function ta(t){return t.slice().sort((e,n)=>e.line&&n.line?e.line-n.line:0)}function Ps(t,e){let n=!1;if(e&&e.length)for(const s of e)t.fire(new Ji(new Error(s.message))),n=!0;return n}var vl=$o;function $o(t,e,n){var s=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var h=new Int32Array(this.arrayBuffer);t=h[0],this.d=(e=h[1])+2*(n=h[2]);for(var g=0;g<this.d*this.d;g++){var _=h[3+g],w=h[3+g+1];s.push(_===w?null:h.subarray(_,w))}var T=h[3+s.length+1];this.keys=h.subarray(h[3+s.length],T),this.bboxes=h.subarray(T),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var D=0;D<this.d*this.d;D++)s.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var R=n/e*t;this.min=-R,this.max=t+R}$o.prototype.insert=function(t,e,n,s,h){this._forEachCell(e,n,s,h,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(s),this.bboxes.push(h)},$o.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},$o.prototype._insertCell=function(t,e,n,s,h,g){this.cells[h].push(g)},$o.prototype.query=function(t,e,n,s,h){var g=this.min,_=this.max;if(t<=g&&e<=g&&_<=n&&_<=s&&!h)return Array.prototype.slice.call(this.keys);var w=[];return this._forEachCell(t,e,n,s,this._queryCell,w,{},h),w},$o.prototype._queryCell=function(t,e,n,s,h,g,_,w){var T=this.cells[h];if(null!==T)for(var D=this.keys,R=this.bboxes,O=0;O<T.length;O++){var B=T[O];if(void 0===_[B]){var V=4*B;(w?w(R[V+0],R[V+1],R[V+2],R[V+3]):t<=R[V+2]&&e<=R[V+3]&&n>=R[V+0]&&s>=R[V+1])?(_[B]=!0,g.push(D[B])):_[B]=!1}}},$o.prototype._forEachCell=function(t,e,n,s,h,g,_,w){for(var T=this._convertToCellCoord(t),D=this._convertToCellCoord(e),R=this._convertToCellCoord(n),O=this._convertToCellCoord(s),B=T;B<=R;B++)for(var V=D;V<=O;V++){var G=this.d*V+B;if((!w||w(this._convertFromCellCoord(B),this._convertFromCellCoord(V),this._convertFromCellCoord(B+1),this._convertFromCellCoord(V+1)))&&h.call(this,t,e,n,s,G,g,_,w))return}},$o.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},$o.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},$o.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,s=0;s<this.cells.length;s++)n+=this.cells[s].length;var h=new Int32Array(e+n+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var g=e,_=0;_<t.length;_++){var w=t[_];h[3+_]=g,h.set(w,g),g+=w.length}return h[3+t.length]=g,h.set(this.keys,g),h[3+t.length+1]=g+=this.keys.length,h.set(this.bboxes,g),g+=this.bboxes.length,h.buffer};const il={};function fn(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),il[e]={klass:t,omit:n.omit||[]}}fn(Object,"Object"),vl.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},vl.deserialize=function(t){return new vl(t.buffer)},Object.defineProperty(vl,"name",{value:"Grid"}),fn(vl,"Grid"),fn(Qr,"Color"),fn(Error,"Error"),fn(St,"AJAXError"),fn(co,"ResolvedImage"),fn(Qn,"StylePropertyFunction"),fn(A,"StyleExpression",{omit:["_evaluator"]}),fn(Ft,"ZoomDependentExpression"),fn(We,"ZoomConstantExpression"),fn(to,"CompoundExpression",{omit:["_evaluate"]});for(const t in Fr)il[Fr[t]._classRegistryKey]||fn(Fr[t],`Expression${t}`);function Rs(t){return t&&typeof ArrayBuffer<"u"&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function ol(t){return Ie.ImageBitmap&&t instanceof Ie.ImageBitmap}function xl(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(Rs(t)||ol(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.push(n.buffer),n}if(t instanceof Ie.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const s of t)n.push(xl(s,e));return n}if("object"==typeof t){const n=t.constructor,s=n._classRegistryKey;if(!s)throw new Error(`can't serialize object of unregistered class ${s}`);const h=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const g in t)t.hasOwnProperty(g)&&(il[s].omit.indexOf(g)>=0||(h[g]=xl(t[g],e)));t instanceof Error&&(h.message=t.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==s&&(h.$name=s),h}throw new Error("can't serialize object of type "+typeof t)}function Va(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||Rs(t)||ol(t)||ArrayBuffer.isView(t)||t instanceof Ie.ImageData)return t;if(Array.isArray(t))return t.map(Va);if("object"==typeof t){const e=t.$name||"Object",{klass:n}=il[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const s=Object.create(n.prototype);for(const h of Object.keys(t))"$name"!==h&&(s[h]=Va(t[h]));return s}throw new Error("can't deserialize object of type "+typeof t)}const ru=t=>t>=1536&&t<=1791,iu=t=>t>=1872&&t<=1919,fi=t=>t>=2208&&t<=2303,ou=t=>t>=11904&&t<=12031,ku=t=>t>=12032&&t<=12255,Lu=t=>t>=12272&&t<=12287,Oc=t=>t>=12288&&t<=12351,Fc=t=>t>=12352&&t<=12447,oc=t=>t>=12448&&t<=12543,Ou=t=>t>=12544&&t<=12591,sc=t=>t>=12704&&t<=12735,sd=t=>t>=12736&&t<=12783,Nl=t=>t>=12784&&t<=12799,To=t=>t>=12800&&t<=13055,ac=t=>t>=13056&&t<=13311,Ul=t=>t>=13312&&t<=19903,su=t=>t>=19968&&t<=40959,Ws=t=>t>=40960&&t<=42127,sl=t=>t>=42128&&t<=42191,au=t=>t>=44032&&t<=55215,lc=t=>t>=63744&&t<=64255,al=t=>t>=64336&&t<=65023,cc=t=>t>=65040&&t<=65055,p=t=>t>=65072&&t<=65103,r=t=>t>=65104&&t<=65135,c=t=>t>=65136&&t<=65279,a=t=>t>=65280&&t<=65519;function f(t){for(const e of t)if(x(e.charCodeAt(0)))return!0;return!1}function d(t){for(const e of t)if(!y(e.charCodeAt(0)))return!1;return!0}function y(t){return!(ru(t)||iu(t)||fi(t)||al(t)||c(t))}function x(t){return!(746!==t&&747!==t&&(t<4352||!(sc(t)||Ou(t)||p(t)&&!(t>=65097&&t<=65103)||lc(t)||ac(t)||ou(t)||sd(t)||!(!Oc(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Ul(t)||su(t)||To(t)||(e=t,e>=12592&&e<=12687)||(e=>e>=43360&&e<=43391)(t)||(e=>e>=55216&&e<=55295)(t)||(e=>e>=4352&&e<=4607)(t)||au(t)||Fc(t)||Lu(t)||(e=>e>=12688&&e<=12703)(t)||ku(t)||Nl(t)||oc(t)&&12540!==t||!(!a(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!r(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(e=>e>=5120&&e<=5759)(t)||(e=>e>=6320&&e<=6399)(t)||cc(t)||(e=>e>=19904&&e<=19967)(t)||Ws(t)||sl(t))));var e}function E(t){return!(x(t)||(e=t,(n=e)>=128&&n<=255&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||(n=>n>=8192&&n<=8303)(e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||(n=>n>=8448&&n<=8527)(e)||(n=>n>=8528&&n<=8591)(e)||(n=>n>=8960&&n<=9215)(e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||(n=>n>=9216&&n<=9279)(e)&&9251!==e||(n=>n>=9280&&n<=9311)(e)||(n=>n>=9312&&n<=9471)(e)||(n=>n>=9632&&n<=9727)(e)||(n=>n>=9728&&n<=9983)(e)&&!(e>=9754&&e<=9759)||(n=>n>=11008&&n<=11263)(e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||Oc(e)||oc(e)||(n=>n>=57344&&n<=63743)(e)||p(e)||r(e)||a(e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e));var e,n}function C(t){return t>=1424&&t<=2303||al(t)||c(t)}function k(t,e){return!(!e&&C(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(n=t,n>=6016&&n<=6143));var n}function U(t){for(const e of t)if(C(e.charCodeAt(0)))return!0;return!1}const Y="deferred",oe="loading",le="loaded";let he=null,me="unavailable",ee=null;const be=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(me="error"),he&&he(t)};function ye(){De.fire(new Or("pluginStateChange",{pluginStatus:me,pluginURL:ee}))}const De=new Hi,ke=function(){return me},Ae=function(){if(me!==Y||!ee)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");me=oe,ye(),ee&&Nr({url:ee},t=>{t?be(t):(me=le,ye())})},Be={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>me===le||null!=Be.applyArabicShaping,isLoading:()=>me===oe,setState(t){me=t.pluginStatus,ee=t.pluginURL},isParsed:()=>null!=Be.applyArabicShaping&&null!=Be.processBidirectionalText&&null!=Be.processStyledBidirectionalText,getPluginURL:()=>ee};class He{constructor(e,n){this.zoom=e,n?(this.now=n.now,this.fadeDuration=n.fadeDuration,this.transition=n.transition,this.pitch=n.pitch):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0)}isSupportedScript(e){return function(n,s){for(const h of n)if(!k(h.charCodeAt(0),s))return!1;return!0}(e,Be.isLoaded())}}class Xe{constructor(e,n){this.property=e,this.value=n,this.expression=function(s,h){if(jo(s))return new Qn(s,h);if($(s)){const g=En(s,h);if("error"===g.result)throw new Error(g.value.map(_=>`${_.key}: ${_.message}`).join(", "));return g.value}{let g=s;return"string"==typeof s&&"color"===h.type&&(g=Qr.parse(s)),{kind:"constant",evaluate:()=>g}}}(void 0===n?e.specification.default:n,e.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,n,s){return this.property.possiblyEvaluate(this,e,n,s)}}class Qe{constructor(e){this.property=e,this.value=new Xe(e,void 0)}transitioned(e,n){return new qe(this.property,this.value,n,rt({},e.transition,this.transition),e.now)}untransitioned(){return new qe(this.property,this.value,null,{},0)}}class qt{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues)}getValue(e){return cn(this._values[e].value.value)}setValue(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Qe(this._values[e].property)),this._values[e].value=new Xe(this._values[e].property,null===n?void 0:cn(n))}getTransition(e){return cn(this._values[e].transition)}setTransition(e,n){this._values.hasOwnProperty(e)||(this._values[e]=new Qe(this._values[e].property)),this._values[e].transition=cn(n)||void 0}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);void 0!==s&&(e[n]=s);const h=this.getTransition(n);void 0!==h&&(e[`${n}-transition`]=h)}return e}transitioned(e,n){const s=new Tt(this._properties);for(const h of Object.keys(this._values))s._values[h]=this._values[h].transitioned(e,n._values[h]);return s}untransitioned(){const e=new Tt(this._properties);for(const n of Object.keys(this._values))e._values[n]=this._values[n].untransitioned();return e}}class qe{constructor(e,n,s,h,g){const _=h.delay||0,w=h.duration||0;g=g||0,this.property=e,this.value=n,this.begin=g+_,this.end=this.begin+w,e.specification.transition&&(h.delay||h.duration)&&(this.prior=s)}possiblyEvaluate(e,n,s){const h=e.now||0,g=this.value.possiblyEvaluate(e,n,s),_=this.prior;if(_){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return _.possiblyEvaluate(e,n,s);{const w=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(e,n,s),g,Ue(w))}}return g}}class Tt{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,n,s){const h=new Ye(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(e,n,s);return h}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class at{constructor(e){this._properties=e,this._values=Object.create(e.defaultPropertyValues)}getValue(e){return cn(this._values[e].value)}setValue(e,n){this._values[e]=new Xe(this._values[e].property,null===n?void 0:cn(n))}serialize(){const e={};for(const n of Object.keys(this._values)){const s=this.getValue(n);void 0!==s&&(e[n]=s)}return e}possiblyEvaluate(e,n,s){const h=new Ye(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(e,n,s);return h}}class kt{constructor(e,n,s){this.property=e,this.value=n,this.parameters=s}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,n,s,h){return this.property.evaluate(this.value,this.parameters,e,n,s,h)}}class Ye{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Ge{constructor(e){this.specification=e}possiblyEvaluate(e,n){return e.expression.evaluate(n)}interpolate(e,n,s){const h=Xo[this.specification.type];return h?h(e,n,s):e}}class it{constructor(e,n){this.specification=e,this.overrides=n}possiblyEvaluate(e,n,s,h){return new kt(this,"constant"===e.expression.kind||"camera"===e.expression.kind?{kind:"constant",value:e.expression.evaluate(n,null,{},s,h)}:e.expression,n)}interpolate(e,n,s){if("constant"!==e.value.kind||"constant"!==n.value.kind)return e;if(void 0===e.value.value||void 0===n.value.value)return new kt(this,{kind:"constant",value:void 0},e.parameters);const h=Xo[this.specification.type];return h?new kt(this,{kind:"constant",value:h(e.value.value,n.value.value,s)},e.parameters):e}evaluate(e,n,s,h,g,_){return"constant"===e.kind?e.value:e.evaluate(n,s,h,g,_)}}class Ct{constructor(e){this.specification=e}possiblyEvaluate(e,n,s,h){return!!e.expression.evaluate(n,null,{},s,h)}interpolate(){return!1}}class Bt{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const n=new He(0,{});for(const s in e){const h=e[s];h.specification.overridable&&this.overridableProperties.push(s);const g=this.defaultPropertyValues[s]=new Xe(h,void 0),_=this.defaultTransitionablePropertyValues[s]=new Qe(h);this.defaultTransitioningPropertyValues[s]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[s]=g.possiblyEvaluate(n)}}}function Mn(t,e){return 256*(t=$t(Math.floor(t),0,255))+$t(Math.floor(e),0,255)}fn(it,"DataDrivenProperty"),fn(Ge,"DataConstantProperty"),fn(Ct,"ColorRampProperty");const _r={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class wn{constructor(e,n){this._structArray=e,this._pos1=n*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class pn{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(e,n){return e._trim(),n&&(e.isTransferred=!0,n.push(e.arrayBuffer)),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const n=Object.create(this.prototype);return n.arrayBuffer=e.arrayBuffer,n.length=e.length,n.capacity=e.arrayBuffer.byteLength/n.bytesPerElement,n._refreshViews(),n}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const n=this.uint8;this._refreshViews(),n&&this.uint8.set(n)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Rn(t,e=1){let n=0,s=0;return{members:t.map(h=>{const g=_r[h.type].BYTES_PER_ELEMENT,_=n=Ir(n,Math.max(e,g)),w=h.components||1;return s=Math.max(s,g),n+=g*w,{name:h.name,type:h.type,components:w,offset:_}}),size:Ir(n,Math.max(s,e)),alignment:e}}function Ir(t,e){return Math.ceil(t/e)*e}class zn extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const h=2*e;return this.int16[h+0]=n,this.int16[h+1]=s,e}}zn.prototype.bytesPerElement=4,fn(zn,"StructArrayLayout2i4");class ti extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s)}emplace(e,n,s,h){const g=3*e;return this.int16[g+0]=n,this.int16[g+1]=s,this.int16[g+2]=h,e}}ti.prototype.bytesPerElement=6,fn(ti,"StructArrayLayout3i6");class pi extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,h)}emplace(e,n,s,h,g){const _=4*e;return this.int16[_+0]=n,this.int16[_+1]=s,this.int16[_+2]=h,this.int16[_+3]=g,e}}pi.prototype.bytesPerElement=8,fn(pi,"StructArrayLayout4i8");class mi extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,_,w){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,s,h,g,_,w)}emplace(e,n,s,h,g,_,w,T){const D=6*e,R=12*e,O=3*e;return this.int16[D+0]=n,this.int16[D+1]=s,this.uint8[R+4]=h,this.uint8[R+5]=g,this.uint8[R+6]=_,this.uint8[R+7]=w,this.float32[O+2]=T,e}}mi.prototype.bytesPerElement=12,fn(mi,"StructArrayLayout2i4ub1f12");class Si extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,h)}emplace(e,n,s,h,g){const _=4*e;return this.float32[_+0]=n,this.float32[_+1]=s,this.float32[_+2]=h,this.float32[_+3]=g,e}}Si.prototype.bytesPerElement=16,fn(Si,"StructArrayLayout4f16");class Oo extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,s,h,g)}emplace(e,n,s,h,g,_){const w=6*e,T=3*e;return this.uint16[w+0]=n,this.uint16[w+1]=s,this.uint16[w+2]=h,this.uint16[w+3]=g,this.float32[T+2]=_,e}}Oo.prototype.bytesPerElement=12,fn(Oo,"StructArrayLayout4ui1f12");class ks extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,h)}emplace(e,n,s,h,g){const _=4*e;return this.uint16[_+0]=n,this.uint16[_+1]=s,this.uint16[_+2]=h,this.uint16[_+3]=g,e}}ks.prototype.bytesPerElement=8,fn(ks,"StructArrayLayout4ui8");class ll extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,_){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,s,h,g,_)}emplace(e,n,s,h,g,_,w){const T=6*e;return this.int16[T+0]=n,this.int16[T+1]=s,this.int16[T+2]=h,this.int16[T+3]=g,this.int16[T+4]=_,this.int16[T+5]=w,e}}ll.prototype.bytesPerElement=12,fn(ll,"StructArrayLayout6i12");class jl extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,_,w,T,D,R,O,B){const V=this.length;return this.resize(V+1),this.emplace(V,e,n,s,h,g,_,w,T,D,R,O,B)}emplace(e,n,s,h,g,_,w,T,D,R,O,B,V){const G=12*e;return this.int16[G+0]=n,this.int16[G+1]=s,this.int16[G+2]=h,this.int16[G+3]=g,this.uint16[G+4]=_,this.uint16[G+5]=w,this.uint16[G+6]=T,this.uint16[G+7]=D,this.int16[G+8]=R,this.int16[G+9]=O,this.int16[G+10]=B,this.int16[G+11]=V,e}}jl.prototype.bytesPerElement=24,fn(jl,"StructArrayLayout4i4ui4i24");class Gi extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,_){const w=this.length;return this.resize(w+1),this.emplace(w,e,n,s,h,g,_)}emplace(e,n,s,h,g,_,w){const T=10*e,D=5*e;return this.int16[T+0]=n,this.int16[T+1]=s,this.int16[T+2]=h,this.float32[D+2]=g,this.float32[D+3]=_,this.float32[D+4]=w,e}}Gi.prototype.bytesPerElement=20,fn(Gi,"StructArrayLayout3i3f20");class Mi extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint32[1*e+0]=n,e}}Mi.prototype.bytesPerElement=4,fn(Mi,"StructArrayLayout1ul4");class Yr extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,_,w,T,D,R,O,B,V){const G=this.length;return this.resize(G+1),this.emplace(G,e,n,s,h,g,_,w,T,D,R,O,B,V)}emplace(e,n,s,h,g,_,w,T,D,R,O,B,V,G){const J=20*e,ce=10*e;return this.int16[J+0]=n,this.int16[J+1]=s,this.int16[J+2]=h,this.int16[J+3]=g,this.int16[J+4]=_,this.float32[ce+3]=w,this.float32[ce+4]=T,this.float32[ce+5]=D,this.float32[ce+6]=R,this.int16[J+14]=O,this.uint32[ce+8]=B,this.uint16[J+18]=V,this.uint16[J+19]=G,e}}Yr.prototype.bytesPerElement=40,fn(Yr,"StructArrayLayout5i4f1i1ul2ui40");class ho extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,_,w){const T=this.length;return this.resize(T+1),this.emplace(T,e,n,s,h,g,_,w)}emplace(e,n,s,h,g,_,w,T){const D=8*e;return this.int16[D+0]=n,this.int16[D+1]=s,this.int16[D+2]=h,this.int16[D+4]=g,this.int16[D+5]=_,this.int16[D+6]=w,this.int16[D+7]=T,e}}ho.prototype.bytesPerElement=16,fn(ho,"StructArrayLayout3i2i2i16");class ps extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,s,h,g)}emplace(e,n,s,h,g,_){const w=4*e,T=8*e;return this.float32[w+0]=n,this.float32[w+1]=s,this.float32[w+2]=h,this.int16[T+6]=g,this.int16[T+7]=_,e}}ps.prototype.bytesPerElement=16,fn(ps,"StructArrayLayout2f1f2i16");class Ei extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,h)}emplace(e,n,s,h,g){const _=12*e,w=3*e;return this.uint8[_+0]=n,this.uint8[_+1]=s,this.float32[w+1]=h,this.float32[w+2]=g,e}}Ei.prototype.bytesPerElement=12,fn(Ei,"StructArrayLayout2ub2f12");class ms extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s)}emplace(e,n,s,h){const g=3*e;return this.float32[g+0]=n,this.float32[g+1]=s,this.float32[g+2]=h,e}}ms.prototype.bytesPerElement=12,fn(ms,"StructArrayLayout3f12");class gs extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s){const h=this.length;return this.resize(h+1),this.emplace(h,e,n,s)}emplace(e,n,s,h){const g=3*e;return this.uint16[g+0]=n,this.uint16[g+1]=s,this.uint16[g+2]=h,e}}gs.prototype.bytesPerElement=6,fn(gs,"StructArrayLayout3ui6");class wl extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,_,w,T,D,R,O,B,V,G,J,ce,xe,Me,ve,Se,Le){const Pe=this.length;return this.resize(Pe+1),this.emplace(Pe,e,n,s,h,g,_,w,T,D,R,O,B,V,G,J,ce,xe,Me,ve,Se,Le)}emplace(e,n,s,h,g,_,w,T,D,R,O,B,V,G,J,ce,xe,Me,ve,Se,Le,Pe){const Ke=30*e,Ze=15*e,_t=60*e;return this.int16[Ke+0]=n,this.int16[Ke+1]=s,this.int16[Ke+2]=h,this.float32[Ze+2]=g,this.float32[Ze+3]=_,this.uint16[Ke+8]=w,this.uint16[Ke+9]=T,this.uint32[Ze+5]=D,this.uint32[Ze+6]=R,this.uint32[Ze+7]=O,this.uint16[Ke+16]=B,this.uint16[Ke+17]=V,this.uint16[Ke+18]=G,this.float32[Ze+10]=J,this.float32[Ze+11]=ce,this.uint8[_t+48]=xe,this.uint8[_t+49]=Me,this.uint8[_t+50]=ve,this.uint32[Ze+13]=Se,this.int16[Ke+28]=Le,this.uint8[_t+58]=Pe,e}}wl.prototype.bytesPerElement=60,fn(wl,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class qs extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g,_,w,T,D,R,O,B,V,G,J,ce,xe,Me,ve,Se,Le,Pe,Ke,Ze,_t,jt,ot,vt,wt,Lt){const Vt=this.length;return this.resize(Vt+1),this.emplace(Vt,e,n,s,h,g,_,w,T,D,R,O,B,V,G,J,ce,xe,Me,ve,Se,Le,Pe,Ke,Ze,_t,jt,ot,vt,wt,Lt)}emplace(e,n,s,h,g,_,w,T,D,R,O,B,V,G,J,ce,xe,Me,ve,Se,Le,Pe,Ke,Ze,_t,jt,ot,vt,wt,Lt,Vt){const st=38*e,tn=19*e;return this.int16[st+0]=n,this.int16[st+1]=s,this.int16[st+2]=h,this.float32[tn+2]=g,this.float32[tn+3]=_,this.int16[st+8]=w,this.int16[st+9]=T,this.int16[st+10]=D,this.int16[st+11]=R,this.int16[st+12]=O,this.int16[st+13]=B,this.uint16[st+14]=V,this.uint16[st+15]=G,this.uint16[st+16]=J,this.uint16[st+17]=ce,this.uint16[st+18]=xe,this.uint16[st+19]=Me,this.uint16[st+20]=ve,this.uint16[st+21]=Se,this.uint16[st+22]=Le,this.uint16[st+23]=Pe,this.uint16[st+24]=Ke,this.uint16[st+25]=Ze,this.uint16[st+26]=_t,this.uint16[st+27]=jt,this.uint16[st+28]=ot,this.uint32[tn+15]=vt,this.float32[tn+16]=wt,this.float32[tn+17]=Lt,this.float32[tn+18]=Vt,e}}qs.prototype.bytesPerElement=76,fn(qs,"StructArrayLayout3i2f6i15ui1ul3f76");class pa extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.float32[1*e+0]=n,e}}pa.prototype.bytesPerElement=4,fn(pa,"StructArrayLayout1f4");class Ma extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n,s,h,g){const _=this.length;return this.resize(_+1),this.emplace(_,e,n,s,h,g)}emplace(e,n,s,h,g,_){const w=5*e;return this.float32[w+0]=n,this.float32[w+1]=s,this.float32[w+2]=h,this.float32[w+3]=g,this.float32[w+4]=_,e}}Ma.prototype.bytesPerElement=20,fn(Ma,"StructArrayLayout5f20");class bl extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n,s,h){const g=this.length;return this.resize(g+1),this.emplace(g,e,n,s,h)}emplace(e,n,s,h,g){const _=6*e;return this.uint32[3*e+0]=n,this.uint16[_+2]=s,this.uint16[_+3]=h,this.uint16[_+4]=g,e}}bl.prototype.bytesPerElement=12,fn(bl,"StructArrayLayout1ul3ui12");class El extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const h=2*e;return this.uint16[h+0]=n,this.uint16[h+1]=s,e}}El.prototype.bytesPerElement=4,fn(El,"StructArrayLayout2ui4");class cl extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const n=this.length;return this.resize(n+1),this.emplace(n,e)}emplace(e,n){return this.uint16[1*e+0]=n,e}}cl.prototype.bytesPerElement=2,fn(cl,"StructArrayLayout1ui2");class zc extends pn{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,n){const s=this.length;return this.resize(s+1),this.emplace(s,e,n)}emplace(e,n,s){const h=2*e;return this.float32[h+0]=n,this.float32[h+1]=s,e}}zc.prototype.bytesPerElement=8,fn(zc,"StructArrayLayout2f8");class em extends wn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}em.prototype.size=40;class cf extends Yr{get(e){return new em(this,e)}}fn(cf,"CollisionBoxArray");class uf extends wn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}uf.prototype.size=60;class tm extends wl{get(e){return new uf(this,e)}}fn(tm,"PlacedSymbolArray");class nm extends wn{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(e){this._structArray.uint32[this._pos4+15]=e}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}nm.prototype.size=76;class ma extends qs{get(e){return new nm(this,e)}}fn(ma,"SymbolInstanceArray");class ad extends pa{getoffsetX(e){return this.float32[1*e+0]}}fn(ad,"GlyphOffsetArray");class hf extends zn{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}fn(hf,"SymbolLineVertexArray");class ld extends wn{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ld.prototype.size=12;class Zs extends bl{get(e){return new ld(this,e)}}fn(Zs,"FeatureIndexArray");class Fu extends El{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}fn(Fu,"FillExtrusionCentroidArray");const rm=Rn([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),im=Rn([{name:"a_dash",components:4,type:"Uint16"}]);var lu={},om={get exports(){return lu},set exports(t){lu=t}},df={};({get exports(){return df},set exports(t){df=t}}).exports=function(t,e){var n,s,h,g,_,w,T,D;for(s=t.length-(n=3&t.length),h=e,_=3432918353,w=461845907,D=0;D<s;)T=255&t.charCodeAt(D)|(255&t.charCodeAt(++D))<<8|(255&t.charCodeAt(++D))<<16|(255&t.charCodeAt(++D))<<24,++D,h=27492+(65535&(g=5*(65535&(h=(h^=T=(65535&(T=(T=(65535&T)*_+(((T>>>16)*_&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295)<<13|h>>>19))+((5*(h>>>16)&65535)<<16)&4294967295))+((58964+(g>>>16)&65535)<<16);switch(T=0,n){case 3:T^=(255&t.charCodeAt(D+2))<<16;case 2:T^=(255&t.charCodeAt(D+1))<<8;case 1:h^=T=(65535&(T=(T=(65535&(T^=255&t.charCodeAt(D)))*_+(((T>>>16)*_&65535)<<16)&4294967295)<<15|T>>>17))*w+(((T>>>16)*w&65535)<<16)&4294967295}return h^=t.length,h=2246822507*(65535&(h^=h>>>16))+((2246822507*(h>>>16)&65535)<<16)&4294967295,h=3266489909*(65535&(h^=h>>>13))+((3266489909*(h>>>16)&65535)<<16)&4294967295,(h^=h>>>16)>>>0};var cd={};({get exports(){return cd},set exports(t){cd=t}}).exports=function(t,e){for(var n,s=t.length,h=e^s,g=0;s>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(g)|(255&t.charCodeAt(++g))<<8|(255&t.charCodeAt(++g))<<16|(255&t.charCodeAt(++g))<<24))+((1540483477*(n>>>16)&65535)<<16),h=1540483477*(65535&h)+((1540483477*(h>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),s-=4,++g;switch(s){case 3:h^=(255&t.charCodeAt(g+2))<<16;case 2:h^=(255&t.charCodeAt(g+1))<<8;case 1:h=1540483477*(65535&(h^=255&t.charCodeAt(g)))+((1540483477*(h>>>16)&65535)<<16)}return h=1540483477*(65535&(h^=h>>>13))+((1540483477*(h>>>16)&65535)<<16),(h^=h>>>15)>>>0};var sm=df,am=cd;om.exports=sm,lu.murmur3=sm,lu.murmur2=am;class ud{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(e,n,s,h){this.ids.push(lm(e)),this.positions.push(n,s,h)}getPositions(e){const n=lm(e);let s=0,h=this.ids.length-1;for(;s<h;){const _=s+h>>1;this.ids[_]>=n?h=_:s=_+1}const g=[];for(;this.ids[s]===n;)g.push({index:this.positions[3*s],start:this.positions[3*s+1],end:this.positions[3*s+2]}),s++;return g}static serialize(e,n){const s=new Float64Array(e.ids),h=new Uint32Array(e.positions);return fh(s,h,0,s.length-1),n&&n.push(s.buffer,h.buffer),{ids:s,positions:h}}static deserialize(e){const n=new ud;return n.ids=e.ids,n.positions=e.positions,n.indexed=!0,n}}function lm(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:lu(String(t))}function fh(t,e,n,s){for(;n<s;){const h=t[n+s>>1];let g=n-1,_=s+1;for(;;){do{g++}while(t[g]<h);do{_--}while(t[_]>h);if(g>=_)break;zu(t,g,_),zu(e,3*g,3*_),zu(e,3*g+1,3*_+1),zu(e,3*g+2,3*_+2)}_-n<s-_?(fh(t,e,n,_),n=_+1):(fh(t,e,_+1,s),s=_)}}function zu(t,e,n){const s=t[e];t[e]=t[n],t[n]=s}fn(ud,"FeaturePositionMap");class uc{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,n){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,n),this.initialized=!0),!!this.location}}class Bc extends uc{constructor(e){super(e),this.current=0}set(e,n,s){this.fetchUniformLocation(e,n)&&this.current!==s&&(this.current=s,this.gl.uniform1f(this.location,s))}}class cm extends uc{constructor(e){super(e),this.current=[0,0,0,0]}set(e,n,s){this.fetchUniformLocation(e,n)&&(s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]&&s[3]===this.current[3]||(this.current=s,this.gl.uniform4f(this.location,s[0],s[1],s[2],s[3])))}}class um extends uc{constructor(e){super(e),this.current=Qr.transparent}set(e,n,s){this.fetchUniformLocation(e,n)&&(s.r===this.current.r&&s.g===this.current.g&&s.b===this.current.b&&s.a===this.current.a||(this.current=s,this.gl.uniform4f(this.location,s.r,s.g,s.b,s.a)))}}const ff=new Float32Array(16),pf=new Float32Array(9),hm=new Float32Array(4);function Nc(t){return[Mn(255*t.r,255*t.g),Mn(255*t.b,255*t.a)]}class cu{constructor(e,n,s){this.value=e,this.uniformNames=n.map(h=>`u_${h}`),this.type=s}setUniform(e,n,s,h,g){n.set(e,g,h.constantOr(this.value))}getBinding(e,n){return"color"===this.type?new um(e):new Bc(e)}}class uu{constructor(e,n){this.uniformNames=n.map(s=>`u_${s}`),this.pattern=null,this.pixelRatio=1}setConstantPatternPositions(e){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br)}setUniform(e,n,s,h,g){const _="u_pattern"===g||"u_dash"===g?this.pattern:"u_pixel_ratio"===g?this.pixelRatio:null;_&&n.set(e,g,_)}getBinding(e,n){return"u_pattern"===n||"u_dash"===n?new cm(e):new Bc(e)}}class hc{constructor(e,n,s,h){this.expression=e,this.type=s,this.maxValue=0,this.paintVertexAttributes=n.map(g=>({name:`a_${g}`,type:"Float32",components:"color"===s?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(e,n,s,h,g,_){const w=this.paintVertexArray.length,T=this.expression.evaluate(new He(0),n,{},g,h,_);this.paintVertexArray.resize(e),this._setPaintValue(w,e,T)}updatePaintArray(e,n,s,h,g){const _=this.expression.evaluate({zoom:0},s,h,void 0,g);this._setPaintValue(e,n,_)}_setPaintValue(e,n,s){if("color"===this.type){const h=Nc(s);for(let g=e;g<n;g++)this.paintVertexArray.emplace(g,h[0],h[1])}else{for(let h=e;h<n;h++)this.paintVertexArray.emplace(h,s);this.maxValue=Math.max(this.maxValue,Math.abs(s))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class $a{constructor(e,n,s,h,g,_){this.expression=e,this.uniformNames=n.map(w=>`u_${w}_t`),this.type=s,this.useIntegerZoom=h,this.zoom=g,this.maxValue=0,this.paintVertexAttributes=n.map(w=>({name:`a_${w}`,type:"Float32",components:"color"===s?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(e,n,s,h,g,_){const w=this.expression.evaluate(new He(this.zoom),n,{},g,h,_),T=this.expression.evaluate(new He(this.zoom+1),n,{},g,h,_),D=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(D,e,w,T)}updatePaintArray(e,n,s,h,g){const _=this.expression.evaluate({zoom:this.zoom},s,h,void 0,g),w=this.expression.evaluate({zoom:this.zoom+1},s,h,void 0,g);this._setPaintValue(e,n,_,w)}_setPaintValue(e,n,s,h){if("color"===this.type){const g=Nc(s),_=Nc(h);for(let w=e;w<n;w++)this.paintVertexArray.emplace(w,g[0],g[1],_[0],_[1])}else{for(let g=e;g<n;g++)this.paintVertexArray.emplace(g,s,h);this.maxValue=Math.max(this.maxValue,Math.abs(s),Math.abs(h))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,n,s,h,g){const _=this.useIntegerZoom?Math.floor(s.zoom):s.zoom,w=$t(this.expression.interpolationFactor(_,this.zoom,this.zoom+1),0,1);n.set(e,g,w)}getBinding(e,n){return new Bc(e)}}class Uc{constructor(e,n,s,h,g){this.expression=e,this.layerId=g,this.paintVertexAttributes=("array"===s?im:rm).members;for(let _=0;_<n.length;++_);this.paintVertexArray=new h}populatePaintArray(e,n,s){const h=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(h,e,n.patterns&&n.patterns[this.layerId],s)}updatePaintArray(e,n,s,h,g,_){this._setPaintValues(e,n,s.patterns&&s.patterns[this.layerId],_)}_setPaintValues(e,n,s,h){if(!h||!s)return;const g=h[s];if(!g)return;const{tl:_,br:w,pixelRatio:T}=g;for(let D=e;D<n;D++)this.paintVertexArray.emplace(D,_[0],_[1],w[0],w[1],T)}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class jc{constructor(e,n,s=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const g in e.paint._values){if(!s(g))continue;const _=e.paint.get(g);if(!(_ instanceof kt&&Kr(_.property.specification)))continue;const w=Ug(g,e.type),T=_.value,D=_.property.specification.type,R=_.property.useIntegerZoom,O="line-dasharray"===g||g.endsWith("pattern"),B="line-dasharray"===g&&"constant"!==e.layout.get("line-cap").value.kind;if("constant"!==T.kind||B)if("source"===T.kind||B||O){const V=hd(g,D,"source");this.binders[g]=O?new Uc(T,w,D,V,e.id):new hc(T,w,D,V),h.push(`/a_${g}`)}else{const V=hd(g,D,"composite");this.binders[g]=new $a(T,w,D,R,n,V),h.push(`/z_${g}`)}else this.binders[g]=O?new uu(T.value,w):new cu(T.value,w,D),h.push(`/u_${g}`)}this.cacheKey=h.sort().join("")}getMaxValue(e){const n=this.binders[e];return n instanceof hc||n instanceof $a?n.maxValue:0}populatePaintArrays(e,n,s,h,g,_){for(const w in this.binders){const T=this.binders[w];(T instanceof hc||T instanceof $a||T instanceof Uc)&&T.populatePaintArray(e,n,s,h,g,_)}}setConstantPatternPositions(e){for(const n in this.binders){const s=this.binders[n];s instanceof uu&&s.setConstantPatternPositions(e)}}updatePaintArrays(e,n,s,h,g,_){let w=!1;for(const T in e){const D=n.getPositions(T);for(const R of D){const O=s.feature(R.index);for(const B in this.binders){const V=this.binders[B];if((V instanceof hc||V instanceof $a||V instanceof Uc)&&!0===V.expression.isStateDependent){const G=h.paint.get(B);V.expression=G.value,V.updatePaintArray(R.start,R.end,O,e[T],g,_),w=!0}}}}return w}defines(){const e=[];for(const n in this.binders){const s=this.binders[n];(s instanceof cu||s instanceof uu)&&e.push(...s.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return e}getBinderAttributes(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof hc||s instanceof $a||s instanceof Uc)for(let h=0;h<s.paintVertexAttributes.length;h++)e.push(s.paintVertexAttributes[h].name)}return e}getBinderUniforms(){const e=[];for(const n in this.binders){const s=this.binders[n];if(s instanceof cu||s instanceof uu||s instanceof $a)for(const h of s.uniformNames)e.push(h)}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const n=[];for(const s in this.binders){const h=this.binders[s];if(h instanceof cu||h instanceof uu||h instanceof $a)for(const g of h.uniformNames)n.push({name:g,property:s,binding:h.getBinding(e,g)})}return n}setUniforms(e,n,s,h,g){for(const{name:_,property:w,binding:T}of s)this.binders[w].setUniform(e,T,g,h.get(w),_)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const n=this.binders[e];(n instanceof hc||n instanceof $a||n instanceof Uc)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(e){for(const n in this.binders){const s=this.binders[n];(s instanceof hc||s instanceof $a||s instanceof Uc)&&s.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const n=this.binders[e];(n instanceof hc||n instanceof $a||n instanceof Uc)&&n.destroy()}}}class hu{constructor(e,n,s=(()=>!0)){this.programConfigurations={};for(const h of e)this.programConfigurations[h.id]=new jc(h,n,s);this.needsUpload=!1,this._featureMap=new ud,this._bufferOffset=0}populatePaintArrays(e,n,s,h,g,_,w){for(const T in this.programConfigurations)this.programConfigurations[T].populatePaintArrays(e,n,h,g,_,w);void 0!==n.id&&this._featureMap.add(n.id,s,this._bufferOffset,e),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,n,s,h,g){for(const _ of s)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(e,this._featureMap,n,_,h,g)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const n in this.programConfigurations)this.programConfigurations[n].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Ng={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio"],"fill-pattern":["pattern","pixel_ratio"],"fill-extrusion-pattern":["pattern","pixel_ratio"],"line-dasharray":["dash"]};function Ug(t,e){return Ng[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const jg={"line-pattern":{source:Oo,composite:Oo},"fill-pattern":{source:Oo,composite:Oo},"fill-extrusion-pattern":{source:Oo,composite:Oo},"line-dasharray":{source:ks,composite:ks}},dm={color:{source:zc,composite:Si},number:{source:pa,composite:zc}};function hd(t,e,n){const s=jg[t];return s&&s[n]||dm[e][n]}fn(cu,"ConstantBinder"),fn(uu,"PatternConstantBinder"),fn(hc,"SourceExpressionBinder"),fn(Uc,"PatternCompositeBinder"),fn($a,"CompositeExpressionBinder"),fn(jc,"ProgramConfiguration",{omit:["_buffers"]}),fn(hu,"ProgramConfigurationSet");const ph="-transition";class Ga extends Hi{constructor(e,n){if(super(),this.id=e.id,this.type=e.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&"sky"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new at(n.layout)),n.paint)){this._transitionablePaint=new qt(n.paint);for(const s in e.paint)this.setPaintProperty(s,e.paint[s],{validate:!1});for(const s in e.layout)this.setLayoutProperty(s,e.layout[s],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ye(n.paint)}}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,n,s={}){null!=n&&this._validate(ic,`layers.${this.id}.layout.${e}`,e,n,s)||("visibility"!==e?this._unevaluatedLayout.setValue(e,n):this.visibility=n)}getPaintProperty(e){return or(e,ph)?this._transitionablePaint.getTransition(e.slice(0,-ph.length)):this._transitionablePaint.getValue(e)}setPaintProperty(e,n,s={}){if(null!=n&&this._validate(dh,`layers.${this.id}.paint.${e}`,e,n,s))return!1;if(or(e,ph))return this._transitionablePaint.setTransition(e.slice(0,-ph.length),n||void 0),!1;{const h=this._transitionablePaint._values[e],g=h.value.isDataDriven(),_=h.value;this._transitionablePaint.setValue(e,n),this._handleSpecialPaintPropertyUpdate(e);const w=this._transitionablePaint._values[e].value,T=w.isDataDriven(),D=or(e,"pattern")||"line-dasharray"===e;return T||g||D||this._handleOverridablePaintPropertyUpdate(e,_,w)}}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getProgramConfiguration(e){return null}_handleOverridablePaintPropertyUpdate(e,n,s){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,n){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,n)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,n)}serialize(){const e={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(e.layout=e.layout||{},e.layout.visibility=this.visibility),In(e,(n,s)=>!(void 0===n||"layout"===s&&!Object.keys(n).length||"paint"===s&&!Object.keys(n).length))}_validate(e,n,s,h,g={}){return(!g||!1!==g.validate)&&Ps(this,e.call(Bl,{key:n,layerType:this.type,objectKey:s,value:h,styleSpec:ct,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const e in this.paint._values){const n=this.paint.get(e);if(n instanceof kt&&Kr(n.property.specification)&&("source"===n.value.kind||"composite"===n.value.kind)&&n.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Ca(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Vg=Rn([{name:"a_pos",components:2,type:"Int16"}],4),$g=Rn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class yo{constructor(e=[]){this.segments=e}prepareSegment(e,n,s,h){let g=this.segments[this.segments.length-1];return e>yo.MAX_VERTEX_ARRAY_LENGTH&&vr(`Max vertices per segment is ${yo.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${e}`),(!g||g.vertexLength+e>yo.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:n.length,primitiveOffset:s.length,vertexLength:0,primitiveLength:0},void 0!==h&&(g.sortKey=h),this.segments.push(g)),g}get(){return this.segments}destroy(){for(const e of this.segments)for(const n in e.vaos)e.vaos[n].destroy()}static simpleSegment(e,n,s,h){return new yo([{vertexOffset:e,primitiveOffset:n,vertexLength:s,primitiveLength:h,vaos:{},sortKey:0}])}}yo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,fn(yo,"SegmentVector");var er=8192;class Ia{constructor(e,n){e&&(n?this.setSouthWest(e).setNorthEast(n):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof Vr?new Vr(e.lng,e.lat):Vr.convert(e),this}setSouthWest(e){return this._sw=e instanceof Vr?new Vr(e.lng,e.lat):Vr.convert(e),this}extend(e){const n=this._sw,s=this._ne;let h,g;if(e instanceof Vr)h=e,g=e;else{if(!(e instanceof Ia))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(Ia.convert(e)):this.extend(Vr.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&e.hasOwnProperty("lon")?this.extend(Vr.convert(e)):this;if(h=e._sw,g=e._ne,!h||!g)return this}return n||s?(n.lng=Math.min(h.lng,n.lng),n.lat=Math.min(h.lat,n.lat),s.lng=Math.max(g.lng,s.lng),s.lat=Math.max(g.lat,s.lat)):(this._sw=new Vr(h.lng,h.lat),this._ne=new Vr(g.lng,g.lat)),this}getCenter(){return new Vr((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Vr(this.getWest(),this.getNorth())}getSouthEast(){return new Vr(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:n,lat:s}=Vr.convert(e);let h=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=s&&s<=this._ne.lat&&h}static convert(e){return!e||e instanceof Ia?e:new Ia(e)}}var mh=1e-6,ga=typeof Float32Array<"u"?Float32Array:Array;function fm(){var t=new ga(9);return ga!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Gg(t,e,n){var s=e[0],h=e[1],g=e[2],_=e[3],w=e[4],T=e[5],D=e[6],R=e[7],O=e[8],B=n[0],V=n[1],G=n[2],J=n[3],ce=n[4],xe=n[5],Me=n[6],ve=n[7],Se=n[8];return t[0]=B*s+V*_+G*D,t[1]=B*h+V*w+G*R,t[2]=B*g+V*T+G*O,t[3]=J*s+ce*_+xe*D,t[4]=J*h+ce*w+xe*R,t[5]=J*g+ce*T+xe*O,t[6]=Me*s+ve*_+Se*D,t[7]=Me*h+ve*w+Se*R,t[8]=Me*g+ve*T+Se*O,t}function Aa(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function mf(t,e){var n=e[0],s=e[1],h=e[2],g=e[3],_=e[4],w=e[5],T=e[6],D=e[7],R=e[8],O=e[9],B=e[10],V=e[11],G=e[12],J=e[13],ce=e[14],xe=e[15],Me=n*w-s*_,ve=n*T-h*_,Se=n*D-g*_,Le=s*T-h*w,Pe=s*D-g*w,Ke=h*D-g*T,Ze=R*J-O*G,_t=R*ce-B*G,jt=R*xe-V*G,ot=O*ce-B*J,vt=O*xe-V*J,wt=B*xe-V*ce,Lt=Me*wt-ve*vt+Se*ot+Le*jt-Pe*_t+Ke*Ze;return Lt?(t[0]=(w*wt-T*vt+D*ot)*(Lt=1/Lt),t[1]=(h*vt-s*wt-g*ot)*Lt,t[2]=(J*Ke-ce*Pe+xe*Le)*Lt,t[3]=(B*Pe-O*Ke-V*Le)*Lt,t[4]=(T*jt-_*wt-D*_t)*Lt,t[5]=(n*wt-h*jt+g*_t)*Lt,t[6]=(ce*Se-G*Ke-xe*ve)*Lt,t[7]=(R*Ke-B*Se+V*ve)*Lt,t[8]=(_*vt-w*jt+D*Ze)*Lt,t[9]=(s*jt-n*vt-g*Ze)*Lt,t[10]=(G*Pe-J*Se+xe*Me)*Lt,t[11]=(O*Se-R*Pe-V*Me)*Lt,t[12]=(w*_t-_*ot-T*Ze)*Lt,t[13]=(n*ot-s*_t+h*Ze)*Lt,t[14]=(J*ve-G*Le-ce*Me)*Lt,t[15]=(R*Le-O*ve+B*Me)*Lt,t):null}function Vc(t,e,n){var s=e[0],h=e[1],g=e[2],_=e[3],w=e[4],T=e[5],D=e[6],R=e[7],O=e[8],B=e[9],V=e[10],G=e[11],J=e[12],ce=e[13],xe=e[14],Me=e[15],ve=n[0],Se=n[1],Le=n[2],Pe=n[3];return t[0]=ve*s+Se*w+Le*O+Pe*J,t[1]=ve*h+Se*T+Le*B+Pe*ce,t[2]=ve*g+Se*D+Le*V+Pe*xe,t[3]=ve*_+Se*R+Le*G+Pe*Me,t[4]=(ve=n[4])*s+(Se=n[5])*w+(Le=n[6])*O+(Pe=n[7])*J,t[5]=ve*h+Se*T+Le*B+Pe*ce,t[6]=ve*g+Se*D+Le*V+Pe*xe,t[7]=ve*_+Se*R+Le*G+Pe*Me,t[8]=(ve=n[8])*s+(Se=n[9])*w+(Le=n[10])*O+(Pe=n[11])*J,t[9]=ve*h+Se*T+Le*B+Pe*ce,t[10]=ve*g+Se*D+Le*V+Pe*xe,t[11]=ve*_+Se*R+Le*G+Pe*Me,t[12]=(ve=n[12])*s+(Se=n[13])*w+(Le=n[14])*O+(Pe=n[15])*J,t[13]=ve*h+Se*T+Le*B+Pe*ce,t[14]=ve*g+Se*D+Le*V+Pe*xe,t[15]=ve*_+Se*R+Le*G+Pe*Me,t}function Bu(t,e,n){var s,h,g,_,w,T,D,R,O,B,V,G,J=n[0],ce=n[1],xe=n[2];return e===t?(t[12]=e[0]*J+e[4]*ce+e[8]*xe+e[12],t[13]=e[1]*J+e[5]*ce+e[9]*xe+e[13],t[14]=e[2]*J+e[6]*ce+e[10]*xe+e[14],t[15]=e[3]*J+e[7]*ce+e[11]*xe+e[15]):(h=e[1],g=e[2],_=e[3],w=e[4],T=e[5],D=e[6],R=e[7],O=e[8],B=e[9],V=e[10],G=e[11],t[0]=s=e[0],t[1]=h,t[2]=g,t[3]=_,t[4]=w,t[5]=T,t[6]=D,t[7]=R,t[8]=O,t[9]=B,t[10]=V,t[11]=G,t[12]=s*J+w*ce+O*xe+e[12],t[13]=h*J+T*ce+B*xe+e[13],t[14]=g*J+D*ce+V*xe+e[14],t[15]=_*J+R*ce+G*xe+e[15]),t}function $c(t,e,n){var s=n[0],h=n[1],g=n[2];return t[0]=e[0]*s,t[1]=e[1]*s,t[2]=e[2]*s,t[3]=e[3]*s,t[4]=e[4]*h,t[5]=e[5]*h,t[6]=e[6]*h,t[7]=e[7]*h,t[8]=e[8]*g,t[9]=e[9]*g,t[10]=e[10]*g,t[11]=e[11]*g,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function gh(t,e,n){var s=Math.sin(n),h=Math.cos(n),g=e[4],_=e[5],w=e[6],T=e[7],D=e[8],R=e[9],O=e[10],B=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=g*h+D*s,t[5]=_*h+R*s,t[6]=w*h+O*s,t[7]=T*h+B*s,t[8]=D*h-g*s,t[9]=R*h-_*s,t[10]=O*h-w*s,t[11]=B*h-T*s,t}function _h(t,e,n){var s=Math.sin(n),h=Math.cos(n),g=e[0],_=e[1],w=e[2],T=e[3],D=e[8],R=e[9],O=e[10],B=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=g*h-D*s,t[1]=_*h-R*s,t[2]=w*h-O*s,t[3]=T*h-B*s,t[8]=g*s+D*h,t[9]=_*s+R*h,t[10]=w*s+O*h,t[11]=T*s+B*h,t}function yh(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function vh(t,e,n){var s,h,g,_=n[0],w=n[1],T=n[2],D=Math.hypot(_,w,T);return D<mh?null:(_*=D=1/D,w*=D,T*=D,s=Math.sin(e),h=Math.cos(e),t[0]=_*_*(g=1-h)+h,t[1]=w*_*g+T*s,t[2]=T*_*g-w*s,t[3]=0,t[4]=_*w*g-T*s,t[5]=w*w*g+h,t[6]=T*w*g+_*s,t[7]=0,t[8]=_*T*g+w*s,t[9]=w*T*g-_*s,t[10]=T*T*g+h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var pm=Vc;function xh(){var t=new ga(3);return ga!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function dd(t){var e=new ga(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function du(t){return Math.hypot(t[0],t[1],t[2])}function Vl(t,e,n){var s=new ga(3);return s[0]=t,s[1]=e,s[2]=n,s}function dc(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function fd(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function mm(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function wh(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function bh(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function Pa(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function Nu(t,e,n,s){return t[0]=e[0]+n[0]*s,t[1]=e[1]+n[1]*s,t[2]=e[2]+n[2]*s,t}function _s(t,e){var n=e[0],s=e[1],h=e[2],g=n*n+s*s+h*h;return g>0&&(g=1/Math.sqrt(g)),t[0]=e[0]*g,t[1]=e[1]*g,t[2]=e[2]*g,t}function Ra(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Gc(t,e,n){var s=e[0],h=e[1],g=e[2],_=n[0],w=n[1],T=n[2];return t[0]=h*T-g*w,t[1]=g*_-s*T,t[2]=s*w-h*_,t}function vo(t,e,n){var s=e[0],h=e[1],g=e[2],_=n[3]*s+n[7]*h+n[11]*g+n[15];return t[0]=(n[0]*s+n[4]*h+n[8]*g+n[12])/(_=_||1),t[1]=(n[1]*s+n[5]*h+n[9]*g+n[13])/_,t[2]=(n[2]*s+n[6]*h+n[10]*g+n[14])/_,t}function gm(t,e,n){var s=n[0],h=n[1],g=n[2],_=e[0],w=e[1],T=e[2],D=h*T-g*w,R=g*_-s*T,O=s*w-h*_,B=h*O-g*R,V=g*D-s*O,G=s*R-h*D,J=2*n[3];return R*=J,O*=J,V*=2,G*=2,t[0]=_+(D*=J)+(B*=2),t[1]=w+R+V,t[2]=T+O+G,t}var pd,Tl=fd,gf=mm,Hg=du;function _f(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Eh(t,e){var n=e[0],s=e[1],h=e[2],g=e[3],_=n*n+s*s+h*h+g*g;return _>0&&(_=1/Math.sqrt(_)),t[0]=n*_,t[1]=s*_,t[2]=h*_,t[3]=g*_,t}function fc(t,e,n){var s=e[0],h=e[1],g=e[2],_=e[3];return t[0]=n[0]*s+n[4]*h+n[8]*g+n[12]*_,t[1]=n[1]*s+n[5]*h+n[9]*g+n[13]*_,t[2]=n[2]*s+n[6]*h+n[10]*g+n[14]*_,t[3]=n[3]*s+n[7]*h+n[11]*g+n[15]*_,t}function yf(){var t=new ga(4);return ga!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function vf(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function xf(t,e,n){n*=.5;var s=e[0],h=e[1],g=e[2],_=e[3],w=Math.sin(n),T=Math.cos(n);return t[0]=s*T+_*w,t[1]=h*T+g*w,t[2]=g*T-h*w,t[3]=_*T-s*w,t}function wf(t,e,n){n*=.5;var s=e[0],h=e[1],g=e[2],_=e[3],w=Math.sin(n),T=Math.cos(n);return t[0]=s*T-g*w,t[1]=h*T+_*w,t[2]=g*T+s*w,t[3]=_*T-h*w,t}xh(),pd=new ga(4),ga!=Float32Array&&(pd[0]=0,pd[1]=0,pd[2]=0,pd[3]=0);var Wg=Eh;xh(),Vl(1,0,0),Vl(0,1,0),yf(),yf(),fm();const qg=Rn([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:_m}=qg,ym=Rn([{name:"a_pos_3",components:3,type:"Int16"}]);var Th=Rn([{name:"a_pos",type:"Int16",components:2}]);class $l{constructor(e,n){this.pos=e,this.dir=n}intersectsPlane(e,n,s){const h=Ra(n,this.dir);if(Math.abs(h)<1e-6)return!1;const g=((e[0]-this.pos[0])*n[0]+(e[1]-this.pos[1])*n[1]+(e[2]-this.pos[2])*n[2])/h;return s[0]=this.pos[0]+this.dir[0]*g,s[1]=this.pos[1]+this.dir[1]*g,s[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(e,n,s){if(J=(V=this.pos)[0],ce=V[1],xe=V[2],Me=(G=e)[0],ve=G[1],Se=G[2],Math.abs(J-Me)<=mh*Math.max(1,Math.abs(J),Math.abs(Me))&&Math.abs(ce-ve)<=mh*Math.max(1,Math.abs(ce),Math.abs(ve))&&Math.abs(xe-Se)<=mh*Math.max(1,Math.abs(xe),Math.abs(Se))||0===n)return s[0]=s[1]=s[2]=0,!1;var V,G,J,ce,xe,Me,ve,Se;const[h,g,_]=this.dir,w=this.pos[0]-e[0],T=this.pos[1]-e[1],D=this.pos[2]-e[2],R=h*h+g*g+_*_,O=2*(w*h+T*g+D*_),B=O*O-4*R*(w*w+T*T+D*D-n*n);if(B<0){const V=Math.max(-O/2,0),G=w+h*V,J=T+g*V,ce=D+_*V,xe=Math.hypot(G,J,ce);return s[0]=G*n/xe,s[1]=J*n/xe,s[2]=ce*n/xe,!1}{const V=(-O-Math.sqrt(B))/(2*R);if(V<0){const G=Math.hypot(w,T,D);return s[0]=w*n/G,s[1]=T*n/G,s[2]=D*n/G,!1}return s[0]=w+h*V,s[1]=T+g*V,s[2]=D+_*V,!0}}}class fu{constructor(e,n,s,h,g){this.TL=e,this.TR=n,this.BR=s,this.BL=h,this.horizon=g}static fromInvProjectionMatrix(e,n,s){const h=[-1,1,1],g=[1,1,1],_=[1,-1,1],w=[-1,-1,1],T=vo(h,h,e),D=vo(g,g,e),R=vo(_,_,e),O=vo(w,w,e);return new fu(T,D,R,O,n/s)}}class bf{constructor(e,n){this.points=e,this.planes=n}static fromInvProjectionMatrix(e,n,s,h){const g=Math.pow(2,s),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const D=fc([],T,e),R=1/D[3]/n*g;return(O=D)[0]=(B=D)[0]*(V=[R,R,h?1/D[3]:R,R])[0],O[1]=B[1]*V[1],O[2]=B[2]*V[2],O[3]=B[3]*V[3],O;var O,B,V}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const D=_s([],Gc([],Tl([],_[T[0]],_[T[1]]),Tl([],_[T[2]],_[T[1]]))),R=-Ra(D,_[T[1]]);return D.concat(R)});return new bf(_,w)}}class _a{static fromPoints(e){const n=[1/0,1/0,1/0],s=[-1/0,-1/0,-1/0];for(const h of e)wh(n,n,h),bh(s,s,h);return new _a(n,s)}static applyTransform(e,n){const s=e.getCorners();for(let h=0;h<s.length;++h)vo(s[h],s[h],n);return _a.fromPoints(s)}constructor(e,n){this.min=e,this.max=n,this.center=Pa([],dc([],this.min,this.max),.5)}quadrant(e){const n=[e%2==0,e<2],s=dd(this.min),h=dd(this.max);for(let g=0;g<n.length;g++)s[g]=n[g]?this.min[g]:this.center[g],h[g]=n[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new _a(s,h)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,n=this.max;return[[e[0],e[1],e[2]],[n[0],e[1],e[2]],[n[0],n[1],e[2]],[e[0],n[1],e[2]],[e[0],e[1],n[2]],[n[0],e[1],n[2]],[n[0],n[1],n[2]],[e[0],n[1],n[2]]]}intersects(e){const n=this.getCorners();let s=!0;for(let h=0;h<e.planes.length;h++){const g=e.planes[h];let _=0;for(let w=0;w<n.length;w++)_+=Ra(g,n[w])+g[3]>=0;if(0===_)return 0;_!==n.length&&(s=!1)}if(s)return 2;for(let h=0;h<3;h++){let g=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let w=0;w<e.points.length;w++){const T=e.points[w][h]-this.min[h];g=Math.min(g,T),_=Math.max(_,T)}if(_<0||g>this.max[h]-this.min[h])return 0}return 1}}const pc=er/Math.PI/2,md=[64,32,16],Dl=-pc,Ha=pc,Zg=[new _a([Dl,Dl,Dl],[Ha,Ha,Ha]),new _a([Dl,Dl,Dl],[0,0,Ha]),new _a([0,Dl,Dl],[Ha,0,Ha]),new _a([Dl,0,Dl],[0,Ha,Ha]),new _a([0,0,Dl],[Ha,Ha,Ha])];function gd(t){return t*pc/Mh}function vm(t,e,n,s=!0){const h=Pa([],t._camera.position,t.worldSize),g=[e,n,1,1];fc(g,g,t.pixelMatrixInverse),_f(g,g,1/g[3]);const _=_s([],Tl([],g,h)),w=t.globeMatrix,T=[w[12],w[13],w[14]],D=Tl([],T,h),R=du(D),O=_s([],D),B=t.worldSize/(2*Math.PI),V=Ra(O,_),G=Math.asin(B/R);if(G<Math.acos(V)){if(!s)return null;const jt=[],ot=[];Pa(jt,_,R/V),_s(ot,Tl(ot,jt,D)),_s(_,dc(_,D,Pa(_,ot,Math.tan(G)*R)))}const J=[];new $l(h,_).closestPointOnSphere(T,B,J);const ce=_s([],Pn(w,0)),xe=_s([],Pn(w,1)),Me=_s([],Pn(w,2)),ve=Ra(ce,J),Se=Ra(xe,J),Le=Ra(Me,J),Pe=mt(Math.asin(-Se/B));let Ke=mt(Math.atan2(ve,Le));Ke=t.center.lng+function(jt,ot){const vt=(ot-jt+180)%360-180;return vt<-180?vt+360:vt}(t.center.lng,Ke);const Ze=Sl(Ke),_t=$t(Ml(Pe),0,1);return new Ih(Ze,_t)}class Xg{constructor(e,n,s){this.a=Tl([],e,s),this.b=Tl([],n,s),this.center=s;const h=_s([],this.a),g=_s([],this.b);this.angle=Math.acos(Ra(h,g))}}function Dh(t,e){if(0===t.angle)return null;let n;return n=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(s,h,g,_){const w=Math.sin(g);return s*(Math.sin((1-_)*g)/w)+h*(Math.sin(_*g)/w)}(t.a[e],t.b[e],t.angle,$t(n,0,1))+t.center[e]}function Ls(t){if(t.z<=1)return Zg[t.z+2*t.y+t.x];const e=wm(Df(t));return _a.fromPoints(e)}function Cl(t,e,n){return Pa(t,t,1-n),Nu(t,t,e,n)}function Ef(t,e){const n=Vu(e.zoom);if(0===n)return Ls(t);const s=Df(t),h=wm(s),g=Sl(s.getWest())*e.worldSize,_=Sl(s.getEast())*e.worldSize,w=Ml(s.getNorth())*e.worldSize,T=Ml(s.getSouth())*e.worldSize,D=[g,w,0],R=[_,w,0],O=[g,T,0],B=[_,T,0],V=mf([],e.globeMatrix);return vo(D,D,V),vo(R,R,V),vo(O,O,V),vo(B,B,V),h[0]=Cl(h[0],O,n),h[1]=Cl(h[1],B,n),h[2]=Cl(h[2],R,n),h[3]=Cl(h[3],D,n),_a.fromPoints(h)}function Tf(t,e,n){for(const s of t)vo(s,s,e),Pa(s,s,n)}function Df({x:t,y:e,z:n}){const s=1/(1<<n),h=new Vr(Wa(t*s),Os((e+1)*s)),g=new Vr(Wa((t+1)*s),Os(e*s));return new Ia(h,g)}function wm(t){const e=Ne(t.getNorth()),n=Ne(t.getSouth()),s=Math.cos(e),h=Math.cos(n),g=Math.sin(e),_=Math.sin(n),w=t.getWest(),T=t.getEast();return[Ch(h,_,w),Ch(h,_,T),Ch(s,g,T),Ch(s,g,w)]}function Ch(t,e,n,s=pc){return n=Ne(n),[t*Math.sin(n)*s,-e*s,t*Math.cos(n)*s]}function Hc(t,e,n){return Ch(Math.cos(Ne(t)),Math.sin(Ne(t)),e,n)}function pu(t,e,n,s){const h=1<<n.z,g=(t/er+n.x)/h;return Hc(Os((e/er+n.y)/h),Wa(g),s)}function Cf({min:t,max:e}){return 16383/Math.max(e[0]-t[0],e[1]-t[1],e[2]-t[2])}const Kg=new Float64Array(16);function ju(t){const e=Cf(t),n=yh(Kg,[e,e,e]);return Bu(n,n,((s=[])[0]=-(h=t.min)[0],s[1]=-h[1],s[2]=-h[2],s));var s,h}function Sf(t){const e=(s=t.min,(n=Kg)[0]=1,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=1,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=1,n[11]=0,n[12]=s[0],n[13]=s[1],n[14]=s[2],n[15]=1,n);var n,s;const h=1/Cf(t);return $c(e,e,[h,h,h])}function bm(t,e,n,s,h){const g=function(T){const D=er/(2*Math.PI);return T/(2*Math.PI)/D}(n),_=[t,e,-n/(2*Math.PI)],w=Aa(new Float64Array(16));return Bu(w,w,_),$c(w,w,[g,g,g]),gh(w,w,Ne(-h)),_h(w,w,Ne(-s)),w}function Vu(t){return an(5,6,t)}function Em(t,e){const n=Hc(e.lat,e.lng);return _=(h=fd([],function(G){const J=Hc(G._center.lat,G._center.lng);let ce=Gc([],Vl(0,1,0),J);const xe=vh([],-G.angle,J);ce=vo(ce,ce,xe),vh(xe,-G._pitch,ce);const Me=_s([],J);return Pa(Me,Me,gd(G.cameraToCenterDistance/G.pixelsPerMeter)),vo(Me,Me,xe),dc([],J,Me)}(t),n))[0],w=h[1],T=h[2],D=(g=n)[0],R=g[1],O=g[2],V=(B=Math.sqrt(_*_+w*w+T*T)*Math.sqrt(D*D+R*R+O*O))&&Ra(h,g)/B,Math.acos(Math.min(Math.max(V,-1),1));var h,g,_,w,T,D,R,O,B,V}function _d(t,e){return Em(t,e)>Math.PI/2*1.01}const Sh=Ne(85),Yg=Math.cos(Sh),Mf=Math.sin(Sh),Mh=6371008.8,Go=2*Math.PI*Mh;class Vr{constructor(e,n){if(isNaN(e)||isNaN(n))throw new Error(`Invalid LngLat object: (${e}, ${n})`);if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Vr(mn(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(e){const n=Math.PI/180,s=this.lat*n,h=e.lat*n,g=Math.sin(s)*Math.sin(h)+Math.cos(s)*Math.cos(h)*Math.cos((e.lng-this.lng)*n);return Mh*Math.acos(Math.min(g,1))}toBounds(e=0){const n=360*e/40075017,s=n/Math.cos(Math.PI/180*this.lat);return new Ia(new Vr(this.lng-s,this.lat-n),new Vr(this.lng+s,this.lat+n))}toEcef(e){const n=gd(e);return Hc(this.lat,this.lng,pc+n)}static convert(e){if(e instanceof Vr)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new Vr(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new Vr(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}function If(t){return Go*Math.cos(t*Math.PI/180)}function Sl(t){return(180+t)/360}function Ml(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Il(t,e){return t/If(e)}function Wa(t){return 360*t-180}function Os(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function Tm(t,e){return t*If(Os(e))}const ys=85.051129;function Jg(t){return 1/Math.cos(t*Math.PI/180)}class Ih{constructor(e,n,s=0){this.x=+e,this.y=+n,this.z=+s}static fromLngLat(e,n=0){const s=Vr.convert(e);return new Ih(Sl(s.lng),Ml(s.lat),Il(n,s.lat))}toLngLat(){return new Vr(Wa(this.x),Os(this.y))}toAltitude(){return Tm(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Go*Jg(Os(this.y))}}function mu(t,e,n,s,h,g,_,w,T){const D=(e+s)/2,R=(n+h)/2,O=new dt(D,R);w(O),function(B,V,G,J,ce,xe){const Me=G-ce,ve=J-xe;return Math.abs((J-V)*Me-(G-B)*ve)/Math.hypot(Me,ve)}(O.x,O.y,g.x,g.y,_.x,_.y)>=T?(mu(t,e,n,D,R,g,O,w,T),mu(t,D,R,s,h,O,_,w,T)):t.push(_)}function yd(t,e,n){let s=t[0],h=s.x,g=s.y;e(s);const _=[s];for(let w=1;w<t.length;w++){const T=t[w],{x:D,y:R}=T;e(T),mu(_,h,g,D,R,s,T,e,n),h=D,g=R,s=T}return _}function vd(t,e,n,s){if(s(e,n)){const h=e.add(n)._mult(.5);vd(t,e,h,s),vd(t,h,n,s)}else t.push(n)}function Dm(t,e){let n=t[0];const s=[n];for(let h=1;h<t.length;h++){const g=t[h];vd(s,n,g,e),n=g}return s}const xd=Math.pow(2,14)-1,Cm=-xd-1;function Qg(t,e){const n=Math.round(t.x*e),s=Math.round(t.y*e);return t.x=$t(n,Cm,xd),t.y=$t(s,Cm,xd),(n<t.x||n>t.x+1||s<t.y||s>t.y+1)&&vr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function Gl(t,e,n){const s=t.loadGeometry(),h=t.extent,g=er/h;if(e&&n&&n.projection.isReprojectedInTileSpace){const _=1<<e.z,{scale:w,x:T,y:D,projection:R}=n,O=B=>{const V=Wa((e.x+B.x/h)/_),G=Os((e.y+B.y/h)/_),J=R.project(V,G);B.x=(J.x*w-T)*h,B.y=(J.y*w-D)*h};for(let B=0;B<s.length;B++)if(1!==t.type)s[B]=yd(s[B],O,1);else{const V=[];for(const G of s[B])G.x<0||G.x>=h||G.y<0||G.y>=h||(O(G),V.push(G));s[B]=V}}for(const _ of s)for(const w of _)Qg(w,g);return s}function Wc(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?Gl(t):[]}}function $u(t,e,n,s,h){t.emplaceBack(2*e+(s+1)/2,2*n+(h+1)/2)}function Af(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class Ah{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new zn,this.indexArray=new gs,this.segments=new yo,this.programConfigurations=new hu(e.layers,e.zoom),this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,h){const g=this.layers[0],_=[];let w=null;"circle"===g.type&&(w=g.layout.get("circle-sort-key"));for(const{feature:D,id:R,index:O,sourceLayerIndex:B}of e){const V=this.layers[0]._featureFilter.needGeometry,G=Wc(D,V);if(!this.layers[0]._featureFilter.filter(new He(this.zoom),G,s))continue;const J=w?w.evaluate(G,{},s):void 0,ce={id:R,properties:D.properties,type:D.type,sourceLayerIndex:B,index:O,geometry:V?G.geometry:Gl(D,s,h),patterns:{},sortKey:J};_.push(ce)}w&&_.sort((D,R)=>D.sortKey-R.sortKey);let T=null;"globe"===h.projection.name&&(this.globeExtVertexArray=new ll,T=h.projection);for(const D of _){const{geometry:R,index:O,sourceLayerIndex:B}=D,V=e[O].feature;this.addFeature(D,R,O,n.availableImages,s,T),n.featureIndex.insert(V,R,O,B,this.index)}}update(e,n,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Vg.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,$g.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(e,n,s,h,g,_){for(const w of n)for(const T of w){const D=T.x,R=T.y;if(D<0||D>=er||R<0||R>=er)continue;if(_){const V=_.projectTilePoint(D,R,g),G=_.upVector(g,D,R),J=this.globeExtVertexArray;Af(J,V,G),Af(J,V,G),Af(J,V,G),Af(J,V,G)}const O=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),B=O.vertexLength;$u(this.layoutVertexArray,D,R,-1,-1),$u(this.layoutVertexArray,D,R,1,-1),$u(this.layoutVertexArray,D,R,1,1),$u(this.layoutVertexArray,D,R,-1,1),this.indexArray.emplaceBack(B,B+1,B+2),this.indexArray.emplaceBack(B,B+2,B+3),O.vertexLength+=4,O.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,{},h,g)}}function Sm(t,e){for(let n=0;n<t.length;n++)if(gc(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(gc(t,e[n]))return!0;return!!mc(t,e)}function Pf(t,e,n){return!!gc(t,e)||!!Ph(e,t,n)}function Rf(t,e){if(1===t.length)return Im(e,t[0]);for(let n=0;n<e.length;n++){const s=e[n];for(let h=0;h<s.length;h++)if(gc(t,s[h]))return!0}for(let n=0;n<t.length;n++)if(Im(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(mc(t,e[n]))return!0;return!1}function Mm(t,e,n){if(t.length>1){if(mc(t,e))return!0;for(let s=0;s<e.length;s++)if(Ph(e[s],t,n))return!0}for(let s=0;s<t.length;s++)if(Ph(t[s],e,n))return!0;return!1}function mc(t,e){if(0===t.length||0===e.length)return!1;for(let n=0;n<t.length-1;n++){const s=t[n],h=t[n+1];for(let g=0;g<e.length-1;g++)if(e_(s,h,e[g],e[g+1]))return!0}return!1}function e_(t,e,n,s){return si(t,n,s)!==si(e,n,s)&&si(t,e,n)!==si(t,e,s)}function Ph(t,e,n){const s=n*n;if(1===e.length)return t.distSqr(e[0])<s;for(let h=1;h<e.length;h++)if(Rh(t,e[h-1],e[h])<s)return!0;return!1}function Rh(t,e,n){const s=e.distSqr(n);if(0===s)return t.distSqr(e);const h=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/s;return t.distSqr(h<0?e:h>1?n:n.sub(e)._mult(h)._add(e))}function Im(t,e){let n,s,h,g=!1;for(let _=0;_<t.length;_++){n=t[_];for(let w=0,T=n.length-1;w<n.length;T=w++)s=n[w],h=n[T],s.y>e.y!=h.y>e.y&&e.x<(h.x-s.x)*(e.y-s.y)/(h.y-s.y)+s.x&&(g=!g)}return g}function gc(t,e){let n=!1;for(let s=0,h=t.length-1;s<t.length;h=s++){const g=t[s],_=t[h];g.y>e.y!=_.y>e.y&&e.x<(_.x-g.x)*(e.y-g.y)/(_.y-g.y)+g.x&&(n=!n)}return n}function kh(t,e,n,s,h){for(const _ of t)if(e<=_.x&&n<=_.y&&s>=_.x&&h>=_.y)return!0;const g=[new dt(e,n),new dt(e,h),new dt(s,h),new dt(s,n)];if(t.length>2)for(const _ of g)if(gc(t,_))return!0;for(let _=0;_<t.length-1;_++)if(gu(t[_],t[_+1],g))return!0;return!1}function gu(t,e,n){const s=n[0],h=n[2];if(t.x<s.x&&e.x<s.x||t.x>h.x&&e.x>h.x||t.y<s.y&&e.y<s.y||t.y>h.y&&e.y>h.y)return!1;const g=si(t,e,n[0]);return g!==si(t,e,n[1])||g!==si(t,e,n[2])||g!==si(t,e,n[3])}function _u(t,e,n){const s=e.paint.get(t).value;return"constant"===s.kind?s.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Gu(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Am(t,e,n,s,h){if(!e[0]&&!e[1])return t;const g=dt.convert(e)._mult(h);"viewport"===n&&g._rotate(-s);const _=[];for(let w=0;w<t.length;w++)_.push(t[w].sub(g));return _}function Pm(t,e,n,s){const h=dt.convert(t)._mult(s);return"viewport"===e&&h._rotate(-n),h}fn(Ah,"CircleBucket",{omit:["layers"]});const Rm=new Bt({"circle-sort-key":new it(ct.layout_circle["circle-sort-key"])});var Hu={paint:new Bt({"circle-radius":new it(ct.paint_circle["circle-radius"]),"circle-color":new it(ct.paint_circle["circle-color"]),"circle-blur":new it(ct.paint_circle["circle-blur"]),"circle-opacity":new it(ct.paint_circle["circle-opacity"]),"circle-translate":new Ge(ct.paint_circle["circle-translate"]),"circle-translate-anchor":new Ge(ct.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Ge(ct.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Ge(ct.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new it(ct.paint_circle["circle-stroke-width"]),"circle-stroke-color":new it(ct.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new it(ct.paint_circle["circle-stroke-opacity"])}),layout:Rm};function km(t,e,n,s,h,g,_,w,T){if(g&&t.queryGeometry.isAboveHorizon)return!1;g&&(T*=t.pixelToTileUnitsFactor);const D=t.tileID.canonical,R=n.projection.upVectorScale(D,n.center.lat,n.worldSize).metersToTile;for(const O of e)for(const B of O){const V=B.add(w),G=h&&n.elevation?n.elevation.exaggeration()*h.getElevationAt(V.x,V.y,!0):0,J=n.projection.projectTilePoint(V.x,V.y,D);if(G>0){const ve=n.projection.upVector(D,V.x,V.y);J.x+=ve[0]*R*G,J.y+=ve[1]*R*G,J.z+=ve[2]*R*G}const ce=g?V:t_(J.x,J.y,J.z,s),xe=g?t.tilespaceRays.map(ve=>n_(ve,G)):t.queryGeometry.screenGeometry,Me=fc([],[J.x,J.y,J.z,1],s);if(!_&&g?T*=Me[3]/n.cameraToCenterDistance:_&&!g&&(T*=n.cameraToCenterDistance/Me[3]),g){const ve=Os((B.y/er+D.y)/(1<<D.z));T/=n.projection.pixelsPerMeter(ve,1)/Il(1,ve)}if(Pf(xe,ce,T))return!0}return!1}function t_(t,e,n,s){const h=fc([],[t,e,n,1],s);return new dt(h[0]/h[3],h[1]/h[3])}const Lm=Vl(0,0,0),kf=Vl(0,0,1);function n_(t,e){const n=xh();return Lm[2]=e,t.intersectsPlane(Lm,kf,n),new dt(n[0],n[1])}class Lf extends Ah{}function Om(t,{width:e,height:n},s,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==e*n*s)throw new RangeError("mismatched image size")}else h=new Uint8Array(e*n*s);return t.width=e,t.height=n,t.data=h,t}function Of(t,e,n){const{width:s,height:h}=e;s===t.width&&h===t.height||(Fm(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,s),height:Math.min(t.height,h)},n),t.width=s,t.height=h,t.data=e.data)}function Fm(t,e,n,s,h,g){if(0===h.width||0===h.height)return e;if(h.width>t.width||h.height>t.height||n.x>t.width-h.width||n.y>t.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>e.width||h.height>e.height||s.x>e.width-h.width||s.y>e.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const _=t.data,w=e.data;for(let T=0;T<h.height;T++){const D=((n.y+T)*t.width+n.x)*g,R=((s.y+T)*e.width+s.x)*g;for(let O=0;O<h.width*g;O++)w[R+O]=_[D+O]}return e}fn(Lf,"HeatmapBucket",{omit:["layers"]});class _c{constructor(e,n){Om(this,e,1,n)}resize(e){Of(this,new _c(e),1)}clone(){return new _c({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,h,g){Fm(e,n,s,h,g,1)}}class Fs{constructor(e,n){Om(this,e,4,n)}resize(e){Of(this,new Fs(e),4)}replace(e,n){n?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new Fs({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,n,s,h,g){Fm(e,n,s,h,g,4)}}fn(_c,"AlphaImage"),fn(Fs,"RGBAImage");var r_={paint:new Bt({"heatmap-radius":new it(ct.paint_heatmap["heatmap-radius"]),"heatmap-weight":new it(ct.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Ge(ct.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ct(ct.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Ge(ct.paint_heatmap["heatmap-opacity"])})};function qc(t){const e={},n=t.resolution||256,s=t.clips?t.clips.length:1,h=t.image||new Fs({width:n,height:s}),g=(_,w,T)=>{e[t.evaluationKey]=T;const D=t.expression.evaluate(e);h.data[_+w+0]=Math.floor(255*D.r/D.a),h.data[_+w+1]=Math.floor(255*D.g/D.a),h.data[_+w+2]=Math.floor(255*D.b/D.a),h.data[_+w+3]=Math.floor(255*D.a)};if(t.clips)for(let _=0,w=0;_<s;++_,w+=4*n)for(let T=0,D=0;T<n;T++,D+=4){const R=T/(n-1),{start:O,end:B}=t.clips[_];g(w,D,O*(1-R)+B*R)}else for(let _=0,w=0;_<n;_++,w+=4)g(0,w,_/(n-1));return h}var Lh={paint:new Bt({"hillshade-illumination-direction":new Ge(ct.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Ge(ct.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Ge(ct.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Ge(ct.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Ge(ct.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Ge(ct.paint_hillshade["hillshade-accent-color"])})};const i_=Rn([{name:"a_pos",components:2,type:"Int16"}],4),{members:zm}=i_;var Wu={};function wd(t,e,n){n=n||2;var s,h,g,_,w,T,D,R=e&&e.length,O=R?e[0]*n:t.length,B=Bm(t,0,O,n,!0),V=[];if(!B||B.next===B.prev)return V;if(R&&(B=function(J,ce,xe,Me){var ve,Se,Le,Pe=[];for(ve=0,Se=ce.length;ve<Se;ve++)(Le=Bm(J,ce[ve]*Me,ve<Se-1?ce[ve+1]*Me:J.length,Me,!1))===Le.next&&(Le.steiner=!0),Pe.push(l_(Le));for(Pe.sort(Fh),ve=0;ve<Pe.length;ve++)xe=s_(Pe[ve],xe);return xe}(t,e,B,n)),t.length>80*n){s=g=t[0],h=_=t[1];for(var G=n;G<O;G+=n)(w=t[G])<s&&(s=w),(T=t[G+1])<h&&(h=T),w>g&&(g=w),T>_&&(_=T);D=0!==(D=Math.max(g-s,_-h))?32767/D:0}return Oh(B,V,n,s,h,D,0),V}function Bm(t,e,n,s,h){var g,_;if(h===Sd(t,e,n,s)>0)for(g=e;g<n;g+=s)_=Uf(g,t[g],t[g+1],_);else for(g=n-s;g>=e;g-=s)_=Uf(g,t[g],t[g+1],_);return _&&yc(_,_.next)&&(Dd(_),_=_.next),_}function Zc(t,e){if(!t)return t;e||(e=t);var n,s=t;do{if(n=!1,s.steiner||!yc(s,s.next)&&0!==Do(s.prev,s,s.next))s=s.next;else{if(Dd(s),(s=e=s.prev)===s.next)break;n=!0}}while(n||s!==e);return e}function Oh(t,e,n,s,h,g,_){if(t){!_&&g&&function(R,O,B,V){var G=R;do{0===G.z&&(G.z=Nf(G.x,G.y,O,B,V)),G.prevZ=G.prev,G.nextZ=G.next,G=G.next}while(G!==R);G.prevZ.nextZ=null,G.prevZ=null,function(J){var ce,xe,Me,ve,Se,Le,Pe,Ke,Ze=1;do{for(xe=J,J=null,Se=null,Le=0;xe;){for(Le++,Me=xe,Pe=0,ce=0;ce<Ze&&(Pe++,Me=Me.nextZ);ce++);for(Ke=Ze;Pe>0||Ke>0&&Me;)0!==Pe&&(0===Ke||!Me||xe.z<=Me.z)?(ve=xe,xe=xe.nextZ,Pe--):(ve=Me,Me=Me.nextZ,Ke--),Se?Se.nextZ=ve:J=ve,ve.prevZ=Se,Se=ve;xe=Me}Se.nextZ=null,Ze*=2}while(Le>1)}(G)}(t,s,h,g);for(var w,T,D=t;t.prev!==t.next;)if(w=t.prev,T=t.next,g?zf(t,s,h,g):Ff(t))e.push(w.i/n|0),e.push(t.i/n|0),e.push(T.i/n|0),Dd(t),t=T.next,D=T.next;else if((t=T)===D){_?1===_?Oh(t=o_(Zc(t),e,n),e,n,s,h,g,2):2===_&&Bf(t,e,n,s,h,g):Oh(Zc(t),e,n,s,h,g,1);break}}}function Ff(t){var e=t.prev,n=t,s=t.next;if(Do(e,n,s)>=0)return!1;for(var h=e.x,g=n.x,_=s.x,w=e.y,T=n.y,D=s.y,R=h<g?h<_?h:_:g<_?g:_,O=w<T?w<D?w:D:T<D?T:D,B=h>g?h>_?h:_:g>_?g:_,V=w>T?w>D?w:D:T>D?T:D,G=s.next;G!==e;){if(G.x>=R&&G.x<=B&&G.y>=O&&G.y<=V&&qu(h,w,g,T,_,D,G.x,G.y)&&Do(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function zf(t,e,n,s){var h=t.prev,g=t,_=t.next;if(Do(h,g,_)>=0)return!1;for(var w=h.x,T=g.x,D=_.x,R=h.y,O=g.y,B=_.y,V=w<T?w<D?w:D:T<D?T:D,G=R<O?R<B?R:B:O<B?O:B,J=w>T?w>D?w:D:T>D?T:D,ce=R>O?R>B?R:B:O>B?O:B,xe=Nf(V,G,e,n,s),Me=Nf(J,ce,e,n,s),ve=t.prevZ,Se=t.nextZ;ve&&ve.z>=xe&&Se&&Se.z<=Me;){if(ve.x>=V&&ve.x<=J&&ve.y>=G&&ve.y<=ce&&ve!==h&&ve!==_&&qu(w,R,T,O,D,B,ve.x,ve.y)&&Do(ve.prev,ve,ve.next)>=0||(ve=ve.prevZ,Se.x>=V&&Se.x<=J&&Se.y>=G&&Se.y<=ce&&Se!==h&&Se!==_&&qu(w,R,T,O,D,B,Se.x,Se.y)&&Do(Se.prev,Se,Se.next)>=0))return!1;Se=Se.nextZ}for(;ve&&ve.z>=xe;){if(ve.x>=V&&ve.x<=J&&ve.y>=G&&ve.y<=ce&&ve!==h&&ve!==_&&qu(w,R,T,O,D,B,ve.x,ve.y)&&Do(ve.prev,ve,ve.next)>=0)return!1;ve=ve.prevZ}for(;Se&&Se.z<=Me;){if(Se.x>=V&&Se.x<=J&&Se.y>=G&&Se.y<=ce&&Se!==h&&Se!==_&&qu(w,R,T,O,D,B,Se.x,Se.y)&&Do(Se.prev,Se,Se.next)>=0)return!1;Se=Se.nextZ}return!0}function o_(t,e,n){var s=t;do{var h=s.prev,g=s.next.next;!yc(h,g)&&Hl(h,s,s.next,g)&&Td(h,g)&&Td(g,h)&&(e.push(h.i/n|0),e.push(s.i/n|0),e.push(g.i/n|0),Dd(s),Dd(s.next),s=t=g),s=s.next}while(s!==t);return Zc(s)}function Bf(t,e,n,s,h,g){var _=t;do{for(var w=_.next.next;w!==_.prev;){if(_.i!==w.i&&c_(_,w)){var T=u_(_,w);return _=Zc(_,_.next),T=Zc(T,T.next),Oh(_,e,n,s,h,g,0),void Oh(T,e,n,s,h,g,0)}w=w.next}_=_.next}while(_!==t)}function Fh(t,e){return t.x-e.x}function s_(t,e){var n=function(h,g){var _,w=g,T=h.x,D=h.y,R=-1/0;do{if(D<=w.y&&D>=w.next.y&&w.next.y!==w.y){var O=w.x+(D-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(O<=T&&O>R&&(R=O,_=w.x<w.next.x?w:w.next,O===T))return _}w=w.next}while(w!==g);if(!_)return null;var B,V=_,G=_.x,J=_.y,ce=1/0;w=_;do{T>=w.x&&w.x>=G&&T!==w.x&&qu(D<J?T:R,D,G,J,D<J?R:T,D,w.x,w.y)&&(B=Math.abs(D-w.y)/(T-w.x),Td(w,h)&&(B<ce||B===ce&&(w.x>_.x||w.x===_.x&&a_(_,w)))&&(_=w,ce=B)),w=w.next}while(w!==V);return _}(t,e);if(!n)return e;var s=u_(n,t);return Zc(s,s.next),Zc(n,n.next)}function a_(t,e){return Do(t.prev,t,e.prev)<0&&Do(e.next,t,t.next)<0}function Nf(t,e,n,s,h){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-s)*h|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function l_(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function qu(t,e,n,s,h,g,_,w){return(h-_)*(e-w)>=(t-_)*(g-w)&&(t-_)*(s-w)>=(n-_)*(e-w)&&(n-_)*(g-w)>=(h-_)*(s-w)}function c_(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(n,s){var h=n;do{if(h.i!==n.i&&h.next.i!==n.i&&h.i!==s.i&&h.next.i!==s.i&&Hl(h,h.next,n,s))return!0;h=h.next}while(h!==n);return!1}(t,e)&&(Td(t,e)&&Td(e,t)&&function(n,s){var h=n,g=!1,_=(n.x+s.x)/2,w=(n.y+s.y)/2;do{h.y>w!=h.next.y>w&&h.next.y!==h.y&&_<(h.next.x-h.x)*(w-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next}while(h!==n);return g}(t,e)&&(Do(t.prev,t,e.prev)||Do(t,e.prev,e))||yc(t,e)&&Do(t.prev,t,t.next)>0&&Do(e.prev,e,e.next)>0)}function Do(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function yc(t,e){return t.x===e.x&&t.y===e.y}function Hl(t,e,n,s){var h=Ed(Do(t,e,n)),g=Ed(Do(t,e,s)),_=Ed(Do(n,s,t)),w=Ed(Do(n,s,e));return h!==g&&_!==w||!(0!==h||!bd(t,n,e))||!(0!==g||!bd(t,s,e))||!(0!==_||!bd(n,t,s))||!(0!==w||!bd(n,e,s))}function bd(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Ed(t){return t>0?1:t<0?-1:0}function Td(t,e){return Do(t.prev,t,t.next)<0?Do(t,e,t.next)>=0&&Do(t,t.prev,e)>=0:Do(t,e,t.prev)<0||Do(t,t.next,e)<0}function u_(t,e){var n=new Cd(t.i,t.x,t.y),s=new Cd(e.i,e.x,e.y),h=t.next,g=e.prev;return t.next=e,e.prev=t,n.next=h,h.prev=n,s.next=n,n.prev=s,g.next=s,s.prev=g,s}function Uf(t,e,n,s){var h=new Cd(t,e,n);return s?(h.next=s.next,h.prev=s,s.next.prev=h,s.next=h):(h.prev=h,h.next=h),h}function Dd(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Cd(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Sd(t,e,n,s){for(var h=0,g=e,_=n-s;g<n;g+=s)h+=(t[_]-t[g])*(t[g+1]+t[_+1]),_=g;return h}function h_(t,e,n,s,h){jf(t,e,n||0,s||t.length-1,h||d_)}function jf(t,e,n,s,h){for(;s>n;){if(s-n>600){var g=s-n+1,_=e-n+1,w=Math.log(g),T=.5*Math.exp(2*w/3),D=.5*Math.sqrt(w*T*(g-T)/g)*(_-g/2<0?-1:1);jf(t,e,Math.max(n,Math.floor(e-_*T/g+D)),Math.min(s,Math.floor(e+(g-_)*T/g+D)),h)}var R=t[e],O=n,B=s;for(zh(t,n,e),h(t[s],R)>0&&zh(t,n,s);O<B;){for(zh(t,O,B),O++,B--;h(t[O],R)<0;)O++;for(;h(t[B],R)>0;)B--}0===h(t[n],R)?zh(t,n,B):zh(t,++B,s),B<=e&&(n=B+1),e<=B&&(s=B-1)}}function zh(t,e,n){var s=t[e];t[e]=t[n],t[n]=s}function d_(t,e){return t<e?-1:t>e?1:0}function qa(t,e){const n=t.length;if(n<=1)return[t];const s=[];let h,g;for(let _=0;_<n;_++){const w=bn(t[_]);0!==w&&(t[_].area=Math.abs(w),void 0===g&&(g=w<0),g===w<0?(h&&s.push(h),h=[t[_]]):h.push(t[_]))}if(h&&s.push(h),e>1)for(let _=0;_<s.length;_++)s[_].length<=e||(h_(s[_],e,1,s[_].length-1,f_),s[_]=s[_].slice(0,e));return s}function f_(t,e){return e.area-t.area}function Md(t,e,n){const s=n.patternDependencies;let h=!1;for(const g of e){const _=g.paint.get(`${t}-pattern`);_.isConstant()||(h=!0);const w=_.constantOr(null);w&&(h=!0,s[w]=!0)}return h}function Vf(t,e,n,s,h){const g=h.patternDependencies;for(const _ of e){const w=_.paint.get(`${t}-pattern`).value;if("constant"!==w.kind){let T=w.evaluate({zoom:s},n,{},h.availableImages);T=T&&T.name?T.name:T,g[T]=!0,n.patterns[_.id]=T}}return n}({get exports(){return Wu},set exports(t){Wu=t}}).exports=wd,Wu.default=wd,wd.deviation=function(t,e,n,s){var h=e&&e.length,g=Math.abs(Sd(t,0,h?e[0]*n:t.length,n));if(h)for(var _=0,w=e.length;_<w;_++)g-=Math.abs(Sd(t,e[_]*n,_<w-1?e[_+1]*n:t.length,n));var T=0;for(_=0;_<s.length;_+=3){var D=s[_]*n,R=s[_+1]*n,O=s[_+2]*n;T+=Math.abs((t[D]-t[O])*(t[R+1]-t[D+1])-(t[D]-t[R])*(t[O+1]-t[D+1]))}return 0===g&&0===T?0:Math.abs((T-g)/g)},wd.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},s=0,h=0;h<t.length;h++){for(var g=0;g<t[h].length;g++)for(var _=0;_<e;_++)n.vertices.push(t[h][g][_]);h>0&&n.holes.push(s+=t[h-1].length)}return n};class Id{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new zn,this.indexArray=new gs,this.indexArray2=new El,this.programConfigurations=new hu(e.layers,e.zoom),this.segments=new yo,this.segments2=new yo,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.projection=e.projection}populate(e,n,s,h){this.hasPattern=Md("fill",this.layers,n);const g=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:w,id:T,index:D,sourceLayerIndex:R}of e){const O=this.layers[0]._featureFilter.needGeometry,B=Wc(w,O);if(!this.layers[0]._featureFilter.filter(new He(this.zoom),B,s))continue;const V=g?g.evaluate(B,{},s,n.availableImages):void 0,G={id:T,properties:w.properties,type:w.type,sourceLayerIndex:R,index:D,geometry:O?B.geometry:Gl(w,s,h),patterns:{},sortKey:V};_.push(G)}g&&_.sort((w,T)=>w.sortKey-T.sortKey);for(const w of _){const{geometry:T,index:D,sourceLayerIndex:R}=w;if(this.hasPattern){const O=Vf("fill",this.layers,w,this.zoom,n);this.patternFeatures.push(O)}else this.addFeature(w,T,D,s,{},n.availableImages);n.featureIndex.insert(e[D].feature,T,D,R,this.index)}}update(e,n,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,h)}addFeatures(e,n,s,h,g){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,zm),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.indexBuffer2=e.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(e,n,s,h,g,_=[]){for(const w of qa(n,500)){let T=0;for(const G of w)T+=G.length;const D=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray),R=D.vertexLength,O=[],B=[];for(const G of w){if(0===G.length)continue;G!==w[0]&&B.push(O.length/2);const J=this.segments2.prepareSegment(G.length,this.layoutVertexArray,this.indexArray2),ce=J.vertexLength;this.layoutVertexArray.emplaceBack(G[0].x,G[0].y),this.indexArray2.emplaceBack(ce+G.length-1,ce),O.push(G[0].x),O.push(G[0].y);for(let xe=1;xe<G.length;xe++)this.layoutVertexArray.emplaceBack(G[xe].x,G[xe].y),this.indexArray2.emplaceBack(ce+xe-1,ce+xe),O.push(G[xe].x),O.push(G[xe].y);J.vertexLength+=G.length,J.primitiveLength+=G.length}const V=Wu(O,B);for(let G=0;G<V.length;G+=3)this.indexArray.emplaceBack(R+V[G],R+V[G+1],R+V[G+2]);D.vertexLength+=T,D.primitiveLength+=V.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,g,_,h)}}fn(Id,"FillBucket",{omit:["layers","patternFeatures"]});const p_=new Bt({"fill-sort-key":new it(ct.layout_fill["fill-sort-key"])});var m_={paint:new Bt({"fill-antialias":new Ge(ct.paint_fill["fill-antialias"]),"fill-opacity":new it(ct.paint_fill["fill-opacity"]),"fill-color":new it(ct.paint_fill["fill-color"]),"fill-outline-color":new it(ct.paint_fill["fill-outline-color"]),"fill-translate":new Ge(ct.paint_fill["fill-translate"]),"fill-translate-anchor":new Ge(ct.paint_fill["fill-translate-anchor"]),"fill-pattern":new it(ct.paint_fill["fill-pattern"])}),layout:p_};const Nm=Rn([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),g_=Rn([{name:"a_centroid_pos",components:2,type:"Uint16"}]),__=Rn([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:y_}=Nm;var Er={},Um=dt,$f=yu;function yu(t,e,n,s,h){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=s,this._values=h,t.readFields(v_,this,e)}function v_(t,e,n){1==t?e.id=n.readVarint():2==t?function(s,h){for(var g=s.readVarint()+s.pos;s.pos<g;){var _=h._keys[s.readVarint()],w=h._values[s.readVarint()];h.properties[_]=w}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function x_(t){for(var e,n,s=0,h=0,g=t.length,_=g-1;h<g;_=h++)s+=((n=t[_]).x-(e=t[h]).x)*(e.y+n.y);return s}yu.types=["Unknown","Point","LineString","Polygon"],yu.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,s=1,h=0,g=0,_=0,w=[];t.pos<n;){if(h<=0){var T=t.readVarint();s=7&T,h=T>>3}if(h--,1===s||2===s)g+=t.readSVarint(),_+=t.readSVarint(),1===s&&(e&&w.push(e),e=[]),e.push(new Um(g,_));else{if(7!==s)throw new Error("unknown command "+s);e&&e.push(e[0].clone())}}return e&&w.push(e),w},yu.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,s=0,h=0,g=0,_=1/0,w=-1/0,T=1/0,D=-1/0;t.pos<e;){if(s<=0){var R=t.readVarint();n=7&R,s=R>>3}if(s--,1===n||2===n)(h+=t.readSVarint())<_&&(_=h),h>w&&(w=h),(g+=t.readSVarint())<T&&(T=g),g>D&&(D=g);else if(7!==n)throw new Error("unknown command "+n)}return[_,T,w,D]},yu.prototype.toGeoJSON=function(t,e,n){var s,h,g=this.extent*Math.pow(2,n),_=this.extent*t,w=this.extent*e,T=this.loadGeometry(),D=yu.types[this.type];function R(V){for(var G=0;G<V.length;G++){var J=V[G];V[G]=[360*(J.x+_)/g-180,360/Math.PI*Math.atan(Math.exp((180-360*(J.y+w)/g)*Math.PI/180))-90]}}switch(this.type){case 1:var O=[];for(s=0;s<T.length;s++)O[s]=T[s][0];R(T=O);break;case 2:for(s=0;s<T.length;s++)R(T[s]);break;case 3:for(T=function(V){var G=V.length;if(G<=1)return[V];for(var J,ce,xe=[],Me=0;Me<G;Me++){var ve=x_(V[Me]);0!==ve&&(void 0===ce&&(ce=ve<0),ce===ve<0?(J&&xe.push(J),J=[V[Me]]):J.push(V[Me]))}return J&&xe.push(J),xe}(T),s=0;s<T.length;s++)for(h=0;h<T[s].length;h++)R(T[s][h])}1===T.length?T=T[0]:D="Multi"+D;var B={type:"Feature",geometry:{type:D,coordinates:T},properties:this.properties};return"id"in this&&(B.id=this.id),B};var jm=$f,Vm=Gf;function Gf(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(w_,this,e),this.length=this._features.length}function w_(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(s){for(var h=null,g=s.readVarint()+s.pos;s.pos<g;){var _=s.readVarint()>>3;h=1===_?s.readString():2===_?s.readFloat():3===_?s.readDouble():4===_?s.readVarint64():5===_?s.readVarint():6===_?s.readSVarint():7===_?s.readBoolean():null}return h}(n))}Gf.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new jm(this._pbf,e,this.extent,this._keys,this._values)};var b_=Vm;function zy(t,e,n){if(3===t){var s=new b_(n,n.readVarint()+n.pos);s.length&&(e[s.name]=s)}}var Ad=Er.VectorTile=function(t,e){this.layers=t.readFields(zy,{},e)},Bh=Er.VectorTileFeature=$f;function Wl(t,e,n,s){const h=[],g=0===s?(_,w,T,D,R,O)=>{_.push(new dt(O,T+(O-w)/(D-w)*(R-T)))}:(_,w,T,D,R,O)=>{_.push(new dt(w+(O-T)/(R-T)*(D-w),O))};for(const _ of t){const w=[];for(const T of _){if(T.length<=2)continue;const D=[];for(let B=0;B<T.length-1;B++){const V=T[B].x,G=T[B].y,J=T[B+1].x,ce=T[B+1].y,xe=0===s?V:G,Me=0===s?J:ce;xe<e?Me>e&&g(D,V,G,J,ce,e):xe>n?Me<n&&g(D,V,G,J,ce,n):D.push(T[B]),Me<e&&xe>=e&&g(D,V,G,J,ce,e),Me>n&&xe<=n&&g(D,V,G,J,ce,n)}let R=T[T.length-1];const O=0===s?R.x:R.y;O>=e&&O<=n&&D.push(R),D.length&&(R=D[D.length-1],D[0].x===R.x&&D[0].y===R.y||D.push(D[0]),w.push(D))}w.length&&h.push(w)}return h}Er.VectorTileLayer=Vm;const E_=Bh.types,Hf=Math.pow(2,13);function vu(t,e,n,s,h,g,_,w){t.emplaceBack((e<<1)+_,(n<<1)+g,(Math.floor(s*Hf)<<1)+h,Math.round(w))}function Nh(t,e,n){t.emplaceBack(e.x,e.y,e.z,16384*n[0],16384*n[1],16384*n[2])}class T_{constructor(){this.acc=new dt(0,0),this.polyCount=[]}startRing(e){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new dt(e.x,e.y),this.max=new dt(e.x,e.y))}append(e,n){this.currentPolyCount.edges++,this.acc._add(e);const s=this.min,h=this.max;e.x<s.x?s.x=e.x:e.x>h.x&&(h.x=e.x),e.y<s.y?s.y=e.y:e.y>h.y&&(h.y=e.y),((0===e.x||e.x===er)&&e.x===n.x)!=((0===e.y||e.y===er)&&e.y===n.y)&&this.processBorderOverlap(e,n),n.x<0!=e.x<0&&this.addBorderIntersection(0,Jn(n.y,e.y,(0-n.x)/(e.x-n.x))),n.x>er!=e.x>er&&this.addBorderIntersection(1,Jn(n.y,e.y,(er-n.x)/(e.x-n.x))),n.y<0!=e.y<0&&this.addBorderIntersection(2,Jn(n.x,e.x,(0-n.y)/(e.y-n.y))),n.y>er!=e.y>er&&this.addBorderIntersection(3,Jn(n.x,e.x,(er-n.y)/(e.y-n.y)))}addBorderIntersection(e,n){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const s=this.borders[e];n<s[0]&&(s[0]=n),n>s[1]&&(s[1]=n)}processBorderOverlap(e,n){if(e.x===n.x){if(e.y===n.y)return;const s=0===e.x?0:1;this.addBorderIntersection(s,n.y),this.addBorderIntersection(s,e.y)}else{const s=0===e.y?2:3;this.addBorderIntersection(s,n.x),this.addBorderIntersection(s,e.x)}}centroid(){const e=this.polyCount.reduce((n,s)=>n+s.edges,0);return 0!==e?this.acc.div(e)._round():new dt(0,0)}span(){return new dt(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((e,n)=>e+ +(n[0]!==Number.MAX_VALUE),0)}}class Pd{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.layoutVertexArray=new pi,this.centroidVertexArray=new Fu,this.indexArray=new gs,this.programConfigurations=new hu(e.layers,e.zoom),this.segments=new yo,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id),this.enableTerrain=e.enableTerrain}populate(e,n,s,h){this.features=[],this.hasPattern=Md("fill-extrusion",this.layers,n),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(g){const _=Math.exp(Math.PI*(1-g.y/(1<<g.z)*2));return 80150034*_/(_*_+1)/er/(1<<g.z)}(s),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter;for(const{feature:g,id:_,index:w,sourceLayerIndex:T}of e){const D=this.layers[0]._featureFilter.needGeometry,R=Wc(g,D);if(!this.layers[0]._featureFilter.filter(new He(this.zoom),R,s))continue;const O={id:_,sourceLayerIndex:T,index:w,geometry:D?R.geometry:Gl(g,s,h),properties:g.properties,type:g.type,patterns:{}},B=this.layoutVertexArray.length;this.hasPattern?this.features.push(Vf("fill-extrusion",this.layers,O,this.zoom,n)):this.addFeature(O,O.geometry,w,s,{},n.availableImages,h),n.featureIndex.insert(g,O.geometry,w,T,this.index,B)}this.sortBorders()}addFeatures(e,n,s,h,g){for(const _ of this.features){const{geometry:w}=_;this.addFeature(_,w,_.index,n,s,h,g)}this.sortBorders()}update(e,n,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,y_),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,__.members,!0))),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,g_.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,n,s,h,g,_,w){const T=[new dt(0,0),new dt(er,er)],D=w.projection,R="globe"===D.name,O=this.enableTerrain&&!R?new T_:null,B="Polygon"===E_[e.type];R&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ll);const V=qa(n,500);for(let xe=V.length-1;xe>=0;xe--){const Me=V[xe];(0===Me.length||(G=Me[0]).every(ve=>ve.x<=0)||G.every(ve=>ve.x>=er)||G.every(ve=>ve.y<=0)||G.every(ve=>ve.y>=er))&&V.splice(xe,1)}var G;let J;if(R)J=qf(V,T,h);else{J=[];for(const xe of V)J.push({polygon:xe,bounds:T})}const ce=B?this.edgeRadius:0;for(const{polygon:xe,bounds:Me}of J){let ve=0,Se=0;for(const Pe of xe)B&&!Pe[0].equals(Pe[Pe.length-1])&&Pe.push(Pe[0]),Se+=B?Pe.length-1:Pe.length;const Le=this.segments.prepareSegment((B?5:4)*Se,this.layoutVertexArray,this.indexArray);if(B){const Pe=[],Ke=[];ve=Le.vertexLength;for(const _t of xe){let jt,ot;_t.length&&_t!==xe[0]&&Ke.push(Pe.length/2),jt=_t[1].sub(_t[0])._perp()._unit();for(let vt=1;vt<_t.length;vt++){const wt=_t[vt],Lt=_t[vt===_t.length-1?1:vt+1];let{x:Vt,y:st}=wt;if(ce){ot=Lt.sub(wt)._perp()._unit();const tn=jt.add(ot)._unit(),Bn=ce*Math.min(4,1/(jt.x*tn.x+jt.y*tn.y));Vt+=Bn*tn.x,st+=Bn*tn.y,jt=ot}vu(this.layoutVertexArray,Vt,st,0,0,1,1,0),Le.vertexLength++,Pe.push(wt.x,wt.y),R&&Nh(this.layoutVertexExtArray,D.projectTilePoint(Vt,st,h),D.upVector(h,Vt,st))}}const Ze=Wu(Pe,Ke);for(let _t=0;_t<Ze.length;_t+=3)this.indexArray.emplaceBack(ve+Ze[_t],ve+Ze[_t+2],ve+Ze[_t+1]),Le.primitiveLength++}for(const Pe of xe){O&&Pe.length&&O.startRing(Pe[0]);let Ke,Ze,_t,jt=Pe.length>4&&$m(Pe[Pe.length-2],Pe[0],Pe[1]),ot=ce?C_(Pe[Pe.length-2],Pe[0],Pe[1],ce):0;Ze=Pe[1].sub(Pe[0])._perp()._unit();let vt=!0;for(let wt=1,Lt=0;wt<Pe.length;wt++){let Vt=Pe[wt-1],st=Pe[wt];const tn=Pe[wt===Pe.length-1?1:wt+1];if(O&&B&&O.currentPolyCount.top++,S_(st,Vt,Me)){ce&&(Ze=tn.sub(st)._perp()._unit(),vt=!vt);continue}O&&O.append(st,Vt);const Bn=st.sub(Vt)._perp(),un=Bn.x/(Math.abs(Bn.x)+Math.abs(Bn.y)),Cn=Bn.y>0?1:0,nn=Vt.dist(st);if(Lt+nn>32768&&(Lt=0),ce){_t=tn.sub(st)._perp()._unit();let Tr=Wf(Vt,st,tn,D_(Ze,_t),ce);isNaN(Tr)&&(Tr=0);const Kn=st.sub(Vt)._unit();Vt=Vt.add(Kn.mult(ot))._round(),st=st.add(Kn.mult(-Tr))._round(),ot=Tr,Ze=_t}const Wn=Le.vertexLength,Ar=Pe.length>4&&$m(Vt,st,tn);let Sr=xu(Lt,jt,vt);if(vu(this.layoutVertexArray,Vt.x,Vt.y,un,Cn,0,0,Sr),vu(this.layoutVertexArray,Vt.x,Vt.y,un,Cn,0,1,Sr),Lt+=nn,Sr=xu(Lt,Ar,!vt),jt=Ar,vu(this.layoutVertexArray,st.x,st.y,un,Cn,0,0,Sr),vu(this.layoutVertexArray,st.x,st.y,un,Cn,0,1,Sr),Le.vertexLength+=4,this.indexArray.emplaceBack(Wn+0,Wn+1,Wn+2),this.indexArray.emplaceBack(Wn+1,Wn+3,Wn+2),Le.primitiveLength+=2,ce){const Tr=ve+(1===wt?Pe.length-2:wt-2),Kn=1===wt?ve:Tr+1;if(this.indexArray.emplaceBack(Wn+1,Tr,Wn+3),this.indexArray.emplaceBack(Tr,Kn,Wn+3),Le.primitiveLength+=2,void 0===Ke&&(Ke=Wn),!S_(tn,Pe[wt],Me)){const ci=wt===Pe.length-1?Ke:Le.vertexLength;this.indexArray.emplaceBack(Wn+2,Wn+3,ci),this.indexArray.emplaceBack(Wn+3,ci+1,ci),this.indexArray.emplaceBack(Wn+3,Kn,ci+1),Le.primitiveLength+=3}vt=!vt}if(R){const Tr=this.layoutVertexExtArray,Kn=D.projectTilePoint(Vt.x,Vt.y,h),ci=D.projectTilePoint(st.x,st.y,h),ar=D.upVector(h,Vt.x,Vt.y),kr=D.upVector(h,st.x,st.y);Nh(Tr,Kn,ar),Nh(Tr,Kn,ar),Nh(Tr,ci,kr),Nh(Tr,ci,kr)}}B&&(ve+=Pe.length-1)}}if(O&&O.polyCount.length>0){if(O.borders){O.vertexArrayOffset=this.centroidVertexArray.length;const xe=O.borders,Me=this.featuresOnBorder.push(O)-1;for(let ve=0;ve<4;ve++)xe[ve][0]!==Number.MAX_VALUE&&this.borders[ve].push(Me)}this.encodeCentroid(O.borders?void 0:O.centroid(),O)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,g,_,h)}sortBorders(){for(let e=0;e<4;e++)this.borders[e].sort((n,s)=>this.featuresOnBorder[n].borders[e][0]-this.featuresOnBorder[s].borders[e][0])}encodeCentroid(e,n,s=!0){let h,g;if(e)if(0!==e.y){const w=n.span()._mult(this.tileToMeter);h=(Math.max(e.x,1)<<3)+Math.min(7,Math.round(w.x/10)),g=(Math.max(e.y,1)<<3)+Math.min(7,Math.round(w.y/10))}else h=Math.ceil(7*(e.x+450)),g=0;else h=0,g=+s;let _=s?this.centroidVertexArray.length:n.vertexArrayOffset;for(const w of n.polyCount){s&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*w.edges+w.top);for(let T=0;T<w.top;T++)this.centroidVertexArray.emplace(_++,h,g);for(let T=0;T<2*w.edges;T++)this.centroidVertexArray.emplace(_++,0,g),this.centroidVertexArray.emplace(_++,h,g)}}}function D_(t,e){const n=t.add(e)._unit();return t.x*n.x+t.y*n.y}function C_(t,e,n,s){const h=e.sub(t)._perp()._unit(),g=n.sub(e)._perp()._unit();return Wf(t,e,n,D_(h,g),s)}function Wf(t,e,n,s,h){const g=Math.sqrt(1-s*s);return Math.min(t.dist(e)/3,e.dist(n)/3,h*g/s)}function S_(t,e,n){return t.x<n[0].x&&e.x<n[0].x||t.x>n[1].x&&e.x>n[1].x||t.y<n[0].y&&e.y<n[0].y||t.y>n[1].y&&e.y>n[1].y}function $m(t,e,n){if(t.x<0||t.x>=er||e.x<0||e.x>=er||n.x<0||n.x>=er)return!1;const s=n.sub(e),h=s.perp(),g=t.sub(e);return(s.x*g.x+s.y*g.y)/Math.sqrt((s.x*s.x+s.y*s.y)*(g.x*g.x+g.y*g.y))>-.866&&h.x*g.x+h.y*g.y<0}function xu(t,e,n){const s=e?2|t:-3&t;return n?1|s:-2&s}function Gm(){const t=Math.PI/32,e=Math.tan(t),n=Mh;return n*Math.sqrt(1+2*e*e)-n}function qf(t,e,n){const s=1<<n.z,h=Wa(n.x/s),g=Wa((n.x+1)/s),_=Os(n.y/s),w=Os((n.y+1)/s);return function(T,D,R,O,B=0,V){const G=[];if(!T.length||!R||!O)return G;const J=(Pe,Ke)=>{for(const Ze of Pe)G.push({polygon:Ze,bounds:Ke})},ce=Math.ceil(Math.log2(R)),xe=Math.ceil(Math.log2(O)),Me=ce-xe,ve=[];for(let Pe=0;Pe<Math.abs(Me);Pe++)ve.push(Me>0?0:1);for(let Pe=0;Pe<Math.min(ce,xe);Pe++)ve.push(0),ve.push(1);let Se=T;if(Se=Wl(Se,D[0].y-B,D[1].y+B,1),Se=Wl(Se,D[0].x-B,D[1].x+B,0),!Se.length)return G;const Le=[];for(ve.length?Le.push({polygons:Se,bounds:D,depth:0}):J(Se,D);Le.length;){const Pe=Le.pop(),Ke=Pe.depth,Ze=ve[Ke],_t=Pe.bounds[0],jt=Pe.bounds[1],ot=0===Ze?_t.x:_t.y,vt=0===Ze?jt.x:jt.y,wt=V?V(Ze,ot,vt):.5*(ot+vt),Lt=Wl(Pe.polygons,ot-B,wt+B,Ze),Vt=Wl(Pe.polygons,wt-B,vt+B,Ze);if(Lt.length){const st=[_t,new dt(0===Ze?wt:jt.x,1===Ze?wt:jt.y)];ve.length>Ke+1?Le.push({polygons:Lt,bounds:st,depth:Ke+1}):J(Lt,st)}if(Vt.length){const st=[new dt(0===Ze?wt:_t.x,1===Ze?wt:_t.y),jt];ve.length>Ke+1?Le.push({polygons:Vt,bounds:st,depth:Ke+1}):J(Vt,st)}}return G}(t,e,Math.ceil((g-h)/11.25),Math.ceil((_-w)/11.25),1,(T,D,R)=>{if(0===T)return.5*(D+R);{const O=Os((n.y+D/er)/s);return(Ml(.5*(Os((n.y+R/er)/s)+O))*s-n.y)*er}})}fn(Pd,"FillExtrusionBucket",{omit:["layers","features"]}),fn(T_,"PartMetadata");const Rd=new Bt({"fill-extrusion-edge-radius":new Ge(ct["layout_fill-extrusion"]["fill-extrusion-edge-radius"])});var M_={paint:new Bt({"fill-extrusion-opacity":new Ge(ct["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new it(ct["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Ge(ct["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Ge(ct["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new it(ct["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new it(ct["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new it(ct["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Ge(ct["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Ge(ct["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Ge(ct["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"])}),layout:Rd};function Zf(t,e,n){var s=2*Math.PI*6378137/256/Math.pow(2,n);return[t*s-2*Math.PI*6378137/2,e*s-2*Math.PI*6378137/2]}class kd{constructor(e,n,s){this.z=e,this.x=n,this.y=s,this.key=Uh(0,e,e,n,s)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}url(e,n){const s=(_=this.y,w=this.z,T=Zf(256*(g=this.x),256*(_=Math.pow(2,w)-_-1),w),D=Zf(256*(g+1),256*(_+1),w),T[0]+","+T[1]+","+D[0]+","+D[1]),h=function(g,_,w){let T,D="";for(let R=g;R>0;R--)T=1<<R-1,D+=(_&T?1:0)+(w&T?2:0);return D}(this.z,this.x,this.y);var g,_,w,T,D;return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===n?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",s)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Hm{constructor(e,n){this.wrap=e,this.canonical=n,this.key=Uh(e,n.z,n.z,n.x,n.y)}}class na{constructor(e,n,s,h,g){this.overscaledZ=e,this.wrap=n,this.canonical=new kd(s,+h,+g),this.key=0===n&&e===s?this.canonical.key:Uh(n,e,s,h,g)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const n=this.canonical.z-e;return e>this.canonical.z?new na(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new na(e,this.wrap,e,this.canonical.x>>n,this.canonical.y>>n)}calculateScaledKey(e,n=!0){if(this.overscaledZ===e&&n)return this.key;if(e>this.canonical.z)return Uh(this.wrap*+n,e,this.canonical.z,this.canonical.x,this.canonical.y);{const s=this.canonical.z-e;return Uh(this.wrap*+n,e,e,this.canonical.x>>s,this.canonical.y>>s)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const n=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.x===this.canonical.x>>n&&e.canonical.y===this.canonical.y>>n}children(e){if(this.overscaledZ>=e)return[new na(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const n=this.canonical.z+1,s=2*this.canonical.x,h=2*this.canonical.y;return[new na(n,this.wrap,n,s,h),new na(n,this.wrap,n,s+1,h),new na(n,this.wrap,n,s,h+1),new na(n,this.wrap,n,s+1,h+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new na(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new na(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Hm(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Uh(t,e,n,s,h){const g=1<<Math.min(n,22);let _=g*(h%g)+s%g;return t&&n<22&&(_+=g*g*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*_+n)+(e-n)}fn(kd,"CanonicalTileID"),fn(na,"OverscaledTileID",{omit:["projMatrix"]});class Zu extends dt{constructor(e,n,s){super(e,n),this.z=s}}function Xu(t,e){return t.x*e.x+t.y*e.y}function Wm(t,e){if(1===t.length){let n=0;const s=e[n++];let h;for(;!h||s.equals(h);)if(h=e[n++],!h)return 1/0;for(;n<e.length;n++){const g=e[n],_=t[0],w=h.sub(s),T=g.sub(s),D=_.sub(s),R=Xu(w,w),O=Xu(w,T),B=Xu(T,T),V=Xu(D,w),G=Xu(D,T),J=R*B-O*O,ce=(B*V-O*G)/J,xe=(R*G-O*V)/J,Me=s.z*(1-ce-xe)+h.z*ce+g.z*xe;if(isFinite(Me))return Me}return 1/0}{let n=1/0;for(const s of e)n=Math.min(n,s.z);return n}}function Xf(t,e,n,s,h,g,_,w){const T=_*h.getElevationAt(t,e,!0,!0),D=0!==g[0],R=D?0===g[1]?_*(g[0]/7-450):_*function(O,B,V){const G=Math.floor(B[0]/8),J=Math.floor(B[1]/8),ce=10*(B[0]-8*G),xe=10*(B[1]-8*J),Me=O.getElevationAt(G,J,!0,!0),ve=O.getMeterToDEM(V),Se=Math.floor(.5*(ce*ve-1)),Le=Math.floor(.5*(xe*ve-1)),Pe=O.tileCoordToPixel(G,J),Ke=2*Se+1,Ze=2*Le+1,_t=(Bn=Ke,un=Ze,[(Vt=O).getElevationAtPixel(st=Pe.x-Se,tn=Pe.y-Le,!0),Vt.getElevationAtPixel(st+un,tn,!0),Vt.getElevationAtPixel(st,tn+un,!0),Vt.getElevationAtPixel(st+Bn,tn+un,!0)]),jt=Math.abs(_t[0]-_t[1]),ot=Math.abs(_t[2]-_t[3]),vt=Math.abs(_t[0]-_t[2])+Math.abs(_t[1]-_t[3]),wt=Math.min(.25,.5*ve*(jt+ot)/Ke),Lt=Math.min(.25,.5*ve*vt/Ze);var Vt,st,tn,Bn,un;return Me+Math.max(wt*ce,Lt*xe)}(h,g,w):T;return{base:T+(0===n)?-1:n,top:D?Math.max(R+s,T+n+2):T+s}}const qm=Rn([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Kf}=qm,By=Rn([{name:"a_packed",components:4,type:"Float32"}]),{members:Yf}=By,I_=Bh.types,Ny=Math.cos(Math.PI/180*37.5);class vc{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(n=>n.id),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(n=>{this.gradients[n.id]={}}),this.layoutVertexArray=new mi,this.layoutVertexArray2=new Si,this.indexArray=new gs,this.programConfigurations=new hu(e.layers,e.zoom),this.segments=new yo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(n=>n.isStateDependent()).map(n=>n.id)}populate(e,n,s,h){this.hasPattern=Md("line",this.layers,n);const g=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:R,id:O,index:B,sourceLayerIndex:V}of e){const G=this.layers[0]._featureFilter.needGeometry,J=Wc(R,G);if(!this.layers[0]._featureFilter.filter(new He(this.zoom),J,s))continue;const ce=g?g.evaluate(J,{},s):void 0,xe={id:O,properties:R.properties,type:R.type,sourceLayerIndex:V,index:B,geometry:G?J.geometry:Gl(R,s,h),patterns:{},sortKey:ce};_.push(xe)}g&&_.sort((R,O)=>R.sortKey-O.sortKey);const{lineAtlas:w,featureIndex:T}=n,D=this.addConstantDashes(w);for(const R of _){const{geometry:O,index:B,sourceLayerIndex:V}=R;if(D&&this.addFeatureDashes(R,w),this.hasPattern){const G=Vf("line",this.layers,R,this.zoom,n);this.patternFeatures.push(G)}else this.addFeature(R,O,B,s,w.positions,n.availableImages);T.insert(e[B].feature,O,B,V,this.index)}}addConstantDashes(e){let n=!1;for(const s of this.layers){const h=s.paint.get("line-dasharray").value,g=s.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==g.kind)n=!0;else{const _=g.value,w=h.value;if(!w)continue;e.addDash(w,_)}}return n}addFeatureDashes(e,n){const s=this.zoom;for(const h of this.layers){const g=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if("constant"===g.kind&&"constant"===_.kind)continue;let w,T;if("constant"===g.kind){if(w=g.value,!w)continue}else w=g.evaluate({zoom:s},e);T="constant"===_.kind?_.value:_.evaluate({zoom:s},e),n.addDash(w,T),e.patterns[h.id]=n.getKey(w,T)}}update(e,n,s,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(e,n,this.stateDependentLayers,s,h)}addFeatures(e,n,s,h,g){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,n,s,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Yf)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Kf),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e){if(e.properties&&e.properties.hasOwnProperty("mapbox_clip_start")&&e.properties.hasOwnProperty("mapbox_clip_end"))return{start:+e.properties.mapbox_clip_start,end:+e.properties.mapbox_clip_end}}addFeature(e,n,s,h,g,_){const w=this.layers[0].layout,T=w.get("line-join").evaluate(e,{}),D=w.get("line-cap").evaluate(e,{}),R=w.get("line-miter-limit"),O=w.get("line-round-limit");this.lineClips=this.lineFeatureClips(e);for(const B of n)this.addLine(B,e,T,D,R,O);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,s,g,_,h)}addLine(e,n,s,h,g,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let xe=0;xe<e.length-1;xe++)this.totalDistance+=e[xe].dist(e[xe+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const w="Polygon"===I_[n.type];let T=e.length;for(;T>=2&&e[T-1].equals(e[T-2]);)T--;let D=0;for(;D<T-1&&e[D].equals(e[D+1]);)D++;if(T<(w?3:2))return;"bevel"===s&&(g=1.05);const R=this.overscaling<=16?122880/(512*this.overscaling):0,O=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let B,V,G,J,ce;this.e1=this.e2=-1,w&&(B=e[T-2],ce=e[D].sub(B)._unit()._perp());for(let xe=D;xe<T;xe++){if(G=xe===T-1?w?e[D+1]:void 0:e[xe+1],G&&e[xe].equals(G))continue;ce&&(J=ce),B&&(V=B),B=e[xe],ce=G?G.sub(B)._unit()._perp():J,J=J||ce;let Me=J.add(ce);0===Me.x&&0===Me.y||Me._unit();const ve=J.x*ce.x+J.y*ce.y,Se=Me.x*ce.x+Me.y*ce.y,Le=0!==Se?1/Se:1/0,Pe=2*Math.sqrt(2-2*Se),Ke=Se<Ny&&V&&G,Ze=J.x*ce.y-J.y*ce.x>0;if(Ke&&xe>D){const ot=B.dist(V);if(ot>2*R){const vt=B.sub(B.sub(V)._mult(R/ot)._round());this.updateDistance(V,vt),this.addCurrentVertex(vt,J,0,0,O),V=vt}}const _t=V&&G;let jt=_t?s:w?"butt":h;if(_t&&"round"===jt&&(Le<_?jt="miter":Le<=2&&(jt="fakeround")),"miter"===jt&&Le>g&&(jt="bevel"),"bevel"===jt&&(Le>2&&(jt="flipbevel"),Le<g&&(jt="miter")),V&&this.updateDistance(V,B),"miter"===jt)Me._mult(Le),this.addCurrentVertex(B,Me,0,0,O);else if("flipbevel"===jt){if(Le>100)Me=ce.mult(-1);else{const ot=Le*J.add(ce).mag()/J.sub(ce).mag();Me._perp()._mult(ot*(Ze?-1:1))}this.addCurrentVertex(B,Me,0,0,O),this.addCurrentVertex(B,Me.mult(-1),0,0,O)}else if("bevel"===jt||"fakeround"===jt){const ot=-Math.sqrt(Le*Le-1),vt=Ze?ot:0,wt=Ze?0:ot;if(V&&this.addCurrentVertex(B,J,vt,wt,O),"fakeround"===jt){const Lt=Math.round(180*Pe/Math.PI/20);for(let Vt=1;Vt<Lt;Vt++){let st=Vt/Lt;if(.5!==st){const Bn=st-.5;st+=st*Bn*(st-1)*((1.0904+ve*(ve*(3.55645-1.43519*ve)-3.2452))*Bn*Bn+(.848013+ve*(.215638*ve-1.06021)))}const tn=ce.sub(J)._mult(st)._add(J)._unit()._mult(Ze?-1:1);this.addHalfVertex(B,tn.x,tn.y,!1,Ze,0,O)}}G&&this.addCurrentVertex(B,ce,-vt,-wt,O)}else if("butt"===jt)this.addCurrentVertex(B,Me,0,0,O);else if("square"===jt){const ot=V?1:-1;V||this.addCurrentVertex(B,Me,ot,ot,O),this.addCurrentVertex(B,Me,0,0,O),V&&this.addCurrentVertex(B,Me,ot,ot,O)}else"round"===jt&&(V&&(this.addCurrentVertex(B,J,0,0,O),this.addCurrentVertex(B,J,1,1,O,!0)),G&&(this.addCurrentVertex(B,ce,-1,-1,O,!0),this.addCurrentVertex(B,ce,0,0,O)));if(Ke&&xe<T-1){const ot=B.dist(G);if(ot>2*R){const vt=B.add(G.sub(B)._mult(R/ot)._round());this.updateDistance(B,vt),this.addCurrentVertex(vt,ce,0,0,O),B=vt}}}}addCurrentVertex(e,n,s,h,g,_=!1){const w=n.y*h-n.x,T=-n.y-n.x*h;this.addHalfVertex(e,n.x+n.y*s,n.y-n.x*s,_,!1,s,g),this.addHalfVertex(e,w,T,_,!0,-h,g)}addHalfVertex({x:e,y:n},s,h,g,_,w,T){this.layoutVertexArray.emplaceBack((e<<1)+(g?1:0),(n<<1)+(_?1:0),Math.round(63*s)+128,Math.round(63*h)+128,1+(0===w?0:w<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const D=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,D),T.primitiveLength++),_?this.e2=D:this.e1=D}updateScaledDistance(){if(this.lineClips){const e=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(e,n){this.distance+=e.dist(n),this.updateScaledDistance()}}fn(vc,"LineBucket",{omit:["layers","patternFeatures"]});const Zm=new Bt({"line-cap":new it(ct.layout_line["line-cap"]),"line-join":new it(ct.layout_line["line-join"]),"line-miter-limit":new Ge(ct.layout_line["line-miter-limit"]),"line-round-limit":new Ge(ct.layout_line["line-round-limit"]),"line-sort-key":new it(ct.layout_line["line-sort-key"])});var Xm={paint:new Bt({"line-opacity":new it(ct.paint_line["line-opacity"]),"line-color":new it(ct.paint_line["line-color"]),"line-translate":new Ge(ct.paint_line["line-translate"]),"line-translate-anchor":new Ge(ct.paint_line["line-translate-anchor"]),"line-width":new it(ct.paint_line["line-width"]),"line-gap-width":new it(ct.paint_line["line-gap-width"]),"line-offset":new it(ct.paint_line["line-offset"]),"line-blur":new it(ct.paint_line["line-blur"]),"line-dasharray":new it(ct.paint_line["line-dasharray"]),"line-pattern":new it(ct.paint_line["line-pattern"]),"line-gradient":new Ct(ct.paint_line["line-gradient"]),"line-trim-offset":new Ge(ct.paint_line["line-trim-offset"])}),layout:Zm};const Jf=new class extends it{possiblyEvaluate(t,e){return e=new He(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,s){return e=rt({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,s)}}(Xm.paint.properties["line-width"].specification);function Km(t,e){return e>0?e+2*t:t}Jf.useIntegerZoom=!0;const A_=Rn([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Ld=Rn([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),Ku=Rn([{name:"a_projected_pos",components:4,type:"Float32"}],4);Rn([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const Qf=Rn([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),jh=Rn([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Rn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const Od=Rn([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),Fd=Rn([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Rn([{name:"triangle",components:3,type:"Uint16"}]),Rn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Rn([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Rn([{type:"Float32",name:"offsetX"}]),Rn([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var vs=24;const ul=128;function Vh(t,e){const{expression:n}=e;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new He(t+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:s,interpolationType:h}=n;let g=0;for(;g<s.length&&s[g]<=t;)g++;g=Math.max(0,g-1);let _=g;for(;_<s.length&&s[_]<t+1;)_++;_=Math.min(s.length-1,_);const w=s[g],T=s[_];return"composite"===n.kind?{kind:"composite",minZoom:w,maxZoom:T,interpolationType:h}:{kind:"camera",minZoom:w,maxZoom:T,minSize:n.evaluate(new He(w)),maxSize:n.evaluate(new He(T)),interpolationType:h}}}function Yu(t,{uSize:e,uSizeT:n},{lowerSize:s,upperSize:h}){return"source"===t.kind?s/ul:"composite"===t.kind?Jn(s/ul,h/ul,n):e}function wu(t,e){let n=0,s=0;if("constant"===t.kind)s=t.layoutSize;else if("source"!==t.kind){const{interpolationType:h,minZoom:g,maxZoom:_}=t,w=h?$t(sr.interpolationFactor(h,e,g,_),0,1):0;"camera"===t.kind?s=Jn(t.minSize,t.maxSize,w):n=w}return{uSizeT:n,uSize:s}}var ep=Object.freeze({__proto__:null,getSizeData:Vh,evaluateSizeForFeature:Yu,evaluateSizeForZoom:wu,SIZE_PACK_FACTOR:ul});function P_(t,e,n){return t.sections.forEach(s=>{s.text=function(h,g,_){const w=g.layout.get("text-transform").evaluate(_,{});return"uppercase"===w?h=h.toLocaleUpperCase():"lowercase"===w&&(h=h.toLocaleLowerCase()),Be.applyArabicShaping&&(h=Be.applyArabicShaping(h)),h}(s.text,e,n)}),t}const $h={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function Ym(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function R_(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}var Ju=Ii,tp=function(t,e,n,s,h){var g,_,w=8*h-s-1,T=(1<<w)-1,D=T>>1,R=-7,O=n?h-1:0,B=n?-1:1,V=t[e+O];for(O+=B,g=V&(1<<-R)-1,V>>=-R,R+=w;R>0;g=256*g+t[e+O],O+=B,R-=8);for(_=g&(1<<-R)-1,g>>=-R,R+=s;R>0;_=256*_+t[e+O],O+=B,R-=8);if(0===g)g=1-D;else{if(g===T)return _?NaN:1/0*(V?-1:1);_+=Math.pow(2,s),g-=D}return(V?-1:1)*_*Math.pow(2,g-s)},Jm=function(t,e,n,s,h,g){var _,w,T,D=8*g-h-1,R=(1<<D)-1,O=R>>1,B=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,V=s?0:g-1,G=s?1:-1,J=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(w=isNaN(e)?1:0,_=R):(_=Math.floor(Math.log(e)/Math.LN2),e*(T=Math.pow(2,-_))<1&&(_--,T*=2),(e+=_+O>=1?B/T:B*Math.pow(2,1-O))*T>=2&&(_++,T/=2),_+O>=R?(w=0,_=R):_+O>=1?(w=(e*T-1)*Math.pow(2,h),_+=O):(w=e*Math.pow(2,O-1)*Math.pow(2,h),_=0));h>=8;t[n+V]=255&w,V+=G,w/=256,h-=8);for(_=_<<h|w,D+=h;D>0;t[n+V]=255&_,V+=G,_/=256,D-=8);t[n+V-G]|=128*J};function Ii(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Ii.Varint=0,Ii.Fixed64=1,Ii.Bytes=2,Ii.Fixed32=5;var ya=4294967296,np=1/ya,Qm=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function Xc(t){return t.type===Ii.Bytes?t.readVarint()+t.pos:t.pos+1}function rp(t,e,n){var s=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(s);for(var h=n.pos-1;h>=t;h--)n.buf[h+s]=n.buf[h]}function k_(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function L_(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function O_(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function eg(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function F_(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function z_(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function ip(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function B_(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function N_(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function zd(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Qu(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function tg(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function ql(t,e,n){e.glyphs=[],1===t&&n.readMessage(op,e)}function op(t,e,n){if(3===t){const{id:s,bitmap:h,width:g,height:_,left:w,top:T,advance:D}=n.readMessage(U_,{});e.glyphs.push({id:s,bitmap:new _c({width:g+6,height:_+6},h),metrics:{width:g,height:_,left:w,top:T,advance:D}})}else 4===t?e.ascender=n.readSVarint():5===t&&(e.descender=n.readSVarint())}function U_(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function sp(t){let e=0,n=0;for(const _ of t)e+=_.w*_.h,n=Math.max(n,_.w);t.sort((_,w)=>w.h-_.h);const s=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let h=0,g=0;for(const _ of t)for(let w=s.length-1;w>=0;w--){const T=s[w];if(!(_.w>T.w||_.h>T.h)){if(_.x=T.x,_.y=T.y,g=Math.max(g,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===T.w&&_.h===T.h){const D=s.pop();w<s.length&&(s[w]=D)}else _.h===T.h?(T.x+=_.w,T.w-=_.w):_.w===T.w?(T.y+=_.h,T.h-=_.h):(s.push({x:T.x+_.w,y:T.y,w:T.w-_.w,h:_.h}),T.y+=_.h,T.h-=_.h);break}}return{w:h,h:g,fill:e/(h*g)||0}}Ii.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var s=this.readVarint(),h=s>>3,g=this.pos;this.type=7&s,t(h,e,this),this.pos===g&&this.skip(s)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=zd(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=tg(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=zd(this.buf,this.pos)+zd(this.buf,this.pos+4)*ya;return this.pos+=8,t},readSFixed64:function(){var t=zd(this.buf,this.pos)+tg(this.buf,this.pos+4)*ya;return this.pos+=8,t},readFloat:function(){var t=tp(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=tp(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,s=this.buf;return e=127&(n=s[this.pos++]),n<128?e:(e|=(127&(n=s[this.pos++]))<<7,n<128?e:(e|=(127&(n=s[this.pos++]))<<14,n<128?e:(e|=(127&(n=s[this.pos++]))<<21,n<128?e:function(h,g,_){var w,T,D=_.buf;if(w=(112&(T=D[_.pos++]))>>4,T<128||(w|=(127&(T=D[_.pos++]))<<3,T<128)||(w|=(127&(T=D[_.pos++]))<<10,T<128)||(w|=(127&(T=D[_.pos++]))<<17,T<128)||(w|=(127&(T=D[_.pos++]))<<24,T<128)||(w|=(1&(T=D[_.pos++]))<<31,T<128))return function Kc(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}(h,w,g);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=s[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Qm?Qm.decode(this.buf.subarray(e,t)):function(n,s,h){for(var g="",_=s;_<h;){var w,T,D,R=n[_],O=null,B=R>239?4:R>223?3:R>191?2:1;if(_+B>h)break;1===B?R<128&&(O=R):2===B?128==(192&(w=n[_+1]))&&(O=(31&R)<<6|63&w)<=127&&(O=null):3===B?(T=n[_+2],128==(192&(w=n[_+1]))&&128==(192&T)&&((O=(15&R)<<12|(63&w)<<6|63&T)<=2047||O>=55296&&O<=57343)&&(O=null)):4===B&&(T=n[_+2],D=n[_+3],128==(192&(w=n[_+1]))&&128==(192&T)&&128==(192&D)&&((O=(15&R)<<18|(63&w)<<12|(63&T)<<6|63&D)<=65535||O>=1114112)&&(O=null)),null===O?(O=65533,B=1):O>65535&&(O-=65536,g+=String.fromCharCode(O>>>10&1023|55296),O=56320|1023&O),g+=String.fromCharCode(O),_+=B}return g}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Ii.Bytes)return t.push(this.readVarint(e));var n=Xc(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Ii.Bytes)return t.push(this.readSVarint());var e=Xc(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Ii.Bytes)return t.push(this.readBoolean());var e=Xc(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Ii.Bytes)return t.push(this.readFloat());var e=Xc(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Ii.Bytes)return t.push(this.readDouble());var e=Xc(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Ii.Bytes)return t.push(this.readFixed32());var e=Xc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Ii.Bytes)return t.push(this.readSFixed32());var e=Xc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Ii.Bytes)return t.push(this.readFixed64());var e=Xc(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Ii.Bytes)return t.push(this.readSFixed64());var e=Xc(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Ii.Varint)for(;this.buf[this.pos++]>127;);else if(e===Ii.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Ii.Fixed32)this.pos+=4;else{if(e!==Ii.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Qu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Qu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Qu(this.buf,-1&t,this.pos),Qu(this.buf,Math.floor(t*np),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Qu(this.buf,-1&t,this.pos),Qu(this.buf,Math.floor(t*np),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(e,n){var s,h,g,w;if(e>=0?(s=e%4294967296|0,h=e/4294967296|0):(h=~(-e/4294967296),4294967295^(s=~(-e%4294967296))?s=s+1|0:(s=0,h=h+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");n.realloc(10),g=s,(w=n).buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,g>>>=7,w.buf[w.pos++]=127&g|128,w.buf[w.pos]=127&(g>>>=7),function(g,_){var w=(7&g)<<4;_.buf[_.pos++]|=w|((g>>>=3)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g|((g>>>=7)?128:0),g&&(_.buf[_.pos++]=127&g)))))}(h,n)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(s,h,g){for(var _,w,T=0;T<h.length;T++){if((_=h.charCodeAt(T))>55295&&_<57344){if(!w){_>56319||T+1===h.length?(s[g++]=239,s[g++]=191,s[g++]=189):w=_;continue}if(_<56320){s[g++]=239,s[g++]=191,s[g++]=189,w=_;continue}_=w-55296<<10|_-56320|65536,w=null}else w&&(s[g++]=239,s[g++]=191,s[g++]=189,w=null);_<128?s[g++]=_:(_<2048?s[g++]=_>>6|192:(_<65536?s[g++]=_>>12|224:(s[g++]=_>>18|240,s[g++]=_>>12&63|128),s[g++]=_>>6&63|128),s[g++]=63&_|128)}return g}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&rp(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Jm(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Jm(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var s=this.pos-n;s>=128&&rp(n,s,this),this.pos=n-1,this.writeVarint(s),this.pos+=s},writeMessage:function(t,e,n){this.writeTag(t,Ii.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,k_,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,L_,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,F_,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,O_,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,eg,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,z_,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,ip,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,B_,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,N_,e)},writeBytesField:function(t,e){this.writeTag(t,Ii.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Ii.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Ii.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Ii.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Ii.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Ii.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Ii.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Ii.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Ii.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Ii.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class Bd{constructor(e,{pixelRatio:n,version:s,stretchX:h,stretchY:g,content:_}){this.paddedRect=e,this.pixelRatio=n,this.stretchX=h,this.stretchY=g,this.content=_,this.version=s}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class ng{constructor(e,n){const s={},h={};this.haveRenderCallbacks=[];const g=[];this.addImages(e,s,g),this.addImages(n,h,g);const{w:_,h:w}=sp(g),T=new Fs({width:_||1,height:w||1});for(const D in e){const R=e[D],O=s[D].paddedRect;Fs.copy(R.data,T,{x:0,y:0},{x:O.x+1,y:O.y+1},R.data)}for(const D in n){const R=n[D],O=h[D].paddedRect,B=O.x+1,V=O.y+1,G=R.data.width,J=R.data.height;Fs.copy(R.data,T,{x:0,y:0},{x:B,y:V},R.data),Fs.copy(R.data,T,{x:0,y:J-1},{x:B,y:V-1},{width:G,height:1}),Fs.copy(R.data,T,{x:0,y:0},{x:B,y:V+J},{width:G,height:1}),Fs.copy(R.data,T,{x:G-1,y:0},{x:B-1,y:V},{width:1,height:J}),Fs.copy(R.data,T,{x:0,y:0},{x:B+G,y:V},{width:1,height:J})}this.image=T,this.iconPositions=s,this.patternPositions=h}addImages(e,n,s){for(const h in e){const g=e[h],_={x:0,y:0,w:g.data.width+2,h:g.data.height+2};s.push(_),n[h]=new Bd(_,g),g.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(e,n){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(s=>e.hasImage(s)),e.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const s in e.updatedImages)this.patchUpdatedImage(this.iconPositions[s],e.getImage(s),n),this.patchUpdatedImage(this.patternPositions[s],e.getImage(s),n)}patchUpdatedImage(e,n,s){if(!e||!n||e.version===n.version)return;e.version=n.version;const[h,g]=e.tl;s.update(n.data,void 0,{x:h,y:g})}}fn(Bd,"ImagePosition"),fn(ng,"ImageAtlas");const Za={horizontal:1,vertical:2,horizontalOnly:3};class Gh{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(e,n){const s=new Gh;return s.scale=e||1,s.fontStack=n,s}static forImage(e){const n=new Gh;return n.imageName=e,n}}class Yc{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,n){const s=new Yc;for(let h=0;h<e.sections.length;h++){const g=e.sections[h];g.image?s.addImageSection(g):s.addTextSection(g,n)}return s}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCharCode(e){return this.text.charCodeAt(e)}verticalizePunctuation(e){this.text=function(n,s){let h="";for(let g=0;g<n.length;g++){const _=n.charCodeAt(g+1)||null,w=n.charCodeAt(g-1)||null;h+=!s&&(_&&E(_)&&!$h[n[g+1]]||w&&E(w)&&!$h[n[g-1]])||!$h[n[g]]?n[g]:$h[n[g]]}return h}(this.text,e)}trim(){let e=0;for(let s=0;s<this.text.length&&Nd[this.text.charCodeAt(s)];s++)e++;let n=this.text.length;for(let s=this.text.length-1;s>=0&&s>=e&&Nd[this.text.charCodeAt(s)];s--)n--;this.text=this.text.substring(e,n),this.sectionIndex=this.sectionIndex.slice(e,n)}substring(e,n){const s=new Yc;return s.text=this.text.substring(e,n),s.sectionIndex=this.sectionIndex.slice(e,n),s.sections=this.sections,s}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,n)=>Math.max(e,this.sections[n].scale),0)}addTextSection(e,n){this.text+=e.text,this.sections.push(Gh.forText(e.scale,e.fontStack||n));const s=this.sections.length-1;for(let h=0;h<e.text.length;++h)this.sectionIndex.push(s)}addImageSection(e){const n=e.image?e.image.name:"";if(0===n.length)return void vr("Can't add FormattedSection with an empty image.");const s=this.getNextImageSectionCharCode();s?(this.text+=String.fromCharCode(s),this.sections.push(Gh.forImage(n)),this.sectionIndex.push(this.sections.length-1)):vr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function ap(t,e,n,s,h,g,_,w,T,D,R,O,B,V,G){const J=Yc.fromFeature(t,h);O===Za.vertical&&J.verticalizePunctuation(B);let ce=[];const xe=function(Pe,Ke,Ze,_t,jt,ot){if(!Pe)return[];const vt=[],wt=function(tn,Bn,un,Cn,nn,Wn){let Ar=0;for(let Sr=0;Sr<tn.length();Sr++){const Tr=tn.getSection(Sr);Ar+=jd(tn.getCharCode(Sr),Tr,Cn,nn,Bn,Wn)}return Ar/Math.max(1,Math.ceil(Ar/un))}(Pe,Ke,Ze,_t,jt,ot),Lt=Pe.text.indexOf("\u200b")>=0;let Vt=0;for(let tn=0;tn<Pe.length();tn++){const Bn=Pe.getSection(tn),un=Pe.getCharCode(tn);if(Nd[un]||(Vt+=jd(un,Bn,_t,jt,Ke,ot)),tn<Pe.length()-1){const Cn=!((st=un)<11904||!(sc(st)||Ou(st)||p(st)||lc(st)||ac(st)||ou(st)||sd(st)||Oc(st)||Ul(st)||su(st)||To(st)||a(st)||Fc(st)||Lu(st)||ku(st)||Nl(st)||oc(st)||cc(st)||sl(st)||Ws(st)));(Ud[un]||Cn||Bn.imageName)&&vt.push(Vd(tn+1,Vt,wt,vt,Uy(un,Pe.getCharCode(tn+1),Cn&&Lt),!1))}}var st;return j_(Vd(Pe.length(),Vt,wt,vt,0,!0))}(J,D,g,e,s,V),{processBidirectionalText:Me,processStyledBidirectionalText:ve}=Be;if(Me&&1===J.sections.length){const Pe=Me(J.toString(),xe);for(const Ke of Pe){const Ze=new Yc;Ze.text=Ke,Ze.sections=J.sections;for(let _t=0;_t<Ke.length;_t++)Ze.sectionIndex.push(0);ce.push(Ze)}}else if(ve){const Pe=ve(J.text,J.sectionIndex,xe);for(const Ke of Pe){const Ze=new Yc;Ze.text=Ke[0],Ze.sectionIndex=Ke[1],Ze.sections=J.sections,ce.push(Ze)}}else ce=function(Pe,Ke){const Ze=[],_t=Pe.text;let jt=0;for(const ot of Ke)Ze.push(Pe.substring(jt,ot)),jt=ot;return jt<_t.length&&Ze.push(Pe.substring(jt,_t.length)),Ze}(J,xe);const Se=[],Le={positionedLines:Se,text:J.toString(),top:R[1],bottom:R[1],left:R[0],right:R[0],writingMode:O,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(Pe,Ke,Ze,_t,jt,ot,vt,wt,Lt,Vt,st,tn){let Bn=0,un=0,Cn=0;const nn="right"===wt?1:"left"===wt?0:.5;let Wn=!1;for(const ar of jt){const kr=ar.getSections();for(const gi of kr){if(gi.imageName)continue;const Fi=Ke[gi.fontStack];if(Fi&&(Wn=void 0!==Fi.ascender&&void 0!==Fi.descender,!Wn))break}if(!Wn)break}let Ar=0;for(const ar of jt){ar.trim();const kr=ar.getMaxScale(),gi=(kr-1)*vs,Fi={positionedGlyphs:[],lineOffset:0};Pe.positionedLines[Ar]=Fi;const Ai=Fi.positionedGlyphs;let zi=0;if(!ar.length()){un+=ot,++Ar;continue}let Vi=0,fo=0;for(let ui=0;ui<ar.length();ui++){const Fo=ar.getSection(ui),Co=ar.getSectionIndex(ui),qr=ar.getCharCode(ui);let Ki=Fo.scale,Ho=null,_i=null,xo=null,zs=vs,es=0;const ts=!(Lt===Za.horizontal||!st&&!x(qr)||st&&(Nd[qr]||(Sr=qr,ru(Sr)||iu(Sr)||fi(Sr)||al(Sr)||c(Sr))));if(Fo.imageName){const Xs=_t[Fo.imageName];if(!Xs)continue;xo=Fo.imageName,Pe.iconsInText=Pe.iconsInText||!0,_i=Xs.paddedRect;const ns=Xs.displaySize;Ki=Ki*vs/tn,Ho={width:ns[0],height:ns[1],left:1,top:-3,advance:ts?ns[1]:ns[0],localGlyph:!1},es=Wn?-Ho.height*Ki:kr*vs-17-ns[1]*Ki,zs=Ho.advance;const Yl=(ts?ns[0]:ns[1])*Ki-vs*kr;Yl>0&&Yl>zi&&(zi=Yl)}else{const Xs=Ze[Fo.fontStack];if(!Xs)continue;Xs[qr]&&(_i=Xs[qr]);const ns=Ke[Fo.fontStack];if(!ns)continue;const Yl=ns.glyphs[qr];if(!Yl)continue;if(Ho=Yl.metrics,zs=8203!==qr?vs:0,Wn){const Iu=void 0!==ns.ascender?Math.abs(ns.ascender):0,lh=void 0!==ns.descender?Math.abs(ns.descender):0,ch=(Iu+lh)*Ki;Vi<ch&&(Vi=ch,fo=(Iu-lh)/2*Ki),es=-Iu*Ki}else es=(kr-Ki)*vs-17}ts?(Pe.verticalizable=!0,Ai.push({glyph:qr,imageName:xo,x:Bn,y:un+es,vertical:ts,scale:Ki,localGlyph:Ho.localGlyph,fontStack:Fo.fontStack,sectionIndex:Co,metrics:Ho,rect:_i}),Bn+=zs*Ki+Vt):(Ai.push({glyph:qr,imageName:xo,x:Bn,y:un+es,vertical:ts,scale:Ki,localGlyph:Ho.localGlyph,fontStack:Fo.fontStack,sectionIndex:Co,metrics:Ho,rect:_i}),Bn+=Ho.advance*Ki+Vt)}0!==Ai.length&&(Cn=Math.max(Bn-Vt,Cn),Wn?lp(Ai,nn,zi,fo,ot*kr/2):lp(Ai,nn,zi,0,ot/2)),Bn=0;const ws=ot*kr+zi;Fi.lineOffset=Math.max(zi,gi),un+=ws,++Ar}var Sr;const Tr=un,{horizontalAlign:Kn,verticalAlign:ci}=$d(vt);(function(ar,kr,gi,Fi,Ai,zi){const Vi=(kr-gi)*Ai,fo=-zi*Fi;for(const ws of ar)for(const ui of ws.positionedGlyphs)ui.x+=Vi,ui.y+=fo})(Pe.positionedLines,nn,Kn,ci,Cn,Tr),Pe.top+=-ci*Tr,Pe.bottom=Pe.top+Tr,Pe.left+=-Kn*Cn,Pe.right=Pe.left+Cn,Pe.hasBaseline=Wn}(Le,e,n,s,ce,_,w,T,O,D,B,G),!function(Pe){for(const Ke of Pe)if(0!==Ke.positionedGlyphs.length)return!1;return!0}(Se)&&Le}const Nd={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ud={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function jd(t,e,n,s,h,g){if(e.imageName){const _=s[e.imageName];return _?_.displaySize[0]*e.scale*vs/g+h:0}{const _=n[e.fontStack],w=_&&_.glyphs[t];return w?w.metrics.advance*e.scale+h:0}}function Hh(t,e,n,s){const h=Math.pow(t-e,2);return s?t<e?h/2:2*h:h+Math.abs(n)*n}function Uy(t,e,n){let s=0;return 10===t&&(s-=1e4),n&&(s+=150),40!==t&&65288!==t||(s+=50),41!==e&&65289!==e||(s+=50),s}function Vd(t,e,n,s,h,g){let _=null,w=Hh(e,n,h,g);for(const T of s){const D=Hh(e-T.x,n,h,g)+T.badness;D<=w&&(_=T,w=D)}return{index:t,x:e,priorBreak:_,badness:w}}function j_(t){return t?j_(t.priorBreak).concat(t.index):[]}function $d(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function lp(t,e,n,s,h){if(!(e||n||s||h))return;const g=t.length-1,_=t[g],w=(_.x+_.metrics.advance*_.scale)*e;for(let T=0;T<=g;T++)t[T].x-=w,t[T].y+=n+s+h}function rg(t,e,n){const{horizontalAlign:s,verticalAlign:h}=$d(n),g=e[0]-t.displaySize[0]*s,_=e[1]-t.displaySize[1]*h;return{image:t,top:_,bottom:_+t.displaySize[1],left:g,right:g+t.displaySize[0]}}function cp(t,e,n,s,h,g){const _=t.image;let w;if(_.content){const ce=_.content,xe=_.pixelRatio||1;w=[ce[0]/xe,ce[1]/xe,_.displaySize[0]-ce[2]/xe,_.displaySize[1]-ce[3]/xe]}const T=e.left*g,D=e.right*g;let R,O,B,V;"width"===n||"both"===n?(V=h[0]+T-s[3],O=h[0]+D+s[1]):(V=h[0]+(T+D-_.displaySize[0])/2,O=V+_.displaySize[0]);const G=e.top*g,J=e.bottom*g;return"height"===n||"both"===n?(R=h[1]+G-s[0],B=h[1]+J+s[2]):(R=h[1]+(G+J-_.displaySize[1])/2,B=R+_.displaySize[1]),{image:_,top:R,right:O,bottom:B,left:V,collisionPadding:w}}class Al extends dt{constructor(e,n,s,h,g){super(e,n),this.angle=h,this.z=s,void 0!==g&&(this.segment=g)}clone(){return new Al(this.x,this.y,this.z,this.angle,this.segment)}}function Zl(t,e,n,s,h){if(void 0===e.segment)return!0;let g=e,_=e.segment+1,w=0;for(;w>-n/2;){if(_--,_<0)return!1;w-=t[_].dist(g),g=t[_]}w+=t[_].dist(t[_+1]),_++;const T=[];let D=0;for(;w<n/2;){const R=t[_],O=t[_+1];if(!O)return!1;let B=t[_-1].angleTo(R)-R.angleTo(O);for(B=Math.abs((B+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:w,angleDelta:B}),D+=B;w-T[0].distance>s;)D-=T.shift().angleDelta;if(D>h)return!1;_++,w+=R.dist(O)}return!0}function Wh(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function qh(t,e,n){return t?.6*e*n:0}function eh(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function V_(t,e,n,s,h,g){const _=qh(n,h,g),w=eh(n,s)*g;let T=0;const D=Wh(t)/2;for(let R=0;R<t.length-1;R++){const O=t[R],B=t[R+1],V=O.dist(B);if(T+V>D){const G=(D-T)/V,J=Jn(O.x,B.x,G),ce=Jn(O.y,B.y,G),xe=new Al(J,ce,0,B.angleTo(O),R);return!_||Zl(t,xe,w,_,e)?xe:void 0}T+=V}}function ig(t,e,n,s,h,g,_,w,T){const D=qh(s,g,_),R=eh(s,h),O=R*_,B=0===t[0].x||t[0].x===T||0===t[0].y||t[0].y===T;return e-O<e/4&&(e=O+e/4),up(t,B?e/2*w%e:(R/2+2*g)*_*w%e,e,D,n,O,B,!1,T)}function up(t,e,n,s,h,g,_,w,T){const D=g/2,R=Wh(t);let O=0,B=e-n,V=[];for(let G=0;G<t.length-1;G++){const J=t[G],ce=t[G+1],xe=J.dist(ce),Me=ce.angleTo(J);for(;B+n<O+xe;){B+=n;const ve=(B-O)/xe,Se=Jn(J.x,ce.x,ve),Le=Jn(J.y,ce.y,ve);if(Se>=0&&Se<T&&Le>=0&&Le<T&&B-D>=0&&B+D<=R){const Pe=new Al(Se,Le,0,Me,G);Pe._round(),s&&!Zl(t,Pe,g,s,h)||V.push(Pe)}}O+=xe}return w||V.length||_||(V=up(t,O/2,n,s,h,g,_,!0,T)),V}function og(t,e,n,s,h){const g=[];for(let _=0;_<t.length;_++){const w=t[_];let T;for(let D=0;D<w.length-1;D++){let R=w[D],O=w[D+1];R.x<e&&O.x<e||(R.x<e?R=new dt(e,R.y+(e-R.x)/(O.x-R.x)*(O.y-R.y))._round():O.x<e&&(O=new dt(e,R.y+(e-R.x)/(O.x-R.x)*(O.y-R.y))._round()),R.y<n&&O.y<n||(R.y<n?R=new dt(R.x+(n-R.y)/(O.y-R.y)*(O.x-R.x),n)._round():O.y<n&&(O=new dt(R.x+(n-R.y)/(O.y-R.y)*(O.x-R.x),n)._round()),R.x>=s&&O.x>=s||(R.x>=s?R=new dt(s,R.y+(s-R.x)/(O.x-R.x)*(O.y-R.y))._round():O.x>=s&&(O=new dt(s,R.y+(s-R.x)/(O.x-R.x)*(O.y-R.y))._round()),R.y>=h&&O.y>=h||(R.y>=h?R=new dt(R.x+(h-R.y)/(O.y-R.y)*(O.x-R.x),h)._round():O.y>=h&&(O=new dt(R.x+(h-R.y)/(O.y-R.y)*(O.x-R.x),h)._round()),T&&R.equals(T[T.length-1])||(T=[R],g.push(T)),T.push(O)))))}}return g}fn(Al,"Anchor");const Zh=1e20;function th(t,e,n,s,h,g,_,w,T){for(let D=e;D<e+s;D++)sg(t,n*g+D,g,h,_,w,T);for(let D=n;D<n+h;D++)sg(t,D*g+e,1,s,_,w,T)}function sg(t,e,n,s,h,g,_){g[0]=0,_[0]=-Zh,_[1]=Zh,h[0]=t[e];for(let w=1,T=0,D=0;w<s;w++){h[w]=t[e+w*n];const R=w*w;do{const O=g[T];D=(h[w]-h[O]+R-O*O)/(w-O)/2}while(D<=_[T]&&--T>-1);T++,g[T]=w,_[T]=D,_[T+1]=Zh}for(let w=0,T=0;w<s;w++){for(;_[T+1]<w;)T++;const D=g[T],R=w-D;t[e+w*n]=h[D]+R*R}}const ag={none:0,ideographs:1,all:2};class nh{constructor(e,n,s){this.requestManager=e,this.localGlyphMode=n,this.localFontFamily=s,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,n){const s=[];for(const h in e)for(const g of e[h])s.push({stack:h,id:g});Gt(s,({stack:h,id:g},_)=>{let w=this.entries[h];w||(w=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=w.glyphs[g];if(void 0!==T)return void _(null,{stack:h,id:g,glyph:T});if(T=this._tinySDF(w,h,g),T)return w.glyphs[g]=T,void _(null,{stack:h,id:g,glyph:T});const D=Math.floor(g/256);if(256*D>65535)return void _(new Error("glyphs > 65535 not supported"));if(w.ranges[D])return void _(null,{stack:h,id:g,glyph:T});let R=w.requests[D];R||(R=w.requests[D]=[],nh.loadGlyphRange(h,D,this.url,this.requestManager,(O,B)=>{if(B){w.ascender=B.ascender,w.descender=B.descender;for(const V in B.glyphs)this._doesCharSupportLocalGlyph(+V)||(w.glyphs[+V]=B.glyphs[+V]);w.ranges[D]=!0}for(const V of R)V(O,B);delete w.requests[D]})),R.push((O,B)=>{O?_(O):B&&_(null,{stack:h,id:g,glyph:B.glyphs[g]||null})})},(h,g)=>{if(h)n(h);else if(g){const _={};for(const{stack:w,id:T,glyph:D}of g)void 0===_[w]&&(_[w]={}),void 0===_[w].glyphs&&(_[w].glyphs={}),_[w].glyphs[T]=D&&{id:D.id,bitmap:D.bitmap.clone(),metrics:D.metrics},_[w].ascender=this.entries[w].ascender,_[w].descender=this.entries[w].descender;n(null,_)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==ag.none&&(this.localGlyphMode===ag.all?!!this.localFontFamily:!!this.localFontFamily&&(su(e)||au(e)||Fc(e)||oc(e)||Oc(e)))}_tinySDF(e,n,s){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(s))return;let g=e.tinySDF;if(!g){let J="400";/bold/i.test(n)?J="900":/medium/i.test(n)?J="500":/light/i.test(n)&&(J="200"),g=e.tinySDF=new nh.TinySDF({fontFamily:h,fontWeight:J,fontSize:48,buffer:6,radius:16}),g.fontWeight=J}if(this.localGlyphs[g.fontWeight][s])return this.localGlyphs[g.fontWeight][s];const _=String.fromCharCode(s),{data:w,width:T,height:D,glyphWidth:R,glyphHeight:O,glyphLeft:B,glyphTop:V,glyphAdvance:G}=g.draw(_);return this.localGlyphs[g.fontWeight][s]={id:s,bitmap:new _c({width:T,height:D},w),metrics:{width:R/2,height:O/2,left:B/2,top:V/2-27,advance:G/2,localGlyph:!0}}}}function lg(t,e,n,s){const h=[],g=t.image,_=g.pixelRatio,w=g.paddedRect.w-2,T=g.paddedRect.h-2,D=t.right-t.left,R=t.bottom-t.top,O=g.stretchX||[[0,w]],B=g.stretchY||[[0,T]],V=(ot,vt)=>ot+vt[1]-vt[0],G=O.reduce(V,0),J=B.reduce(V,0),ce=w-G,xe=T-J;let Me=0,ve=G,Se=0,Le=J,Pe=0,Ke=ce,Ze=0,_t=xe;if(g.content&&s){const ot=g.content;Me=Gd(O,0,ot[0]),Se=Gd(B,0,ot[1]),ve=Gd(O,ot[0],ot[2]),Le=Gd(B,ot[1],ot[3]),Pe=ot[0]-Me,Ze=ot[1]-Se,Ke=ot[2]-ot[0]-ve,_t=ot[3]-ot[1]-Le}const jt=(ot,vt,wt,Lt)=>{const Vt=Hd(ot.stretch-Me,ve,D,t.left),st=Wd(ot.fixed-Pe,Ke,ot.stretch,G),tn=Hd(vt.stretch-Se,Le,R,t.top),Bn=Wd(vt.fixed-Ze,_t,vt.stretch,J),un=Hd(wt.stretch-Me,ve,D,t.left),Cn=Wd(wt.fixed-Pe,Ke,wt.stretch,G),nn=Hd(Lt.stretch-Se,Le,R,t.top),Wn=Wd(Lt.fixed-Ze,_t,Lt.stretch,J),Ar=new dt(Vt,tn),Sr=new dt(un,tn),Tr=new dt(un,nn),Kn=new dt(Vt,nn),ci=new dt(st/_,Bn/_),ar=new dt(Cn/_,Wn/_),kr=e*Math.PI/180;if(kr){const Ai=Math.sin(kr),zi=Math.cos(kr),Vi=[zi,-Ai,Ai,zi];Ar._matMult(Vi),Sr._matMult(Vi),Kn._matMult(Vi),Tr._matMult(Vi)}const gi=ot.stretch+ot.fixed,Fi=vt.stretch+vt.fixed;return{tl:Ar,tr:Sr,bl:Kn,br:Tr,tex:{x:g.paddedRect.x+1+gi,y:g.paddedRect.y+1+Fi,w:wt.stretch+wt.fixed-gi,h:Lt.stretch+Lt.fixed-Fi},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ci,pixelOffsetBR:ar,minFontScaleX:Ke/_/D,minFontScaleY:_t/_/R,isSDF:n}};if(s&&(g.stretchX||g.stretchY)){const ot=cg(O,ce,G),vt=cg(B,xe,J);for(let wt=0;wt<ot.length-1;wt++){const Lt=ot[wt],Vt=ot[wt+1];for(let st=0;st<vt.length-1;st++)h.push(jt(Lt,vt[st],Vt,vt[st+1]))}}else h.push(jt({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:w+1},{fixed:0,stretch:T+1}));return h}function Gd(t,e,n){let s=0;for(const h of t)s+=Math.max(e,Math.min(n,h[1]))-Math.max(e,Math.min(n,h[0]));return s}function cg(t,e,n){const s=[{fixed:-1,stretch:0}];for(const[h,g]of t){const _=s[s.length-1];s.push({fixed:h-_.stretch,stretch:_.stretch}),s.push({fixed:h-_.stretch,stretch:_.stretch+(g-h)})}return s.push({fixed:e+1,stretch:n}),s}function Hd(t,e,n,s){return t/e*n+s}function Wd(t,e,n,s){return t-e*n/s}function $_(t,e,n,s){const h=e+t.positionedLines[s].lineOffset;return 0===s?n+h/2:n+(h+(e+t.positionedLines[s-1].lineOffset))/2}nh.loadGlyphRange=function(t,e,n,s,h){const g=256*e,_=g+255,w=s.transformRequest(s.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${g}-${_}`),on.Glyphs);Nr(w,(T,D)=>{if(T)h(T);else if(D){const R={},O=new Ju(D).readFields(ql,{});for(const B of O.glyphs)R[B.id]=B;h(null,{glyphs:R,ascender:O.ascender,descender:O.descender})}})},nh.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:s=.25,fontFamily:h="sans-serif",fontWeight:g="normal",fontStyle:_="normal"}={}){this.buffer=e,this.cutoff=s,this.radius=n;const w=this.size=t+4*e,T=this._createCanvas(w),D=this.ctx=T.getContext("2d",{willReadFrequently:!0});D.font=`${_} ${g} ${t}px ${h}`,D.textBaseline="alphabetic",D.textAlign="left",D.fillStyle="black",this.gridOuter=new Float64Array(w*w),this.gridInner=new Float64Array(w*w),this.f=new Float64Array(w),this.z=new Float64Array(w+1),this.v=new Uint16Array(w)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:s,actualBoundingBoxLeft:h,actualBoundingBoxRight:g}=this.ctx.measureText(t),_=Math.ceil(n),w=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-h))),T=Math.min(this.size-this.buffer,_+Math.ceil(s)),D=w+2*this.buffer,R=T+2*this.buffer,O=Math.max(D*R,0),B=new Uint8ClampedArray(O),V={data:B,width:D,height:R,glyphWidth:w,glyphHeight:T,glyphTop:_,glyphLeft:0,glyphAdvance:e};if(0===w||0===T)return V;const{ctx:G,buffer:J,gridInner:ce,gridOuter:xe}=this;G.clearRect(J,J,w,T),G.fillText(t,J,J+_);const Me=G.getImageData(J,J,w,T);xe.fill(Zh,0,O),ce.fill(0,0,O);for(let ve=0;ve<T;ve++)for(let Se=0;Se<w;Se++){const Le=Me.data[4*(ve*w+Se)+3]/255;if(0===Le)continue;const Pe=(ve+J)*D+Se+J;if(1===Le)xe[Pe]=0,ce[Pe]=Zh;else{const Ke=.5-Le;xe[Pe]=Ke>0?Ke*Ke:0,ce[Pe]=Ke<0?Ke*Ke:0}}th(xe,0,0,D,R,D,this.f,this.v,this.z),th(ce,J,J,w,T,D,this.f,this.v,this.z);for(let ve=0;ve<O;ve++){const Se=Math.sqrt(xe[ve])-Math.sqrt(ce[ve]);B[ve]=Math.round(255-255*(Se/this.radius+this.cutoff))}return V}};class ug{constructor(e=[],n=hp){if(this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(let s=(this.length>>1)-1;s>=0;s--)this._down(s)}push(e){this.data.push(e),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const e=this.data[0],n=this.data.pop();return this.length--,this.length>0&&(this.data[0]=n,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:n,compare:s}=this,h=n[e];for(;e>0;){const g=e-1>>1,_=n[g];if(s(h,_)>=0)break;n[e]=_,e=g}n[e]=h}_down(e){const{data:n,compare:s}=this,h=this.length>>1,g=n[e];for(;e<h;){let _=1+(e<<1),w=n[_];const T=_+1;if(T<this.length&&s(n[T],w)<0&&(_=T,w=n[T]),s(w,g)>=0)break;n[e]=w,e=_}n[e]=g}}function hp(t,e){return t<e?-1:t>e?1:0}function G_(t,e=1,n=!1){let s=1/0,h=1/0,g=-1/0,_=-1/0;const w=t[0];for(let V=0;V<w.length;V++){const G=w[V];(!V||G.x<s)&&(s=G.x),(!V||G.y<h)&&(h=G.y),(!V||G.x>g)&&(g=G.x),(!V||G.y>_)&&(_=G.y)}const T=Math.min(g-s,_-h);let D=T/2;const R=new ug([],dp);if(0===T)return new dt(s,h);for(let V=s;V<g;V+=T)for(let G=h;G<_;G+=T)R.push(new rh(V+D,G+D,D,t));let O=function(V){let G=0,J=0,ce=0;const xe=V[0];for(let Me=0,ve=xe.length,Se=ve-1;Me<ve;Se=Me++){const Le=xe[Me],Pe=xe[Se],Ke=Le.x*Pe.y-Pe.x*Le.y;J+=(Le.x+Pe.x)*Ke,ce+=(Le.y+Pe.y)*Ke,G+=3*Ke}return new rh(J/G,ce/G,0,V)}(t),B=R.length;for(;R.length;){const V=R.pop();(V.d>O.d||!O.d)&&(O=V,n&&console.log("found best %d after %d probes",Math.round(1e4*V.d)/1e4,B)),V.max-O.d<=e||(D=V.h/2,R.push(new rh(V.p.x-D,V.p.y-D,D,t)),R.push(new rh(V.p.x+D,V.p.y-D,D,t)),R.push(new rh(V.p.x-D,V.p.y+D,D,t)),R.push(new rh(V.p.x+D,V.p.y+D,D,t)),B+=4)}return n&&(console.log(`num probes: ${B}`),console.log(`best distance: ${O.d}`)),O.p}function dp(t,e){return e.max-t.max}function rh(t,e,n,s){this.p=new dt(t,e),this.h=n,this.d=function(h,g){let _=!1,w=1/0;for(let T=0;T<g.length;T++){const D=g[T];for(let R=0,O=D.length,B=O-1;R<O;B=R++){const V=D[R],G=D[B];V.y>h.y!=G.y>h.y&&h.x<(G.x-V.x)*(h.y-V.y)/(G.y-V.y)+V.x&&(_=!_),w=Math.min(w,Rh(h,V,G))}}return(_?1:-1)*Math.sqrt(w)}(this.p,s),this.max=this.d+this.h*Math.SQRT2}const fp=Number.POSITIVE_INFINITY,H_=Math.sqrt(2);function hg(t,[e,n]){let s=0,h=0;if(n===fp){e<0&&(e=0);const g=e/H_;switch(t){case"top-right":case"top-left":h=g-7;break;case"bottom-right":case"bottom-left":h=7-g;break;case"bottom":h=7-e;break;case"top":h=e-7}switch(t){case"top-right":case"bottom-right":s=-g;break;case"top-left":case"bottom-left":s=g;break;case"left":s=e;break;case"right":s=-e}}else{switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":h=n-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-n}switch(t){case"top-right":case"bottom-right":case"right":s=-e;break;case"top-left":case"bottom-left":case"left":s=e}}return[s,h]}function W_(t,e,n,s,h,g,_,w,T,D){t.createArrays(),t.tilePixelRatio=er/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const R=t.layers[0].layout,O=t.layers[0]._unevaluatedLayout._values,B={};if("composite"===t.textSizeData.kind){const{minZoom:J,maxZoom:ce}=t.textSizeData;B.compositeTextSizes=[O["text-size"].possiblyEvaluate(new He(J),w),O["text-size"].possiblyEvaluate(new He(ce),w)]}if("composite"===t.iconSizeData.kind){const{minZoom:J,maxZoom:ce}=t.iconSizeData;B.compositeIconSizes=[O["icon-size"].possiblyEvaluate(new He(J),w),O["icon-size"].possiblyEvaluate(new He(ce),w)]}B.layoutTextSize=O["text-size"].possiblyEvaluate(new He(T+1),w),B.layoutIconSize=O["icon-size"].possiblyEvaluate(new He(T+1),w),B.textMaxSize=O["text-size"].possiblyEvaluate(new He(18),w);const V="map"===R.get("text-rotation-alignment")&&"point"!==R.get("symbol-placement"),G=R.get("text-size");for(const J of t.features){const ce=R.get("text-font").evaluate(J,{},w).join(","),xe=G.evaluate(J,{},w),Me=B.layoutTextSize.evaluate(J,{},w),ve=(B.layoutIconSize.evaluate(J,{},w),{horizontal:{},vertical:void 0}),Se=J.text;let Le,Pe=[0,0];if(Se){const _t=Se.toString(),jt=R.get("text-letter-spacing").evaluate(J,{},w)*vs,ot=R.get("text-line-height").evaluate(J,{},w)*vs,vt=d(_t)?jt:0,wt=R.get("text-anchor").evaluate(J,{},w),Lt=R.get("text-variable-anchor");if(!Lt){const un=R.get("text-radial-offset").evaluate(J,{},w);Pe=un?hg(wt,[un*vs,fp]):R.get("text-offset").evaluate(J,{},w).map(Cn=>Cn*vs)}let Vt=V?"center":R.get("text-justify").evaluate(J,{},w);const st="point"===R.get("symbol-placement"),tn=st?R.get("text-max-width").evaluate(J,{},w)*vs:1/0,Bn=un=>{t.allowVerticalPlacement&&f(_t)&&(ve.vertical=ap(Se,e,n,h,ce,tn,ot,wt,un,vt,Pe,Za.vertical,!0,Me,xe))};if(!V&&Lt){const un="auto"===Vt?Lt.map(nn=>pp(nn)):[Vt];let Cn=!1;for(let nn=0;nn<un.length;nn++){const Wn=un[nn];if(!ve.horizontal[Wn])if(Cn)ve.horizontal[Wn]=ve.horizontal[0];else{const Ar=ap(Se,e,n,h,ce,tn,ot,"center",Wn,vt,Pe,Za.horizontal,!1,Me,xe);Ar&&(ve.horizontal[Wn]=Ar,Cn=1===Ar.positionedLines.length)}}Bn("left")}else{if("auto"===Vt&&(Vt=pp(wt)),st||R.get("text-writing-mode").indexOf("horizontal")>=0||!f(_t)){const un=ap(Se,e,n,h,ce,tn,ot,wt,Vt,vt,Pe,Za.horizontal,!1,Me,xe);un&&(ve.horizontal[Vt]=un)}Bn(st?"left":Vt)}}let Ke=!1;if(J.icon&&J.icon.name){const _t=s[J.icon.name];_t&&(Le=rg(h[J.icon.name],R.get("icon-offset").evaluate(J,{},w),R.get("icon-anchor").evaluate(J,{},w)),Ke=_t.sdf,void 0===t.sdfIcons?t.sdfIcons=_t.sdf:t.sdfIcons!==_t.sdf&&vr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(_t.pixelRatio!==t.pixelRatio||0!==R.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const Ze=dg(ve.horizontal)||ve.vertical;t.iconsInText||(t.iconsInText=!!Ze&&Ze.iconsInText),(Ze||Le)&&q_(t,J,ve,Le,s,B,Me,0,Pe,Ke,_,w,D)}g&&t.generateCollisionDebugBuffers(T,t.collisionBoxArray)}function pp(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function q_(t,e,n,s,h,g,_,w,T,D,R,O,B){let V=g.textMaxSize.evaluate(e,{},O);void 0===V&&(V=_);const G=t.layers[0].layout,J=G.get("icon-offset").evaluate(e,{},O),ce=dg(n.horizontal)||n.vertical,xe="globe"===B.name,Me=_/24,ve=t.tilePixelRatio*V/24,Se=(vt=t.overscaling,t.zoom>18&&vt>2&&(vt>>=1),Math.max(er/(512*vt),1)*G.get("symbol-spacing")),Le=G.get("text-padding")*t.tilePixelRatio,Pe=G.get("icon-padding")*t.tilePixelRatio,Ke=Ne(G.get("text-max-angle")),Ze="map"===G.get("text-rotation-alignment")&&"point"!==G.get("symbol-placement"),_t="map"===G.get("icon-rotation-alignment")&&"point"!==G.get("symbol-placement"),jt=G.get("symbol-placement"),ot=Se/2;var vt;const wt=G.get("icon-text-fit");let Lt;s&&"none"!==wt&&(t.allowVerticalPlacement&&n.vertical&&(Lt=cp(s,n.vertical,wt,G.get("icon-text-fit-padding"),J,Me)),ce&&(s=cp(s,ce,wt,G.get("icon-text-fit-padding"),J,Me)));const Vt=(st,tn,Bn)=>{if(tn.x<0||tn.x>=er||tn.y<0||tn.y>=er)return;let un=null;if(xe){const{x:Cn,y:nn,z:Wn}=B.projectTilePoint(tn.x,tn.y,Bn);un={anchor:new Al(Cn,nn,Wn,0,void 0),up:B.upVector(Bn,tn.x,tn.y)}}!function(Cn,nn,Wn,Ar,Sr,Tr,Kn,ci,ar,kr,gi,Fi,Ai,zi,Vi,fo,ws,ui,Fo,Co,qr,Ki,Ho,_i,xo){const zs=Cn.addToLineVertexArray(nn,Ar);let es,ts,Xs,ns,Yl,Iu,lh,ch=0,jp=0,Vp=0,Qc=0,$p=-1,Gp=-1;const va={};let ty=lu("");const Mc=Wn?Wn.anchor:nn;let Eg=0,rf=0;if(void 0===ar._unevaluatedLayout.getValue("text-radial-offset")?[Eg,rf]=ar.layout.get("text-offset").evaluate(qr,{},xo).map(La=>La*vs):(Eg=ar.layout.get("text-radial-offset").evaluate(qr,{},xo)*vs,rf=fp),Cn.allowVerticalPlacement&&Sr.vertical){const La=Sr.vertical;if(Vi)Iu=qd(La),ci&&(lh=qd(ci));else{const Oa=ar.layout.get("text-rotate").evaluate(qr,{},xo)+90;Xs=gp(kr,Mc,nn,gi,Fi,Ai,La,zi,Oa,fo),ci&&(ns=gp(kr,Mc,nn,gi,Fi,Ai,ci,ui,Oa))}}if(Tr){const La=ar.layout.get("icon-rotate").evaluate(qr,{},xo),Oa="none"!==ar.layout.get("icon-text-fit"),id=lg(Tr,La,Ho,Oa),eu=ci?lg(ci,La,Ho,Oa):void 0;ts=gp(kr,Mc,nn,gi,Fi,Ai,Tr,ui,La),ch=4*id.length;const Dg=Cn.iconSizeData;let Jl=null;"source"===Dg.kind?(Jl=[ul*ar.layout.get("icon-size").evaluate(qr,{},xo)],Jl[0]>xc&&vr(`${Cn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===Dg.kind&&(Jl=[ul*Ki.compositeIconSizes[0].evaluate(qr,{},xo),ul*Ki.compositeIconSizes[1].evaluate(qr,{},xo)],(Jl[0]>xc||Jl[1]>xc)&&vr(`${Cn.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),Cn.addSymbols(Cn.icon,id,Jl,Co,Fo,qr,!1,Wn,nn,zs.lineStartIndex,zs.lineLength,-1,_i,xo),$p=Cn.icon.placedSymbolArray.length-1,eu&&(jp=4*eu.length,Cn.addSymbols(Cn.icon,eu,Jl,Co,Fo,qr,Za.vertical,Wn,nn,zs.lineStartIndex,zs.lineLength,-1,_i,xo),Gp=Cn.icon.placedSymbolArray.length-1)}for(const La in Sr.horizontal){const Oa=Sr.horizontal[La];es||(ty=lu(Oa.text),Vi?Yl=qd(Oa):es=gp(kr,Mc,nn,gi,Fi,Ai,Oa,zi,ar.layout.get("text-rotate").evaluate(qr,{},xo),fo));const id=1===Oa.positionedLines.length;if(Vp+=mp(Cn,Wn,nn,Oa,Kn,ar,Vi,qr,fo,zs,Sr.vertical?Za.horizontal:Za.horizontalOnly,id?Object.keys(Sr.horizontal):[La],va,$p,Ki,_i,xo),id)break}Sr.vertical&&(Qc+=mp(Cn,Wn,nn,Sr.vertical,Kn,ar,Vi,qr,fo,zs,Za.vertical,["vertical"],va,Gp,Ki,_i,xo));let Ic=-1;const Tg=(La,Oa)=>La?Math.max(La,Oa):Oa;Ic=Tg(Yl,Ic),Ic=Tg(Iu,Ic),Ic=Tg(lh,Ic);const hr=Ic>-1?1:0;Cn.glyphOffsetArray.length>=Jc.MAX_GLYPHS&&vr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==qr.sortKey&&Cn.addToSortKeyRanges(Cn.symbolInstances.length,qr.sortKey),Cn.symbolInstances.emplaceBack(Mc.x,Mc.y,Mc.z,nn.x,nn.y,va.right>=0?va.right:-1,va.center>=0?va.center:-1,va.left>=0?va.left:-1,va.vertical>=0?va.vertical:-1,$p,Gp,ty,void 0!==es?es:Cn.collisionBoxArray.length,void 0!==es?es+1:Cn.collisionBoxArray.length,void 0!==Xs?Xs:Cn.collisionBoxArray.length,void 0!==Xs?Xs+1:Cn.collisionBoxArray.length,void 0!==ts?ts:Cn.collisionBoxArray.length,void 0!==ts?ts+1:Cn.collisionBoxArray.length,ns||Cn.collisionBoxArray.length,ns?ns+1:Cn.collisionBoxArray.length,gi,Vp,Qc,ch,jp,hr,0,Eg,rf,Ic)}(t,tn,un,st,n,s,h,Lt,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,Le,Ze,T,0,Pe,_t,J,e,g,D,R,O)};if("line"===jt)for(const st of og(e.geometry,0,0,er,er)){const tn=ig(st,Se,Ke,n.vertical||ce,s,24,ve,t.overscaling,er);for(const Bn of tn)ce&&jy(t,ce.text,ot,Bn)||Vt(st,Bn,O)}else if("line-center"===jt){for(const st of e.geometry)if(st.length>1){const tn=V_(st,Ke,n.vertical||ce,s,24,ve);tn&&Vt(st,tn,O)}}else if("Polygon"===e.type)for(const st of qa(e.geometry,0)){const tn=G_(st,16);Vt(st[0],new Al(tn.x,tn.y,0,0,void 0),O)}else if("LineString"===e.type)for(const st of e.geometry)Vt(st,new Al(st[0].x,st[0].y,0,0,void 0),O);else if("Point"===e.type)for(const st of e.geometry)for(const tn of st)Vt([tn],new Al(tn.x,tn.y,0,0,void 0),O)}const xc=32640;function mp(t,e,n,s,h,g,_,w,T,D,R,O,B,V,G,J,ce){const xe=function(Se,Le,Pe,Ke,Ze,_t,jt,ot){const vt=[];if(0===Le.positionedLines.length)return vt;const wt=Ke.layout.get("text-rotate").evaluate(_t,{})*Math.PI/180,Lt=function(un){const Cn=un[0],nn=un[1],Wn=Cn*nn;return Wn>0?[Cn,-nn]:Wn<0?[-Cn,nn]:0===Cn?[nn,Cn]:[nn,-Cn]}(Pe);let Vt=Math.abs(Le.top-Le.bottom);for(const un of Le.positionedLines)Vt-=un.lineOffset;const st=Le.positionedLines.length,tn=Vt/st;let Bn=Le.top-Pe[1];for(let un=0;un<st;++un){const Cn=Le.positionedLines[un];Bn=$_(Le,tn,Bn,un);for(const nn of Cn.positionedGlyphs){if(!nn.rect)continue;const Wn=nn.rect||{};let Ar=4,Sr=!0,Tr=1,Kn=0;if(nn.imageName){const _i=jt[nn.imageName];if(!_i)continue;if(_i.sdf){vr("SDF images are not supported in formatted text and will be ignored.");continue}Sr=!1,Tr=_i.pixelRatio,Ar=1/Tr}const ci=(Ze||ot)&&nn.vertical,ar=nn.metrics.advance*nn.scale/2,kr=nn.metrics,gi=nn.rect;if(null===gi)continue;ot&&Le.verticalizable&&(Kn=nn.imageName?ar-nn.metrics.width*nn.scale/2:0);const Fi=Ze?[nn.x+ar,nn.y]:[0,0];let Ai=[0,0],zi=[0,0],Vi=!1;Ze||(ci?(zi=[nn.x+ar+Lt[0],nn.y+Lt[1]-Kn],Vi=!0):Ai=[nn.x+ar+Pe[0],nn.y+Pe[1]-Kn]);const fo=gi.w*nn.scale/(Tr*(nn.localGlyph?2:1)),ws=gi.h*nn.scale/(Tr*(nn.localGlyph?2:1));let ui,Fo,Co,qr;if(ci){const _i=nn.y-Bn,xo=new dt(-ar,ar-_i),zs=-Math.PI/2,es=new dt(...zi);ui=new dt(-ar+Ai[0],Ai[1]),ui._rotateAround(zs,xo)._add(es),ui.x+=-_i+ar,ui.y-=(kr.left-Ar)*nn.scale;const ts=nn.imageName?kr.advance*nn.scale:vs*nn.scale,Xs=String.fromCharCode(nn.glyph);Ym(Xs)?ui.x+=(1-Ar)*nn.scale:R_(Xs)?ui.x+=ts-kr.height*nn.scale+(-Ar-1)*nn.scale:ui.x+=nn.imageName||kr.width+2*Ar===gi.w&&kr.height+2*Ar===gi.h?(ts-ws)/2:(ts-(kr.height+2*Ar)*nn.scale)/2,Fo=new dt(ui.x,ui.y-fo),Co=new dt(ui.x+ws,ui.y),qr=new dt(ui.x+ws,ui.y-fo)}else{const _i=(kr.left-Ar)*nn.scale-ar+Ai[0],xo=(-kr.top-Ar)*nn.scale+Ai[1],zs=_i+fo,es=xo+ws;ui=new dt(_i,xo),Fo=new dt(zs,xo),Co=new dt(_i,es),qr=new dt(zs,es)}if(wt){let _i;_i=Ze?new dt(0,0):Vi?new dt(Lt[0],Lt[1]):new dt(Pe[0],Pe[1]),ui._rotateAround(wt,_i),Fo._rotateAround(wt,_i),Co._rotateAround(wt,_i),qr._rotateAround(wt,_i)}const Ki=new dt(0,0),Ho=new dt(0,0);vt.push({tl:ui,tr:Fo,bl:Co,br:qr,tex:Wn,writingMode:Le.writingMode,glyphOffset:Fi,sectionIndex:nn.sectionIndex,isSDF:Sr,pixelOffsetTL:Ki,pixelOffsetBR:Ho,minFontScaleX:0,minFontScaleY:0})}}return vt}(0,s,T,g,_,w,h,t.allowVerticalPlacement),Me=t.textSizeData;let ve=null;"source"===Me.kind?(ve=[ul*g.layout.get("text-size").evaluate(w,{},ce)],ve[0]>xc&&vr(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===Me.kind&&(ve=[ul*G.compositeTextSizes[0].evaluate(w,{},ce),ul*G.compositeTextSizes[1].evaluate(w,{},ce)],(ve[0]>xc||ve[1]>xc)&&vr(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,xe,ve,T,_,w,R,e,n,D.lineStartIndex,D.lineLength,V,J,ce);for(const Se of O)B[Se]=t.text.placedSymbolArray.length-1;return 4*xe.length}function dg(t){for(const e in t)return t[e];return null}function gp(t,e,n,s,h,g,_,w,T,D){let R=_.top,O=_.bottom,B=_.left,V=_.right;const G=_.collisionPadding;if(G&&(B-=G[0],R-=G[1],V+=G[2],O+=G[3]),T){const J=new dt(B,R),ce=new dt(V,R),xe=new dt(B,O),Me=new dt(V,O),ve=Ne(T);let Se=new dt(0,0);D&&(Se=new dt(D[0],D[1])),J._rotateAround(ve,Se),ce._rotateAround(ve,Se),xe._rotateAround(ve,Se),Me._rotateAround(ve,Se),B=Math.min(J.x,ce.x,xe.x,Me.x),V=Math.max(J.x,ce.x,xe.x,Me.x),R=Math.min(J.y,ce.y,xe.y,Me.y),O=Math.max(J.y,ce.y,xe.y,Me.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,B,R,V,O,w,s,h,g),t.length-1}function qd(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function jy(t,e,n,s){const h=t.compareText;if(e in h){const g=h[e];for(let _=g.length-1;_>=0;_--)if(s.dist(g[_])<n)return!0}else h[e]=[];return h[e].push(s),!1}function Xh(t,e){const n=t.fovAboveCenter,s=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,h=(t._camera.position[2]*t.worldSize-s)/Math.cos(t._pitch),g=Math.sin(n)*h/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),_=Math.sin(t._pitch)*g+h;return Math.min(1.01*_,h*(1/t._horizonShift))}function bu(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),s=t.x*n,h=(t.x+1)*n,g=t.y*n,_=(t.y+1)*n,w=Wa(s),T=Wa(h),D=Os(g),R=Os(_),O=e.project(w,D),B=e.project(T,D),V=e.project(T,R),G=e.project(w,R);let J=Math.min(O.x,B.x,V.x,G.x),ce=Math.min(O.y,B.y,V.y,G.y),xe=Math.max(O.x,B.x,V.x,G.x),Me=Math.max(O.y,B.y,V.y,G.y);const ve=n/16;function Se(Pe,Ke,Ze,_t,jt,ot){const vt=(Ze+jt)/2,wt=(_t+ot)/2,Lt=e.project(Wa(vt),Os(wt)),Vt=Math.max(0,J-Lt.x,ce-Lt.y,Lt.x-xe,Lt.y-Me);J=Math.min(J,Lt.x),xe=Math.max(xe,Lt.x),ce=Math.min(ce,Lt.y),Me=Math.max(Me,Lt.y),Vt>ve&&(Se(Pe,Lt,Ze,_t,vt,wt),Se(Lt,Ke,vt,wt,jt,ot))}Se(O,B,s,g,h,g),Se(B,V,h,g,h,_),Se(V,G,h,_,s,_),Se(G,O,s,_,s,g),J-=ve,ce-=ve,xe+=ve,Me+=ve;const Le=1/Math.max(xe-J,Me-ce);return{scale:Le,x:J*Le,y:ce*Le,x2:xe*Le,y2:Me*Le,projection:e}}const Z_=Aa(new Float32Array(16));class Xl{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,n){return{x:0,y:0,z:0}}unproject(e,n){return new Vr(0,0)}projectTilePoint(e,n,s){return{x:e,y:n,z:0}}locationPoint(e,n,s=!0){return e._coordinatePoint(e.locationCoordinate(n),s)}pixelsPerMeter(e,n){return Il(1,e)*n}pixelSpaceConversion(e,n,s){return 1}farthestPixelDistance(e){return Xh(e,e.pixelsPerMeter)}pointCoordinate(e,n,s,h){const g=e.horizonLineFromTop(!1),_=new dt(n,Math.max(g,s));return e.rayIntersectionCoordinate(e.pointRayIntersection(_,h))}pointCoordinate3D(e,n,s){const h=new dt(n,s);if(e.elevation)return e.elevation.pointCoordinate(h);{const g=this.pointCoordinate(e,h.x,h.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(e,n){if(e.elevation)return!this.pointCoordinate3D(e,n.x,n.y);const s=e.horizonLineFromTop();return n.y<s}createInversionMatrix(e,n){return Z_}createTileMatrix(e,n,s){let h,g,_;const w=s.canonical,T=Aa(new Float64Array(16));if(this.isReprojectedInTileSpace){const D=bu(w,this);h=1,g=D.x+s.wrap*D.scale,_=D.y,$c(T,T,[h/D.scale,h/D.scale,e.pixelsPerMeter/n])}else h=n/e.zoomScale(w.z),g=(w.x+Math.pow(2,w.z)*s.wrap)*h,_=w.y*h;return Bu(T,T,[g,_,0]),$c(T,T,[h/er,h/er,1]),T}upVector(e,n,s){return[0,0,1]}upVectorScale(e,n,s){return{metersToTile:1}}}class X_ extends Xl{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[n,s]=this.parallels=e.parallels||[29.5,45.5],h=Math.sin(Ne(n));this.n=(h+Math.sin(Ne(s)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(e,n){const{n:s,c:h,r0:g}=this,_=Ne(e-this.center[0]),w=Ne(n),T=Math.sqrt(h-2*s*Math.sin(w))/s;return{x:T*Math.sin(_*s),y:T*Math.cos(_*s)-g,z:0}}unproject(e,n){const{n:s,c:h,r0:g}=this,_=g+n;let w=Math.atan2(e,Math.abs(_))*Math.sign(_);_*s<0&&(w-=Math.PI*Math.sign(e)*Math.sign(_));const T=Ne(this.center[0])*s;w=mn(w,-Math.PI-T,Math.PI-T);const D=$t(mt(w/s)+this.center[0],-180,180),R=Math.asin($t((h-(e*e+_*_)*s*s)/(2*s),-1,1)),O=$t(mt(R),-ys,ys);return new Vr(D,O)}}const ka=1.340264,wc=-.081106,Qo=893e-6,Pl=.003796,Eu=Math.sqrt(3)/2;class hl extends Xl{project(e,n){n=n/180*Math.PI,e=e/180*Math.PI;const s=Math.asin(Eu*Math.sin(n)),h=s*s,g=h*h*h;return{x:.5*(e*Math.cos(s)/(Eu*(ka+3*wc*h+g*(7*Qo+9*Pl*h)))/Math.PI+.5),y:1-.5*(s*(ka+wc*h+g*(Qo+Pl*h))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,h=s*s,g=h*h*h;for(let R,O,B,V=0;V<12&&(O=s*(ka+wc*h+g*(Qo+Pl*h))-n,B=ka+3*wc*h+g*(7*Qo+9*Pl*h),R=O/B,s=$t(s-R,-Math.PI/3,Math.PI/3),h=s*s,g=h*h*h,!(Math.abs(R)<1e-12));++V);const _=Eu*e*(ka+3*wc*h+g*(7*Qo+9*Pl*h))/Math.cos(s),w=Math.asin(Math.sin(s)/Eu),T=$t(180*_/Math.PI,-180,180),D=$t(180*w/Math.PI,-ys,ys);return new Vr(T,D)}}class _p extends Xl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){return{x:.5+e/360,y:.5-n/360,z:0}}unproject(e,n){const s=360*(e-.5),h=$t(360*(.5-n),-ys,ys);return new Vr(s,h)}}const Rl=Math.PI/2;function bc(t){return Math.tan((Rl+t)/2)}class ih extends Xl{constructor(e){super(e),this.center=e.center||[0,30];const[n,s]=this.parallels=e.parallels||[30,30];let h=Ne(n),g=Ne(s);this.southernCenter=h+g<0,this.southernCenter&&(h=-h,g=-g);const _=Math.cos(h),w=bc(h);this.n=h===g?Math.sin(h):Math.log(_/Math.cos(g))/Math.log(bc(g)/w),this.f=_*Math.pow(bc(h),this.n)/this.n}project(e,n){n=Ne(n),this.southernCenter&&(n=-n),e=Ne(e-this.center[0]);const s=1e-6,{n:h,f:g}=this;g>0?n<-Rl+s&&(n=-Rl+s):n>Rl-s&&(n=Rl-s);const _=g/Math.pow(bc(n),h);let w=_*Math.sin(h*e),T=g-_*Math.cos(h*e);return w=.5*(w/Math.PI+.5),T=.5*(T/Math.PI+.5),{x:w,y:this.southernCenter?T:1-T,z:0}}unproject(e,n){e=(2*e-.5)*Math.PI,this.southernCenter&&(n=1-n),n=(2*(1-n)-.5)*Math.PI;const{n:s,f:h}=this,g=h-n,_=Math.sign(g),w=Math.sign(s)*Math.sqrt(e*e+g*g);let T=Math.atan2(e,Math.abs(g))*_;g*s<0&&(T-=Math.PI*Math.sign(e)*_);const D=$t(mt(T/s)+this.center[0],-180,180),R=$t(mt(2*Math.atan(Math.pow(h/w,1/s))-Rl),-ys,ys);return new Vr(D,this.southernCenter?-R:R)}}class Tu extends Xl{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,n){return{x:Sl(e),y:Ml(n),z:0}}unproject(e,n){const s=Wa(e),h=Os(n);return new Vr(s,h)}}const Du=Ne(ys);class oh extends Xl{project(e,n){const s=(n=Ne(n))*n,h=s*s;return{x:.5*((e=Ne(e))*(.8707-.131979*s+h*(h*(.003971*s-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(n*(1.007226+s*(.015085+h*(.028874*s-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(e,n){e=(2*e-.5)*Math.PI;let s=n=(2*(1-n)-1)*Math.PI,h=25,g=0,_=s*s;do{_=s*s;const D=_*_;g=(s*(1.007226+_*(.015085+D*(.028874*_-.044475-.005916*D)))-n)/(1.007226+_*(.045255+D*(.259866*_-.311325-.005916*11*D))),s=$t(s-g,-Du,Du)}while(Math.abs(g)>1e-6&&--h>0);_=s*s;const w=$t(mt(e/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),T=mt(s);return new Vr(w,T)}}const Cu=Ne(ys);class sh extends Xl{project(e,n){n=Ne(n),e=Ne(e);const s=Math.cos(n),h=2/Math.PI,g=Math.acos(s*Math.cos(e/2)),_=Math.sin(g)/g,w=.5*(e*h+2*s*Math.sin(e/2)/_)||0,T=.5*(n+Math.sin(n)/_)||0;return{x:.5*(w/Math.PI+.5),y:1-.5*(T/Math.PI+1),z:0}}unproject(e,n){let s=e=(2*e-.5)*Math.PI,h=n=(2*(1-n)-1)*Math.PI,g=25;const _=1e-6;let w=0,T=0;do{const D=Math.cos(h),R=Math.sin(h),O=2*R*D,B=R*R,V=D*D,G=Math.cos(s/2),J=Math.sin(s/2),ce=2*G*J,xe=J*J,Me=1-V*G*G,ve=Me?1/Me:0,Se=Me?Math.acos(D*G)*Math.sqrt(1/Me):0,Le=.5*(2*Se*D*J+2*s/Math.PI)-e,Pe=.5*(Se*R+h)-n,Ke=.5*ve*(V*xe+Se*D*G*B)+1/Math.PI,Ze=ve*(ce*O/4-Se*R*J),_t=.125*ve*(O*J-Se*R*V*ce),jt=.5*ve*(B*G+Se*xe*D)+.5,ot=Ze*_t-jt*Ke;w=(Pe*Ze-Le*jt)/ot,T=(Le*_t-Pe*Ke)/ot,s=$t(s-w,-Math.PI,Math.PI),h=$t(h-T,-Cu,Cu)}while((Math.abs(w)>_||Math.abs(T)>_)&&--g>0);return new Vr(mt(s),mt(h))}}class Su extends Xl{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ne(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,n){const{scale:s,cosPhi:h}=this;return{x:Ne(e)*h*s+.5,y:-Math.sin(Ne(n))/h*s+.5,z:0}}unproject(e,n){const{scale:s,cosPhi:h}=this,g=-(n-.5)/s,_=$t(mt((e-.5)/s)/h,-180,180),w=Math.asin($t(g*h,-1,1)),T=$t(mt(w),-ys,ys);return new Vr(_,T)}}class fg extends Tu{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,n,s){const h=pu(e,n,s);return vo(h,h,ju(Ls(s))),{x:h[0],y:h[1],z:h[2]}}locationPoint(e,n){const s=Hc(n.lat,n.lng),h=_s([],s),g=e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(n),e._centerAltitude):e._centerAltitude;Nu(s,s,h,Il(1,0)*er*g);const _=Aa(new Float64Array(16));return Vc(_,e.pixelMatrix,e.globeMatrix),vo(s,s,_),new dt(s[0],s[1])}pixelsPerMeter(e,n){return Il(1,0)*n}pixelSpaceConversion(e,n,s){const h=Il(1,e)*n,g=Jn(Il(1,45)*n,h,s);return this.pixelsPerMeter(e,n)/g}createTileMatrix(e,n,s){const h=Sf(Ls(s.canonical));return Vc(new Float64Array(16),e.globeMatrix,h)}createInversionMatrix(e,n){const{center:s}=e,h=ju(Ls(n));return _h(h,h,Ne(s.lng)),gh(h,h,Ne(s.lat)),$c(h,h,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(e,n,s,h){return vm(e,n,s,!0)||new Ih(0,0)}pointCoordinate3D(e,n,s){const h=this.pointCoordinate(e,n,s,0);return[h.x,h.y,h.z]}isPointAboveHorizon(e,n){return!vm(e,n.x,n.y,!1)}farthestPixelDistance(e){const n=function(h,g){const _=h.cameraToCenterDistance,w=h._centerAltitude*g,T=h._camera,D=h._camera.forward(),R=dc([],Pa([],D,-_),[0,0,w]),O=h.worldSize/(2*Math.PI),B=[0,0,-O],V=h.width/h.height,G=Math.tan(h.fovAboveCenter),J=Pa([],T.up(),G),ce=Pa([],T.right(),G*V),xe=_s([],dc([],dc([],D,J),ce)),Me=[];let ve;if(new $l(R,xe).closestPointOnSphere(B,O,Me)){const Se=dc([],Me,B),Le=Tl([],Se,R);ve=Math.cos(h.fovAboveCenter)*du(Le)}else{const Se=Tl([],R,B),Le=Tl([],B,R);_s(Le,Le);const Pe=du(Se)-O;ve=Math.sqrt(Pe*(Pe+2*O));const Ke=Math.acos(ve/(O+Pe))-Math.acos(Ra(D,Le));ve*=Math.cos(Ke)}return 1.01*ve}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),s=Vu(e.zoom);if(s>0){const h=Xh(e,Il(1,e.center.lat)*e.worldSize),g=e.worldSize/(2*Math.PI),_=Math.max(e.width,e.height)/e.worldSize*Math.PI;return Jn(n,h+g*(1-Math.cos(_)),Math.pow(s,10))}return n}upVector(e,n,s){return pu(n,s,e,1)}upVectorScale(e){return{metersToTile:gd(Cf(Ls(e)))}}}function yp(t){const e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Tu(t);case"equirectangular":return new _p(t);case"naturalEarth":return new oh(t);case"equalEarth":return new hl(t);case"winkelTripel":return new sh(t);case"albers":return n?new Su(t):new X_(t);case"lambertConformalConic":return n?new Su(t):new ih(t);case"globe":return new fg(t)}throw new Error(`Invalid projection name: ${t.name}`)}const pg=Bh.types,mg=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Kh(t,e,n,s,h,g,_,w,T,D,R,O,B){const V=w?Math.min(xc,Math.round(w[0])):0,G=w?Math.min(xc,Math.round(w[1])):0;t.emplaceBack(e,n,Math.round(32*s),Math.round(32*h),g,_,(V<<1)+(T?1:0),G,16*D,16*R,256*O,256*B)}function Yh(t,e,n,s,h,g,_){t.emplaceBack(e,n,s,h,g,_)}function Jh(t,e,n,s,h){t.emplaceBack(e,n,s,h),t.emplaceBack(e,n,s,h),t.emplaceBack(e,n,s,h),t.emplaceBack(e,n,s,h)}function gg(t){for(const e of t.sections)if(U(e.text))return!0;return!1}class Zd{constructor(e){this.layoutVertexArray=new jl,this.indexArray=new gs,this.programConfigurations=e,this.segments=new yo,this.dynamicLayoutVertexArray=new Si,this.opacityVertexArray=new Mi,this.placedSymbolArray=new tm,this.globeExtVertexArray=new Gi}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(e,n,s,h){this.isEmpty()||(s&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,A_.members),this.indexBuffer=e.createIndexBuffer(this.indexArray,n),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,Ku.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,mg,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,Ld.members,!0)),this.opacityVertexBuffer.itemSize=1),(s||h)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}fn(Zd,"SymbolBuffers");class vp{constructor(e,n,s){this.layoutVertexArray=new e,this.layoutAttributes=n,this.indexArray=new s,this.segments=new yo,this.collisionVertexArray=new Ei,this.collisionVertexArrayExt=new ms}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,Qf.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,jh.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}fn(vp,"CollisionBuffers");class Jc{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(_=>_.id),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Aa([]),this.placementViewportMatrix=Aa([]);const n=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Vh(this.zoom,n["text-size"]),this.iconSizeData=Vh(this.zoom,n["icon-size"]);const s=this.layers[0].layout,h=s.get("symbol-sort-key"),g=s.get("symbol-z-order");this.canOverlap=s.get("text-allow-overlap")||s.get("icon-allow-overlap")||s.get("text-ignore-placement")||s.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==g&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===g||"auto"===g&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=s.get("text-writing-mode").map(_=>Za[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=e.sourceID,this.projection=e.projection}createArrays(){this.text=new Zd(new hu(this.layers,this.zoom,e=>/^text/.test(e))),this.icon=new Zd(new hu(this.layers,this.zoom,e=>/^icon/.test(e))),this.glyphOffsetArray=new ad,this.lineVertexArray=new hf,this.symbolInstances=new ma}calculateGlyphDependencies(e,n,s,h,g){for(let _=0;_<e.length;_++)if(n[e.charCodeAt(_)]=!0,h&&g){const w=$h[e.charAt(_)];w&&(n[w.charCodeAt(0)]=!0)}}populate(e,n,s,h){const g=this.layers[0],_=g.layout,w="globe"===this.projection.name,T=_.get("text-font"),D=_.get("text-field"),R=_.get("icon-image"),O=("constant"!==D.value.kind||D.value.value instanceof Wi&&!D.value.value.isEmpty()||D.value.value.toString().length>0)&&("constant"!==T.value.kind||T.value.value.length>0),B="constant"!==R.value.kind||!!R.value.value||Object.keys(R.parameters).length>0,V=_.get("symbol-sort-key");if(this.features=[],!O&&!B)return;const G=n.iconDependencies,J=n.glyphDependencies,ce=n.availableImages,xe=new He(this.zoom);for(const{feature:Me,id:ve,index:Se,sourceLayerIndex:Le}of e){const Pe=g._featureFilter.needGeometry,Ke=Wc(Me,Pe);if(!g._featureFilter.filter(xe,Ke,s))continue;if(Pe||(Ke.geometry=Gl(Me,s,h)),w&&1!==Me.type&&s.z<=5){const ot=Ke.geometry,vt=.98078528056,wt=(Lt,Vt)=>Ra(pu(Lt.x,Lt.y,s,1),pu(Vt.x,Vt.y,s,1))<vt;for(let Lt=0;Lt<ot.length;Lt++)ot[Lt]=Dm(ot[Lt],wt)}let Ze,_t;if(O){const ot=g.getValueAndResolveTokens("text-field",Ke,s,ce),vt=Wi.factory(ot);gg(vt)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ke()||this.hasRTLText&&Be.isParsed())&&(Ze=P_(vt,g,Ke))}if(B){const ot=g.getValueAndResolveTokens("icon-image",Ke,s,ce);_t=ot instanceof co?ot:co.fromString(ot)}if(!Ze&&!_t)continue;const jt=this.sortFeaturesByKey?V.evaluate(Ke,{},s):void 0;if(this.features.push({id:ve,text:Ze,icon:_t,index:Se,sourceLayerIndex:Le,geometry:Ke.geometry,properties:Me.properties,type:pg[Me.type],sortKey:jt}),_t&&(G[_t.name]=!0),Ze){const ot=T.evaluate(Ke,{},s).join(","),vt="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Za.vertical)>=0;for(const wt of Ze.sections)if(wt.image)G[wt.image.name]=!0;else{const Lt=f(Ze.toString()),Vt=wt.fontStack||ot,st=J[Vt]=J[Vt]||{};this.calculateGlyphDependencies(wt.text,st,vt,this.allowVerticalPlacement,Lt)}}}"line"===_.get("symbol-placement")&&(this.features=function(Me){const ve={},Se={},Le=[];let Pe=0;function Ke(ot){Le.push(Me[ot]),Pe++}function Ze(ot,vt,wt){const Lt=Se[ot];return delete Se[ot],Se[vt]=Lt,Le[Lt].geometry[0].pop(),Le[Lt].geometry[0]=Le[Lt].geometry[0].concat(wt[0]),Lt}function _t(ot,vt,wt){const Lt=ve[vt];return delete ve[vt],ve[ot]=Lt,Le[Lt].geometry[0].shift(),Le[Lt].geometry[0]=wt[0].concat(Le[Lt].geometry[0]),Lt}function jt(ot,vt,wt){const Lt=wt?vt[0][vt[0].length-1]:vt[0][0];return`${ot}:${Lt.x}:${Lt.y}`}for(let ot=0;ot<Me.length;ot++){const vt=Me[ot],wt=vt.geometry,Lt=vt.text?vt.text.toString():null;if(!Lt){Ke(ot);continue}const Vt=jt(Lt,wt),st=jt(Lt,wt,!0);if(Vt in Se&&st in ve&&Se[Vt]!==ve[st]){const tn=_t(Vt,st,wt),Bn=Ze(Vt,st,Le[tn].geometry);delete ve[Vt],delete Se[st],Se[jt(Lt,Le[Bn].geometry,!0)]=Bn,Le[tn].geometry=null}else Vt in Se?Ze(Vt,st,wt):st in ve?_t(Vt,st,wt):(Ke(ot),ve[Vt]=Pe-1,Se[st]=Pe-1)}return Le.filter(ot=>ot.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((Me,ve)=>Me.sortKey-ve.sortKey)}update(e,n,s,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(e,n,this.layers,s,h),this.icon.programConfigurations.updatePaintArrays(e,n,this.layers,s,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=yp(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,n){const s=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:h,y:g}of n)this.lineVertexArray.emplaceBack(h,g);return{lineStartIndex:s,lineLength:this.lineVertexArray.length-s}}addSymbols(e,n,s,h,g,_,w,T,D,R,O,B,V,G){const J=e.indexArray,ce=e.layoutVertexArray,xe=e.globeExtVertexArray,Me=e.segments.prepareSegment(4*n.length,ce,J,this.canOverlap?_.sortKey:void 0),ve=this.glyphOffsetArray.length,Se=Me.vertexLength,Le=this.allowVerticalPlacement&&w===Za.vertical?Math.PI/2:0,Pe=_.text&&_.text.sections;for(let Ze=0;Ze<n.length;Ze++){const{tl:_t,tr:jt,bl:ot,br:vt,tex:wt,pixelOffsetTL:Lt,pixelOffsetBR:Vt,minFontScaleX:st,minFontScaleY:tn,glyphOffset:Bn,isSDF:un,sectionIndex:Cn}=n[Ze],nn=Me.vertexLength,Wn=Bn[1];if(Kh(ce,D.x,D.y,_t.x,Wn+_t.y,wt.x,wt.y,s,un,Lt.x,Lt.y,st,tn),Kh(ce,D.x,D.y,jt.x,Wn+jt.y,wt.x+wt.w,wt.y,s,un,Vt.x,Lt.y,st,tn),Kh(ce,D.x,D.y,ot.x,Wn+ot.y,wt.x,wt.y+wt.h,s,un,Lt.x,Vt.y,st,tn),Kh(ce,D.x,D.y,vt.x,Wn+vt.y,wt.x+wt.w,wt.y+wt.h,s,un,Vt.x,Vt.y,st,tn),T){const{x:Ar,y:Sr,z:Tr}=T.anchor,[Kn,ci,ar]=T.up;Yh(xe,Ar,Sr,Tr,Kn,ci,ar),Yh(xe,Ar,Sr,Tr,Kn,ci,ar),Yh(xe,Ar,Sr,Tr,Kn,ci,ar),Yh(xe,Ar,Sr,Tr,Kn,ci,ar),Jh(e.dynamicLayoutVertexArray,Ar,Sr,Tr,Le)}else Jh(e.dynamicLayoutVertexArray,D.x,D.y,D.z,Le);J.emplaceBack(nn,nn+1,nn+2),J.emplaceBack(nn+1,nn+2,nn+3),Me.vertexLength+=4,Me.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Bn[0]),Ze!==n.length-1&&Cn===n[Ze+1].sectionIndex||e.programConfigurations.populatePaintArrays(ce.length,_,_.index,{},V,G,Pe&&Pe[Cn])}const Ke=T?T.anchor:D;e.placedSymbolArray.emplaceBack(Ke.x,Ke.y,Ke.z,D.x,D.y,ve,this.glyphOffsetArray.length-ve,Se,R,O,D.segment,s?s[0]:0,s?s[1]:0,h[0],h[1],w,0,!1,0,B,0)}_commitLayoutVertex(e,n,s,h,g,_,w){e.emplaceBack(n,s,h,g,_,Math.round(w.x),Math.round(w.y))}_addCollisionDebugVertices(e,n,s,h,g,_,w){const T=s.segments.prepareSegment(4,s.layoutVertexArray,s.indexArray),D=T.vertexLength,R=w.tileAnchorX,O=w.tileAnchorY;for(let V=0;V<4;V++)s.collisionVertexArray.emplaceBack(0,0,0,0);s.collisionVertexArrayExt.emplaceBack(n,-e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(n,e.padding,-e.padding),s.collisionVertexArrayExt.emplaceBack(n,e.padding,e.padding),s.collisionVertexArrayExt.emplaceBack(n,-e.padding,e.padding),this._commitLayoutVertex(s.layoutVertexArray,h,g,_,R,O,new dt(e.x1,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,h,g,_,R,O,new dt(e.x2,e.y1)),this._commitLayoutVertex(s.layoutVertexArray,h,g,_,R,O,new dt(e.x2,e.y2)),this._commitLayoutVertex(s.layoutVertexArray,h,g,_,R,O,new dt(e.x1,e.y2)),T.vertexLength+=4;const B=s.indexArray;B.emplaceBack(D,D+1),B.emplaceBack(D+1,D+2),B.emplaceBack(D+2,D+3),B.emplaceBack(D+3,D),T.primitiveLength+=4}_addTextDebugCollisionBoxes(e,n,s,h,g,_){for(let w=h;w<g;w++){const T=s.get(w),D=this.getSymbolInstanceTextSize(e,_,n,w);this._addCollisionDebugVertices(T,D,this.textCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(e,n,s,h,g,_){for(let w=h;w<g;w++){const T=s.get(w),D=this.getSymbolInstanceIconSize(e,n,_.placedIconSymbolIndex);this._addCollisionDebugVertices(T,D,this.iconCollisionBox,T.projectedAnchorX,T.projectedAnchorY,T.projectedAnchorZ,_)}}generateCollisionDebugBuffers(e,n){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new vp(ho,Od.members,El),this.iconCollisionBox=new vp(ho,Od.members,El);const s=wu(this.iconSizeData,e),h=wu(this.textSizeData,e);for(let g=0;g<this.symbolInstances.length;g++){const _=this.symbolInstances.get(g);this._addTextDebugCollisionBoxes(h,e,n,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(h,e,n,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(s,e,n,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(s,e,n,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(e,n,s,h){const g=this.text.placedSymbolArray.get(n.rightJustifiedTextSymbolIndex>=0?n.rightJustifiedTextSymbolIndex:n.centerJustifiedTextSymbolIndex>=0?n.centerJustifiedTextSymbolIndex:n.leftJustifiedTextSymbolIndex>=0?n.leftJustifiedTextSymbolIndex:n.verticalPlacedTextSymbolIndex>=0?n.verticalPlacedTextSymbolIndex:h),_=Yu(this.textSizeData,e,g)/vs;return this.tilePixelRatio*_}getSymbolInstanceIconSize(e,n,s){const h=this.icon.placedSymbolArray.get(s),g=Yu(this.iconSizeData,e,h);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(e,n,s){e.emplaceBack(n,-s,-s),e.emplaceBack(n,s,-s),e.emplaceBack(n,s,s),e.emplaceBack(n,-s,s)}_updateTextDebugCollisionBoxes(e,n,s,h,g,_){for(let w=h;w<g;w++){const T=s.get(w),D=this.getSymbolInstanceTextSize(e,_,n,w);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,D,T.padding)}}_updateIconDebugCollisionBoxes(e,n,s,h,g,_){for(let w=h;w<g;w++){const T=s.get(w),D=this.getSymbolInstanceIconSize(e,n,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,D,T.padding)}}updateCollisionDebugBuffers(e,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const s=wu(this.iconSizeData,e),h=wu(this.textSizeData,e);for(let g=0;g<this.symbolInstances.length;g++){const _=this.symbolInstances.get(g);this._updateTextDebugCollisionBoxes(h,e,n,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(h,e,n,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(s,e,n,_.iconBoxStartIndex,_.iconBoxEndIndex,_.placedIconSymbolIndex),this._updateIconDebugCollisionBoxes(s,e,n,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_.placedIconSymbolIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,n,s,h,g,_,w,T,D){const R={};if(n<s){const{x1:O,y1:B,x2:V,y2:G,padding:J,projectedAnchorX:ce,projectedAnchorY:xe,projectedAnchorZ:Me,tileAnchorX:ve,tileAnchorY:Se,featureIndex:Le}=e.get(n);R.textBox={x1:O,y1:B,x2:V,y2:G,padding:J,projectedAnchorX:ce,projectedAnchorY:xe,projectedAnchorZ:Me,tileAnchorX:ve,tileAnchorY:Se},R.textFeatureIndex=Le}if(h<g){const{x1:O,y1:B,x2:V,y2:G,padding:J,projectedAnchorX:ce,projectedAnchorY:xe,projectedAnchorZ:Me,tileAnchorX:ve,tileAnchorY:Se,featureIndex:Le}=e.get(h);R.verticalTextBox={x1:O,y1:B,x2:V,y2:G,padding:J,projectedAnchorX:ce,projectedAnchorY:xe,projectedAnchorZ:Me,tileAnchorX:ve,tileAnchorY:Se},R.verticalTextFeatureIndex=Le}if(_<w){const{x1:O,y1:B,x2:V,y2:G,padding:J,projectedAnchorX:ce,projectedAnchorY:xe,projectedAnchorZ:Me,tileAnchorX:ve,tileAnchorY:Se,featureIndex:Le}=e.get(_);R.iconBox={x1:O,y1:B,x2:V,y2:G,padding:J,projectedAnchorX:ce,projectedAnchorY:xe,projectedAnchorZ:Me,tileAnchorX:ve,tileAnchorY:Se},R.iconFeatureIndex=Le}if(T<D){const{x1:O,y1:B,x2:V,y2:G,padding:J,projectedAnchorX:ce,projectedAnchorY:xe,projectedAnchorZ:Me,tileAnchorX:ve,tileAnchorY:Se,featureIndex:Le}=e.get(T);R.verticalIconBox={x1:O,y1:B,x2:V,y2:G,padding:J,projectedAnchorX:ce,projectedAnchorY:xe,projectedAnchorZ:Me,tileAnchorX:ve,tileAnchorY:Se},R.verticalIconFeatureIndex=Le}return R}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let n=0;n<this.symbolInstances.length;n++){const s=this.symbolInstances.get(n);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,s.textBoxStartIndex,s.textBoxEndIndex,s.verticalTextBoxStartIndex,s.verticalTextBoxEndIndex,s.iconBoxStartIndex,s.iconBoxEndIndex,s.verticalIconBoxStartIndex,s.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(e,n){const s=e.placedSymbolArray.get(n),h=s.vertexStartIndex+4*s.numGlyphs;for(let g=s.vertexStartIndex;g<h;g+=4)e.indexArray.emplaceBack(g,g+1,g+2),e.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const n=Math.sin(e),s=Math.cos(e),h=[],g=[],_=[];for(let w=0;w<this.symbolInstances.length;++w){_.push(w);const T=this.symbolInstances.get(w);h.push(0|Math.round(n*T.tileAnchorX+s*T.tileAnchorY)),g.push(T.featureIndex)}return _.sort((w,T)=>h[w]-h[T]||g[T]-g[w]),_}addToSortKeyRanges(e,n){const s=this.sortKeyRanges[this.sortKeyRanges.length-1];s&&s.sortKey===n?s.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:n,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const n of this.symbolInstanceIndexes){const s=this.symbolInstances.get(n);this.featureSortOrder.push(s.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:_,verticalPlacedTextSymbolIndex:w,placedIconSymbolIndex:T,verticalPlacedIconSymbolIndex:D}=s;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),g>=0&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),_>=0&&_!==g&&_!==h&&this.addIndicesForPlacedSymbol(this.text,_),w>=0&&this.addIndicesForPlacedSymbol(this.text,w),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T),D>=0&&this.addIndicesForPlacedSymbol(this.icon,D)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}fn(Jc,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Jc.MAX_GLYPHS=65535,Jc.addDynamicAttributes=Jh;const _g=new Bt({"symbol-placement":new Ge(ct.layout_symbol["symbol-placement"]),"symbol-spacing":new Ge(ct.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Ge(ct.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new it(ct.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Ge(ct.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Ge(ct.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Ge(ct.layout_symbol["icon-ignore-placement"]),"icon-optional":new Ge(ct.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Ge(ct.layout_symbol["icon-rotation-alignment"]),"icon-size":new it(ct.layout_symbol["icon-size"]),"icon-text-fit":new Ge(ct.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ge(ct.layout_symbol["icon-text-fit-padding"]),"icon-image":new it(ct.layout_symbol["icon-image"]),"icon-rotate":new it(ct.layout_symbol["icon-rotate"]),"icon-padding":new Ge(ct.layout_symbol["icon-padding"]),"icon-keep-upright":new Ge(ct.layout_symbol["icon-keep-upright"]),"icon-offset":new it(ct.layout_symbol["icon-offset"]),"icon-anchor":new it(ct.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Ge(ct.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Ge(ct.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Ge(ct.layout_symbol["text-rotation-alignment"]),"text-field":new it(ct.layout_symbol["text-field"]),"text-font":new it(ct.layout_symbol["text-font"]),"text-size":new it(ct.layout_symbol["text-size"]),"text-max-width":new it(ct.layout_symbol["text-max-width"]),"text-line-height":new it(ct.layout_symbol["text-line-height"]),"text-letter-spacing":new it(ct.layout_symbol["text-letter-spacing"]),"text-justify":new it(ct.layout_symbol["text-justify"]),"text-radial-offset":new it(ct.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Ge(ct.layout_symbol["text-variable-anchor"]),"text-anchor":new it(ct.layout_symbol["text-anchor"]),"text-max-angle":new Ge(ct.layout_symbol["text-max-angle"]),"text-writing-mode":new Ge(ct.layout_symbol["text-writing-mode"]),"text-rotate":new it(ct.layout_symbol["text-rotate"]),"text-padding":new Ge(ct.layout_symbol["text-padding"]),"text-keep-upright":new Ge(ct.layout_symbol["text-keep-upright"]),"text-transform":new it(ct.layout_symbol["text-transform"]),"text-offset":new it(ct.layout_symbol["text-offset"]),"text-allow-overlap":new Ge(ct.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Ge(ct.layout_symbol["text-ignore-placement"]),"text-optional":new Ge(ct.layout_symbol["text-optional"])});var xp={paint:new Bt({"icon-opacity":new it(ct.paint_symbol["icon-opacity"]),"icon-color":new it(ct.paint_symbol["icon-color"]),"icon-halo-color":new it(ct.paint_symbol["icon-halo-color"]),"icon-halo-width":new it(ct.paint_symbol["icon-halo-width"]),"icon-halo-blur":new it(ct.paint_symbol["icon-halo-blur"]),"icon-translate":new Ge(ct.paint_symbol["icon-translate"]),"icon-translate-anchor":new Ge(ct.paint_symbol["icon-translate-anchor"]),"text-opacity":new it(ct.paint_symbol["text-opacity"]),"text-color":new it(ct.paint_symbol["text-color"],{runtimeType:Gn,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new it(ct.paint_symbol["text-halo-color"]),"text-halo-width":new it(ct.paint_symbol["text-halo-width"]),"text-halo-blur":new it(ct.paint_symbol["text-halo-blur"]),"text-translate":new Ge(ct.paint_symbol["text-translate"]),"text-translate-anchor":new Ge(ct.paint_symbol["text-translate-anchor"])}),layout:_g};class wp{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:is,this.defaultValue=e}evaluate(e){if(e.formattedSection){const n=this.defaultValue.property.overrides;if(n&&n.hasOverride(e.formattedSection))return n.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}fn(wp,"FormatSectionOverride",{omit:["defaultValue"]});class ah extends Ga{constructor(e){super(e,xp)}recalculate(e,n){super.recalculate(e,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const s=this.layout.get("text-writing-mode");if(s){const h=[];for(const g of s)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(e,n,s,h){const g=this.layout.get(e).evaluate(n,{},s,h),_=this._unevaluatedLayout._values[e];return _.isDataDriven()||$(_.value)||!g?g:(w=n.properties,g.replace(/{([^{}]+)}/g,(D,R)=>R in w?String(w[R]):""));var w}createBucket(e){return new Jc(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of xp.paint.overridableProperties){if(!ah.hasPaintOverride(this.layout,e))continue;const n=this.paint.get(e),s=new wp(n),h=new A(s,n.property.specification);let g=null;g="constant"===n.value.kind||"source"===n.value.kind?new We("source",h):new Ft("composite",h,n.value.zoomStops,n.value._interpolationType),this.paint._values[e]=new kt(n.property,g,n.parameters)}}_handleOverridablePaintPropertyUpdate(e,n,s){return!(!this.layout||n.isDataDriven()||s.isDataDriven())&&ah.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,n){const s=e.get("text-field"),h=xp.paint.properties[n];let g=!1;const _=w=>{for(const T of w)if(h.overrides&&h.overrides.hasOverride(T))return void(g=!0)};if("constant"===s.value.kind&&s.value.value instanceof Wi)_(s.value.value.sections);else if("source"===s.value.kind){const w=D=>{g||(D instanceof Ui&&ii(D.value)===Jr?_(D.value.sections):D instanceof eo?_(D.sections):D.eachChild(w))},T=s.value;T._styleExpression&&w(T._styleExpression.expression)}return g}getProgramConfiguration(e){return new jc(this,e)}}var bp={paint:new Bt({"background-color":new Ge(ct.paint_background["background-color"]),"background-pattern":new Ge(ct.paint_background["background-pattern"]),"background-opacity":new Ge(ct.paint_background["background-opacity"])})},K_={paint:new Bt({"raster-opacity":new Ge(ct.paint_raster["raster-opacity"]),"raster-hue-rotate":new Ge(ct.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Ge(ct.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Ge(ct.paint_raster["raster-brightness-max"]),"raster-saturation":new Ge(ct.paint_raster["raster-saturation"]),"raster-contrast":new Ge(ct.paint_raster["raster-contrast"]),"raster-resampling":new Ge(ct.paint_raster["raster-resampling"]),"raster-fade-duration":new Ge(ct.paint_raster["raster-fade-duration"])})};class Xd extends Ga{constructor(e){super(e,{}),this.implementation=e}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isLayerDraped(){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}var Kd={paint:new Bt({"sky-type":new Ge(ct.paint_sky["sky-type"]),"sky-atmosphere-sun":new Ge(ct.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Ge(ct.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Ge(ct.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Ge(ct.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ct(ct.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Ge(ct.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Ge(ct.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Ge(ct.paint_sky["sky-opacity"])})};function Qh(t,e,n){const s=[0,0,1],h=vf([]);return wf(h,h,n?-Ne(t)+Math.PI:Ne(t)),xf(h,h,-Ne(e)),gm(s,s,h),_s(s,s)}const Y_={circle:class extends Ga{constructor(t){super(t,Hu)}createBucket(t){return new Ah(t)}queryRadius(t){const e=t;return _u("circle-radius",this,e)+_u("circle-stroke-width",this,e)+Gu(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,s,h,g,_,w){const T=Pm(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,t.pixelToTileUnitsFactor),D=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return km(t,s,g,_,w,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),T,D)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new jc(this,t)}},heatmap:class extends Ga{createBucket(t){return new Lf(t)}constructor(t){super(t,r_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=qc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return _u("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,s,h,g,_,w){const T=this.paint.get("heatmap-radius").evaluate(e,n);return km(t,s,g,_,w,!0,!0,new dt(0,0),T)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new jc(this,t)}},hillshade:class extends Ga{constructor(t){super(t,Lh)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ga{constructor(t){super(t,m_)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(t){return new jc(this,t)}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new Id(t)}queryRadius(){return Gu(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,s,h,g){return!t.queryGeometry.isAboveHorizon&&Rf(Am(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,t.pixelToTileUnitsFactor),s)}isTileClipped(){return!0}},"fill-extrusion":class extends Ga{constructor(t){super(t,M_)}createBucket(t){return new Pd(t)}queryRadius(){return Gu(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new jc(this,t)}queryIntersectsFeature(t,e,n,s,h,g,_,w,T){const D=Pm(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,t.pixelToTileUnitsFactor),R=this.paint.get("fill-extrusion-height").evaluate(e,n),O=this.paint.get("fill-extrusion-base").evaluate(e,n),B=[0,0],V=w&&g.elevation,G=g.elevation?g.elevation.exaggeration():1,J=t.tile.getBucket(this);if(V&&J instanceof Pd){const Se=J.centroidVertexArray,Le=T+1;Le<Se.length&&(B[0]=Se.geta_centroid_pos0(Le),B[1]=Se.geta_centroid_pos1(Le))}if(0===B[0]&&1===B[1])return!1;"globe"===g.projection.name&&(s=qf([s],[new dt(0,0),new dt(er,er)],t.tileID.canonical).map(Se=>Se.polygon).flat());const ce=V?w:null,[xe,Me]=(Le=s,Pe=O,Ke=R,Ze=D,_t=_,jt=ce,ot=B,vt=G,wt=g.center.lat,"globe"===(Se=g).projection.name?function(Vt,st,tn,Bn,un,Cn,nn,Wn,Ar,Sr,Tr){const Kn=[],ci=[],ar=Vt.projection.upVectorScale(Tr,Vt.center.lat,Vt.worldSize).metersToTile,kr=[0,0,0,1],gi=[0,0,0,1],Fi=(zi,Vi,fo,ws)=>{zi[0]=Vi,zi[1]=fo,zi[2]=ws,zi[3]=1},Ai=Gm();tn>0&&(tn+=Ai),Bn+=Ai;for(const zi of st){const Vi=[],fo=[];for(const ws of zi){const ui=ws.x+un.x,Fo=ws.y+un.y,Co=Vt.projection.projectTilePoint(ui,Fo,Tr),qr=Vt.projection.upVector(Tr,ws.x,ws.y);let Ki=tn,Ho=Bn;if(nn){const _i=Xf(ui,Fo,tn,Bn,nn,Wn,Ar,Sr);Ki+=_i.base,Ho+=_i.top}0!==tn?Fi(kr,Co.x+qr[0]*ar*Ki,Co.y+qr[1]*ar*Ki,Co.z+qr[2]*ar*Ki):Fi(kr,Co.x,Co.y,Co.z),Fi(gi,Co.x+qr[0]*ar*Ho,Co.y+qr[1]*ar*Ho,Co.z+qr[2]*ar*Ho),vo(kr,kr,Cn),vo(gi,gi,Cn),Vi.push(new Zu(kr[0],kr[1],kr[2])),fo.push(new Zu(gi[0],gi[1],gi[2]))}Kn.push(Vi),ci.push(fo)}return[Kn,ci]}(Se,Le,Pe,Ke,Ze,_t,jt,ot,vt,wt,t.tileID.canonical):jt?function(Vt,st,tn,Bn,un,Cn,nn,Wn,Ar){const Sr=[],Tr=[],Kn=[0,0,0,1];for(const ci of Vt){const ar=[],kr=[];for(const gi of ci){const Fi=gi.x+Bn.x,Ai=gi.y+Bn.y,zi=Xf(Fi,Ai,st,tn,Cn,nn,Wn,Ar);Kn[0]=Fi,Kn[1]=Ai,Kn[2]=zi.base,Kn[3]=1,fc(Kn,Kn,un),Kn[3]=Math.max(Kn[3],1e-5);const Vi=new Zu(Kn[0]/Kn[3],Kn[1]/Kn[3],Kn[2]/Kn[3]);Kn[0]=Fi,Kn[1]=Ai,Kn[2]=zi.top,Kn[3]=1,fc(Kn,Kn,un),Kn[3]=Math.max(Kn[3],1e-5);const fo=new Zu(Kn[0]/Kn[3],Kn[1]/Kn[3],Kn[2]/Kn[3]);ar.push(Vi),kr.push(fo)}Sr.push(ar),Tr.push(kr)}return[Sr,Tr]}(Le,Pe,Ke,Ze,_t,jt,ot,vt,wt):function(Vt,st,tn,Bn,un){const Cn=[],nn=[],Wn=un[8]*st,Ar=un[9]*st,Sr=un[10]*st,Tr=un[11]*st,Kn=un[8]*tn,ci=un[9]*tn,ar=un[10]*tn,kr=un[11]*tn;for(const gi of Vt){const Fi=[],Ai=[];for(const zi of gi){const Vi=zi.x+Bn.x,fo=zi.y+Bn.y,ws=un[0]*Vi+un[4]*fo+un[12],ui=un[1]*Vi+un[5]*fo+un[13],Fo=un[2]*Vi+un[6]*fo+un[14],Co=un[3]*Vi+un[7]*fo+un[15],qr=ws+Wn,Ki=ui+Ar,Ho=Fo+Sr,_i=Math.max(Co+Tr,1e-5),xo=ws+Kn,zs=ui+ci,es=Fo+ar,ts=Math.max(Co+kr,1e-5);Fi.push(new Zu(qr/_i,Ki/_i,Ho/_i)),Ai.push(new Zu(xo/ts,zs/ts,es/ts))}Cn.push(Fi),nn.push(Ai)}return[Cn,nn]}(Le,Pe,Ke,Ze,_t)),ve=t.queryGeometry;var Se,Le,Pe,Ke,Ze,_t,jt,ot,vt,wt;return function(Se,Le,Pe){let Ke=1/0;Rf(Pe,Le)&&(Ke=Wm(Pe,Le[0]));for(let Ze=0;Ze<Le.length;Ze++){const _t=Le[Ze],jt=Se[Ze];for(let ot=0;ot<_t.length-1;ot++){const vt=_t[ot],wt=[vt,_t[ot+1],jt[ot+1],jt[ot],vt];Sm(Pe,wt)&&(Ke=Math.min(Ke,Wm(Pe,wt)))}}return Ke!==1/0&&Ke}(xe,Me,ve.isPointQuery()?ve.screenBounds:ve.screenGeometry)}},line:class extends Ga{constructor(t){super(t,Xm),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof ls,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=Jf.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new vc(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new jc(this,t)}queryRadius(t){const e=t,n=Km(_u("line-width",this,e),_u("line-gap-width",this,e)),s=_u("line-offset",this,e);return n/2+Math.abs(s)+Gu(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,s,h,g){if(t.queryGeometry.isAboveHorizon)return!1;const _=Am(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,t.pixelToTileUnitsFactor),w=t.pixelToTileUnitsFactor/2*Km(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),T=this.paint.get("line-offset").evaluate(e,n);return T&&(s=function(D,R){const O=[],B=new dt(0,0);for(let V=0;V<D.length;V++){const G=D[V],J=[];for(let ce=0;ce<G.length;ce++){const Me=G[ce],ve=G[ce+1],Se=0===ce?B:Me.sub(G[ce-1])._unit()._perp(),Le=ce===G.length-1?B:ve.sub(Me)._unit()._perp(),Pe=Se._add(Le)._unit();Pe._mult(1/(Pe.x*Le.x+Pe.y*Le.y)),J.push(Pe._mult(R)._add(Me))}O.push(J)}return O}(s,T*t.pixelToTileUnitsFactor)),function(D,R,O){for(let B=0;B<R.length;B++){const V=R[B];if(D.length>=3)for(let G=0;G<V.length;G++)if(gc(D,V[G]))return!0;if(Mm(D,V,O))return!0}return!1}(_,s,w)}isTileClipped(){return!0}},symbol:ah,background:class extends Ga{constructor(t){super(t,bp)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ga{constructor(t){super(t,K_)}getProgramIds(){return["raster"]}},sky:class extends Ga{constructor(t){super(t,Kd),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=qc({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const s=this.paint.get("sky-atmosphere-sun"),h=!s,g=t.style.light,_=g.properties.get("position");return h&&"viewport"===g.properties.get("anchor")&&vr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?Qh(_.azimuthal,90-_.polar,e):Qh(s[0],90-s[1],e)}const n=this.paint.get("sky-gradient-center");return Qh(n[0],90-n[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}};class Mu{constructor(e,n,s,h){this.context=e,this.format=s,this.texture=e.gl.createTexture(),this.update(n,h)}update(e,n,s){const{width:h,height:g}=e,{context:_}=this,{gl:w}=_,{HTMLImageElement:T,HTMLCanvasElement:D,HTMLVideoElement:R,ImageData:O,ImageBitmap:B}=Ie;if(w.bindTexture(w.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===w.RGBA&&(!n||!1!==n.premultiply)),s||this.size&&this.size[0]===h&&this.size[1]===g){const{x:V,y:G}=s||{x:0,y:0};e instanceof T||e instanceof D||e instanceof R||e instanceof O||B&&e instanceof B?w.texSubImage2D(w.TEXTURE_2D,0,V,G,w.RGBA,w.UNSIGNED_BYTE,e):w.texSubImage2D(w.TEXTURE_2D,0,V,G,h,g,w.RGBA,w.UNSIGNED_BYTE,e.data)}else this.size=[h,g],e instanceof T||e instanceof D||e instanceof R||e instanceof O||B&&e instanceof B?w.texImage2D(w.TEXTURE_2D,0,this.format,this.format,w.UNSIGNED_BYTE,e):w.texImage2D(w.TEXTURE_2D,0,this.format,h,g,0,this.format,w.UNSIGNED_BYTE,e.data);this.useMipmap=Boolean(n&&n.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&w.generateMipmap(w.TEXTURE_2D)}bind(e,n){const{context:s}=this,{gl:h}=s;h.bindTexture(h.TEXTURE_2D,this.texture),e!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,e),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?e===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:e),this.filter=e),n!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,n),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,n),this.wrap=n)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Ep{constructor(e){this._callback=e,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Tp{constructor(){this.tasks={},this.taskQueue=[],yr(["process"],this),this.invoker=new Ep(this.process),this.nextId=0}add(e,n){const s=this.nextId++,h=function({type:g,isSymbolTile:_,zoom:w}){return w=w||0,"message"===g?0:"maybePrepare"!==g||_?"parseTile"!==g||_?"parseTile"===g&&_?300-w:"maybePrepare"===g&&_?400-w:500:200-w:100-w}(n);if(0===h){ni();try{e()}finally{}return{cancel:()=>{}}}return this.tasks[s]={fn:e,metadata:n,priority:h,id:s},this.taskQueue.push(s),this.invoker.trigger(),{cancel:()=>{delete this.tasks[s]}}}process(){ni();try{if(this.taskQueue=this.taskQueue.filter(s=>!!this.tasks[s]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const n=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!n)return;n.fn()}finally{}}pick(){let e=null,n=1/0;for(let h=0;h<this.taskQueue.length;h++){const g=this.tasks[this.taskQueue[h]];g.priority<n&&(n=g.priority,e=h)}if(null===e)return null;const s=this.taskQueue[e];return this.taskQueue.splice(e,1),s}remove(){this.invoker.remove()}}class Dp{constructor(e){this._stringToNumber={},this._numberToString=[];for(let n=0;n<e.length;n++){const s=e[n];this._stringToNumber[s]=n,this._numberToString[n]=s}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}const Cp=["tile","layer","source","sourceLayer","state"];class Sp{constructor(e,n,s,h,g){this.type="Feature",this._vectorTileFeature=e,this._z=n,this._x=s,this._y=h,this.properties=e.properties,this.id=g}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(e.id=this.id);for(const n of Cp)void 0!==this[n]&&(e[n]=this[n]);return e}}const Xa=32,dl=33,Ec=new Uint16Array(8184);for(let t=0;t<2046;t++){let e=t+2,n=0,s=0,h=0,g=0,_=0,w=0;for(1&e?h=g=_=Xa:n=s=w=Xa;(e>>=1)>1;){const D=n+h>>1,R=s+g>>1;1&e?(h=n,g=s,n=_,s=w):(n=h,s=g,h=_,g=w),_=D,w=R}const T=4*t;Ec[T+0]=n,Ec[T+1]=s,Ec[T+2]=h,Ec[T+3]=g}const Kl=new Uint16Array(2178),Tc=new Uint8Array(1089),ed=new Uint16Array(1089);function Mp(t){return 0===t?-.03125:32===t?.03125:0}var Ip=Rn([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const yg={type:2,extent:er,loadGeometry:()=>[[new dt(0,0),new dt(8193,0),new dt(8193,8193),new dt(0,8193),new dt(0,0)]]};class Yd{constructor(e,n,s,h,g){this.tileID=e,this.uid=It(),this.uses=0,this.tileSize=n,this.tileZoom=s,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=g,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(e){const n=e+this.timeAdded;n<xr.now()||this.fadeEndTime&&n<this.fadeEndTime||(this.fadeEndTime=n)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=bu(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(e,n,s){if(this.unloadVectorData(),this.state="loaded",e){e.featureIndex&&(this.latestFeatureIndex=e.featureIndex,e.rawTileData?(this.latestRawTileData=e.rawTileData,this.latestFeatureIndex.rawTileData=e.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=e.collisionBoxArray,this.buckets=function(h,g){const _={};if(!g)return _;for(const w of h){const T=w.layerIds.map(D=>g.getLayer(D)).filter(Boolean);if(0!==T.length){w.layers=T,w.stateDependentLayerIds&&(w.stateDependentLayers=w.stateDependentLayerIds.map(D=>T.filter(R=>R.id===D)[0]));for(const D of T)_[D.id]=w}}return _}(e.buckets,n.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const g=this.buckets[h];if(g instanceof Jc){if(this.hasSymbolBuckets=!0,!s)break;g.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const g=this.buckets[h];if(g instanceof Jc&&g.hasRTLText){this.hasRTLText=!0,Be.isLoading()||Be.isLoaded()||"deferred"!==ke()||Ae();break}}this.queryPadding=0;for(const h in this.buckets){const g=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,n.style.getLayer(h).queryRadius(g))}e.imageAtlas&&(this.imageAtlas=e.imageAtlas),e.glyphAtlasImage&&(this.glyphAtlasImage=e.glyphAtlasImage),e.lineAtlas&&(this.lineAtlas=e.lineAtlas)}else this.collisionBoxArray=new cf}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(e){return this.buckets[e.id]}upload(e){for(const s in this.buckets){const h=this.buckets[s];h.uploadPending()&&h.upload(e)}const n=e.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Mu(e,this.imageAtlas.image,n.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Mu(e,this.glyphAtlasImage,n.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Mu(e,this.lineAtlas.image,n.ALPHA),this.lineAtlas.uploaded=!0)}prepare(e){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture)}queryRenderedFeatures(e,n,s,h,g,_,w,T){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:w,transform:_,params:g,tileTransform:this.tileTransform},e,n,s):{}}querySourceFeatures(e,n){const s=this.latestFeatureIndex;if(!s||!s.rawTileData)return;const h=s.loadVTLayers(),g=n?n.sourceLayer:"",_=h._geojsonTileLayer||h[g];if(!_)return;const w=Ca(n&&n.filter),{z:T,x:D,y:R}=this.tileID.canonical,O={z:T,x:D,y:R};for(let B=0;B<_.length;B++){const V=_.feature(B);if(w.needGeometry){const ce=Wc(V,!0);if(!w.filter(new He(this.tileID.overscaledZ),ce,this.tileID.canonical))continue}else if(!w.filter(new He(this.tileID.overscaledZ),V))continue;const G=s.getId(V,g),J=new Sp(V,T,D,R,G);J.tile=O,e.push(J)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(e){const n=this.expirationTime;if(e.cacheControl){const s=wr(e.cacheControl);s["max-age"]&&(this.expirationTime=Date.now()+1e3*s["max-age"])}else e.expires&&(this.expirationTime=new Date(e.expires).getTime());if(this.expirationTime){const s=Date.now();let h=!1;if(this.expirationTime>s)h=!1;else if(n)if(this.expirationTime<n)h=!0;else{const g=this.expirationTime-n;g?this.expirationTime=s+Math.max(g,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(e,n){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(e).length||!n)return;const s=this.latestFeatureIndex.loadVTLayers(),h=n.style.listImages();for(const g in this.buckets){if(!n.style.hasLayer(g))continue;const _=this.buckets[g],w=_.layers[0].sourceLayer||"_geojsonTileLayer",T=s[w],D=e[w];if(!T||!D||0===Object.keys(D).length)continue;if(_.update(D,T,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof vc||_ instanceof Id){const O=n.style._getSourceCache(_.layers[0].source);n._terrain&&n._terrain.enabled&&O&&_.programConfigurations.needsUpload&&n._terrain._clearRenderCacheForTile(O.id,this.tileID)}const R=n&&n.style&&n.style.getLayer(g);R&&(this.queryPadding=Math.max(this.queryPadding,R.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<xr.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(e){this.symbolFadeHoldUntil=xr.now()+e}setTexture(e,n){const s=n.context,h=s.gl;this.texture=this.texture||n.getTileTexture(e.width),this.texture?this.texture.update(e,{useMipmap:!0}):(this.texture=new Mu(s,e,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),s.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,s.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,s.extTextureFilterAnisotropicMax))}setDependencies(e,n){const s={};for(const h of n)s[h]=!0;this.dependencies[e]=s}hasDependency(e,n){for(const s of e){const h=this.dependencies[s];if(h)for(const g of n)if(h[g])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(e,n){if(!n||"mercator"===n.name||this._tileDebugBuffer)return;const s=Gl(yg,this.tileID.canonical,this.tileTransform)[0],h=new zn,g=new cl;for(let _=0;_<s.length;_++){const{x:w,y:T}=s[_];h.emplaceBack(w,T),g.emplaceBack(_)}g.emplaceBack(0),this._tileDebugIndexBuffer=e.createIndexBuffer(g),this._tileDebugBuffer=e.createVertexBuffer(h,Th.members),this._tileDebugSegments=yo.simpleSegment(0,0,h.length,g.length)}_makeTileBoundsBuffers(e,n){if(this._tileBoundsBuffer||!n||"mercator"===n.name)return;const s=Gl(yg,this.tileID.canonical,this.tileTransform)[0];let h,g;if(this.isRaster){const _=function(w,T){const D=bu(w,T),R=Math.pow(2,w.z);for(let ce=0;ce<dl;ce++)for(let xe=0;xe<dl;xe++){const Me=Wa((w.x+(xe+Mp(xe))/Xa)/R),ve=Os((w.y+(ce+Mp(ce))/Xa)/R),Se=T.project(Me,ve),Le=ce*dl+xe;Kl[2*Le+0]=Math.round((Se.x*D.scale-D.x)*er),Kl[2*Le+1]=Math.round((Se.y*D.scale-D.y)*er)}Tc.fill(0),ed.fill(0);for(let ce=2045;ce>=0;ce--){const xe=4*ce,Me=Ec[xe+0],ve=Ec[xe+1],Se=Ec[xe+2],Le=Ec[xe+3],Pe=Me+Se>>1,Ke=ve+Le>>1,Ze=Pe+Ke-ve,_t=Ke+Me-Pe,jt=ve*dl+Me,ot=Le*dl+Se,vt=Ke*dl+Pe,wt=Math.hypot((Kl[2*jt+0]+Kl[2*ot+0])/2-Kl[2*vt+0],(Kl[2*jt+1]+Kl[2*ot+1])/2-Kl[2*vt+1])>=16;Tc[vt]=Tc[vt]||(wt?1:0),ce<1022&&(Tc[vt]=Tc[vt]||Tc[(ve+_t>>1)*dl+(Me+Ze>>1)]||Tc[(Le+_t>>1)*dl+(Se+Ze>>1)])}const O=new pi,B=new gs;let V=0;function G(ce,xe){const Me=xe*dl+ce;return 0===ed[Me]&&(O.emplaceBack(Kl[2*Me+0],Kl[2*Me+1],ce*er/Xa,xe*er/Xa),ed[Me]=++V),ed[Me]-1}function J(ce,xe,Me,ve,Se,Le){const Pe=ce+Me>>1,Ke=xe+ve>>1;if(Math.abs(ce-Se)+Math.abs(xe-Le)>1&&Tc[Ke*dl+Pe])J(Se,Le,ce,xe,Pe,Ke),J(Me,ve,Se,Le,Pe,Ke);else{const Ze=G(ce,xe),_t=G(Me,ve),jt=G(Se,Le);B.emplaceBack(Ze,_t,jt)}}return J(0,0,Xa,Xa,Xa,0),J(Xa,Xa,0,0,0,Xa),{vertices:O,indices:B}}(this.tileID.canonical,n);h=_.vertices,g=_.indices}else{h=new pi,g=new gs;for(const{x:w,y:T}of s)h.emplaceBack(w,T,0,0);const _=Wu(h.int16,void 0,4);for(let w=0;w<_.length;w+=3)g.emplaceBack(_[w],_[w+1],_[w+2])}this._tileBoundsBuffer=e.createVertexBuffer(h,Ip.members),this._tileBoundsIndexBuffer=e.createIndexBuffer(g),this._tileBoundsSegments=yo.simpleSegment(0,0,h.length,g.length)}_makeGlobeTileDebugBuffers(e,n){const s=n.projection;if(!s||"globe"!==s.name||n.freezeTileCoverage)return;const h=this.tileID.canonical,g=ju(Ef(h,n)),_=Vu(n.zoom);let w;_>0&&(w=mf(new Float64Array(16),n.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(e,h,n,g,w,_),this._makeGlobeTileDebugTextBuffer(e,h,n,g,w,_)}_globePoint(e,n,s,h,g,_,w){let T=pu(e,n,s);if(_){const D=1<<s.z,R=Sl(h.center.lng),O=Ml(h.center.lat),B=(s.x+.5)/D-R;let V=0;B>.5?V=-1:B<-.5&&(V=1);let G=(e/er+s.x)/D+V,J=(n/er+s.y)/D;G=(G-R)*h._pixelsPerMercatorPixel+R,J=(J-O)*h._pixelsPerMercatorPixel+O;const ce=[G*h.worldSize,J*h.worldSize,0];vo(ce,ce,_),T=Cl(T,ce,w)}return vo(T,T,g)}_makeGlobeTileDebugBorderBuffer(e,n,s,h,g,_){const w=new zn,T=new cl,D=new ti,R=(B,V,G,J,ce)=>{const xe=(G-B)/(ce-1),Me=(J-V)/(ce-1),ve=w.length;for(let Se=0;Se<ce;Se++){const Le=B+Se*xe,Pe=V+Se*Me;w.emplaceBack(Le,Pe);const Ke=this._globePoint(Le,Pe,n,s,h,g,_);D.emplaceBack(Ke[0],Ke[1],Ke[2]),T.emplaceBack(ve+Se)}},O=er;R(0,0,O,0,16),R(O,0,O,O,16),R(O,O,0,O,16),R(0,O,0,0,16),this._tileDebugIndexBuffer=e.createIndexBuffer(T),this._tileDebugBuffer=e.createVertexBuffer(w,Th.members),this._globeTileDebugBorderBuffer=e.createVertexBuffer(D,ym.members),this._tileDebugSegments=yo.simpleSegment(0,0,w.length,T.length)}_makeGlobeTileDebugTextBuffer(e,n,s,h,g,_){const w=new zn,T=new gs,D=new ti,R=25;T.reserve(32),w.reserve(R),D.reserve(R);const O=(B,V)=>R*B+V;for(let B=0;B<R;B++){const V=2048*B;for(let G=0;G<R;G++){const J=2048*G;w.emplaceBack(J,V);const ce=this._globePoint(J,V,n,s,h,g,_);D.emplaceBack(ce[0],ce[1],ce[2])}}for(let B=0;B<4;B++)for(let V=0;V<4;V++){const G=O(B,V),J=O(B,V+1),ce=O(B+1,V),xe=O(B+1,V+1);T.emplaceBack(G,J,ce),T.emplaceBack(ce,J,xe)}this._tileDebugTextIndexBuffer=e.createIndexBuffer(T),this._tileDebugTextBuffer=e.createVertexBuffer(w,Th.members),this._globeTileDebugTextBuffer=e.createVertexBuffer(D,ym.members),this._tileDebugTextSegments=yo.simpleSegment(0,0,R,32)}}class vg{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,n,s){const h=String(n);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][h]=this.stateChanges[e][h]||{},rt(this.stateChanges[e][h],s),null===this.deletedStates[e]){this.deletedStates[e]={};for(const g in this.state[e])g!==h&&(this.deletedStates[e][g]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][h]){this.deletedStates[e][h]={};for(const g in this.state[e][h])s[g]||(this.deletedStates[e][h][g]=null)}else for(const g in s)this.deletedStates[e]&&this.deletedStates[e][h]&&null===this.deletedStates[e][h][g]&&delete this.deletedStates[e][h][g]}removeFeatureState(e,n,s){if(null===this.deletedStates[e])return;const h=String(n);if(this.deletedStates[e]=this.deletedStates[e]||{},s&&void 0!==n)null!==this.deletedStates[e][h]&&(this.deletedStates[e][h]=this.deletedStates[e][h]||{},this.deletedStates[e][h][s]=null);else if(void 0!==n)if(this.stateChanges[e]&&this.stateChanges[e][h])for(s in this.deletedStates[e][h]={},this.stateChanges[e][h])this.deletedStates[e][h][s]=null;else this.deletedStates[e][h]=null;else this.deletedStates[e]=null}getState(e,n){const s=String(n),h=rt({},(this.state[e]||{})[s],(this.stateChanges[e]||{})[s]);if(null===this.deletedStates[e])return{};if(this.deletedStates[e]){const g=this.deletedStates[e][n];if(null===g)return{};for(const _ in g)delete h[_]}return h}initializeTileState(e,n){e.setFeatureState(this.state,n)}coalesceChanges(e,n){const s={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const g={};for(const _ in this.stateChanges[h])this.state[h][_]||(this.state[h][_]={}),rt(this.state[h][_],this.stateChanges[h][_]),g[_]=this.state[h][_];s[h]=g}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const g={};if(null===this.deletedStates[h])for(const _ in this.state[h])g[_]={},this.state[h][_]={};else for(const _ in this.deletedStates[h]){if(null===this.deletedStates[h][_])this.state[h][_]={};else if(this.state[h][_])for(const w of Object.keys(this.deletedStates[h][_]))delete this.state[h][_][w];g[_]=this.state[h][_]}s[h]=s[h]||{},rt(s[h],g)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(s).length)for(const h in e)e[h].setFeatureState(s,n)}}class Jd{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,n){const s=this.toIdx(e,n);return{min:this.minimums[s],max:this.maximums[s]}}isLeaf(e,n){return this.leaves[this.toIdx(e,n)]}toIdx(e,n){return n*this.size+e}}function Qd(t,e,n,s){let h=0,g=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(s[_])<1e-15){if(n[_]<t[_]||n[_]>e[_])return null}else{const w=1/s[_];let T=(t[_]-n[_])*w,D=(e[_]-n[_])*w;if(T>D){const R=T;T=D,D=R}if(T>h&&(h=T),D<g&&(g=D),h>g)return null}return h}function Ap(t,e,n,s,h,g,_,w,T,D,R){const O=s-t,B=h-e,V=g-n,G=_-t,J=w-e,ce=T-n,xe=R[1]*ce-R[2]*J,Me=R[2]*G-R[0]*ce,ve=R[0]*J-R[1]*G,Se=O*xe+B*Me+V*ve;if(Math.abs(Se)<1e-15)return null;const Le=1/Se,Pe=D[0]-t,Ke=D[1]-e,Ze=D[2]-n,_t=(Pe*xe+Ke*Me+Ze*ve)*Le;if(_t<0||_t>1)return null;const jt=Ke*V-Ze*B,ot=Ze*O-Pe*V,vt=Pe*B-Ke*O,wt=(R[0]*jt+R[1]*ot+R[2]*vt)*Le;return wt<0||_t+wt>1?null:(G*jt+J*ot+ce*vt)*Le}function Pp(t,e,n){return(t-e)/(n-e)}function Rp(t,e,n,s,h,g,_,w,T){const D=1<<n,R=g-s,O=_-h,B=(t+1)/D*R+s,V=(e+0)/D*O+h,G=(e+1)/D*O+h;w[0]=(t+0)/D*R+s,w[1]=V,T[0]=B,T[1]=G}class kp{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const n=function(g){const _=Math.ceil(Math.log2(g.dim/8)),w=[];let T=Math.ceil(Math.pow(2,_));const D=1/T,R=(V,G,J,ce,xe)=>{const Me=ce?1:0,ve=(V+1)*J-Me,Se=G*J,Le=(G+1)*J-Me;xe[0]=V*J,xe[1]=Se,xe[2]=ve,xe[3]=Le};let O=new Jd(T);const B=[];for(let V=0;V<T*T;V++){R(V%T,Math.floor(V/T),D,!1,B);const G=Dc(B[0],B[1],g),J=Dc(B[2],B[1],g),ce=Dc(B[2],B[3],g),xe=Dc(B[0],B[3],g);O.minimums.push(Math.min(G,J,ce,xe)),O.maximums.push(Math.max(G,J,ce,xe)),O.leaves.push(1)}for(w.push(O),T/=2;T>=1;T/=2){const V=w[w.length-1];O=new Jd(T);for(let G=0;G<T*T;G++){R(G%T,Math.floor(G/T),2,!0,B);const J=V.getElevation(B[0],B[1]),ce=V.getElevation(B[2],B[1]),xe=V.getElevation(B[2],B[3]),Me=V.getElevation(B[0],B[3]),ve=V.isLeaf(B[0],B[1]),Se=V.isLeaf(B[2],B[1]),Le=V.isLeaf(B[2],B[3]),Pe=V.isLeaf(B[0],B[3]),Ke=Math.min(J.min,ce.min,xe.min,Me.min),Ze=Math.max(J.max,ce.max,xe.max,Me.max),_t=ve&&Se&&Le&&Pe;O.maximums.push(Ze),O.minimums.push(Ke),O.leaves.push(Ze-Ke<=5&&_t?1:0)}w.push(O)}return w}(this.dem),s=n.length-1,h=n[s];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(n,0,0,s,0)}raycastRoot(e,n,s,h,g,_,w=1){return Qd([e,n,-100],[s,h,this.maximums[0]*w],g,_)}raycast(e,n,s,h,g,_,w=1){if(!this.nodeCount)return null;const T=this.raycastRoot(e,n,s,h,g,_,w);if(null==T)return null;const D=[],R=[],O=[],B=[],V=[{idx:0,t:T,nodex:0,nodey:0,depth:0}];for(;V.length>0;){const{idx:G,t:J,nodex:ce,nodey:xe,depth:Me}=V.pop();if(this.leaves[G]){Rp(ce,xe,Me,e,n,s,h,O,B);const Se=1<<Me,Le=(ce+0)/Se,Pe=(ce+1)/Se,Ke=(xe+0)/Se,Ze=(xe+1)/Se,_t=Dc(Le,Ke,this.dem)*w,jt=Dc(Pe,Ke,this.dem)*w,ot=Dc(Pe,Ze,this.dem)*w,vt=Dc(Le,Ze,this.dem)*w,wt=Ap(O[0],O[1],_t,B[0],O[1],jt,B[0],B[1],ot,g,_),Lt=Ap(B[0],B[1],ot,O[0],B[1],vt,O[0],O[1],_t,g,_),Vt=Math.min(null!==wt?wt:Number.MAX_VALUE,null!==Lt?Lt:Number.MAX_VALUE);if(Vt!==Number.MAX_VALUE)return Vt;{const st=Nu([],g,_,J);if(Lp(_t,jt,vt,ot,Pp(st[0],O[0],B[0]),Pp(st[1],O[1],B[1]))>=st[2])return J}continue}let ve=0;for(let Se=0;Se<this._siblingOffset.length;Se++){Rp((ce<<1)+this._siblingOffset[Se][0],(xe<<1)+this._siblingOffset[Se][1],Me+1,e,n,s,h,O,B),O[2]=-100,B[2]=this.maximums[this.childOffsets[G]+Se]*w;const Le=Qd(O,B,g,_);if(null!=Le){const Pe=Le;D[Se]=Pe;let Ke=!1;for(let Ze=0;Ze<ve&&!Ke;Ze++)Pe>=D[R[Ze]]&&(R.splice(Ze,0,Se),Ke=!0);Ke||(R[ve]=Se),ve++}}for(let Se=0;Se<ve;Se++){const Le=R[Se];V.push({idx:this.childOffsets[G]+Le,t:D[Le],nodex:(ce<<1)+this._siblingOffset[Le][0],nodey:(xe<<1)+this._siblingOffset[Le][1],depth:Me+1})}}return null}_addNode(e,n,s){return this.minimums.push(e),this.maximums.push(n),this.leaves.push(s),this.childOffsets.push(0),this.nodeCount++}_construct(e,n,s,h,g){if(1===e[h].isLeaf(n,s))return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const _=h-1,w=e[_];let T=0,D=0;for(let R=0;R<this._siblingOffset.length;R++){const O=2*n+this._siblingOffset[R][0],B=2*s+this._siblingOffset[R][1],V=w.getElevation(O,B),G=w.isLeaf(O,B),J=this._addNode(V.min,V.max,G);G&&(T|=1<<R),D||(D=J)}for(let R=0;R<this._siblingOffset.length;R++)T&1<<R||this._construct(e,2*n+this._siblingOffset[R][0],2*s+this._siblingOffset[R][1],_,D+R)}}function Lp(t,e,n,s,h,g){return Jn(Jn(t,n,g),Jn(e,s,g),h)}function Dc(t,e,n){const s=n.dim,h=$t(t*s-.5,0,s-1),g=$t(e*s-.5,0,s-1),_=Math.floor(h),w=Math.floor(g),T=Math.min(_+1,s-1),D=Math.min(w+1,s-1);return Lp(n.get(_,w),n.get(T,w),n.get(_,D),n.get(T,D),h-_,g-w)}const Op={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class td{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,n,s,h=!1,g=!1){if(this.uid=e,n.height!==n.width)throw new RangeError("DEM tiles must be square");if(s&&"mapbox"!==s&&"terrarium"!==s)return vr(`"${s}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=n.height;const _=this.dim=n.height-2,w=new Uint32Array(n.data.buffer);if(this.pixels=new Uint8Array(n.data.buffer),this.encoding=s||"mapbox",this.borderReady=h,!h){for(let T=0;T<_;T++)w[this._idx(-1,T)]=w[this._idx(0,T)],w[this._idx(_,T)]=w[this._idx(_-1,T)],w[this._idx(T,-1)]=w[this._idx(T,0)],w[this._idx(T,_)]=w[this._idx(T,_-1)];w[this._idx(-1,-1)]=w[this._idx(0,0)],w[this._idx(_,-1)]=w[this._idx(_-1,0)],w[this._idx(-1,_)]=w[this._idx(0,_-1)],w[this._idx(_,_)]=w[this._idx(_-1,_-1)],g&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new kp(this)}get(e,n,s=!1){s&&(e=$t(e,-1,this.dim),n=$t(n,-1,this.dim));const h=4*this._idx(e,n);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(e){return Op[e]}get unpackVector(){return Op[this.encoding]}_idx(e,n){if(e<-1||e>=this.dim+1||n<-1||n>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(n+1)*this.stride+(e+1)}_unpackMapbox(e,n,s){return(256*e*256+256*n+s)/10-1e4}_unpackTerrarium(e,n,s){return 256*e+n+s/256-32768}static pack(e,n){const s=[0,0,0,0],h=td.getUnpackVector(n);let g=Math.floor((e+h[3])/h[2]);return s[2]=g%256,g=Math.floor(g/256),s[1]=g%256,g=Math.floor(g/256),s[0]=g,s}getPixels(){return new Fs({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,n,s){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let h=n*this.dim,g=n*this.dim+this.dim,_=s*this.dim,w=s*this.dim+this.dim;switch(n){case-1:h=g-1;break;case 1:g=h+1}switch(s){case-1:_=w-1;break;case 1:w=_+1}const T=-n*this.dim,D=-s*this.dim;for(let R=_;R<w;R++)for(let O=h;O<g;O++){const B=4*this._idx(O,R),V=4*this._idx(O+T,R+D);this.pixels[B+0]=e.pixels[V+0],this.pixels[B+1]=e.pixels[V+1],this.pixels[B+2]=e.pixels[V+2],this.pixels[B+3]=e.pixels[V+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}fn(td,"DEMData"),fn(kp,"DemMinMaxQuadTree",{omit:["dem"]});class ef{constructor(e,n){this.max=e,this.onRemove=n,this.reset()}reset(){for(const e in this.data)for(const n of this.data[e])n.timeout&&clearTimeout(n.timeout),this.onRemove(n.value);return this.data={},this.order=[],this}add(e,n,s){const h=e.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const g={value:n,timeout:void 0};if(void 0!==s&&(g.timeout=setTimeout(()=>{this.remove(e,g)},s)),this.data[h].push(g),this.order.push(h),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const n=this.data[e].shift();return n.timeout&&clearTimeout(n.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),n.value}getByKey(e){const n=this.data[e];return n?n[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,n){if(!this.has(e))return this;const s=e.wrapped().key,h=void 0===n?0:this.data[s].indexOf(n),g=this.data[s][h];return this.data[s].splice(h,1),g.timeout&&clearTimeout(g.timeout),0===this.data[s].length&&delete this.data[s],this.onRemove(g.value),this.order.splice(this.order.indexOf(s),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const n=this._getAndRemoveByKey(this.order[0]);n&&this.onRemove(n)}return this}filter(e){const n=[];for(const s in this.data)for(const h of this.data[s])e(h.value)||n.push(h);for(const s of n)this.remove(s.value.tileID,s)}}class Ka{constructor(e,n,s){this.func=e,this.mask=n,this.range=s}}Ka.ReadOnly=!1,Ka.ReadWrite=!0,Ka.disabled=new Ka(519,Ka.ReadOnly,[0,1]);class zp{constructor(e,n,s,h,g,_){this.test=e,this.ref=n,this.mask=s,this.fail=h,this.depthFail=g,this.pass=_}}zp.disabled=new zp({func:519,mask:0},0,0,7680,7680,7680);class fl{constructor(e,n,s){this.blendFunction=e,this.blendColor=n,this.mask=s}}fl.Replace=[1,0],fl.disabled=new fl(fl.Replace,Qr.transparent,[!1,!1,!1,!1]),fl.unblended=new fl(fl.Replace,Qr.transparent,[!0,!0,!0,!0]),fl.alphaBlended=new fl([1,771],Qr.transparent,[!0,!0,!0,!0]);class kl{constructor(e,n,s){this.enable=e,this.mode=n,this.frontFace=s}}kl.disabled=new kl(!1,1029,2305),kl.backCCW=new kl(!0,1029,2305),kl.backCW=new kl(!0,1029,2304),kl.frontCW=new kl(!0,1028,2304),kl.frontCCW=new kl(!0,1028,2305);class Sc extends Hi{constructor(e,n,s){super(),this.id=e,this._onlySymbols=s,n.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),n.on("error",()=>{this._sourceErrored=!0}),this._source=n,this._tiles={},this._cache=new ef(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=n.minTileCacheSize,this._maxTileCacheSize=n.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new vg,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const e in this._tiles){const n=this._tiles[e];if("loaded"!==n.state&&"errored"!==n.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,n){return e.isSymbolTile=this._onlySymbols,this._source.loadTile(e,n)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e,()=>{})}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e,()=>{})}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const n in this._tiles){const s=this._tiles[n];s.upload(e),s.prepare(this.map.style.imageManager)}}getIds(){return lt(this._tiles).map(e=>e.tileID).sort(J_).map(e=>e.key)}getRenderableIds(e){const n=[];for(const s in this._tiles)this._isIdRenderable(+s,e)&&n.push(this._tiles[s]);return e?n.sort((s,h)=>{const g=s.tileID,_=h.tileID,w=new dt(g.canonical.x,g.canonical.y)._rotate(this.transform.angle),T=new dt(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return g.overscaledZ-_.overscaledZ||T.y-w.y||T.x-w.x}).map(s=>s.tileID.key):n.map(s=>s.tileID).sort(J_).map(s=>s.key)}hasRenderableParent(e){const n=this.findLoadedParent(e,0);return!!n&&this._isIdRenderable(n.tileID.key)}_isIdRenderable(e,n){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(n||!this._tiles[e].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,n){const s=this._tiles[e];s&&("loading"!==s.state&&(s.state=n),this._loadTile(s,this._tileLoaded.bind(this,s,e,n)))}_tileLoaded(e,n,s,h){if(h)if(e.state="errored",404!==h.status)this._source.fire(new Ji(h,{tile:e}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const g=this.map.painter.terrain;this.update(this.transform,g.getScaledDemTileSize(),!0),g.resetTileLookupCache(this.id)}else this.update(this.transform);else e.timeAdded=xr.now(),"expired"===s&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this._source.type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new Or("data",{dataType:"source",tile:e,coord:e.tileID,sourceCacheId:this.id}))}_backfillDEM(e){const n=this.getRenderableIds();for(let h=0;h<n.length;h++){const g=n[h];if(e.neighboringTiles&&e.neighboringTiles[g]){const _=this.getTileByID(g);s(e,_),s(_,e)}}function s(h,g){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let _=g.tileID.canonical.x-h.tileID.canonical.x;const w=g.tileID.canonical.y-h.tileID.canonical.y,T=Math.pow(2,h.tileID.canonical.z),D=g.tileID.key;0===_&&0===w||Math.abs(w)>1||(Math.abs(_)>1&&(1===Math.abs(_+T)?_+=T:1===Math.abs(_-T)&&(_-=T)),g.dem&&h.dem&&(h.dem.backfillBorder(g.dem,_,w),h.neighboringTiles&&h.neighboringTiles[D]&&(h.neighboringTiles[D].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,n,s,h){for(const g in this._tiles){let _=this._tiles[g];if(h[g]||!_.hasData()||_.tileID.overscaledZ<=n||_.tileID.overscaledZ>s)continue;let w=_.tileID;for(;_&&_.tileID.overscaledZ>n+1;){const D=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[D.key],_&&_.hasData()&&(w=D)}let T=w;for(;T.overscaledZ>n;)if(T=T.scaledTo(T.overscaledZ-1),e[T.key]){h[w.key]=w;break}}}findLoadedParent(e,n){if(e.key in this._loadedParentTiles){const s=this._loadedParentTiles[e.key];return s&&s.tileID.overscaledZ>=n?s:null}for(let s=e.overscaledZ-1;s>=n;s--){const h=e.scaledTo(s),g=this._getLoadedTile(h);if(g)return g}}_getLoadedTile(e){const n=this._tiles[e.key];return n&&n.hasData()?n:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,n){n=n||this._source.tileSize;const s=Math.ceil(e.width/n)+1,h=Math.ceil(e.height/n)+1,g=Math.floor(s*h*5),_="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,g):g,w="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(w)}handleWrapJump(e){const n=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,n){const s={};for(const h in this._tiles){const g=this._tiles[h];g.tileID=g.tileID.unwrapTo(g.tileID.wrap+n),s[g.tileID.key]=g}this._tiles=s;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(e,n,s){if(this.transform=e,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!s)return;let h;this.updateCacheSize(e,n),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=e.getVisibleUnwrappedCoordinates(this._source.tileID).map(w=>new na(w.canonical.z,w.wrap,w.canonical.z,w.canonical.x,w.canonical.y)):(h=e.coveringTiles({tileSize:n||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!s,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(w=>this._source.hasTile(w)))):h=[];const g=this._updateRetainedTiles(h);if(Q_(this._source.type)&&0!==h.length){const w={},T={},D=Object.keys(g);for(const O of D){const B=g[O],V=this._tiles[O];if(!V||V.fadeEndTime&&V.fadeEndTime<=xr.now())continue;const G=this.findLoadedParent(B,Math.max(B.overscaledZ-Sc.maxOverzooming,this._source.minzoom));G&&(this._addTile(G.tileID),w[G.tileID.key]=G.tileID),T[O]=B}const R=h[h.length-1].overscaledZ;for(const O in this._tiles){const B=this._tiles[O];if(g[O]||!B.hasData())continue;let V=B.tileID;for(;V.overscaledZ>R;){V=V.scaledTo(V.overscaledZ-1);const G=this._tiles[V.key];if(G&&G.hasData()&&T[V.key]){g[O]=B.tileID;break}}}for(const O in w)g[O]||(this._coveredTiles[O]=!0,g[O]=w[O])}for(const w in g)this._tiles[w].clearFadeHold();const _=function(w,T){const D=[];for(const R in w)R in T||D.push(R);return D}(this._tiles,g);for(const w of _){const T=this._tiles[w];T.hasSymbolBuckets&&!T.holdingForFade()?T.setHoldDuration(this.map._fadeDuration):T.hasSymbolBuckets&&!T.symbolFadeFinished()||this._removeTile(+w)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const n={};if(0===e.length)return n;const s={},h=e.reduce((D,R)=>Math.min(D,R.overscaledZ),1/0),g=e[0].overscaledZ,_=Math.max(g-Sc.maxOverzooming,this._source.minzoom),w=Math.max(g+Sc.maxUnderzooming,this._source.minzoom),T={};for(const D of e){const R=this._addTile(D);n[D.key]=D,R.hasData()||h<this._source.maxzoom&&(T[D.key]=D)}this._retainLoadedChildren(T,h,w,n);for(const D of e){let R=this._tiles[D.key];if(R.hasData())continue;if(D.canonical.z>=this._source.maxzoom){const B=D.children(this._source.maxzoom)[0],V=this.getTile(B);if(V&&V.hasData()){n[B.key]=B;continue}}else{const B=D.children(this._source.maxzoom);if(n[B[0].key]&&n[B[1].key]&&n[B[2].key]&&n[B[3].key])continue}let O=R.wasRequested();for(let B=D.overscaledZ-1;B>=_;--B){const V=D.scaledTo(B);if(s[V.key]||(s[V.key]=!0,R=this.getTile(V),!R&&O&&(R=this._addTile(V)),R&&(n[V.key]=V,O=R.wasRequested(),R.hasData())))break}}return n}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const n=[];let s,h=this._tiles[e].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){s=this._loadedParentTiles[h.key];break}n.push(h.key);const g=h.scaledTo(h.overscaledZ-1);if(s=this._getLoadedTile(g),s)break;h=g}for(const g of n)this._loadedParentTiles[g]=s}}_addTile(e){let n=this._tiles[e.key];if(n)return n;n=this._cache.getAndRemove(e),n&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));const s=Boolean(n);if(!s){const h=this.map?this.map.painter:null;n=new Yd(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))}return n?(n.uses++,this._tiles[e.key]=n,s||this._source.fire(new Or("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null}_setTileReloadTimer(e,n){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const s=n.getExpiryTimeout();s&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},s))}_removeTile(e){const n=this._tiles[e];n&&(n.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),n.uses>0||(n.hasData()&&"reloading"!==n.state?this._cache.add(n.tileID,n,n.getExpiryTimeout()):(n.aborted=!0,this._abortTile(n),this._unloadTile(n))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(e,n,s){const h=[],g=this.transform;if(!g)return h;const _="globe"===g.projection.name,w=Sl(g.center.lng);for(const T in this._tiles){const D=this._tiles[T];if(s&&D.clearQueryDebugViz(),D.holdingForFade())continue;let R;if(_){const O=D.tileID.canonical;if(0===O.z){const B=[Math.abs($t(w,...rd(O,-1))-w),Math.abs($t(w,...rd(O,1))-w)];R=[0,2*B.indexOf(Math.min(...B))-1]}else{const B=[Math.abs($t(w,...rd(O,-1))-w),Math.abs($t(w,...rd(O,0))-w),Math.abs($t(w,...rd(O,1))-w)];R=[B.indexOf(Math.min(...B))-1]}}else R=[0];for(const O of R){const B=e.containsTile(D,g,n,O);B&&h.push(B)}}return h}getVisibleCoordinates(e){const n=this.getRenderableIds(e).map(s=>this._tiles[s].tileID);for(const s of n)s.projMatrix=this.transform.calculateProjMatrix(s.toUnwrapped());return n}hasTransition(){if(this._source.hasTransition())return!0;if(Q_(this._source.type))for(const e in this._tiles){const n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=xr.now())return!0}return!1}setFeatureState(e,n,s){this._state.updateState(e=e||"_geojsonTileLayer",n,s)}removeFeatureState(e,n,s){this._state.removeFeatureState(e=e||"_geojsonTileLayer",n,s)}getFeatureState(e,n){return this._state.getState(e=e||"_geojsonTileLayer",n)}setDependencies(e,n,s){const h=this._tiles[e];h&&h.setDependencies(n,s)}reloadTilesForDependencies(e,n){for(const s in this._tiles)this._tiles[s].hasDependency(e,n)&&this._reloadTile(+s,"reloading");this._cache.filter(s=>!s.hasDependency(e,n))}_preloadTiles(e,n){const s=new Map,h=Array.isArray(e)?e:[e],g=this.map.painter.terrain,_=this.usedForTerrain&&g?g.getScaledDemTileSize():this._source.tileSize;for(const w of h){const T=w.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of T)s.set(D.key,D);this.usedForTerrain&&w.updateElevation(!1)}Gt(Array.from(s.values()),(w,T)=>{const D=new Yd(w,this._source.tileSize*w.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(D,R=>{"raster-dem"===this._source.type&&D.dem&&this._backfillDEM(D),T(R,D)})},n)}}function J_(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),s=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||s-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Q_(t){return"raster"===t||"image"===t||"video"===t||"custom"===t}function rd(t,e){const n=1<<t.z;return[t.x/n+e,(t.x+1)/n+e]}Sc.maxOverzooming=10,Sc.maxUnderzooming=3;class tf{constructor(e,n,s){this._demTile=e,this._dem=this._demTile.dem,this._scale=n,this._offset=s}static create(e,n,s){const h=s||e.findDEMTileFor(n);if(!h||!h.dem)return;const g=h.dem,_=h.tileID,w=1<<n.canonical.z-_.canonical.z;return new tf(h,h.tileSize/er/w,[(n.canonical.x/w-_.canonical.x)*g.dim,(n.canonical.y/w-_.canonical.y)*g.dim])}tileCoordToPixel(e,n){const s=n*this._scale+this._offset[1],h=Math.floor(e*this._scale+this._offset[0]),g=Math.floor(s);return new dt(h,g)}getElevationAt(e,n,s,h){const g=e*this._scale+this._offset[0],_=n*this._scale+this._offset[1],w=Math.floor(g),T=Math.floor(_),D=this._dem;return h=!!h,s?Jn(Jn(D.get(w,T,h),D.get(w,T+1,h),_-T),Jn(D.get(w+1,T,h),D.get(w+1,T+1,h),_-T),g-w):D.get(w,T,h)}getElevationAtPixel(e,n,s){return this._dem.get(e,n,!!s)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*Il(1,e)*this._dem.stride}}class Bp{constructor(e,n){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new vl(er,16,0),this.featureIndexArray=new Zs,this.promoteId=n}insert(e,n,s,h,g,_=0){const w=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(s,h,g,_);const T=this.grid;for(let D=0;D<n.length;D++){const R=n[D],O=[1/0,1/0,-1/0,-1/0];for(let B=0;B<R.length;B++){const V=R[B];O[0]=Math.min(O[0],V.x),O[1]=Math.min(O[1],V.y),O[2]=Math.max(O[2],V.x),O[3]=Math.max(O[3],V.y)}O[0]<er&&O[1]<er&&O[2]>=0&&O[3]>=0&&T.insert(w,O[0],O[1],O[2],O[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Ad(new Ju(this.rawTileData)).layers,this.sourceLayerCoder=new Dp(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,n,s,h){this.loadVTLayers();const g=e.params||{},_=Ca(g.filter),w=e.tileResult,T=e.transform,D=w.bufferedTilespaceBounds,R=this.grid.query(D.min.x,D.min.y,D.max.x,D.max.y,(G,J,ce,xe)=>kh(w.bufferedTilespaceGeometry,G,J,ce,xe));R.sort(xs);let O=null;T.elevation&&R.length>0&&(O=tf.create(T.elevation,this.tileID));const B={};let V;for(let G=0;G<R.length;G++){const J=R[G];if(J===V)continue;V=J;const ce=this.featureIndexArray.get(J);let xe=null;this.loadMatchingFeature(B,ce,_,g.layers,g.availableImages,n,s,h,(Me,ve,Se,Le=0)=>(xe||(xe=Gl(Me,this.tileID.canonical,e.tileTransform)),ve.queryIntersectsFeature(w,Me,Se,xe,this.z,e.transform,e.pixelPosMatrix,O,Le)))}return B}loadMatchingFeature(e,n,s,h,g,_,w,T,D){const{featureIndex:R,bucketIndex:O,sourceLayerIndex:B,layoutVertexArrayOffset:V}=n,G=this.bucketLayerIDs[O];if(h&&!function(Me,ve){for(let Se=0;Se<Me.length;Se++)if(ve.indexOf(Me[Se])>=0)return!0;return!1}(h,G))return;const J=this.sourceLayerCoder.decode(B),ce=this.vtLayers[J].feature(R);if(s.needGeometry){const Me=Wc(ce,!0);if(!s.filter(new He(this.tileID.overscaledZ),Me,this.tileID.canonical))return}else if(!s.filter(new He(this.tileID.overscaledZ),ce))return;const xe=this.getId(ce,J);for(let Me=0;Me<G.length;Me++){const ve=G[Me];if(h&&h.indexOf(ve)<0)continue;const Se=_[ve];if(!Se)continue;let Le={};void 0!==xe&&T&&(Le=T.getState(Se.sourceLayer||"_geojsonTileLayer",xe));const Pe=rt({},w[ve]);Pe.paint=xg(Pe.paint,Se.paint,ce,Le,g),Pe.layout=xg(Pe.layout,Se.layout,ce,Le,g);const Ke=!D||D(ce,Se,Le,V);if(!Ke)continue;const Ze=new Sp(ce,this.z,this.x,this.y,xe);Ze.layer=Pe;let _t=e[ve];void 0===_t&&(_t=e[ve]=[]),_t.push({featureIndex:R,feature:Ze,intersectionZ:Ke})}}lookupSymbolFeatures(e,n,s,h,g,_,w,T){const D={};this.loadVTLayers();const R=Ca(g);for(const O of e)this.loadMatchingFeature(D,{bucketIndex:s,sourceLayerIndex:h,featureIndex:O,layoutVertexArrayOffset:0},R,_,w,T,n);return D}loadFeature(e){const{featureIndex:n,sourceLayerIndex:s}=e;this.loadVTLayers();const h=this.sourceLayerCoder.decode(s),g=this.vtFeatures[h];if(g[n])return g[n];const _=this.vtLayers[h].feature(n);return g[n]=_,_}hasLayer(e){for(const n of this.bucketLayerIDs)for(const s of n)if(e===s)return!0;return!1}getId(e,n){let s=e.id;if(this.promoteId){const h="string"==typeof this.promoteId?this.promoteId:this.promoteId[n];null!=h&&(s=e.properties[h]),"boolean"==typeof s&&(s=Number(s))}return s}}function xg(t,e,n,s,h){return vn(t,(g,_)=>{const w=e instanceof Ye?e.get(_):null;return w&&w.evaluate?w.evaluate(n,s,h):w})}function xs(t,e){return e-t}fn(Bp,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Np{constructor(e,n){this.width=e,this.height=n,this.nextRow=0,this.image=new _c({width:e,height:n}),this.positions={},this.uploaded=!1}getDash(e,n){const s=this.getKey(e,n);return this.positions[s]}trim(){const e=this.width,n=this.height=Nt(this.nextRow);this.image.resize({width:e,height:n})}getKey(e,n){return e.join(",")+n}getDashRanges(e,n,s){const h=[];let g=e.length%2==1?-e[e.length-1]*s:0,_=e[0]*s,w=!0;h.push({left:g,right:_,isDash:w,zeroLength:0===e[0]});let T=e[0];for(let D=1;D<e.length;D++){w=!w;const R=e[D];g=T*s,T+=R,_=T*s,h.push({left:g,right:_,isDash:w,zeroLength:0===R})}return h}addRoundDash(e,n,s){const h=n/2;for(let g=-s;g<=s;g++){const _=this.width*(this.nextRow+s+g);let w=0,T=e[w];for(let D=0;D<this.width;D++){D/T.right>1&&(T=e[++w]);const R=Math.abs(D-T.left),O=Math.abs(D-T.right),B=Math.min(R,O);let V;const G=g/s*(h+1);if(T.isDash){const J=h-Math.abs(G);V=Math.sqrt(B*B+J*J)}else V=h-Math.sqrt(B*B+G*G);this.image.data[_+D]=Math.max(0,Math.min(255,V+128))}}}addRegularDash(e,n){for(let T=e.length-1;T>=0;--T){const D=e[T],R=e[T+1];D.zeroLength?e.splice(T,1):R&&R.isDash===D.isDash&&(R.left=D.left,e.splice(T,1))}const s=e[0],h=e[e.length-1];s.isDash===h.isDash&&(s.left=h.left-this.width,h.right=s.right+this.width);const g=this.width*this.nextRow;let _=0,w=e[_];for(let T=0;T<this.width;T++){T/w.right>1&&(w=e[++_]);const D=Math.abs(T-w.left),R=Math.abs(T-w.right),O=Math.min(D,R);this.image.data[g+T]=Math.max(0,Math.min(255,(w.isDash?O:-O)+n+128))}}addDash(e,n){const s=this.getKey(e,n);if(this.positions[s])return this.positions[s];const h="round"===n,g=h?7:0,_=2*g+1;if(this.nextRow+_>this.height)return vr("LineAtlas out of space"),null;0===e.length&&e.push(1);let w=0;for(let R=0;R<e.length;R++)e[R]<0&&(vr("Negative value is found in line dasharray, replacing values with 0"),e[R]=0),w+=e[R];if(0!==w){const R=this.width/w,O=this.getDashRanges(e,this.width,R);h?this.addRoundDash(O,R,g):this.addRegularDash(O,"square"===n?.5*R:0)}const T=this.nextRow+g;this.nextRow+=_;const D={tl:[T,g],br:[w,0]};return this.positions[s]=D,D}}fn(Np,"LineAtlas");class wg{constructor(e){const n={},s=[];for(const w in e){const T=e[w],D=n[w]={};for(const R in T.glyphs){const O=T.glyphs[+R];if(!O||0===O.bitmap.width||0===O.bitmap.height)continue;const B=O.metrics.localGlyph?2:1,V={x:0,y:0,w:O.bitmap.width+2*B,h:O.bitmap.height+2*B};s.push(V),D[R]=V}}const{w:h,h:g}=sp(s),_=new _c({width:h||1,height:g||1});for(const w in e){const T=e[w];for(const D in T.glyphs){const R=T.glyphs[+D];if(!R||0===R.bitmap.width||0===R.bitmap.height)continue;const O=n[w][D],B=R.metrics.localGlyph?2:1;_c.copy(R.bitmap,_,{x:0,y:0},{x:O.x+B,y:O.y+B},R.bitmap)}}this.image=_,this.positions=n}}fn(wg,"GlyphAtlas");class ey{constructor(e){this.tileID=new na(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.tileZoom=e.tileZoom,this.uid=e.uid,this.zoom=e.zoom,this.canonical=e.tileID.canonical,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId,this.enableTerrain=!!e.enableTerrain,this.isSymbolTile=e.isSymbolTile,this.tileTransform=bu(e.tileID.canonical,e.projection),this.projection=e.projection}parse(e,n,s,h,g){this.status="parsing",this.data=e,this.collisionBoxArray=new cf;const _=new Dp(Object.keys(e.layers).sort()),w=new Bp(this.tileID,this.promoteId);w.bucketLayerIDs=[];const T={},D=new Np(256,256),R={featureIndex:w,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:D,availableImages:s},O=n.familiesBySource[this.source];for(const Le in O){const Pe=e.layers[Le];if(!Pe)continue;let Ke=!1,Ze=!1;for(const ot of O[Le])"symbol"===ot[0].type?Ke=!0:Ze=!0;if(!0===this.isSymbolTile&&!Ke||!1===this.isSymbolTile&&!Ze)continue;1===Pe.version&&vr(`Vector tile source "${this.source}" layer "${Le}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const _t=_.encode(Le),jt=[];for(let ot=0;ot<Pe.length;ot++){const vt=Pe.feature(ot),wt=w.getId(vt,Le);jt.push({feature:vt,id:wt,index:ot,sourceLayerIndex:_t})}for(const ot of O[Le]){const vt=ot[0];void 0!==this.isSymbolTile&&"symbol"===vt.type!==this.isSymbolTile||vt.minzoom&&this.zoom<Math.floor(vt.minzoom)||vt.maxzoom&&this.zoom>=vt.maxzoom||"none"!==vt.visibility&&(nf(ot,this.zoom,s),(T[vt.id]=vt.createBucket({index:w.bucketLayerIDs.length,layers:ot,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:_t,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:s})).populate(jt,R,this.tileID.canonical,this.tileTransform),w.bucketLayerIDs.push(ot.map(wt=>wt.id)))}}let B,V,G,J;D.trim();const ce={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},xe=vn(R.glyphDependencies,Le=>Object.keys(Le).map(Number));Object.keys(xe).length?h.send("getGlyphs",{uid:this.uid,stacks:xe},(Le,Pe)=>{B||(B=Le,V=Pe,Se.call(this))},void 0,!1,ce):V={};const Me=Object.keys(R.iconDependencies);Me.length?h.send("getImages",{icons:Me,source:this.source,tileID:this.tileID,type:"icons"},(Le,Pe)=>{B||(B=Le,G=Pe,Se.call(this))},void 0,!1,ce):G={};const ve=Object.keys(R.patternDependencies);function Se(){if(B)return g(B);if(V&&G&&J){const Le=new wg(V),Pe=new ng(G,J);for(const Ke in T){const Ze=T[Ke];Ze instanceof Jc?(nf(Ze.layers,this.zoom,s),W_(Ze,V,Le.positions,G,Pe.iconPositions,this.showCollisionBoxes,s,this.tileID.canonical,this.tileZoom,this.projection)):Ze.hasPattern&&(Ze instanceof vc||Ze instanceof Id||Ze instanceof Pd)&&(nf(Ze.layers,this.zoom,s),Ze.addFeatures(R,this.tileID.canonical,Pe.patternPositions,s,this.tileTransform))}this.status="done",g(null,{buckets:lt(T).filter(Ke=>!Ke.isEmpty()),featureIndex:w,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Le.image,lineAtlas:D,imageAtlas:Pe,glyphMap:this.returnDependencies?V:null,iconMap:this.returnDependencies?G:null,glyphPositions:this.returnDependencies?Le.positions:null})}}ve.length?h.send("getImages",{icons:ve,source:this.source,tileID:this.tileID,type:"patterns"},(Le,Pe)=>{B||(B=Le,J=Pe,Se.call(this))},void 0,!1,ce):J={},Se.call(this)}}function nf(t,e,n){const s=new He(e);for(const h of t)h.recalculate(s,n)}class bg{constructor(e){this.entries={},this.scheduler=e}request(e,n,s,h){const g=this.entries[e]=this.entries[e]||{callbacks:[]};if(g.result){const[_,w]=g.result;return this.scheduler?this.scheduler.add(()=>{h(_,w)},n):h(_,w),()=>{}}return g.callbacks.push(h),g.cancel||(g.cancel=s((_,w)=>{g.result=[_,w];for(const T of g.callbacks)this.scheduler?this.scheduler.add(()=>{T(_,w)},n):T(_,w);setTimeout(()=>delete this.entries[e],3e3)})),()=>{g.result||(g.callbacks=g.callbacks.filter(_=>_!==h),g.callbacks.length||(g.cancel(),delete this.entries[e]))}}}function Up(t,e,n){const s=JSON.stringify(t.request);return t.data&&(this.deduped.entries[s]={result:[null,t.data]}),this.deduped.request(s,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},h=>{const g=Nr(t.request,(_,w,T,D)=>{_?h(_):w&&h(null,{vectorTile:n?void 0:new Ad(new Ju(w)),rawData:w,cacheControl:T,expires:D})});return()=>{g.cancel(),h()}},e)}u.ARRAY_TYPE=ga,u.AUTH_ERR_MSG=gr,u.Aabb=_a,u.Actor=class{constructor(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},yr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=ni()?t:Ie,this.scheduler=new Tp}send(t,e,n,s,h=!1,g){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=g,this.callbacks[_]=n);const w=yi(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:t,hasCallback:!!n,targetMapId:s,mustQueue:h,sourceMapId:this.mapId,data:xl(e,w)},w),{cancel:()=>{n&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:s,sourceMapId:this.mapId})}}}receive(t){const e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const s=this.cancelCallbacks[n];delete this.cancelCallbacks[n],s&&s.cancel()}else if(e.mustQueue||ni()){const s=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),s&&s.metadata||{type:"message"})}else this.processTask(n,e)}processTask(t,e){if("<response>"===e.type){const n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(Va(e.error)):n(null,Va(e.data)))}else{const n=yi(this.globalScope)?void 0:[],s=e.hasCallback?(g,_)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:g?xl(g):null,data:xl(_,n)},n)}:g=>{},h=Va(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,h,s);else if(this.parent.getWorkerSource){const g=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,g[0],h.source)[g[1]](h,s)}else s(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},u.CanonicalTileID=kd,u.Color=Qr,u.ColorMode=fl,u.CullFaceMode=kl,u.DEMData=td,u.DataConstantProperty=Ge,u.DedupedRequest=bg,u.DepthMode=Ka,u.EXTENT=er,u.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(this.isUsingMockSource()||!e||t.y<0||t.y>1)return!1;const n=e.getSource().maxzoom,s=1<<n,h=Math.floor(t.x),g=Math.floor((t.x-h)*s),_=Math.floor(t.y*s),w=this.findDEMTileFor(new na(n,h,n,g,_));return!(!w||!w.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){if(this.isUsingMockSource())return null;null==e&&(e=null);const s=this._source();if(!s||t.y<0||t.y>1)return e;const h=s.getSource().maxzoom,g=1<<h,_=Math.floor(t.x),w=t.x-_,T=new na(h,_,h,Math.floor(w*g),Math.floor(t.y*g)),D=this.findDEMTileFor(T);if(!D||!D.dem)return e;const R=D.dem,O=1<<D.tileID.canonical.z,B=(w*O-D.tileID.canonical.x)*R.dim,V=(t.y*O-D.tileID.canonical.y)*R.dim,G=Math.floor(B),J=Math.floor(V);return(n?this.exaggeration():1)*Jn(Jn(R.get(G,J),R.get(G,J+1),V-J),Jn(R.get(G+1,J),R.get(G+1,J+1),V-J),B-G)}getAtTileOffset(t,e,n){const s=1<<t.canonical.z;return this.getAtPointOrZero(new Ih(t.wrap+(t.canonical.x+e/er)/s,(t.canonical.y+n/er)/s))}getAtTileOffsetFunc(t,e,n,s){return h=>{const g=this.getAtTileOffset(t,h.x,h.y),_=s.upVector(t.canonical,h.x,h.y);return Pa(_,_,g*s.upVectorScale(t.canonical,e,n).metersToTile),_}}getForTilePoints(t,e,n,s){if(this.isUsingMockSource())return!1;const h=tf.create(this,t,s);return!!h&&(e.forEach(g=>{g[2]=this.exaggeration()*h.getElevationAt(g[0],g[1],n)}),!0)}getMinMaxForTile(t){if(this.isUsingMockSource())return null;const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const n=e.dem.tree,s=e.tileID,h=1<<t.canonical.z-s.canonical.z;let g=t.canonical.x/h-s.canonical.x,_=t.canonical.y/h-s.canonical.y,w=0;for(let T=0;T<t.canonical.z-s.canonical.z&&!n.leaves[w];T++){g*=2,_*=2;const D=2*Math.floor(_)+Math.floor(g);w=n.childOffsets[w]+D,g%=1,_%=1}return{min:this.exaggeration()*n.minimums[w],max:this.exaggeration()*n.maximums[w]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},u.ErrorEvent=Ji,u.EvaluationParameters=He,u.Event=Or,u.Evented=Hi,u.FillExtrusionBucket=Pd,u.Frustum=bf,u.FrustumCorners=fu,u.GLOBE_RADIUS=pc,u.GLOBE_SCALE_MATCH_LATITUDE=45,u.GLOBE_ZOOM_THRESHOLD_MAX=6,u.GLOBE_ZOOM_THRESHOLD_MIN=5,u.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();for(const t of this._gridSegments)t.withSkirts.destroy(),t.withoutSkirts.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const t of this._wireframeSegments)t.destroy()}}_fillGridMeshWithLods(t,e){const n=new zn,s=new gs,h=[],g=t+1+2,_=e[0]+1,w=e[0]+1+(1+e.length),T=(D,R,O)=>{let B=D===g-1?D-2:0===D?D:D-1;return B+=O?24575:0,[B,R]};for(let D=0;D<g;++D)n.emplaceBack(...T(D,0,!0));for(let D=0;D<_;++D)for(let R=0;R<g;++R)n.emplaceBack(...T(R,D,(0===R||R===g-1)&&!0));for(let D=0;D<e.length;++D){const R=e[D];for(let O=0;O<g;++O)n.emplaceBack(...T(O,R,!0))}for(let D=0;D<e.length;++D){const R=s.length,O=e[D]+1+2,B=new gs;for(let J=0;J<O-1;J++){const ce=J===O-2,xe=ce?g*(w-e.length+D-J):g;for(let Me=0;Me<g-1;Me++){const ve=J*g+Me;0===J||ce||0===Me||Me===g-2?(B.emplaceBack(ve+1,ve,ve+xe),B.emplaceBack(ve+xe,ve+xe+1,ve+1)):(s.emplaceBack(ve+1,ve,ve+xe),s.emplaceBack(ve+xe,ve+xe+1,ve+1))}}const V=yo.simpleSegment(0,R,n.length,s.length-R);for(let J=0;J<B.uint16.length;J+=3)s.emplaceBack(B.uint16[J],B.uint16[J+1],B.uint16[J+2]);const G=yo.simpleSegment(0,R,n.length,s.length-R);h.push({withoutSkirts:V,withSkirts:G})}return{vertices:n,indices:s,segments:h}}_createGrid(t){const e=this._fillGridMeshWithLods(64,md);this._gridSegments=e.segments,this._gridBuffer=t.createVertexBuffer(e.vertices,Th.members),this._gridIndexBuffer=t.createIndexBuffer(e.indices,!0)}_createPoles(t){const e=new gs;for(let h=0;h<=64;h++)e.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const n=new Ma,s=new Ma;this._poleSegments=[];for(let h=0,g=0;h<5;h++){const _=360/(1<<h);n.emplaceBack(0,-pc,0,.5,0),s.emplaceBack(0,-pc,0,.5,1);for(let w=0;w<=64;w++){const T=w/64,D=Jn(0,_,T),[R,O,B]=Ch(Yg,Mf,D,pc);n.emplaceBack(R,O,B,T,0),s.emplaceBack(R,O,B,T,1)}this._poleSegments.push(yo.simpleSegment(g,0,66,64)),g+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,_m,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(s,_m,!1)}getGridBuffers(t,e){return[this._gridBuffer,this._gridIndexBuffer,e?this._gridSegments[t].withSkirts:this._gridSegments[t].withoutSkirts]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t,e){if(!this._wireframeSegments){const n=new El,s=64,h=s+1+2,g=1;this._wireframeSegments=[];for(let _=0,w=0;_<md.length;_++){const T=md[_];for(let R=g;R<T+g;R++)for(let O=g;O<s+g;O++){const B=R*h+O;n.emplaceBack(B,B+1),n.emplaceBack(B,B+h),n.emplaceBack(B,B+h+1)}const D=T*s*3;this._wireframeSegments.push(yo.simpleSegment(0,w,(T+1)*h,D)),w+=D}this._wireframeIndexBuffer=t.createIndexBuffer(n)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[e]]}},u.GlyphManager=nh,u.ImagePosition=Bd,u.LivePerformanceUtils=je,u.LngLat=Vr,u.LngLatBounds=Ia,u.LocalGlyphMode=ag,u.MAX_MERCATOR_LATITUDE=ys,u.MercatorCoordinate=Ih,u.ONE_EM=vs,u.OverscaledTileID=na,u.PerformanceMarkers=pe,u.Properties=Bt,u.RGBAImage=Fs,u.Ray=$l,u.RequestManager=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const t=function(){let e="";for(let n=0;n<10;n++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",hn,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!so(t))return t;const n=Re(t);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!so(t))return t;const n=Re(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e,n,s){if(!so(t))return t;const h=Re(t);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),n&&h.params.push(`language=${n}`),s&&h.params.push(`worldview=${s}`),this._makeAPIURL(h,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,s){const h=Re(t);return so(t)?(h.path=`/styles/v1${h.path}/sprite${e}${n}`,this._makeAPIURL(h,this._customAccessToken||s)):(h.path+=`${e}${n}`,Wt(h))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!so(t))return t;const s=Re(t);s.path=s.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&"raster"!==s.authority&&512===n?"@2x":""}${gt.supported?".webp":"$1"}`),"raster"===s.authority?s.path=`/${bt.RASTER_URL_PREFIX}${s.path}`:(s.path=s.path.replace(/^.+\/v4\//,"/"),s.path=`/${bt.TILE_URL_VERSION}${s.path}`);const h=this._customAccessToken||function(g){for(const _ of g){const w=_.match(/^access_token=(.*)$/);if(w)return w[1]}return null}(s.params)||bt.ACCESS_TOKEN;return bt.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&s.params.push(`sku=${this._skuToken}`),this._makeAPIURL(s,h)}canonicalizeTileURL(t,e){const n=Re(t);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let s="mapbox://";n.path.match(/^\/raster\/v1\//)?s+=`raster/${n.path.replace(`/${bt.RASTER_URL_PREFIX}/`,"")}`:s+=`tiles/${n.path.replace(`/${bt.TILE_URL_VERSION}/`,"")}`;let h=n.params;return e&&(h=h.filter(g=>!g.match(/^access_token=/))),h.length&&(s+=`?${h.join("&")}`),s}canonicalizeTileset(t,e){const n=!!e&&so(e),s=[];for(const h of t.tiles||[])kn(h)?s.push(this.canonicalizeTileURL(h,n)):s.push(h);return s}_makeAPIURL(t,e){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",s=Re(bt.API_URL);if(t.protocol=s.protocol,t.authority=s.authority,"http"===t.protocol){const h=t.params.indexOf("secure");h>=0&&t.params.splice(h,1)}if("/"!==s.path&&(t.path=`${s.path}${t.path}`),!bt.REQUIRE_ACCESS_TOKEN)return Wt(t);if(e=e||bt.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(h=>-1===h.indexOf("access_token")),t.params.push(`access_token=${e||""}`),Wt(t)}},u.ResourceType=on,u.SegmentVector=yo,u.SourceCache=Sc,u.StencilMode=zp,u.StructArrayLayout1ui2=cl,u.StructArrayLayout2f1f2i16=ps,u.StructArrayLayout2i4=zn,u.StructArrayLayout2ui4=El,u.StructArrayLayout3f12=ms,u.StructArrayLayout3ui6=gs,u.StructArrayLayout4i8=pi,u.StructArrayLayout5f20=Ma,u.Texture=Mu,u.Tile=Yd,u.Transitionable=qt,u.Uniform1f=Bc,u.Uniform1i=class extends uc{constructor(t){super(t),this.current=0}set(t,e,n){this.fetchUniformLocation(t,e)&&this.current!==n&&(this.current=n,this.gl.uniform1i(this.location,n))}},u.Uniform2f=class extends uc{constructor(t){super(t),this.current=[0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]||(this.current=n,this.gl.uniform2f(this.location,n[0],n[1])))}},u.Uniform3f=class extends uc{constructor(t){super(t),this.current=[0,0,0]}set(t,e,n){this.fetchUniformLocation(t,e)&&(n[0]===this.current[0]&&n[1]===this.current[1]&&n[2]===this.current[2]||(this.current=n,this.gl.uniform3f(this.location,n[0],n[1],n[2])))}},u.Uniform4f=cm,u.UniformColor=um,u.UniformMatrix2f=class extends uc{constructor(t){super(t),this.current=hm}set(t,e,n){if(this.fetchUniformLocation(t,e))for(let s=0;s<4;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix2fv(this.location,!1,n);break}}},u.UniformMatrix3f=class extends uc{constructor(t){super(t),this.current=pf}set(t,e,n){if(this.fetchUniformLocation(t,e))for(let s=0;s<9;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix3fv(this.location,!1,n);break}}},u.UniformMatrix4f=class extends uc{constructor(t){super(t),this.current=ff}set(t,e,n){if(this.fetchUniformLocation(t,e)){if(n[12]!==this.current[12]||n[0]!==this.current[0])return this.current=n,void this.gl.uniformMatrix4fv(this.location,!1,n);for(let s=1;s<16;s++)if(n[s]!==this.current[s]){this.current=n,this.gl.uniformMatrix4fv(this.location,!1,n);break}}}},u.UnwrappedTileID=Hm,u.ValidationError=yt,u.VectorTileFeature=Bh,u.VectorTileWorkerSource=class extends Hi{constructor(t,e,n,s,h){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=h||Up,this.loading={},this.loaded={},this.deduped=new bg(t.scheduler),this.isSpriteLoaded=s,this.scheduler=t.scheduler}loadTile(t,e){const n=t.uid,s=t&&t.request,h=s&&s.collectResourceTiming,g=this.loading[n]=new ey(t);g.abort=this.loadVectorData(t,(_,w)=>{const T=!this.loading[n];if(delete this.loading[n],T||_||!w)return g.status="done",T||(this.loaded[n]=g),e(_);const D=w.rawData,R={};w.expires&&(R.expires=w.expires),w.cacheControl&&(R.cacheControl=w.cacheControl),g.vectorTile=w.vectorTile||new Ad(new Ju(D));const O=()=>{g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,(B,V)=>{if(B||!V)return e(B);const G={};if(h){const J=sn(s);J.length>0&&(G.resourceTiming=JSON.parse(JSON.stringify(J)))}e(null,rt({rawTileData:D.slice(0)},V,R,G))})};this.isSpriteLoaded?O():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(O,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):O()}),this.loaded=this.loaded||{},this.loaded[n]=g})}reloadTile(t,e){const n=this.loaded,s=t.uid,h=this;if(n&&n[s]){const g=n[s];g.showCollisionBoxes=t.showCollisionBoxes,g.enableTerrain=!!t.enableTerrain,g.projection=t.projection,g.tileTransform=bu(t.tileID.canonical,t.projection);const _=(w,T)=>{const D=g.reloadCallback;D&&(delete g.reloadCallback,g.parse(g.vectorTile,h.layerIndex,this.availableImages,h.actor,D)),e(w,T)};"parsing"===g.status?g.reloadCallback=_:"done"===g.status&&(g.vectorTile?g.parse(g.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(t,e){const n=t.uid,s=this.loading[n];s&&(s.abort&&s.abort(),delete this.loading[n]),e()}removeTile(t,e){const n=this.loaded,s=t.uid;n&&n[s]&&delete n[s],e()}},u.WritingMode=Za,u.ZoomDependentExpression=Ft,u.add=dc,u.addDynamicAttributes=Jh,u.adjoint=function(t,e){var n=e[0],s=e[1],h=e[2],g=e[3],_=e[4],w=e[5],T=e[6],D=e[7],R=e[8];return t[0]=_*R-w*D,t[1]=h*D-s*R,t[2]=s*w-h*_,t[3]=w*T-g*R,t[4]=n*R-h*T,t[5]=h*g-n*w,t[6]=g*D-_*T,t[7]=s*T-n*D,t[8]=n*_-s*g,t},u.asyncAll=Gt,u.bezier=en,u.bindAll=yr,u.boundsAttributes=Ip,u.bufferConvexPolygon=function(t,e){const n=[];for(let s=0;s<t.length;s++){const h=mn(s-1,-1,t.length-1),g=mn(s+1,-1,t.length-1),_=t[s],w=t[g],T=t[h].sub(_).unit(),D=w.sub(_).unit(),R=D.angleWithSep(T.x,T.y),O=T.add(D).unit().mult(-1*e/Math.sin(R/2));n.push(_.add(O))}return n},u.cacheEntryPossiblyAdded=function(t){Mr++,Mr>So&&(t.getActor().send("enforceCacheSizeLimit",Pi),Mr=0)},u.calculateGlobeLabelMatrix=function(t,e){const{x:n,y:s}=t.point,h=bm(n,s,t.worldSize/t._pixelsPerMercatorPixel,0,0);return Vc(h,h,Sf(Ls(e)))},u.calculateGlobeMatrix=function(t){const{x:e,y:n}=t.point,{lng:s,lat:h}=t._center;return bm(e,n,t.worldSize,s,h)},u.calculateGlobeMercatorMatrix=function(t){const e=t.pixelsPerMeter,n=e/Il(1,t.center.lat),s=Aa(new Float64Array(16));return Bu(s,s,[t.point.x,t.point.y,0]),$c(s,s,[n,n,e]),Float32Array.from(s)},u.circumferenceAtLatitude=If,u.clamp=$t,u.clearTileCache=function(t){if(!Vn())return;const e=Ie.caches.delete(jr);t&&e.catch(t).then(()=>t())},u.clipLine=og,u.clone=function(t){var e=new ga(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},u.clone$1=cn,u.collisionCircleLayout=Fd,u.config=bt,u.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},u.create=function(){var t=new ga(16);return ga!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},u.create$1=fm,u.createExpression=fe,u.createLayout=Rn,u.createStyleLayer=function(t){return"custom"===t.type?new Xd(t):new Y_[t.type](t)},u.cross=Gc,u.degToRad=Ne,u.distance=function(t,e){return Math.hypot(e[0]-t[0],e[1]-t[1],e[2]-t[2])},u.div=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},u.dot=Ra,u.earthRadius=Mh,u.ease=Xt,u.easeCubicInOut=Ue,u.ecefToLatLng=function([t,e,n]){const s=Math.hypot(t,e,n),h=Math.atan2(t,n),g=.5*Math.PI-Math.acos(-e/s);return new Vr(mt(h),mt(g))},u.emitValidationErrors=Ps,u.endsWith=or,u.enforceCacheSizeLimit=function(t){yn(),Br&&Br.then(e=>{e.keys().then(n=>{for(let s=0;s<n.length-t;s++)e.delete(n[s])})})},u.evaluateSizeForFeature=Yu,u.evaluateSizeForZoom=wu,u.evaluateVariableOffset=hg,u.evented=De,u.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},u.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},u.exported=xr,u.exported$1=gt,u.extend=rt,u.extend$1=$r,u.fillExtrusionHeightLift=Gm,u.filterObject=In,u.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},u.fromQuat=function(t,e){var n=e[0],s=e[1],h=e[2],g=e[3],_=n+n,w=s+s,T=h+h,D=n*_,R=s*_,O=s*w,B=h*_,V=h*w,G=h*T,J=g*_,ce=g*w,xe=g*T;return t[0]=1-O-G,t[1]=R+xe,t[2]=B-ce,t[3]=0,t[4]=R-xe,t[5]=1-D-G,t[6]=V+J,t[7]=0,t[8]=B+ce,t[9]=V-J,t[10]=1-D-O,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},u.fromRotation=function(t,e){var n=Math.sin(e),s=Math.cos(e);return t[0]=s,t[1]=n,t[2]=0,t[3]=-n,t[4]=s,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},u.fromScaling=yh,u.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return ln[e]},u.getAABBPointSquareDist=function(t,e,n){let s=0;for(let h=0;h<2;++h){const g=n?n[h]:0;t[h]>g&&(s+=(t[h]-g)*(t[h]-g)),e[h]<g&&(s+=(g-e[h])*(g-e[h]))}return s},u.getAnchorAlignment=$d,u.getAnchorJustification=pp,u.getBounds=function(t){let e=1/0,n=1/0,s=-1/0,h=-1/0;for(const g of t)e=Math.min(e,g.x),n=Math.min(n,g.y),s=Math.max(s,g.x),h=Math.max(h,g.y);return{min:new dt(e,n),max:new dt(s,h)}},u.getColumn=Pn,u.getGridMatrix=function(t,e,n,s){const h=e.getNorth(),g=e.getSouth(),_=e.getWest(),w=e.getEast(),T=1<<t.z,D=w-_,R=h-g,O=D/64,B=-R/md[n],V=[0,O,0,B,0,0,h,_,0];if(t.z>0){const G=180/s;Gg(V,V,[G/D+1,0,0,0,G/R+1,0,-.5*G/O,.5*G/B,1])}return V[2]=T,V[5]=t.x,V[8]=t.y,V},u.getImage=po,u.getJSON=function(t,e){return dr(rt(t,{type:"json"}),e)},u.getLatitudinalLod=function(t){const e=ys-5;t=$t(t,-e,e)/e*90;const n=Math.pow(Math.abs(Math.sin(Ne(t))),3);return Math.round(n*(md.length-1))},u.getMapSessionAPI=q,u.getPerformanceMeasurement=sn,u.getProjection=yp,u.getRTLTextPluginStatus=ke,u.getReferrer=vi,u.getTilePoint=function(t,{x:e,y:n},s=0){return new dt(((e-s)*t.scale-t.x)*er,(n*t.scale-t.y)*er)},u.getTileVec3=function(t,e,n=0){return Vl(((e.x-n)*t.scale-t.x)*er,(e.y*t.scale-t.y)*er,Tm(e.z,e.y))},u.getVideo=function(t,e){const n=Ie.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let s=0;s<t.length;s++){const h=Ie.document.createElement("source");io(t[s])||(n.crossOrigin="Anonymous"),h.src=t[s],n.appendChild(h)}return{cancel:()=>{}}},u.globeCenterToScreenPoint=function(t){const e=[0,0,0],n=Aa(new Float64Array(16));return Vc(n,t.pixelMatrix,t.globeMatrix),vo(e,e,n),new dt(e[0],e[1])},u.globeDenormalizeECEF=Sf,u.globeECEFOrigin=function(t,e){const n=[0,0,0];return vo(n,n,ju(Ls(e.canonical))),vo(n,n,t),n},u.globeMetersToEcef=gd,u.globeNormalizeECEF=ju,u.globePixelsToTileUnits=function(t,e){return er/(512*Math.pow(2,t))*Cf(Ls(e))},u.globePoleMatrixForTile=function(t,e,n){const s=Aa(new Float64Array(16)),h=(e/(1<<t)-.5)*Math.PI*2;return _h(s,n.globeMatrix,h),Float32Array.from(s)},u.globeTileBounds=Ls,u.globeTiltAtLngLat=Em,u.globeToMercatorTransition=Vu,u.globeUseCustomAntiAliasing=function(t,e,n){const s=Vu(n.zoom),h=t.style.map._antialias,g=!!e.extStandardDerivatives,_=e.extStandardDerivativesForceOff||t.terrain&&t.terrain.exaggeration()>0;return 0===s&&!h&&!_&&g},u.identity=Aa,u.identity$1=vf,u.invert=mf,u.isFullscreen=function(){return!!Ie.document.fullscreenElement||!!Ie.document.webkitFullscreenElement},u.isLngLatBehindGlobe=_d,u.isMapAuthenticated=function(t){return re.has(t)},u.isMapboxURL=so,u.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!yi(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},u.latFromMercatorY=Os,u.latLngToECEF=Hc,u.len=Hg,u.length=du,u.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},u.lngFromMercatorX=Wa,u.loadVectorTile=Up,u.makeRequest=dr,u.mapValue=function(t,e,n,s,h){return $t((t-e)/(n-e)*(h-s)+s,s,h)},u.mercatorScale=Jg,u.mercatorXfromLng=Sl,u.mercatorYfromLat=Ml,u.mercatorZfromAltitude=Il,u.mul=pm,u.mul$1=gf,u.multiply=Vc,u.multiply$1=Gg,u.multiply$2=mm,u.nextPowerOfTwo=Nt,u.normalize=_s,u.normalize$1=Wg,u.normalize$2=Eh,u.number=Jn,u.ortho=function(t,e,n,s,h,g,_){var w=1/(e-n),T=1/(s-h),D=1/(g-_);return t[0]=-2*w,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*T,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*D,t[11]=0,t[12]=(e+n)*w,t[13]=(h+s)*T,t[14]=(_+g)*D,t[15]=1,t},u.pbf=Ju,u.perspective=function(t,e,n,s,h){var g,_=1/Math.tan(e/2);return t[0]=_/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=_,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=h&&h!==1/0?(t[10]=(h+s)*(g=1/(s-h)),t[14]=2*h*s*g):(t[10]=-1,t[14]=-2*s),t},u.pick=function(t,e){const n={};for(let s=0;s<e.length;s++){const h=e[s];h in t&&(n[h]=t[h])}return n},u.plugin=Be,u.pointGeometry=dt,u.polesInViewport=function(t){const e=Aa(new Float64Array(16));Vc(e,t.pixelMatrix,t.globeMatrix);const n=[0,Dl,0],s=[0,Ha,0];return vo(n,n,e),vo(s,s,e),[n[0]>0&&n[0]<=t.width&&n[1]>0&&n[1]<=t.height&&!_d(t,new Vr(t.center.lat,90)),s[0]>0&&s[0]<=t.width&&s[1]>0&&s[1]<=t.height&&!_d(t,new Vr(t.center.lat,-90))]},u.polygonContainsPoint=gc,u.polygonIntersectsBox=kh,u.polygonIntersectsPolygon=Sm,u.polygonizeBounds=function(t,e,n=0,s=!0){const h=new dt(n,n),g=t.sub(h),_=e.add(h),w=[g,new dt(_.x,g.y),_,new dt(g.x,_.y)];return s&&w.push(g.clone()),w},u.posAttributes=Th,u.postMapLoadEvent=de,u.postPerformanceEvent=ne,u.postTurnstileEvent=H,u.potpack=sp,u.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},u.radToDeg=mt,u.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],u.registerForPluginStateChange=function(t){return t({pluginStatus:me,pluginURL:ee}),De.on("pluginStateChange",t),t},u.removeAuthState=function(t){re.delete(t)},u.renderColorRamp=qc,u.resample=yd,u.rotateX=gh,u.rotateX$1=xf,u.rotateY=_h,u.rotateY$1=wf,u.rotateZ=function(t,e,n){var s=Math.sin(n),h=Math.cos(n),g=e[0],_=e[1],w=e[2],T=e[3],D=e[4],R=e[5],O=e[6],B=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=g*h+D*s,t[1]=_*h+R*s,t[2]=w*h+O*s,t[3]=T*h+B*s,t[4]=D*h-g*s,t[5]=R*h-_*s,t[6]=O*h-w*s,t[7]=B*h-T*s,t},u.rotateZ$1=function(t,e,n){n*=.5;var s=e[0],h=e[1],g=e[2],_=e[3],w=Math.sin(n),T=Math.cos(n);return t[0]=s*T+h*w,t[1]=h*T-s*w,t[2]=g*T+_*w,t[3]=_*T-g*w,t},u.scale=$c,u.scale$1=_f,u.scale$2=Pa,u.scaleAndAdd=Nu,u.set=function(t,e,n,s){return t[0]=e,t[1]=n,t[2]=s,t},u.setCacheLimits=function(t,e){Pi=t,So=e},u.setColumn=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},u.setRTLTextPlugin=function(t,e,n=!1){if(me===Y||me===oe||me===le)throw new Error("setRTLTextPlugin cannot be called multiple times.");ee=xr.resolveURL(t),me=Y,he=e,ye(),n||Ae()},u.smoothstep=an,u.spec=ct,u.squaredLength=function(t){var e=t[0],n=t[1],s=t[2];return e*e+n*n+s*s},u.storeAuthState=function(t,e){e?re.add(t):re.delete(t)},u.sub=Tl,u.subtract=fd,u.symbolSize=ep,u.tileAABB=function(t,e,n,s,h,g,_,w,T){if("globe"===T.name)return function xm(t,e,n){const s=e/t.worldSize,h=t.globeMatrix;if(n.z<=1){const Ze=Ls(n).getCorners();return Tf(Ze,h,s),_a.fromPoints(Ze)}const g=Df(n),_=wm(g);Tf(_,h,s);const w=Number.MAX_VALUE,T=[-w,-w,-w],D=[w,w,w];if(g.contains(t.center)){for(const jt of _)wh(D,D,jt),bh(T,T,jt);T[2]=0;const Ze=t.point,_t=[Ze.x*s,Ze.y*s,0];return wh(D,D,_t),bh(T,T,_t),new _a(D,T)}const R=[h[12]*s,h[13]*s,h[14]*s],O=g.getCenter(),B=$t(t.center.lat,-ys,ys),V=$t(O.lat,-ys,ys),G=Sl(t.center.lng),J=Ml(B);let ce=G-Sl(O.lng);const xe=J-Ml(V);ce>.5?ce-=1:ce<-.5&&(ce+=1);let Me=0;Math.abs(ce)>Math.abs(xe)?Me=ce>=0?1:3:(Me=xe>=0?0:2,Nu(R,R,[h[4]*s,h[5]*s,h[6]*s],-Math.sin(Ne(xe>=0?g.getSouth():g.getNorth()))*pc));const ve=_[Me],Se=_[(Me+1)%4],Le=new Xg(ve,Se,R),Pe=[Dh(Le,0)||ve[0],Dh(Le,1)||ve[1],Dh(Le,2)||ve[2]],Ke=Vu(t.zoom);if(Ke>0){const Ze=function({x:jt,y:ot,z:vt},wt,Lt,Vt,st){const tn=1/(1<<vt);let Bn=jt*tn,un=Bn+tn,Cn=ot*tn,nn=Cn+tn,Wn=0;const Ar=(Bn+un)/2-Vt;return Ar>.5?Wn=-1:Ar<-.5&&(Wn=1),Bn=((Bn+Wn)*wt-(Vt*=wt))*Lt+Vt,un=((un+Wn)*wt-Vt)*Lt+Vt,Cn=(Cn*wt-(st*=wt))*Lt+st,nn=(nn*wt-st)*Lt+st,[[Bn,nn,0],[un,nn,0],[un,Cn,0],[Bn,Cn,0]]}(n,e,t._pixelsPerMercatorPixel,G,J);for(let jt=0;jt<_.length;jt++)Cl(_[jt],Ze[jt],Ke);const _t=dc([],Ze[Me],Ze[(Me+1)%4]);Pa(_t,_t,.5),Cl(Pe,_t,Ke)}for(const Ze of _)wh(D,D,Ze),bh(T,T,Ze);return D[2]=Math.min(ve[2],Se[2]),wh(D,D,Pe),bh(T,T,Pe),new _a(D,T)}(t,e,new kd(n,s,h));const D=bu({z:n,x:s,y:h},T);return new _a([(g+D.x/D.scale)*e,e*(D.y/D.scale),_],[(g+D.x2/D.scale)*e,e*(D.y2/D.scale),w])},u.tileCornersToBounds=Df,u.tileTransform=bu,u.transformMat3=function(t,e,n){var s=e[0],h=e[1],g=e[2];return t[0]=s*n[0]+h*n[3]+g*n[6],t[1]=s*n[1]+h*n[4]+g*n[7],t[2]=s*n[2]+h*n[5]+g*n[8],t},u.transformMat4=vo,u.transformMat4$1=fc,u.transformQuat=gm,u.transitionTileAABBinECEF=Ef,u.translate=Bu,u.transpose=function(t,e){if(t===e){var n=e[1],s=e[2],h=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=s,t[7]=h}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},u.triggerPluginCompletionEvent=be,u.uniqueId=It,u.updateGlobeVertexNormal=function(t,e,n,s,h){const g=5*e+2;t.float32[g+0]=n,t.float32[g+1]=s,t.float32[g+2]=h},u.validateCustomStyleLayer=function(t){const e=[],n=t.id;return void 0===n&&e.push({message:`layers.${n}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},u.validateFilter=t=>ta(Fl(t)),u.validateFog=t=>ta(rl(t)),u.validateLayer=t=>ta(nu(t)),u.validateLight=t=>ta(Ru(t)),u.validateSource=t=>ta(zl(t)),u.validateStyle=Bl,u.validateTerrain=t=>ta(ja(t)),u.values=lt,u.vectorTile=Er,u.version=Kt,u.warnOnce=vr,u.window=Ie,u.wrap=mn}),_e(0,function(u){function Ie(ue){if("number"==typeof ue||"boolean"==typeof ue||"string"==typeof ue||null==ue)return JSON.stringify(ue);if(Array.isArray(ue)){let K="[";for(const de of ue)K+=`${Ie(de)},`;return`${K}]`}let H="{";for(const K of Object.keys(ue).sort())H+=`${K}:${Ie(ue[K])},`;return`${H}}`}function Kt(ue){let H="";for(const K of u.refProperties)H+=`/${Ie(ue[K])}`;return H}class Ut{constructor(H){this.keyCache={},H&&this.replace(H)}replace(H){this._layerConfigs={},this._layers={},this.update(H,[])}update(H,K){for(const Ee of H)this._layerConfigs[Ee.id]=Ee,(this._layers[Ee.id]=u.createStyleLayer(Ee)).compileFilter(),this.keyCache[Ee.id]&&delete this.keyCache[Ee.id];for(const Ee of K)delete this.keyCache[Ee],delete this._layerConfigs[Ee],delete this._layers[Ee];this.familiesBySource={};const de=function(Ee,ne){const ie={};for(let re=0;re<Ee.length;re++){const pe=ne&&ne[Ee[re].id]||Kt(Ee[re]);ne&&(ne[Ee[re].id]=pe);let je=ie[pe];je||(je=ie[pe]=[]),je.push(Ee[re])}const q=[];for(const re in ie)q.push(ie[re]);return q}(u.values(this._layerConfigs),this.keyCache);for(const Ee of de){const ne=Ee.map(ht=>this._layers[ht.id]),ie=ne[0];if("none"===ie.visibility)continue;const q=ie.source||"";let re=this.familiesBySource[q];re||(re=this.familiesBySource[q]={});const pe=ie.sourceLayer||"_geojsonTileLayer";let je=re[pe];je||(je=re[pe]=[]),je.push(ne)}}}class bt{loadTile(H,K){const{uid:de,encoding:Ee,rawImageData:ne,padding:ie,buildQuadTree:q}=H,re=u.window.ImageBitmap&&ne instanceof u.window.ImageBitmap?this.getImageData(ne,ie):ne;K(null,new u.DEMData(de,re,Ee,ie<1,q))}getImageData(H,K){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(H.width,H.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=H.width,this.offscreenCanvas.height=H.height,this.offscreenCanvasContext.drawImage(H,0,0,H.width,H.height);const de=this.offscreenCanvasContext.getImageData(-K,-K,H.width+2*K,H.height+2*K);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),de}}var gt=function ue(H,K){var de,Ee=H&&H.type;if("FeatureCollection"===Ee)for(de=0;de<H.features.length;de++)ue(H.features[de],K);else if("GeometryCollection"===Ee)for(de=0;de<H.geometries.length;de++)ue(H.geometries[de],K);else if("Feature"===Ee)ue(H.geometry,K);else if("Polygon"===Ee)nt(H.coordinates,K);else if("MultiPolygon"===Ee)for(de=0;de<H.coordinates.length;de++)nt(H.coordinates[de],K);return H};function nt(ue,H){if(0!==ue.length){ft(ue[0],H);for(var K=1;K<ue.length;K++)ft(ue[K],!H)}}function ft(ue,H){for(var K=0,de=0,Ee=0,ne=ue.length,ie=ne-1;Ee<ne;ie=Ee++){var q=(ue[Ee][0]-ue[ie][0])*(ue[ie][1]+ue[Ee][1]),re=K+q;de+=Math.abs(K)>=Math.abs(q)?K-re+q:q-re+K,K=re}K+de>=0!=!!H&&ue.reverse()}const Et=u.VectorTileFeature.prototype.toGeoJSON;class jn{constructor(H){this._feature=H,this.extent=u.EXTENT,this.type=H.type,this.properties=H.tags,"id"in H&&!isNaN(H.id)&&(this.id=parseInt(H.id,10))}loadGeometry(){if(1===this._feature.type){const H=[];for(const K of this._feature.geometry)H.push([new u.pointGeometry(K[0],K[1])]);return H}{const H=[];for(const K of this._feature.geometry){const de=[];for(const Ee of K)de.push(new u.pointGeometry(Ee[0],Ee[1]));H.push(de)}return H}}toGeoJSON(H,K,de){return Et.call(this,H,K,de)}}class Jt{constructor(H){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.EXTENT,this.length=H.length,this._features=H}feature(H){return new jn(this._features[H])}}var hn={},Qt={get exports(){return hn},set exports(ue){hn=ue}},tr=u.pointGeometry,dt=u.vectorTile.VectorTileFeature,Lr=Zr;function Zr(ue,H){this.options=H||{},this.features=ue,this.length=ue.length}function Je(ue,H){this.id="number"==typeof ue.id?ue.id:void 0,this.type=ue.type,this.rawGeometry=1===ue.type?[ue.geometry]:ue.geometry,this.properties=ue.tags,this.extent=H||4096}Zr.prototype.feature=function(ue){return new Je(this.features[ue],this.options.extent)},Je.prototype.loadGeometry=function(){var ue=this.rawGeometry;this.geometry=[];for(var H=0;H<ue.length;H++){for(var K=ue[H],de=[],Ee=0;Ee<K.length;Ee++)de.push(new tr(K[Ee][0],K[Ee][1]));this.geometry.push(de)}return this.geometry},Je.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var ue=this.geometry,H=1/0,K=-1/0,de=1/0,Ee=-1/0,ne=0;ne<ue.length;ne++)for(var ie=ue[ne],q=0;q<ie.length;q++){var re=ie[q];H=Math.min(H,re.x),K=Math.max(K,re.x),de=Math.min(de,re.y),Ee=Math.max(Ee,re.y)}return[H,de,K,Ee]},Je.prototype.toGeoJSON=dt.prototype.toGeoJSON;var Ne=u.pbf,mt=Lr;function ln(ue){var H=new Ne;return function(K,de){for(var Ee in K.layers)de.writeMessage(3,Ue,K.layers[Ee])}(ue,H),H.finish()}function Ue(ue,H){var K;H.writeVarintField(15,ue.version||1),H.writeStringField(1,ue.name||""),H.writeVarintField(5,ue.extent||4096);var de={keys:[],values:[],keycache:{},valuecache:{}};for(K=0;K<ue.length;K++)de.feature=ue.feature(K),H.writeMessage(2,en,de);var Ee=de.keys;for(K=0;K<Ee.length;K++)H.writeStringField(3,Ee[K]);var ne=de.values;for(K=0;K<ne.length;K++)H.writeMessage(4,Gt,ne[K])}function en(ue,H){var K=ue.feature;void 0!==K.id&&H.writeVarintField(1,K.id),H.writeMessage(2,Xt,ue),H.writeVarintField(3,K.type),H.writeMessage(4,mn,K)}function Xt(ue,H){var K=ue.feature,de=ue.keys,Ee=ue.values,ne=ue.keycache,ie=ue.valuecache;for(var q in K.properties){var re=K.properties[q],pe=ne[q];if(null!==re){void 0===pe&&(de.push(q),ne[q]=pe=de.length-1),H.writeVarint(pe);var je=typeof re;"string"!==je&&"boolean"!==je&&"number"!==je&&(re=JSON.stringify(re));var ht=je+":"+re,ut=ie[ht];void 0===ut&&(Ee.push(re),ie[ht]=ut=Ee.length-1),H.writeVarint(ut)}}}function $t(ue,H){return(H<<3)+(7&ue)}function an(ue){return ue<<1^ue>>31}function mn(ue,H){for(var K=ue.loadGeometry(),de=ue.type,Ee=0,ne=0,ie=K.length,q=0;q<ie;q++){var re=K[q],pe=1;1===de&&(pe=re.length),H.writeVarint($t(1,pe));for(var je=3===de?re.length-1:re.length,ht=0;ht<je;ht++){1===ht&&1!==de&&H.writeVarint($t(2,je-1));var ut=re[ht].x-Ee,sn=re[ht].y-ne;H.writeVarint(an(ut)),H.writeVarint(an(sn)),Ee+=ut,ne+=sn}3===de&&H.writeVarint($t(7,1))}}function Gt(ue,H){var K=typeof ue;"string"===K?H.writeStringField(1,ue):"boolean"===K?H.writeBooleanField(7,ue):"number"===K&&(ue%1!=0?H.writeDoubleField(3,ue):ue<0?H.writeSVarintField(6,ue):H.writeVarintField(5,ue))}function lt(ue,H,K,de,Ee,ne){if(Ee-de<=K)return;const ie=de+Ee>>1;rt(ue,H,ie,de,Ee,ne%2),lt(ue,H,K,de,ie-1,ne+1),lt(ue,H,K,ie+1,Ee,ne+1)}function rt(ue,H,K,de,Ee,ne){for(;Ee>de;){if(Ee-de>600){const pe=Ee-de+1,je=K-de+1,ht=Math.log(pe),ut=.5*Math.exp(2*ht/3),sn=.5*Math.sqrt(ht*ut*(pe-ut)/pe)*(je-pe/2<0?-1:1);rt(ue,H,K,Math.max(de,Math.floor(K-je*ut/pe+sn)),Math.min(Ee,Math.floor(K+(pe-je)*ut/pe+sn)),ne)}const ie=H[2*K+ne];let q=de,re=Ee;for(Dt(ue,H,de,K),H[2*Ee+ne]>ie&&Dt(ue,H,de,Ee);q<re;){for(Dt(ue,H,q,re),q++,re--;H[2*q+ne]<ie;)q++;for(;H[2*re+ne]>ie;)re--}H[2*de+ne]===ie?Dt(ue,H,de,re):(re++,Dt(ue,H,re,Ee)),re<=K&&(de=re+1),K<=re&&(Ee=re-1)}}function Dt(ue,H,K,de){It(ue,K,de),It(H,2*K,2*de),It(H,2*K+1,2*de+1)}function It(ue,H,K){const de=ue[H];ue[H]=ue[K],ue[K]=de}function Ht(ue,H,K,de){const Ee=ue-K,ne=H-de;return Ee*Ee+ne*ne}Qt.exports=ln,hn.fromVectorTileJs=ln,hn.fromGeojsonVt=function(ue,H){H=H||{};var K={};for(var de in ue)K[de]=new mt(ue[de].features,H),K[de].name=de,K[de].version=H.version,K[de].extent=H.extent;return ln({layers:K})},hn.GeoJSONWrapper=mt;const Nt=ue=>ue[0],Dn=ue=>ue[1];class yr{constructor(H,K=Nt,de=Dn,Ee=64,ne=Float64Array){this.nodeSize=Ee,this.points=H;const ie=H.length<65536?Uint16Array:Uint32Array,q=this.ids=new ie(H.length),re=this.coords=new ne(2*H.length);for(let pe=0;pe<H.length;pe++)q[pe]=pe,re[2*pe]=K(H[pe]),re[2*pe+1]=de(H[pe]);lt(q,re,Ee,0,q.length-1,0)}range(H,K,de,Ee){return function(ne,ie,q,re,pe,je,ht){const ut=[0,ne.length-1,0],sn=[];let dn,Rt;for(;ut.length;){const xn=ut.pop(),rr=ut.pop(),xr=ut.pop();if(rr-xr<=ht){for(let Or=xr;Or<=rr;Or++)dn=ie[2*Or],Rt=ie[2*Or+1],dn>=q&&dn<=pe&&Rt>=re&&Rt<=je&&sn.push(ne[Or]);continue}const Sn=Math.floor((xr+rr)/2);dn=ie[2*Sn],Rt=ie[2*Sn+1],dn>=q&&dn<=pe&&Rt>=re&&Rt<=je&&sn.push(ne[Sn]);const Pr=(xn+1)%2;(0===xn?q<=dn:re<=Rt)&&(ut.push(xr),ut.push(Sn-1),ut.push(Pr)),(0===xn?pe>=dn:je>=Rt)&&(ut.push(Sn+1),ut.push(rr),ut.push(Pr))}return sn}(this.ids,this.coords,H,K,de,Ee,this.nodeSize)}within(H,K,de){return function(Ee,ne,ie,q,re,pe){const je=[0,Ee.length-1,0],ht=[],ut=re*re;for(;je.length;){const sn=je.pop(),dn=je.pop(),Rt=je.pop();if(dn-Rt<=pe){for(let Pr=Rt;Pr<=dn;Pr++)Ht(ne[2*Pr],ne[2*Pr+1],ie,q)<=ut&&ht.push(Ee[Pr]);continue}const xn=Math.floor((Rt+dn)/2),rr=ne[2*xn],xr=ne[2*xn+1];Ht(rr,xr,ie,q)<=ut&&ht.push(Ee[xn]);const Sn=(sn+1)%2;(0===sn?ie-re<=rr:q-re<=xr)&&(je.push(Rt),je.push(xn-1),je.push(Sn)),(0===sn?ie+re>=rr:q+re>=xr)&&(je.push(xn+1),je.push(dn),je.push(Sn))}return ht}(this.ids,this.coords,H,K,de,this.nodeSize)}}const or={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:ue=>ue},vn=Math.fround||(In=new Float32Array(1),ue=>(In[0]=+ue,In[0]));var In;class cn{constructor(H){this.options=yi(Object.create(or),H),this.trees=new Array(this.options.maxZoom+1)}load(H){const{log:K,minZoom:de,maxZoom:Ee,nodeSize:ne}=this.options;K&&console.time("total time");const ie=`prepare ${H.length} points`;K&&console.time(ie),this.points=H;let q=[];for(let re=0;re<H.length;re++)H[re].geometry&&q.push(vr(H[re],re));this.trees[Ee+1]=new yr(q,Xr,Pn,ne,Float32Array),K&&console.timeEnd(ie);for(let re=Ee;re>=de;re--){const pe=+Date.now();q=this._cluster(q,re),this.trees[re]=new yr(q,Xr,Pn,ne,Float32Array),K&&console.log("z%d: %d clusters in %dms",re,q.length,+Date.now()-pe)}return K&&console.timeEnd("total time"),this}getClusters(H,K){let de=((H[0]+180)%360+360)%360-180;const Ee=Math.max(-90,Math.min(90,H[1]));let ne=180===H[2]?180:((H[2]+180)%360+360)%360-180;const ie=Math.max(-90,Math.min(90,H[3]));if(H[2]-H[0]>=360)de=-180,ne=180;else if(de>ne){const je=this.getClusters([de,Ee,180,ie],K),ht=this.getClusters([-180,Ee,ne,ie],K);return je.concat(ht)}const q=this.trees[this._limitZoom(K)],re=q.range(ni(de),wr(ie),ni(ne),wr(Ee)),pe=[];for(const je of re){const ht=q.points[je];pe.push(ht.numPoints?si(ht):this.points[ht.index])}return pe}getChildren(H){const K=this._getOriginId(H),de=this._getOriginZoom(H),Ee="No cluster with the specified id.",ne=this.trees[de];if(!ne)throw new Error(Ee);const ie=ne.points[K];if(!ie)throw new Error(Ee);const q=this.options.radius/(this.options.extent*Math.pow(2,de-1)),re=ne.within(ie.x,ie.y,q),pe=[];for(const je of re){const ht=ne.points[je];ht.parentId===H&&pe.push(ht.numPoints?si(ht):this.points[ht.index])}if(0===pe.length)throw new Error(Ee);return pe}getLeaves(H,K,de){const Ee=[];return this._appendLeaves(Ee,H,K=K||10,de=de||0,0),Ee}getTile(H,K,de){const Ee=this.trees[this._limitZoom(H)],ne=Math.pow(2,H),{extent:ie,radius:q}=this.options,re=q/ie,pe=(de-re)/ne,je=(de+1+re)/ne,ht={features:[]};return this._addTileFeatures(Ee.range((K-re)/ne,pe,(K+1+re)/ne,je),Ee.points,K,de,ne,ht),0===K&&this._addTileFeatures(Ee.range(1-re/ne,pe,1,je),Ee.points,ne,de,ne,ht),K===ne-1&&this._addTileFeatures(Ee.range(0,pe,re/ne,je),Ee.points,-1,de,ne,ht),ht.features.length?ht:null}getClusterExpansionZoom(H){let K=this._getOriginZoom(H)-1;for(;K<=this.options.maxZoom;){const de=this.getChildren(H);if(K++,1!==de.length)break;H=de[0].properties.cluster_id}return K}_appendLeaves(H,K,de,Ee,ne){const ie=this.getChildren(K);for(const q of ie){const re=q.properties;if(re&&re.cluster?ne+re.point_count<=Ee?ne+=re.point_count:ne=this._appendLeaves(H,re.cluster_id,de,Ee,ne):ne<Ee?ne++:H.push(q),H.length===de)break}return ne}_addTileFeatures(H,K,de,Ee,ne,ie){for(const q of H){const re=K[q],pe=re.numPoints;let je,ht,ut;if(pe)je=bn(re),ht=re.x,ut=re.y;else{const Rt=this.points[re.index];je=Rt.properties,ht=ni(Rt.geometry.coordinates[0]),ut=wr(Rt.geometry.coordinates[1])}const sn={type:1,geometry:[[Math.round(this.options.extent*(ht*ne-de)),Math.round(this.options.extent*(ut*ne-Ee))]],tags:je};let dn;pe?dn=re.id:this.options.generateId?dn=re.index:this.points[re.index].id&&(dn=this.points[re.index].id),void 0!==dn&&(sn.id=dn),ie.features.push(sn)}}_limitZoom(H){return Math.max(this.options.minZoom,Math.min(Math.floor(+H),this.options.maxZoom+1))}_cluster(H,K){const de=[],{radius:Ee,extent:ne,reduce:ie,minPoints:q}=this.options,re=Ee/(ne*Math.pow(2,K));for(let pe=0;pe<H.length;pe++){const je=H[pe];if(je.zoom<=K)continue;je.zoom=K;const ht=this.trees[K+1],ut=ht.within(je.x,je.y,re),sn=je.numPoints||1;let dn=sn;for(const Rt of ut){const xn=ht.points[Rt];xn.zoom>K&&(dn+=xn.numPoints||1)}if(dn>sn&&dn>=q){let Rt=je.x*sn,xn=je.y*sn,rr=ie&&sn>1?this._map(je,!0):null;const xr=(pe<<5)+(K+1)+this.points.length;for(const Sn of ut){const Pr=ht.points[Sn];if(Pr.zoom<=K)continue;Pr.zoom=K;const Or=Pr.numPoints||1;Rt+=Pr.x*Or,xn+=Pr.y*Or,Pr.parentId=xr,ie&&(rr||(rr=this._map(je,!0)),ie(rr,this._map(Pr)))}je.parentId=xr,de.push(pr(Rt/dn,xn/dn,xr,dn,rr))}else if(de.push(je),dn>1)for(const Rt of ut){const xn=ht.points[Rt];xn.zoom<=K||(xn.zoom=K,de.push(xn))}}return de}_getOriginId(H){return H-this.points.length>>5}_getOriginZoom(H){return(H-this.points.length)%32}_map(H,K){if(H.numPoints)return K?yi({},H.properties):H.properties;const de=this.points[H.index].properties,Ee=this.options.map(de);return K&&Ee===de?yi({},Ee):Ee}}function pr(ue,H,K,de,Ee){return{x:vn(ue),y:vn(H),zoom:1/0,id:K,parentId:-1,numPoints:de,properties:Ee}}function vr(ue,H){const[K,de]=ue.geometry.coordinates;return{x:vn(ni(K)),y:vn(wr(de)),zoom:1/0,index:H,parentId:-1}}function si(ue){return{type:"Feature",id:ue.id,properties:bn(ue),geometry:{type:"Point",coordinates:[(H=ue.x,360*(H-.5)),Yi(ue.y)]}};var H}function bn(ue){const H=ue.numPoints,K=H>=1e4?`${Math.round(H/1e3)}k`:H>=1e3?Math.round(H/100)/10+"k":H;return yi(yi({},ue.properties),{cluster:!0,cluster_id:ue.id,point_count:H,point_count_abbreviated:K})}function ni(ue){return ue/360+.5}function wr(ue){const H=Math.sin(ue*Math.PI/180),K=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return K<0?0:K>1?1:K}function Yi(ue){const H=(180-360*ue)*Math.PI/180;return 360*Math.atan(Math.exp(H))/Math.PI-90}function yi(ue,H){for(const K in H)ue[K]=H[K];return ue}function Xr(ue){return ue.x}function Pn(ue){return ue.y}function jr(ue,H,K,de){for(var Ee,ne=de,ie=K-H>>1,q=K-H,re=ue[H],pe=ue[H+1],je=ue[K],ht=ue[K+1],ut=H+3;ut<K;ut+=3){var sn=Br(ue[ut],ue[ut+1],re,pe,je,ht);if(sn>ne)Ee=ut,ne=sn;else if(sn===ne){var dn=Math.abs(ut-ie);dn<q&&(Ee=ut,q=dn)}}ne>de&&(Ee-H>3&&jr(ue,H,Ee,de),ue[Ee+2]=ne,K-Ee>3&&jr(ue,Ee,K,de))}function Br(ue,H,K,de,Ee,ne){var ie=Ee-K,q=ne-de;if(0!==ie||0!==q){var re=((ue-K)*ie+(H-de)*q)/(ie*ie+q*q);re>1?(K=Ee,de=ne):re>0&&(K+=ie*re,de+=q*re)}return(ie=ue-K)*ie+(q=H-de)*q}function ri(ue,H,K,de){var Ee={id:void 0===ue?null:ue,type:H,geometry:K,tags:de,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(ne){var ie=ne.geometry,q=ne.type;if("Point"===q||"MultiPoint"===q||"LineString"===q)Pi(ne,ie);else if("Polygon"===q||"MultiLineString"===q)for(var re=0;re<ie.length;re++)Pi(ne,ie[re]);else if("MultiPolygon"===q)for(re=0;re<ie.length;re++)for(var pe=0;pe<ie[re].length;pe++)Pi(ne,ie[re][pe])}(Ee),Ee}function Pi(ue,H){for(var K=0;K<H.length;K+=3)ue.minX=Math.min(ue.minX,H[K]),ue.minY=Math.min(ue.minY,H[K+1]),ue.maxX=Math.max(ue.maxX,H[K]),ue.maxY=Math.max(ue.maxY,H[K+1])}function So(ue,H,K,de){if(H.geometry){var Ee=H.geometry.coordinates,ne=H.geometry.type,ie=Math.pow(K.tolerance/((1<<K.maxZoom)*K.extent),2),q=[],re=H.id;if(K.promoteId?re=H.properties[K.promoteId]:K.generateId&&(re=de||0),"Point"===ne)Vn(Ee,q);else if("MultiPoint"===ne)for(var pe=0;pe<Ee.length;pe++)Vn(Ee[pe],q);else if("LineString"===ne)yn(Ee,q,ie,!1);else if("MultiLineString"===ne){if(K.lineMetrics){for(pe=0;pe<Ee.length;pe++)yn(Ee[pe],q=[],ie,!1),ue.push(ri(re,"LineString",q,H.properties));return}Ri(Ee,q,ie,!1)}else if("Polygon"===ne)Ri(Ee,q,ie,!0);else{if("MultiPolygon"!==ne){if("GeometryCollection"===ne){for(pe=0;pe<H.geometry.geometries.length;pe++)So(ue,{id:re,geometry:H.geometry.geometries[pe],properties:H.properties},K,de);return}throw new Error("Input data is not a valid GeoJSON object.")}for(pe=0;pe<Ee.length;pe++){var je=[];Ri(Ee[pe],je,ie,!0),q.push(je)}}ue.push(ri(re,ne,q,H.properties))}}function Vn(ue,H){H.push(Mr(ue[0])),H.push(on(ue[1])),H.push(0)}function yn(ue,H,K,de){for(var Ee,ne,ie=0,q=0;q<ue.length;q++){var re=Mr(ue[q][0]),pe=on(ue[q][1]);H.push(re),H.push(pe),H.push(0),q>0&&(ie+=de?(Ee*pe-re*ne)/2:Math.sqrt(Math.pow(re-Ee,2)+Math.pow(pe-ne,2))),Ee=re,ne=pe}var je=H.length-3;H[2]=1,jr(H,0,je,K),H[je+2]=1,H.size=Math.abs(ie),H.start=0,H.end=H.size}function Ri(ue,H,K,de){for(var Ee=0;Ee<ue.length;Ee++){var ne=[];yn(ue[Ee],ne,K,de),H.push(ne)}}function Mr(ue){return ue/360+.5}function on(ue){var H=Math.sin(ue*Math.PI/180),K=.5-.25*Math.log((1+H)/(1-H))/Math.PI;return K<0?0:K>1?1:K}function St(ue,H,K,de,Ee,ne,ie,q){if(de/=H,ne>=(K/=H)&&ie<de)return ue;if(ie<K||ne>=de)return null;for(var re=[],pe=0;pe<ue.length;pe++){var je=ue[pe],ht=je.geometry,ut=je.type,sn=0===Ee?je.minX:je.minY,dn=0===Ee?je.maxX:je.maxY;if(sn>=K&&dn<de)re.push(je);else if(!(dn<K||sn>=de)){var Rt=[];if("Point"===ut||"MultiPoint"===ut)vi(ht,Rt,K,de,Ee);else if("LineString"===ut)dr(ht,Rt,K,de,Ee,!1,q.lineMetrics);else if("MultiLineString"===ut)io(ht,Rt,K,de,Ee,!1);else if("Polygon"===ut)io(ht,Rt,K,de,Ee,!0);else if("MultiPolygon"===ut)for(var xn=0;xn<ht.length;xn++){var rr=[];io(ht[xn],rr,K,de,Ee,!0),rr.length&&Rt.push(rr)}if(Rt.length){if(q.lineMetrics&&"LineString"===ut){for(xn=0;xn<Rt.length;xn++)re.push(ri(je.id,ut,Rt[xn],je.tags));continue}"LineString"!==ut&&"MultiLineString"!==ut||(1===Rt.length?(ut="LineString",Rt=Rt[0]):ut="MultiLineString"),"Point"!==ut&&"MultiPoint"!==ut||(ut=3===Rt.length?"Point":"MultiPoint"),re.push(ri(je.id,ut,Rt,je.tags))}}}return re.length?re:null}function vi(ue,H,K,de,Ee){for(var ne=0;ne<ue.length;ne+=3){var ie=ue[ne+Ee];ie>=K&&ie<=de&&(H.push(ue[ne]),H.push(ue[ne+1]),H.push(ue[ne+2]))}}function dr(ue,H,K,de,Ee,ne,ie){for(var q,re,pe=Nr(ue),je=0===Ee?oo:Dr,ht=ue.start,ut=0;ut<ue.length-3;ut+=3){var sn=ue[ut],dn=ue[ut+1],Rt=ue[ut+2],xn=ue[ut+3],rr=ue[ut+4],xr=0===Ee?sn:dn,Sn=0===Ee?xn:rr,Pr=!1;ie&&(q=Math.sqrt(Math.pow(sn-xn,2)+Math.pow(dn-rr,2))),xr<K?Sn>K&&(re=je(pe,sn,dn,xn,rr,K),ie&&(pe.start=ht+q*re)):xr>de?Sn<de&&(re=je(pe,sn,dn,xn,rr,de),ie&&(pe.start=ht+q*re)):ki(pe,sn,dn,Rt),Sn<K&&xr>=K&&(re=je(pe,sn,dn,xn,rr,K),Pr=!0),Sn>de&&xr<=de&&(re=je(pe,sn,dn,xn,rr,de),Pr=!0),!ne&&Pr&&(ie&&(pe.end=ht+q*re),H.push(pe),pe=Nr(ue)),ie&&(ht+=q)}var Or=ue.length-3;sn=ue[Or],dn=ue[Or+1],Rt=ue[Or+2],(xr=0===Ee?sn:dn)>=K&&xr<=de&&ki(pe,sn,dn,Rt),Or=pe.length-3,ne&&Or>=3&&(pe[Or]!==pe[0]||pe[Or+1]!==pe[1])&&ki(pe,pe[0],pe[1],pe[2]),pe.length&&H.push(pe)}function Nr(ue){var H=[];return H.size=ue.size,H.start=ue.start,H.end=ue.end,H}function io(ue,H,K,de,Ee,ne){for(var ie=0;ie<ue.length;ie++)dr(ue[ie],H,K,de,Ee,ne,!1)}function ki(ue,H,K,de){ue.push(H),ue.push(K),ue.push(de)}function oo(ue,H,K,de,Ee,ne){var ie=(ne-H)/(de-H);return ue.push(ne),ue.push(K+(Ee-K)*ie),ue.push(1),ie}function Dr(ue,H,K,de,Ee,ne){var ie=(ne-K)/(Ee-K);return ue.push(H+(de-H)*ie),ue.push(ne),ue.push(1),ie}function po(ue,H){for(var K=[],de=0;de<ue.length;de++){var Ee,ne=ue[de],ie=ne.type;if("Point"===ie||"MultiPoint"===ie||"LineString"===ie)Ee=gr(ne.geometry,H);else if("MultiLineString"===ie||"Polygon"===ie){Ee=[];for(var q=0;q<ne.geometry.length;q++)Ee.push(gr(ne.geometry[q],H))}else if("MultiPolygon"===ie)for(Ee=[],q=0;q<ne.geometry.length;q++){for(var re=[],pe=0;pe<ne.geometry[q].length;pe++)re.push(gr(ne.geometry[q][pe],H));Ee.push(re)}K.push(ri(ne.id,ie,Ee,ne.tags))}return K}function gr(ue,H){var K=[];K.size=ue.size,void 0!==ue.start&&(K.start=ue.start,K.end=ue.end);for(var de=0;de<ue.length;de+=3)K.push(ue[de]+H,ue[de+1],ue[de+2]);return K}function so(ue,H){if(ue.transformed)return ue;var K,de,Ee,ne=1<<ue.z,ie=ue.x,q=ue.y;for(K=0;K<ue.features.length;K++){var re=ue.features[K],pe=re.geometry,je=re.type;if(re.geometry=[],1===je)for(de=0;de<pe.length;de+=2)re.geometry.push(kn(pe[de],pe[de+1],H,ne,ie,q));else for(de=0;de<pe.length;de++){var ht=[];for(Ee=0;Ee<pe[de].length;Ee+=2)ht.push(kn(pe[de][Ee],pe[de][Ee+1],H,ne,ie,q));re.geometry.push(ht)}}return ue.transformed=!0,ue}function kn(ue,H,K,de,Ee,ne){return[Math.round(K*(ue*de-Ee)),Math.round(K*(H*de-ne))]}function xi(ue,H,K,de,Ee){for(var ne=H===Ee.maxZoom?0:Ee.tolerance/((1<<H)*Ee.extent),ie={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:K,y:de,z:H,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},q=0;q<ue.length;q++){ie.numFeatures++,$n(ie,ue[q],ne,Ee);var re=ue[q].minX,pe=ue[q].minY,je=ue[q].maxX,ht=ue[q].maxY;re<ie.minX&&(ie.minX=re),pe<ie.minY&&(ie.minY=pe),je>ie.maxX&&(ie.maxX=je),ht>ie.maxY&&(ie.maxY=ht)}return ie}function $n(ue,H,K,de){var Ee=H.geometry,ne=H.type,ie=[];if("Point"===ne||"MultiPoint"===ne)for(var q=0;q<Ee.length;q+=3)ie.push(Ee[q]),ie.push(Ee[q+1]),ue.numPoints++,ue.numSimplified++;else if("LineString"===ne)pt(ie,Ee,ue,K,!1,!1);else if("MultiLineString"===ne||"Polygon"===ne)for(q=0;q<Ee.length;q++)pt(ie,Ee[q],ue,K,"Polygon"===ne,0===q);else if("MultiPolygon"===ne)for(var re=0;re<Ee.length;re++){var pe=Ee[re];for(q=0;q<pe.length;q++)pt(ie,pe[q],ue,K,!0,0===q)}if(ie.length){var je=H.tags||null;if("LineString"===ne&&de.lineMetrics){for(var ht in je={},H.tags)je[ht]=H.tags[ht];je.mapbox_clip_start=Ee.start/Ee.size,je.mapbox_clip_end=Ee.end/Ee.size}var ut={geometry:ie,type:"Polygon"===ne||"MultiPolygon"===ne?3:"LineString"===ne||"MultiLineString"===ne?2:1,tags:je};null!==H.id&&(ut.id=H.id),ue.features.push(ut)}}function pt(ue,H,K,de,Ee,ne){var ie=de*de;if(de>0&&H.size<(Ee?ie:de))K.numPoints+=H.length/3;else{for(var q=[],re=0;re<H.length;re+=3)(0===de||H[re+2]>ie)&&(K.numSimplified++,q.push(H[re]),q.push(H[re+1])),K.numPoints++;Ee&&function(pe,je){for(var ht=0,ut=0,sn=pe.length,dn=sn-2;ut<sn;dn=ut,ut+=2)ht+=(pe[ut]-pe[dn])*(pe[ut+1]+pe[dn+1]);if(ht>0===je)for(ut=0,sn=pe.length;ut<sn/2;ut+=2){var Rt=pe[ut],xn=pe[ut+1];pe[ut]=pe[sn-2-ut],pe[ut+1]=pe[sn-1-ut],pe[sn-2-ut]=Rt,pe[sn-1-ut]=xn}}(q,ne),ue.push(q)}}function Fe(ue,H){var K=(H=this.options=function(Ee,ne){for(var ie in ne)Ee[ie]=ne[ie];return Ee}(Object.create(this.options),H)).debug;if(K&&console.time("preprocess data"),H.maxZoom<0||H.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(H.promoteId&&H.generateId)throw new Error("promoteId and generateId cannot be used together.");var Ee,ne,ie,q,re,pe,de=function(Ee,ne){var ie=[];if("FeatureCollection"===Ee.type)for(var q=0;q<Ee.features.length;q++)So(ie,Ee.features[q],ne,q);else So(ie,"Feature"===Ee.type?Ee:{geometry:Ee},ne);return ie}(ue,H);this.tiles={},this.tileCoords=[],K&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",H.indexMaxZoom,H.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),q=Ee=de,re=St(Ee,1,-1-(ie=(ne=H).buffer/ne.extent),ie,0,-1,2,ne),pe=St(Ee,1,1-ie,2+ie,0,-1,2,ne),(re||pe)&&(q=St(Ee,1,-ie,1+ie,0,-1,2,ne)||[],re&&(q=po(re,1).concat(q)),pe&&(q=q.concat(po(pe,-1)))),(de=q).length&&this.splitTile(de,0,0,0),K&&(de.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Re(ue,H,K){return 32*((1<<ue)*K+H)+ue}function Wt(ue,H){const K=ue.tileID.canonical;if(!this._geoJSONIndex)return H(null,null);const de=this._geoJSONIndex.getTile(K.z,K.x,K.y);if(!de)return H(null,null);const Ee=new Jt(de.features);let ne=hn(Ee);0===ne.byteOffset&&ne.byteLength===ne.buffer.byteLength||(ne=new Uint8Array(ne)),H(null,{vectorTile:Ee,rawData:ne.buffer})}Fe.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},Fe.prototype.splitTile=function(ue,H,K,de,Ee,ne,ie){for(var q=[ue,H,K,de],re=this.options,pe=re.debug;q.length;){de=q.pop(),K=q.pop(),H=q.pop(),ue=q.pop();var je=1<<H,ht=Re(H,K,de),ut=this.tiles[ht];if(!ut&&(pe>1&&console.time("creation"),ut=this.tiles[ht]=xi(ue,H,K,de,re),this.tileCoords.push({z:H,x:K,y:de}),pe)){pe>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",H,K,de,ut.numFeatures,ut.numPoints,ut.numSimplified),console.timeEnd("creation"));var sn="z"+H;this.stats[sn]=(this.stats[sn]||0)+1,this.total++}if(ut.source=ue,Ee){if(H===re.maxZoom||H===Ee)continue;var dn=1<<Ee-H;if(K!==Math.floor(ne/dn)||de!==Math.floor(ie/dn))continue}else if(H===re.indexMaxZoom||ut.numPoints<=re.indexMaxPoints)continue;if(ut.source=null,0!==ue.length){pe>1&&console.time("clipping");var Rt,xn,rr,xr,Sn,Pr,Or=.5*re.buffer/re.extent,Ji=.5-Or,Hi=.5+Or,ct=1+Or;Rt=xn=rr=xr=null,Sn=St(ue,je,K-Or,K+Hi,0,ut.minX,ut.maxX,re),Pr=St(ue,je,K+Ji,K+ct,0,ut.minX,ut.maxX,re),ue=null,Sn&&(Rt=St(Sn,je,de-Or,de+Hi,1,ut.minY,ut.maxY,re),xn=St(Sn,je,de+Ji,de+ct,1,ut.minY,ut.maxY,re),Sn=null),Pr&&(rr=St(Pr,je,de-Or,de+Hi,1,ut.minY,ut.maxY,re),xr=St(Pr,je,de+Ji,de+ct,1,ut.minY,ut.maxY,re),Pr=null),pe>1&&console.timeEnd("clipping"),q.push(Rt||[],H+1,2*K,2*de),q.push(xn||[],H+1,2*K,2*de+1),q.push(rr||[],H+1,2*K+1,2*de),q.push(xr||[],H+1,2*K+1,2*de+1)}}},Fe.prototype.getTile=function(ue,H,K){var de=this.options,Ee=de.extent,ne=de.debug;if(ue<0||ue>24)return null;var ie=1<<ue,q=Re(ue,H=(H%ie+ie)%ie,K);if(this.tiles[q])return so(this.tiles[q],Ee);ne>1&&console.log("drilling down to z%d-%d-%d",ue,H,K);for(var re,pe=ue,je=H,ht=K;!re&&pe>0;)pe--,je=Math.floor(je/2),ht=Math.floor(ht/2),re=this.tiles[Re(pe,je,ht)];return re&&re.source?(ne>1&&console.log("found parent tile z%d-%d-%d",pe,je,ht),ne>1&&console.time("drilling down"),this.splitTile(re.source,pe,je,ht,ue,H,K),ne>1&&console.timeEnd("drilling down"),this.tiles[q]?so(this.tiles[q],Ee):null):null};class Pt extends u.VectorTileWorkerSource{constructor(H,K,de,Ee,ne){super(H,K,de,Ee,Wt),ne&&(this.loadGeoJSON=ne)}loadData(H,K){const de=H&&H.request,Ee=de&&de.collectResourceTiming;this.loadGeoJSON(H,(ne,ie)=>{if(ne||!ie)return K(ne);if("object"!=typeof ie)return K(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`));{gt(ie,!0);try{if(H.filter){const re=u.createExpression(H.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===re.result)throw new Error(re.value.map(je=>`${je.key}: ${je.message}`).join(", "));ie={type:"FeatureCollection",features:ie.features.filter(je=>re.value.evaluate({zoom:0},je))}}this._geoJSONIndex=H.cluster?new cn(function({superclusterOptions:re,clusterProperties:pe}){if(!pe||!re)return re;const je={},ht={},ut={accumulated:null,zoom:0},sn={properties:null},dn=Object.keys(pe);for(const Rt of dn){const[xn,rr]=pe[Rt],xr=u.createExpression(rr),Sn=u.createExpression("string"==typeof xn?[xn,["accumulated"],["get",Rt]]:xn);je[Rt]=xr.value,ht[Rt]=Sn.value}return re.map=Rt=>{sn.properties=Rt;const xn={};for(const rr of dn)xn[rr]=je[rr].evaluate(ut,sn);return xn},re.reduce=(Rt,xn)=>{sn.properties=xn;for(const rr of dn)ut.accumulated=Rt[rr],Rt[rr]=ht[rr].evaluate(ut,sn)},re}(H)).load(ie.features):new Fe(re=ie,H.geojsonVtOptions)}catch(re){return K(re)}this.loaded={};const q={};if(Ee){const re=u.getPerformanceMeasurement(de);re&&(q.resourceTiming={},q.resourceTiming[H.source]=JSON.parse(JSON.stringify(re)))}K(null,q)}var re})}reloadTile(H,K){const de=this.loaded;return de&&de[H.uid]?super.reloadTile(H,K):this.loadTile(H,K)}loadGeoJSON(H,K){if(H.request)u.getJSON(H.request,K);else{if("string"!=typeof H.data)return K(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`));try{return K(null,JSON.parse(H.data))}catch{return K(new Error(`Input data given to '${H.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(H,K){try{K(null,this._geoJSONIndex.getClusterExpansionZoom(H.clusterId))}catch(de){K(de)}}getClusterChildren(H,K){try{K(null,this._geoJSONIndex.getChildren(H.clusterId))}catch(de){K(de)}}getClusterLeaves(H,K){try{K(null,this._geoJSONIndex.getLeaves(H.clusterId,H.limit,H.offset))}catch(de){K(de)}}}class Ln{constructor(H){this.self=H,this.actor=new u.Actor(H,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=u.getProjection({name:"mercator"}),this.workerSourceTypes={vector:u.VectorTileWorkerSource,geojson:Pt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(K,de)=>{if(this.workerSourceTypes[K])throw new Error(`Worker source with name "${K}" already registered.`);this.workerSourceTypes[K]=de},this.self.registerRTLTextPlugin=K=>{if(u.plugin.isParsed())throw new Error("RTL text plugin already registered.");u.plugin.applyArabicShaping=K.applyArabicShaping,u.plugin.processBidirectionalText=K.processBidirectionalText,u.plugin.processStyledBidirectionalText=K.processStyledBidirectionalText}}clearCaches(H,K,de){delete this.layerIndexes[H],delete this.availableImages[H],delete this.workerSources[H],delete this.demWorkerSources[H],de()}checkIfReady(H,K,de){de()}setReferrer(H,K){this.referrer=K}spriteLoaded(H,K){this.isSpriteLoaded[H]=K;for(const de in this.workerSources[H]){const Ee=this.workerSources[H][de];for(const ne in Ee)Ee[ne]instanceof u.VectorTileWorkerSource&&(Ee[ne].isSpriteLoaded=K,Ee[ne].fire(new u.Event("isSpriteLoaded")))}}setImages(H,K,de){this.availableImages[H]=K;for(const Ee in this.workerSources[H]){const ne=this.workerSources[H][Ee];for(const ie in ne)ne[ie].availableImages=K}de()}enableTerrain(H,K,de){this.terrain=K,de()}setProjection(H,K){this.projections[H]=u.getProjection(K)}setLayers(H,K,de){this.getLayerIndex(H).replace(K),de()}updateLayers(H,K,de){this.getLayerIndex(H).update(K.layers,K.removedIds),de()}loadTile(H,K,de){const Ee=this.enableTerrain?u.extend({enableTerrain:this.terrain},K):K;Ee.projection=this.projections[H]||this.defaultProjection,this.getWorkerSource(H,K.type,K.source).loadTile(Ee,de)}loadDEMTile(H,K,de){const Ee=this.enableTerrain?u.extend({buildQuadTree:this.terrain},K):K;this.getDEMWorkerSource(H,K.source).loadTile(Ee,de)}reloadTile(H,K,de){const Ee=this.enableTerrain?u.extend({enableTerrain:this.terrain},K):K;Ee.projection=this.projections[H]||this.defaultProjection,this.getWorkerSource(H,K.type,K.source).reloadTile(Ee,de)}abortTile(H,K,de){this.getWorkerSource(H,K.type,K.source).abortTile(K,de)}removeTile(H,K,de){this.getWorkerSource(H,K.type,K.source).removeTile(K,de)}removeSource(H,K,de){if(!this.workerSources[H]||!this.workerSources[H][K.type]||!this.workerSources[H][K.type][K.source])return;const Ee=this.workerSources[H][K.type][K.source];delete this.workerSources[H][K.type][K.source],void 0!==Ee.removeSource?Ee.removeSource(K,de):de()}loadWorkerSource(H,K,de){try{this.self.importScripts(K.url),de()}catch(Ee){de(Ee.toString())}}syncRTLPluginState(H,K,de){try{u.plugin.setState(K);const Ee=u.plugin.getPluginURL();if(u.plugin.isLoaded()&&!u.plugin.isParsed()&&null!=Ee){this.self.importScripts(Ee);const ne=u.plugin.isParsed();de(ne?void 0:new Error(`RTL Text Plugin failed to import scripts from ${Ee}`),ne)}}catch(Ee){de(Ee.toString())}}getAvailableImages(H){let K=this.availableImages[H];return K||(K=[]),K}getLayerIndex(H){let K=this.layerIndexes[H];return K||(K=this.layerIndexes[H]=new Ut),K}getWorkerSource(H,K,de){return this.workerSources[H]||(this.workerSources[H]={}),this.workerSources[H][K]||(this.workerSources[H][K]={}),this.workerSources[H][K][de]||(this.workerSources[H][K][de]=new this.workerSourceTypes[K]({send:(ne,ie,q,re,pe,je)=>{this.actor.send(ne,ie,q,H,pe,je)},scheduler:this.actor.scheduler},this.getLayerIndex(H),this.getAvailableImages(H),this.isSpriteLoaded[H])),this.workerSources[H][K][de]}getDEMWorkerSource(H,K){return this.demWorkerSources[H]||(this.demWorkerSources[H]={}),this.demWorkerSources[H][K]||(this.demWorkerSources[H][K]=new bt),this.demWorkerSources[H][K]}enforceCacheSizeLimit(H,K){u.enforceCacheSizeLimit(K)}getWorkerPerformanceMetrics(H,K,de){de(void 0,void 0)}}return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope&&(self.worker=new Ln(self)),Ln}),_e(0,function(u){function Ie(p,r){if(Array.isArray(p)){if(!Array.isArray(r)||p.length!==r.length)return!1;for(let c=0;c<p.length;c++)if(!Ie(p[c],r[c]))return!1;return!0}if("object"==typeof p&&null!==p&&null!==r){if("object"!=typeof r||Object.keys(p).length!==Object.keys(r).length)return!1;for(const c in p)if(!Ie(p[c],r[c]))return!1;return!0}return p===r}var Kt=Ut;function Ut(p){return r=p,!(typeof window>"u"||typeof document>"u"||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var a,f,d=new Blob([""],{type:"text/javascript"}),y=URL.createObjectURL(d);try{f=new Worker(y),a=!0}catch{a=!1}return f&&f.terminate(),URL.revokeObjectURL(y),a}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var a=document.createElement("canvas");a.width=a.height=1;var f=a.getContext("2d");if(!f)return!1;var d=f.getImageData(0,0,1,1);return d&&d.width===a.width}()||(void 0===bt[c=r&&r.failIfMajorPerformanceCaveat]&&(bt[c]=function(a){var f,y,x,E,d=(y=a,x=document.createElement("canvas"),(E=Object.create(Ut.webGLContextAttributes)).failIfMajorPerformanceCaveat=y,x.getContext("webgl",E)||x.getContext("experimental-webgl",E));if(!d)return!1;try{f=d.createShader(d.VERTEX_SHADER)}catch{return!1}return!(!f||d.isContextLost())&&(d.shaderSource(f,"void main() {}"),d.compileShader(f),!0===d.getShaderParameter(f,d.COMPILE_STATUS))}(c)),!bt[c]||document.documentMode));var r,c}var bt={};function gt(p,r,c){const a=u.window.document.createElement(p);return void 0!==r&&(a.className=r),c&&c.appendChild(a),a}function nt(p,r,c){const a=u.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const f of Object.keys(r))a.setAttributeNS(null,f,r[f]);return c&&c.appendChild(a),a}Ut.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ft=u.window.document&&u.window.document.documentElement.style,Et=ft&&void 0!==ft.userSelect?"userSelect":"WebkitUserSelect";let jn;function Jt(){ft&&Et&&(jn=ft[Et],ft[Et]="none")}function hn(){ft&&Et&&(ft[Et]=jn)}function Qt(p){p.preventDefault(),p.stopPropagation(),u.window.removeEventListener("click",Qt,!0)}function tr(){u.window.addEventListener("click",Qt,!0),u.window.setTimeout(()=>{u.window.removeEventListener("click",Qt,!0)},0)}function dt(p,r){const c=p.getBoundingClientRect();return Je(p,c,r)}function Lr(p,r){const c=p.getBoundingClientRect(),a=[];for(let f=0;f<r.length;f++)a.push(Je(p,c,r[f]));return a}function Zr(p){return void 0!==u.window.InstallTrigger&&2===p.button&&p.ctrlKey&&u.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function Je(p,r,c){const a=p.offsetWidth===r.width?1:p.offsetWidth/r.width;return new u.pointGeometry((c.clientX-r.left)*a,(c.clientY-r.top)*a)}function Ne(p,r){var c=r[0],a=r[1],f=r[2],d=r[3],y=c*d-f*a;return y?(p[0]=d*(y=1/y),p[1]=-a*y,p[2]=-f*y,p[3]=c*y,p):null}function mt(p){const{userImage:r}=p;return!!(r&&r.render&&r.render())&&(p.data.replace(new Uint8Array(r.data.buffer)),!0)}class ln extends u.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(r){if(this.loaded!==r&&(this.loaded=r,r)){for(const{ids:c,callback:a}of this.requestors)this._notify(c,a);this.requestors=[]}}hasImage(r){return!!this.getImage(r)}getImage(r){return this.images[r]}addImage(r,c){this._validate(r,c)&&(this.images[r]=c)}_validate(r,c){let a=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new u.ErrorEvent(new Error(`Image "${r}" has invalid "stretchX" value`))),a=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new u.ErrorEvent(new Error(`Image "${r}" has invalid "stretchY" value`))),a=!1),this._validateContent(c.content,c)||(this.fire(new u.ErrorEvent(new Error(`Image "${r}" has invalid "content" value`))),a=!1),a}_validateStretch(r,c){if(!r)return!0;let a=0;for(const f of r){if(f[0]<a||f[1]<f[0]||c<f[1])return!1;a=f[1]}return!0}_validateContent(r,c){return!(r&&(4!==r.length||r[0]<0||c.data.width<r[0]||r[1]<0||c.data.height<r[1]||r[2]<0||c.data.width<r[2]||r[3]<0||c.data.height<r[3]||r[2]<r[0]||r[3]<r[1]))}updateImage(r,c){c.version=this.images[r].version+1,this.images[r]=c,this.updatedImages[r]=!0}removeImage(r){const c=this.images[r];delete this.images[r],delete this.patterns[r],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(r,c){let a=!0;if(!this.isLoaded())for(const f of r)this.images[f]||(a=!1);this.isLoaded()||a?this._notify(r,c):this.requestors.push({ids:r,callback:c})}_notify(r,c){const a={};for(const f of r){this.images[f]||this.fire(new u.Event("styleimagemissing",{id:f}));const d=this.images[f];d?a[f]={data:d.data.clone(),pixelRatio:d.pixelRatio,sdf:d.sdf,version:d.version,stretchX:d.stretchX,stretchY:d.stretchY,content:d.content,hasRenderCallback:Boolean(d.userImage&&d.userImage.render)}:u.warnOnce(`Image "${f}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,a)}getPixelSize(){const{width:r,height:c}=this.atlasImage;return{width:r,height:c}}getPattern(r){const c=this.patterns[r],a=this.getImage(r);if(!a)return null;if(c&&c.position.version===a.version)return c.position;if(c)c.position.version=a.version;else{const f={w:a.data.width+2,h:a.data.height+2,x:0,y:0},d=new u.ImagePosition(f,a);this.patterns[r]={bin:f,position:d}}return this._updatePatternAtlas(),this.patterns[r].position}bind(r){const c=r.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new u.Texture(r,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const r=[];for(const d in this.patterns)r.push(this.patterns[d].bin);const{w:c,h:a}=u.potpack(r),f=this.atlasImage;f.resize({width:c||1,height:a||1});for(const d in this.patterns){const{bin:y}=this.patterns[d],x=y.x+1,E=y.y+1,C=this.images[d].data,k=C.width,U=C.height;u.RGBAImage.copy(C,f,{x:0,y:0},{x,y:E},{width:k,height:U}),u.RGBAImage.copy(C,f,{x:0,y:U-1},{x,y:E-1},{width:k,height:1}),u.RGBAImage.copy(C,f,{x:0,y:0},{x,y:E+U},{width:k,height:1}),u.RGBAImage.copy(C,f,{x:k-1,y:0},{x:x-1,y:E},{width:1,height:U}),u.RGBAImage.copy(C,f,{x:0,y:0},{x:x+k,y:E},{width:1,height:U})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(r){for(const c of r){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const a=this.images[c];mt(a)&&this.updateImage(c,a)}}}const Ue=new u.Properties({anchor:new u.DataConstantProperty(u.spec.light.anchor),position:new class{constructor(){this.specification=u.spec.light.position}possiblyEvaluate(p,r){return function([c,a,f]){const d=u.degToRad(a+90),y=u.degToRad(f);return{x:c*Math.cos(d)*Math.sin(y),y:c*Math.sin(d)*Math.sin(y),z:c*Math.cos(y),azimuthal:a,polar:f}}(p.expression.evaluate(r))}interpolate(p,r,c){return{x:u.number(p.x,r.x,c),y:u.number(p.y,r.y,c),z:u.number(p.z,r.z,c),azimuthal:u.number(p.azimuthal,r.azimuthal,c),polar:u.number(p.polar,r.polar,c)}}},color:new u.DataConstantProperty(u.spec.light.color),intensity:new u.DataConstantProperty(u.spec.light.intensity)}),en="-transition";class Xt extends u.Evented{constructor(r){super(),this._transitionable=new u.Transitionable(Ue),this.setLight(r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,c={}){if(!this._validate(u.validateLight,r,c))for(const a in r){const f=r[a];u.endsWith(a,en)?this._transitionable.setTransition(a.slice(0,-en.length),f):this._transitionable.setValue(a,f)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,a){return(!a||!1!==a.validate)&&u.emitValidationErrors(this,r.call(u.validateStyle,u.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}const $t=new u.Properties({source:new u.DataConstantProperty(u.spec.terrain.source),exaggeration:new u.DataConstantProperty(u.spec.terrain.exaggeration)}),an="-transition";class mn extends u.Evented{constructor(r,c){super(),this._transitionable=new u.Transitionable($t),this.set(r),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=c}get(){return this._transitionable.serialize()}set(r){for(const c in r){const a=r[c];u.endsWith(c,an)?this._transitionable.setTransition(c.slice(0,-an.length),a):this._transitionable.setValue(c,a)}}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}}function Gt(p,r,c,a){const f=u.smoothstep(45,65,c),[d,y]=lt(p,a),x=u.length(r);let E=1-Math.min(1,Math.exp((x-d)/(y-d)*-6));return E*=E*E,E=Math.min(1,1.00747*E),E*f*p.alpha}function lt(p,r){const c=.5/Math.tan(.5*r);return[p.range[0]+c,p.range[1]+c]}const rt=new u.Properties({range:new u.DataConstantProperty(u.spec.fog.range),color:new u.DataConstantProperty(u.spec.fog.color),"high-color":new u.DataConstantProperty(u.spec.fog["high-color"]),"space-color":new u.DataConstantProperty(u.spec.fog["space-color"]),"horizon-blend":new u.DataConstantProperty(u.spec.fog["horizon-blend"]),"star-intensity":new u.DataConstantProperty(u.spec.fog["star-intensity"])}),Dt="-transition";class It extends u.Evented{constructor(r,c){super(),this._transitionable=new u.Transitionable(rt),this.set(r),this._transitioning=this._transitionable.untransitioned(),this._transform=c}get state(){const r=this._transform,c="globe"===r.projection.name,a=u.globeToMercatorTransition(r.zoom),f=this.properties.get("range"),d=[.5,3];return{range:c?[u.number(d[0],f[0],a),u.number(d[1],f[1],a)]:f,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,c={}){if(!this._validate(u.validateFog,r,c)){for(const a of Object.keys(u.spec.fog))r&&void 0===r[a]&&(r[a]=u.spec.fog[a].default);for(const a in r){const f=r[a];u.endsWith(a,Dt)?this._transitionable.setTransition(a.slice(0,-Dt.length),f):this._transitionable.setValue(a,f)}}}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:u.smoothstep(45,65,r))*c.a}getOpacityAtLatLng(r,c){return this._transform.projection.supportsFog?function(a,f,d){const y=u.MercatorCoordinate.fromLngLat(f),x=d.elevation?d.elevation.getAtPointOrZero(y):0,E=[y.x,y.y,x];return u.transformMat4(E,E,d.mercatorFogMatrix),Gt(a,E,d.pitch,d._fov)}(this.state,r,c):0}getFovAdjustedRange(r){return this._transform.projection.supportsFog?lt(this.state,r):[0,1]}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,a){return(!a||!1!==a.validate)&&u.emitValidationErrors(this,r.call(u.validateStyle,u.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:u.spec})))}}class Ht{constructor(r,c){this.workerPool=r,this.actors=[],this.currentActor=0,this.id=u.uniqueId();const a=this.workerPool.acquire(this.id);for(let f=0;f<a.length;f++){const d=new Ht.Actor(a[f],c,this.id);d.name=`Worker ${f}`,this.actors.push(d)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(r,c,a){u.asyncAll(this.actors,(f,d)=>{f.send(r,c,d)},a=a||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(r=>{r.remove()}),this.actors=[],this.workerPool.release(this.id)}}function Nt(p,r,c){return r*(u.EXTENT/(p.tileSize*Math.pow(2,c-p.tileID.overscaledZ)))}Ht.Actor=u.Actor;class Dn{constructor(r,c,a,f){this.screenBounds=r,this.cameraPoint=c,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=a,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,f)}static createFromScreenPoints(r,c){let a,f;if(r instanceof u.pointGeometry||"number"==typeof r[0]){const d=u.pointGeometry.convert(r);a=[d],f=c.isPointAboveHorizon(d)}else{const d=u.pointGeometry.convert(r[0]),y=u.pointGeometry.convert(r[1]);a=[d,y],f=u.polygonizeBounds(d,y).every(x=>c.isPointAboveHorizon(x))}return new Dn(a,c.getCameraPoint(),f,c)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(r){return u.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const c=this.screenBounds[0],a=1===this.screenBounds.length?this.screenBounds[0].add(new u.pointGeometry(1,1)):this.screenBounds[1],f=u.polygonizeBounds(c,a,0,!1);return this.cameraPoint.y>a.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<a.x?f.splice(3,0,this.cameraPoint):this.cameraPoint.x>=a.x?f[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(f[3]=this.cameraPoint)),u.bufferConvexPolygon(f,r)}bufferedCameraGeometryGlobe(r){const c=this.screenBounds[0],a=1===this.screenBounds.length?this.screenBounds[0].add(new u.pointGeometry(1,1)):this.screenBounds[1],f=u.polygonizeBounds(c,a,r),d=this.cameraPoint.clone();switch(3*((d.y>c.y)+(d.y>a.y))+((d.x>c.x)+(d.x>a.x))){case 0:f[0]=d,f[4]=d.clone();break;case 1:f.splice(1,0,d);break;case 2:f[1]=d;break;case 3:f.splice(4,0,d);break;case 5:f.splice(2,0,d);break;case 6:f[3]=d;break;case 7:f.splice(3,0,d);break;case 8:f[2]=d}return f}containsTile(r,c,a,f=0){const d=r.queryPadding/c._pixelsPerMercatorPixel+1,y=a?this._bufferedCameraMercator(d,c):this._bufferedScreenMercator(d,c);let x=r.tileID.wrap+(y.unwrapped?f:0);const E=y.polygon.map(me=>u.getTilePoint(r.tileTransform,me,x));if(!u.polygonIntersectsBox(E,0,0,u.EXTENT,u.EXTENT))return;x=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?f:0);const C=this.screenGeometryMercator.polygon.map(me=>u.getTileVec3(r.tileTransform,me,x)),k=C.map(me=>new u.pointGeometry(me[0],me[1])),U=c.getFreeCameraOptions().position||new u.MercatorCoordinate(0,0,0),Y=u.getTileVec3(r.tileTransform,U,x),oe=C.map(me=>{const ee=u.sub(me,me,Y);return u.normalize(ee,ee),new u.Ray(Y,ee)}),le=Nt(r,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:oe,bufferedTilespaceGeometry:E,bufferedTilespaceBounds:(he=u.getBounds(E),he.min.x=u.clamp(he.min.x,0,u.EXTENT),he.min.y=u.clamp(he.min.y,0,u.EXTENT),he.max.x=u.clamp(he.max.x,0,u.EXTENT),he.max.y=u.clamp(he.max.y,0,u.EXTENT),he),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:le};var he}_bufferedScreenMercator(r,c){const a=vn(r);if(this._screenRaycastCache[a])return this._screenRaycastCache[a];{let f;return f="globe"===c.projection.name?this._projectAndResample(this.bufferedScreenGeometry(r),c):{polygon:this.bufferedScreenGeometry(r).map(d=>c.pointCoordinate3D(d)),unwrapped:!0},this._screenRaycastCache[a]=f,f}}_bufferedCameraMercator(r,c){const a=vn(r);if(this._cameraRaycastCache[a])return this._cameraRaycastCache[a];{let f;return f="globe"===c.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),c):{polygon:this.bufferedCameraGeometry(r).map(d=>c.pointCoordinate3D(d)),unwrapped:!0},this._cameraRaycastCache[a]=f,f}}_projectAndResample(r,c){const a=function(d,y){const x=u.multiply([],y.pixelMatrix,y.globeMatrix),E=[0,-u.GLOBE_RADIUS,0,1],C=[0,u.GLOBE_RADIUS,0,1],k=[0,0,0,1];u.transformMat4$1(E,E,x),u.transformMat4$1(C,C,x),u.transformMat4$1(k,k,x);const U=new u.pointGeometry(E[0]/E[3],E[1]/E[3]),Y=new u.pointGeometry(C[0]/C[3],C[1]/C[3]),oe=u.polygonContainsPoint(d,U)&&E[3]<k[3],le=u.polygonContainsPoint(d,Y)&&C[3]<k[3];if(!oe&&!le)return null;const he=function(Be,He,Xe){for(let Qe=1;Qe<Be.length;Qe++){const qt=or(He.pointCoordinate3D(Be[Qe-1]).x),qe=or(He.pointCoordinate3D(Be[Qe]).x);if(Xe<0){if(qt<qe)return{idx:Qe,t:-qt/(qe-1-qt)}}else if(qe<qt)return{idx:Qe,t:(1-qt)/(qe+1-qt)}}return null}(d,y,oe?-1:1);if(!he)return null;const{idx:me,t:ee}=he;let be=me>1?yr(d.slice(0,me),y):[],ye=me<d.length?yr(d.slice(me),y):[];be=be.map(Be=>new u.pointGeometry(or(Be.x),Be.y)),ye=ye.map(Be=>new u.pointGeometry(or(Be.x),Be.y));const De=[...be];0===De.length&&De.push(ye[ye.length-1]);const ke=u.number(De[De.length-1].y,(0===ye.length?be[0]:ye[0]).y,ee);let Ae;return Ae=oe?[new u.pointGeometry(0,ke),new u.pointGeometry(0,0),new u.pointGeometry(1,0),new u.pointGeometry(1,ke)]:[new u.pointGeometry(1,ke),new u.pointGeometry(1,1),new u.pointGeometry(0,1),new u.pointGeometry(0,ke)],De.push(...Ae),0===ye.length?De.push(be[0]):De.push(...ye),{polygon:De.map(Be=>new u.MercatorCoordinate(Be.x,Be.y)),unwrapped:!1}}(r,c);if(a)return a;const f=function(d,y){let x=!1,E=-1/0,C=0;for(let U=0;U<d.length-1;U++)d[U].x>E&&(E=d[U].x,C=U);for(let U=0;U<d.length-1;U++){const Y=(C+U)%(d.length-1),oe=d[Y],le=d[Y+1];Math.abs(oe.x-le.x)>.5&&(oe.x<le.x?(oe.x+=1,0===Y&&(d[d.length-1].x+=1)):(le.x+=1,Y+1===d.length-1&&(d[0].x+=1)),x=!0)}const k=u.mercatorXfromLng(y.center.lng);return x&&k<Math.abs(k-1)&&d.forEach(U=>{U.x-=1}),{polygon:d,unwrapped:x}}(yr(r,c).map(d=>new u.pointGeometry(or(d.x),d.y)),c);return{polygon:f.polygon.map(d=>new u.MercatorCoordinate(d.x,d.y)),unwrapped:f.unwrapped}}}function yr(p,r){return u.resample(p,c=>{const a=r.pointCoordinate3D(c);c.x=a.x,c.y=a.y},1/256)}function or(p){return p<0?1+p%1:p%1}function vn(p){return 100*p|0}function In(p,r,c,a,f){const d=function(y,x){if(y)return f(y);if(x){p.url&&x.tiles&&p.tiles&&delete p.tiles;const E=u.pick(u.extend(x,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(E.vectorLayers=x.vector_layers,E.vectorLayerIds=E.vectorLayers.map(C=>C.id)),E.tiles=r.canonicalizeTileset(E,p.url),f(null,E)}};return p.url?u.getJSON(r.transformRequest(r.normalizeSourceURL(p.url,null,c,a),u.ResourceType.Source),d):u.exported.frame(()=>d(null,p))}class cn{constructor(r,c,a){this.bounds=u.LngLatBounds.convert(this.validateBounds(r)),this.minzoom=c||0,this.maxzoom=a||24}validateBounds(r){return Array.isArray(r)&&4===r.length?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}contains(r){const c=Math.pow(2,r.z),a=Math.floor(u.mercatorXfromLng(this.bounds.getWest())*c),f=Math.floor(u.mercatorYfromLat(this.bounds.getNorth())*c),d=Math.ceil(u.mercatorXfromLng(this.bounds.getEast())*c),y=Math.ceil(u.mercatorYfromLat(this.bounds.getSouth())*c);return r.x>=a&&r.x<d&&r.y>=f&&r.y<y}}class pr{constructor(r,c,a){this.context=r;const f=r.gl;this.buffer=f.createBuffer(),this.dynamicDraw=Boolean(a),this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),f.bufferData(f.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?f.DYNAMIC_DRAW:f.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const vr={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class si{constructor(r,c,a,f){this.length=c.length,this.attributes=a,this.itemSize=c.bytesPerElement,this.dynamicDraw=f,this.context=r;const d=r.gl;this.buffer=d.createBuffer(),r.bindVertexBuffer.set(this.buffer),d.bufferData(d.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?d.DYNAMIC_DRAW:d.STATIC_DRAW),this.dynamicDraw||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,c){for(let a=0;a<this.attributes.length;a++){const f=c.attributes[this.attributes[a].name];void 0!==f&&r.enableVertexAttribArray(f)}}setVertexAttribPointers(r,c,a){for(let f=0;f<this.attributes.length;f++){const d=this.attributes[f],y=c.attributes[d.name];void 0!==y&&r.vertexAttribPointer(y,d.components,r[vr[d.type]],!1,this.itemSize,d.offset+this.itemSize*(a||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class bn{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ni extends bn{getDefault(){return u.Color.transparent}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class wr extends bn{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class Yi extends bn{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class yi extends bn{getDefault(){return[!0,!0,!0,!0]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class Xr extends bn{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class Pn extends bn{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class jr extends bn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const c=this.current;(r.func!==c.func||r.ref!==c.ref||r.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class Br extends bn{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class ri extends bn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=r,this.dirty=!1}}class Pi extends bn{getDefault(){return[0,1]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class So extends bn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=r,this.dirty=!1}}class Vn extends bn{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class yn extends bn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.BLEND):c.disable(c.BLEND),this.current=r,this.dirty=!1}}class Ri extends bn{getDefault(){const r=this.gl;return[r.ONE,r.ZERO]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(r[0],r[1]),this.current=r,this.dirty=!1)}}class Mr extends bn{getDefault(){return u.Color.transparent}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class on extends bn{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquation(r),this.current=r,this.dirty=!1)}}class St extends bn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=r,this.dirty=!1}}class vi extends bn{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class dr extends bn{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}class Nr extends bn{getDefault(){return null}set(r){(r!==this.current||this.dirty)&&(this.gl.useProgram(r),this.current=r,this.dirty=!1)}}class io extends bn{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class ki extends bn{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class oo extends bn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Dr extends bn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class po extends bn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class gr extends bn{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class so extends bn{getDefault(){return null}set(r){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class kn extends bn{constructor(r){super(r),this.vao=r.extVertexArrayObject}getDefault(){return null}set(r){this.vao&&(r!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(r),this.current=r,this.dirty=!1)}}class xi extends bn{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class $n extends bn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class pt extends bn{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Fe extends bn{constructor(r,c){super(r),this.context=r,this.parent=c}getDefault(){return null}}class Re extends Fe{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Wt extends Fe{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Pt extends Wt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Ln{constructor(r,c,a,f){this.context=r,this.width=c,this.height=a;const d=this.framebuffer=r.gl.createFramebuffer();this.colorAttachment=new Re(r,d),f&&(this.depthAttachment=new Wt(r,d))}destroy(){const r=this.context.gl,c=this.colorAttachment.get();if(c&&r.deleteTexture(c),this.depthAttachment){const a=this.depthAttachment.get();a&&r.deleteRenderbuffer(a)}r.deleteFramebuffer(this.framebuffer)}}class ue{constructor(r,c=!1){if(this.gl=r,this.isWebGL2=c,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),c){const a=r;this.extVertexArrayObject={createVertexArrayOES:a.createVertexArray.bind(r),deleteVertexArrayOES:a.deleteVertexArray.bind(r),bindVertexArrayOES:a.bindVertexArray.bind(r)}}this.clearColor=new ni(this),this.clearDepth=new wr(this),this.clearStencil=new Yi(this),this.colorMask=new yi(this),this.depthMask=new Xr(this),this.stencilMask=new Pn(this),this.stencilFunc=new jr(this),this.stencilOp=new Br(this),this.stencilTest=new ri(this),this.depthRange=new Pi(this),this.depthTest=new So(this),this.depthFunc=new Vn(this),this.blend=new yn(this),this.blendFunc=new Ri(this),this.blendColor=new Mr(this),this.blendEquation=new on(this),this.cullFace=new St(this),this.cullFaceSide=new vi(this),this.frontFace=new dr(this),this.program=new Nr(this),this.activeTexture=new io(this),this.viewport=new ki(this),this.bindFramebuffer=new oo(this),this.bindRenderbuffer=new Dr(this),this.bindTexture=new po(this),this.bindVertexBuffer=new gr(this),this.bindElementBuffer=new so(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new kn(this),this.pixelStoreUnpack=new xi(this),this.pixelStoreUnpackPremultiplyAlpha=new $n(this),this.pixelStoreUnpackFlipY=new pt(this),this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),c||(this.extTextureHalfFloat=r.getExtension("OES_texture_half_float")),(c||this.extTextureHalfFloat&&r.getExtension("OES_texture_half_float_linear"))&&(this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=c||r.getExtension("OES_standard_derivatives"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,c){return new pr(this,r,c)}createVertexBuffer(r,c,a){return new si(this,r,c,a)}createRenderbuffer(r,c,a){const f=this.gl,d=f.createRenderbuffer();return this.bindRenderbuffer.set(d),f.renderbufferStorage(f.RENDERBUFFER,r,c,a),this.bindRenderbuffer.set(null),d}createFramebuffer(r,c,a){return new Ln(this,r,c,a)}clear({color:r,depth:c,stencil:a}){const f=this.gl;let d=0;r&&(d|=f.COLOR_BUFFER_BIT,this.clearColor.set(r),this.colorMask.set([!0,!0,!0,!0])),void 0!==c&&(d|=f.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),void 0!==a&&(d|=f.STENCIL_BUFFER_BIT,this.clearStencil.set(a),this.stencilMask.set(255)),f.clear(d)}setCullFace(r){!1===r.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){Ie(r.blendFunction,u.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor)),this.colorMask.set(r.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class H extends u.Evented{constructor(r,c,a,f){if(super(),this.id=r,this.dispatcher=a,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.extend(this,u.pick(c,["url","scheme","tileSize","promoteId"])),this._options=u.extend({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(f),this._tileWorkers={},this._deduped=new u.DedupedRequest}load(r){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,a=this.map._worldview;this._tileJSONRequest=In(this._options,this.map._requestManager,c,a,(f,d)=>{this._tileJSONRequest=null,this._loaded=!0,f?(c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),a&&2!==a.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${a}`),this.fire(new u.ErrorEvent(f))):d&&(u.extend(this,d),d.bounds&&(this.tileBounds=new cn(d.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(d.tiles,this.map._requestManager._customAccessToken),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(f)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return u.extend({},this._options)}loadTile(r,c){const a=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(a,u.ResourceType.Tile),data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile};if(f.request.collectResourceTiming=this._collectResourceTiming,r.actor&&"expired"!==r.state)"loading"===r.state?r.reloadCallback=c:r.request=r.actor.send("reloadTile",f,d.bind(this));else if(r.actor=this._tileWorkers[a]=this._tileWorkers[a]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",f,d.bind(this),void 0,!0);else{const y=u.loadVectorTile.call({deduped:this._deduped},f,(x,E)=>{x||!E?d.call(this,x):(f.data={cacheControl:E.cacheControl,expires:E.expires,rawData:E.rawData.slice(0)},r.actor&&r.actor.send("loadTile",f,d.bind(this),void 0,!0))},!0);r.request={cancel:y}}function d(y,x){return delete r.request,r.aborted?c(null):y&&404!==y.status?c(y):(x&&x.resourceTiming&&(r.resourceTiming=x.resourceTiming),this.map._refreshExpiredTiles&&x&&r.setExpiryData(x),r.loadVectorData(x,this.map.painter),u.cacheEntryPossiblyAdded(this.dispatcher),c(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id})}unloadTile(r){r.unloadVectorData(),r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class K extends u.Evented{constructor(r,c,a,f){super(),this.id=r,this.dispatcher=a,this.setEventedParent(f),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.extend({type:"raster"},c),u.extend(this,u.pick(c,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=In(this._options,this.map._requestManager,null,null,(c,a)=>{this._tileJSONRequest=null,this._loaded=!0,c?this.fire(new u.ErrorEvent(c)):a&&(u.extend(this,a),a.bounds&&(this.tileBounds=new cn(a.bounds,this.minzoom,this.maxzoom)),u.postTurnstileEvent(a.tiles),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))),r&&r(c)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest(),this.load(()=>this.map.style._clearSource(this.id))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(){this.cancelTileJSONRequest()}serialize(){return u.extend({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,c){const a=u.exported.devicePixelRatio>=2,f=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),a,this.tileSize);r.request=u.getImage(this.map._requestManager.transformRequest(f,u.ResourceType.Tile),(d,y,x,E)=>(delete r.request,r.aborted?(r.state="unloaded",c(null)):d?(r.state="errored",c(d)):y?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:x,expires:E}),r.setTexture(y,this.map.painter),r.state="loaded",u.cacheEntryPossiblyAdded(this.dispatcher),void c(null)):c(null)))}static loadTileData(r,c,a){r.setTexture(c,a)}static unloadTileData(r,c){r.texture&&c.saveTileTexture(r.texture)}abortTile(r,c){r.request&&(r.request.cancel(),delete r.request),c()}unloadTile(r,c){r.texture&&this.map.painter.saveTileTexture(r.texture),c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}let de;function Ee(p,r,c,a,f,d,y,x){const E=[p,c,f,r,a,d,1,1,1],C=[y,x,1],k=u.adjoint([],E),[U,Y,oe]=u.transformMat3(C,C,u.transpose(k,k));return u.multiply$1(E,[U,0,0,0,Y,0,0,0,oe],E)}class ne extends u.Evented{constructor(r,c,a,f){super(),this.id=r,this.dispatcher=a,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(f),this.options=c,this._dirty=!1}load(r,c){this._loaded=c||!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._imageRequest=u.getImage(this.map._requestManager.transformRequest(this.url,u.ResourceType.Image),(a,f)=>{if(this._imageRequest=null,this._loaded=!0,a)this.fire(new u.ErrorEvent(a));else if(f){const{HTMLImageElement:d}=u.window;this.image=f instanceof d?u.exported.getImageData(f):f,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,r&&(this.coordinates=r),this._finishLoading()}})}loaded(){return this._loaded}updateImage(r){return this.image&&r.url?(this._imageRequest&&r.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=r.url,this.load(r.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(r){this.map=r,this.load()}onRemove(){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),this.texture&&this.texture.destroy()}setCoordinates(r){this.coordinates=r,this._boundsArray=void 0;const c=r.map(u.MercatorCoordinate.fromLngLat);return this.tileID=function(a){let f=1/0,d=1/0,y=-1/0,x=-1/0;for(const U of a)f=Math.min(f,U.x),d=Math.min(d,U.y),y=Math.max(y,U.x),x=Math.max(x,U.y);const E=Math.max(y-f,x-d),C=Math.max(0,Math.floor(-Math.log(E)/Math.LN2)),k=Math.pow(2,C);return new u.CanonicalTileID(C,Math.floor((f+y)/2*k),Math.floor((d+x)/2*k))}(c),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(r){for(const E in this.tiles){const C=this.tiles[E];"loaded"!==C.state&&(C.state="loaded",C.texture=this.texture)}if(this._boundsArray)return;const c=u.tileTransform(this.tileID,this.map.transform.projection),[a,f,d,y]=this.coordinates.map(E=>{const C=c.projection.project(E[0],E[1]);return u.getTilePoint(c,C)._round()});this.perspectiveTransform=function(E,C,k,U,Y,oe,le,he,me,ee){const be=Ee(0,0,E,0,0,C,E,C),ye=Ee(k,U,Y,oe,le,he,me,ee);return u.multiply$1(ye,u.adjoint(be,be),ye),[ye[6]/ye[8]*E/u.EXTENT,ye[7]/ye[8]*C/u.EXTENT]}(this.width,this.height,a.x,a.y,f.x,f.y,y.x,y.y,d.x,d.y);const x=this._boundsArray=new u.StructArrayLayout4i8;x.emplaceBack(a.x,a.y,0,0),x.emplaceBack(f.x,f.y,u.EXTENT,0),x.emplaceBack(y.x,y.y,0,u.EXTENT),x.emplaceBack(d.x,d.y,u.EXTENT,u.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=r.createVertexBuffer(x,u.boundsAttributes.members),this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const r=this.map.painter.context,c=r.gl;this._dirty&&(this.texture?this.texture.update(this.image):(this.texture=new u.Texture(r,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE)),this._dirty=!1),this._prepareData(r)}loadTile(r,c){this.tileID&&this.tileID.equals(r.tileID.canonical)?(this.tiles[String(r.tileID.wrap)]=r,r.buckets={},c(null)):(r.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const ie={vector:H,raster:K,"raster-dem":class extends K{constructor(p,r,c,a){super(p,r,c,a),this.type="raster-dem",this.maxzoom=22,this._options=u.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(p,r){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function a(f,d){f&&(p.state="errored",r(f)),d&&(p.dem=d,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",r(null))}p.request=u.getImage(this.map._requestManager.transformRequest(c,u.ResourceType.Tile),function(f,d,y,x){if(delete p.request,p.aborted)p.state="unloaded",r(null);else if(f)p.state="errored",r(f);else if(d){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:y,expires:x});const E=u.window.ImageBitmap&&d instanceof u.window.ImageBitmap&&(null==de&&(de=u.window.OffscreenCanvas&&new u.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof u.window.createImageBitmap),de),C=1-(d.width-u.prevPowerOfTwo(d.width))/2;C<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const k=E?d:u.exported.getImageData(d,C),U={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:k,encoding:this.encoding,padding:C};p.actor&&"expired"!==p.state||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",U,a.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const r=p.canonical,c=Math.pow(2,r.z),a=(r.x-1+c)%c,f=0===r.x?p.wrap-1:p.wrap,d=(r.x+1+c)%c,y=r.x+1===c?p.wrap+1:p.wrap,x={};return x[new u.OverscaledTileID(p.overscaledZ,f,r.z,a,r.y).key]={backfilled:!1},x[new u.OverscaledTileID(p.overscaledZ,y,r.z,d,r.y).key]={backfilled:!1},r.y>0&&(x[new u.OverscaledTileID(p.overscaledZ,f,r.z,a,r.y-1).key]={backfilled:!1},x[new u.OverscaledTileID(p.overscaledZ,p.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},x[new u.OverscaledTileID(p.overscaledZ,y,r.z,d,r.y-1).key]={backfilled:!1}),r.y+1<c&&(x[new u.OverscaledTileID(p.overscaledZ,f,r.z,a,r.y+1).key]={backfilled:!1},x[new u.OverscaledTileID(p.overscaledZ,p.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},x[new u.OverscaledTileID(p.overscaledZ,y,r.z,d,r.y+1).key]={backfilled:!1}),x}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends u.Evented{constructor(p,r,c,a){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(a),this._data=r.data,this._options=u.extend({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const f=u.EXTENT/this.tileSize;this.workerOptions=u.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*f,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*f,extent:u.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:u.EXTENT,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*f,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},r),this}getClusterChildren(p,r){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},r),this}getClusterLeaves(p,r,c,a){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:r,offset:c},a),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new u.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=u.extend({},this.workerOptions),r=this._data;"string"==typeof r?(p.request=this.map._requestManager.transformRequest(u.exported.resolveURL(r),u.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(r),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(c,a)=>{if(this._loaded=!0,this._pendingLoad=null,c)this.fire(new u.ErrorEvent(c));else{const f={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&a&&a.resourceTiming&&a.resourceTiming[this.id]&&(f.resourceTiming=a.resourceTiming[this.id]),this.fire(new u.Event("data",f)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,r){const c=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(c,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:u.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(a,f)=>(delete p.request,p.unloadVectorData(),p.aborted?r(null):a?r(a):(p.loadVectorData(f,this.map.painter,"reloadTile"===c),r(null))),void 0,"loadTile"===c)}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return u.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ne{constructor(p,r,c,a){super(p,r,c,a),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const r of p.urls)this.urls.push(this.map._requestManager.transformRequest(r,u.ResourceType.Source).url);u.getVideo(this.urls,(r,c)=>{this._loaded=!0,r?this.fire(new u.ErrorEvent(r)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const r=this.video.seekable;p<r.start(0)||p>r.end(0)?this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const p=this.map.painter.context,r=p.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new u.Texture(p,this.video,r.RGBA),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ne,canvas:class extends ne{constructor(p,r,c,a){super(p,r,c,a),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(f=>!Array.isArray(f)||2!==f.length||f.some(d=>"number"!=typeof d))||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof u.window.HTMLCanvasElement||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof u.window.HTMLCanvasElement?this.options.canvas:u.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const r=this.map.painter.context;this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new u.Texture(r,this.canvas,r.gl.RGBA,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends u.Evented{constructor(p,r,c,a){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=r,this.setEventedParent(a),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new u.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new u.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new cn(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),u.extend(this,u.pick(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return u.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:r,y:c,z:a}=p.canonical;return this._implementation.hasTile({x:r,y:c,z:a})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,r){const{x:c,y:a,z:f}=p.tileID.canonical,d=new u.window.AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:c,y:a,z:f},{signal:d.signal})).then(function(y){return delete p.request,p.aborted?(p.state="unloaded",r(null)):void 0===y?(p.state="errored",r(null)):null===y?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",r(null)):(x=y)instanceof u.window.ImageData||x instanceof u.window.HTMLCanvasElement||x instanceof u.window.ImageBitmap||x instanceof u.window.HTMLImageElement?(this.loadTileData(p,y),p.state="loaded",void r(null)):(p.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)));var x}.bind(this)).catch(y=>{20!==y.code&&(p.state="errored",r(y))}),p.request.cancel=()=>d.abort()}loadTileData(p,r){K.loadTileData(p,r,this._map.painter)}unloadTileData(p){K.unloadTileData(p,this._map.painter)}unloadTile(p,r){if(this.unloadTileData(p),this._implementation.unloadTile){const{x:c,y:a,z:f}=p.tileID.canonical;this._implementation.unloadTile({x:c,y:a,z:f})}r()}abortTile(p,r){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),r()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){this._map.style._clearSource(this.id)}_update(){this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"}))}}},q=function(p,r,c,a){const f=new ie[r.type](p,r,c,a);if(f.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${f.id}`);return u.bindAll(["load","abort","unload","serialize","prepare"],f),f};function re(p,r){const c=u.identity([]);return u.scale(c,c,[.5*p.width,.5*-p.height,1]),u.translate(c,c,[1,-1,0]),u.multiply(c,c,p.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(c)}function pe(p,r,c,a,f,d,y,x=!1){const E=p.tilesIn(a,y,x);E.sort(ht);const C=[];for(const U of E)C.push({wrappedTileID:U.tile.tileID.wrapped().key,queryResults:U.tile.queryRenderedFeatures(r,c,p._state,U,f,d,re(p.transform,U.tile.tileID),x)});const k=function(U){const Y={},oe={};for(const le of U){const he=le.queryResults,me=le.wrappedTileID,ee=oe[me]=oe[me]||{};for(const be in he){const ye=he[be],De=ee[be]=ee[be]||{},ke=Y[be]=Y[be]||[];for(const Ae of ye)De[Ae.featureIndex]||(De[Ae.featureIndex]=!0,ke.push(Ae))}}return Y}(C);for(const U in k)k[U].forEach(Y=>{const oe=Y.feature,le=oe.layer;le&&"background"!==le.type&&"sky"!==le.type&&(oe.source=le.source,le["source-layer"]&&(oe.sourceLayer=le["source-layer"]),oe.state=void 0!==oe.id?p.getFeatureState(le["source-layer"],oe.id):{})});return k}function je(p,r){const c=p.getRenderableIds().map(d=>p.getTileByID(d)),a=[],f={};for(let d=0;d<c.length;d++){const y=c[d],x=y.tileID.canonical.key;f[x]||(f[x]=!0,y.querySourceFeatures(a,r))}return a}function ht(p,r){const c=p.tileID,a=r.tileID;return c.overscaledZ-a.overscaledZ||c.canonical.y-a.canonical.y||c.wrap-a.wrap||c.canonical.x-a.canonical.x}function ut(){return null!=cc.workerClass?new cc.workerClass:new u.window.Worker(cc.workerUrl)}const sn="mapboxgl_preloaded_worker_pool";class dn{constructor(){this.active={}}acquire(r){if(!this.workers)for(this.workers=[];this.workers.length<dn.workerCount;)this.workers.push(new ut);return this.active[r]=!0,this.workers.slice()}release(r){delete this.active[r],0===this.numActive()&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[sn]}numActive(){return Object.keys(this.active).length}}let Rt;function xn(){return Rt||(Rt=new dn),Rt}function rr(p,r){const c={};for(const a in p)"ref"!==a&&(c[a]=p[a]);return u.refProperties.forEach(a=>{a in r&&(c[a]=r[a])}),c}function xr(p){p=p.slice();const r=Object.create(null);for(let c=0;c<p.length;c++)r[p[c].id]=p[c];for(let c=0;c<p.length;c++)"ref"in p[c]&&(p[c]=rr(p[c],r[p[c].ref]));return p}dn.workerCount=2;const Sn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function Pr(p,r,c){c.push({command:Sn.addSource,args:[p,r[p]]})}function Or(p,r,c){r.push({command:Sn.removeSource,args:[p]}),c[p]=!0}function Ji(p,r,c,a){Or(p,c,a),Pr(p,r,c)}function Hi(p,r,c){let a;for(a in p[c])if(p[c].hasOwnProperty(a)&&"data"!==a&&!Ie(p[c][a],r[c][a]))return!1;for(a in r[c])if(r[c].hasOwnProperty(a)&&"data"!==a&&!Ie(p[c][a],r[c][a]))return!1;return!0}function ct(p,r,c,a,f,d){let y;for(y in r=r||{},p=p||{})p.hasOwnProperty(y)&&(Ie(p[y],r[y])||c.push({command:d,args:[a,y,r[y],f]}));for(y in r)r.hasOwnProperty(y)&&!p.hasOwnProperty(y)&&(Ie(p[y],r[y])||c.push({command:d,args:[a,y,r[y],f]}))}function $r(p){return p.id}function qn(p,r){return p[r.id]=r,p}class wi{constructor(r,c){this.reset(r,c)}reset(r,c){this.points=r||[],this._distances=[0];for(let a=1;a<this.points.length;a++)this._distances[a]=this._distances[a-1]+this.points[a].dist(this.points[a-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(1===this.points.length)return this.points[0];r=u.clamp(r,0,1);let c=1,a=this._distances[c];const f=r*this.paddedLength+this.padding;for(;a<f&&c<this._distances.length;)a=this._distances[++c];const d=c-1,y=this._distances[d],x=a-y,E=x>0?(f-y)/x:0;return this.points[d].mult(1-E).add(this.points[c].mult(E))}}class Bi{constructor(r,c,a){const f=this.boxCells=[],d=this.circleCells=[];this.xCellCount=Math.ceil(r/a),this.yCellCount=Math.ceil(c/a);for(let y=0;y<this.xCellCount*this.yCellCount;y++)f.push([]),d.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=c,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,c,a,f,d){this._forEachCell(c,a,f,d,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(c),this.bboxes.push(a),this.bboxes.push(f),this.bboxes.push(d)}insertCircle(r,c,a,f){this._forEachCell(c-f,a-f,c+f,a+f,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(c),this.circles.push(a),this.circles.push(f)}_insertBoxCell(r,c,a,f,d,y){this.boxCells[d].push(y)}_insertCircleCell(r,c,a,f,d,y){this.circleCells[d].push(y)}_query(r,c,a,f,d,y){if(a<0||r>this.width||f<0||c>this.height)return!d&&[];const x=[];if(r<=0&&c<=0&&this.width<=a&&this.height<=f){if(d)return!0;for(let E=0;E<this.boxKeys.length;E++)x.push({key:this.boxKeys[E],x1:this.bboxes[4*E],y1:this.bboxes[4*E+1],x2:this.bboxes[4*E+2],y2:this.bboxes[4*E+3]});for(let E=0;E<this.circleKeys.length;E++){const C=this.circles[3*E],k=this.circles[3*E+1],U=this.circles[3*E+2];x.push({key:this.circleKeys[E],x1:C-U,y1:k-U,x2:C+U,y2:k+U})}return y?x.filter(y):x}return this._forEachCell(r,c,a,f,this._queryCell,x,{hitTest:d,seenUids:{box:{},circle:{}}},y),d?x.length>0:x}_queryCircle(r,c,a,f,d){const y=r-a,x=r+a,E=c-a,C=c+a;if(x<0||y>this.width||C<0||E>this.height)return!f&&[];const k=[];return this._forEachCell(y,E,x,C,this._queryCellCircle,k,{hitTest:f,circle:{x:r,y:c,radius:a},seenUids:{box:{},circle:{}}},d),f?k.length>0:k}query(r,c,a,f,d){return this._query(r,c,a,f,!1,d)}hitTest(r,c,a,f,d){return this._query(r,c,a,f,!0,d)}hitTestCircle(r,c,a,f){return this._queryCircle(r,c,a,!0,f)}_queryCell(r,c,a,f,d,y,x,E){const C=x.seenUids,k=this.boxCells[d];if(null!==k){const Y=this.bboxes;for(const oe of k)if(!C.box[oe]){C.box[oe]=!0;const le=4*oe;if(r<=Y[le+2]&&c<=Y[le+3]&&a>=Y[le+0]&&f>=Y[le+1]&&(!E||E(this.boxKeys[oe]))){if(x.hitTest)return y.push(!0),!0;y.push({key:this.boxKeys[oe],x1:Y[le],y1:Y[le+1],x2:Y[le+2],y2:Y[le+3]})}}}const U=this.circleCells[d];if(null!==U){const Y=this.circles;for(const oe of U)if(!C.circle[oe]){C.circle[oe]=!0;const le=3*oe;if(this._circleAndRectCollide(Y[le],Y[le+1],Y[le+2],r,c,a,f)&&(!E||E(this.circleKeys[oe]))){if(x.hitTest)return y.push(!0),!0;{const he=Y[le],me=Y[le+1],ee=Y[le+2];y.push({key:this.circleKeys[oe],x1:he-ee,y1:me-ee,x2:he+ee,y2:me+ee})}}}}}_queryCellCircle(r,c,a,f,d,y,x,E){const C=x.circle,k=x.seenUids,U=this.boxCells[d];if(null!==U){const oe=this.bboxes;for(const le of U)if(!k.box[le]){k.box[le]=!0;const he=4*le;if(this._circleAndRectCollide(C.x,C.y,C.radius,oe[he+0],oe[he+1],oe[he+2],oe[he+3])&&(!E||E(this.boxKeys[le])))return y.push(!0),!0}}const Y=this.circleCells[d];if(null!==Y){const oe=this.circles;for(const le of Y)if(!k.circle[le]){k.circle[le]=!0;const he=3*le;if(this._circlesCollide(oe[he],oe[he+1],oe[he+2],C.x,C.y,C.radius)&&(!E||E(this.circleKeys[le])))return y.push(!0),!0}}}_forEachCell(r,c,a,f,d,y,x,E){const C=this._convertToXCellCoord(r),k=this._convertToYCellCoord(c),U=this._convertToXCellCoord(a),Y=this._convertToYCellCoord(f);for(let oe=C;oe<=U;oe++)for(let le=k;le<=Y;le++)if(d.call(this,r,c,a,f,this.xCellCount*le+oe,y,x,E))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,c,a,f,d,y){const x=f-r,E=d-c,C=a+y;return C*C>x*x+E*E}_circleAndRectCollide(r,c,a,f,d,y,x){const E=(y-f)/2,C=Math.abs(r-(f+E));if(C>E+a)return!1;const k=(x-d)/2,U=Math.abs(c-(d+k));if(U>k+a)return!1;if(C<=E||U<=k)return!0;const Y=C-E,oe=U-k;return Y*Y+oe*oe<=a*a}}const ai=Math.tan(85*Math.PI/180);function Gr(p,r,c,a,f,d,y){const x=u.create();if(c)if("globe"===d.name){const E=u.calculateGlobeLabelMatrix(f,r);u.multiply(x,x,E)}else{const E=Ne([],y);x[0]=E[0],x[1]=E[1],x[4]=E[2],x[5]=E[3],a||u.rotateZ(x,x,f.angle)}else u.multiply(x,f.labelPlaneMatrix,p);return x}function Ks(p,r,c,a,f,d,y){const x=Gr(p,r,c,a,f,d,y);return"globe"===d.name&&c||(x[2]=x[6]=x[10]=x[14]=0),x}function is(p,r,c,a,f,d,y){if(c){if("globe"===d.name){const x=Gr(p,r,c,a,f,d,y);return u.invert(x,x),u.multiply(x,p,x),x}{const x=u.clone(p),E=u.identity([]);return E[0]=y[0],E[1]=y[1],E[4]=y[2],E[5]=y[3],u.multiply(x,x,E),a||u.rotateZ(x,x,-f.angle),x}}return f.glCoordMatrix}function Zt(p,r,c,a){const f=[p,r,c,1];c?u.transformMat4$1(f,f,a):os(f,f,a);const d=f[3];return f[0]/=d,f[1]/=d,f[2]/=d,f}function On(p,r){return Math.min(.5+p/r*.5,1.5)}function Ot(p,r){const c=p[0]/p[3],a=p[1]/p[3];return c>=-r[0]&&c<=r[0]&&a>=-r[1]&&a<=r[1]}function Gn(p,r,c,a,f,d,y,x,E,C){const k=c.transform,U=a?p.textSizeData:p.iconSizeData,Y=u.evaluateSizeForZoom(U,c.transform.zoom),oe="globe"===k.projection.name,le=[256/c.width*2+1,256/c.height*2+1],he=a?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;he.clear();let me=null;oe&&(me=a?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const ee=p.lineVertexArray,be=a?p.text.placedSymbolArray:p.icon.placedSymbolArray,ye=c.transform.width/c.transform.height;let De,ke=!1;for(let Ae=0;Ae<be.length;Ae++){const Be=be.get(Ae),{numGlyphs:He,writingMode:Xe}=Be;if(Xe!==u.WritingMode.vertical||ke||De===u.WritingMode.horizontal||(ke=!0),De=Xe,(Be.hidden||Xe===u.WritingMode.vertical)&&!ke){Cr(He,he);continue}ke=!1;const Qe=new u.pointGeometry(Be.tileAnchorX,Be.tileAnchorY);let{x:qt,y:qe,z:Tt}=k.projection.projectTilePoint(Qe.x,Qe.y,C.canonical);if(E){const[_r,wn,pn]=E(Qe);qt+=_r,qe+=wn,Tt+=pn}const at=[qt,qe,Tt,1];if(u.transformMat4$1(at,at,r),!Ot(at,le)){Cr(He,he);continue}const kt=On(c.transform.cameraToCenterDistance,at[3]),Ye=u.evaluateSizeForFeature(U,Y,Be),Ge=y?Ye/kt:Ye*kt,it=Zt(qt,qe,Tt,f);if(it[3]<=0){Cr(He,he);continue}let Ct={};const Bt=y?null:E,Mn=mo(Be,Ge,!1,x,r,f,d,p.glyphOffsetArray,ee,he,me,it,Qe,Ct,ye,Bt,k.projection,C,y);ke=Mn.useVertical,Bt&&Mn.needsFlipping&&(Ct={}),(Mn.notEnoughRoom||ke||Mn.needsFlipping&&mo(Be,Ge,!0,x,r,f,d,p.glyphOffsetArray,ee,he,me,it,Qe,Ct,ye,Bt,k.projection,C,y).notEnoughRoom)&&Cr(He,he)}a?(p.text.dynamicLayoutVertexBuffer.updateData(he),me&&p.text.globeExtVertexBuffer.updateData(me)):(p.icon.dynamicLayoutVertexBuffer.updateData(he),me&&p.icon.globeExtVertexBuffer.updateData(me))}function Ur(p,r,c,a,f,d,y,x,E,C,k,U,Y,oe,le,he){const{lineStartIndex:me,glyphStartIndex:ee,segment:be}=x,ye=ee+x.numGlyphs,De=me+x.lineLength,ke=r.getoffsetX(ee),Ae=r.getoffsetX(ye-1),Be=ir(p*ke,c,a,f,d,y,be,me,De,E,C,k,U,Y,!0,oe,le,he);if(!Be)return null;const He=ir(p*Ae,c,a,f,d,y,be,me,De,E,C,k,U,Y,!0,oe,le,he);return He?{first:Be,last:He}:null}function Nn(p,r,c,a){return p===u.WritingMode.horizontal&&Math.abs(a)>Math.abs(c)?{useVertical:!0}:p===u.WritingMode.vertical?a>0?{needsFlipping:!0}:null:0!==r&&(0===(f=c)||Math.abs(a/f)>ai)?1===r?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null;var f}function mo(p,r,c,a,f,d,y,x,E,C,k,U,Y,oe,le,he,me,ee,be){const ye=r/24,De=p.lineOffsetX*ye,ke=p.lineOffsetY*ye,{lineStartIndex:Ae,glyphStartIndex:Be,numGlyphs:He,segment:Xe,writingMode:Qe,flipState:qt}=p,qe=Ae+p.lineLength,Tt=at=>{if(k){const[it,Ct,Bt]=at.up,Mn=C.length;u.updateGlobeVertexNormal(k,Mn+0,it,Ct,Bt),u.updateGlobeVertexNormal(k,Mn+1,it,Ct,Bt),u.updateGlobeVertexNormal(k,Mn+2,it,Ct,Bt),u.updateGlobeVertexNormal(k,Mn+3,it,Ct,Bt)}const[kt,Ye,Ge]=at.point;u.addDynamicAttributes(C,kt,Ye,Ge,at.angle)};if(He>1){const at=Ur(ye,x,De,ke,c,U,Y,p,E,d,oe,he,!1,me,ee,be);if(!at)return{notEnoughRoom:!0};if(a&&!c){let[kt,Ye,Ge]=at.first.point,[it,Ct,Bt]=at.last.point;[kt,Ye]=Zt(kt,Ye,Ge,y),[it,Ct]=Zt(it,Ct,Bt,y);const Mn=Nn(Qe,qt,(it-kt)*le,Ct-Ye);if(p.flipState=Mn&&Mn.needsFlipping?1:2,Mn)return Mn}Tt(at.first);for(let kt=Be+1;kt<Be+He-1;kt++){const Ye=ir(ye*x.getoffsetX(kt),De,ke,c,U,Y,Xe,Ae,qe,E,d,oe,he,!1,!1,me,ee,be);if(!Ye)return C.length-=4*(kt-Be),{notEnoughRoom:!0};Tt(Ye)}Tt(at.last)}else{if(a&&!c){const kt=Zt(Y.x,Y.y,0,f),Ye=Ae+Xe+1,Ge=new u.pointGeometry(E.getx(Ye),E.gety(Ye)),it=Zt(Ge.x,Ge.y,0,f),Ct=it[3]>0?it:Mo(Y,Ge,kt,1,f,void 0,me,ee.canonical),Bt=Nn(Qe,qt,(Ct[0]-kt[0])*le,Ct[1]-kt[1]);if(p.flipState=Bt&&Bt.needsFlipping?1:2,Bt)return Bt}const at=ir(ye*x.getoffsetX(Be),De,ke,c,U,Y,Xe,Ae,qe,E,d,oe,he,!1,!1,me,ee,be);if(!at)return{notEnoughRoom:!0};Tt(at)}return{}}function Jr(p,r,c,a,f){const{x:d,y,z:x}=a.projectTilePoint(p.x,p.y,r);if(!f)return Zt(d,y,x,c);const[E,C,k]=f(p);return Zt(d+E,y+C,x+k,c)}function Mo(p,r,c,a,f,d,y,x){const E=Jr(p.sub(r)._unit()._add(p),x,f,y,d);return u.sub(E,c,E),u.normalize(E,E),u.scaleAndAdd(E,c,E,a)}function ir(p,r,c,a,f,d,y,x,E,C,k,U,Y,oe,le,he,me,ee){const be=a?p-r:p+r;let ye=be>0?1:-1,De=0;a&&(ye*=-1,De=Math.PI),ye<0&&(De+=Math.PI);let ke=x+y+(ye>0?0:1)|0,Ae=f,Be=f,He=0,Xe=0;const Qe=Math.abs(be),qt=[],qe=[];let Tt=d,at=Tt;const kt=()=>Mo(at,Tt,Be,Qe-He+1,k,Y,he,me.canonical);for(;He+Xe<=Qe;){if(ke+=ye,ke<x||ke>=E)return null;if(Be=Ae,at=Tt,qt.push(Be),oe&&qe.push(at),Tt=new u.pointGeometry(C.getx(ke),C.gety(ke)),Ae=U[ke],!Ae){const pn=Jr(Tt,me.canonical,k,he,Y);Ae=pn[3]>0?U[ke]=pn:kt()}He+=Xe,Xe=u.distance(Be,Ae)}le&&Y&&(U[ke]&&(Ae=kt(),Xe=u.distance(Be,Ae)),U[ke]=Ae);const Ye=(Qe-He)/Xe,Ge=Tt.sub(at)._mult(Ye)._add(at),it=u.sub([],Ae,Be),Ct=u.scaleAndAdd([],Be,it,Ye);let Bt=[0,0,1],Mn=it[0],_r=it[1];if(ee&&(Bt=he.upVector(me.canonical,Ge.x,Ge.y),0!==Bt[0]||0!==Bt[1]||1!==Bt[2])){const pn=[Bt[2],0,-Bt[0]],Rn=u.cross([],Bt,pn);u.normalize(pn,pn),u.normalize(Rn,Rn),Mn=u.dot(it,pn),_r=u.dot(it,Rn)}if(c){const pn=u.cross([],Bt,it);u.normalize(pn,pn),u.scaleAndAdd(Ct,Ct,pn,c*ye)}const wn=De+Math.atan2(_r,Mn);return qt.push(Ct),oe&&qe.push(Ge),{point:Ct,angle:wn,path:qt,tilePath:qe,up:Bt}}function Cr(p,r){const c=r.length,a=c+4*p;r.resize(a),r.float32.fill(-1/0,4*c,4*a)}function os(p,r,c){const a=r[0],f=r[1];return p[0]=c[0]*a+c[4]*f+c[12],p[1]=c[1]*a+c[5]*f+c[13],p[3]=c[3]*a+c[7]*f+c[15],p}const An=100;class Es{constructor(r,c,a=new Bi(r.width+200,r.height+200,25),f=new Bi(r.width+200,r.height+200,25)){this.transform=r,this.grid=a,this.ignoredGrid=f,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+An,this.screenBottomBoundary=r.height+An,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=c}placeCollisionBox(r,c,a,f,d,y,x,E){let C=a.projectedAnchorX,k=a.projectedAnchorY,U=a.projectedAnchorZ;const Y=a.elevation,oe=a.tileID,le=r.getProjection();if(Y&&oe){const[Ae,Be,He]=le.upVector(oe.canonical,a.tileAnchorX,a.tileAnchorY),Xe=le.upVectorScale(oe.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;C+=Ae*Y*Xe,k+=Be*Y*Xe,U+=He*Y*Xe}const he=this.projectAndGetPerspectiveRatio(x,C,k,U,a.tileID,"globe"===le.name||!!Y||this.transform.pitch>0,le),me=y*he.perspectiveRatio,ee=(a.x1*c+f.x-a.padding)*me+he.point.x,be=(a.y1*c+f.y-a.padding)*me+he.point.y,ye=(a.x2*c+f.x+a.padding)*me+he.point.x,De=(a.y2*c+f.y+a.padding)*me+he.point.y,ke=he.perspectiveRatio<=.55||he.occluded;return!this.isInsideGrid(ee,be,ye,De)||!d&&this.grid.hitTest(ee,be,ye,De,E)||ke?{box:[],offscreen:!1,occluded:he.occluded}:{box:[ee,be,ye,De],offscreen:this.isOffscreen(ee,be,ye,De),occluded:!1}}placeCollisionCircles(r,c,a,f,d,y,x,E,C,k,U,Y,oe,le,he){const me=[],ee=this.transform.elevation,be=r.getProjection(),ye=ee?ee.getAtTileOffsetFunc(he,this.transform.center.lat,this.transform.worldSize,be):null,De=new u.pointGeometry(a.tileAnchorX,a.tileAnchorY);let{x:ke,y:Ae,z:Be}=be.projectTilePoint(De.x,De.y,he.canonical);if(ye){const[Ge,it,Ct]=ye(De);ke+=Ge,Ae+=it,Be+=Ct}const He="globe"===be.name,Xe=this.projectAndGetPerspectiveRatio(x,ke,Ae,Be,he,He||!!ee||this.transform.pitch>0,be),{perspectiveRatio:Qe}=Xe,qt=(U?y/Qe:y*Qe)/u.ONE_EM,qe=Zt(ke,Ae,Be,E),Tt=Xe.signedDistanceFromCamera>0?Ur(qt,d,a.lineOffsetX*qt,a.lineOffsetY*qt,!1,qe,De,a,f,E,{},ee&&!U?ye:null,U&&!!ee,be,he,U):null;let at=!1,kt=!1,Ye=!0;if(Tt&&!Xe.occluded){const Ge=.5*oe*Qe+le,it=new u.pointGeometry(-100,-100),Ct=new u.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Bt=new wi,{first:Mn,last:_r}=Tt,wn=Mn.path.length;let pn=[];for(let zn=wn-1;zn>=1;zn--)pn.push(Mn.path[zn]);for(let zn=1;zn<_r.path.length;zn++)pn.push(_r.path[zn]);const Rn=2.5*Ge;C&&(pn=pn.map(([zn,ti,pi],mi)=>(ye&&!He&&(pi=ye(mi<wn-1?Mn.tilePath[wn-1-mi]:_r.tilePath[mi-wn+2])[2]),Zt(zn,ti,pi,C))),pn.some(zn=>zn[3]<=0)&&(pn=[]));let Ir=[];if(pn.length>0){let zn=1/0,ti=-1/0,pi=1/0,mi=-1/0;for(const Si of pn)zn=Math.min(zn,Si[0]),pi=Math.min(pi,Si[1]),ti=Math.max(ti,Si[0]),mi=Math.max(mi,Si[1]);ti>=it.x&&zn<=Ct.x&&mi>=it.y&&pi<=Ct.y&&(Ir=[pn.map(Si=>new u.pointGeometry(Si[0],Si[1]))],(zn<it.x||ti>Ct.x||pi<it.y||mi>Ct.y)&&(Ir=u.clipLine(Ir,it.x,it.y,Ct.x,Ct.y)))}for(const zn of Ir){Bt.reset(zn,.25*Ge);let ti=0;ti=Bt.length<=.5*Ge?1:Math.ceil(Bt.paddedLength/Rn)+1;for(let pi=0;pi<ti;pi++){const mi=pi/Math.max(ti-1,1),Si=Bt.lerp(mi),Oo=Si.x+An,ks=Si.y+An;me.push(Oo,ks,Ge,0);const ll=Oo-Ge,jl=ks-Ge,Gi=Oo+Ge,Mi=ks+Ge;if(Ye=Ye&&this.isOffscreen(ll,jl,Gi,Mi),kt=kt||this.isInsideGrid(ll,jl,Gi,Mi),!c&&this.grid.hitTestCircle(Oo,ks,Ge,Y)&&(at=!0,!k))return{circles:[],offscreen:!1,collisionDetected:at,occluded:!1}}}}return{circles:!k&&at||!kt?[]:me,offscreen:Ye,collisionDetected:at,occluded:Xe.occluded}}queryRenderedSymbols(r){if(0===r.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const c=[];let a=1/0,f=1/0,d=-1/0,y=-1/0;for(const k of r){const U=new u.pointGeometry(k.x+An,k.y+An);a=Math.min(a,U.x),f=Math.min(f,U.y),d=Math.max(d,U.x),y=Math.max(y,U.y),c.push(U)}const x=this.grid.query(a,f,d,y).concat(this.ignoredGrid.query(a,f,d,y)),E={},C={};for(const k of x){const U=k.key;if(void 0===E[U.bucketInstanceId]&&(E[U.bucketInstanceId]={}),E[U.bucketInstanceId][U.featureIndex])continue;const Y=[new u.pointGeometry(k.x1,k.y1),new u.pointGeometry(k.x2,k.y1),new u.pointGeometry(k.x2,k.y2),new u.pointGeometry(k.x1,k.y2)];u.polygonIntersectsPolygon(c,Y)&&(E[U.bucketInstanceId][U.featureIndex]=!0,void 0===C[U.bucketInstanceId]&&(C[U.bucketInstanceId]=[]),C[U.bucketInstanceId].push(U.featureIndex))}return C}insertCollisionBox(r,c,a,f,d){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:a,featureIndex:f,collisionGroupID:d},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,c,a,f,d){const y=c?this.ignoredGrid:this.grid,x={bucketInstanceId:a,featureIndex:f,collisionGroupID:d};for(let E=0;E<r.length;E+=4)y.insertCircle(x,r[E],r[E+1],r[E+2])}projectAndGetPerspectiveRatio(r,c,a,f,d,y,x){const E=[c,a,f,1];let C=!1;f||this.transform.pitch>0?(u.transformMat4$1(E,E,r),this.fogState&&d&&"globe"!==x.name&&(C=function(oe,le,he,me,ee,be){const ye=be.calculateFogTileMatrix(ee),De=[le,he,me];return u.transformMat4(De,De,ye),Gt(oe,De,be.pitch,be._fov)}(this.fogState,c,a,f,d.toUnwrapped(),this.transform)>.9)):os(E,E,r);const k=E[3];return{point:new u.pointGeometry((E[0]/k+1)/2*this.transform.width+An,(-E[1]/k+1)/2*this.transform.height+An),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(x)/k*.5,1.5),signedDistanceFromCamera:k,occluded:y&&E[2]>k||C}}isOffscreen(r,c,a,f){return a<An||r>=this.screenRightBoundary||f<An||c>this.screenBottomBoundary}isInsideGrid(r,c,a,f){return a>=0&&r<this.gridRightBoundary&&f>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const r=u.identity([]);return u.translate(r,r,[-100,-100,0]),r}}function bi(p,r,c){const a=r.createTileMatrix(p,p.worldSize,c.toUnwrapped());return u.multiply(new Float32Array(16),p.projMatrix,a)}function Bs(p,r,c){if(r.projection.name===c.projection.name)return p.projMatrix;const a=c.clone();return a.setProjection(r.projection),bi(a,r.getProjection(),p)}function Qi(p,r,c){return r.name===c.projection.name?p.projMatrix:bi(c,r,p)}class li{constructor(r,c,a,f){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?c:-c))):f&&a?1:0,this.placed=a}isHidden(){return 0===this.opacity&&!this.placed}}class ao{constructor(r,c,a,f,d,y=!1){this.text=new li(r?r.text:null,c,a,d),this.icon=new li(r?r.icon:null,c,f,d),this.clipped=y}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class hi{constructor(r,c,a,f=!1){this.text=r,this.icon=c,this.skipFade=a,this.clipped=f}}class lo{constructor(){this.invProjMatrix=u.create(),this.viewportMatrix=u.create(),this.circles=[]}}class Li{constructor(r,c,a,f,d){this.bucketInstanceId=r,this.featureIndex=c,this.sourceLayerIndex=a,this.bucketIndex=f,this.tileID=d}}class Qr{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const c=++this.maxGroupID;this.collisionGroups[r]={ID:c,predicate:a=>a.collisionGroupID===c}}return this.collisionGroups[r]}}function Hr(p,r,c,a,f){const{horizontalAlign:d,verticalAlign:y}=u.getAnchorAlignment(p),x=-(d-.5)*r,E=-(y-.5)*c,C=u.evaluateVariableOffset(p,a);return new u.pointGeometry(x+C[0]*f,E+C[1]*f)}function Bo(p,r,c,a,f){const d=new u.pointGeometry(p,r);return c&&d._rotate(a?f:-f),d}class Wi{constructor(r,c,a,f,d){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new Es(this.transform,d),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new Qr(a),this.collisionCircleArrays={},this.prevPlacement=f,f&&(f.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,c,a,f){const d=a.getBucket(c),y=a.latestFeatureIndex;if(!d||!y||c.id!==d.layerIds[0])return;const x=d.layers[0].layout,E=a.collisionBoxArray,C=Math.pow(2,this.transform.zoom-a.tileID.overscaledZ),k=a.tileSize/u.EXTENT,U=a.tileID.toUnwrapped();this.transform.setProjection(d.projection);const Y=(oe=a.tileID,le=d.getProjection(),he=this.transform,le.name===this.projection?he.calculateProjMatrix(oe.toUnwrapped()):bi(he,le,oe));var oe,le,he;const me="map"===x.get("text-pitch-alignment"),ee="map"===x.get("text-rotation-alignment");c.compileFilter();const be=c.dynamicFilter(),ye=c.dynamicFilterNeedsFeature(),De=this.transform.calculatePixelsToTileUnitsMatrix(a),ke=Ks(Y,a.tileID.canonical,me,ee,this.transform,d.getProjection(),De);let Ae=null;if(me){const Xe=is(Y,a.tileID.canonical,me,ee,this.transform,d.getProjection(),De);Ae=u.multiply([],this.transform.labelPlaneMatrix,Xe)}let Be=null;be&&a.latestFeatureIndex&&(Be={unwrappedTileID:U,dynamicFilter:be,dynamicFilterNeedsFeature:ye,featureIndex:a.latestFeatureIndex}),this.retainedQueryData[d.bucketInstanceId]=new Li(d.bucketInstanceId,y,d.sourceLayerIndex,d.index,a.tileID);const He={bucket:d,layout:x,posMatrix:Y,textLabelPlaneMatrix:ke,labelToScreenMatrix:Ae,clippingData:Be,scale:C,textPixelRatio:k,holdingForFade:a.holdingForFade(),collisionBoxArray:E,partiallyEvaluatedTextSize:u.evaluateSizeForZoom(d.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:u.evaluateSizeForZoom(d.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(d.sourceID)};if(f)for(const Xe of d.sortKeyRanges){const{sortKey:Qe,symbolInstanceStart:qt,symbolInstanceEnd:qe}=Xe;r.push({sortKey:Qe,symbolInstanceStart:qt,symbolInstanceEnd:qe,parameters:He})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:d.symbolInstances.length,parameters:He})}attemptAnchorPlacement(r,c,a,f,d,y,x,E,C,k,U,Y,oe,le,he,me,ee,be){const{textOffset0:ye,textOffset1:De,crossTileID:ke}=Y,Ae=[ye,De],Be=Hr(r,a,f,Ae,d),He=this.collisionIndex.placeCollisionBox(le,d,c,Bo(Be.x,Be.y,y,x,this.transform.angle),U,E,C,k.predicate);if(me){const Xe=le.getSymbolInstanceIconSize(be,this.transform.zoom,Y.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(le,Xe,me,Bo(Be.x,Be.y,y,x,this.transform.angle),U,E,C,k.predicate).box.length)return}if(He.box.length>0){let Xe;return this.prevPlacement&&this.prevPlacement.variableOffsets[ke]&&this.prevPlacement.placements[ke]&&this.prevPlacement.placements[ke].text&&(Xe=this.prevPlacement.variableOffsets[ke].anchor),this.variableOffsets[ke]={textOffset:Ae,width:a,height:f,anchor:r,textScale:d,prevAnchor:Xe},this.markUsedJustification(le,r,Y,he),le.allowVerticalPlacement&&(this.markUsedOrientation(le,he,Y),this.placedOrientations[ke]=he),{shift:Be,placedGlyphBoxes:He}}}placeLayerBucketPart(r,c,a,f){const{bucket:d,layout:y,posMatrix:x,textLabelPlaneMatrix:E,labelToScreenMatrix:C,clippingData:k,textPixelRatio:U,holdingForFade:Y,collisionBoxArray:oe,partiallyEvaluatedTextSize:le,partiallyEvaluatedIconSize:he,collisionGroup:me}=r.parameters,ee=y.get("text-optional"),be=y.get("icon-optional"),ye=y.get("text-allow-overlap"),De=y.get("icon-allow-overlap"),ke="map"===y.get("text-rotation-alignment"),Ae="map"===y.get("text-pitch-alignment"),Be="none"!==y.get("icon-text-fit"),He="viewport-y"===y.get("symbol-z-order");this.transform.setProjection(d.projection);let Xe=ye&&(De||!d.hasIconData()||be),Qe=De&&(ye||!d.hasTextData()||ee);!d.collisionArrays&&oe&&d.deserializeCollisionBoxes(oe),a&&f&&d.updateCollisionDebugBuffers(this.transform.zoom,oe);const qt=(qe,Tt,at)=>{const{crossTileID:kt,numVerticalGlyphVertices:Ye}=qe;if(k){const Gi={zoom:this.transform.zoom,pitch:this.transform.pitch};let Mi=null;if(k.dynamicFilterNeedsFeature){const Yr=this.retainedQueryData[d.bucketInstanceId];Mi=k.featureIndex.loadFeature({featureIndex:qe.featureIndex,bucketIndex:Yr.bucketIndex,sourceLayerIndex:Yr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,k.dynamicFilter)(Gi,Mi,this.retainedQueryData[d.bucketInstanceId].tileID.canonical,new u.pointGeometry(qe.tileAnchorX,qe.tileAnchorY),this.transform.calculateDistanceTileData(k.unwrappedTileID)))return this.placements[kt]=new hi(!1,!1,!1,!0),void(c[kt]=!0)}if(c[kt])return;if(Y)return void(this.placements[kt]=new hi(!1,!1,!1));let Ge=!1,it=!1,Ct=!0,Bt=!1,Mn=!1,_r=null,wn={box:null,offscreen:null,occluded:null},pn={box:null,offscreen:null,occluded:null},Rn=null,Ir=null,zn=null,ti=0,pi=0,mi=0;at.textFeatureIndex?ti=at.textFeatureIndex:qe.useRuntimeCollisionCircles&&(ti=qe.featureIndex),at.verticalTextFeatureIndex&&(pi=at.verticalTextFeatureIndex);const Si=Gi=>{Gi.tileID=this.retainedQueryData[d.bucketInstanceId].tileID;const Mi=this.transform.elevation;(Mi||Gi.elevation)&&(Gi.elevation=Mi?Mi.getAtTileOffset(Gi.tileID,Gi.tileAnchorX,Gi.tileAnchorY):0)},Oo=at.textBox;if(Oo){Si(Oo);const Gi=Yr=>{let ho=u.WritingMode.horizontal;if(d.allowVerticalPlacement&&!Yr&&this.prevPlacement){const ps=this.prevPlacement.placedOrientations[kt];ps&&(this.placedOrientations[kt]=ps,ho=ps,this.markUsedOrientation(d,ho,qe))}return ho},Mi=(Yr,ho)=>{if(d.allowVerticalPlacement&&Ye>0&&at.verticalTextBox){for(const ps of d.writingModes)if(ps===u.WritingMode.vertical?(wn=ho(),pn=wn):wn=Yr(),wn&&wn.box&&wn.box.length)break}else wn=Yr()};if(y.get("text-variable-anchor")){let Yr=y.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[kt]){const Ei=this.prevPlacement.variableOffsets[kt];Yr.indexOf(Ei.anchor)>0&&(Yr=Yr.filter(ms=>ms!==Ei.anchor),Yr.unshift(Ei.anchor))}const ho=(Ei,ms,gs)=>{const wl=d.getSymbolInstanceTextSize(le,qe,this.transform.zoom,Tt),qs=(Ei.x2-Ei.x1)*wl+2*Ei.padding,pa=(Ei.y2-Ei.y1)*wl+2*Ei.padding,Ma=Be&&!De?ms:null;Ma&&Si(Ma);let bl={box:[],offscreen:!1,occluded:!1};const El=ye?2*Yr.length:Yr.length;for(let cl=0;cl<El;++cl){const zc=this.attemptAnchorPlacement(Yr[cl%Yr.length],Ei,qs,pa,wl,ke,Ae,U,x,me,cl>=Yr.length,qe,Tt,d,gs,Ma,le,he);if(zc&&(bl=zc.placedGlyphBoxes,bl&&bl.box&&bl.box.length)){Ge=!0,_r=zc.shift;break}}return bl};Mi(()=>ho(Oo,at.iconBox,u.WritingMode.horizontal),()=>{const Ei=at.verticalTextBox;return Ei&&Si(Ei),d.allowVerticalPlacement&&!(wn&&wn.box&&wn.box.length)&&Ye>0&&Ei?ho(Ei,at.verticalIconBox,u.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),wn&&(Ge=wn.box,Ct=wn.offscreen,Bt=wn.occluded);const ps=Gi(wn&&wn.box);if(!Ge&&this.prevPlacement){const Ei=this.prevPlacement.variableOffsets[kt];Ei&&(this.variableOffsets[kt]=Ei,this.markUsedJustification(d,Ei.anchor,qe,ps))}}else{const Yr=(ho,ps)=>{const Ei=d.getSymbolInstanceTextSize(le,qe,this.transform.zoom,Tt),ms=this.collisionIndex.placeCollisionBox(d,Ei,ho,new u.pointGeometry(0,0),ye,U,x,me.predicate);return ms&&ms.box&&ms.box.length&&(this.markUsedOrientation(d,ps,qe),this.placedOrientations[kt]=ps),ms};Mi(()=>Yr(Oo,u.WritingMode.horizontal),()=>{const ho=at.verticalTextBox;return d.allowVerticalPlacement&&Ye>0&&ho?(Si(ho),Yr(ho,u.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Gi(wn&&wn.box&&wn.box.length)}}if(Rn=wn,Ge=Rn&&Rn.box&&Rn.box.length>0,Ct=Rn&&Rn.offscreen,Bt=Rn&&Rn.occluded,qe.useRuntimeCollisionCircles){const Gi=d.text.placedSymbolArray.get(qe.centerJustifiedTextSymbolIndex>=0?qe.centerJustifiedTextSymbolIndex:qe.verticalPlacedTextSymbolIndex),Mi=u.evaluateSizeForFeature(d.textSizeData,le,Gi),Yr=y.get("text-padding");Ir=this.collisionIndex.placeCollisionCircles(d,ye,Gi,d.lineVertexArray,d.glyphOffsetArray,Mi,x,E,C,a,Ae,me.predicate,qe.collisionCircleDiameter*Mi/u.ONE_EM,Yr,this.retainedQueryData[d.bucketInstanceId].tileID),Ge=ye||Ir.circles.length>0&&!Ir.collisionDetected,Ct=Ct&&Ir.offscreen,Bt=Ir.occluded}if(at.iconFeatureIndex&&(mi=at.iconFeatureIndex),at.iconBox){const Gi=Mi=>{Si(Mi);const Yr=Be&&_r?Bo(_r.x,_r.y,ke,Ae,this.transform.angle):new u.pointGeometry(0,0),ho=d.getSymbolInstanceIconSize(he,this.transform.zoom,qe.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(d,ho,Mi,Yr,De,U,x,me.predicate)};pn&&pn.box&&pn.box.length&&at.verticalIconBox?(zn=Gi(at.verticalIconBox),it=zn.box.length>0):(zn=Gi(at.iconBox),it=zn.box.length>0),Ct=Ct&&zn.offscreen,Mn=zn.occluded}const ks=ee||0===qe.numHorizontalGlyphVertices&&0===Ye,ll=be||0===qe.numIconVertices;if(ks||ll?ll?ks||(it=it&&Ge):Ge=it&&Ge:it=Ge=it&&Ge,Ge&&Rn&&Rn.box&&this.collisionIndex.insertCollisionBox(Rn.box,y.get("text-ignore-placement"),d.bucketInstanceId,pn&&pn.box&&pi?pi:ti,me.ID),it&&zn&&this.collisionIndex.insertCollisionBox(zn.box,y.get("icon-ignore-placement"),d.bucketInstanceId,mi,me.ID),Ir&&(Ge&&this.collisionIndex.insertCollisionCircles(Ir.circles,y.get("text-ignore-placement"),d.bucketInstanceId,ti,me.ID),a)){const Gi=d.bucketInstanceId;let Mi=this.collisionCircleArrays[Gi];void 0===Mi&&(Mi=this.collisionCircleArrays[Gi]=new lo);for(let Yr=0;Yr<Ir.circles.length;Yr+=4)Mi.circles.push(Ir.circles[Yr+0]),Mi.circles.push(Ir.circles[Yr+1]),Mi.circles.push(Ir.circles[Yr+2]),Mi.circles.push(Ir.collisionDetected?1:0)}const jl="globe"!==d.projection.name;Xe=Xe&&(jl||!Bt),Qe=Qe&&(jl||!Mn),this.placements[kt]=new hi(Ge||Xe,it||Qe,Ct||d.justReloaded),c[kt]=!0};if(He){const qe=d.getSortedSymbolIndexes(this.transform.angle);for(let Tt=qe.length-1;Tt>=0;--Tt){const at=qe[Tt];qt(d.symbolInstances.get(at),at,d.collisionArrays[at])}}else for(let qe=r.symbolInstanceStart;qe<r.symbolInstanceEnd;qe++)qt(d.symbolInstances.get(qe),qe,d.collisionArrays[qe]);if(a&&d.bucketInstanceId in this.collisionCircleArrays){const qe=this.collisionCircleArrays[d.bucketInstanceId];u.invert(qe.invProjMatrix,x),qe.viewportMatrix=this.collisionIndex.getViewportMatrix()}d.justReloaded=!1}markUsedJustification(r,c,a,f){const{leftJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:y,rightJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:E,crossTileID:C}=a,k=u.getAnchorJustification(c),U=f===u.WritingMode.vertical?E:"left"===k?d:"center"===k?y:"right"===k?x:-1;d>=0&&(r.text.placedSymbolArray.get(d).crossTileID=U>=0&&d!==U?0:C),y>=0&&(r.text.placedSymbolArray.get(y).crossTileID=U>=0&&y!==U?0:C),x>=0&&(r.text.placedSymbolArray.get(x).crossTileID=U>=0&&x!==U?0:C),E>=0&&(r.text.placedSymbolArray.get(E).crossTileID=U>=0&&E!==U?0:C)}markUsedOrientation(r,c,a){const f=c===u.WritingMode.horizontal||c===u.WritingMode.horizontalOnly?c:0,d=c===u.WritingMode.vertical?c:0,{leftJustifiedTextSymbolIndex:y,centerJustifiedTextSymbolIndex:x,rightJustifiedTextSymbolIndex:E,verticalPlacedTextSymbolIndex:C}=a,k=r.text.placedSymbolArray;y>=0&&(k.get(y).placedOrientation=f),x>=0&&(k.get(x).placedOrientation=f),E>=0&&(k.get(E).placedOrientation=f),C>=0&&(k.get(C).placedOrientation=d)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let a=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const f=c?c.symbolFadeChange(r):1,d=c?c.opacities:{},y=c?c.variableOffsets:{},x=c?c.placedOrientations:{};for(const E in this.placements){const C=this.placements[E],k=d[E];k?(this.opacities[E]=new ao(k,f,C.text,C.icon,null,C.clipped),a=a||C.text!==k.text.placed||C.icon!==k.icon.placed):(this.opacities[E]=new ao(null,f,C.text,C.icon,C.skipFade,C.clipped),a=a||C.text||C.icon)}for(const E in d){const C=d[E];if(!this.opacities[E]){const k=new ao(C,f,!1,!1);k.isHidden()||(this.opacities[E]=k,a=a||C.text.placed||C.icon.placed)}}for(const E in y)this.variableOffsets[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.variableOffsets[E]=y[E]);for(const E in x)this.placedOrientations[E]||!this.opacities[E]||this.opacities[E].isHidden()||(this.placedOrientations[E]=x[E]);a?this.lastPlacementChangeTime=r:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:r)}updateLayerOpacities(r,c){const a={};for(const f of c){const d=f.getBucket(r);d&&f.latestFeatureIndex&&r.id===d.layerIds[0]&&this.updateBucketOpacities(d,a,f.collisionBoxArray)}}updateBucketOpacities(r,c,a){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const f=r.layers[0].layout,d=!!r.layers[0].dynamicFilter(),y=new ao(null,0,!1,!1,!0),x=f.get("text-allow-overlap"),E=f.get("icon-allow-overlap"),C=f.get("text-variable-anchor"),k="map"===f.get("text-rotation-alignment"),U="map"===f.get("text-pitch-alignment"),Y="none"!==f.get("icon-text-fit"),oe=new ao(null,0,x&&(E||!r.hasIconData()||f.get("icon-optional")),E&&(x||!r.hasTextData()||f.get("text-optional")),!0);!r.collisionArrays&&a&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(a);const le=(me,ee,be)=>{for(let ye=0;ye<ee/4;ye++)me.opacityVertexArray.emplaceBack(be)};let he=0;for(let me=0;me<r.symbolInstances.length;me++){const ee=r.symbolInstances.get(me),{numHorizontalGlyphVertices:be,numVerticalGlyphVertices:ye,crossTileID:De,numIconVertices:ke}=ee;let Ae=this.opacities[De];c[De]?Ae=y:Ae||(Ae=oe,this.opacities[De]=Ae),c[De]=!0;const Be=be>0||ye>0,He=ke>0,Xe=this.placedOrientations[De],Qe=Xe===u.WritingMode.vertical,qt=Xe===u.WritingMode.horizontal||Xe===u.WritingMode.horizontalOnly;if(!Be&&!He||Ae.isHidden()||he++,Be){const qe=ra(Ae.text);le(r.text,be,Qe?Wo:qe),le(r.text,ye,qt?Wo:qe);const Tt=Ae.text.isHidden(),{leftJustifiedTextSymbolIndex:at,centerJustifiedTextSymbolIndex:kt,rightJustifiedTextSymbolIndex:Ye,verticalPlacedTextSymbolIndex:Ge}=ee,it=r.text.placedSymbolArray,Ct=Tt||Qe?1:0;at>=0&&(it.get(at).hidden=Ct),kt>=0&&(it.get(kt).hidden=Ct),Ye>=0&&(it.get(Ye).hidden=Ct),Ge>=0&&(it.get(Ge).hidden=Tt||qt?1:0);const Bt=this.variableOffsets[De];Bt&&this.markUsedJustification(r,Bt.anchor,ee,Xe);const Mn=this.placedOrientations[De];Mn&&(this.markUsedJustification(r,"left",ee,Mn),this.markUsedOrientation(r,Mn,ee))}if(He){const qe=ra(Ae.icon),{placedIconSymbolIndex:Tt,verticalPlacedIconSymbolIndex:at}=ee,kt=r.icon.placedSymbolArray,Ye=Ae.icon.isHidden()?1:0;Tt>=0&&(le(r.icon,ke,Qe?Wo:qe),kt.get(Tt).hidden=Ye),at>=0&&(le(r.icon,ee.numVerticalIconVertices,qt?Wo:qe),kt.get(at).hidden=Ye)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const qe=r.collisionArrays[me];if(qe){let Tt=new u.pointGeometry(0,0),at=!0;if(qe.textBox||qe.verticalTextBox){if(C){const Ye=this.variableOffsets[De];Ye?(Tt=Hr(Ye.anchor,Ye.width,Ye.height,Ye.textOffset,Ye.textScale),k&&Tt._rotate(U?this.transform.angle:-this.transform.angle)):at=!1}d&&(at=!Ae.clipped),qe.textBox&&co(r.textCollisionBox.collisionVertexArray,Ae.text.placed,!at||Qe,Tt.x,Tt.y),qe.verticalTextBox&&co(r.textCollisionBox.collisionVertexArray,Ae.text.placed,!at||qt,Tt.x,Tt.y)}const kt=at&&Boolean(!qt&&qe.verticalIconBox);qe.iconBox&&co(r.iconCollisionBox.collisionVertexArray,Ae.icon.placed,kt,Y?Tt.x:0,Y?Tt.y:0),qe.verticalIconBox&&co(r.iconCollisionBox.collisionVertexArray,Ae.icon.placed,!kt,Y?Tt.x:0,Y?Tt.y:0)}}}if(r.fullyClipped=0===he,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const me=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=me.invProjMatrix,r.placementViewportMatrix=me.viewportMatrix,r.collisionCircleArray=me.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return 0===this.fadeDuration?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,c){const a=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*a>r}setStale(){this.stale=!0}}function co(p,r,c,a,f){p.emplaceBack(r?1:0,c?1:0,a||0,f||0),p.emplaceBack(r?1:0,c?1:0,a||0,f||0),p.emplaceBack(r?1:0,c?1:0,a||0,f||0),p.emplaceBack(r?1:0,c?1:0,a||0,f||0)}const Ns=Math.pow(2,25),Ys=Math.pow(2,24),ii=Math.pow(2,17),Ni=Math.pow(2,16),xa=Math.pow(2,9),Ui=Math.pow(2,8),Wr=Math.pow(2,1);function ra(p){if(0===p.opacity&&!p.placed)return 0;if(1===p.opacity&&p.placed)return 4294967295;const r=p.placed?1:0,c=Math.floor(127*p.opacity);return c*Ns+r*Ys+c*ii+r*Ni+c*xa+r*Ui+c*Wr+r}const Wo=0;class Io{constructor(r){this._sortAcrossTiles="viewport-y"!==r.layout.get("symbol-z-order")&&void 0!==r.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(r,c,a,f,d){const y=this._bucketParts;for(;this._currentTileIndex<r.length;)if(c.getBucketParts(y,f,r[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,d())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,y.sort((x,E)=>x.sortKey-E.sortKey));this._currentPartIndex<y.length;){const x=y[this._currentPartIndex];if(c.placeLayerBucketPart(x,this._seenCrossTileIDs,a,0===x.symbolInstanceStart),this._currentPartIndex++,d())return!0}return!1}}class eo{constructor(r,c,a,f,d,y,x,E){this.placement=new Wi(r,d,y,x,E),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=a,this._showCollisionBoxes=f,this._done=!1}isDone(){return this._done}continuePlacement(r,c,a){const f=u.exported.now(),d=()=>{const y=u.exported.now()-f;return!this._forceFullPlacement&&y>2};for(;this._currentPlacementIndex>=0;){const y=c[r[this._currentPlacementIndex]],x=this.placement.collisionIndex.transform.zoom;if("symbol"===y.type&&(!y.minzoom||y.minzoom<=x)&&(!y.maxzoom||y.maxzoom>x)){if(this._inProgressLayer||(this._inProgressLayer=new Io(y)),this._inProgressLayer.continuePlacement(a[y.source],this.placement,this._showCollisionBoxes,y,d))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const Js=512/u.EXTENT/2;class wa{constructor(r,c,a){this.tileID=r,this.indexedSymbolInstances={},this.bucketInstanceId=a;for(let f=0;f<c.length;f++){const d=c.get(f),y=d.key;this.indexedSymbolInstances[y]||(this.indexedSymbolInstances[y]=[]),this.indexedSymbolInstances[y].push({crossTileID:d.crossTileID,coord:this.getScaledCoordinates(d,r)})}}getScaledCoordinates(r,c){const a=Js/Math.pow(2,c.canonical.z-this.tileID.canonical.z);return{x:Math.floor((c.canonical.x*u.EXTENT+r.tileAnchorX)*a),y:Math.floor((c.canonical.y*u.EXTENT+r.tileAnchorY)*a)}}findMatches(r,c,a){const f=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let d=0;d<r.length;d++){const y=r.get(d);if(y.crossTileID)continue;const x=this.indexedSymbolInstances[y.key];if(!x)continue;const E=this.getScaledCoordinates(y,c);for(const C of x)if(Math.abs(C.coord.x-E.x)<=f&&Math.abs(C.coord.y-E.y)<=f&&!a[C.crossTileID]){a[C.crossTileID]=!0,y.crossTileID=C.crossTileID;break}}}}class No{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class wo{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const c=Math.round((r-this.lng)/360);if(0!==c)for(const a in this.indexes){const f=this.indexes[a],d={};for(const y in f){const x=f[y];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+c),d[x.tileID.key]=x}this.indexes[a]=d}this.lng=r}addBucket(r,c,a){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let d=0;d<c.symbolInstances.length;d++)c.symbolInstances.get(d).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]={});const f=this.usedCrossTileIDs[r.overscaledZ];for(const d in this.indexes){const y=this.indexes[d];if(Number(d)>r.overscaledZ)for(const x in y){const E=y[x];E.tileID.isChildOf(r)&&E.findMatches(c.symbolInstances,r,f)}else{const x=y[r.scaledTo(Number(d)).key];x&&x.findMatches(c.symbolInstances,r,f)}}for(let d=0;d<c.symbolInstances.length;d++){const y=c.symbolInstances.get(d);y.crossTileID||(y.crossTileID=a.generate(),f[y.crossTileID]=!0)}return void 0===this.indexes[r.overscaledZ]&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new wa(r,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(r,c){for(const a in c.indexedSymbolInstances)for(const f of c.indexedSymbolInstances[a])delete this.usedCrossTileIDs[r][f.crossTileID]}removeStaleBuckets(r){let c=!1;for(const a in this.indexes){const f=this.indexes[a];for(const d in f)r[f[d].bucketInstanceId]||(this.removeBucketCrossTileIDs(a,f[d]),delete f[d],c=!0)}return c}}class Ja{constructor(){this.layerIndexes={},this.crossTileIDs=new No,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,c,a,f){let d=this.layerIndexes[r.id];void 0===d&&(d=this.layerIndexes[r.id]=new wo);let y=!1;const x={};"globe"!==f.name&&d.handleWrapJump(a);for(const E of c){const C=E.getBucket(r);C&&r.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),d.addBucket(E.tileID,C,this.crossTileIDs)&&(y=!0),x[C.bucketInstanceId]=!0)}return d.removeStaleBuckets(x)&&(y=!0),y}pruneUnusedLayers(r){const c={};r.forEach(a=>{c[a]=!0});for(const a in this.layerIndexes)c[a]||delete this.layerIndexes[a]}}const Us=(p,r)=>u.emitValidationErrors(p,r&&r.filter(c=>"source.canvas"!==c.identifier)),Ts=u.pick(Sn,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),to=u.pick(Sn,["setCenter","setZoom","setBearing","setPitch"]),ia={version:8,layers:[],sources:{}},js={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class uo extends u.Evented{constructor(r,c={}){super(),this.map=r,this.dispatcher=new Ht(xn(),this),this.imageManager=new ln,this.imageManager.setEventedParent(this),this.glyphManager=new u.GlyphManager(r._requestManager,c.localFontFamily?u.LocalGlyphMode.all:c.localIdeographFontFamily?u.LocalGlyphMode.ideographs:u.LocalGlyphMode.none,c.localFontFamily||c.localIdeographFontFamily),this.crossTileSymbolIndex=new Ja,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",u.getReferrer());const a=this;this._rtlTextPluginCallback=uo.registerForPluginStateChange(f=>{a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:f.pluginStatus,pluginURL:f.pluginURL},(d,y)=>{if(u.triggerPluginCompletionEvent(d),y&&y.every(x=>x))for(const x in a._sourceCaches){const E=a._sourceCaches[x],C=E.getSource().type;"vector"!==C&&"geojson"!==C||E.reload()}})}),this.on("data",f=>{if("source"!==f.dataType||"metadata"!==f.sourceDataType)return;const d=this.getSource(f.sourceId);if(d&&d.vectorLayerIds)for(const y in this._layers){const x=this._layers[y];x.source===d.id&&this._validateLayer(x)}})}loadURL(r,c={}){this.fire(new u.Event("dataloading",{dataType:"style"}));const a="boolean"==typeof c.validate?c.validate:!u.isMapboxURL(r);r=this.map._requestManager.normalizeStyleURL(r,c.accessToken);const f=this.map._requestManager.transformRequest(r,u.ResourceType.Style);this._request=u.getJSON(f,(d,y)=>{this._request=null,d?this.fire(new u.ErrorEvent(d)):y&&this._load(y,a)})}loadJSON(r,c={}){this.fire(new u.Event("dataloading",{dataType:"style"})),this._request=u.exported.frame(()=>{this._request=null,this._load(r,!1!==c.validate)})}loadEmpty(){this.fire(new u.Event("dataloading",{dataType:"style"})),this._load(ia,!1)}_updateLayerCount(r,c){const a=c?1:-1;r.is3D()&&(this._num3DLayers+=a),"circle"===r.type&&(this._numCircleLayers+=a),"symbol"===r.type&&(this._numSymbolLayers+=a)}_load(r,c){if(c&&Us(this,u.validateStyle(r)))return;this._loaded=!0,this.stylesheet=u.clone$1(r),this._updateMapProjection();for(const f in r.sources)this.addSource(f,r.sources[f],{validate:!1});this._changed=!1,r.sprite?this._loadSprite(r.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(r.glyphs);const a=xr(this.stylesheet.layers);this._order=a.map(f=>f.id),this._layers={},this._serializedLayers={};for(let f of a)f=u.createStyleLayer(f),f.setEventedParent(this,{layer:{id:f.id}}),this._layers[f.id]=f,this._serializedLayers[f.id]=f.serialize(),this._updateLayerCount(f,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Xt(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new u.Event("data",{dataType:"style"})),this.fire(new u.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_updateMapProjection(){this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.stylesheet.projection)}_loadSprite(r){this._spriteRequest=function(c,a,f){let d,y,x;const E=u.exported.devicePixelRatio>1?"@2x":"";let C=u.getJSON(a.transformRequest(a.normalizeSpriteURL(c,E,".json"),u.ResourceType.SpriteJSON),(Y,oe)=>{C=null,x||(x=Y,d=oe,U())}),k=u.getImage(a.transformRequest(a.normalizeSpriteURL(c,E,".png"),u.ResourceType.SpriteImage),(Y,oe)=>{k=null,x||(x=Y,y=oe,U())});function U(){if(x)f(x);else if(d&&y){const Y=u.exported.getImageData(y),oe={};for(const le in d){const{width:he,height:me,x:ee,y:be,sdf:ye,pixelRatio:De,stretchX:ke,stretchY:Ae,content:Be}=d[le],He=new u.RGBAImage({width:he,height:me});u.RGBAImage.copy(Y,He,{x:ee,y:be},{x:0,y:0},{width:he,height:me}),oe[le]={data:He,pixelRatio:De,sdf:ye,stretchX:ke,stretchY:Ae,content:Be}}f(null,oe)}}return{cancel(){C&&(C.cancel(),C=null),k&&(k.cancel(),k=null)}}}(r,this.map._requestManager,(c,a)=>{if(this._spriteRequest=null,c)this.fire(new u.ErrorEvent(c));else if(a)for(const f in a)this.imageManager.addImage(f,a[f]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new u.Event("data",{dataType:"style"}))})}_validateLayer(r){const c=this.getSource(r.source);if(!c)return;const a=r.sourceLayer;a&&("geojson"===c.type||c.vectorLayerIds&&-1===c.vectorLayerIds.indexOf(a))&&this.fire(new u.ErrorEvent(new Error(`Source layer "${a}" does not exist on source "${c.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(r){const c=[];for(const a of r){const f=this._layers[a];"custom"!==f.type&&c.push(f.serialize())}return c}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(r){return!!this.terrain&&("function"==typeof r.isLayerDraped?r.isLayerDraped():js[r.type])}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(r){if(!this._loaded)return;const c=this._changed;if(this._changed){const f=Object.keys(this._updatedLayers),d=Object.keys(this._removedLayers);(f.length||d.length)&&this._updateWorkerLayers(f,d);for(const y in this._updatedSources){const x=this._updatedSources[y];"reload"===x?this._reloadSource(y):"clear"===x&&this._clearSource(y)}this._updateTilesForChangedImages();for(const y in this._updatedPaintProps)this._layers[y].updateTransitions(r);this.light.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this._resetUpdates()}const a={};for(const f in this._sourceCaches){const d=this._sourceCaches[f];a[f]=d.used,d.used=!1}for(const f of this._order){const d=this._layers[f];if(d.recalculate(r,this._availableImages),!d.isHidden(r.zoom)){const x=this._getLayerSourceCache(d);x&&(x.used=!0)}const y=this.map.painter;if(y){const x=d.getProgramIds();if(!x)continue;const E=d.getProgramConfiguration(r.zoom);for(const C of x)y.useProgram(C,E)}}for(const f in a){const d=this._sourceCaches[f];a[f]!==d.used&&d.getSource().fire(new u.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:d.getSource().id}))}this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),c&&this.fire(new u.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const r=Object.keys(this._changedImages);if(r.length){for(const c in this._sourceCaches)this._sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],r);this._changedImages={}}}_updateWorkerLayers(r,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(r),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(r){if(this._checkLoaded(),Us(this,u.validateStyle(r)))return!1;(r=u.clone$1(r)).layers=xr(r.layers);const c=function(f,d){if(!f)return[{command:Sn.setStyle,args:[d]}];let y=[];try{if(!Ie(f.version,d.version))return[{command:Sn.setStyle,args:[d]}];Ie(f.center,d.center)||y.push({command:Sn.setCenter,args:[d.center]}),Ie(f.zoom,d.zoom)||y.push({command:Sn.setZoom,args:[d.zoom]}),Ie(f.bearing,d.bearing)||y.push({command:Sn.setBearing,args:[d.bearing]}),Ie(f.pitch,d.pitch)||y.push({command:Sn.setPitch,args:[d.pitch]}),Ie(f.sprite,d.sprite)||y.push({command:Sn.setSprite,args:[d.sprite]}),Ie(f.glyphs,d.glyphs)||y.push({command:Sn.setGlyphs,args:[d.glyphs]}),Ie(f.transition,d.transition)||y.push({command:Sn.setTransition,args:[d.transition]}),Ie(f.light,d.light)||y.push({command:Sn.setLight,args:[d.light]}),Ie(f.fog,d.fog)||y.push({command:Sn.setFog,args:[d.fog]}),Ie(f.projection,d.projection)||y.push({command:Sn.setProjection,args:[d.projection]});const x={},E=[];!function(U,Y,oe,le){let he;for(he in Y=Y||{},U=U||{})U.hasOwnProperty(he)&&(Y.hasOwnProperty(he)||Or(he,oe,le));for(he in Y)Y.hasOwnProperty(he)&&(U.hasOwnProperty(he)?Ie(U[he],Y[he])||("geojson"===U[he].type&&"geojson"===Y[he].type&&Hi(U,Y,he)?oe.push({command:Sn.setGeoJSONSourceData,args:[he,Y[he].data]}):Ji(he,Y,oe,le)):Pr(he,Y,oe))}(f.sources,d.sources,E,x);const C=[];f.layers&&f.layers.forEach(U=>{U.source&&x[U.source]?y.push({command:Sn.removeLayer,args:[U.id]}):C.push(U)});let k=f.terrain;k&&x[k.source]&&(y.push({command:Sn.setTerrain,args:[void 0]}),k=void 0),y=y.concat(E),Ie(k,d.terrain)||y.push({command:Sn.setTerrain,args:[d.terrain]}),function(U,Y,oe){Y=Y||[];const le=(U=U||[]).map($r),he=Y.map($r),me=U.reduce(qn,{}),ee=Y.reduce(qn,{}),be=le.slice(),ye=Object.create(null);let De,ke,Ae,Be,He,Xe,Qe;for(De=0,ke=0;De<le.length;De++)Ae=le[De],ee.hasOwnProperty(Ae)?ke++:(oe.push({command:Sn.removeLayer,args:[Ae]}),be.splice(be.indexOf(Ae,ke),1));for(De=0,ke=0;De<he.length;De++)Ae=he[he.length-1-De],be[be.length-1-De]!==Ae&&(me.hasOwnProperty(Ae)?(oe.push({command:Sn.removeLayer,args:[Ae]}),be.splice(be.lastIndexOf(Ae,be.length-ke),1)):ke++,Xe=be[be.length-De],oe.push({command:Sn.addLayer,args:[ee[Ae],Xe]}),be.splice(be.length-De,0,Ae),ye[Ae]=!0);for(De=0;De<he.length;De++)if(Ae=he[De],Be=me[Ae],He=ee[Ae],!ye[Ae]&&!Ie(Be,He))if(Ie(Be.source,He.source)&&Ie(Be["source-layer"],He["source-layer"])&&Ie(Be.type,He.type)){for(Qe in ct(Be.layout,He.layout,oe,Ae,null,Sn.setLayoutProperty),ct(Be.paint,He.paint,oe,Ae,null,Sn.setPaintProperty),Ie(Be.filter,He.filter)||oe.push({command:Sn.setFilter,args:[Ae,He.filter]}),Ie(Be.minzoom,He.minzoom)&&Ie(Be.maxzoom,He.maxzoom)||oe.push({command:Sn.setLayerZoomRange,args:[Ae,He.minzoom,He.maxzoom]}),Be)Be.hasOwnProperty(Qe)&&"layout"!==Qe&&"paint"!==Qe&&"filter"!==Qe&&"metadata"!==Qe&&"minzoom"!==Qe&&"maxzoom"!==Qe&&(0===Qe.indexOf("paint.")?ct(Be[Qe],He[Qe],oe,Ae,Qe.slice(6),Sn.setPaintProperty):Ie(Be[Qe],He[Qe])||oe.push({command:Sn.setLayerProperty,args:[Ae,Qe,He[Qe]]}));for(Qe in He)He.hasOwnProperty(Qe)&&!Be.hasOwnProperty(Qe)&&"layout"!==Qe&&"paint"!==Qe&&"filter"!==Qe&&"metadata"!==Qe&&"minzoom"!==Qe&&"maxzoom"!==Qe&&(0===Qe.indexOf("paint.")?ct(Be[Qe],He[Qe],oe,Ae,Qe.slice(6),Sn.setPaintProperty):Ie(Be[Qe],He[Qe])||oe.push({command:Sn.setLayerProperty,args:[Ae,Qe,He[Qe]]}))}else oe.push({command:Sn.removeLayer,args:[Ae]}),Xe=be[be.lastIndexOf(Ae)+1],oe.push({command:Sn.addLayer,args:[He,Xe]})}(C,d.layers,y)}catch(x){console.warn("Unable to compute style diff:",x),y=[{command:Sn.setStyle,args:[d]}]}return y}(this.serialize(),r).filter(f=>!(f.command in to));if(0===c.length)return!1;const a=c.filter(f=>!(f.command in Ts));if(a.length>0)throw new Error(`Unimplemented: ${a.map(f=>f.command).join(", ")}.`);return c.forEach(f=>{"setTransition"!==f.command&&"setProjection"!==f.command&&this[f.command].apply(this,f.args)}),this.stylesheet=r,this._updateMapProjection(),!0}addImage(r,c){return this.getImage(r)?this.fire(new u.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(r,c),this._afterImageUpdated(r),this)}updateImage(r,c){this.imageManager.updateImage(r,c)}getImage(r){return this.imageManager.getImage(r)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r),this._afterImageUpdated(r),this):this.fire(new u.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(r){this._availableImages=this.imageManager.listImages(),this._changedImages[r]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(r,c,a={}){if(this._checkLoaded(),void 0!==this.getSource(r))throw new Error("There is already a source with this ID");if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(u.validateSource,`sources.${r}`,c,null,a))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const f=q(r,c,this.dispatcher,this);f.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(r),source:f.serialize(),sourceId:r}));const d=y=>{const x=(y?"symbol:":"other:")+r,E=this._sourceCaches[x]=new u.SourceCache(x,f,y);(y?this._symbolSourceCaches:this._otherSourceCaches)[r]=E,E.style=this,E.onAdd(this.map)};d(!1),"vector"!==c.type&&"geojson"!==c.type||d(!0),f.onAdd&&f.onAdd(this.map),this._changed=!0}removeSource(r){this._checkLoaded();const c=this.getSource(r);if(!c)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===r)return this.fire(new u.ErrorEvent(new Error(`Source "${r}" cannot be removed while layer "${f}" is using it.`)));if(this.terrain&&this.terrain.get().source===r)return this.fire(new u.ErrorEvent(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));const a=this._getSourceCaches(r);for(const f of a)delete this._sourceCaches[f.id],delete this._updatedSources[f.id],f.fire(new u.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:f.getSource().id})),f.setEventedParent(null),f.clearTiles();return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(r,c){this._checkLoaded(),this.getSource(r).setData(c),this._changed=!0}getSource(r){const c=this._getSourceCache(r);return c&&c.getSource()}_getSources(){const r=[];for(const c in this._otherSourceCaches){const a=this._getSourceCache(c);a&&r.push(a.getSource())}return r}addLayer(r,c,a={}){this._checkLoaded();const f=r.id;if(this.getLayer(f))return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${f}" already exists on this map`)));let d;if("custom"===r.type){if(Us(this,u.validateCustomStyleLayer(r)))return;d=u.createStyleLayer(r)}else{if("object"==typeof r.source&&(this.addSource(f,r.source),r=u.clone$1(r),r=u.extend(r,{source:f})),this._validate(u.validateLayer,`layers.${f}`,r,{arrayIndex:-1},a))return;d=u.createStyleLayer(r),this._validateLayer(d),d.setEventedParent(this,{layer:{id:f}}),this._serializedLayers[d.id]=d.serialize(),this._updateLayerCount(d,!0)}const y=c?this._order.indexOf(c):this._order.length;if(c&&-1===y)return void this.fire(new u.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`)));this._order.splice(y,0,f),this._layerOrderChanged=!0,this._layers[f]=d;const x=this._getLayerSourceCache(d);if(this._removedLayers[f]&&d.source&&x&&"custom"!==d.type){const E=this._removedLayers[f];delete this._removedLayers[f],E.type!==d.type?this._updatedSources[d.source]="clear":(this._updatedSources[d.source]="reload",x.pause())}this._updateLayer(d),d.onAdd&&d.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(r,c){if(this._checkLoaded(),this._changed=!0,!this._layers[r])return void this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be moved.`)));if(r===c)return;const a=this._order.indexOf(r);this._order.splice(a,1);const f=c?this._order.indexOf(c):this._order.length;c&&-1===f?this.fire(new u.ErrorEvent(new Error(`Layer with id "${c}" does not exist on this map.`))):(this._order.splice(f,0,r),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(r){this._checkLoaded();const c=this._layers[r];if(!c)return void this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be removed.`)));c.setEventedParent(null),this._updateLayerCount(c,!1);const a=this._order.indexOf(r);this._order.splice(a,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[r]=c,delete this._layers[r],delete this._serializedLayers[r],delete this._updatedLayers[r],delete this._updatedPaintProps[r],c.onRemove&&c.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(r){return this._layers[r]}hasLayer(r){return r in this._layers}hasLayerType(r){for(const c in this._layers)if(this._layers[c].type===r)return!0;return!1}setLayerZoomRange(r,c,a){this._checkLoaded();const f=this.getLayer(r);f?f.minzoom===c&&f.maxzoom===a||(null!=c&&(f.minzoom=c),null!=a&&(f.maxzoom=a),this._updateLayer(f)):this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(r,c,a={}){this._checkLoaded();const f=this.getLayer(r);if(f){if(!Ie(f.filter,c))return null==c?(f.filter=void 0,void this._updateLayer(f)):void(this._validate(u.validateFilter,`layers.${f.id}.filter`,c,{layerType:f.type},a)||(f.filter=u.clone$1(c),this._updateLayer(f)))}else this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be filtered.`)))}getFilter(r){const c=this.getLayer(r);return c&&u.clone$1(c.filter)}setLayoutProperty(r,c,a,f={}){this._checkLoaded();const d=this.getLayer(r);d?Ie(d.getLayoutProperty(c),a)||(d.setLayoutProperty(c,a,f),this._updateLayer(d)):this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(r,c){const a=this.getLayer(r);if(a)return a.getLayoutProperty(c);this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style.`)))}setPaintProperty(r,c,a,f={}){this._checkLoaded();const d=this.getLayer(r);d?Ie(d.getPaintProperty(c),a)||(d.setPaintProperty(c,a,f)&&this._updateLayer(d),this._changed=!0,this._updatedPaintProps[r]=!0):this.fire(new u.ErrorEvent(new Error(`The layer '${r}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(r,c){const a=this.getLayer(r);return a&&a.getPaintProperty(c)}setFeatureState(r,c){this._checkLoaded();const a=r.source,f=r.sourceLayer,d=this.getSource(a);if(!d)return void this.fire(new u.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)));const y=d.type;if("geojson"===y&&f)return void this.fire(new u.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===y&&!f)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===r.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided.")));const x=this._getSourceCaches(a);for(const E of x)E.setFeatureState(f,r.id,c)}removeFeatureState(r,c){this._checkLoaded();const a=r.source,f=this.getSource(a);if(!f)return void this.fire(new u.ErrorEvent(new Error(`The source '${a}' does not exist in the map's style.`)));const d=f.type,y="vector"===d?r.sourceLayer:void 0;if("vector"===d&&!y)return void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&"string"!=typeof r.id&&"number"!=typeof r.id)return void this.fire(new u.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const x=this._getSourceCaches(a);for(const E of x)E.removeFeatureState(y,r.id,c)}getFeatureState(r){this._checkLoaded();const c=r.source,a=r.sourceLayer,f=this.getSource(c);if(f){if("vector"!==f.type||a)return void 0===r.id&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(c)[0].getFeatureState(a,r.id);this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new u.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return u.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const r={};for(const c in this._sourceCaches){const a=this._sourceCaches[c].getSource();r[a.id]||(r[a.id]=a.serialize())}return u.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.getTerrain()||void 0,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:r,layers:this._serializeLayers(this._order)},c=>void 0!==c)}_updateLayer(r){this._updatedLayers[r.id]=!0;const c=this._getLayerSourceCache(r);r.source&&!this._updatedSources[r.source]&&c&&"raster"!==c.getSource().type&&(this._updatedSources[r.source]="reload",c.pause()),this._changed=!0,r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const c=y=>"fill-extrusion"===this._layers[y].type,a={},f=[];for(let y=this._order.length-1;y>=0;y--){const x=this._order[y];if(c(x)){a[x]=y;for(const E of r){const C=E[x];if(C)for(const k of C)f.push(k)}}}f.sort((y,x)=>x.intersectionZ-y.intersectionZ);const d=[];for(let y=this._order.length-1;y>=0;y--){const x=this._order[y];if(c(x))for(let E=f.length-1;E>=0;E--){const C=f[E].feature;if(a[C.layer.id]<y)break;d.push(C),f.pop()}else for(const E of r){const C=E[x];if(C)for(const k of C)d.push(k.feature)}}return d}queryRenderedFeatures(r,c,a){c&&c.filter&&this._validate(u.validateFilter,"queryRenderedFeatures.filter",c.filter,null,c);const f={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new u.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const E of c.layers){const C=this._layers[E];if(!C)return this.fire(new u.ErrorEvent(new Error(`The layer '${E}' does not exist in the map's style and cannot be queried for features.`))),[];f[C.source]=!0}}const d=[];c.availableImages=this._availableImages;const y=c&&c.layers?c.layers.some(E=>{const C=this.getLayer(E);return C&&C.is3D()}):this.has3DLayers(),x=Dn.createFromScreenPoints(r,a);for(const E in this._sourceCaches){const C=this._sourceCaches[E].getSource().id;c.layers&&!f[C]||d.push(pe(this._sourceCaches[E],this._layers,this._serializedLayers,x,c,a,y,!!this.map._showQueryGeometry))}return this.placement&&d.push(function(E,C,k,U,Y,oe,le){const he={},me=oe.queryRenderedSymbols(U),ee=[];for(const be of Object.keys(me).map(Number))ee.push(le[be]);ee.sort(ht);for(const be of ee){const ye=be.featureIndex.lookupSymbolFeatures(me[be.bucketInstanceId],C,be.bucketIndex,be.sourceLayerIndex,Y.filter,Y.layers,Y.availableImages,E);for(const De in ye){const ke=he[De]=he[De]||[],Ae=ye[De];Ae.sort((Be,He)=>{const Xe=be.featureSortOrder;if(Xe){const Qe=Xe.indexOf(Be.featureIndex);return Xe.indexOf(He.featureIndex)-Qe}return He.featureIndex-Be.featureIndex});for(const Be of Ae)ke.push(Be)}}for(const be in he)he[be].forEach(ye=>{const De=ye.feature,ke=k(E[be]).getFeatureState(De.layer["source-layer"],De.id);De.source=De.layer.source,De.layer["source-layer"]&&(De.sourceLayer=De.layer["source-layer"]),De.state=ke});return he}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),x.screenGeometry,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(d)}querySourceFeatures(r,c){c&&c.filter&&this._validate(u.validateFilter,"querySourceFeatures.filter",c.filter,null,c);const a=this._getSourceCaches(r);let f=[];for(const d of a)f=f.concat(je(d,c));return f}addSourceType(r,c,a){return uo.getSourceType(r)?a(new Error(`A source type called "${r}" already exists.`)):(uo.setSourceType(r,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:c.workerSourceURL},a):a(null,null))}getLight(){return this.light.getLight()}setLight(r,c={}){this._checkLoaded();const a=this.light.getLight();let f=!1;for(const y in r)if(!Ie(r[y],a[y])){f=!0;break}if(!f)return;const d=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(r,c),this.light.updateTransitions(d)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(r,c=1){if(this._checkLoaded(),!r)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===c){if("object"==typeof r.source){const a="terrain-dem-src";this.addSource(a,r.source),r=u.clone$1(r),r=u.extend(r,{source:a})}if(this._validate(u.validateTerrain,"terrain",r))return}if(!this.terrain||this.terrain&&c!==this.terrain.drapeRenderMode)this._createTerrain(r,c);else{const a=this.terrain,f=a.get();for(const d of Object.keys(u.spec.terrain))!r.hasOwnProperty(d)&&u.spec.terrain[d].default&&(r[d]=u.spec.terrain[d].default);for(const d in r)if(!Ie(r[d],f[d])){a.set(r),this.stylesheet.terrain=r;const y=this._setTransitionParameters({duration:0});a.updateTransitions(y);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const c=this.fog=new It(r,this.map.transform);this.stylesheet.fog=r;const a=this._setTransitionParameters({duration:0});c.updateTransitions(a)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog,a=c.get();0===Object.keys(r).length&&c.set(r);for(const f in r)if(!Ie(r[f],a[f])){c.set(r),this.stylesheet.fog=r;const d=this._setTransitionParameters({duration:0});c.updateTransitions(d);break}}else this._createFog(r);this._markersNeedUpdate=!0}_setTransitionParameters(r){return{now:u.exported.now(),transition:u.extend(r,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const r=this._order.filter(a=>this.isLayerDraped(this._layers[a])),c=this._order.filter(a=>!this.isLayerDraped(this._layers[a]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...c)}_createTerrain(r,c){const a=this.terrain=new mn(r,c);this.stylesheet.terrain=r,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const f=this._setTransitionParameters({duration:0});a.updateTransitions(f)}_force3DLayerUpdate(){for(const r in this._layers){const c=this._layers[r];"fill-extrusion"===c.type&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const c=this._layers[r];"symbol"===c.type&&this._updateLayer(c)}}_validate(r,c,a,f,d={}){return(!d||!1!==d.validate)&&Us(this,r.call(u.validateStyle,u.extend({key:c,style:this.serialize(),value:a,styleSpec:u.spec},f)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),u.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._layers)this._layers[r].setEventedParent(null);for(const r in this._sourceCaches)this._sourceCaches[r].clearTiles(),this._sourceCaches[r].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(r){const c=this._getSourceCaches(r);for(const a of c)a.clearTiles()}_reloadSource(r){const c=this._getSourceCaches(r);for(const a of c)a.resume(),a.reload()}_reloadSources(){for(const r of this._getSources())r.reload&&r.reload()}_updateSources(r){for(const c in this._sourceCaches)this._sourceCaches[c].update(r)}_generateCollisionBoxes(){for(const r in this._sourceCaches){const c=this._sourceCaches[r];c.resume(),c.reload()}}_updatePlacement(r,c,a,f,d=!1){let y=!1,x=!1;const E={};for(const C of this._order){const k=this._layers[C];if("symbol"!==k.type)continue;if(!E[k.source]){const Y=this._getLayerSourceCache(k);if(!Y)continue;E[k.source]=Y.getRenderableIds(!0).map(oe=>Y.getTileByID(oe)).sort((oe,le)=>le.tileID.overscaledZ-oe.tileID.overscaledZ||(oe.tileID.isLessThan(le.tileID)?-1:1))}const U=this.crossTileSymbolIndex.addLayer(k,E[k.source],r.center.lng,r.projection);y=y||U}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),d=d||this._layerOrderChanged||0===a,this._layerOrderChanged&&this.fire(new u.Event("neworder")),(d||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(u.exported.now(),r.zoom))&&(this.pauseablePlacement=new eo(r,this._order,d,c,a,f,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,E),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(u.exported.now()),x=!0),y&&this.pauseablePlacement.placement.setStale()),x||y)for(const C of this._order){const k=this._layers[C];"symbol"===k.type&&this.placement.updateLayerOpacities(k,E[k.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(u.exported.now())}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}getImages(r,c,a){this.imageManager.getImages(c.icons,a),this._updateTilesForChangedImages();const f=d=>{d&&d.setDependencies(c.tileID.key,c.type,c.icons)};f(this._otherSourceCaches[c.source]),f(this._symbolSourceCaches[c.source])}getGlyphs(r,c,a){this.glyphManager.getGlyphs(c.stacks,a)}getResource(r,c,a){return u.makeRequest(c,a)}_getSourceCache(r){return this._otherSourceCaches[r]}_getLayerSourceCache(r){return"symbol"===r.type?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}_getSourceCaches(r){const c=[];return this._otherSourceCaches[r]&&c.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&c.push(this._symbolSourceCaches[r]),c}_isSourceCacheLoaded(r){const c=this._getSourceCaches(r);return 0===c.length?(this.fire(new u.ErrorEvent(new Error(`There is no source with ID '${r}'`))),!1):c.every(a=>a.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}uo.getSourceType=function(p){return ie[p]},uo.setSourceType=function(p,r){ie[p]=r},uo.registerForPluginStateChange=u.registerForPluginStateChange;var oa="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",Fa="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",za="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\nconst float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",sa="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",bo="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif";let aa={},Eo={};const Vs=[];ss(oa,Vs),ss(za,Vs),ss(sa,Vs),ss(bo,Vs),aa=mr("",za),Eo=mr(bo,sa);const Qa=mr("\n#if __VERSION__ >=300\n#define varying in\n#define gl_FragColor glFragColor\n#define texture2D texture\n#define textureCube texture\nout vec4 glFragColor;\n#endif\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}highp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}","\n#if __VERSION__ >=300\n#define attribute in\n#define varying out\n#define texture2D texture\n#endif\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),la=oa,go="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Ds={background:mr("uniform vec4 u_color;uniform float u_opacity;\n#ifdef LIGHTING_3D_MODE\nvarying vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#ifdef LIGHTING_3D_MODE\nuniform vec4 u_color;varying vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(u_color);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:mr("uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos;void main() {vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:mr("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:mr("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:mr("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:mr("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:mr("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:mr("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:mr("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:mr("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:mr("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:mr("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;varying vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:mr("uniform vec2 u_texsize;uniform sampler2D u_image;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:mr("varying vec4 v_color;\n#ifdef RENDER_SHADOWS\nvarying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\nvoid main() {\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvec3 normal=v_normal;\n#endif\nfloat z;vec4 color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);color=mix(v_color,v_roof_color,z);\n#else\ncolor=v_color;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);color.rgb=color.rgb*shade;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef ZERO_ROOF_RADIUS\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#endif\ncolor.xyz=shadowed_color_normal(color.xyz,normalize(normal),v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying highp vec4 v_pos_light_view_0;varying highp vec4 v_pos_light_view_1;varying float v_depth;\n#endif\n#ifdef ZERO_ROOF_RADIUS\nvarying vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nvarying highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS)\nv_normal=normal;\n#endif\nbase=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele;vec3 pos;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nv_pos_light_view_0=u_light_matrix_0*vec4(pos,1);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1);v_depth=gl_Position.w;\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}v_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting(color,NdotL);\n#else\nv_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_color*=u_opacity;\n#ifdef ZERO_ROOF_RADIUS\nv_roof_color=vec4(0.0,0.0,0.0,1.0);\n#ifdef LIGHTING_3D_MODE\nv_roof_color=apply_lighting(color,calculate_NdotL(vec3(0.0,0.0,1.0)));\n#else\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));\n#endif\nv_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:mr("uniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 imagecoord=mod(v_pos,1.0);vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);vec4 out_color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,v_NdotL)*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos;varying vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;varying vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nvarying float v_NdotL;\n#endif\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;ele=elevation(pos_nx.xy);c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_NdotL=NdotL;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif \n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:mr("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:mr("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\ngl_FragColor=apply_lighting(gl_FragColor);\n#endif\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:mr("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\nuniform float u_border_width;uniform vec4 u_border_color;float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture2D(u_dash_image,v_tex).a;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;alpha*=linearstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nout_color=color;\n#endif\nfloat trimmed=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);trimmed=0.0;}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=(u_border_width+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);\n#ifdef RENDER_LINE_BORDER_AUTO\nfloat Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}\n#else\nout_color.rgb=mix(u_border_color.rgb*u_border_color.a*trimmed,out_color.rgb,smoothAlpha);\n#endif\n}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;varying vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/floorwidth,(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:mr("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;vec2 pattern_size=vec2(display_size.x/u_tile_units_to_pixels,display_size.y);float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x=mod(v_linesofar/pattern_size.x*aspect,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));vec4 color=texture2D(u_image,pos);\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting(color);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern\n#pragma mapbox: define lowp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:mr("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:mr("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:mr("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:mr("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:mr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvarying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef RENDER_SHADOWS\ncolor.xyz=shadowed_color(color.xyz,v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;varying vec4 v_pos_light_view_0;varying vec4 v_pos_light_view_1;varying float v_depth;\n#endif\nconst float wireframeOffset=0.00015;void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=wireframeOffset;\n#endif\nv_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);v_depth=gl_Position.w;\n#endif\n}"),terrainDepth:mr("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;varying float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:mr("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Fa),skyboxGradient:mr("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Fa),skyboxCapture:mr("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:mr("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\ncolor=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:mr("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function ss(p,r){const c=p.replace(/\s*\/\/[^\n]*\n/g,"\n").split("\n");for(let a of c)if(a=a.trim(),"#"===a[0]&&a.includes("if")&&!a.includes("endif")){a=a.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const f=a.split(" ");for(const d of f)r.includes(d)||r.push(d)}}function mr(p,r){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,a=r.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),f={},d=[...Vs];return ss(p,d),ss(r,d),{fragmentSource:p=p.replace(c,(y,x,E,C,k)=>(f[k]=!0,"define"===x?`\n#ifndef HAS_UNIFORM_u_${k}\nvarying ${E} ${C} ${k};\n#else\nuniform ${E} ${C} u_${k};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${k}\n    ${E} ${C} ${k} = u_${k};\n#endif\n`)),vertexSource:r=r.replace(c,(y,x,E,C,k)=>{const U="float"===C?"vec2":"vec4",Y=k.match(/color/)?"color":U;return f[k]?"define"===x?`\n#ifndef HAS_UNIFORM_u_${k}\nuniform lowp float u_${k}_t;\nattribute ${E} ${U} a_${k};\nvarying ${E} ${C} ${k};\n#else\nuniform ${E} ${C} u_${k};\n#endif\n`:"vec4"===Y?`\n#ifndef HAS_UNIFORM_u_${k}\n    ${k} = a_${k};\n#else\n    ${E} ${C} ${k} = u_${k};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${k}\n    ${k} = unpack_mix_${Y}(a_${k}, u_${k}_t);\n#else\n    ${E} ${C} ${k} = u_${k};\n#endif\n`:"define"===x?`\n#ifndef HAS_UNIFORM_u_${k}\nuniform lowp float u_${k}_t;\nattribute ${E} ${U} a_${k};\n#else\nuniform ${E} ${C} u_${k};\n#endif\n`:"vec4"===Y?`\n#ifndef HAS_UNIFORM_u_${k}\n    ${E} ${C} ${k} = a_${k};\n#else\n    ${E} ${C} ${k} = u_${k};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${k}\n    ${E} ${C} ${k} = unpack_mix_${Y}(a_${k}, u_${k}_t);\n#else\n    ${E} ${C} ${k} = u_${k};\n#endif\n`}),staticAttributes:a,usedDefines:d}}class ba{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,c,a,f,d,y,x){this.context=r;let E=this.boundPaintVertexBuffers.length!==f.length;for(let k=0;!E&&k<f.length;k++)this.boundPaintVertexBuffers[k]!==f[k]&&(E=!0);let C=this.boundDynamicVertexBuffers.length!==x.length;for(let k=0;!C&&k<x.length;k++)this.boundDynamicVertexBuffers[k]!==x[k]&&(C=!0);if(!r.extVertexArrayObject||!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==a||E||C||this.boundIndexBuffer!==d||this.boundVertexOffset!==y)this.freshBind(c,a,f,d,y,x);else{r.bindVertexArrayOES.set(this.vao);for(const k of x)k&&k.bind();d&&d.dynamicDraw&&d.bind()}}freshBind(r,c,a,f,d,y){let x;const E=r.numAttributes,C=this.context,k=C.gl;if(C.extVertexArrayObject)this.vao&&this.destroy(),this.vao=C.extVertexArrayObject.createVertexArrayOES(),C.bindVertexArrayOES.set(this.vao),x=0,this.boundProgram=r,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=a,this.boundIndexBuffer=f,this.boundVertexOffset=d,this.boundDynamicVertexBuffers=y;else{x=C.currentNumAttributes||0;for(let U=E;U<x;U++)k.disableVertexAttribArray(U)}c.enableAttributes(k,r),c.bind(),c.setVertexAttribPointers(k,r,d);for(const U of a)U.enableAttributes(k,r),U.bind(),U.setVertexAttribPointers(k,r,d);for(const U of y)U&&(U.enableAttributes(k,r),U.bind(),U.setVertexAttribPointers(k,r,d));f&&f.bind(),C.currentNumAttributes=E}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function qo(p,r){const c=Math.pow(2,r.canonical.z),a=r.canonical.y;return[new u.MercatorCoordinate(0,a/c).toLngLat().lat,new u.MercatorCoordinate(0,(a+1)/c).toLngLat().lat]}function Zo(p,r,c,a,f,d,y){const x=p.context,E=x.gl,C=c.fbo;if(!C)return;p.prepareDrawTile();const k=p.useProgram("hillshade");x.activeTexture.set(E.TEXTURE0),E.bindTexture(E.TEXTURE_2D,C.colorAttachment.get());const U=((he,me,ee,be)=>{const ye=ee.paint.get("hillshade-shadow-color"),De=ee.paint.get("hillshade-highlight-color"),ke=ee.paint.get("hillshade-accent-color");let Ae=ee.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===ee.paint.get("hillshade-illumination-anchor")&&(Ae-=he.transform.angle);const Be=!he.options.moving;return{u_matrix:be||he.transform.calculateProjMatrix(me.tileID.toUnwrapped(),Be),u_image:0,u_latrange:qo(0,me.tileID),u_light:[ee.paint.get("hillshade-exaggeration"),Ae],u_shadow:ye,u_highlight:De,u_accent:ke}})(p,c,a,p.terrain?r.projMatrix:null);p.prepareDrawProgram(x,k,r.toUnwrapped());const{tileBoundsBuffer:Y,tileBoundsIndexBuffer:oe,tileBoundsSegments:le}=p.getTileBoundsBuffers(c);k.draw(x,E.TRIANGLES,f,d,y,u.CullFaceMode.disabled,U,a.id,Y,oe,le)}function as(p,r,c){if(!r.needsDEMTextureUpload)return;const a=p.context,f=a.gl;a.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||p.getTileTexture(c.stride);const d=c.getPixels();r.demTexture?r.demTexture.update(d,{premultiply:!1}):r.demTexture=new u.Texture(a,d,f.RGBA,{premultiply:!1}),r.needsDEMTextureUpload=!1}function qi(p,r,c,a,f,d){const y=p.context,x=y.gl;if(!r.dem)return;const E=r.dem;if(y.activeTexture.set(x.TEXTURE1),as(p,r,E),!r.demTexture)return;r.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const C=E.dim;y.activeTexture.set(x.TEXTURE0);let k=r.fbo;if(!k){const le=new u.Texture(y,{width:C,height:C,data:null},x.RGBA);le.bind(x.LINEAR,x.CLAMP_TO_EDGE),k=r.fbo=y.createFramebuffer(C,C,!0),k.colorAttachment.set(le.texture)}y.bindFramebuffer.set(k.framebuffer),y.viewport.set([0,0,C,C]);const{tileBoundsBuffer:U,tileBoundsIndexBuffer:Y,tileBoundsSegments:oe}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(y,x.TRIANGLES,a,f,d,u.CullFaceMode.disabled,((le,he)=>{const me=he.stride,ee=u.create();return u.ortho(ee,0,u.EXTENT,-u.EXTENT,0,0,1),u.translate(ee,ee,[0,-u.EXTENT,0]),{u_matrix:ee,u_image:1,u_dimension:[me,me],u_zoom:le.overscaledZ,u_unpack:he.unpackVector}})(r.tileID,E),c.id,U,Y,oe),r.needsHillshadePrepare=!1}const Ao=p=>({u_matrix:new u.UniformMatrix4f(p),u_image0:new u.Uniform1i(p),u_skirt_height:new u.Uniform1f(p)}),Cs=(p,r)=>({u_matrix:p,u_image0:0,u_skirt_height:r}),no=(p,r,c,a,f,d,y,x,E,C,k,U,Y,oe,le)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(a),u_merc_matrix:c,u_zoom_transition:f,u_merc_center:d,u_image0:0,u_frustum_tl:y,u_frustum_tr:x,u_frustum_br:E,u_frustum_bl:C,u_globe_pos:k,u_globe_radius:U,u_viewport:Y,u_grid_matrix:le?Float32Array.from(le):new Float32Array(9),u_skirt_height:oe});function $s(p,r){return null!=p&&null!=r&&!(!p.hasData()||!r.hasData())&&null!=p.demTexture&&null!=r.demTexture&&p.tileID.key!==r.tileID.key}const Ss=new class{constructor(){this.operations={}}newMorphing(p,r,c,a,f){if(p in this.operations){const d=this.operations[p];d.to.tileID.key!==c.tileID.key&&(d.queued=c)}else this.operations[p]={startTime:a,phase:0,duration:f,from:r,to:c,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const r=this.operations[p];return{from:r.from,to:r.to,phase:r.phase}}update(p){for(const r in this.operations){const c=this.operations[r];for(c.phase=(p-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,p)){delete this.operations[r];break}}}_nextOp(p,r){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=r,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},di={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ca(p){return 6*Math.pow(1.5,22-p)}function ls(p,r){const c=1<<p.z;return!r&&(0===p.x||p.x===c-1)||0===p.y||p.y===c-1}const Jn=p=>({u_matrix:p});function Xo(p,r,c,a,f){if(f>0){const d=u.exported.now(),y=(d-p.timeAdded)/f,x=r?(d-r.timeAdded)/f:-1,E=c.getSource(),C=a.coveringZoomLevel({tileSize:E.tileSize,roundZoom:E.roundZoom}),k=!r||Math.abs(r.tileID.overscaledZ-C)>Math.abs(p.tileID.overscaledZ-C),U=k&&p.refreshedUponExpiration?1:u.clamp(k?y:1-x,0,1);return p.refreshedUponExpiration&&y>=1&&(p.refreshedUponExpiration=!1),r?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class Ba extends u.SourceCache{constructor(r){const c={type:"raster-dem",maxzoom:r.transform.maxZoom},a=new Ht(xn(),null),f=q("mock-dem",c,a,r.style);super("mock-dem",f,!1),f.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,c){r.state="loaded",c(null)}}class cs extends u.SourceCache{constructor(r){const c=q("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},new Ht(xn(),null),r.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,c,a){if(r.freezeTileCoverage)return;this.transform=r;const f=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((d,y)=>{if(d[y.key]="",!this._tiles[y.key]){const x=new u.Tile(y,this._source.tileSize*y.overscaleFactor(),r.tileZoom);x.state="loaded",this._tiles[y.key]=x}return d},{});for(const d in this._tiles)d in f||(this.freeFBO(d),this._tiles[d].unloadVectorData(),delete this._tiles[d])}freeFBO(r){const c=this.proxyCachedFBO[r];if(void 0!==c){const a=Object.values(c);this.renderCachePool.push(...a),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ei extends u.OverscaledTileID{constructor(r,c,a){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=c,this.projMatrix=a}}class us extends u.Elevation{constructor(r,c){super(),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[a,f,d]=function(E){const C=new u.StructArrayLayout2i4,k=new u.StructArrayLayout3ui6,U=131;C.reserve(17161),k.reserve(33800);const Y=u.EXTENT/128,oe=u.EXTENT+Y/2,le=oe+Y;for(let me=-Y;me<le;me+=Y)for(let ee=-Y;ee<le;ee+=Y){const be=ee<0||ee>oe||me<0||me>oe?24575:0,ye=u.clamp(Math.round(ee),0,u.EXTENT),De=u.clamp(Math.round(me),0,u.EXTENT);C.emplaceBack(ye+be,De)}const he=(me,ee)=>{const be=ee*U+me;k.emplaceBack(be+1,be,be+U),k.emplaceBack(be+U,be+U+1,be+1)};for(let me=1;me<129;me++)for(let ee=1;ee<129;ee++)he(ee,me);return[0,129].forEach(me=>{for(let ee=0;ee<130;ee++)he(ee,me),he(me,ee)}),[C,k,32768]}(),y=r.context;this.gridBuffer=y.createVertexBuffer(a,u.posAttributes.members),this.gridIndexBuffer=y.createIndexBuffer(f),this.gridSegments=u.SegmentVector.simpleSegment(0,0,a.length,f.length),this.gridNoSkirtSegments=u.SegmentVector.simpleSegment(0,0,a.length,d),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new cs(c.map),this.orthoMatrix=u.create(),u.ortho(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,u.EXTENT,0,u.EXTENT,0,1);const x=y.gl;this._overlapStencilMode=new u.StencilMode({func:x.GEQUAL,mask:255},0,255,x.KEEP,x.KEEP,x.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new Ba(c.map)}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),r.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=r,this._checkRenderCacheEfficiency(),this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,c,a){if(r&&r.terrain){this._style!==r&&(this.style=r),this.enabled=!0;const f=r.terrain.properties;this.sourceCache=0===r.terrain.drapeRenderMode?this._mockSourceCache:r._getSourceCache(f.get("source")),this._exaggeration=f.get("exaggeration");const d=()=>{this.sourceCache.used&&u.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const y=this.getScaledDemTileSize();this.sourceCache.update(c,y,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,d(),this._initializing=!0),d(),c.updateElevation(!0,a),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const r=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==r.efficiency&&u.warnOnce(`Terrain render cache efficiency is not optimal (${r.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${r.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(r){r.coord&&"source"===r.dataType?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):"style"===r.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._sourceCaches)this._style._sourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,a=this.painter.transform;this._initializing&&(this._initializing=0===a._centerAltitude&&-1===this.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(a.center),-1),this._emptyDEMTextureDirty=!this._initializing);const f=this.proxyCoords=c.getIds().map(E=>{const C=c.getTileByID(E).tileID;return C.projMatrix=a.calculateProjMatrix(C.toUnwrapped()),C});(function(E,C){const k=C.transform.pointCoordinate(C.transform.getCameraPoint()),U=new u.pointGeometry(k.x,k.y);E.sort((Y,oe)=>{if(oe.overscaledZ-Y.overscaledZ)return oe.overscaledZ-Y.overscaledZ;const le=new u.pointGeometry(Y.canonical.x+(1<<Y.canonical.z)*Y.wrap,Y.canonical.y),he=new u.pointGeometry(oe.canonical.x+(1<<oe.canonical.z)*oe.wrap,oe.canonical.y),me=U.mult(1<<Y.canonical.z);return me.x-=.5,me.y-=.5,me.distSqr(le)-me.distSqr(he)})})(f,this.painter),this._previousZoom=a.zoom;const d=this.proxyToSource||{};this.proxyToSource={},f.forEach(E=>{this.proxyToSource[E.key]={}}),this.terrainTileForTile={};const y=this._style._sourceCaches;for(const E in y){const C=y[E];if(!C.used||(C!==this.sourceCache&&this.resetTileLookupCache(C.id),this._setupProxiedCoordsForOrtho(C,r[E],d),C.usedForTerrain))continue;const k=r[E];C.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[c.id]=f.map(E=>new ei(E,E.key,this.orthoMatrix)),this._assignTerrainTiles(f),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(d),this.renderingToTexture=!1,this._updateTimestamp=u.exported.now();const x={};this._visibleDemTiles=[];for(const E of this.proxyCoords){const C=this.terrainTileForTile[E.key];if(!C)continue;const k=C.tileID.key;k in x||(this._visibleDemTiles.push(C),x[k]=k)}}_assignTerrainTiles(r){this._initializing||r.forEach(c=>{if(this.terrainTileForTile[c.key])return;const a=this._findTileCoveringTileID(c,this.sourceCache);a&&(this.terrainTileForTile[c.key]=a)})}_prepareDEMTextures(){const r=this.painter.context,c=r.gl;for(const a in this.terrainTileForTile){const f=this.terrainTileForTile[a],d=f.dem;!d||f.demTexture&&!f.needsDEMTextureUpload||(r.activeTexture.set(c.TEXTURE1),as(this.painter,f,d))}}_prepareDemTileUniforms(r,c,a,f){if(!c||null==c.demTexture)return!1;const d=r.tileID.canonical,y=Math.pow(2,c.tileID.canonical.z-d.z),x=f||"";return a[`u_dem_tl${x}`]=[d.x*y%1,d.y*y%1],a[`u_dem_scale${x}`]=y,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const r=this.painter.context,c=r.gl;if(!this._emptyDepthBufferTexture){const a=new u.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new u.Texture(r,a,c.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let r=0;const c=this._visibleDemTiles.reduce((a,f)=>{if(!f.dem)return a;const d=f.dem.tree.minimums[0];return d>0&&r++,a+d},0);return r?c/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,c=r.gl;r.activeTexture.set(c.TEXTURE2);const a=this._getLoadedAreaMinimum(),f=new u.RGBAImage({width:1,height:1},new Uint8Array(u.DEMData.pack(a,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let d=this._emptyDEMTexture;return d?d.update(f,{premultiply:!1}):d=this._emptyDEMTexture=new u.Texture(r,f,c.RGBA,{premultiply:!1}),d}setupElevationDraw(r,c,a){const f=this.painter.context,d=f.gl,y=(x=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:u.DEMData.getUnpackVector(x),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0});var x;y.u_dem_size=this.sourceCache.getSource().tileSize,y.u_exaggeration=this.exaggeration();let E=null,C=null,k=1;if(a&&a.morphing&&this._useVertexMorphing){const U=a.morphing.srcDemTile,Y=a.morphing.dstDemTile;k=a.morphing.phase,U&&Y&&(this._prepareDemTileUniforms(r,U,y,"_prev")&&(C=U),this._prepareDemTileUniforms(r,Y,y)&&(E=Y))}if(C&&E?(f.activeTexture.set(d.TEXTURE2),E.demTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE,d.NEAREST),f.activeTexture.set(d.TEXTURE4),C.demTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE,d.NEAREST),y.u_dem_lerp=k):(E=this.terrainTileForTile[r.tileID.key],f.activeTexture.set(d.TEXTURE2),(this._prepareDemTileUniforms(r,E,y)?E.demTexture:this.emptyDEMTexture).bind(d.NEAREST,d.CLAMP_TO_EDGE)),f.activeTexture.set(d.TEXTURE3),a&&a.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE),this._depthFBO&&(y.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(d.NEAREST,d.CLAMP_TO_EDGE),y.u_depth_size_inv=[1,1]),a&&a.useMeterToDem&&E){const U=(1<<E.tileID.canonical.z)*u.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;y.u_meter_to_dem=U}if(a&&a.labelPlaneMatrixInv&&(y.u_label_plane_matrix_inv=a.labelPlaneMatrixInv),c.setTerrainUniformValues(f,y),"globe"===this.painter.transform.projection.name){const U=this.globeUniformValues(this.painter.transform,r.tileID.canonical,a&&a.useDenormalizedUpVectorScale);c.setGlobeUniformValues(f,U)}}globeUniformValues(r,c,a){const f=r.projection;return{u_tile_tl_up:f.upVector(c,0,0),u_tile_tr_up:f.upVector(c,u.EXTENT,0),u_tile_br_up:f.upVector(c,u.EXTENT,u.EXTENT),u_tile_bl_up:f.upVector(c,0,u.EXTENT),u_tile_up_scale:a?u.globeMetersToEcef(1):f.upVectorScale(c,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const c=this.painter,a=this.painter.context;0!==r.length&&(a.bindFramebuffer.set(null),a.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(f,d,y,x,E){if("globe"===f.transform.projection.name)!function(C,k,U,Y,oe){const le=C.context,he=le.gl;let me,ee;const be=C.options.showTerrainWireframe?2:0,ye=C.transform,De=u.globeUseCustomAntiAliasing(C,le,ye),ke=(kt,Ye)=>{if(ee===kt)return;const Ge=[di[kt],"PROJECTION_GLOBE_VIEW"];De&&Ge.push("CUSTOM_ANTIALIASING"),Ye&&Ge.push(di[be]),me=C.useProgram("globeRaster",null,Ge),ee=kt},Ae=C.colorModeForRenderPass(),Be=new u.DepthMode(he.LEQUAL,u.DepthMode.ReadWrite,C.depthRangeFor3D);Ss.update(oe);const He=u.calculateGlobeMercatorMatrix(ye),Xe=[u.mercatorXfromLng(ye.center.lng),u.mercatorYfromLat(ye.center.lat)],Qe=be?[!1,!0]:[!1],qt=C.globeSharedBuffers,qe=[ye.width*u.exported.devicePixelRatio,ye.height*u.exported.devicePixelRatio],Tt=Float32Array.from(ye.globeMatrix),at={useDenormalizedUpVectorScale:!0};if(Qe.forEach(kt=>{const Ye=C.transform,Ge=ca(Ye.zoom)*k.exaggeration();ee=-1;const it=kt?he.LINES:he.TRIANGLES;for(const Ct of Y){const Bt=U.getTile(Ct),Mn=u.StencilMode.disabled,_r=k.prevTerrainTileForTile[Ct.key],wn=k.terrainTileForTile[Ct.key];$s(_r,wn)&&Ss.newMorphing(Ct.key,_r,wn,oe,250),le.activeTexture.set(he.TEXTURE0),Bt.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE);const pn=Ss.getMorphValuesForProxy(Ct.key),Rn=pn?1:0;pn&&u.extend$1(at,{morphing:{srcDemTile:pn.from,dstDemTile:pn.to,phase:u.easeCubicInOut(pn.phase)}});const Ir=u.tileCornersToBounds(Ct.canonical),zn=u.getLatitudinalLod(Ir.getCenter().lat),ti=u.getGridMatrix(Ct.canonical,Ir,zn,Ye.worldSize/Ye._pixelsPerMercatorPixel),pi=u.globeNormalizeECEF(u.globeTileBounds(Ct.canonical)),mi=no(Ye.projMatrix,Tt,He,pi,u.globeToMercatorTransition(Ye.zoom),Xe,Ye.frustumCorners.TL,Ye.frustumCorners.TR,Ye.frustumCorners.BR,Ye.frustumCorners.BL,Ye.globeCenterInViewSpace,Ye.globeRadius,qe,Ge,ti);if(ke(Rn,kt),k.setupElevationDraw(Bt,me,at),C.prepareDrawProgram(le,me,Ct.toUnwrapped()),qt){const[Si,Oo,ks]=kt?qt.getWirefameBuffers(C.context,zn):qt.getGridBuffers(zn,0!==Ge);me.draw(le,it,Be,Mn,Ae,u.CullFaceMode.backCCW,mi,"globe_raster",Si,Oo,ks)}}}),qt){const kt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];De&&kt.push("CUSTOM_ANTIALIASING"),me=C.useProgram("globeRaster",null,kt);for(const Ye of Y){const{x:Ge,y:it,z:Ct}=Ye.canonical,Bt=0===it,Mn=it===(1<<Ct)-1,[_r,wn,pn,Rn]=qt.getPoleBuffers(Ct);if(Rn&&(Bt||Mn)){const Ir=U.getTile(Ye);le.activeTexture.set(he.TEXTURE0),Ir.texture.bind(he.LINEAR,he.CLAMP_TO_EDGE);let zn=u.globePoleMatrixForTile(Ct,Ge,ye);const ti=u.globeNormalizeECEF(u.globeTileBounds(Ye.canonical)),pi=(mi,Si)=>mi.draw(le,he.TRIANGLES,Be,u.StencilMode.disabled,Ae,u.CullFaceMode.disabled,no(ye.projMatrix,zn,zn,ti,0,Xe,ye.frustumCorners.TL,ye.frustumCorners.TR,ye.frustumCorners.BR,ye.frustumCorners.BL,ye.globeCenterInViewSpace,ye.globeRadius,qe,0),"globe_pole_raster",Si,pn,Rn);k.setupElevationDraw(Ir,me,at),C.prepareDrawProgram(le,me,Ye.toUnwrapped()),Bt&&pi(me,_r),Mn&&(zn=u.scale(u.create(),zn,[1,-1,1]),pi(me,wn))}}}}(f,d,y,x,E);else{const C=f.context,k=C.gl;let U,Y;const oe=f.options.showTerrainWireframe?2:0,le=(ye,De)=>{if(Y===ye)return;const ke=[di[ye]];De&&ke.push(di[oe]),U=f.useProgram("terrainRaster",null,ke),Y=ye},he=f.colorModeForRenderPass(),me=new u.DepthMode(k.LEQUAL,u.DepthMode.ReadWrite,f.depthRangeFor3D);Ss.update(E);const ee=f.transform,be=ca(ee.zoom)*d.exaggeration();(oe?[!1,!0]:[!1]).forEach(ye=>{Y=-1;const De=ye?k.LINES:k.TRIANGLES,[ke,Ae]=ye?d.getWirefameBuffer():[d.gridIndexBuffer,d.gridSegments];for(const Be of x){const He=y.getTile(Be),Xe=u.StencilMode.disabled,Qe=d.prevTerrainTileForTile[Be.key],qt=d.terrainTileForTile[Be.key];$s(Qe,qt)&&Ss.newMorphing(Be.key,Qe,qt,E,250),C.activeTexture.set(k.TEXTURE0),He.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE,k.LINEAR_MIPMAP_NEAREST);const qe=Ss.getMorphValuesForProxy(Be.key),Tt=qe?1:0;let at;qe&&(at={morphing:{srcDemTile:qe.from,dstDemTile:qe.to,phase:u.easeCubicInOut(qe.phase)}});const kt=Cs(Be.projMatrix,ls(Be.canonical,ee.renderWorldCopies)?be/10:be);le(Tt,ye),d.setupElevationDraw(He,U,at),f.prepareDrawProgram(C,U,Be.toUnwrapped()),U.draw(C,De,me,Xe,he,u.CullFaceMode.backCCW,kt,"terrain_raster",d.gridBuffer,ke,Ae)}})}}(c,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(0===this._drapedRenderBatches.length)return r+1;this.renderingToTexture=!0;const c=this.painter,a=this.painter.context,f=this.proxySourceCache,d=this.proxiedCoords[f.id],y=this._drapedRenderBatches.shift(),x=[],E=c.style.order;let C=0;for(const k of d){const U=f.getTileByID(k.proxyTileKey),Y=f.proxyCachedFBO[k.key]?f.proxyCachedFBO[k.key][r]:void 0,oe=void 0!==Y?f.renderCache[Y]:this.pool[C++],le=void 0!==Y;if(U.texture=oe.tex,le&&!oe.dirty){x.push(U.tileID);continue}let he;a.bindFramebuffer.set(oe.fb.framebuffer),this.renderedToTile=!1,oe.dirty&&(a.clear({color:u.Color.transparent,stencil:0}),oe.dirty=!1);for(let me=y.start;me<=y.end;++me){const ee=c.style._layers[E[me]];if(ee.isHidden(c.transform.zoom))continue;const be=c.style._getLayerSourceCache(ee),ye=be?this.proxyToSource[k.key][be.id]:[k];if(!ye)continue;const De=ye;a.viewport.set([0,0,oe.fb.width,oe.fb.height]),he!==(be?be.id:null)&&(this._setupStencil(oe,ye,ee,be),he=be?be.id:null),c.renderLayer(c,be,ee,De)}this.renderedToTile?(oe.dirty=!0,x.push(U.tileID)):le||--C,5===C&&(C=0,this.renderToBackBuffer(x))}return this.renderToBackBuffer(x),this.renderingToTexture=!1,a.bindFramebuffer.set(null),a.viewport.set([0,0,c.width,c.height]),y.end+1}postRender(){}renderCacheEfficiency(r){const c=r.order.length;if(0===c)return{efficiency:100};let a,f=0,d=0,y=!1;for(let x=0;x<c;++x){const E=r._layers[r.order[x]];this._style.isLayerDraped(E)?(y&&++f,++d):y||(y=!0,a=E.id)}return 0===d?{efficiency:100}:{efficiency:100*(1-f/d),firstUndrapedLayer:a}}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{r=Math.min(r,c.dem.tree.minimums[0])}),0===r?r:(r-30)*this._exaggeration}raycast(r,c,a){if(!this._visibleDemTiles)return null;const f=this._visibleDemTiles.filter(d=>d.dem).map(d=>{const y=d.tileID,x=1<<y.overscaledZ,{x:E,y:C}=y.canonical,k=E/x,U=(E+1)/x,Y=C/x,oe=(C+1)/x;return{minx:k,miny:Y,maxx:U,maxy:oe,t:d.dem.tree.raycastRoot(k,Y,U,oe,r,c,a),tile:d}});f.sort((d,y)=>(null!==d.t?d.t:Number.MAX_VALUE)-(null!==y.t?y.t:Number.MAX_VALUE));for(const d of f){if(null==d.t)return null;const y=d.tile.dem.tree.raycast(d.minx,d.miny,d.maxx,d.maxy,r,c,a);if(null!=y)return y}return null}_createFBO(){const r=this.painter.context,c=r.gl,a=this.drapeBufferSize;r.activeTexture.set(c.TEXTURE0);const f=new u.Texture(r,{width:a[0],height:a[1],data:null},c.RGBA);f.bind(c.LINEAR,c.CLAMP_TO_EDGE);const d=r.createFramebuffer(a[0],a[1],!1);return d.colorAttachment.set(f.texture),d.depthAttachment=new Pt(r,d.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,a[0],a[1]),this._stencilRef=0,d.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):d.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&!r.extTextureFilterAnisotropicForceOff&&c.texParameterf(c.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:d,tex:f,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const r in this._style._sourceCaches)if(this._style._sourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const c=this._style._layers[r],a=c.isHidden(this.painter.transform.zoom);return"custom"===c.type?!a&&c.shouldRedrape():!a&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const a of this._style._getSources())if(a instanceof H){r=!0;break}if(!r)return;const c={};for(let a=0;a<this._style.order.length;++a){const f=this._style._layers[this._style.order[a]],d=this._style._getLayerSourceCache(f);if(d&&!c[d.id]&&!f.isHidden(this.painter.transform.zoom)&&"line"===f.type&&f.widthExpression()instanceof u.ZoomDependentExpression){c[d.id]=!0;for(const y of this.proxyCoords){const x=this.proxyToSource[y.key][d.id];if(x)for(const E of x)this._clearRenderCacheForTile(d.id,E)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const a in this._style._sourceCaches)if(this._style._sourceCaches[a]._source instanceof K){r=!0;break}if(!r)return;const c={};for(let a=0;a<this._style.order.length;++a){const f=this._style._layers[this._style.order[a]],d=this._style._getLayerSourceCache(f);if(!d||c[d.id]||f.isHidden(this.painter.transform.zoom)||"raster"!==f.type)continue;const y=f.paint.get("raster-fade-duration");for(const x of this.proxyCoords){const E=this.proxyToSource[x.key][d.id];if(E)for(const C of E){const k=Xo(d.getTile(C),d.findLoadedParent(C,0),d,this.painter.transform,y);(1!==k.opacity||0!==k.mix)&&this._clearRenderCacheForTile(d.id,C)}}}}_setupDrapedRenderBatches(){const r=this._style.order,c=r.length;if(0===c)return;const a=[];let f,d=0,y=this._style._layers[r[d]];for(;!this._style.isLayerDraped(y)&&y.isHidden(this.painter.transform.zoom)&&++d<c;)y=this._style._layers[r[d]];for(;d<c;++d){const x=this._style._layers[r[d]];x.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(x)?void 0===f&&(f=d):void 0!==f&&(a.push({start:f,end:d-1}),f=void 0))}void 0!==f&&a.push({start:f,end:d-1}),this._drapedRenderBatches=a}_setupRenderCache(r){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const y=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let x=0;x<y.length;++x){const E=Object.values(y[x]);c.renderCachePool.push(...E)}}return}this._clearRasterLayersFromRenderCache();const a=this.proxyCoords,f=this._tilesDirty;for(let y=a.length-1;y>=0;y--){const x=a[y];if(c.getTileByID(x.key),void 0!==c.proxyCachedFBO[x.key]){const E=r[x.key],C=this.proxyToSource[x.key];let k=0;for(const U in C){const Y=C[U],oe=E[U];if(!oe||oe.length!==Y.length||Y.some((le,he)=>le!==oe[he]||f[U]&&f[U].hasOwnProperty(le.key))){k=-1;break}++k}for(const U in c.proxyCachedFBO[x.key])c.renderCache[c.proxyCachedFBO[x.key][U]].dirty=k<0||k!==Object.values(E).length}}const d=[...this._drapedRenderBatches];d.sort((y,x)=>x.end-x.start-(y.end-y.start));for(const y of d)for(const x of a){if(c.proxyCachedFBO[x.key])continue;let E=c.renderCachePool.pop();void 0===E&&c.renderCache.length<50&&(E=c.renderCache.length,c.renderCache.push(this._createFBO())),void 0!==E&&(c.proxyCachedFBO[x.key]={},c.proxyCachedFBO[x.key][y.start]=E,c.renderCache[E].dirty=!0)}this._tilesDirty={}}_setupStencil(r,c,a,f){if(!f||!this._sourceTilesOverlap[f.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const d=this.painter.context,y=d.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let x;if(a.isTileClipped())x=c.length,this._overlapStencilMode.test={func:y.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);x=1,this._overlapStencilMode.test={func:y.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+x>255&&(d.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=x,this._overlapStencilMode.ref=this._stencilRef,a.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):u.StencilMode.disabled}_renderTileClippingMasks(r,c){const a=this.painter,f=this.painter.context,d=f.gl;a._tileClippingMaskIDs={},f.setColorMode(u.ColorMode.disabled),f.setDepthMode(u.DepthMode.disabled);const y=a.useProgram("clippingMask");for(const x of r){const E=a._tileClippingMaskIDs[x.key]=--c;y.draw(f,d.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:d.ALWAYS,mask:0},E,255,d.KEEP,d.KEEP,d.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,Jn(x.projMatrix),"$clipping",a.tileExtentBuffer,a.quadTriangleIndexBuffer,a.tileExtentSegments)}}pointCoordinate(r){const c=this.painter.transform;if(r.x<0||r.x>c.width||r.y<0||r.y>c.height)return null;const a=[r.x,r.y,1,1];u.transformMat4$1(a,a,c.pixelMatrixInverse),u.scale$1(a,a,1/a[3]),a[0]/=c.worldSize,a[1]/=c.worldSize;const f=c._camera.position,d=u.mercatorZfromAltitude(1,c.center.lat),y=[f[0],f[1],f[2]/d,0],x=u.subtract([],a.slice(0,3),y);u.normalize(x,x);const E=this.raycast(y,x,this._exaggeration);return null!==E&&E?(u.scaleAndAdd(y,y,x,E),y[3]=y[2],y[2]*=d,y):null}drawDepth(){const r=this.painter,c=r.context,a=this.proxySourceCache,f=Math.ceil(r.width),d=Math.ceil(r.height);if(!this._depthFBO||this._depthFBO.width===f&&this._depthFBO.height===d||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const y=c.gl,x=c.createFramebuffer(f,d,!0);c.activeTexture.set(y.TEXTURE0);const E=new u.Texture(c,{width:f,height:d,data:null},y.RGBA);E.bind(y.NEAREST,y.CLAMP_TO_EDGE),x.colorAttachment.set(E.texture);const C=c.createRenderbuffer(c.gl.DEPTH_COMPONENT16,f,d);x.depthAttachment.set(C),this._depthFBO=x,this._depthTexture=E}c.bindFramebuffer.set(this._depthFBO.framebuffer),c.viewport.set([0,0,f,d]),function(y,x,E,C){if("globe"===y.transform.projection.name)return;const k=y.context,U=k.gl;k.clear({depth:1});const Y=y.useProgram("terrainDepth"),oe=new u.DepthMode(U.LESS,u.DepthMode.ReadWrite,y.depthRangeFor3D);for(const le of C){const he=E.getTile(le),me=Cs(le.projMatrix,0);x.setupElevationDraw(he,Y),Y.draw(k,U.TRIANGLES,oe,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.backCCW,me,"terrain_depth",x.gridBuffer,x.gridIndexBuffer,x.gridNoSkirtSegments)}}(r,this,a,this.proxyCoords)}_setupProxiedCoordsForOrtho(r,c,a){if(r.getSource()instanceof ne)return this._setupProxiedCoordsForImageSource(r,c,a);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const f=this.proxiedCoords[r.id]=[],d=this.proxyCoords;for(let x=0;x<d.length;x++){const E=d[x],C=this._findTileCoveringTileID(E,r);if(C){const k=this._createProxiedId(E,C,a[E.key]&&a[E.key][r.id]);f.push(k),this.proxyToSource[E.key][r.id]=[k]}}let y=!1;for(let x=0;x<c.length;x++){const E=r.getTile(c[x]);if(!E||!E.hasData())continue;const C=this._findTileCoveringTileID(E.tileID,this.proxySourceCache);if(C&&C.tileID.canonical.z!==E.tileID.canonical.z){const k=this.proxyToSource[C.tileID.key][r.id],U=this._createProxiedId(C.tileID,E,a[C.tileID.key]&&a[C.tileID.key][r.id]);k?k.splice(k.length-1,0,U):this.proxyToSource[C.tileID.key][r.id]=[U],f.push(U),y=!0}}this._sourceTilesOverlap[r.id]=y}_setupProxiedCoordsForImageSource(r,c,a){if(!r.getSource().loaded())return;const f=this.proxiedCoords[r.id]=[],d=this.proxyCoords,y=r.getSource(),x=new u.pointGeometry(y.tileID.x,y.tileID.y)._div(1<<y.tileID.z),E=y.coordinates.map(u.MercatorCoordinate.fromLngLat).reduce((k,U)=>(k.min.x=Math.min(k.min.x,U.x-x.x),k.min.y=Math.min(k.min.y,U.y-x.y),k.max.x=Math.max(k.max.x,U.x-x.x),k.max.y=Math.max(k.max.y,U.y-x.y),k),{min:new u.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new u.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),C=(k,U)=>{const Y=k.wrap+k.canonical.x/(1<<k.canonical.z),oe=k.canonical.y/(1<<k.canonical.z),le=u.EXTENT/(1<<k.canonical.z),he=U.wrap+U.canonical.x/(1<<U.canonical.z),me=U.canonical.y/(1<<U.canonical.z);return Y+le<he+E.min.x||Y>he+E.max.x||oe+le<me+E.min.y||oe>me+E.max.y};for(let k=0;k<d.length;k++){const U=d[k];for(let Y=0;Y<c.length;Y++){const oe=r.getTile(c[Y]);if(!oe||!oe.hasData()||C(U,oe.tileID))continue;const le=this._createProxiedId(U,oe,a[U.key]&&a[U.key][r.id]),he=this.proxyToSource[U.key][r.id];he?he.push(le):this.proxyToSource[U.key][r.id]=[le],f.push(le)}}}_createProxiedId(r,c,a){let f=this.orthoMatrix;if(a){const d=a.find(y=>y.key===c.tileID.key);if(d)return d}if(c.tileID.key!==r.key){const d=r.canonical.z-c.tileID.canonical.z;let y,x,E;f=u.create();const C=c.tileID.wrap-r.wrap<<r.overscaledZ;d>0?(y=u.EXTENT>>d,x=y*((c.tileID.canonical.x<<d)-r.canonical.x+C),E=y*((c.tileID.canonical.y<<d)-r.canonical.y)):(y=u.EXTENT<<-d,x=u.EXTENT*(c.tileID.canonical.x-(r.canonical.x+C<<-d)),E=u.EXTENT*(c.tileID.canonical.y-(r.canonical.y<<-d))),u.ortho(f,0,y,0,y,0,1),u.translate(f,f,[x,E,0])}return new ei(c.tileID,r.key,f)}_findTileCoveringTileID(r,c){let a=c.getTile(r);if(a&&a.hasData())return a;const f=this._findCoveringTileCache[c.id],d=f[r.key];if(a=d?c.getTileByID(d):null,a&&a.hasData()||null===d)return a;let y=a?a.tileID:r,x=y.overscaledZ;const E=c.getSource().minzoom,C=[];if(!d){const U=c.getSource().maxzoom;if(r.canonical.z>=U){const Y=r.canonical.z-U;c.getSource().reparseOverscaled?(x=Math.max(r.canonical.z+2,c.transform.tileZoom),y=new u.OverscaledTileID(x,r.wrap,U,r.canonical.x>>Y,r.canonical.y>>Y)):0!==Y&&(x=U,y=new u.OverscaledTileID(x,r.wrap,U,r.canonical.x>>Y,r.canonical.y>>Y))}y.key!==r.key&&(C.push(y.key),a=c.getTile(y))}const k=U=>{C.forEach(Y=>{f[Y]=U}),C.length=0};for(x-=1;x>=E&&(!a||!a.hasData());x--){a&&k(a.tileID.key);const U=y.calculateScaledKey(x);if(a=c.getTileByID(U),a&&a.hasData())break;const Y=f[U];if(null===Y)break;void 0===Y?C.push(U):a=c.getTileByID(Y)}return k(a?a.tileID.key:null),a&&a.hasData()?a:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,c){let a=this._tilesDirty[r];a||(a=this._tilesDirty[r]={}),a[c.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const r=function(c){let a=0;const f=new u.StructArrayLayout2ui4,d=131;for(let y=1;y<129;y++){for(let x=1;x<129;x++)a=y*d+x,f.emplaceBack(a,a+1),f.emplaceBack(a,a+d),f.emplaceBack(a+1,a+d),128===y&&f.emplaceBack(a+d,a+d+1);f.emplaceBack(a+1,a+1+d)}return f}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(r),this.wireframeSegments=u.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,r.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}class Ko{static cacheKey(r,c,a,f){let d=`${c}${f?f.cacheKey:""}`;for(const y of a)r.usedDefines.includes(y)&&(d+=`/${y}`);return d}constructor(r,c,a,f,d,y){const x=r.gl;this.program=x.createProgram();const E=function(ee){const be=[];for(let ye=0;ye<ee.length;ye++){if(null===ee[ye])continue;const De=ee[ye].split(" ");be.push(De.pop())}return be}(a.staticAttributes),C=f?f.getBinderAttributes():[],k=E.concat(C);let U=f?f.defines():[];U=U.concat(y.map(ee=>`#define ${ee}`));const Y=r.isWebGL2?"#version 300 es\n":"",oe=Y+U.concat(r.extStandardDerivatives&&0===Y.length?"#extension GL_OES_standard_derivatives : enable\n".concat(go):go,go,la,Qa.fragmentSource,Eo.fragmentSource,a.fragmentSource).join("\n"),le=Y+U.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",la,Qa.vertexSource,Eo.vertexSource,aa.vertexSource,a.vertexSource).join("\n"),he=x.createShader(x.FRAGMENT_SHADER);if(x.isContextLost())return void(this.failedToCreate=!0);x.shaderSource(he,oe),x.compileShader(he),x.attachShader(this.program,he);const me=x.createShader(x.VERTEX_SHADER);if(x.isContextLost())this.failedToCreate=!0;else{x.shaderSource(me,le),x.compileShader(me),x.attachShader(this.program,me),this.attributes={},this.numAttributes=k.length;for(let ee=0;ee<this.numAttributes;ee++)k[ee]&&(x.bindAttribLocation(this.program,ee,k[ee]),this.attributes[k[ee]]=ee);x.linkProgram(this.program),x.deleteShader(me),x.deleteShader(he),this.fixedUniforms=d(r),this.binderUniforms=f?f.getUniforms(r):[],y.includes("TERRAIN")&&(this.terrainUniforms={u_dem:new u.Uniform1i(ee=r),u_dem_prev:new u.Uniform1i(ee),u_dem_unpack:new u.Uniform4f(ee),u_dem_tl:new u.Uniform2f(ee),u_dem_scale:new u.Uniform1f(ee),u_dem_tl_prev:new u.Uniform2f(ee),u_dem_scale_prev:new u.Uniform1f(ee),u_dem_size:new u.Uniform1f(ee),u_dem_lerp:new u.Uniform1f(ee),u_exaggeration:new u.Uniform1f(ee),u_depth:new u.Uniform1i(ee),u_depth_size_inv:new u.Uniform2f(ee),u_meter_to_dem:new u.Uniform1f(ee),u_label_plane_matrix_inv:new u.UniformMatrix4f(ee)}),y.includes("GLOBE")&&(this.globeUniforms=(ee=>({u_tile_tl_up:new u.Uniform3f(ee),u_tile_tr_up:new u.Uniform3f(ee),u_tile_br_up:new u.Uniform3f(ee),u_tile_bl_up:new u.Uniform3f(ee),u_tile_up_scale:new u.Uniform1f(ee)}))(r)),y.includes("FOG")&&(this.fogUniforms=(ee=>({u_fog_matrix:new u.UniformMatrix4f(ee),u_fog_range:new u.Uniform2f(ee),u_fog_color:new u.Uniform4f(ee),u_fog_horizon_blend:new u.Uniform1f(ee),u_fog_temporal_offset:new u.Uniform1f(ee),u_frustum_tl:new u.Uniform3f(ee),u_frustum_tr:new u.Uniform3f(ee),u_frustum_br:new u.Uniform3f(ee),u_frustum_bl:new u.Uniform3f(ee),u_globe_pos:new u.Uniform3f(ee),u_globe_radius:new u.Uniform1f(ee),u_globe_transition:new u.Uniform1f(ee),u_is_globe:new u.Uniform1i(ee),u_viewport:new u.Uniform2f(ee)}))(r))}var ee}setTerrainUniformValues(r,c){if(!this.terrainUniforms)return;const a=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const f in c)a[f]&&a[f].set(this.program,f,c[f])}}setGlobeUniformValues(r,c){if(!this.globeUniforms)return;const a=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const f in c)a[f]&&a[f].set(this.program,f,c[f])}}setFogUniformValues(r,c){if(!this.fogUniforms)return;const a=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const f in c)a[f].set(this.program,f,c[f])}}draw(r,c,a,f,d,y,x,E,C,k,U,Y,oe,le,he){const me=r.gl;if(this.failedToCreate)return;r.program.set(this.program),r.setDepthMode(a),r.setStencilMode(f),r.setColorMode(d),r.setCullFace(y);for(const be of Object.keys(this.fixedUniforms))this.fixedUniforms[be].set(this.program,be,x[be]);le&&le.setUniforms(this.program,r,this.binderUniforms,Y,{zoom:oe});const ee={[me.LINES]:2,[me.TRIANGLES]:3,[me.LINE_STRIP]:1}[c];for(const be of U.get()){const ye=be.vaos||(be.vaos={});(ye[E]||(ye[E]=new ba)).bind(r,this,C,le?le.getPaintVertexBuffers():[],k,be.vertexOffset,he||[]),me.drawElements(c,be.primitiveLength*ee,me.UNSIGNED_SHORT,be.primitiveOffset*ee*2)}}}function el(p,r){const c=Math.pow(2,r.tileID.overscaledZ),a=r.tileSize*Math.pow(2,p.transform.tileZoom)/c,f=a*(r.tileID.canonical.x+r.tileID.wrap*c),d=a*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture.size,u_tile_units_to_pixels:1/Nt(r,1,p.transform.tileZoom),u_pixel_coord_upper:[f>>16,d>>16],u_pixel_coord_lower:[65535&f,65535&d]}}const Gs=u.create(),Ms=(p,r,c,a,f,d,y,x,E,C,k)=>{const U=r.style.light,Y=U.properties.get("position"),oe=[Y.x,Y.y,Y.z],le=u.create$1();"viewport"===U.properties.get("anchor")&&(u.fromRotation(le,-r.transform.angle),u.transformMat3(oe,oe,le));const he=U.properties.get("color"),me=r.transform,ee={u_matrix:p,u_lightpos:oe,u_lightintensity:U.properties.get("intensity"),u_lightcolor:[he.r,he.g,he.b],u_vertical_gradient:+c,u_opacity:a,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Gs,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_ao:f,u_edge_radius:d};return"globe"===me.projection.name&&(ee.u_tile_id=[y.canonical.x,y.canonical.y,1<<y.canonical.z],ee.u_zoom_transition=E,ee.u_inv_rot_matrix=k,ee.u_merc_center=C,ee.u_up_dir=me.projection.upVector(new u.CanonicalTileID(0,0,0),C[0]*u.EXTENT,C[1]*u.EXTENT),ee.u_height_lift=x),ee},Po=(p,r,c,a,f,d,y,x,E,C,k,U)=>{const Y=Ms(p,r,c,a,f,d,y,E,C,k,U),oe={u_height_factor:-Math.pow(2,y.overscaledZ)/x.tileSize/8};return u.extend(Y,el(r,x),oe)},nr=p=>({u_matrix:p}),ua=(p,r,c)=>u.extend(nr(p),el(r,c)),Qs=(p,r)=>({u_matrix:p,u_world:r}),ea=(p,r,c,a)=>u.extend(ua(p,r,c),{u_world:a}),Ti=u.create(),Ea=(p,r,c,a,f,d)=>{const y=p.transform,x="globe"===y.projection.name;let E;if("map"===d.paint.get("circle-pitch-alignment"))if(x){const k=u.globePixelsToTileUnits(y.zoom,r.canonical)*y._pixelsPerMercatorPixel;E=Float32Array.from([k,0,0,k])}else E=y.calculatePixelsToTileUnitsMatrix(c);else E=new Float32Array([y.pixelsToGLUnits[0],0,0,y.pixelsToGLUnits[1]]);const C={u_camera_to_center_distance:y.cameraToCenterDistance,u_matrix:p.translatePosMatrix(r.projMatrix,c,d.paint.get("circle-translate"),d.paint.get("circle-translate-anchor")),u_device_pixel_ratio:u.exported.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:Ti,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(x){C.u_inv_rot_matrix=a,C.u_merc_center=f,C.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],C.u_zoom_transition=u.globeToMercatorTransition(y.zoom);const k=f[0]*u.EXTENT,U=f[1]*u.EXTENT;C.u_up_dir=y.projection.upVector(new u.CanonicalTileID(0,0,0),k,U)}return C},hs=p=>{const r=[];return"map"===p.paint.get("circle-pitch-alignment")&&r.push("PITCH_WITH_MAP"),"map"===p.paint.get("circle-pitch-scale")&&r.push("SCALE_WITH_MAP"),r},ha=(p,r,c,a)=>{const f=u.EXTENT/c.tileSize;return{u_matrix:p,u_camera_to_center_distance:r.getCameraToCenterDistance(a),u_extrude_scale:[r.pixelsToGLUnits[0]/f,r.pixelsToGLUnits[1]/f]}},Ta=(p,r,c=1)=>({u_matrix:p,u_color:r,u_overlay:0,u_overlay_scale:c}),zt=u.create(),sr=(p,r,c,a,f,d,y)=>{const x=p.transform,E="globe"===x.projection.name,C=E?u.globePixelsToTileUnits(x.zoom,r.canonical)*x._pixelsPerMercatorPixel:Nt(c,1,d),k={u_matrix:r.projMatrix,u_extrude_scale:C,u_intensity:y,u_inv_rot_matrix:zt,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(E){k.u_inv_rot_matrix=a,k.u_merc_center=f,k.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],k.u_zoom_transition=u.globeToMercatorTransition(x.zoom);const U=f[0]*u.EXTENT,Y=f[1]*u.EXTENT;k.u_up_dir=x.projection.upVector(new u.CanonicalTileID(0,0,0),U,Y)}return k},da=(p,r,c,a,f,d,y)=>{const x=p.transform,E=x.calculatePixelsToTileUnitsMatrix(r);return{u_matrix:tl(p,r,c,a),u_pixels_to_tile_units:E,u_device_pixel_ratio:d,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:f,u_texsize:Is(c)?r.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:Oi(r,p.transform),u_alpha_discard_threshold:0,u_trim_offset:y}},Na=(p,r,c,a,f)=>{const d=p.transform;return{u_matrix:tl(p,r,c,a),u_texsize:r.imageAtlasTexture.size,u_pixels_to_tile_units:d.calculatePixelsToTileUnitsMatrix(r),u_device_pixel_ratio:f,u_image:0,u_tile_units_to_pixels:Oi(r,d),u_units_to_pixels:[1/d.pixelsToGLUnits[0],1/d.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Oi(p,r){return 1/Nt(p,1,r.tileZoom)}function tl(p,r,c,a){return p.translatePosMatrix(a||r.tileID.projMatrix,r,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}function Is(p){const r=p.paint.get("line-dasharray").value;return r.value||"constant"!==r.kind}const Ro=(p,r,c,a,f,d)=>{return{u_matrix:p,u_tl_parent:r,u_scale_parent:c,u_fade_t:a.mix,u_opacity:a.opacity*f.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:f.paint.get("raster-brightness-min"),u_brightness_high:f.paint.get("raster-brightness-max"),u_saturation_factor:(x=f.paint.get("raster-saturation"),x>0?1-1/(1.001-x):-x),u_contrast_factor:(y=f.paint.get("raster-contrast"),y>0?1/(1-y):1+y),u_spin_weights:Yo(f.paint.get("raster-hue-rotate")),u_perspective_transform:d};var y,x};function Yo(p){p*=Math.PI/180;const r=Math.sin(p),c=Math.cos(p);return[(2*c+1)/3,(-Math.sqrt(3)*r-c+1)/3,(Math.sqrt(3)*r-c+1)/3]}const ko=u.create(),ds=(p,r,c,a,f,d,y,x,E,C,k,U,Y,oe,le,he)=>{const me=f.transform,ee={u_is_size_zoom_constant:+("constant"===p||"source"===p),u_is_size_feature_constant:+("constant"===p||"camera"===p),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:me.cameraToCenterDistance,u_rotate_symbol:+c,u_aspect_ratio:me.width/me.height,u_fade_change:f.options.fadeDuration?f.symbolFadeChange:1,u_matrix:d,u_label_plane_matrix:y,u_coord_matrix:x,u_is_text:+E,u_pitch_with_map:+a,u_texsize:C,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ko,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:ko,u_up_vector:[0,-1,0]};return"globe"===he.name&&(ee.u_tile_id=[k.canonical.x,k.canonical.y,1<<k.canonical.z],ee.u_zoom_transition=U,ee.u_inv_rot_matrix=oe,ee.u_merc_center=Y,ee.u_camera_forward=me._camera.forward(),ee.u_ecef_origin=u.globeECEFOrigin(me.globeMatrix,k.toUnwrapped()),ee.u_tile_matrix=Float32Array.from(me.globeMatrix),ee.u_up_vector=le),ee},nl=(p,r,c,a,f,d,y,x,E,C,k,U,Y,oe,le,he,me)=>u.extend(ds(p,r,c,a,f,d,y,x,E,C,U,Y,oe,le,he,me),{u_gamma_scale:a?f.transform.cameraToCenterDistance*Math.cos(f.terrain?0:f.transform._pitch):1,u_device_pixel_ratio:u.exported.devicePixelRatio,u_is_halo:+k}),Da=(p,r,c,a,f,d,y,x,E,C,k,U,Y,oe,le,he)=>u.extend(nl(p,r,c,a,f,d,y,x,!0,E,!0,k,U,Y,oe,le,he),{u_texsize_icon:C,u_texture_icon:1}),Zi=(p,r,c)=>({u_matrix:p,u_opacity:r,u_color:c}),_o=(p,r,c,a,f)=>u.extend(function(d,y,x){const E=y.imageManager.getPattern(d.toString()),{width:C,height:k}=y.imageManager.getPixelSize(),U=Math.pow(2,x.tileID.overscaledZ),Y=x.tileSize*Math.pow(2,y.transform.tileZoom)/U,oe=Y*(x.tileID.canonical.x+x.tileID.wrap*U),le=Y*x.tileID.canonical.y;return{u_image:0,u_pattern_tl:E.tl,u_pattern_br:E.br,u_texsize:[C,k],u_pattern_size:E.displaySize,u_tile_units_to_pixels:1/Nt(x,1,y.transform.tileZoom),u_pixel_coord_upper:[oe>>16,le>>16],u_pixel_coord_lower:[65535&oe,65535&le]}}(a,c,f),{u_matrix:p,u_opacity:r}),pl={fillExtrusion:p=>({u_matrix:new u.UniformMatrix4f(p),u_lightpos:new u.Uniform3f(p),u_lightintensity:new u.Uniform1f(p),u_lightcolor:new u.Uniform3f(p),u_vertical_gradient:new u.Uniform1f(p),u_opacity:new u.Uniform1f(p),u_edge_radius:new u.Uniform1f(p),u_ao:new u.Uniform2f(p),u_tile_id:new u.Uniform3f(p),u_zoom_transition:new u.Uniform1f(p),u_inv_rot_matrix:new u.UniformMatrix4f(p),u_merc_center:new u.Uniform2f(p),u_up_dir:new u.Uniform3f(p),u_height_lift:new u.Uniform1f(p)}),fillExtrusionPattern:p=>({u_matrix:new u.UniformMatrix4f(p),u_lightpos:new u.Uniform3f(p),u_lightintensity:new u.Uniform1f(p),u_lightcolor:new u.Uniform3f(p),u_vertical_gradient:new u.Uniform1f(p),u_height_factor:new u.Uniform1f(p),u_edge_radius:new u.Uniform1f(p),u_ao:new u.Uniform2f(p),u_tile_id:new u.Uniform3f(p),u_zoom_transition:new u.Uniform1f(p),u_inv_rot_matrix:new u.UniformMatrix4f(p),u_merc_center:new u.Uniform2f(p),u_up_dir:new u.Uniform3f(p),u_height_lift:new u.Uniform1f(p),u_image:new u.Uniform1i(p),u_texsize:new u.Uniform2f(p),u_pixel_coord_upper:new u.Uniform2f(p),u_pixel_coord_lower:new u.Uniform2f(p),u_tile_units_to_pixels:new u.Uniform1f(p),u_opacity:new u.Uniform1f(p)}),fill:p=>({u_matrix:new u.UniformMatrix4f(p)}),fillPattern:p=>({u_matrix:new u.UniformMatrix4f(p),u_image:new u.Uniform1i(p),u_texsize:new u.Uniform2f(p),u_pixel_coord_upper:new u.Uniform2f(p),u_pixel_coord_lower:new u.Uniform2f(p),u_tile_units_to_pixels:new u.Uniform1f(p)}),fillOutline:p=>({u_matrix:new u.UniformMatrix4f(p),u_world:new u.Uniform2f(p)}),fillOutlinePattern:p=>({u_matrix:new u.UniformMatrix4f(p),u_world:new u.Uniform2f(p),u_image:new u.Uniform1i(p),u_texsize:new u.Uniform2f(p),u_pixel_coord_upper:new u.Uniform2f(p),u_pixel_coord_lower:new u.Uniform2f(p),u_tile_units_to_pixels:new u.Uniform1f(p)}),circle:p=>({u_camera_to_center_distance:new u.Uniform1f(p),u_extrude_scale:new u.UniformMatrix2f(p),u_device_pixel_ratio:new u.Uniform1f(p),u_matrix:new u.UniformMatrix4f(p),u_inv_rot_matrix:new u.UniformMatrix4f(p),u_merc_center:new u.Uniform2f(p),u_tile_id:new u.Uniform3f(p),u_zoom_transition:new u.Uniform1f(p),u_up_dir:new u.Uniform3f(p)}),collisionBox:p=>({u_matrix:new u.UniformMatrix4f(p),u_camera_to_center_distance:new u.Uniform1f(p),u_extrude_scale:new u.Uniform2f(p)}),collisionCircle:p=>({u_matrix:new u.UniformMatrix4f(p),u_inv_matrix:new u.UniformMatrix4f(p),u_camera_to_center_distance:new u.Uniform1f(p),u_viewport_size:new u.Uniform2f(p)}),debug:p=>({u_color:new u.UniformColor(p),u_matrix:new u.UniformMatrix4f(p),u_overlay:new u.Uniform1i(p),u_overlay_scale:new u.Uniform1f(p)}),clippingMask:p=>({u_matrix:new u.UniformMatrix4f(p)}),heatmap:p=>({u_extrude_scale:new u.Uniform1f(p),u_intensity:new u.Uniform1f(p),u_matrix:new u.UniformMatrix4f(p),u_inv_rot_matrix:new u.UniformMatrix4f(p),u_merc_center:new u.Uniform2f(p),u_tile_id:new u.Uniform3f(p),u_zoom_transition:new u.Uniform1f(p),u_up_dir:new u.Uniform3f(p)}),heatmapTexture:p=>({u_image:new u.Uniform1i(p),u_color_ramp:new u.Uniform1i(p),u_opacity:new u.Uniform1f(p)}),hillshade:p=>({u_matrix:new u.UniformMatrix4f(p),u_image:new u.Uniform1i(p),u_latrange:new u.Uniform2f(p),u_light:new u.Uniform2f(p),u_shadow:new u.UniformColor(p),u_highlight:new u.UniformColor(p),u_accent:new u.UniformColor(p)}),hillshadePrepare:p=>({u_matrix:new u.UniformMatrix4f(p),u_image:new u.Uniform1i(p),u_dimension:new u.Uniform2f(p),u_zoom:new u.Uniform1f(p),u_unpack:new u.Uniform4f(p)}),line:p=>({u_matrix:new u.UniformMatrix4f(p),u_pixels_to_tile_units:new u.UniformMatrix2f(p),u_device_pixel_ratio:new u.Uniform1f(p),u_units_to_pixels:new u.Uniform2f(p),u_dash_image:new u.Uniform1i(p),u_gradient_image:new u.Uniform1i(p),u_image_height:new u.Uniform1f(p),u_texsize:new u.Uniform2f(p),u_tile_units_to_pixels:new u.Uniform1f(p),u_alpha_discard_threshold:new u.Uniform1f(p),u_trim_offset:new u.Uniform2f(p)}),linePattern:p=>({u_matrix:new u.UniformMatrix4f(p),u_texsize:new u.Uniform2f(p),u_pixels_to_tile_units:new u.UniformMatrix2f(p),u_device_pixel_ratio:new u.Uniform1f(p),u_image:new u.Uniform1i(p),u_units_to_pixels:new u.Uniform2f(p),u_tile_units_to_pixels:new u.Uniform1f(p),u_alpha_discard_threshold:new u.Uniform1f(p)}),raster:p=>({u_matrix:new u.UniformMatrix4f(p),u_tl_parent:new u.Uniform2f(p),u_scale_parent:new u.Uniform1f(p),u_fade_t:new u.Uniform1f(p),u_opacity:new u.Uniform1f(p),u_image0:new u.Uniform1i(p),u_image1:new u.Uniform1i(p),u_brightness_low:new u.Uniform1f(p),u_brightness_high:new u.Uniform1f(p),u_saturation_factor:new u.Uniform1f(p),u_contrast_factor:new u.Uniform1f(p),u_spin_weights:new u.Uniform3f(p),u_perspective_transform:new u.Uniform2f(p)}),symbolIcon:p=>({u_is_size_zoom_constant:new u.Uniform1i(p),u_is_size_feature_constant:new u.Uniform1i(p),u_size_t:new u.Uniform1f(p),u_size:new u.Uniform1f(p),u_camera_to_center_distance:new u.Uniform1f(p),u_rotate_symbol:new u.Uniform1i(p),u_aspect_ratio:new u.Uniform1f(p),u_fade_change:new u.Uniform1f(p),u_matrix:new u.UniformMatrix4f(p),u_label_plane_matrix:new u.UniformMatrix4f(p),u_coord_matrix:new u.UniformMatrix4f(p),u_is_text:new u.Uniform1i(p),u_pitch_with_map:new u.Uniform1i(p),u_texsize:new u.Uniform2f(p),u_tile_id:new u.Uniform3f(p),u_zoom_transition:new u.Uniform1f(p),u_inv_rot_matrix:new u.UniformMatrix4f(p),u_merc_center:new u.Uniform2f(p),u_camera_forward:new u.Uniform3f(p),u_tile_matrix:new u.UniformMatrix4f(p),u_up_vector:new u.Uniform3f(p),u_ecef_origin:new u.Uniform3f(p),u_texture:new u.Uniform1i(p)}),symbolSDF:p=>({u_is_size_zoom_constant:new u.Uniform1i(p),u_is_size_feature_constant:new u.Uniform1i(p),u_size_t:new u.Uniform1f(p),u_size:new u.Uniform1f(p),u_camera_to_center_distance:new u.Uniform1f(p),u_rotate_symbol:new u.Uniform1i(p),u_aspect_ratio:new u.Uniform1f(p),u_fade_change:new u.Uniform1f(p),u_matrix:new u.UniformMatrix4f(p),u_label_plane_matrix:new u.UniformMatrix4f(p),u_coord_matrix:new u.UniformMatrix4f(p),u_is_text:new u.Uniform1i(p),u_pitch_with_map:new u.Uniform1i(p),u_texsize:new u.Uniform2f(p),u_texture:new u.Uniform1i(p),u_gamma_scale:new u.Uniform1f(p),u_device_pixel_ratio:new u.Uniform1f(p),u_tile_id:new u.Uniform3f(p),u_zoom_transition:new u.Uniform1f(p),u_inv_rot_matrix:new u.UniformMatrix4f(p),u_merc_center:new u.Uniform2f(p),u_camera_forward:new u.Uniform3f(p),u_tile_matrix:new u.UniformMatrix4f(p),u_up_vector:new u.Uniform3f(p),u_ecef_origin:new u.Uniform3f(p),u_is_halo:new u.Uniform1i(p)}),symbolTextAndIcon:p=>({u_is_size_zoom_constant:new u.Uniform1i(p),u_is_size_feature_constant:new u.Uniform1i(p),u_size_t:new u.Uniform1f(p),u_size:new u.Uniform1f(p),u_camera_to_center_distance:new u.Uniform1f(p),u_rotate_symbol:new u.Uniform1i(p),u_aspect_ratio:new u.Uniform1f(p),u_fade_change:new u.Uniform1f(p),u_matrix:new u.UniformMatrix4f(p),u_label_plane_matrix:new u.UniformMatrix4f(p),u_coord_matrix:new u.UniformMatrix4f(p),u_is_text:new u.Uniform1i(p),u_pitch_with_map:new u.Uniform1i(p),u_texsize:new u.Uniform2f(p),u_texsize_icon:new u.Uniform2f(p),u_texture:new u.Uniform1i(p),u_texture_icon:new u.Uniform1i(p),u_gamma_scale:new u.Uniform1f(p),u_device_pixel_ratio:new u.Uniform1f(p),u_is_halo:new u.Uniform1i(p)}),background:p=>({u_matrix:new u.UniformMatrix4f(p),u_opacity:new u.Uniform1f(p),u_color:new u.UniformColor(p)}),backgroundPattern:p=>({u_matrix:new u.UniformMatrix4f(p),u_opacity:new u.Uniform1f(p),u_image:new u.Uniform1i(p),u_pattern_tl:new u.Uniform2f(p),u_pattern_br:new u.Uniform2f(p),u_texsize:new u.Uniform2f(p),u_pattern_size:new u.Uniform2f(p),u_pixel_coord_upper:new u.Uniform2f(p),u_pixel_coord_lower:new u.Uniform2f(p),u_tile_units_to_pixels:new u.Uniform1f(p)}),terrainRaster:Ao,terrainDepth:Ao,skybox:p=>({u_matrix:new u.UniformMatrix4f(p),u_sun_direction:new u.Uniform3f(p),u_cubemap:new u.Uniform1i(p),u_opacity:new u.Uniform1f(p),u_temporal_offset:new u.Uniform1f(p)}),skyboxGradient:p=>({u_matrix:new u.UniformMatrix4f(p),u_color_ramp:new u.Uniform1i(p),u_center_direction:new u.Uniform3f(p),u_radius:new u.Uniform1f(p),u_opacity:new u.Uniform1f(p),u_temporal_offset:new u.Uniform1f(p)}),skyboxCapture:p=>({u_matrix_3f:new u.UniformMatrix3f(p),u_sun_direction:new u.Uniform3f(p),u_sun_intensity:new u.Uniform1f(p),u_color_tint_r:new u.Uniform4f(p),u_color_tint_m:new u.Uniform4f(p),u_luminance:new u.Uniform1f(p)}),globeRaster:p=>({u_proj_matrix:new u.UniformMatrix4f(p),u_globe_matrix:new u.UniformMatrix4f(p),u_normalize_matrix:new u.UniformMatrix4f(p),u_merc_matrix:new u.UniformMatrix4f(p),u_zoom_transition:new u.Uniform1f(p),u_merc_center:new u.Uniform2f(p),u_image0:new u.Uniform1i(p),u_grid_matrix:new u.UniformMatrix3f(p),u_skirt_height:new u.Uniform1f(p),u_frustum_tl:new u.Uniform3f(p),u_frustum_tr:new u.Uniform3f(p),u_frustum_br:new u.Uniform3f(p),u_frustum_bl:new u.Uniform3f(p),u_globe_pos:new u.Uniform3f(p),u_globe_radius:new u.Uniform1f(p),u_viewport:new u.Uniform2f(p)}),globeAtmosphere:p=>({u_frustum_tl:new u.Uniform3f(p),u_frustum_tr:new u.Uniform3f(p),u_frustum_br:new u.Uniform3f(p),u_frustum_bl:new u.Uniform3f(p),u_horizon:new u.Uniform1f(p),u_transition:new u.Uniform1f(p),u_fadeout_range:new u.Uniform1f(p),u_color:new u.Uniform4f(p),u_high_color:new u.Uniform4f(p),u_space_color:new u.Uniform4f(p),u_star_intensity:new u.Uniform1f(p),u_star_density:new u.Uniform1f(p),u_star_size:new u.Uniform1f(p),u_temporal_offset:new u.Uniform1f(p),u_horizon_angle:new u.Uniform1f(p),u_rotation_matrix:new u.UniformMatrix4f(p)})};let Uo;function Q(p,r,c,a,f,d,y){const x=p.context,E=x.gl,C=p.transform,k=p.useProgram("collisionBox"),U=[];let Y=0,oe=0;for(let De=0;De<a.length;De++){const ke=a[De],Ae=r.getTile(ke),Be=Ae.getBucket(c);if(!Be)continue;const He=Bs(ke,Be,C);let Xe=He;0===f[0]&&0===f[1]||(Xe=p.translatePosMatrix(He,Ae,f,d));const Qe=y?Be.textCollisionBox:Be.iconCollisionBox,qt=Be.collisionCircleArray;if(qt.length>0){const qe=u.create(),Tt=Xe;u.mul(qe,Be.placementInvProjMatrix,C.glCoordMatrix),u.mul(qe,qe,Be.placementViewportMatrix),U.push({circleArray:qt,circleOffset:oe,transform:Tt,invTransform:qe,projection:Be.getProjection()}),Y+=qt.length/4,oe=Y}Qe&&(p.terrain&&p.terrain.setupElevationDraw(Ae,k),k.draw(x,E.LINES,u.DepthMode.disabled,u.StencilMode.disabled,p.colorModeForRenderPass(),u.CullFaceMode.disabled,ha(Xe,C,Ae,Be.getProjection()),c.id,Qe.layoutVertexBuffer,Qe.indexBuffer,Qe.segments,null,C.zoom,null,[Qe.collisionVertexBuffer,Qe.collisionVertexBufferExt]))}if(!y||!U.length)return;const le=p.useProgram("collisionCircle"),he=new u.StructArrayLayout2f1f2i16;he.resize(4*Y),he._trim();let me=0;for(const De of U)for(let ke=0;ke<De.circleArray.length/4;ke++){const Ae=4*ke,Be=De.circleArray[Ae+0],He=De.circleArray[Ae+1],Xe=De.circleArray[Ae+2],Qe=De.circleArray[Ae+3];he.emplace(me++,Be,He,Xe,Qe,0),he.emplace(me++,Be,He,Xe,Qe,1),he.emplace(me++,Be,He,Xe,Qe,2),he.emplace(me++,Be,He,Xe,Qe,3)}(!Uo||Uo.length<2*Y)&&(Uo=function(De){const ke=2*De,Ae=new u.StructArrayLayout3ui6;Ae.resize(ke),Ae._trim();for(let Be=0;Be<ke;Be++){const He=6*Be;Ae.uint16[He+0]=4*Be+0,Ae.uint16[He+1]=4*Be+1,Ae.uint16[He+2]=4*Be+2,Ae.uint16[He+3]=4*Be+2,Ae.uint16[He+4]=4*Be+3,Ae.uint16[He+5]=4*Be+0}return Ae}(Y));const ee=x.createIndexBuffer(Uo,!0),be=x.createVertexBuffer(he,u.collisionCircleLayout.members,!0);for(const De of U){const ke={u_matrix:De.transform,u_inv_matrix:De.invTransform,u_camera_to_center_distance:(ye=C).getCameraToCenterDistance(De.projection),u_viewport_size:[ye.width,ye.height]};le.draw(x,E.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,p.colorModeForRenderPass(),u.CullFaceMode.disabled,ke,c.id,be,ee,u.SegmentVector.simpleSegment(0,2*De.circleOffset,De.circleArray.length,De.circleArray.length/2),null,C.zoom)}var ye;be.destroy(),ee.destroy()}const M=u.create();function P({width:p,height:r,anchor:c,textOffset:a,textScale:f},d){const{horizontalAlign:y,verticalAlign:x}=u.getAnchorAlignment(c),E=-(y-.5)*p,C=-(x-.5)*r,k=u.evaluateVariableOffset(c,a);return new u.pointGeometry((E/f+k[0])*d,(C/f+k[1])*d)}function j(p,r,c,a,f,d,y,x,E,C,k){const U=p.text.placedSymbolArray,Y=p.text.dynamicLayoutVertexArray,oe=p.icon.dynamicLayoutVertexArray,le={},he=p.getProjection(),me=Qi(x,he,d),ee=d.elevation,be=he.upVectorScale(x.canonical,d.center.lat,d.worldSize).metersToTile;Y.clear();for(let ye=0;ye<U.length;ye++){const De=U.get(ye),{tileAnchorX:ke,tileAnchorY:Ae,numGlyphs:Be}=De,Xe=De.hidden||!De.crossTileID||p.allowVerticalPlacement&&!De.placedOrientation?null:a[De.crossTileID];if(Xe){let Qe=0,qt=0,qe=0;if(ee){const Mn=ee?ee.getAtTileOffset(x,ke,Ae):0,[_r,wn,pn]=he.upVector(x.canonical,ke,Ae);Qe=Mn*_r*be,qt=Mn*wn*be,qe=Mn*pn*be}let[Tt,at,kt,Ye]=Zt(De.projectedAnchorX+Qe,De.projectedAnchorY+qt,De.projectedAnchorZ+qe,c?me:y);const Ge=On(d.getCameraToCenterDistance(he),Ye);let it=f.evaluateSizeForFeature(p.textSizeData,C,De)*Ge/u.ONE_EM;c&&(it*=p.tilePixelRatio/E);const Ct=P(Xe,it);c?(({x:Tt,y:at,z:kt}=he.projectTilePoint(ke+Ct.x,Ae+Ct.y,x.canonical)),[Tt,at,kt]=Zt(Tt+Qe,at+qt,kt+qe,y)):(r&&Ct._rotate(-d.angle),Tt+=Ct.x,at+=Ct.y,kt=0);const Bt=p.allowVerticalPlacement&&De.placedOrientation===u.WritingMode.vertical?Math.PI/2:0;for(let Mn=0;Mn<Be;Mn++)u.addDynamicAttributes(Y,Tt,at,kt,Bt);k&&De.associatedIconIndex>=0&&(le[De.associatedIconIndex]={x:Tt,y:at,z:kt,angle:Bt})}else Cr(Be,Y)}if(k){oe.clear();const ye=p.icon.placedSymbolArray;for(let De=0;De<ye.length;De++){const ke=ye.get(De),{numGlyphs:Ae}=ke,Be=le[De];if(ke.hidden||!Be)Cr(Ae,oe);else{const{x:He,y:Xe,z:Qe,angle:qt}=Be;for(let qe=0;qe<Ae;qe++)u.addDynamicAttributes(oe,He,Xe,Qe,qt)}}p.icon.dynamicLayoutVertexBuffer.updateData(oe)}p.text.dynamicLayoutVertexBuffer.updateData(Y)}function te(p,r,c){return c.iconsInText&&r?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function ge(p,r,c,a,f,d,y,x,E,C,k,U){const Y=p.context,oe=Y.gl,le=p.transform,he="map"===x,me="map"===E,ee=he&&"point"!==c.layout.get("symbol-placement"),be=he&&!me&&!ee,ye=void 0!==c.layout.get("symbol-sort-key").constantOr(1);let De=!1;const ke=p.depthModeForSublayer(0,u.DepthMode.ReadOnly),Ae=[u.mercatorXfromLng(le.center.lng),u.mercatorYfromLat(le.center.lat)],Be=c.layout.get("text-variable-anchor"),He="globe"===le.projection.name,Xe=[],Qe=[0,-1,0];let qt=Qe;!He&&!le.mercatorFromTransition||he||(qt=function(qe){const Tt=qe._camera.getWorldToCamera(qe.worldSize,1),at=u.multiply([],Tt,qe.globeMatrix);u.invert(at,at);const kt=[0,0,0],Ye=[0,1,0,0];return u.transformMat4$1(Ye,Ye,at),kt[0]=Ye[0],kt[1]=Ye[1],kt[2]=Ye[2],u.normalize(kt,kt),kt}(le));for(const qe of a){const Tt=r.getTile(qe),at=Tt.getBucket(c);if(!at||"mercator"===at.projection.name&&He)continue;const kt=f?at.text:at.icon;if(!kt||at.fullyClipped||!kt.segments.get().length)continue;const Ye=kt.programConfigurations.get(c.id),Ge=f||at.sdfIcons,it=f?at.textSizeData:at.iconSizeData,Ct=me||0!==le.pitch,Bt=u.evaluateSizeForZoom(it,le.zoom);let Mn,_r,wn,pn,Rn=[0,0],Ir=null;if(f)_r=Tt.glyphAtlasTexture,wn=oe.LINEAR,Mn=Tt.glyphAtlasTexture.size,at.iconsInText&&(Rn=Tt.imageAtlasTexture.size,Ir=Tt.imageAtlasTexture,pn=Ct||p.options.rotating||p.options.zooming||"composite"===it.kind||"camera"===it.kind?oe.LINEAR:oe.NEAREST);else{const pa=1!==c.layout.get("icon-size").constantOr(0)||at.iconsNeedLinear;_r=Tt.imageAtlasTexture,wn=Ge||p.options.rotating||p.options.zooming||pa||Ct?oe.LINEAR:oe.NEAREST,Mn=Tt.imageAtlasTexture.size}const zn="globe"===at.projection.name,ti=zn?qt:Qe,pi=zn?u.globeToMercatorTransition(le.zoom):0,mi=Qi(qe,at.getProjection(),le),Si=le.calculatePixelsToTileUnitsMatrix(Tt),Oo=Gr(mi,Tt.tileID.canonical,me,he,le,at.getProjection(),Si),ks=p.terrain&&me&&ee?u.invert(u.create(),Oo):M,ll=is(mi,Tt.tileID.canonical,me,he,le,at.getProjection(),Si),jl=Be&&at.hasTextData(),Gi="none"!==c.layout.get("icon-text-fit")&&jl&&at.hasIconData();if(ee){const pa=le.elevation,Ma=pa?pa.getAtTileOffsetFunc(qe,le.center.lat,le.worldSize,at.getProjection()):null,bl=Ks(mi,Tt.tileID.canonical,me,he,le,at.getProjection(),Si);Gn(at,mi,p,f,bl,ll,me,C,Ma,qe)}const Mi=ee||f&&Be||Gi,Yr=p.translatePosMatrix(mi,Tt,d,y),ho=Mi?M:Oo,ps=p.translatePosMatrix(ll,Tt,d,y,!0),Ei=at.getProjection().createInversionMatrix(le,qe.canonical),ms=[];p.terrainRenderModeElevated()&&me&&ms.push("PITCH_WITH_MAP_TERRAIN"),zn&&ms.push("PROJECTION_GLOBE_VIEW"),Mi&&ms.push("PROJECTED_POS_ON_VIEWPORT");const gs=Ge&&0!==c.paint.get(f?"text-halo-width":"icon-halo-width").constantOr(1);let wl;wl=Ge?at.iconsInText?Da(it.kind,Bt,be,me,p,Yr,ho,ps,Mn,Rn,qe,pi,Ae,Ei,ti,at.getProjection()):nl(it.kind,Bt,be,me,p,Yr,ho,ps,f,Mn,!0,qe,pi,Ae,Ei,ti,at.getProjection()):ds(it.kind,Bt,be,me,p,Yr,ho,ps,f,Mn,qe,pi,Ae,Ei,ti,at.getProjection());const qs={program:p.useProgram(te(Ge,f,at),Ye,ms),buffers:kt,uniformValues:wl,atlasTexture:_r,atlasTextureIcon:Ir,atlasInterpolation:wn,atlasInterpolationIcon:pn,isSDF:Ge,hasHalo:gs,tile:Tt,labelPlaneMatrixInv:ks};if(ye&&at.canOverlap){De=!0;const pa=kt.segments.get();for(const Ma of pa)Xe.push({segments:new u.SegmentVector([Ma]),sortKey:Ma.sortKey,state:qs})}else Xe.push({segments:kt.segments,sortKey:0,state:qs})}De&&Xe.sort((qe,Tt)=>qe.sortKey-Tt.sortKey);for(const qe of Xe){const Tt=qe.state;if(p.terrain&&p.terrain.setupElevationDraw(Tt.tile,Tt.program,{useDepthForOcclusion:!He,labelPlaneMatrixInv:Tt.labelPlaneMatrixInv}),Y.activeTexture.set(oe.TEXTURE0),Tt.atlasTexture.bind(Tt.atlasInterpolation,oe.CLAMP_TO_EDGE),Tt.atlasTextureIcon&&(Y.activeTexture.set(oe.TEXTURE1),Tt.atlasTextureIcon&&Tt.atlasTextureIcon.bind(Tt.atlasInterpolationIcon,oe.CLAMP_TO_EDGE)),Tt.isSDF){const at=Tt.uniformValues;Tt.hasHalo&&(at.u_is_halo=1,Oe(Tt.buffers,qe.segments,c,p,Tt.program,ke,k,U,at)),at.u_is_halo=0}Oe(Tt.buffers,qe.segments,c,p,Tt.program,ke,k,U,Tt.uniformValues)}}function Oe(p,r,c,a,f,d,y,x,E){const C=a.context,k=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.globeExtVertexBuffer];f.draw(C,C.gl.TRIANGLES,d,y,x,u.CullFaceMode.disabled,E,c.id,p.layoutVertexBuffer,p.indexBuffer,r,c.paint,a.transform.zoom,p.programConfigurations.get(c.id),k)}function ze(p,r,c,a,f,d,y){const x=p.context.gl,E=c.paint.get("fill-pattern"),C=E&&E.constantOr(1);let k,U,Y,oe,le;y?(U=C&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",k=x.LINES):(U=C?"fillPattern":"fill",k=x.TRIANGLES);for(const he of a){const me=r.getTile(he);if(C&&!me.patternsLoaded())continue;const ee=me.getBucket(c);if(!ee)continue;p.prepareDrawTile();const be=ee.programConfigurations.get(c.id),ye=p.useProgram(U,be);C&&(p.context.activeTexture.set(x.TEXTURE0),me.imageAtlasTexture.bind(x.LINEAR,x.CLAMP_TO_EDGE),be.updatePaintBuffers());const De=E.constantOr(null);if(De&&me.imageAtlas){const Ae=me.imageAtlas.patternPositions[De.toString()];Ae&&be.setConstantPatternPositions(Ae)}const ke=p.translatePosMatrix(he.projMatrix,me,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(y){oe=ee.indexBuffer2,le=ee.segments2;const Ae=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[x.drawingBufferWidth,x.drawingBufferHeight];Y="fillOutlinePattern"===U&&C?ea(ke,p,me,Ae):Qs(ke,Ae)}else oe=ee.indexBuffer,le=ee.segments,Y=C?ua(ke,p,me):nr(ke);p.prepareDrawProgram(p.context,ye,he.toUnwrapped()),ye.draw(p.context,k,f,p.stencilModeForClipping(he),d,u.CullFaceMode.disabled,Y,c.id,ee.layoutVertexBuffer,oe,le,c.paint,p.transform.zoom,be)}}function et(p,r,c,a,f,d,y){const x=p.context,E=x.gl,C=p.transform,k=c.paint.get("fill-extrusion-pattern"),U=k.constantOr(1),Y=c.paint.get("fill-extrusion-opacity"),oe=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),c.paint.get("fill-extrusion-ambient-occlusion-radius")],le=c.layout.get("fill-extrusion-edge-radius"),he="globe"===C.projection.name?u.fillExtrusionHeightLift():0,me="globe"===C.projection.name,ee=me?u.globeToMercatorTransition(C.zoom):0,be=[u.mercatorXfromLng(C.center.lng),u.mercatorYfromLat(C.center.lat)],ye=[];me&&ye.push("PROJECTION_GLOBE_VIEW"),oe[0]>0&&ye.push("FAUX_AO");for(const De of a){const ke=r.getTile(De),Ae=ke.getBucket(c);if(!Ae||Ae.projection.name!==C.projection.name)continue;const Be=Ae.programConfigurations.get(c.id),He=p.useProgram(U?"fillExtrusionPattern":"fillExtrusion",Be,ye);if(p.terrain){const kt=p.terrain;if(p.style.terrainSetForDrapingOnly())kt.setupElevationDraw(ke,He,{useMeterToDem:!0});else{if(!Ae.enableTerrain)continue;if(kt.setupElevationDraw(ke,He,{useMeterToDem:!0}),xt(x,r,De,Ae,c,kt),!Ae.centroidVertexBuffer){const Ye=He.attributes.a_centroid_pos;void 0!==Ye&&E.vertexAttrib2f(Ye,0,0)}}}U&&(p.context.activeTexture.set(E.TEXTURE0),ke.imageAtlasTexture.bind(E.LINEAR,E.CLAMP_TO_EDGE),Be.updatePaintBuffers());const Xe=k.constantOr(null);if(Xe&&ke.imageAtlas){const kt=ke.imageAtlas.patternPositions[Xe.toString()];kt&&Be.setConstantPatternPositions(kt)}const Qe=p.translatePosMatrix(De.projMatrix,ke,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),qt=C.projection.createInversionMatrix(C,De.canonical),qe=c.paint.get("fill-extrusion-vertical-gradient"),Tt=U?Po(Qe,p,qe,Y,oe,le,De,ke,he,ee,be,qt):Ms(Qe,p,qe,Y,oe,le,De,he,ee,be,qt);p.prepareDrawProgram(x,He,De.toUnwrapped());const at=[];p.terrain&&at.push(Ae.centroidVertexBuffer),me&&at.push(Ae.layoutVertexExtBuffer),He.draw(x,x.gl.TRIANGLES,f,d,y,u.CullFaceMode.backCCW,Tt,c.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,c.paint,p.transform.zoom,Be,at)}}function xt(p,r,c,a,f,d){const y=[ee=>{let be=ee.canonical.x-1,ye=ee.wrap;return be<0&&(be=(1<<ee.canonical.z)-1,ye--),new u.OverscaledTileID(ee.overscaledZ,ye,ee.canonical.z,be,ee.canonical.y)},ee=>{let be=ee.canonical.x+1,ye=ee.wrap;return be===1<<ee.canonical.z&&(be=0,ye++),new u.OverscaledTileID(ee.overscaledZ,ye,ee.canonical.z,be,ee.canonical.y)},ee=>new u.OverscaledTileID(ee.overscaledZ,ee.wrap,ee.canonical.z,ee.canonical.x,(0===ee.canonical.y?1<<ee.canonical.z:ee.canonical.y)-1),ee=>new u.OverscaledTileID(ee.overscaledZ,ee.wrap,ee.canonical.z,ee.canonical.x,ee.canonical.y===(1<<ee.canonical.z)-1?0:ee.canonical.y+1)],x=ee=>{const be=r.getSource().minzoom,ye=ke=>{const Ae=r.getTileByID(ke);if(Ae&&Ae.hasData())return Ae.getBucket(f)},De=[0,-1,1];for(const ke of De){if(ee.overscaledZ+ke<be)continue;const Ae=ye(ee.calculateScaledKey(ee.overscaledZ+ke));if(Ae)return Ae}},E=[0,0,0],C=(ee,be)=>(E[0]=Math.min(ee.min.y,be.min.y),E[1]=Math.max(ee.max.y,be.max.y),E[2]=u.EXTENT-be.min.x>ee.max.x?be.min.x-u.EXTENT:ee.max.x,E),k=(ee,be)=>(E[0]=Math.min(ee.min.x,be.min.x),E[1]=Math.max(ee.max.x,be.max.x),E[2]=u.EXTENT-be.min.y>ee.max.y?be.min.y-u.EXTENT:ee.max.y,E),U=[(ee,be)=>C(ee,be),(ee,be)=>C(be,ee),(ee,be)=>k(ee,be),(ee,be)=>k(be,ee)],Y=new u.pointGeometry(0,0);let oe,le,he;const me=(ee,be,ye,De,ke)=>{const Ae=[[De?ye:ee,De?ee:ye,0],[De?ye:be,De?be:ye,0]],Be=ke<0?u.EXTENT+ke:ke,He=[De?Be:(ee+be)/2,De?(ee+be)/2:Be,0];return 0===ye&&ke<0||0!==ye&&ke>0?d.getForTilePoints(he,[He],!0,le):Ae.push(He),d.getForTilePoints(c,Ae,!0,oe),Math.max(Ae[0][2],Ae[1][2],He[2])/d.exaggeration()};for(let ee=0;ee<4;ee++){const be=(ee<2?1:5)-ee,ye=a.borders[ee];if(0===ye.length)continue;const De=he=y[ee](c),ke=x(De);if(!(ke&&ke instanceof u.FillExtrusionBucket&&ke.enableTerrain)||a.borderDoneWithNeighborZ[ee]===ke.canonical.z&&ke.borderDoneWithNeighborZ[be]===a.canonical.z||(le=d.findDEMTileFor(De),!le||!le.dem))continue;if(!oe){const Xe=d.findDEMTileFor(c);if(!Xe||!Xe.dem)return;oe=Xe}const Ae=ke.borders[be];let Be=0;const He=ke.borderDoneWithNeighborZ[be]!==a.canonical.z;if(a.canonical.z===ke.canonical.z){for(let Xe=0;Xe<ye.length;Xe++){const Qe=a.featuresOnBorder[ye[Xe]],qt=Qe.borders[ee];let qe;for(;Be<Ae.length&&(qe=ke.featuresOnBorder[Ae[Be]],!(qe.borders[be][1]>qt[0]+3));)He&&ke.encodeCentroid(void 0,qe,!1),Be++;if(qe&&Be<Ae.length){const Tt=Be;let at=0;for(;!(qe.borders[be][0]>qt[1]-3)&&(at++,++Be!==Ae.length);)qe=ke.featuresOnBorder[Ae[Be]];if(qe=ke.featuresOnBorder[Ae[Tt]],Qe.intersectsCount()>1||qe.intersectsCount()>1||1!==at){1!==at&&(Be=Tt),a.encodeCentroid(void 0,Qe,!1),He&&ke.encodeCentroid(void 0,qe,!1);continue}const kt=U[ee](Qe,qe),Ye=ee%2?u.EXTENT-1:0;Y.x=me(kt[0],Math.min(u.EXTENT-1,kt[1]),Ye,ee<2,kt[2]),Y.y=0,a.encodeCentroid(Y,Qe,!1),He&&ke.encodeCentroid(Y,qe,!1)}else a.encodeCentroid(void 0,Qe,!1)}a.borderDoneWithNeighborZ[ee]=ke.canonical.z,a.needsCentroidUpdate=!0,He&&(ke.borderDoneWithNeighborZ[be]=a.canonical.z,ke.needsCentroidUpdate=!0)}else{for(const Xe of ye)a.encodeCentroid(void 0,a.featuresOnBorder[Xe],!1);if(He){for(const Xe of Ae)ke.encodeCentroid(void 0,ke.featuresOnBorder[Xe],!1);ke.borderDoneWithNeighborZ[be]=a.canonical.z,ke.needsCentroidUpdate=!0}a.borderDoneWithNeighborZ[ee]=ke.canonical.z,a.needsCentroidUpdate=!0}}(a.needsCentroidUpdate||!a.centroidVertexBuffer&&0!==a.centroidVertexArray.length)&&a.uploadCentroid(p)}const gn=new u.Color(1,0,0,1),_n=new u.Color(0,1,0,1),cr=new u.Color(0,0,1,1),ur=new u.Color(1,0,1,1),Un=new u.Color(0,1,1,1);function Zn(p,r,c){const a=p.context,f=p.transform,d=a.gl,y="globe"===f.projection.name,x=y?["PROJECTION_GLOBE_VIEW"]:null;let E=c.projMatrix;if(y&&u.globeToMercatorTransition(f.zoom)>0){const Qe=u.transitionTileAABBinECEF(c.canonical,f),qt=u.globeDenormalizeECEF(Qe);E=u.multiply(new Float32Array(16),f.globeMatrix,qt),u.multiply(E,f.projMatrix,E)}const C=p.useProgram("debug",null,x),k=r.getTileByID(c.key);p.terrain&&p.terrain.setupElevationDraw(k,C);const U=u.DepthMode.disabled,Y=u.StencilMode.disabled,oe=p.colorModeForRenderPass();a.activeTexture.set(d.TEXTURE0),p.emptyTexture.bind(d.LINEAR,d.CLAMP_TO_EDGE),y?k._makeGlobeTileDebugBuffers(p.context,f):k._makeDebugTileBoundsBuffers(p.context,f.projection);const he=k._tileDebugBuffer||p.debugBuffer,me=k._tileDebugIndexBuffer||p.debugIndexBuffer,ee=k._tileDebugSegments||p.debugSegments;C.draw(a,d.LINE_STRIP,U,Y,oe,u.CullFaceMode.disabled,Ta(E,u.Color.red),"$debug",he,me,ee,null,null,null,[k._globeTileDebugBorderBuffer]);const be=k.latestRawTileData,ye=Math.floor((be&&be.byteLength||0)/1024),De=r.getTile(c).tileSize,ke=512/Math.min(De,512)*(c.overscaledZ/f.zoom)*.5;let Ae=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Ae+=` => ${c.overscaledZ}`),Ae+=` ${ye}kb`,function(Qe,qt){Qe.initDebugOverlayCanvas();const qe=Qe.debugOverlayCanvas,Tt=Qe.context.gl,at=Qe.debugOverlayCanvas.getContext("2d");at.clearRect(0,0,qe.width,qe.height),at.shadowColor="white",at.shadowBlur=2,at.lineWidth=1.5,at.strokeStyle="white",at.textBaseline="top",at.font="bold 36px Open Sans, sans-serif",at.fillText(qt,5,5),at.strokeText(qt,5,5),Qe.debugOverlayTexture.update(qe),Qe.debugOverlayTexture.bind(Tt.LINEAR,Tt.CLAMP_TO_EDGE)}(p,Ae);const Be=k._tileDebugTextBuffer||p.debugBuffer,He=k._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,Xe=k._tileDebugTextSegments||p.debugSegments;C.draw(a,d.TRIANGLES,U,Y,u.ColorMode.alphaBlended,u.CullFaceMode.disabled,Ta(E,u.Color.transparent,ke),"$debug",Be,He,Xe,null,null,null,[k._globeTileDebugTextBuffer])}function fr(p,r,c,a){oi(p,0,r+c/2,p.transform.width,c,a)}function Fr(p,r,c,a){oi(p,r-c/2,0,c,p.transform.height,a)}function oi(p,r,c,a,f,d){const y=p.context,x=y.gl;x.enable(x.SCISSOR_TEST),x.scissor(r*u.exported.devicePixelRatio,c*u.exported.devicePixelRatio,a*u.exported.devicePixelRatio,f*u.exported.devicePixelRatio),y.clear({color:d}),x.disable(x.SCISSOR_TEST)}const Rr=u.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Kr}=Rr;function br(p,r,c,a){p.emplaceBack(r,c,a)}class Xi{constructor(r){this.vertexArray=new u.StructArrayLayout3f12,this.indices=new u.StructArrayLayout3ui6,br(this.vertexArray,-1,-1,1),br(this.vertexArray,1,-1,1),br(this.vertexArray,-1,1,1),br(this.vertexArray,1,1,1),br(this.vertexArray,-1,-1,-1),br(this.vertexArray,1,-1,-1),br(this.vertexArray,-1,1,-1),br(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,Kr),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=u.SegmentVector.simpleSegment(0,0,36,12)}}function Hn(p,r,c,a,f,d){const y=p.gl,x=r.paint.get("sky-atmosphere-color"),E=r.paint.get("sky-atmosphere-halo-color"),C=r.paint.get("sky-atmosphere-sun-intensity"),k={u_matrix_3f:u.fromMat4(u.create$1(),a),u_sun_direction:f,u_sun_intensity:C,u_color_tint_r:[(le=x).r,le.g,le.b,le.a],u_color_tint_m:[(he=E).r,he.g,he.b,he.a],u_luminance:5e-5};var le,he;y.framebufferTexture2D(y.FRAMEBUFFER,y.COLOR_ATTACHMENT0,y.TEXTURE_CUBE_MAP_POSITIVE_X+d,r.skyboxTexture,0),c.draw(p,y.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,u.ColorMode.unblended,u.CullFaceMode.frontCW,k,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const jo=u.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class fs{constructor(r){const c=new u.StructArrayLayout5f20;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const a=new u.StructArrayLayout3ui6;a.emplaceBack(0,1,2),a.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(c,jo.members),this.indexBuffer=r.createIndexBuffer(a),this.segments=u.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const F={symbol:function(p,r,c,a,f){if("translucent"!==p.renderPass)return;const d=u.StencilMode.disabled,y=p.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(x,E,C,k,U,Y,oe){const le=E.transform,he="map"===U,me="map"===Y;for(const ee of x){const be=k.getTile(ee),ye=be.getBucket(C);if(!ye||!ye.text||!ye.text.segments.get().length)continue;const De=u.evaluateSizeForZoom(ye.textSizeData,le.zoom),ke=Qi(ee,ye.getProjection(),le),Ae=le.calculatePixelsToTileUnitsMatrix(be),Be=Gr(ke,be.tileID.canonical,me,he,le,ye.getProjection(),Ae),He="none"!==C.layout.get("icon-text-fit")&&ye.hasIconData();if(De){const Xe=Math.pow(2,le.zoom-be.tileID.overscaledZ);j(ye,he,me,oe,u.symbolSize,le,Be,ee,Xe,De,He)}}}(a,p,c,r,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),f),0!==c.paint.get("icon-opacity").constantOr(1)&&ge(p,r,c,a,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),d,y),0!==c.paint.get("text-opacity").constantOr(1)&&ge(p,r,c,a,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),d,y),r.map.showCollisionBoxes&&(Q(p,r,c,a,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Q(p,r,c,a,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(p,r,c,a){if("translucent"!==p.renderPass)return;const f=c.paint.get("circle-opacity"),d=c.paint.get("circle-stroke-width"),y=c.paint.get("circle-stroke-opacity"),x=void 0!==c.layout.get("circle-sort-key").constantOr(1);if(0===f.constantOr(1)&&(0===d.constantOr(1)||0===y.constantOr(1)))return;const E=p.context,C=E.gl,k=p.transform,U=p.depthModeForSublayer(0,u.DepthMode.ReadOnly),Y=u.StencilMode.disabled,oe=p.colorModeForRenderPass(),le="globe"===k.projection.name,he=[u.mercatorXfromLng(k.center.lng),u.mercatorYfromLat(k.center.lat)],me=[];for(let be=0;be<a.length;be++){const ye=a[be],De=r.getTile(ye),ke=De.getBucket(c);if(!ke||ke.projection.name!==k.projection.name)continue;const Ae=ke.programConfigurations.get(c.id),Be=hs(c);le&&Be.push("PROJECTION_GLOBE_VIEW");const He=p.useProgram("circle",Ae,Be),Xe=ke.layoutVertexBuffer,Qe=ke.globeExtVertexBuffer,qt=ke.indexBuffer,qe=k.projection.createInversionMatrix(k,ye.canonical),Tt={programConfiguration:Ae,program:He,layoutVertexBuffer:Xe,globeExtVertexBuffer:Qe,indexBuffer:qt,uniformValues:Ea(p,ye,De,qe,he,c),tile:De};if(x){const at=ke.segments.get();for(const kt of at)me.push({segments:new u.SegmentVector([kt]),sortKey:kt.sortKey,state:Tt})}else me.push({segments:ke.segments,sortKey:0,state:Tt})}x&&me.sort((be,ye)=>be.sortKey-ye.sortKey);const ee={useDepthForOcclusion:!le};for(const be of me){const{programConfiguration:ye,program:De,layoutVertexBuffer:ke,globeExtVertexBuffer:Ae,indexBuffer:Be,uniformValues:He,tile:Xe}=be.state,Qe=be.segments;p.terrain&&p.terrain.setupElevationDraw(Xe,De,ee),p.prepareDrawProgram(E,De,Xe.tileID.toUnwrapped()),De.draw(E,C.TRIANGLES,U,Y,oe,u.CullFaceMode.disabled,He,c.id,ke,Be,Qe,c.paint,k.zoom,ye,[Ae])}},heatmap:function(p,r,c,a){if(0!==c.paint.get("heatmap-opacity"))if("offscreen"===p.renderPass){const f=p.context,d=f.gl,y=u.StencilMode.disabled,x=new u.ColorMode([d.ONE,d.ONE],u.Color.transparent,[!0,!0,!0,!0]);(function(oe,le,he,me){const ee=oe.gl,be=le.width*me,ye=le.height*me;oe.activeTexture.set(ee.TEXTURE1),oe.viewport.set([0,0,be,ye]);let De=he.heatmapFbo;if(!De||De&&(De.width!==be||De.height!==ye)){De&&De.destroy();const ke=ee.createTexture();ee.bindTexture(ee.TEXTURE_2D,ke),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_2D,ee.TEXTURE_MAG_FILTER,ee.LINEAR),De=he.heatmapFbo=oe.createFramebuffer(be,ye,!1),function(Ae,Be,He,Xe,Qe,qt){const qe=Ae.gl;qe.texImage2D(qe.TEXTURE_2D,0,Ae.isWebGL2&&Ae.extRenderToTextureHalfFloat?qe.RGBA16F:qe.RGBA,Qe,qt,0,qe.RGBA,Ae.extRenderToTextureHalfFloat?Ae.isWebGL2?qe.HALF_FLOAT:Ae.extTextureHalfFloat.HALF_FLOAT_OES:qe.UNSIGNED_BYTE,null),Xe.colorAttachment.set(He)}(oe,0,ke,De,be,ye)}else ee.bindTexture(ee.TEXTURE_2D,De.colorAttachment.get()),oe.bindFramebuffer.set(De.framebuffer)})(f,p,c,"globe"===p.transform.projection.name?.5:.25),f.clear({color:u.Color.transparent});const E=p.transform,C="globe"===E.projection.name,k=C?["PROJECTION_GLOBE_VIEW"]:null,U=C?u.CullFaceMode.frontCCW:u.CullFaceMode.disabled,Y=[u.mercatorXfromLng(E.center.lng),u.mercatorYfromLat(E.center.lat)];for(let oe=0;oe<a.length;oe++){const le=a[oe];if(r.hasRenderableParent(le))continue;const he=r.getTile(le),me=he.getBucket(c);if(!me||me.projection.name!==E.projection.name)continue;const ee=me.programConfigurations.get(c.id),be=p.useProgram("heatmap",ee,k),{zoom:ye}=p.transform;p.terrain&&p.terrain.setupElevationDraw(he,be),p.prepareDrawProgram(f,be,le.toUnwrapped());const De=E.projection.createInversionMatrix(E,le.canonical);be.draw(f,d.TRIANGLES,u.DepthMode.disabled,y,x,U,sr(p,le,he,De,Y,ye,c.paint.get("heatmap-intensity")),c.id,me.layoutVertexBuffer,me.indexBuffer,me.segments,c.paint,p.transform.zoom,ee,C?[me.globeExtVertexBuffer]:null)}f.viewport.set([0,0,p.width,p.height])}else"translucent"===p.renderPass&&(p.context.setColorMode(p.colorModeForRenderPass()),function(f,d){const y=f.context,x=y.gl,E=d.heatmapFbo;if(!E)return;y.activeTexture.set(x.TEXTURE0),x.bindTexture(x.TEXTURE_2D,E.colorAttachment.get()),y.activeTexture.set(x.TEXTURE1);let C=d.colorRampTexture;C||(C=d.colorRampTexture=new u.Texture(y,d.colorRamp,x.RGBA)),C.bind(x.LINEAR,x.CLAMP_TO_EDGE),f.useProgram("heatmapTexture").draw(y,x.TRIANGLES,u.DepthMode.disabled,u.StencilMode.disabled,f.colorModeForRenderPass(),u.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:d.paint.get("heatmap-opacity")},d.id,f.viewportBuffer,f.quadTriangleIndexBuffer,f.viewportSegments,d.paint,f.transform.zoom)}(p,c))},line:function(p,r,c,a){if("translucent"!==p.renderPass)return;const f=c.paint.get("line-opacity"),d=c.paint.get("line-width");if(0===f.constantOr(1)||0===d.constantOr(1))return;const y=p.depthModeForSublayer(0,u.DepthMode.ReadOnly),x=p.colorModeForRenderPass(),E=p.terrain&&p.terrain.renderingToTexture?1:u.exported.devicePixelRatio,C=c.paint.get("line-dasharray"),k=C.constantOr(1),U=c.layout.get("line-cap"),Y=c.paint.get("line-pattern"),oe=Y.constantOr(1),le=c.paint.get("line-gradient"),he=oe?"linePattern":"line",me=p.context,ee=me.gl,be=(De=>{const ke=[];Is(De)&&ke.push("RENDER_LINE_DASH"),De.paint.get("line-gradient")&&ke.push("RENDER_LINE_GRADIENT");const Ae=De.paint.get("line-trim-offset");0===Ae[0]&&0===Ae[1]||ke.push("RENDER_LINE_TRIM_OFFSET");const Be=De.paint.get("line-pattern").constantOr(1),He=1!==De.paint.get("line-opacity").constantOr(1);return!Be&&He&&ke.push("RENDER_LINE_ALPHA_DISCARD"),ke})(c);let ye=be.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(ye=!1);for(const De of a){const ke=r.getTile(De);if(oe&&!ke.patternsLoaded())continue;const Ae=ke.getBucket(c);if(!Ae)continue;p.prepareDrawTile();const Be=Ae.programConfigurations.get(c.id),He=p.useProgram(he,Be,be),Xe=Y.constantOr(null);if(Xe&&ke.imageAtlas){const Ge=ke.imageAtlas.patternPositions[Xe.toString()];Ge&&Be.setConstantPatternPositions(Ge)}const Qe=C.constantOr(null),qt=U.constantOr(null);if(!oe&&Qe&&qt&&ke.lineAtlas){const Ge=ke.lineAtlas.getDash(Qe,qt);Ge&&Be.setConstantPatternPositions(Ge)}let[qe,Tt]=c.paint.get("line-trim-offset");("round"===qt||"square"===qt)&&qe!==Tt&&(0===qe&&(qe-=1),1===Tt&&(Tt+=1));const at=p.terrain?De.projMatrix:null,kt=oe?Na(p,ke,c,at,E):da(p,ke,c,at,Ae.lineClipsArray.length,E,[qe,Tt]);if(le){const Ge=Ae.gradients[c.id];let it=Ge.texture;if(c.gradientVersion!==Ge.version){let Ct=256;if(c.stepInterpolant){const Bt=r.getSource().maxzoom,Mn=De.canonical.z===Bt?Math.ceil(1<<p.transform.maxZoom-De.canonical.z):1;Ct=u.clamp(u.nextPowerOfTwo(Ae.maxLineLength/u.EXTENT*1024*Mn),256,me.maxTextureSize)}Ge.gradient=u.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Ct,image:Ge.gradient||void 0,clips:Ae.lineClipsArray}),Ge.texture?Ge.texture.update(Ge.gradient):Ge.texture=new u.Texture(me,Ge.gradient,ee.RGBA),Ge.version=c.gradientVersion,it=Ge.texture}me.activeTexture.set(ee.TEXTURE1),it.bind(c.stepInterpolant?ee.NEAREST:ee.LINEAR,ee.CLAMP_TO_EDGE)}k&&(me.activeTexture.set(ee.TEXTURE0),ke.lineAtlasTexture.bind(ee.LINEAR,ee.REPEAT),Be.updatePaintBuffers()),oe&&(me.activeTexture.set(ee.TEXTURE0),ke.imageAtlasTexture.bind(ee.LINEAR,ee.CLAMP_TO_EDGE),Be.updatePaintBuffers()),p.prepareDrawProgram(me,He,De.toUnwrapped());const Ye=Ge=>{He.draw(me,ee.TRIANGLES,y,Ge,x,u.CullFaceMode.disabled,kt,c.id,Ae.layoutVertexBuffer,Ae.indexBuffer,Ae.segments,c.paint,p.transform.zoom,Be,[Ae.layoutVertexBuffer2])};if(ye){const Ge=p.stencilModeForClipping(De).ref;0===Ge&&p.terrain&&me.clear({stencil:0});const it={func:ee.EQUAL,mask:255};kt.u_alpha_discard_threshold=.8,Ye(new u.StencilMode(it,Ge,255,ee.KEEP,ee.KEEP,ee.INVERT)),kt.u_alpha_discard_threshold=0,Ye(new u.StencilMode(it,Ge,255,ee.KEEP,ee.KEEP,ee.KEEP))}else Ye(p.stencilModeForClipping(De))}ye&&(p.resetStencilClippingMasks(),p.terrain&&me.clear({stencil:0}))},fill:function(p,r,c,a){const f=c.paint.get("fill-color"),d=c.paint.get("fill-opacity");if(0===d.constantOr(1))return;const y=p.colorModeForRenderPass(),x=c.paint.get("fill-pattern"),E=p.opaquePassEnabledForLayer()&&!x.constantOr(1)&&1===f.constantOr(u.Color.transparent).a&&1===d.constantOr(0)?"opaque":"translucent";if(p.renderPass===E){const C=p.depthModeForSublayer(1,"opaque"===p.renderPass?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly);ze(p,r,c,a,C,y,!1)}if("translucent"===p.renderPass&&c.paint.get("fill-antialias")){const C=p.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,u.DepthMode.ReadOnly);ze(p,r,c,a,C,y,!0)}},"fill-extrusion":function(p,r,c,a){const f=c.paint.get("fill-extrusion-opacity");if(0!==f&&"translucent"===p.renderPass){const d=new u.DepthMode(p.context.gl.LEQUAL,u.DepthMode.ReadWrite,p.depthRangeFor3D);if(1!==f||c.paint.get("fill-extrusion-pattern").constantOr(1))et(p,r,c,a,d,u.StencilMode.disabled,u.ColorMode.disabled),et(p,r,c,a,d,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const y=p.colorModeForRenderPass();et(p,r,c,a,d,u.StencilMode.disabled,y)}}},hillshade:function(p,r,c,a){if("offscreen"!==p.renderPass&&"translucent"!==p.renderPass)return;const f=p.context,d=p.depthModeForSublayer(0,u.DepthMode.ReadOnly),y=p.colorModeForRenderPass(),x=p.terrain&&p.terrain.renderingToTexture,[E,C]="translucent"!==p.renderPass||x?[{},a]:p.stencilConfigForOverlap(a);for(const k of C){const U=r.getTile(k);if(U.needsHillshadePrepare&&"offscreen"===p.renderPass)qi(p,U,c,d,u.StencilMode.disabled,y);else if("translucent"===p.renderPass){const Y=x&&p.terrain?p.terrain.stencilModeForRTTOverlap(k):E[k.overscaledZ];Zo(p,k,U,c,d,Y,y)}}f.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,r,c,a,f,d){if("translucent"!==p.renderPass||0===c.paint.get("raster-opacity")||!a.length)return;const y=p.context,x=y.gl,E=r.getSource(),C=p.useProgram("raster"),k=p.colorModeForRenderPass(),U=p.terrain&&p.terrain.renderingToTexture,[Y,oe]=E instanceof ne||U?[{},a]:p.stencilConfigForOverlap(a),le=oe[oe.length-1].overscaledZ,he=!p.options.moving;for(const me of oe){const ee=U?u.DepthMode.disabled:p.depthModeForSublayer(me.overscaledZ-le,1===c.paint.get("raster-opacity")?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly,x.LESS),be=me.toUnwrapped(),ye=r.getTile(me);if(U&&(!ye||!ye.hasData()))continue;const De=U?me.projMatrix:p.transform.calculateProjMatrix(be,he),ke=p.terrain&&U?p.terrain.stencilModeForRTTOverlap(me):Y[me.overscaledZ],Ae=d?0:c.paint.get("raster-fade-duration");ye.registerFadeDuration(Ae);const Be=r.findLoadedParent(me,0),He=Xo(ye,Be,r,p.transform,Ae);let Xe,Qe;p.terrain&&p.terrain.prepareDrawTile();const qt="nearest"===c.paint.get("raster-resampling")?x.NEAREST:x.LINEAR;y.activeTexture.set(x.TEXTURE0),ye.texture.bind(qt,x.CLAMP_TO_EDGE),y.activeTexture.set(x.TEXTURE1),Be?(Be.texture.bind(qt,x.CLAMP_TO_EDGE),Xe=Math.pow(2,Be.tileID.overscaledZ-ye.tileID.overscaledZ),Qe=[ye.tileID.canonical.x*Xe%1,ye.tileID.canonical.y*Xe%1]):ye.texture.bind(qt,x.CLAMP_TO_EDGE);const qe=Ro(De,Qe||[0,0],Xe||1,He,c,E instanceof ne?E.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(y,C,be),E instanceof ne)E.boundsBuffer&&E.boundsSegments&&C.draw(y,x.TRIANGLES,ee,u.StencilMode.disabled,k,u.CullFaceMode.disabled,qe,c.id,E.boundsBuffer,p.quadTriangleIndexBuffer,E.boundsSegments);else{const{tileBoundsBuffer:Tt,tileBoundsIndexBuffer:at,tileBoundsSegments:kt}=p.getTileBoundsBuffers(ye);C.draw(y,x.TRIANGLES,ee,ke,k,u.CullFaceMode.disabled,qe,c.id,Tt,at,kt)}}p.resetStencilClippingMasks()},background:function(p,r,c,a){const f=c.paint.get("background-color"),d=c.paint.get("background-opacity");if(0===d)return;const y=p.context,x=y.gl,E=p.transform,C=E.tileSize,k=c.paint.get("background-pattern");if(p.isPatternMissing(k))return;const U=!k&&1===f.a&&1===d&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==U)return;const Y=u.StencilMode.disabled,oe=p.depthModeForSublayer(0,"opaque"===U?u.DepthMode.ReadWrite:u.DepthMode.ReadOnly),le=p.colorModeForRenderPass(),he=p.useProgram(k?"backgroundPattern":"background");let me,ee=a;ee||(me=p.getBackgroundTiles(),ee=Object.values(me).map(be=>be.tileID)),k&&(y.activeTexture.set(x.TEXTURE0),p.imageManager.bind(p.context));for(const be of ee){const ye=be.toUnwrapped(),De=a?be.projMatrix:p.transform.calculateProjMatrix(ye);p.prepareDrawTile();const ke=r?r.getTile(be):me?me[be.key]:new u.Tile(be,C,E.zoom,p),Ae=k?_o(De,d,p,k,{tileID:be,tileSize:C}):Zi(De,d,f);p.prepareDrawProgram(y,he,ye);const{tileBoundsBuffer:Be,tileBoundsIndexBuffer:He,tileBoundsSegments:Xe}=p.getTileBoundsBuffers(ke);he.draw(y,x.TRIANGLES,oe,Y,le,u.CullFaceMode.disabled,Ae,c.id,Be,He,Xe)}},sky:function(p,r,c){const a=p.transform,f="mercator"===a.projection.name||"globe"===a.projection.name?1:u.smoothstep(7,8,a.zoom),d=c.paint.get("sky-opacity")*f;if(0===d)return;const y=p.context,x=c.paint.get("sky-type"),E=new u.DepthMode(y.gl.LEQUAL,u.DepthMode.ReadOnly,[0,1]),C=p.frameCounter/1e3%1;"atmosphere"===x?"offscreen"===p.renderPass?c.needsSkyboxCapture(p)&&(function(k,U,Y,oe){const le=k.context,he=le.gl;let me=U.skyboxFbo;if(!me){me=U.skyboxFbo=le.createFramebuffer(32,32,!1),U.skyboxGeometry=new Xi(le),U.skyboxTexture=le.gl.createTexture(),he.bindTexture(he.TEXTURE_CUBE_MAP,U.skyboxTexture),he.texParameteri(he.TEXTURE_CUBE_MAP,he.TEXTURE_WRAP_S,he.CLAMP_TO_EDGE),he.texParameteri(he.TEXTURE_CUBE_MAP,he.TEXTURE_WRAP_T,he.CLAMP_TO_EDGE),he.texParameteri(he.TEXTURE_CUBE_MAP,he.TEXTURE_MIN_FILTER,he.LINEAR),he.texParameteri(he.TEXTURE_CUBE_MAP,he.TEXTURE_MAG_FILTER,he.LINEAR);for(let De=0;De<6;++De)he.texImage2D(he.TEXTURE_CUBE_MAP_POSITIVE_X+De,0,he.RGBA,32,32,0,he.RGBA,he.UNSIGNED_BYTE,null)}le.bindFramebuffer.set(me.framebuffer),le.viewport.set([0,0,32,32]);const ee=U.getCenter(k,!0),be=k.useProgram("skyboxCapture"),ye=new Float64Array(16);u.identity(ye),u.rotateY(ye,ye,.5*-Math.PI),Hn(le,U,be,ye,ee,0),u.identity(ye),u.rotateY(ye,ye,.5*Math.PI),Hn(le,U,be,ye,ee,1),u.identity(ye),u.rotateX(ye,ye,.5*-Math.PI),Hn(le,U,be,ye,ee,2),u.identity(ye),u.rotateX(ye,ye,.5*Math.PI),Hn(le,U,be,ye,ee,3),u.identity(ye),Hn(le,U,be,ye,ee,4),u.identity(ye),u.rotateY(ye,ye,Math.PI),Hn(le,U,be,ye,ee,5),le.viewport.set([0,0,k.width,k.height])}(p,c),c.markSkyboxValid(p)):"sky"===p.renderPass&&function(k,U,Y,oe,le){const he=k.context,me=he.gl,ee=k.transform,be=k.useProgram("skybox");he.activeTexture.set(me.TEXTURE0),me.bindTexture(me.TEXTURE_CUBE_MAP,U.skyboxTexture);const ye={u_matrix:ee.skyboxMatrix,u_sun_direction:U.getCenter(k,!1),u_cubemap:0,u_opacity:oe,u_temporal_offset:le};k.prepareDrawProgram(he,be),be.draw(he,me.TRIANGLES,Y,u.StencilMode.disabled,k.colorModeForRenderPass(),u.CullFaceMode.backCW,ye,"skybox",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(p,c,E,d,C):"gradient"===x&&"sky"===p.renderPass&&function(k,U,Y,oe,le){const he=k.context,me=he.gl,ee=k.transform,be=k.useProgram("skyboxGradient");U.skyboxGeometry||(U.skyboxGeometry=new Xi(he)),he.activeTexture.set(me.TEXTURE0);let ye=U.colorRampTexture;ye||(ye=U.colorRampTexture=new u.Texture(he,U.colorRamp,me.RGBA)),ye.bind(me.LINEAR,me.CLAMP_TO_EDGE);const De=(ke=ee.skyboxMatrix,Ae=U.getCenter(k,!1),Be=U.paint.get("sky-gradient-radius"),He=oe,Xe=le,{u_matrix:ke,u_color_ramp:0,u_center_direction:Ae,u_radius:u.degToRad(Be),u_opacity:He,u_temporal_offset:Xe});var ke,Ae,Be,He,Xe;k.prepareDrawProgram(he,be),be.draw(he,me.TRIANGLES,Y,u.StencilMode.disabled,k.colorModeForRenderPass(),u.CullFaceMode.backCW,De,"skyboxGradient",U.skyboxGeometry.vertexBuffer,U.skyboxGeometry.indexBuffer,U.skyboxGeometry.segment)}(p,c,E,d,C)},debug:function(p,r,c){for(let a=0;a<c.length;a++)Zn(p,r,c[a])},custom:function(p,r,c,a){const f=p.context,d=c.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||"offscreen"===p.renderPass)&&c.isLayerDraped()){if("offscreen"===p.renderPass){const y=d.prerender;if(y){if(p.setCustomLayerDefaults(),f.setColorMode(p.colorModeForRenderPass()),"globe"===p.transform.projection.name){const x=p.transform.pointMerc;y.call(d,f.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),u.globeToMercatorTransition(p.transform.zoom),[x.x,x.y],p.transform.pixelsPerMeterRatio)}else y.call(d,f.gl,p.transform.customLayerMatrix());f.setDirty(),p.setBaseState()}}else if("translucent"===p.renderPass){if(p.terrain&&p.terrain.renderingToTexture){const x=d.renderToTile;if(x){const E=a[0].canonical,C=new u.MercatorCoordinate(E.x+a[0].wrap*(1<<E.z),E.y,E.z);f.setDepthMode(u.DepthMode.disabled),f.setStencilMode(u.StencilMode.disabled),f.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),x.call(d,f.gl,C),f.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),f.setColorMode(p.colorModeForRenderPass()),f.setStencilMode(u.StencilMode.disabled);const y="3d"===d.renderingMode?new u.DepthMode(p.context.gl.LEQUAL,u.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,u.DepthMode.ReadOnly);if(f.setDepthMode(y),"globe"===p.transform.projection.name){const x=p.transform.pointMerc;d.render(f.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),u.globeToMercatorTransition(p.transform.zoom),[x.x,x.y],p.transform.pixelsPerMeterRatio)}else d.render(f.gl,p.transform.customLayerMatrix());f.setDirty(),p.setBaseState(),f.bindFramebuffer.set(null)}}else u.warnOnce("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")}};class X{constructor(r,c,a=!1){this.context=new ue(r,a),this.transform=c,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=u.SourceCache.maxUnderzooming+u.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ja,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(r,c){const a=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(a||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new us(this,r));const f=this._terrain;this.transform.elevation=a?f:null,f.update(r,this.transform,c)}_updateFog(r){const c=r.fog;if(!c||"globe"===this.transform.projection.name||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[a,f]=c.getFovAdjustedRange(this.transform._fov);if(a>f)return void(this.transform.fogCullDistSq=null);const d=a+.78*(f-a);this.transform.fogCullDistSq=d*d}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(r,c){if(this.width=r*u.exported.devicePixelRatio,this.height=c*u.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const a of this.style.order)this.style._layers[a].resize()}setup(){const r=this.context,c=new u.StructArrayLayout2i4;c.emplaceBack(0,0),c.emplaceBack(u.EXTENT,0),c.emplaceBack(0,u.EXTENT),c.emplaceBack(u.EXTENT,u.EXTENT),this.tileExtentBuffer=r.createVertexBuffer(c,u.posAttributes.members),this.tileExtentSegments=u.SegmentVector.simpleSegment(0,0,4,2);const a=new u.StructArrayLayout2i4;a.emplaceBack(0,0),a.emplaceBack(u.EXTENT,0),a.emplaceBack(0,u.EXTENT),a.emplaceBack(u.EXTENT,u.EXTENT),this.debugBuffer=r.createVertexBuffer(a,u.posAttributes.members),this.debugSegments=u.SegmentVector.simpleSegment(0,0,4,5);const f=new u.StructArrayLayout2i4;f.emplaceBack(-1,-1),f.emplaceBack(1,-1),f.emplaceBack(-1,1),f.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(f,u.posAttributes.members),this.viewportSegments=u.SegmentVector.simpleSegment(0,0,4,2);const d=new u.StructArrayLayout4i8;d.emplaceBack(0,0,0,0),d.emplaceBack(u.EXTENT,0,u.EXTENT,0),d.emplaceBack(0,u.EXTENT,0,u.EXTENT),d.emplaceBack(u.EXTENT,u.EXTENT,u.EXTENT,u.EXTENT),this.mercatorBoundsBuffer=r.createVertexBuffer(d,u.boundsAttributes.members),this.mercatorBoundsSegments=u.SegmentVector.simpleSegment(0,0,4,2);const y=new u.StructArrayLayout3ui6;y.emplaceBack(0,1,2),y.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(y);const x=new u.StructArrayLayout1ui2;for(const C of[0,1,3,2,0])x.emplaceBack(C);this.debugIndexBuffer=r.createIndexBuffer(x),this.emptyTexture=new u.Texture(r,new u.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA),this.identityMat=u.create();const E=this.context.gl;this.stencilClearMode=new u.StencilMode({func:E.ALWAYS,mask:0},0,255,E.ZERO,E.ZERO,E.ZERO),this.loadTimeStamps.push(u.window.performance.now()),this.atmosphereBuffer=new fs(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context,c=r.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(r,c.TRIANGLES,u.DepthMode.disabled,this.stencilClearMode,u.ColorMode.disabled,u.CullFaceMode.disabled,Jn(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,c,a){if(!c||this.currentStencilSource===c.id||!r.isTileClipped()||!a||0===a.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let x=!1;for(const E of a)if(void 0===this._tileClippingMaskIDs[E.key]){x=!0;break}if(!x)return}this.currentStencilSource=c.id;const f=this.context,d=f.gl;this.nextStencilID+a.length>256&&this.clearStencil(),f.setColorMode(u.ColorMode.disabled),f.setDepthMode(u.DepthMode.disabled);const y=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const x of a){const E=c.getTile(x),C=this._tileClippingMaskIDs[x.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:U,tileBoundsSegments:Y}=this.getTileBoundsBuffers(E);y.draw(f,d.TRIANGLES,u.DepthMode.disabled,new u.StencilMode({func:d.ALWAYS,mask:0},C,255,d.KEEP,d.KEEP,d.REPLACE),u.ColorMode.disabled,u.CullFaceMode.disabled,Jn(x.projMatrix),"$clipping",k,U,Y)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,c=this.context.gl;return new u.StencilMode({func:c.NOTEQUAL,mask:255},r,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const c=this.context.gl;return new u.StencilMode({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(r){const c=this.context.gl,a=r.sort((y,x)=>x.overscaledZ-y.overscaledZ),f=a[a.length-1].overscaledZ,d=a[0].overscaledZ-f+1;if(d>1){this.currentStencilSource=void 0,this.nextStencilID+d>256&&this.clearStencil();const y={};for(let x=0;x<d;x++)y[x+f]=new u.StencilMode({func:c.GEQUAL,mask:255},x+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=d,[y,a]}return[{[f]:u.StencilMode.disabled},a]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new u.ColorMode([r.CONSTANT_COLOR,r.ONE],new u.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?u.ColorMode.unblended:u.ColorMode.alphaBlended}depthModeForSublayer(r,c,a){if(!this.opaquePassEnabledForLayer())return u.DepthMode.disabled;const f=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new u.DepthMode(a||this.context.gl.LEQUAL,c,[f,f])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(r,c){this.style=r,this.options=c,this.imageManager=r.imageManager,this.glyphManager=r.glyphManager,this.symbolFadeChange=r.placement.symbolFadeChange(u.exported.now()),this.imageManager.beginFrame();const a=this.style.order,f=this.style._sourceCaches;for(const E in f){const C=f[E];C.used&&C.prepare(this.context)}const d={},y={},x={};for(const E in f){const C=f[E];d[E]=C.getVisibleCoordinates(),y[E]=d[E].slice().reverse(),x[E]=C.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let E=0;E<a.length;E++)if(this.style._layers[a[E]].is3D()){this.opaquePassCutoff=E;break}if(this.terrain&&(this.terrain.updateTileBinding(x),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new u.GlobeSharedBuffers(this.context)),u.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const E of a){const C=this.style._layers[E],k=r._getLayerSourceCache(C);if(!C.hasOffscreenPass()||C.isHidden(this.transform.zoom))continue;const U=k?y[k.id]:void 0;("custom"===C.type||C.isSky()||U&&U.length)&&this.renderLayer(this,k,C,U)}if(this.depthRangeFor3D=[0,1-(r.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:c.showOverdrawInspector?u.Color.black:u.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const E=this.style._layers[a[this.currentLayer]],C=r._getLayerSourceCache(E);if(E.isSky())continue;const k=C?y[C.id]:void 0;this._renderTileClippingMasks(E,C,k),this.renderLayer(this,C,E,k)}if(this.style.fog&&this.transform.projection.supportsFog&&function(E,C){const k=E.context,U=k.gl,Y=E.transform,oe=new u.DepthMode(U.LEQUAL,u.DepthMode.ReadOnly,[0,1]),le=E.useProgram("globeAtmosphere",null,"globe"===Y.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),he=u.globeToMercatorTransition(Y.zoom),me=C.properties.get("color").toArray01(),ee=C.properties.get("high-color").toArray01(),be=C.properties.get("space-color").toArray01PremultipliedAlpha(),ye=u.identity$1([]);u.rotateY$1(ye,ye,-u.degToRad(Y._center.lng)),u.rotateX$1(ye,ye,u.degToRad(Y._center.lat)),u.rotateZ$1(ye,ye,Y.angle),u.rotateX$1(ye,ye,-Y._pitch);const De=u.fromQuat(new Float32Array(16),ye),ke=u.mapValue(C.properties.get("star-intensity"),0,1,0,.25),Be=u.mapValue(C.properties.get("horizon-blend"),0,1,5e-4,.25),He=u.globeUseCustomAntiAliasing(E,k,Y)&&5e-4===Be?Y.worldSize/(2*Math.PI*1.025)-1:Y.globeRadius,Xe=E.frameCounter/1e3%1,Qe=u.length(Y.globeCenterInViewSpace),qt=Math.sqrt(Math.pow(Qe,2)-Math.pow(He,2)),qe=Math.acos(qt/Qe),Tt={u_frustum_tl:Y.frustumCorners.TL,u_frustum_tr:Y.frustumCorners.TR,u_frustum_br:Y.frustumCorners.BR,u_frustum_bl:Y.frustumCorners.BL,u_horizon:Y.frustumCorners.horizon,u_transition:he,u_fadeout_range:Be,u_color:me,u_high_color:ee,u_space_color:be,u_star_intensity:ke,u_star_size:5*u.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Xe,u_horizon_angle:qe,u_rotation_matrix:De};E.prepareDrawProgram(k,le);const at=E.atmosphereBuffer;at&&le.draw(k,U.TRIANGLES,oe,u.StencilMode.disabled,u.ColorMode.alphaBlended,u.CullFaceMode.backCW,Tt,"skybox",at.vertexBuffer,at.indexBuffer,at.segments)}(this,this.style.fog),this.renderPass="sky",(u.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const E=this.style._layers[a[this.currentLayer]],C=r._getLayerSourceCache(E);E.isSky()&&this.renderLayer(this,C,E,C?y[C.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<a.length;){const E=this.style._layers[a[this.currentLayer]],C=r._getLayerSourceCache(E);if(E.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(E)){if(E.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const k=C?("symbol"===E.type?x:y)[C.id]:void 0;this._renderTileClippingMasks(E,C,C?d[C.id]:void 0),this.renderLayer(this,C,E,k),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let E=null;u.values(this.style._layers).forEach(C=>{const k=r._getLayerSourceCache(C);k&&!C.isHidden(this.transform.zoom)&&(!E||E.getSource().maxzoom<k.getSource().maxzoom)&&(E=k)}),E&&this.options.showTileBoundaries&&F.debug(this,E,E.getVisibleCoordinates())}this.options.showPadding&&function(E){const C=E.transform.padding;fr(E,E.transform.height-(C.top||0),3,gn),fr(E,C.bottom||0,3,_n),Fr(E,C.left||0,3,cr),Fr(E,E.transform.width-(C.right||0),3,ur);const k=E.transform.centerPoint;var U,Y,oe,le;oi(U=E,(Y=k.x)-1,(oe=E.transform.height-k.y)-10,2,20,le=Un),oi(U,Y-10,oe-1,20,2,le)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(u.window.performance.now()),this.saveCanvasCopy())}}renderLayer(r,c,a,f){a.isHidden(this.transform.zoom)||("background"===a.type||"sky"===a.type||"custom"===a.type||f&&f.length)&&(this.id=a.id,this.gpuTimingStart(a),(!r.transform.projection.unsupportedLayers||!r.transform.projection.unsupportedLayers.includes(a.type)||r.terrain&&"custom"===a.type)&&F[a.type](r,c,a,f,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery;let a=this.gpuTimers[r.id];a||(a=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:c.createQueryEXT()}),a.calls++,c.beginQueryEXT(c.TIME_ELAPSED_EXT,a.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,c=r.createQueryEXT();this.deferredRenderGpuTimeQueries.push(c),r.beginQueryEXT(r.TIME_ELAPSED_EXT,c)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const r=this.context.extTimerQuery;r.endQueryEXT(r.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const c={};for(const a in r){const f=r[a],d=this.context.extTimerQuery,y=d.getQueryObjectEXT(f.query,d.QUERY_RESULT_EXT)/1e6;d.deleteQueryEXT(f.query),c[a]=y}return c}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.extTimerQuery;let a=0;for(const f of r)a+=c.getQueryObjectEXT(f,c.QUERY_RESULT_EXT)/1e6,c.deleteQueryEXT(f);return a}translatePosMatrix(r,c,a,f,d){if(!a[0]&&!a[1])return r;const y=d?"map"===f?this.transform.angle:0:"viewport"===f?-this.transform.angle:0;if(y){const C=Math.sin(y),k=Math.cos(y);a=[a[0]*k-a[1]*C,a[0]*C+a[1]*k]}const x=[d?a[0]:Nt(c,a[0],this.transform.zoom),d?a[1]:Nt(c,a[1],this.transform.zoom),0],E=new Float32Array(16);return u.translate(E,r,x),E}saveTileTexture(r){const c=this._tileTextures[r.size[0]];c?c.push(r):this._tileTextures[r.size[0]]=[r]}getTileTexture(r){const c=this._tileTextures[r];return c&&c.length>0?c.pop():null}isPatternMissing(r){return null===r||void 0!==r&&!this.imageManager.getPattern(r.toString())}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture}currentGlobalDefines(){const r=this.terrain&&this.terrain.renderingToTexture,c=this.terrain&&0===this.terrain.exaggeration(),a=this.style&&this.style.fog,f=[];return this.terrainRenderModeElevated()&&f.push("TERRAIN"),"globe"===this.transform.projection.name&&f.push("GLOBE"),c&&f.push("ZERO_EXAGGERATION"),a&&!r&&0!==a.getOpacity(this.transform.pitch)&&f.push("FOG"),r&&f.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&f.push("OVERDRAW_INSPECTOR"),f}useProgram(r,c,a){this.cache=this.cache||{};const f=a||[],d=this.currentGlobalDefines().concat(f),y=Ko.cacheKey(Ds[r],r,d,c);return this.cache[y]||(this.cache[y]=new Ko(this.context,r,Ds[r],c,pl[r],d)),this.cache[y]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=u.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new u.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(r,c,a){if(this.terrain&&this.terrain.renderingToTexture)return;const f=this.style.fog;if(f){const d=f.getOpacity(this.transform.pitch),y=((x,E,C,k,U,Y,oe,le,he,me,ee)=>{const be=x.transform,ye=E.properties.get("color").toArray01();ye[3]=k;const De=x.frameCounter/1e3%1;return{u_fog_matrix:C?be.calculateFogTileMatrix(C):x.identityMat,u_fog_range:E.getFovAdjustedRange(be._fov),u_fog_color:ye,u_fog_horizon_blend:E.properties.get("horizon-blend"),u_fog_temporal_offset:De,u_frustum_tl:U,u_frustum_tr:Y,u_frustum_br:oe,u_frustum_bl:le,u_globe_pos:he,u_globe_radius:me,u_viewport:ee,u_globe_transition:u.globeToMercatorTransition(be.zoom),u_is_globe:+("globe"===be.projection.name)}})(this,f,a,d,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*u.exported.devicePixelRatio,this.transform.height*u.exported.devicePixelRatio]);c.setFogUniformValues(r,y)}}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,c=r.createTexture();return r.bindTexture(r.TEXTURE_2D,c),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&0!==r.getOpacity(this.transform.pitch)}getBackgroundTiles(){const r=this._backgroundTiles,c=this._backgroundTiles={},a=this.transform.coveringTiles({tileSize:512});for(const f of a)c[f.key]=r[f.key]||new u.Tile(f,512,this.transform.tileZoom,this);return c}clearBackgroundTiles(){this._backgroundTiles={}}}class N{constructor(r=0,c=0,a=0,f=0){if(isNaN(r)||r<0||isNaN(c)||c<0||isNaN(a)||a<0||isNaN(f)||f<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=c,this.left=a,this.right=f}interpolate(r,c,a){return null!=c.top&&null!=r.top&&(this.top=u.number(r.top,c.top,a)),null!=c.bottom&&null!=r.bottom&&(this.bottom=u.number(r.bottom,c.bottom,a)),null!=c.left&&null!=r.left&&(this.left=u.number(r.left,c.left,a)),null!=c.right&&null!=r.right&&(this.right=u.number(r.right,c.right,a)),this}getCenter(r,c){const a=u.clamp((this.left+r-this.right)/2,0,r),f=u.clamp((this.top+c-this.bottom)/2,0,c);return new u.pointGeometry(a,f)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new N(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function se(p,r){const c=u.getColumn(p,3);u.fromQuat(p,r),u.setColumn(p,3,c)}function Ce(p,r){const c=u.identity$1([]);return u.rotateZ$1(c,c,-r),u.rotateX$1(c,c,-p),c}function I(p,r){const c=[p[0],p[1],0],a=[r[0],r[1],0];if(u.length(c)>=1e-15){const y=u.normalize([],c);u.scale$2(a,y,u.dot(a,y)),r[0]=a[0],r[1]=a[1]}const f=u.cross([],r,p);if(u.len(f)<1e-15)return null;const d=Math.atan2(-f[1],f[0]);return Ce(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),d)}class A{constructor(r,c){this.position=r,this.orientation=c}get position(){return this._position}set position(r){if(r){const c=r instanceof u.MercatorCoordinate?r:new u.MercatorCoordinate(r[0],r[1],r[2]);this._renderWorldCopies&&(c.x=u.wrap(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(r,c){if(this.orientation=null,!this.position)return;const a=this._elevation?this._elevation.getAtPointOrZero(u.MercatorCoordinate.fromLngLat(r)):0,f=this.position,d=u.MercatorCoordinate.fromLngLat(r,a),y=[d.x-f.x,d.y-f.y,d.z-f.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=I(y,c)}setPitchBearing(r,c){this.orientation=Ce(u.degToRad(r),u.degToRad(-c))}}class ${constructor(r,c){this._transform=u.identity([]),this.orientation=c,this.position=r}get mercatorPosition(){const r=this.position;return new u.MercatorCoordinate(r[0],r[1],r[2])}get position(){const r=u.getColumn(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var c;r&&u.setColumn(this._transform,3,[(c=r)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||u.identity$1([]),r&&se(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,c){this._orientation=Ce(r,c),se(this._transform,this._orientation)}forward(){const r=u.getColumn(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=u.getColumn(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=u.getColumn(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,c){const a=new Float64Array(16);return u.invert(a,this.getWorldToCamera(r,c)),a}getWorldToCameraPosition(r,c,a){const f=this.position;u.scale$2(f,f,-r);const d=new Float64Array(16);return u.fromScaling(d,[a,a,a]),u.translate(d,d,f),d[10]*=c,d}getWorldToCamera(r,c){const a=new Float64Array(16),f=new Float64Array(4),d=this.position;return u.conjugate(f,this._orientation),u.scale$2(d,d,-r),u.fromQuat(a,f),u.translate(a,a,d),a[1]*=-1,a[5]*=-1,a[9]*=-1,a[13]*=-1,a[8]*=c,a[9]*=c,a[10]*=c,a[11]*=c,a}getCameraToClipPerspective(r,c,a,f){const d=new Float64Array(16);return u.perspective(d,r,c,a,f),d}getDistanceToElevation(r,c=!1){const a=0===r?0:u.mercatorZfromAltitude(r,c?u.latFromMercatorY(this.position[1]):this.position[1]),f=this.forward();return(a-this.position[2])/f[2]}clone(){return new $([...this.position],[...this.orientation])}}function fe(p,r){const c=Ft(p.projection,p.zoom,p.width,p.height),a=function(d,y,x,E,C){const k=new u.LngLat(x.lng-180*En,x.lat),U=new u.LngLat(x.lng+180*En,x.lat),Y=d.project(k.lng,k.lat),oe=d.project(U.lng,U.lat),le=-Math.atan2(oe.y-Y.y,oe.x-Y.x),he=u.MercatorCoordinate.fromLngLat(x);he.y=u.clamp(he.y,-.999975,.999975);const me=he.toLngLat(),ee=d.project(me.lng,me.lat),be=u.MercatorCoordinate.fromLngLat(me);be.x+=En;const ye=be.toLngLat(),De=d.project(ye.lng,ye.lat),ke=Xn(De.x-ee.x,De.y-ee.y,le),Ae=u.MercatorCoordinate.fromLngLat(me);Ae.y+=En;const Be=Ae.toLngLat(),He=d.project(Be.lng,Be.lat),Xe=Xn(He.x-ee.x,He.y-ee.y,le),Qe=Math.abs(ke.x)/Math.abs(Xe.y),qt=u.identity([]);u.rotateZ(qt,qt,-le*(1-(C?0:E)));const qe=u.identity([]);return u.scale(qe,qe,[1,1-(1-Qe)*E,1]),qe[4]=-Xe.x/Xe.y*E,u.rotateZ(qe,qe,le),u.multiply(qe,qt,qe),qe}(p.projection,0,p.center,c,r),f=We(p);return u.scale(a,a,[f,f,1]),a}function We(p){const r=p.projection,c=Ft(p.projection,p.zoom,p.width,p.height),a=Qn(r,p.center),f=Qn(r,u.LngLat.convert(r.center));return Math.pow(2,a*c+(1-c)*f)}function Ft(p,r,c,a,f=1/0){const d=p.range;if(!d)return 0;const y=Math.min(f,Math.max(c,a)),x=Math.log(y/1024)/Math.LN2;return u.smoothstep(d[0]+x,d[1]+x,r)}const En=1/4e4;function Qn(p,r){const c=u.clamp(r.lat,-u.MAX_MERCATOR_LATITUDE,u.MAX_MERCATOR_LATITUDE),a=new u.LngLat(r.lng-180*En,c),f=new u.LngLat(r.lng+180*En,c),d=p.project(a.lng,c),y=p.project(f.lng,c),x=u.MercatorCoordinate.fromLngLat(a),E=u.MercatorCoordinate.fromLngLat(f),C=y.x-d.x,k=y.y-d.y,U=E.x-x.x,Y=E.y-x.y,oe=Math.sqrt((U*U+Y*Y)/(C*C+k*k));return Math.log(oe)/Math.LN2}function Xn(p,r,c){const a=Math.cos(c),f=Math.sin(c);return{x:p*a-r*f,y:p*f+r*a}}class yt{constructor(r,c,a,f,d,y,x){this.tileSize=512,this._renderWorldCopies=void 0===d||d,this._minZoom=r||0,this._maxZoom=c||22,this._minPitch=a??0,this._maxPitch=f??60,this.setProjection(y),this.setMaxBounds(x),this.width=0,this.height=0,this._center=new u.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new N,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new $,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const r=new yt(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(r,c=!1){const a=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||a)&&this._updateCameraOnTerrain(),(r||a)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return u.pick(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=u.getProjection(this.projectionOptions);const a=!Ie(c,this.getProjection());return a&&this._calcMatrices(),this.mercatorFromTransition=!1,a}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=u.getProjection({name:"mercator"});const c=r!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(r){void 0===r?r=!0:null===r&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return u.mercatorZfromAltitude(this.center.lat,this.cameraWorldSizeForFog)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.pointGeometry(this.width,this.height)}get bearing(){return u.wrap(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const c=-r*Math.PI/180;var a,f,d,y,x,E,C,k,U,Y;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=(a=new u.ARRAY_TYPE(4),u.ARRAY_TYPE!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a),f=this.rotationMatrix,y=this.angle,x=(d=this.rotationMatrix)[0],E=d[1],C=d[2],k=d[3],U=Math.sin(y),Y=Math.cos(y),f[0]=x*Y+C*U,f[1]=E*Y+k*U,f[2]=x*-U+C*Y,f[3]=E*-U+k*Y)}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const c=u.clamp(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=u.degToRad(r),this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const c=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;this._centerAltitude=r.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=r.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],a=this.horizonLineFromTop();let f=0,d=0;for(let y=0;y<c.length;y++){const x=new u.pointGeometry(c[y][0]*this.width,a+c[y][1]*(this.height-a)),E=r.pointCoordinate(x);if(!E)continue;const C=1/Math.hypot(E[0]-this._camera.position[0],E[1]-this._camera.position[1]);f+=E[3]*C,d+=C}return 0===d?NaN:f/d}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const r=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),a=this.pixelsPerMeter/this.worldSize*c,f=this._mercatorZfromZoom(r),d=this._mercatorZfromZoom(this._maxZoom),y=Math.max(f-a,d);this._setZoom(this._zoomFromMercatorZ(y))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let a;a=r.z<this._camera.position[2]?[c.x,c.y,c.z]:[r.x,r.y,r.z];const f=u.length(u.sub([],this._camera.position,a));return u.clamp(this._zoomFromMercatorZ(f),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let c=!1;if(r.orientation&&!u.exactEquals(r.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(r.orientation)),r.position){const a=[r.position.x,r.position.y,r.position.z];u.exactEquals$1(a,this._camera.position)||(this._setCameraPosition(a),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,c=new A;return c.position=new u.MercatorCoordinate(r[0],r[1],r[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(r){if(!u.length$1(r))return!1;u.normalize$1(r,r);const c=u.transformQuat([],[0,0,-1],r),a=u.transformQuat([],[0,-1,0],r);if(a[2]<0)return!1;const f=I(c,a);return!!f&&(this._camera.orientation=f,!0)}_setCameraPosition(r){const c=this.zoomScale(this.minZoom)*this.tileSize,a=this.zoomScale(this.maxZoom)*this.tileSize,f=this.cameraToCenterDistance;r[2]=u.clamp(r[2],f/a,f/c),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,c,a){this._unmodified=!1,this._edgeInsets.interpolate(r,c,a),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const c=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(r){const c=[new u.UnwrappedTileID(0,r)];if(this.renderWorldCopies){const a=this.pointCoordinate(new u.pointGeometry(0,0)),f=this.pointCoordinate(new u.pointGeometry(this.width,0)),d=this.pointCoordinate(new u.pointGeometry(this.width,this.height)),y=this.pointCoordinate(new u.pointGeometry(0,this.height)),x=Math.floor(Math.min(a.x,f.x,d.x,y.x)),E=Math.floor(Math.max(a.x,f.x,d.x,y.x)),C=1;for(let k=x-C;k<=E+C;k++)0!==k&&c.push(new u.UnwrappedTileID(k,r))}return c}coveringTiles(r){let c=this.coveringZoomLevel(r);const a=c,f=this.elevation&&!r.isTerrainDEM,d="mercator"===this.projection.name;if(void 0!==r.minzoom&&c<r.minzoom)return[];void 0!==r.maxzoom&&c>r.maxzoom&&(c=r.maxzoom);const y=this.locationCoordinate(this.center),x=this.center.lat,E=1<<c,C=[E*y.x,E*y.y,0],k="globe"===this.projection.name,U=!k,Y=u.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,U),oe=k?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),le=E*u.mercatorZfromAltitude(1,this.center.lat),he=this._camera.position[2]/u.mercatorZfromAltitude(1,this.center.lat),me=[E*oe.x,E*oe.y,he*(U?1:le)],ee=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),be=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?c:0,ye=r.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,De=r.isTerrainDEM?-ye:this._elevation?this._elevation.getMinElevationBelowMSL():0,ke=this.projection.isReprojectedInTileSpace?We(this):1,Ae=Ye=>{const it=new u.MercatorCoordinate(Ye.x+25e-6,Ye.y,Ye.z),Ct=new u.MercatorCoordinate(Ye.x,Ye.y+25e-6,Ye.z),Bt=Ye.toLngLat(),Mn=it.toLngLat(),_r=Ct.toLngLat(),wn=this.locationCoordinate(Bt),pn=this.locationCoordinate(Mn),Rn=this.locationCoordinate(_r),Ir=Math.hypot(pn.x-wn.x,pn.y-wn.y),zn=Math.hypot(Rn.x-wn.x,Rn.y-wn.y);return Math.sqrt(Ir*zn)*ke/25e-6},Be=Ye=>{const Ge=ye,it=De;return{aabb:u.tileAABB(this,E,0,0,0,Ye,it,Ge,this.projection),zoom:0,x:0,y:0,minZ:it,maxZ:Ge,wrap:Ye,fullyVisible:!1}},He=[];let Xe=[];const Qe=c,qt=r.reparseOverscaled?a:c,qe=Ye=>Ye*Ye,Tt=qe((he-this._centerAltitude)*le),at=Ye=>{if(!this._elevation||!Ye.tileID||!d)return;const Ge=this._elevation.getMinMaxForTile(Ye.tileID),it=Ye.aabb;Ge?(it.min[2]=Ge.min,it.max[2]=Ge.max,it.center[2]=(it.min[2]+it.max[2])/2):(Ye.shouldSplit=kt(Ye),Ye.shouldSplit||(it.min[2]=it.max[2]=it.center[2]=this._centerAltitude))},kt=Ye=>{if(Ye.zoom<be)return!0;if(Ye.zoom===Qe)return!1;if(null!=Ye.shouldSplit)return Ye.shouldSplit;const Ge=Ye.aabb.distanceX(me),it=Ye.aabb.distanceY(me);let Ct=Tt,Bt=1;if(k){Ct=qe(Ye.aabb.distanceZ(me));const wn=Math.pow(2,Ye.zoom),pn=u.latFromMercatorY((Ye.y+1)/wn),Rn=u.latFromMercatorY(Ye.y/wn),Ir=Math.min(Math.max(x,pn),Rn),zn=u.circumferenceAtLatitude(Ir)/u.circumferenceAtLatitude(x);if(Bt=Ir===x?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,zn/this._mercatorScaleRatio),this.zoom<=u.GLOBE_ZOOM_THRESHOLD_MIN&&Ye.zoom===Qe-1&&zn>=.9)return!0}else if(f&&(Ct=qe(Ye.aabb.distanceZ(me)*le)),this.projection.isReprojectedInTileSpace&&a<=5){const wn=Math.pow(2,Ye.zoom),pn=Ae(new u.MercatorCoordinate((Ye.x+.5)/wn,(Ye.y+.5)/wn));Bt=pn>.85?1:pn}const Mn=Ge*Ge+it*it+Ct;return Mn<qe((1<<Qe-Ye.zoom)*ee*Bt*((wn,pn)=>{if(pn*qe(.707)<wn)return 1;const Rn=Math.sqrt(pn/wn);return Rn/(1.4144271570014144+(Math.pow(1.1,Rn-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ct,Tt),Mn))};if(this.renderWorldCopies)for(let Ye=1;Ye<=3;Ye++)He.push(Be(-Ye)),He.push(Be(Ye));for(He.push(Be(0));He.length>0;){const Ye=He.pop(),Ge=Ye.x,it=Ye.y;let Ct=Ye.fullyVisible;if(!Ct){const Bt=Ye.aabb.intersects(Y);if(0===Bt)continue;Ct=2===Bt}if(Ye.zoom!==Qe&&kt(Ye))for(let Bt=0;Bt<4;Bt++){const Mn=(Ge<<1)+Bt%2,_r=(it<<1)+(Bt>>1),wn={aabb:d?Ye.aabb.quadrant(Bt):u.tileAABB(this,E,Ye.zoom+1,Mn,_r,Ye.wrap,Ye.minZ,Ye.maxZ,this.projection),zoom:Ye.zoom+1,x:Mn,y:_r,wrap:Ye.wrap,fullyVisible:Ct,tileID:void 0,shouldSplit:void 0,minZ:Ye.minZ,maxZ:Ye.maxZ};f&&!k&&(wn.tileID=new u.OverscaledTileID(Ye.zoom+1===Qe?qt:Ye.zoom+1,Ye.wrap,Ye.zoom+1,Mn,_r),at(wn)),He.push(wn)}else{const Bt=Ye.zoom===Qe?qt:Ye.zoom;if(r.minzoom&&r.minzoom>Bt)continue;const Mn=C[0]-(.5+Ge+(Ye.wrap<<Ye.zoom))*(1<<c-Ye.zoom),_r=C[1]-.5-it,wn=Ye.tileID?Ye.tileID:new u.OverscaledTileID(Bt,Ye.wrap,Ye.zoom,Ge,it);Xe.push({tileID:wn,distanceSq:Mn*Mn+_r*_r})}}if(this.fogCullDistSq){const Ye=this.fogCullDistSq,Ge=this.horizonLineFromTop();Xe=Xe.filter(it=>{const Ct=[0,0,0,1],Bt=[u.EXTENT,u.EXTENT,0,1],Mn=this.calculateFogTileMatrix(it.tileID.toUnwrapped());u.transformMat4$1(Ct,Ct,Mn),u.transformMat4$1(Bt,Bt,Mn);const _r=u.getAABBPointSquareDist(Ct,Bt);if(0===_r)return!0;let wn=!1;const pn=this._elevation;if(pn&&_r>Ye&&0!==Ge){const Rn=this.calculateProjMatrix(it.tileID.toUnwrapped());let Ir;r.isTerrainDEM||(Ir=pn.getMinMaxForTile(it.tileID)),Ir||(Ir={min:De,max:ye});const zn=u.furthestTileCorner(this.rotation),ti=[zn[0]*u.EXTENT,zn[1]*u.EXTENT,Ir.max];u.transformMat4(ti,ti,Rn),wn=(1-ti[1])*this.height*.5<Ge}return _r<Ye||wn})}return Xe.sort((Ye,Ge)=>Ye.distanceSq-Ge.distanceSq).map(Ye=>Ye.tileID)}resize(r,c){this.width=r,this.height=c,this.pixelsToGLUnits=[2/r,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const c=u.clamp(r.lat,-u.MAX_MERCATOR_LATITUDE,u.MAX_MERCATOR_LATITUDE),a=this.projection.project(r.lng,c);return new u.pointGeometry(a.x*this.worldSize,a.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/u.mercatorZfromAltitude(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,c){let a,f;const d=this.centerPoint;if("globe"===this.projection.name){const x=this.worldSize;a=(c.x-d.x)/x,f=(c.y-d.y)/x}else{const x=this.pointCoordinate(c),E=this.pointCoordinate(d);a=x.x-E.x,f=x.y-E.y}const y=this.locationCoordinate(r);this.setLocation(new u.MercatorCoordinate(y.x-a,y.y-f))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r){return this.projection.locationPoint(this,r)}locationPoint3D(r){return this.projection.locationPoint(this,r,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r){return this.coordinateLocation(this.pointCoordinate3D(r))}locationCoordinate(r,c){const a=c?u.mercatorZfromAltitude(c,r.lat):void 0,f=this.projection.project(r.lng,r.lat);return new u.MercatorCoordinate(f.x,f.y,a)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,c){const a=c??this._centerAltitude,f=[r.x,r.y,0,1],d=[r.x,r.y,1,1];u.transformMat4$1(f,f,this.pixelMatrixInverse),u.transformMat4$1(d,d,this.pixelMatrixInverse);const y=d[3];u.scale$1(f,f,1/f[3]),u.scale$1(d,d,1/y);const x=f[2],E=d[2];return{p0:f,p1:d,t:x===E?0:(a-x)/(E-x)}}screenPointToMercatorRay(r){const c=[r.x,r.y,0,1],a=[r.x,r.y,1,1];return u.transformMat4$1(c,c,this.pixelMatrixInverse),u.transformMat4$1(a,a,this.pixelMatrixInverse),u.scale$1(c,c,1/c[3]),u.scale$1(a,a,1/a[3]),c[2]=u.mercatorZfromAltitude(c[2],this._center.lat)*this.worldSize,a[2]=u.mercatorZfromAltitude(a[2],this._center.lat)*this.worldSize,u.scale$1(c,c,1/this.worldSize),u.scale$1(a,a,1/this.worldSize),new u.Ray([c[0],c[1],c[2]],u.normalize([],u.sub([],a,c)))}rayIntersectionCoordinate(r){const{p0:c,p1:a,t:f}=r,d=u.mercatorZfromAltitude(c[2],this._center.lat),y=u.mercatorZfromAltitude(a[2],this._center.lat);return new u.MercatorCoordinate(u.number(c[0],a[0],f)/this.worldSize,u.number(c[1],a[1],f)/this.worldSize,u.number(d,y,f))}pointCoordinate(r,c=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,c)}pointCoordinate3D(r){if(!this.elevation)return this.pointCoordinate(r);let c=this.projection.pointCoordinate3D(this,r.x,r.y);if(c)return new u.MercatorCoordinate(c[0],c[1],c[2]);let a=0,f=this.horizonLineFromTop();if(r.y>f)return this.pointCoordinate(r);const d=.02*f,y=r.clone();for(let x=0;x<10&&f-a>d;x++){y.y=u.number(a,f,.66);const E=this.projection.pointCoordinate3D(this,y.x,y.y);E?(f=y.y,c=E):a=y.y}return c?new u.MercatorCoordinate(c[0],c[1],c[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}_coordinatePoint(r,c){const a=c&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,f=[r.x*this.worldSize,r.y*this.worldSize,a+r.toAltitude(),1];return u.transformMat4$1(f,f,this.pixelMatrix),f[3]>0?new u.pointGeometry(f[0]/f[3],f[1]/f[3]):new u.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:c}=this._edgeInsets,a=this.height-this._edgeInsets.bottom,f=this.width-this._edgeInsets.right,d=this.pointLocation3D(new u.pointGeometry(c,r)),y=this.pointLocation3D(new u.pointGeometry(f,r)),x=this.pointLocation3D(new u.pointGeometry(f,a)),E=this.pointLocation3D(new u.pointGeometry(c,a));let C=Math.min(d.lng,y.lng,x.lng,E.lng),k=Math.max(d.lng,y.lng,x.lng,E.lng),U=Math.min(d.lat,y.lat,x.lat,E.lat),Y=Math.max(d.lat,y.lat,x.lat,E.lat);const oe=Math.pow(2,-this.zoom)/16*270,le="globe"===this.projection.name?1:4,he=(me,ee,be,ye,De)=>{const ke=(me+be)/2,Ae=(ee+ye)/2,Be=new u.pointGeometry(ke,Ae),{lng:He,lat:Xe}=this.pointLocation3D(Be),Qe=Math.max(0,C-He,U-Xe,He-k,Xe-Y);C=Math.min(C,He),k=Math.max(k,He),U=Math.min(U,Xe),Y=Math.max(Y,Xe),(De<le||Qe>oe)&&(he(me,ee,ke,Ae,De+1),he(ke,Ae,be,ye,De+1))};if(he(c,r,f,r,1),he(f,r,f,a,1),he(f,a,c,a,1),he(c,a,c,r,1),"globe"===this.projection.name){const[me,ee]=u.polesInViewport(this);me?(Y=90,k=180,C=-180):ee&&(U=-90,k=180,C=-180)}return new u.LngLatBounds(new u.LngLat(C,U),new u.LngLat(k,Y))}_getBoundsRectangular(r,c){const{top:a,left:f}=this._edgeInsets,d=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,x=new u.pointGeometry(f,a),E=new u.pointGeometry(y,a),C=new u.pointGeometry(y,d),k=new u.pointGeometry(f,d);let U=this.pointCoordinate(x,r),Y=this.pointCoordinate(E,r);const oe=this.pointCoordinate(C,c),le=this.pointCoordinate(k,c),he=(me,ee)=>(ee.y-me.y)/(ee.x-me.x);return U.y>1&&Y.y>=0?U=new u.MercatorCoordinate((1-le.y)/he(le,U)+le.x,1):U.y<0&&Y.y<=1&&(U=new u.MercatorCoordinate(-le.y/he(le,U)+le.x,0)),Y.y>1&&U.y>=0?Y=new u.MercatorCoordinate((1-oe.y)/he(oe,Y)+oe.x,1):Y.y<0&&U.y<=1&&(Y=new u.MercatorCoordinate(-oe.y/he(oe,Y)+oe.x,0)),(new u.LngLatBounds).extend(this.coordinateLocation(U)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(le)).extend(this.coordinateLocation(oe))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=r.visibleDemTiles.reduce((a,f)=>{if(f.dem){const d=f.dem.tree;a.min=Math.min(a.min,d.minimums[0]),a.max=Math.max(a.max,d.maximums[0])}return a},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*r.exaggeration(),c.max*r.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,a=this.height/2-c*(1-this._horizonShift);return r?Math.max(0,a):a}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-u.MAX_MERCATOR_LATITUDE,this.maxLat=u.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=u.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=u.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=u.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=u.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,c){return this.projection.createTileMatrix(this,c,r)}calculateDistanceTileData(r){const c=r.key,a=this._distanceTileDataCache;if(a[c])return a[c];const f=r.canonical,d=1/this.height,y=this.cameraWorldSize,x=y/this.zoomScale(f.z),E=(f.x+Math.pow(2,f.z)*r.wrap)*x,C=f.y*x,k=this.point;k.x*=y/this.worldSize,k.y*=y/this.worldSize;const U=this.angle,Y=Math.sin(-U),oe=-Math.cos(-U);return a[c]={bearing:[Y,oe],center:[(k.x-E)*d,(k.y-C)*d],scale:x/u.EXTENT*d},a[c]}calculateFogTileMatrix(r){const c=r.key,a=this._fogTileMatrixCache;if(a[c])return a[c];const f=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return u.multiply(f,this.worldToFogMatrix,f),a[c]=new Float32Array(f),a[c]}calculateProjMatrix(r,c=!1){const a=r.key,f=c?this._alignedProjMatrixCache:this._projMatrixCache;if(f[a])return f[a];const d=this.calculatePosMatrix(r,this.worldSize);return u.multiply(d,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:c?this.alignedProjMatrix:this.projMatrix,d),f[a]=new Float32Array(d),f[a]}calculatePixelsToTileUnitsMatrix(r){const c=r.tileID.key,a=this._pixelsToTileUnitsCache;if(a[c])return a[c];const f=function(d,y){const{scale:x}=d.tileTransform,E=x*u.EXTENT/(d.tileSize*Math.pow(2,y.zoom-d.tileID.overscaledZ+d.tileID.canonical.z));return C=new Float32Array(4),Y=(k=y.inverseAdjustmentMatrix)[1],oe=k[2],le=k[3],me=(U=[E,E])[1],C[0]=k[0]*(he=U[0]),C[1]=Y*he,C[2]=oe*me,C[3]=le*me,C;var C,k,U,Y,oe,le,he,me}(r,this);return a[c]=f,a[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const r=1/this.worldSize,c=u.fromScaling([],[r,r,r]);return u.multiply(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const r=this._elevation;this._updateCameraState();const c=u.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,a=this._computeCameraPosition(c),f=this._camera.forward(),d=u.mercatorZfromAltitude(1,this._center.lat);a[2]/=d,f[2]/=d,u.normalize(f,f);const y=r.raycast(a,f,r.exaggeration());if(y){const x=u.scaleAndAdd([],a,f,y),E=new u.MercatorCoordinate(x[0],x[1],u.mercatorZfromAltitude(x[2],u.latFromMercatorY(x[1]))),C=(E.z+u.length([E.x-a[0],E.y-a[1],E.z-a[2]*d]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(C),this._centerAltitude=E.toAltitude(),this._center=this.coordinateLocation(E),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const c=this._elevation,a=u.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(a),d=c.getAtPointOrZero(new u.MercatorCoordinate(...f)),y=this.pixelsPerMeter/this.worldSize*d,x=this._minimumHeightOverTerrain(),E=f[2]-y;if(E<=x)if(E<0||r){const C=this.locationCoordinate(this._center,this._centerAltitude),k=[f[0],f[1],C.z-f[2]],U=u.length(k);k[2]-=(x-E)/this._pixelsPerMercatorPixel;const Y=u.length(k);if(0===Y)return;u.scale$2(k,k,U/Y*this._pixelsPerMercatorPixel),this._camera.position=[f[0],f[1],C.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const Y=this.center;return Y.lat=u.clamp(Y.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(Y.lng=u.clamp(Y.lng,this.minLng,this.maxLng)),this.center=Y,void(this._constraining=!1)}const c=this._unmodified,{x:a,y:f}=this.point;let d=0,y=a,x=f;const E=this.width/2,C=this.height/2,k=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(f-C<k&&(x=k+C),f+C>U&&(x=U-C),U-k<this.height&&(d=Math.max(d,this.height/(U-k)),x=(U+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const Y=this.worldMinX*this.scale,oe=this.worldMaxX*this.scale,le=this.worldSize/2-(Y+oe)/2;y=(a+le+this.worldSize)%this.worldSize-le,y-E<Y&&(y=Y+E),y+E>oe&&(y=oe-E),oe-Y<this.width&&(d=Math.max(d,this.width/(oe-Y)),y=(oe+Y)/2)}y===a&&x===f||(this.center=this.unproject(new u.pointGeometry(y,x))),d&&(this.zoom+=this.scaleZoom(d)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,c=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=u.mercatorZfromAltitude(1,this.center.lat)/u.mercatorZfromAltitude(1,u.GLOBE_SCALE_MATCH_LATITUDE));const a=Ft(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,a),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const f="meters"===this.projection.zAxisUnit?c:1,d=this._camera.getWorldToCamera(this.worldSize,f),y=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);y[8]=2*-r.x/this.width,y[9]=2*r.y/this.height;let x=u.mul([],y,d);if(this.projection.isReprojectedInTileSpace){const Ae=this.locationCoordinate(this.center),Be=u.identity([]);u.translate(Be,Be,[Ae.x*this.worldSize,Ae.y*this.worldSize,0]),u.multiply(Be,Be,fe(this)),u.translate(Be,Be,[-Ae.x*this.worldSize,-Ae.y*this.worldSize,0]),u.multiply(x,x,Be),this.inverseAdjustmentMatrix=function(He){const Xe=fe(He,!0);return Ne([],[Xe[0],Xe[1],Xe[4],Xe[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=u.scale([],x,[this.worldSize,this.worldSize,this.worldSize/f,1]),this.projMatrix=x,this.invProjMatrix=u.invert(new Float64Array(16),this.projMatrix);const E=u.invert([],y);this.frustumCorners=u.FrustumCorners.fromInvProjectionMatrix(E,this.horizonLineFromTop(),this.height);const C=new Float32Array(16);u.identity(C),u.scale(C,C,[1,-1,1]),u.rotateX(C,C,this._pitch),u.rotateZ(C,C,this.angle);const k=u.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),U=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;k[8]=2*-r.x/this.width,k[9]=2*(r.y+U)/this.height,this.skyboxMatrix=u.multiply(C,k,C);const Y=this.point,oe=Y.x,le=Y.y,he=this.width%2/2,me=this.height%2/2,ee=Math.cos(this.angle),be=Math.sin(this.angle),ye=oe-Math.round(oe)+ee*he+be*me,De=le-Math.round(le)+ee*me+be*he,ke=new Float64Array(x);if(u.translate(ke,ke,[ye>.5?ye-1:ye,De>.5?De-1:De,0]),this.alignedProjMatrix=ke,x=u.create(),u.scale(x,x,[this.width/2,-this.height/2,1]),u.translate(x,x,[1,-1,0]),this.labelPlaneMatrix=x,x=u.create(),u.scale(x,x,[1,-1,1]),u.translate(x,x,[-1,-1,0]),u.scale(x,x,[2/this.width,2/this.height,1]),this.glCoordMatrix=x,this.pixelMatrix=u.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},x=u.invert(new Float64Array(16),this.pixelMatrix),!x)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=x,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=u.calculateGlobeMatrix(this);const Ae=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=u.transformMat4(Ae,Ae,d),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=x;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,a=this._camera.position,f=1/this.height/this._pixelsPerMercatorPixel,d=[r,r,c];u.scale$2(d,d,f),u.scale$2(a,a,-1),u.multiply$2(a,a,d);const y=u.create();u.translate(y,y,a),u.scale(y,y,d),this.mercatorFogMatrix=y,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,c,f)}_computeCameraPosition(r){const c=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,a=this._camera.forward(),f=this.point,d=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-r/this.worldSize*this._centerAltitude;return[f.x/this.worldSize-a[0]*d,f.y/this.worldSize-a[1]*d,r/this.worldSize*this._centerAltitude-a[2]*d]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),a=this._camera.position[2],f=r[2];let d=1;this.projection.wrap&&(this.center=this.center.wrap()),f>0&&(d=Math.min((c-a)/f,1)),this._camera.position=u.scaleAndAdd([],this._camera.position,r,d),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,c=this._camera.forward(),{pitch:a,bearing:f}=this._camera.getPitchBearing(),d=u.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,y=this._mercatorZfromZoom(this._maxZoom)*Math.cos(u.degToRad(this._maxPitch)),x=Math.max((r[2]-d)/Math.cos(a),y),E=this._zoomFromMercatorZ(x);u.scaleAndAdd(r,r,c,x),this._pitch=u.clamp(a,u.degToRad(this.minPitch),u.degToRad(this.maxPitch)),this.angle=u.wrap(f,-Math.PI,Math.PI),this._setZoom(u.clamp(E,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new u.MercatorCoordinate(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+4,this._maxZoom);return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(r*this.tileSize))}zoomFromMercatorZAdjusted(r){let c=0,a=u.GLOBE_ZOOM_THRESHOLD_MAX,f=0,d=1/0;for(;a-c>1e-6&&a>c;){const y=c+.5*(a-c),x=this.tileSize*Math.pow(2,y),E=this.getCameraToCenterDistance(this.projection,y,x),C=this.scaleZoom(E/(r*this.tileSize)),k=Math.abs(y-C);k<d&&(d=k,f=y),y<C?c=y:a=y}return f}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(u.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,c){const a=Math.min(r.x,c.x),f=Math.max(r.x,c.x),d=Math.min(r.y,c.y),y=Math.max(r.y,c.y);if(d<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const x=[new u.pointGeometry(a,d),new u.pointGeometry(f,y),new u.pointGeometry(a,y),new u.pointGeometry(f,d)],E=this.renderWorldCopies?-3:0,C=this.renderWorldCopies?4:1;for(const k of x){const U=this.pointRayIntersection(k);if(U.t<0)return!0;const Y=this.rayIntersectionCoordinate(U);if(Y.x<E||Y.y<0||Y.x>C||Y.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+u.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new u.pointGeometry(0,0),new u.pointGeometry(this.width,this.height))}zoomDeltaToMovement(r,c){const a=u.length(u.sub([],this._camera.position,r)),f=this._zoomFromMercatorZ(a)+c;return a-this._mercatorZfromZoom(f)}getCameraPoint(){if("globe"===this.projection.name){const r=function([c,a,f],d){const y=[c,a,f,1];u.transformMat4$1(y,y,d);const x=y[3]=Math.max(y[3],1e-6);return y[0]/=x,y[1]/=x,y[2]/=x,y}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new u.pointGeometry(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.pointGeometry(0,r))}}getCameraToCenterDistance(r,c=this.zoom,a=this.worldSize){const f=Ft(r,c,this.width,this.height,1024),d=r.pixelSpaceConversion(this.center.lat,a,f);return.5/Math.tan(.5*this._fov)*this.height*d}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&u.multiply(r,r,this.globeMatrix),r}}function Di(p,r){let c=!1,a=null;const f=()=>{a=null,c&&(p(),a=setTimeout(f,r),c=!1)};return()=>(c=!0,a||f(),a)}class As{constructor(r){this._hashName=r&&encodeURIComponent(r),u.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Di(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,u.window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),u.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const c=Ci(r);if(this._hashName){const a=this._hashName;let f=!1;const d=u.window.location.hash.slice(1).split("&").map(y=>{const x=y.split("=")[0];return x===a?(f=!0,`${x}=${c}`):y}).filter(y=>y);return f||d.push(`${a}=${c}`),`#${d.join("&")}`}return`#${c}`}_getCurrentHash(){const r=u.window.location.hash.replace("#","");if(this._hashName){let c;return r.split("&").map(a=>a.split("=")).forEach(a=>{a[0]===this._hashName&&(c=a)}),(c&&c[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(a=>isNaN(a))){const a=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(c[3]||0):r.getBearing();return r.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:a,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){const r=u.window.location.href.replace(/(#.+)?$/,this.getHashString());u.window.history.replaceState(u.window.history.state,null,r)}}function Ci(p,r){const c=p.getCenter(),a=Math.round(100*p.getZoom())/100,f=Math.ceil((a*Math.LN2+Math.log(512/360/.5))/Math.LN10),d=Math.pow(10,f),y=Math.round(c.lng*d)/d,x=Math.round(c.lat*d)/d,E=p.getBearing(),C=p.getPitch();let k=r?`/${y}/${x}/${a}`:`${a}/${x}/${y}`;return(E||C)&&(k+="/"+Math.round(10*E)/10),C&&(k+=`/${Math.round(C)}`),k}const $i={linearity:.3,easing:u.bezier(0,0,.3,1)},ji=u.extend({deceleration:2500,maxSpeed:1400},$i),Hs=u.extend({deceleration:20,maxSpeed:1400},$i),Vo=u.extend({deceleration:1e3,maxSpeed:360},$i),ec=u.extend({deceleration:1e3,maxSpeed:90},$i);class Ca{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:u.exported.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,c=u.exported.now();for(;r.length>0&&c-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new u.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:d}of this._inertiaBuffer)c.zoom+=d.zoomDelta||0,c.bearing+=d.bearingDelta||0,c.pitch+=d.pitchDelta||0,d.panDelta&&c.pan._add(d.panDelta),d.around&&(c.around=d.around),d.pinchAround&&(c.pinchAround=d.pinchAround);const a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,f={};if(c.pan.mag()){const d=tc(c.pan.mag(),a,u.extend({},ji,r||{}));f.offset=c.pan.mult(d.amount/c.pan.mag()),f.center=this._map.transform.center,Sa(f,d)}if(c.zoom){const d=tc(c.zoom,a,Hs);f.zoom=this._map.transform.zoom+d.amount,Sa(f,d)}if(c.bearing){const d=tc(c.bearing,a,Vo);f.bearing=this._map.transform.bearing+u.clamp(d.amount,-179,179),Sa(f,d)}if(c.pitch){const d=tc(c.pitch,a,ec);f.pitch=this._map.transform.pitch+d.amount,Sa(f,d)}if(f.zoom||f.bearing){const d=void 0===c.pinchAround?c.around:c.pinchAround;f.around=d?this._map.unproject(d):this._map.getCenter()}return this.clear(),f.noMoveStart=!0,f}}function Sa(p,r){(!p.duration||p.duration<r.duration)&&(p.duration=r.duration,p.easing=r.easing)}function tc(p,r,c){const{maxSpeed:a,linearity:f,deceleration:d}=c,y=u.clamp(p*f/(r/1e3),-a,a),x=Math.abs(y)/(d*f);return{easing:c.easing,duration:1e3*x,amount:y*(x/2)}}class ro extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,a,f={}){const d=dt(c.getCanvasContainer(),a),y=c.unproject(d);super(r,u.extend({point:d,lngLat:y,originalEvent:a},f)),this._defaultPrevented=!1,this.target=c}}class Ua extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,a){const f="touchend"===r?a.changedTouches:a.touches,d=Lr(c.getCanvasContainer(),f),y=d.map(E=>c.unproject(E)),x=d.reduce((E,C,k,U)=>E.add(C.div(U.length)),new u.pointGeometry(0,0));super(r,{points:d,point:x,lngLats:y,lngLat:c.unproject(x),originalEvent:a}),this._defaultPrevented=!1}}class ml extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,a){super(r,{originalEvent:a}),this._defaultPrevented=!1}}class Pu{constructor(r,c){this._map=r,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new ml(r.type,this._map,r))}mousedown(r,c){return this._mousedownPos=c,this._firePreventable(new ro(r.type,this._map,r))}mouseup(r){this._map.fire(new ro(r.type,this._map,r))}preclick(r){const c=u.extend({},r);c.type="preclick",this._map.fire(new ro(c.type,this._map,c))}click(r,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(r),this._map.fire(new ro(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new ro(r.type,this._map,r))}mouseover(r){this._map.fire(new ro(r.type,this._map,r))}mouseout(r){this._map.fire(new ro(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Ua(r.type,this._map,r))}touchmove(r){this._map.fire(new Ua(r.type,this._map,r))}touchend(r){this._map.fire(new Ua(r.type,this._map,r))}touchcancel(r){this._map.fire(new Ua(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ll{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new ro(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ro("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new ro(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pc{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,c){this.isEnabled()&&r.shiftKey&&0===r.button&&(Jt(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(r,c){if(!this._active)return;const a=c,f=this._startPos,d=this._lastPos;if(!f||!d||d.equals(a)||!this._box&&a.dist(f)<this._clickTolerance)return;this._lastPos=a,this._box||(this._box=gt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const y=Math.min(f.x,a.x),x=Math.max(f.x,a.x),E=Math.min(f.y,a.y),C=Math.max(f.y,a.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${y}px,${E}px)`,this._box.style.width=x-y+"px",this._box.style.height=C-E+"px")})}mouseupWindow(r,c){if(!this._active)return;const a=this._startPos,f=c;if(a&&0===r.button){if(this.reset(),tr(),a.x!==f.x||a.y!==f.y)return this._map.fire(new u.Event("boxzoomend",{originalEvent:r})),{cameraAnimation:d=>d.fitScreenCoordinates(a,f,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&27===r.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),hn(),delete this._startPos,delete this._lastPos}_fireEvent(r,c){return this._map.fire(new u.Event(r,{originalEvent:c}))}}function Rc(p,r){const c={};for(let a=0;a<p.length;a++)c[p[a].identifier]=r[a];return c}class fa{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,c,a){(this.centroid||a.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=r.timeStamp),a.length===this.numTouches&&(this.centroid=function(f){const d=new u.pointGeometry(0,0);for(const y of f)d._add(y);return d.div(f.length)}(c),this.touches=Rc(a,c)))}touchmove(r,c,a){if(this.aborted||!this.centroid)return;const f=Rc(a,c);for(const d in this.touches){const x=f[d];(!x||x.dist(this.touches[d])>30)&&(this.aborted=!0)}}touchend(r,c,a){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),0===a.length){const f=!this.aborted&&this.centroid;if(this.reset(),f)return f}}}class Ol{constructor(r){this.singleTap=new fa(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,c,a){this.singleTap.touchstart(r,c,a)}touchmove(r,c,a){this.singleTap.touchmove(r,c,a)}touchend(r,c,a){const f=this.singleTap.touchend(r,c,a);if(f){const d=r.timeStamp-this.lastTime<500,y=!this.lastTap||this.lastTap.dist(f)<30;if(d&&y||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=f,this.count===this.numTaps)return this.reset(),f}}}class Fl{constructor(){this._zoomIn=new Ol({numTouches:1,numTaps:2}),this._zoomOut=new Ol({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,c,a){this._zoomIn.touchstart(r,c,a),this._zoomOut.touchstart(r,c,a)}touchmove(r,c,a){this._zoomIn.touchmove(r,c,a),this._zoomOut.touchmove(r,c,a)}touchend(r,c,a){const f=this._zoomIn.touchend(r,c,a),d=this._zoomOut.touchend(r,c,a);return f?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()+1,around:y.unproject(f)},{originalEvent:r})}):d?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:y=>y.easeTo({duration:300,zoom:y.getZoom()-1,around:y.unproject(d)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const gl={0:1,2:2};class nc{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,c){return!1}_move(r,c){return{}}mousedown(r,c){if(this._lastPoint)return;const a=Zr(r);this._correctButton(r,a)&&(this._lastPoint=c,this._eventButton=a)}mousemoveWindow(r,c){const a=this._lastPoint;if(a)if(r.preventDefault(),null!=this._eventButton&&function(f,d){const y=gl[d];return void 0===f.buttons||(f.buttons&y)!==y}(r,this._eventButton))this.reset();else if(this._moved||!(c.dist(a)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(a,c)}mouseupWindow(r){this._lastPoint&&Zr(r)===this._eventButton&&(this._moved&&tr(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kc extends nc{mousedown(r,c){super.mousedown(r,c),this._lastPoint&&(this._active=!0)}_correctButton(r,c){return 0===c&&!r.ctrlKey}_move(r,c){return{around:c,panDelta:c.sub(r)}}}class _l extends nc{_correctButton(r,c){return 0===c&&r.ctrlKey||2===c}_move(r,c){const a=.8*(c.x-r.x);if(a)return this._active=!0,{bearingDelta:a}}contextmenu(r){r.preventDefault()}}class nu extends nc{_correctButton(r,c){return 0===c&&r.ctrlKey||2===c}_move(r,c){const a=-.5*(c.y-r.y);if(a)return this._active=!0,{pitchDelta:a}}contextmenu(r){r.preventDefault()}}class yl{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),u.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new u.pointGeometry(0,0)}touchstart(r,c,a){return this._calculateTransform(r,c,a)}touchmove(r,c,a){if(this._active&&!(a.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===a.length&&!u.isFullscreen())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,c,a)}}touchend(r,c,a){this._calculateTransform(r,c,a),this._active&&a.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,c,a){a.length>0&&(this._active=!0);const f=Rc(a,c),d=new u.pointGeometry(0,0),y=new u.pointGeometry(0,0);let x=0;for(const C in f){const k=f[C],U=this._touches[C];U&&(d._add(k),y._add(k.sub(U)),x++,f[C]=k)}if(this._touches=f,x<this._minTouches||!y.mag())return;const E=y.div(x);return this._sum._add(E),this._sum.mag()<this._clickTolerance?void 0:{around:d.div(x),panDelta:E}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=gt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","null")},500)}}class rc{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,c,a){return{}}touchstart(r,c,a){this._firstTwoTouches||a.length<2||(this._firstTwoTouches=[a[0].identifier,a[1].identifier],this._start([c[0],c[1]]))}touchmove(r,c,a){const f=this._firstTwoTouches;if(!f)return;r.preventDefault();const[d,y]=f,x=zl(a,c,d),E=zl(a,c,y);if(!x||!E)return;const C=this._aroundCenter?null:x.add(E).div(2);return this._move([x,E],C,r)}touchend(r,c,a){if(!this._firstTwoTouches)return;const[f,d]=this._firstTwoTouches,y=zl(a,c,f),x=zl(a,c,d);y&&x||(this._active&&tr(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function zl(p,r,c){for(let a=0;a<p.length;a++)if(p[a].identifier===c)return r[a]}function Jo(p,r){return Math.log(p/r)/Math.LN2}class Ru extends rc{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,c){const a=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Jo(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Jo(this._distance,a),pinchAround:c}}}function ja(p,r){return 180*p.angleWith(r)/Math.PI}class rl extends rc{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,c){const a=this._vector;if(this._vector=r[0].sub(r[1]),a&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:ja(this._vector,a),pinchAround:c}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const c=25/(Math.PI*this._minDiameter)*360,a=this._startVector;if(!a)return!1;const f=ja(r,a);return Math.abs(f)<c}}function Lc(p){return Math.abs(p.y)>Math.abs(p.x)}class Lo extends rc{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Lc(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,c,a){const f=this._lastPoints;if(!f)return;const d=r[0].sub(f[0]),y=r[1].sub(f[1]);return this._map._cooperativeGestures&&!u.isFullscreen()&&a.touches.length<3||(this._valid=this.gestureBeginsVertically(d,y,a.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(d.y+y.y)/2*-.5})}gestureBeginsVertically(r,c,a){if(void 0!==this._valid)return this._valid;const f=r.mag()>=2,d=c.mag()>=2;if(!f&&!d)return;if(!f||!d)return null==this._firstMove&&(this._firstMove=a),a-this._firstMove<100&&void 0;const y=r.y>0==c.y>0;return Lc(r)&&Lc(c)&&y}}const hh={panStep:100,bearingStep:15,pitchStep:10};class Bl{constructor(){const r=hh;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let c=0,a=0,f=0,d=0,y=0;switch(r.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:r.shiftKey?a=-1:(r.preventDefault(),d=-1);break;case 39:r.shiftKey?a=1:(r.preventDefault(),d=1);break;case 38:r.shiftKey?f=1:(r.preventDefault(),y=-1);break;case 40:r.shiftKey?f=-1:(r.preventDefault(),y=1);break;default:return}return this._rotationDisabled&&(a=0,f=0),{cameraAnimation:x=>{const E=x.getZoom();x.easeTo({duration:300,easeId:"keyboardHandler",easing:dh,zoom:c?Math.round(E)+c*(r.shiftKey?2:1):E,bearing:x.getBearing()+a*this._bearingStep,pitch:x.getPitch()+f*this._pitchStep,offset:[-d*this._panStep,-y*this._panStep],center:x.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function dh(p){return p*(2-p)}const ic=4.000244140625;class ta{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,u.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&"center"===r.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||u.isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=r.deltaMode===u.window.WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const a=u.exported.now(),f=a-(this._lastWheelEventTime||0);this._lastWheelEventTime=a,0!==c&&c%ic==0?this._type="wheel":0!==c&&Math.abs(c)<4?this._type="trackpad":f>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(f*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),r.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=r,this._delta-=c,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=dt(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;"wheel"===this._type&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(0!==this._delta){const E="wheel"===this._type&&Math.abs(this._delta)>ic?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*E)));this._delta<0&&0!==C&&(C=1/C);const k=c(),U=Math.pow(2,k),Y="number"==typeof this._targetZoom?r.zoomScale(this._targetZoom):U;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(Y*C))),"wheel"===this._type&&(this._startZoom=k,this._easing=this._smoothOutEasing(200)),this._delta=0}const a="number"==typeof this._targetZoom?this._targetZoom:c(),f=this._startZoom,d=this._easing;let y,x=!1;if("wheel"===this._type&&f&&d){const E=Math.min((u.exported.now()-this._lastWheelEventTime)/200,1),C=d(E);y=u.number(f,a,C),E<1?this._frameId||(this._frameId=!0):x=!0}else y=a,x=!0;return this._active=!0,x&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!x,zoomDelta:y-c(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let c=u.ease;if(this._prevEase){const a=this._prevEase,f=(u.exported.now()-a.start)/a.duration,d=a.easing(f+.01)-a.easing(f),y=.27/Math.sqrt(d*d+1e-4)*.01,x=Math.sqrt(.0729-y*y);c=u.bezier(y,x,.25,1)}return this._prevEase={start:u.exported.now(),duration:r,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=gt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(u.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","null")},200)}}class Ps{constructor(r,c){this._clickZoom=r,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class vl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,c){return r.preventDefault(),{cameraAnimation:a=>{a.easeTo({duration:300,zoom:a.getZoom()+(r.shiftKey?-1:1),around:a.unproject(c)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class $o{constructor(){this._tap=new Ol({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,c,a){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?a.length>0&&(this._swipePoint=c[0],this._swipeTouch=a[0].identifier):this._tap.touchstart(r,c,a))}touchmove(r,c,a){if(this._tapTime){if(this._swipePoint){if(a[0].identifier!==this._swipeTouch)return;const f=c[0],d=f.y-this._swipePoint.y;return this._swipePoint=f,r.preventDefault(),this._active=!0,{zoomDelta:d/128}}}else this._tap.touchmove(r,c,a)}touchend(r,c,a){this._tapTime?this._swipePoint&&0===a.length&&this.reset():this._tap.touchend(r,c,a)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class il{constructor(r,c,a){this._el=r,this._mousePan=c,this._touchPan=a}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class fn{constructor(r,c,a){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=c,this._mousePitch=a}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Rs{constructor(r,c,a,f){this._el=r,this._touchZoom=c,this._touchRotate=a,this._tapDragZoom=f,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const ol=p=>p.zoom||p.drag||p.pitch||p.rotate;class xl extends u.Event{}class Va{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,c){const a=u.sub([],c,r);this.radius=u.length(a[2]<0?u.div([],a,this.constants):[a[0],a[1],0])}projectRay(r){u.div(r,r,this.constants),u.normalize(r,r),u.mul$1(r,r,this.constants);const c=u.scale$2([],r,this.radius);if(c[2]>0){const a=u.scale$2([],[0,0,1],u.dot(c,[0,0,1])),f=u.scale$2([],u.normalize([],[c[0],c[1],0]),this.radius),d=u.add([],c,u.scale$2([],u.sub([],u.add([],f,a),c),2));c[0]=d[0],c[1]=d[1]}return c}}function ru(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class iu{constructor(r,c){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ca(r),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Va,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),u.bindAll(["handleEvent","handleWindowEvent"],this);const a=this._el;this._listeners=[[a,"touchstart",{passive:!0}],[a,"touchmove",{passive:!1}],[a,"touchend",void 0],[a,"touchcancel",void 0],[a,"mousedown",void 0],[a,"mousemove",void 0],[a,"mouseup",void 0],[u.window.document,"mousemove",{capture:!0}],[u.window.document,"mouseup",void 0],[a,"mouseover",void 0],[a,"mouseout",void 0],[a,"dblclick",void 0],[a,"click",void 0],[a,"keydown",{capture:!1}],[a,"keyup",void 0],[a,"wheel",{passive:!1}],[a,"contextmenu",void 0],[u.window,"blur",void 0]];for(const[f,d,y]of this._listeners)f.addEventListener(d,f===u.window.document?this.handleWindowEvent:this.handleEvent,y)}destroy(){for(const[r,c,a]of this._listeners)r.removeEventListener(c,r===u.window.document?this.handleWindowEvent:this.handleEvent,a)}_addDefaultHandlers(r){const c=this._map,a=c.getCanvasContainer();this._add("mapEvent",new Pu(c,r));const f=c.boxZoom=new Pc(c,r);this._add("boxZoom",f);const d=new Fl,y=new vl;c.doubleClickZoom=new Ps(y,d),this._add("tapZoom",d),this._add("clickZoom",y);const x=new $o;this._add("tapDragZoom",x);const E=c.touchPitch=new Lo(c);this._add("touchPitch",E);const C=new _l(r),k=new nu(r);c.dragRotate=new fn(r,C,k),this._add("mouseRotate",C,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const U=new kc(r),Y=new yl(c,r);c.dragPan=new il(a,U,Y),this._add("mousePan",U),this._add("touchPan",Y,["touchZoom","touchRotate"]);const oe=new rl,le=new Ru;c.touchZoomRotate=new Rs(a,le,oe,x),this._add("touchRotate",oe,["touchPan","touchZoom"]),this._add("touchZoom",le,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Ll(c));const he=c.scrollZoom=new ta(c,this);this._add("scrollZoom",he,["mousePan"]);const me=c.keyboard=new Bl;this._add("keyboard",me);for(const ee of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[ee]&&c[ee].enable(r[ee])}_add(r,c,a){this._handlers.push({handlerName:r,handler:c,allowed:a}),this._handlersById[r]=c}stop(r){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[]}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!ol(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,c,a){for(const f in r)if(f!==a&&(!c||c.indexOf(f)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const c=[];for(const a of r)this._el.contains(a.target)&&c.push(a);return c}handleEvent(r,c){this._updatingCamera=!0;const a="renderFrame"===r.type,f=a?void 0:r,d={needsRenderFrame:!1},y={},x={},E=r.touches?this._getMapTouches(r.touches):void 0,C=E?Lr(this._el,E):a?void 0:dt(this._el,r);for(const{handlerName:Y,handler:oe,allowed:le}of this._handlers){if(!oe.isEnabled())continue;let he;this._blockedByActive(x,le,Y)?oe.reset():oe[c||r.type]&&(he=oe[c||r.type](r,C,E),this.mergeHandlerResult(d,y,he,Y,f),he&&he.needsRenderFrame&&this._triggerRenderFrame()),(he||oe.isActive())&&(x[Y]=oe)}const k={};for(const Y in this._previousActiveHandlers)x[Y]||(k[Y]=f);this._previousActiveHandlers=x,(Object.keys(k).length||ru(d))&&(this._changes.push([d,y,k]),this._triggerRenderFrame()),(Object.keys(x).length||ru(d))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=d;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(r,c,a,f,d){if(!a)return;u.extend(r,a);const y={handlerName:f,originalEvent:a.originalEvent||d};void 0!==a.zoomDelta&&(c.zoom=y),void 0!==a.panDelta&&(c.drag=y),void 0!==a.pitchDelta&&(c.pitch=y),void 0!==a.bearingDelta&&(c.rotate=y)}_applyChanges(){const r={},c={},a={};for(const[f,d,y]of this._changes)f.panDelta&&(r.panDelta=(r.panDelta||new u.pointGeometry(0,0))._add(f.panDelta)),f.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+f.zoomDelta),f.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+f.bearingDelta),f.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+f.pitchDelta),void 0!==f.around&&(r.around=f.around),void 0!==f.aroundCoord&&(r.aroundCoord=f.aroundCoord),void 0!==f.pinchAround&&(r.pinchAround=f.pinchAround),f.noInertia&&(r.noInertia=f.noInertia),u.extend(c,d),u.extend(a,y);this._updateMapTransform(r,c,a),this._changes=[]}_updateMapTransform(r,c,a){const f=this._map,d=f.transform,y=be=>[be.x,be.y,be.z];if((be=>{const ye=this._eventsInProgress.drag;return ye&&!this._handlersById[ye.handlerName].isActive()})()&&!ru(r)){const be=d.zoom;d.cameraElevationReference="sea",d.recenterOnTerrain(),d.cameraElevationReference="ground",be!==d.zoom&&this._map._update(!0)}if(d._isCameraConstrained&&f._stop(!0),!ru(r))return void this._fireEvents(c,a,!0);let{panDelta:x,zoomDelta:E,bearingDelta:C,pitchDelta:k,around:U,aroundCoord:Y,pinchAround:oe}=r;d._isCameraConstrained&&(E>0&&(E=0),d._isCameraConstrained=!1),void 0!==oe&&(U=oe),(E||(be=>c.drag&&!this._eventsInProgress.drag)())&&U&&(this._dragOrigin=y(d.pointCoordinate3D(U)),this._trackingEllipsoid.setup(d._camera.position,this._dragOrigin)),d.cameraElevationReference="sea",f._stop(!0),U=U||f.transform.centerPoint,C&&(d.bearing+=C),k&&(d.pitch+=k),d._updateCameraState();const le=[0,0,0];if(x)if("mercator"===d.projection.name){const be=this._trackingEllipsoid.projectRay(d.screenPointToMercatorRay(U).dir),ye=this._trackingEllipsoid.projectRay(d.screenPointToMercatorRay(U.sub(x)).dir);le[0]=ye[0]-be[0],le[1]=ye[1]-be[1]}else{const be=d.pointCoordinate(U);if("globe"===d.projection.name){x=x.rotate(-d.angle);const ye=d._pixelsPerMercatorPixel/d.worldSize;le[0]=-x.x*u.mercatorScale(u.latFromMercatorY(be.y))*ye,le[1]=-x.y*u.mercatorScale(d.center.lat)*ye}else{const ye=d.pointCoordinate(U.sub(x));be&&ye&&(le[0]=ye.x-be.x,le[1]=ye.y-be.y)}}const he=d.zoom,me=[0,0,0];if(E){const be=y(Y||d.pointCoordinate3D(U)),ye={dir:u.normalize([],u.sub([],be,d._camera.position))};if(ye.dir[2]<0){const De=d.zoomDeltaToMovement(be,E);u.scale$2(me,ye.dir,De)}}const ee=u.add(le,le,me);d._translateCameraConstrained(ee),E&&Math.abs(d.zoom-he)>1e-4&&d.recenterOnTerrain(),d.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(c,a,!0)}_fireEvents(r,c,a){const f=ol(this._eventsInProgress),d=ol(r),y={};for(const k in r){const{originalEvent:U}=r[k];this._eventsInProgress[k]||(y[`${k}start`]=U),this._eventsInProgress[k]=r[k]}!f&&d&&this._fireEvent("movestart",d.originalEvent);for(const k in y)this._fireEvent(k,y[k]);d&&this._fireEvent("move",d.originalEvent);for(const k in r){const{originalEvent:U}=r[k];this._fireEvent(k,U)}const x={};let E;for(const k in this._eventsInProgress){const{handlerName:U,originalEvent:Y}=this._eventsInProgress[k];this._handlersById[U].isActive()||(delete this._eventsInProgress[k],E=c[U]||Y,x[`${k}end`]=E)}for(const k in x)this._fireEvent(k,x[k]);const C=ol(this._eventsInProgress);if(a&&(f||d)&&!C){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=Y=>0!==Y&&-this._bearingSnap<Y&&Y<this._bearingSnap;k?(U(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:E})):(this._map.fire(new u.Event("moveend",{originalEvent:E})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,c){this._map.fire(new u.Event(r,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new xl("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const fi="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class ou extends u.Evented{constructor(r,c){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=c.bearingSnap,u.bindAll(["_renderFrameCallback"],this)}getCenter(){return new u.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(r,c){return this.jumpTo({center:r},c)}panBy(r,c,a){return r=u.pointGeometry.convert(r).mult(-1),this.panTo(this.transform.center,u.extend({offset:r},c),a)}panTo(r,c,a){return this.easeTo(u.extend({center:r},c),a)}getZoom(){return this.transform.zoom}setZoom(r,c){return this.jumpTo({zoom:r},c),this}zoomTo(r,c,a){return this.easeTo(u.extend({zoom:r},c),a)}zoomIn(r,c){return this.zoomTo(this.getZoom()+1,r,c),this}zoomOut(r,c){return this.zoomTo(this.getZoom()-1,r,c),this}getBearing(){return this.transform.bearing}setBearing(r,c){return this.jumpTo({bearing:r},c),this}getPadding(){return this.transform.padding}setPadding(r,c){return this.jumpTo({padding:r},c),this}rotateTo(r,c,a){return this.easeTo(u.extend({bearing:r},c),a)}resetNorth(r,c){return this.rotateTo(0,u.extend({duration:1e3},r),c),this}resetNorthPitch(r,c){return this.easeTo(u.extend({bearing:0,pitch:0,duration:1e3},r),c),this}snapToNorth(r,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,c):this}getPitch(){return this.transform.pitch}setPitch(r,c){return this.jumpTo({pitch:r},c),this}cameraForBounds(r,c){r=u.LngLatBounds.convert(r);const a=c&&c.bearing||0,f=c&&c.pitch||0,d=r.getNorthWest(),y=r.getSouthEast();return this._cameraForBounds(this.transform,d,y,a,f,c)}_extendCameraOptions(r){const c={top:0,bottom:0,right:0,left:0};if("number"==typeof(r=u.extend({padding:c,offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding){const a=r.padding;r.padding={top:a,bottom:a,right:a,left:a}}return r.padding=u.extend(c,r.padding),r}_minimumAABBFrustumDistance(r,c){const a=c.max[0]-c.min[0],f=c.max[1]-c.min[1];return a/f>r.aspect?a/(2*Math.tan(.5*r.fovX)*r.aspect):f/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,c,a,f,d,y){const x=r.clone(),E=this._extendCameraOptions(y);x.bearing=f,x.pitch=d;const C=u.LngLat.convert(c),k=u.LngLat.convert(a),U=.5*(C.lat+k.lat),Y=.5*(C.lng+k.lng),oe=u.latLngToECEF(U,Y),le=u.normalize([],oe),he=u.normalize([],u.cross([],le,[0,1,0])),me=u.cross([],he,le),ee=[he[0],he[1],he[2],0,me[0],me[1],me[2],0,le[0],le[1],le[2],0,0,0,0,1],be=[oe,u.latLngToECEF(C.lat,C.lng),u.latLngToECEF(k.lat,C.lng),u.latLngToECEF(k.lat,k.lng),u.latLngToECEF(C.lat,k.lng),u.latLngToECEF(U,C.lng),u.latLngToECEF(U,k.lng),u.latLngToECEF(C.lat,Y),u.latLngToECEF(k.lat,Y)];let ye=u.Aabb.fromPoints(be.map(Ct=>[u.dot(he,Ct),u.dot(me,Ct),u.dot(le,Ct)]));const De=u.transformMat4([],ye.center,ee);0===u.squaredLength(De)&&u.set(De,0,0,1),u.normalize(De,De),u.scale$2(De,De,u.GLOBE_RADIUS),x.center=u.ecefToLatLng(De);const ke=x.getWorldToCameraMatrix(),Ae=u.invert(new Float64Array(16),ke);ye=u.Aabb.applyTransform(ye,u.multiply([],ke,ee)),u.transformMat4(De,De,ke);const Be=.5*(ye.max[2]-ye.min[2]),He=this._minimumAABBFrustumDistance(x,ye),Xe=u.scale$2([],[0,0,1],Be),Qe=u.add(Xe,De,Xe),qt=He+(0===x.pitch?0:u.distance(De,Qe)),qe=x.globeCenterInViewSpace,Tt=u.sub([],De,[qe[0],qe[1],qe[2]]);u.normalize(Tt,Tt),u.scale$2(Tt,Tt,qt);const at=u.add([],De,Tt);u.transformMat4(at,at,Ae);const kt=u.earthRadius/u.GLOBE_RADIUS,Ye=u.length(at),Ge=u.mercatorZfromAltitude(Math.max(Ye*kt-u.earthRadius,Number.EPSILON),0),it=Math.min(x.zoomFromMercatorZAdjusted(Ge),E.maxZoom);return it>.5*(u.GLOBE_ZOOM_THRESHOLD_MIN+u.GLOBE_ZOOM_THRESHOLD_MAX)?(x.setProjection({name:"mercator"}),x.zoom=it,this._cameraForBounds(x,c,a,f,d,y)):{center:x.center,zoom:it,bearing:f,pitch:d}}queryTerrainElevation(r,c){const a=this.transform.elevation;return a?(c=u.extend({},{exaggerated:!0},c),a.getAtPoint(u.MercatorCoordinate.fromLngLat(r),null,c.exaggerated)):null}_cameraForBounds(r,c,a,f,d,y){if("globe"===r.projection.name)return this._cameraForBoundsOnGlobe(r,c,a,f,d,y);const x=r.clone(),E=this._extendCameraOptions(y),C=x.padding;x.bearing=f,x.pitch=d;const k=u.LngLat.convert(c),U=u.LngLat.convert(a),Y=new u.LngLat(k.lng,U.lat),oe=new u.LngLat(U.lng,k.lat),le=x.project(k),he=x.project(U),me=this.queryTerrainElevation(k),ee=this.queryTerrainElevation(U),be=this.queryTerrainElevation(Y),ye=this.queryTerrainElevation(oe),De=[[le.x,le.y,Math.min(me||0,ee||0,be||0,ye||0)],[he.x,he.y,Math.max(me||0,ee||0,be||0,ye||0)]];let ke=u.Aabb.fromPoints(De);const Ae=x.getWorldToCameraMatrix(),Be=u.invert(new Float64Array(16),Ae);ke=u.Aabb.applyTransform(ke,Ae);const He=u.sub([],ke.max,ke.min),Xe=C.left||0,Qe=C.right||0,qt=C.bottom||0,qe=C.top||0,{left:Tt,right:at,top:kt,bottom:Ye}=E.padding,Ge=.5*(Xe+Qe),it=.5*(qe+qt),Ct=Math.min(x.scaleZoom(x.scale*Math.min((x.width-(Xe+Qe+Tt+at))/He[0],(x.height-(qt+qe+Ye+kt))/He[1])),E.maxZoom),Bt=x.scale/x.zoomScale(Ct);ke=new u.Aabb([ke.min[0]-(Tt+Ge)*Bt,ke.min[1]-(Ye+it)*Bt,ke.min[2]],[ke.max[0]+(at+Ge)*Bt,ke.max[1]+(kt+it)*Bt,ke.max[2]]);const Mn=.5*He[2],_r=this._minimumAABBFrustumDistance(x,ke),wn=[0,0,1,0];u.transformMat4$1(wn,wn,Ae),u.normalize$2(wn,wn);const pn=u.scale$2([],wn,_r+Mn),Rn=u.add([],ke.center,pn),Ir=("number"==typeof E.offset.x&&"number"==typeof E.offset.y?new u.pointGeometry(E.offset.x,E.offset.y):u.pointGeometry.convert(E.offset)).rotate(-u.degToRad(f));ke.center[0]-=Ir.x*Bt,ke.center[1]+=Ir.y*Bt,u.transformMat4(ke.center,ke.center,Be),u.transformMat4(Rn,Rn,Be);const zn=[ke.center[0],ke.center[1],Rn[2]*x.pixelsPerMeter];u.scale$2(zn,zn,1/x.worldSize);const ti=u.lngFromMercatorX(zn[0]),pi=u.latFromMercatorY(zn[1]),mi=Math.min(x._zoomFromMercatorZ(zn[2]),E.maxZoom),Si=new u.LngLat(ti,pi);return x.mercatorFromTransition&&mi<.5*(u.GLOBE_ZOOM_THRESHOLD_MIN+u.GLOBE_ZOOM_THRESHOLD_MAX)?(x.setProjection({name:"globe"}),x.zoom=mi,this._cameraForBounds(x,c,a,f,d,y)):{center:Si,zoom:mi,bearing:f,pitch:d}}fitBounds(r,c,a){const f=this.cameraForBounds(r,c);return this._fitInternal(f,c,a)}fitScreenCoordinates(r,c,a,f,d){const y=u.pointGeometry.convert(r),x=u.pointGeometry.convert(c),E=new u.pointGeometry(Math.min(y.x,x.x),Math.min(y.y,x.y)),C=new u.pointGeometry(Math.max(y.x,x.x),Math.max(y.y,x.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(y,x))return this;const k=this.transform.pointLocation3D(E),U=this.transform.pointLocation3D(C),Y=this.transform.pointLocation3D(new u.pointGeometry(E.x,C.y)),oe=this.transform.pointLocation3D(new u.pointGeometry(C.x,E.y)),le=[Math.min(k.lng,U.lng,Y.lng,oe.lng),Math.min(k.lat,U.lat,Y.lat,oe.lat)],he=[Math.max(k.lng,U.lng,Y.lng,oe.lng),Math.max(k.lat,U.lat,Y.lat,oe.lat)],me=f&&f.pitch?f.pitch:this.getPitch(),ee=this._cameraForBounds(this.transform,le,he,a,me,f);return this._fitInternal(ee,f,d)}_fitInternal(r,c,a){return r?(delete(c=u.extend(r,c)).padding,c.linear?this.easeTo(c,a):this.flyTo(c,a)):this}jumpTo(r,c){this.stop();const a=r.preloadOnly?this.transform.clone():this.transform;let f=!1,d=!1,y=!1;return"zoom"in r&&a.zoom!==+r.zoom&&(f=!0,a.zoom=+r.zoom),void 0!==r.center&&(a.center=u.LngLat.convert(r.center)),"bearing"in r&&a.bearing!==+r.bearing&&(d=!0,a.bearing=+r.bearing),"pitch"in r&&a.pitch!==+r.pitch&&(y=!0,a.pitch=+r.pitch),null==r.padding||a.isPaddingEqual(r.padding)||(a.padding=r.padding),r.preloadOnly?(this._preloadTiles(a),this):(this.fire(new u.Event("movestart",c)).fire(new u.Event("move",c)),f&&this.fire(new u.Event("zoomstart",c)).fire(new u.Event("zoom",c)).fire(new u.Event("zoomend",c)),d&&this.fire(new u.Event("rotatestart",c)).fire(new u.Event("rotate",c)).fire(new u.Event("rotateend",c)),y&&this.fire(new u.Event("pitchstart",c)).fire(new u.Event("pitch",c)).fire(new u.Event("pitchend",c)),this.fire(new u.Event("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||u.warnOnce(fi),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,c){const a=this.transform;if(!a.projection.supportsFreeCamera)return u.warnOnce(fi),this;this.stop();const f=a.zoom,d=a.pitch,y=a.bearing;a.setFreeCameraOptions(r);const x=f!==a.zoom,E=d!==a.pitch,C=y!==a.bearing;return this.fire(new u.Event("movestart",c)).fire(new u.Event("move",c)),x&&this.fire(new u.Event("zoomstart",c)).fire(new u.Event("zoom",c)).fire(new u.Event("zoomend",c)),C&&this.fire(new u.Event("rotatestart",c)).fire(new u.Event("rotate",c)).fire(new u.Event("rotateend",c)),E&&this.fire(new u.Event("pitchstart",c)).fire(new u.Event("pitch",c)).fire(new u.Event("pitchend",c)),this.fire(new u.Event("moveend",c)),this}easeTo(r,c){this._stop(!1,r.easeId),(!1===(r=u.extend({offset:[0,0],duration:500,easing:u.ease},r)).animate||!r.essential&&u.exported.prefersReducedMotion)&&(r.duration=0);const a=this.transform,f=this.getZoom(),d=this.getBearing(),y=this.getPitch(),x=this.getPadding(),E="zoom"in r?+r.zoom:f,C="bearing"in r?this._normalizeBearing(r.bearing,d):d,k="pitch"in r?+r.pitch:y,U="padding"in r?r.padding:a.padding,Y=u.pointGeometry.convert(r.offset);let oe,le,he;if("globe"===a.projection.name){const Xe=u.MercatorCoordinate.fromLngLat(a.center),Qe=Y.rotate(-a.angle);Xe.x+=Qe.x/a.worldSize,Xe.y+=Qe.y/a.worldSize;const qt=Xe.toLngLat(),qe=u.LngLat.convert(r.center||qt);this._normalizeCenter(qe),oe=a.centerPoint.add(Qe),le=new u.pointGeometry(Xe.x,Xe.y).mult(a.worldSize),he=new u.pointGeometry(u.mercatorXfromLng(qe.lng),u.mercatorYfromLat(qe.lat)).mult(a.worldSize).sub(le)}else{oe=a.centerPoint.add(Y);const Xe=a.pointLocation(oe),Qe=u.LngLat.convert(r.center||Xe);this._normalizeCenter(Qe),le=a.project(Xe),he=a.project(Qe).sub(le)}const me=a.zoomScale(E-f);let ee,be;r.around&&(ee=u.LngLat.convert(r.around),be=a.locationPoint(ee));const ye=this._zooming||E!==f,De=this._rotating||d!==C,ke=this._pitching||k!==y,Ae=!a.isPaddingEqual(U),Be=Xe=>Qe=>{if(ye&&(Xe.zoom=u.number(f,E,Qe)),De&&(Xe.bearing=u.number(d,C,Qe)),ke&&(Xe.pitch=u.number(y,k,Qe)),Ae&&(Xe.interpolatePadding(x,U,Qe),oe=Xe.centerPoint.add(Y)),ee)Xe.setLocationAtPoint(ee,be);else{const qt=Xe.zoomScale(Xe.zoom-f),qe=E>f?Math.min(2,me):Math.max(.5,me),Tt=Math.pow(qe,1-Qe),at=Xe.unproject(le.add(he.mult(Qe*Tt)).mult(qt));Xe.setLocationAtPoint(Xe.renderWorldCopies?at.wrap():at,oe)}return r.preloadOnly||this._fireMoveEvents(c),Xe};if(r.preloadOnly){const Xe=this._emulate(Be,r.duration,a);return this._preloadTiles(Xe),this}const He={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ye,this._rotating=De,this._pitching=ke,this._padding=Ae,this._easeId=r.easeId,this._prepareEase(c,r.noMoveStart,He),this._ease(Be(a),Xe=>{a.recenterOnTerrain(),this._afterEase(c,Xe)},r),this}_prepareEase(r,c,a={}){this._moving=!0,this.transform.cameraElevationReference="sea",c||a.moving||this.fire(new u.Event("movestart",r)),this._zooming&&!a.zooming&&this.fire(new u.Event("zoomstart",r)),this._rotating&&!a.rotating&&this.fire(new u.Event("rotatestart",r)),this._pitching&&!a.pitching&&this.fire(new u.Event("pitchstart",r))}_fireMoveEvents(r){this.fire(new u.Event("move",r)),this._zooming&&this.fire(new u.Event("zoom",r)),this._rotating&&this.fire(new u.Event("rotate",r)),this._pitching&&this.fire(new u.Event("pitch",r))}_afterEase(r,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const a=this._zooming,f=this._rotating,d=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,a&&this.fire(new u.Event("zoomend",r)),f&&this.fire(new u.Event("rotateend",r)),d&&this.fire(new u.Event("pitchend",r)),this.fire(new u.Event("moveend",r))}flyTo(r,c){if(!r.essential&&u.exported.prefersReducedMotion){const Ct=u.pick(r,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ct,c)}this.stop(),r=u.extend({offset:[0,0],speed:1.2,curve:1.42,easing:u.ease},r);const a=this.transform,f=this.getZoom(),d=this.getBearing(),y=this.getPitch(),x=this.getPadding(),E="zoom"in r?u.clamp(+r.zoom,a.minZoom,a.maxZoom):f,C="bearing"in r?this._normalizeBearing(r.bearing,d):d,k="pitch"in r?+r.pitch:y,U="padding"in r?r.padding:a.padding,Y=a.zoomScale(E-f),oe=u.pointGeometry.convert(r.offset);let le=a.centerPoint.add(oe);const he=a.pointLocation(le),me=u.LngLat.convert(r.center||he);this._normalizeCenter(me);const ee=a.project(he),be=a.project(me).sub(ee);let ye=r.curve;const De=Math.max(a.width,a.height),ke=De/Y,Ae=be.mag();if("minZoom"in r){const Ct=u.clamp(Math.min(r.minZoom,f,E),a.minZoom,a.maxZoom),Bt=De/a.zoomScale(Ct-f);ye=Math.sqrt(Bt/Ae*2)}const Be=ye*ye;function He(Ct){const Bt=(ke*ke-De*De+(Ct?-1:1)*Be*Be*Ae*Ae)/(2*(Ct?ke:De)*Be*Ae);return Math.log(Math.sqrt(Bt*Bt+1)-Bt)}function Xe(Ct){return(Math.exp(Ct)-Math.exp(-Ct))/2}function Qe(Ct){return(Math.exp(Ct)+Math.exp(-Ct))/2}const qt=He(0);let qe=function(Ct){return Qe(qt)/Qe(qt+ye*Ct)},Tt=function(Ct){return De*((Qe(qt)*(Xe(Bt=qt+ye*Ct)/Qe(Bt))-Xe(qt))/Be)/Ae;var Bt},at=(He(1)-qt)/ye;if(Math.abs(Ae)<1e-6||!isFinite(at)){if(Math.abs(De-ke)<1e-6)return this.easeTo(r,c);const Ct=ke<De?-1:1;at=Math.abs(Math.log(ke/De))/ye,Tt=function(){return 0},qe=function(Bt){return Math.exp(Ct*ye*Bt)}}r.duration="duration"in r?+r.duration:1e3*at/("screenSpeed"in r?+r.screenSpeed/ye:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const kt=d!==C,Ye=k!==y,Ge=!a.isPaddingEqual(U),it=Ct=>Bt=>{const Mn=Bt*at,_r=1/qe(Mn);Ct.zoom=1===Bt?E:f+Ct.scaleZoom(_r),kt&&(Ct.bearing=u.number(d,C,Bt)),Ye&&(Ct.pitch=u.number(y,k,Bt)),Ge&&(Ct.interpolatePadding(x,U,Bt),le=Ct.centerPoint.add(oe));const wn=1===Bt?me:Ct.unproject(ee.add(be.mult(Tt(Mn))).mult(_r));return Ct.setLocationAtPoint(Ct.renderWorldCopies?wn.wrap():wn,le),Ct._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(c),Ct};if(r.preloadOnly){const Ct=this._emulate(it,r.duration,a);return this._preloadTiles(Ct),this}return this._zooming=!0,this._rotating=kt,this._pitching=Ye,this._padding=Ge,this._prepareEase(c,!1),this._ease(it(a),()=>this._afterEase(c),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(r,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const a=this._onEaseEnd;this._onEaseEnd=void 0,a.call(this,c)}if(!r){const a=this.handlers;a&&a.stop(!1)}return this}_ease(r,c,a){!1===a.animate||0===a.duration?(r(1),c()):(this._easeStart=u.exported.now(),this._easeOptions=a,this._onEaseFrame=r,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((u.exported.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,c){r=u.wrap(r,-180,180);const a=Math.abs(r-c);return Math.abs(r-360-c)<a&&(r-=360),Math.abs(r+360-c)<a&&(r+=360),r}_normalizeCenter(r){const c=this.transform;if(!c.renderWorldCopies||c.maxBounds)return;const a=r.lng-c.center.lng;r.lng+=a>180?-360:a<-180?360:0}_emulate(r,c,a){const f=Math.ceil(15*c/1e3),d=[],y=r(a.clone());for(let x=0;x<=f;x++){const E=y(x/f);d.push(E.clone())}return d}}class ku{constructor(r={}){this.options=r,u.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const c=this.options&&this.options.compact;return this._map=r,this._container=gt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=gt("button","mapboxgl-ctrl-attrib-button",this._container),gt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=gt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===c&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(r,c){const a=this._map._getUIString(`AttributionControl.${c}`);r.setAttribute("aria-label",a),r.removeAttribute("title"),r.firstElementChild&&r.firstElementChild.setAttribute("title",a)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||u.config.ACCESS_TOKEN}];if(r){const a=c.reduce((f,d,y)=>(d.value&&(f+=`${d.key}=${d.value}${y<c.length-1?"&":""}`),f),"?");r.href=`${u.config.FEEDBACK_URL}/${a}#${Ci(this._map,!0)}`,r.rel="noopener nofollow",this._setElementTitle(r,"MapFeedback")}}_updateData(r){!r||"metadata"!==r.sourceDataType&&"visibility"!==r.sourceDataType&&"style"!==r.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const f=this._map.style.stylesheet;this.styleOwner=f.owner,this.styleId=f.id}const c=this._map.style._sourceCaches;for(const f in c){const d=c[f];if(d.used){const y=d.getSource();y.attribution&&r.indexOf(y.attribution)<0&&r.push(y.attribution)}}r.sort((f,d)=>f.length-d.length),r=r.filter((f,d)=>{for(let y=d+1;y<r.length;y++)if(r[y].indexOf(f)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const a=r.join(" | ");a!==this._attribHTML&&(this._attribHTML=a,r.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Lu{constructor(){u.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=gt("div","mapboxgl-ctrl");const c=gt("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&"metadata"!==r.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(0===Object.entries(r).length)return!0;for(const c in r){const a=r[c].getSource();if(a.hasOwnProperty("mapbox_logo")&&!a.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const c=r[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Oc{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const c=++this._id;return this._queue.push({callback:r,id:c,cancelled:!1}),c}remove(r){const c=this._currentlyRunning,a=c?this._queue.concat(c):this._queue;for(const f of a)if(f.id===r)return void(f.cancelled=!0)}run(r=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const a of c)if(!a.cancelled&&(a.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Fc(p,r,c){if(p=new u.LngLat(p.lng,p.lat),r){const a=new u.LngLat(p.lng-360,p.lat),f=new u.LngLat(p.lng+360,p.lat),d=360*Math.ceil(Math.abs(p.lng-c.center.lng)/360),y=c.locationPoint(p).distSqr(r),x=r.x<0||r.y<0||r.x>c.width||r.y>c.height;c.locationPoint(a).distSqr(r)<y&&(x||Math.abs(a.lng-c.center.lng)<d)?p=a:c.locationPoint(f).distSqr(r)<y&&(x||Math.abs(f.lng-c.center.lng)<d)&&(p=f)}for(;Math.abs(p.lng-c.center.lng)>180;){const a=c.locationPoint(p);if(a.x>=0&&a.y>=0&&a.x<=c.width&&a.y<=c.height)break;p.lng>c.center.lng?p.lng-=360:p.lng+=360}return p}const oc={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Ou extends u.Evented{constructor(r,c){if(super(),(r instanceof u.window.HTMLElement||c)&&(r=u.extend({element:r},c)),u.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&r.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),this._occludedOpacity=r&&r.occludedOpacity||.2,r&&r.element)this._element=r.element,this._offset=u.pointGeometry.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=gt("div");const f=41,d=27,y=nt("svg",{display:"block",height:f*this._scale+"px",width:d*this._scale+"px",viewBox:`0 0 ${d} ${f}`},this._element),x=nt("radialGradient",{id:"shadowGradient"},nt("defs",{},y));nt("stop",{offset:"10%","stop-opacity":.4},x),nt("stop",{offset:"100%","stop-opacity":.05},x),nt("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},y),nt("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},y),nt("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},y),nt("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},y),this._offset=u.pointGeometry.convert(r&&r.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()});const a=this._element.classList;for(const f in oc)a.remove(`mapboxgl-marker-anchor-${f}`);a.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=u.LngLat.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const f=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[f,-1*(24.6+f)],"bottom-right":[-f,-1*(24.6+f)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=r,r._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const c=r.code,a=r.charCode||r.keyCode;"Space"!==c&&"Enter"!==c&&32!==a&&13!==a||this.togglePopup()}_onMapClick(r){const c=r.originalEvent.target,a=this._element;this._popup&&(c===a||a.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,c=this._pos;if(!r||!c)return!1;const a=r.unproject(c),f=r.getFreeCameraOptions();if(!f.position)return!1;const d=f.position.toLngLat();return d.distanceTo(a)<.9*d.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const c=this._pos;if(!c||c.x<0||c.x>r.transform.width||c.y<0||c.y>r.transform.height)return void this._clearFadeTimer();const a=r.unproject(c);let f;r._showingGlobe()&&u.isLngLatBehindGlobe(r.transform,this._lngLat)?f=0:(f=1-r._queryFogOpacity(a),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(f*=this._occludedOpacity)),this._element.style.opacity=`${f}`,this._element.style.pointerEvents=f>0?"auto":"none",this._popup&&this._popup._setOpacity(f),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${r.x}px,${r.y}px)\n            ${oc[this._anchor]}\n            ${this._calculateXYTransform()} ${this._calculateZTransform()}\n            translate(${c.x}px,${c.y}px)\n        `}_calculateXYTransform(){const r=this._pos,c=this._map,a=this.getPitchAlignment();if(!c||!r||"map"!==a)return"";if(!c._showingGlobe()){const E=c.getPitch();return E?`rotateX(${E}deg)`:""}const f=u.radToDeg(u.globeTiltAtLngLat(c.transform,this._lngLat)),d=r.sub(u.globeCenterToScreenPoint(c.transform)),y=Math.abs(d.x)+Math.abs(d.y);if(0===y)return"";const x=f/y;return`rotateX(${-d.y*x}deg) rotateY(${d.x*x}deg)`}_calculateZTransform(){const r=this._pos,c=this._map;if(!c||!r)return"";let a=0;const f=this.getRotationAlignment();if("map"===f)if(c._showingGlobe()){const d=c.project(new u.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),y=c.project(new u.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(d);a=u.radToDeg(Math.atan2(y.y,y.x))-90}else a=-c.getBearing();else if("horizon"===f){const d=u.smoothstep(4,6,c.getZoom()),y=u.globeCenterToScreenPoint(c.transform);y.y+=d*c.transform.height;const x=r.sub(y),E=u.radToDeg(Math.atan2(x.y,x.x));a=(E>90?E-270:E+90)*(1-d)}return a+=this._rotation,a?`rotateZ(${a}deg)`:""}_update(r){u.window.cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=Fc(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat),!0===r?this._updateFrameId=u.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=u.pointGeometry.convert(r),this._update(),this}_onMove(r){const c=this._map;if(!c)return;const a=this._pointerdownPos,f=this._positionDelta;if(a&&f){if(!this._isDragging){const d=this._clickTolerance||c._clickTolerance;if(r.point.dist(a)<d)return;this._isDragging=!0}this._pos=r.point.sub(f),this._lngLat=c.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new u.Event("dragstart"))),this.fire(new u.Event("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new u.Event("dragend")),this._state="inactive"}_addDragHandler(r){const c=this._map,a=this._pos;c&&a&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(a),this._pointerdownPos=r.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const c=this._map;return c&&(r?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||.2,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const sc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},sd=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Nl(p=new u.pointGeometry(0,0),r="bottom"){if("number"==typeof p){const c=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(r){case"top":return new u.pointGeometry(0,p);case"top-left":return new u.pointGeometry(c,c);case"top-right":return new u.pointGeometry(-c,c);case"bottom":return new u.pointGeometry(0,-p);case"bottom-left":return new u.pointGeometry(c,-c);case"bottom-right":return new u.pointGeometry(-c,-c);case"left":return new u.pointGeometry(p,0);case"right":return new u.pointGeometry(-p,0)}return new u.pointGeometry(0,0)}return p instanceof u.pointGeometry||Array.isArray(p)?u.pointGeometry.convert(p):u.pointGeometry.convert(p[r]||[0,0])}class To{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const c=u.easeCubicInOut((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,c,a){this._start=this.getValue(c),this._end=r,this._startTime=c,this._endTime=c+a}}const ac={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Ul={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},su={showCompass:!0,showZoom:!0,visualizePitch:!1};class Ws{constructor(r,c,a=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new _l({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,a&&(this.mousePitch=new nu({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),u.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(r,c){this.mouseRotate.mousedown(r,c),this.mousePitch&&this.mousePitch.mousedown(r,c),Jt()}move(r,c){const a=this.map,f=this.mouseRotate.mousemoveWindow(r,c),d=f&&f.bearingDelta;if(d&&a.setBearing(a.getBearing()+d),this.mousePitch){const y=this.mousePitch.mousemoveWindow(r,c),x=y&&y.pitchDelta;x&&a.setPitch(a.getPitch()+x)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart,{passive:!1}),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){hn(),u.window.removeEventListener("mousemove",this.mousemove),u.window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(u.extend({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),dt(this.element,r)),u.window.addEventListener("mousemove",this.mousemove),u.window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,dt(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){1!==r.targetTouches.length?this.reset():(this._startPos=this._lastPos=Lr(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){1!==r.targetTouches.length?this.reset():(this._lastPos=Lr(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){0===r.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const sl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},au={maxWidth:100,unit:"metric"};function lc(p,r,c){const a=al(r),f=a/r,d={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"}[c];this._map._requestDomTask(()=>{this._container.style.width=p*f+"px",this._container.innerHTML=`${a}&nbsp;${d}`})}function al(p){const r=Math.pow(10,`${Math.floor(p)}`.length-1);let c=p/r;return c=c>=10?10:c>=5?5:c>=3?3:c>=2?2:c>=1?1:function(a){const f=Math.pow(10,Math.ceil(-Math.log(a)/Math.LN10));return Math.round(a*f)/f}(c),r*c}const cc={version:u.version,supported:Kt,setRTLTextPlugin:u.setRTLTextPlugin,getRTLTextPluginStatus:u.getRTLTextPluginStatus,Map:class extends ou{constructor(p){if(u.LivePerformanceUtils.mark(u.PerformanceMarkers.create),null!=(p=u.extend({},Ul,p)).minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&u.isSafariWithAntialiasingBug(u.window)&&(p.antialias=!1,u.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new yt(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._useWebGL2=p.useWebGL2,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new Oc,this._domRenderTaskQueue=new Oc,this._controls=[],this._markers=[],this._popups=[],this._mapId=u.uniqueId(),this._locale=u.extend({},ac,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new To(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._requestManager=new u.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,"string"==typeof p.container){if(this._container=u.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof u.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&u.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),u.bindAll(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==u.window&&(u.window.addEventListener("online",this._onWindowOnline,!1),u.window.addEventListener("resize",this._onWindowResize,!1),u.window.addEventListener("orientationchange",this._onWindowResize,!1),u.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1),u.window.addEventListener("visibilitychange",this._onVisibilityChange,!1)),this.handlers=new iu(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new As("string"==typeof p.hash&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,u.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new ku({customAttribution:p.customAttribution})),this._logoControl=new Lu,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",r=>{this._update("style"===r.dataType),this.fire(new u.Event(`${r.dataType}data`,r))}),this.on("dataloading",r=>{this.fire(new u.Event(`${r.dataType}dataloading`,r))})}_getMapId(){return this._mapId}addControl(p,r){if(void 0===r&&(r=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=p.onAdd(this);this._controls.push(p);const a=this._controlPositions[r];return-1!==r.indexOf("bottom")?a.insertBefore(c,a.firstChild):a.appendChild(c),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(p);return r>-1&&this._controls.splice(r,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new u.Event("movestart",p)).fire(new u.Event("move",p)),this.fire(new u.Event("resize",p)),r&&this.fire(new u.Event("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(u.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new u.Event("zoomstart")).fire(new u.Event("zoom")).fire(new u.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new u.Event("zoomstart")).fire(new u.Event("zoom")).fire(new u.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new u.Event("pitchstart")).fire(new u.Event("pitch")).fire(new u.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new u.Event("pitchstart")).fire(new u.Event("pitch")).fire(new u.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return"auto"===p?u.window.navigator.language:Array.isArray(p)?0===p.length?void 0:p.map(r=>"auto"===r?u.window.navigator.language:r):p}setLanguage(p){const r=this._parseLanguage(p);if(!this.style||r===this._language)return this;this._language=r,this.style._reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this.style._reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(p){return this._lazyInitEmptyStyle(),p?"string"==typeof p&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.stylesheet?this.style.stylesheet.projection:null)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const p=this.transform,r=p.projection.name;let c;"globe"===r&&p.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX?(p.setMercatorFromTransition(),c=!0):"mercator"===r&&p.zoom<u.GLOBE_ZOOM_THRESHOLD_MAX&&(p.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate())}_prioritizeAndUpdateProjection(p,r){return this._updateProjection(p||r||{name:"mercator"})}_updateProjection(p){let r;if(r="globe"===p.name&&this.transform.zoom>=u.GLOBE_ZOOM_THRESHOLD_MAX?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),r){this.painter.clearBackgroundTiles();for(const c in this.style._sourceCaches)this.style._sourceCaches[c].clearTiles();this._update(!0),this._forceMarkerAndPopupUpdate(!0)}return this}project(p){return this.transform.locationPoint3D(u.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(u.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,r,c){if("mouseenter"===p||"mouseover"===p){let a=!1;const f=y=>{const x=r.filter(C=>this.getLayer(C)),E=x.length?this.queryRenderedFeatures(y.point,{layers:x}):[];E.length?a||(a=!0,c.call(this,new ro(p,this,y.originalEvent,{features:E}))):a=!1},d=()=>{a=!1};return{layers:new Set(r),listener:c,delegates:{mousemove:f,mouseout:d}}}if("mouseleave"===p||"mouseout"===p){let a=!1;const f=y=>{const x=r.filter(E=>this.getLayer(E));(x.length?this.queryRenderedFeatures(y.point,{layers:x}):[]).length?a=!0:a&&(a=!1,c.call(this,new ro(p,this,y.originalEvent)))},d=y=>{a&&(a=!1,c.call(this,new ro(p,this,y.originalEvent)))};return{layers:new Set(r),listener:c,delegates:{mousemove:f,mouseout:d}}}{const a=f=>{const d=r.filter(x=>this.getLayer(x)),y=d.length?this.queryRenderedFeatures(f.point,{layers:d}):[];y.length&&(f.features=y,c.call(this,f),delete f.features)};return{layers:new Set(r),listener:c,delegates:{[p]:a}}}}on(p,r,c){if(void 0===c)return super.on(p,r);Array.isArray(r)||(r=[r]);const a=this._createDelegatedListener(p,r,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(a);for(const f in a.delegates)this.on(f,a.delegates[f]);return this}once(p,r,c){if(void 0===c)return super.once(p,r);Array.isArray(r)||(r=[r]);const a=this._createDelegatedListener(p,r,c);for(const f in a.delegates)this.once(f,a.delegates[f]);return this}off(p,r,c){if(void 0===c)return super.off(p,r);r=new Set(Array.isArray(r)?r:[r]);const a=(d,y)=>{if(d.size!==y.size)return!1;for(const x of d)if(!y.has(x))return!1;return!0},f=this._delegatedListeners?this._delegatedListeners[p]:void 0;return f&&(d=>{for(let y=0;y<d.length;y++){const x=d[y];if(x.listener===c&&a(x.layers,r)){for(const E in x.delegates)this.off(E,x.delegates[E]);return d.splice(y,1),this}}})(f),this}queryRenderedFeatures(p,r){return this.style?(void 0!==r||void 0===p||p instanceof u.pointGeometry||Array.isArray(p)||(r=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],r=r||{},this.transform)):[]}querySourceFeatures(p,r){return this.style.querySourceFeatures(p,r)}setStyle(p,r){return!1!==(r=u.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r)).diff&&r.localIdeographFontFamily===this._localIdeographFontFamily&&r.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,r),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(p,r))}_getUIString(p){const r=this._locale[p];if(null==r)throw new Error(`Missing UI string '${p}'`);return r}_updateStyle(p,r){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new uo(this,r||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof p?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new uo(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,r){if("string"==typeof p){const c=this._requestManager.normalizeStyleURL(p),a=this._requestManager.transformRequest(c,u.ResourceType.Style);u.getJSON(a,(f,d)=>{f?this.fire(new u.ErrorEvent(f)):d&&this._updateDiff(d,r)})}else"object"==typeof p&&this._updateDiff(p,r)}_updateDiff(p,r){try{this.style.setState(p)&&this._update(!0)}catch(c){u.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(p,r)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(u.warnOnce("There is no style added to the map."),!1)}addSource(p,r){return this._lazyInitEmptyStyle(),this.style.addSource(p,r),this._update(!0)}isSourceLoaded(p){return!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const r in p){const c=p[r]._tiles;for(const a in c){const f=c[a];if("loaded"!==f.state&&"errored"!==f.state)return!1}}return!0}addSourceType(p,r,c){this._lazyInitEmptyStyle(),this.style.addSourceType(p,r,c)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,r,{pixelRatio:c=1,sdf:a=!1,stretchX:f,stretchY:d,content:y}={}){if(this._lazyInitEmptyStyle(),r instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&r instanceof u.window.ImageBitmap){const{width:x,height:E,data:C}=u.exported.getImageData(r);this.style.addImage(p,{data:new u.RGBAImage({width:x,height:E},C),pixelRatio:c,stretchX:f,stretchY:d,content:y,sdf:a,version:0})}else if(void 0===r.width||void 0===r.height)this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:x,height:E}=r,C=r;this.style.addImage(p,{data:new u.RGBAImage({width:x,height:E},new Uint8Array(C.data)),pixelRatio:c,stretchX:f,stretchY:d,content:y,sdf:a,version:0,userImage:C}),C.onAdd&&C.onAdd(this,p)}}updateImage(p,r){const c=this.style.getImage(p);if(!c)return void this.fire(new u.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const a=r instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&r instanceof u.window.ImageBitmap?u.exported.getImageData(r):r,{width:f,height:d}=a;void 0!==f&&void 0!==d?f===c.data.width&&d===c.data.height?(c.data.replace(a.data,!(r instanceof u.window.HTMLImageElement||u.window.ImageBitmap&&r instanceof u.window.ImageBitmap)),this.style.updateImage(p,c)):this.fire(new u.ErrorEvent(new Error(`The width and height of the updated image (${f}, ${d})\n                must be that same as the previous version of the image\n                (${c.data.width}, ${c.data.height})`))):this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new u.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,r){u.getImage(this._requestManager.transformRequest(p,u.ResourceType.Image),(c,a)=>{r(c,a instanceof u.window.HTMLImageElement?u.exported.getImageData(a):a)})}listImages(){return this.style.listImages()}addLayer(p,r){return this._lazyInitEmptyStyle(),this.style.addLayer(p,r),this._update(!0)}moveLayer(p,r){return this.style.moveLayer(p,r),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,r,c){return this.style.setLayerZoomRange(p,r,c),this._update(!0)}setFilter(p,r,c={}){return this.style.setFilter(p,r,c),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,r,c,a={}){return this.style.setPaintProperty(p,r,c,a),this._update(!0)}getPaintProperty(p,r){return this.style.getPaintProperty(p,r)}setLayoutProperty(p,r,c,a={}){return this.style.setLayoutProperty(p,r,c,a),this._update(!0)}getLayoutProperty(p,r){return this.style.getLayoutProperty(p,r)}setLight(p,r={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,r),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(u.LngLat.convert(p),this.transform):0}setFeatureState(p,r){return this.style.setFeatureState(p,r),this._update()}removeFeatureState(p,r){return this.style.removeFeatureState(p,r),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let c,a,f,d=this._container;for(;d&&(!a||!f);){const y=u.window.getComputedStyle(d).transform;y&&"none"!==y&&(c=y.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&"0"!==c[0]&&"1"!==c[0]&&(a=c[0]),c[3]&&"0"!==c[3]&&"1"!==c[3]&&(f=c[3])),d=d.parentElement}this._containerWidth=a?Math.abs(p/a):p,this._containerHeight=f?Math.abs(r/f):r}_detectMissingCSS(){"rgb(250, 128, 114)"!==u.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&u.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=gt("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=gt("div","mapboxgl-canvas-container",p);this._interactive&&r.classList.add("mapboxgl-interactive"),this._canvas=gt("canvas","mapboxgl-canvas",r),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=gt("div","mapboxgl-control-container",p),a=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(f=>{a[f]=gt("div",`mapboxgl-ctrl-${f}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,r){const c=u.exported.devicePixelRatio||1;this._canvas.width=c*Math.ceil(p),this._canvas.height=c*Math.ceil(r),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${r}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const r=this._markers.indexOf(p);-1!==r&&this._markers.splice(r,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const r=this._popups.indexOf(p);-1!==r&&this._popups.splice(r,1)}_setupPainter(){const p=u.extend({},Kt.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._useWebGL2&&this._canvas.getContext("webgl2",p),c=r||this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);c?(this._useWebGL2&&!r&&u.warnOnce("Failed to create WebGL 2 context. Using WebGL 1."),u.storeAuthState(c,!0),this.painter=new X(c,this.transform,!!r),this.on("data",a=>{"source"===a.dataType&&this.painter.setTileLoadedFlag(!0)}),u.exported$1.testSupport(c)):this.fire(new u.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new u.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new u.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let r;const c=this.painter.context.extTimerQuery,a=u.exported.now();if(this.listens("gpu-timing-frame")&&(r=c.createQueryEXT(),c.beginQueryEXT(c.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],u.window.performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],u.window.performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const f=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const x=this.transform.zoom,E=this.transform.pitch,C=u.exported.now(),k=new u.EvaluationParameters(x,{now:C,fadeDuration:f,pitch:E,transition:this.style.getTransition()});this.style.update(k)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let d=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),d=this._updateAverageElevation(a),this.style._updateSources(this.transform),this._forceMarkerAndPopupUpdate()):d=this._updateAverageElevation(a),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,f,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:f,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new u.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new u.Event("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const x=u.exported.now()-a;c.endQueryEXT(c.TIME_ELAPSED_EXT,r),setTimeout(()=>{const E=c.getQueryObjectEXT(r,c.QUERY_RESULT_EXT)/1e6;c.deleteQueryEXT(r),this.fire(new u.Event("gpu-timing-frame",{cpuTime:x,gpuTime:E})),u.window.performance.mark("frame-gpu",{startTime:a,detail:{gpuTime:E}})},50)}if(this.listens("gpu-timing-layer")){const x=this.painter.collectGpuTimers();setTimeout(()=>{const E=this.painter.queryGpuTimers(x);this.fire(new u.Event("gpu-timing-layer",{layerTimes:E}))},50)}if(this.listens("gpu-timing-deferred-render")){const x=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const E=this.painter.queryGpuTimeDeferredRender(x);this.fire(new u.Event("gpu-timing-deferred-render",{gpuTime:E}))},50)}const y=this._sourcesDirty||this._styleDirty||this._placementDirty||d;if(y||this._repaint)this.triggerRepaint();else{const x=!this.isMoving()&&this.loaded();if(x&&(d=this._updateAverageElevation(a,!0)),d)this.triggerRepaint();else if(this._triggerFrame(!1),x&&(this.fire(new u.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const E=this._calculateSpeedIndex();this.fire(new u.Event("speedindexcompleted",{speedIndex:E})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||y||(this._fullyLoaded=!0,u.LivePerformanceUtils.mark(u.PerformanceMarkers.fullLoad),this._performanceMetricsCollection&&u.postPerformanceEvent(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const r of this._markers)p&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!p||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(p,r=!1){const c=a=>(this.transform.averageElevation=a,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&c(0);if((r||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const a=this.transform.averageElevation;let f=this.transform.sampleAverageElevation(),d=!1;this.transform.elevation&&(d=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(f)?f=0:this._averageElevationLastSampledAt=p;const y=Math.abs(a-f);if(y>1){if(this._isInitialLoad||d)return this._averageElevation.jumpTo(f),c(f);this._averageElevation.easeTo(f,p,300)}else if(y>1e-4)return this._averageElevation.jumpTo(f),c(f)}return!!this._averageElevation.isEasing(p)&&c(this._averageElevation.getValue(p))}_authenticate(){u.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===u.AUTH_ERR_MSG||401===p.status)){const r=this.painter.context.gl;u.storeAuthState(r,!1),this._logoControl instanceof Lu&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new u.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),u.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const c=this.painter.context.gl,a=c.createFramebuffer();function f(d){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,d,0);const y=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,y),y}return c.bindFramebuffer(c.FRAMEBUFFER,a),this._canvasPixelComparison(f(p),r.canvasCopies.map(f),r.timeStamps)}_canvasPixelComparison(p,r,c){let a=c[1]-c[0];const f=p.length/4;for(let d=0;d<r.length;d++){const y=r[d];let x=0;for(let E=0;E<y.length;E+=4)y[E]===p[E]&&y[E+1]===p[E+1]&&y[E+2]===p[E+2]&&y[E+3]===p[E+3]&&(x+=1);a+=(c[d+2]-c[d+1])*(1-x/f)}return a}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==u.window&&(u.window.removeEventListener("resize",this._onWindowResize,!1),u.window.removeEventListener("orientationchange",this._onWindowResize,!1),u.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),u.window.removeEventListener("online",this._onWindowOnline,!1),u.window.removeEventListener("visibilitychange",this._onVisibilityChange,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),u.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new u.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=u.exported.frame(r=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(r)}))}_preloadTiles(p){const r=this.style?Object.values(this.style._sourceCaches):[];return u.asyncAll(r,(c,a)=>c._preloadTiles(p,a),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){"hidden"===u.window.document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,p&&this._update())}_setCacheLimits(p,r){u.setCacheLimits(p,r)}get version(){return u.version}},NavigationControl:class{constructor(p){this.options=u.extend({},su,p),this._container=gt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(u.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),gt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),gt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(u.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:r}):c.resetNorth({},{originalEvent:r}))}),this._compassIcon=gt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const r=p.getZoom(),c=r===p.getMaxZoom(),a=r===p.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=a,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",a.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ws(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,r){const c=gt("button",p,this._container);return c.type="button",c.addEventListener("click",r),c}_setButtonTitle(p,r){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${r}`);p.setAttribute("aria-label",c),p.firstElementChild&&p.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends u.Evented{constructor(p){super(),this.options=u.extend({geolocation:u.window.navigator.geolocation},sl,p),u.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Di(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=gt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const r=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,p(c)};void 0!==this._supportsGeolocation?p(this._supportsGeolocation):void 0!==u.window.navigator.permissions?u.window.navigator.permissions.query({name:"geolocation"}).then(c=>r("denied"!==c.state)).catch(()=>r()):r()}_isOutOfMapMaxBounds(p){const r=this._map.getMaxBounds(),c=p.coords;return!!r&&(c.longitude<r.getWest()||c.longitude>r.getEast()||c.latitude<r.getSouth()||c.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new u.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(p),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("geolocate",p)),this._finish()}}_updateCamera(p){const r=new u.LngLat(p.coords.longitude,p.coords.latitude),c=p.coords.accuracy,a=this._map.getBearing(),f=u.extend({bearing:a},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(c),f,{geolocateSource:!0})}_updateMarker(p){if(p){const r=new u.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,r=u.mercatorZfromAltitude(1,p._center.lat)*p.worldSize,c=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(1===p.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===p.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new u.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=gt("button","mapboxgl-ctrl-geolocate",this._container),gt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===p){u.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=gt("div","mapboxgl-user-location"),this._dotElement.appendChild(gt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(gt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Ou({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=gt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Ou({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||"ACTIVE_LOCK"!==this._watchState||r.originalEvent&&"resize"===r.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new u.Event("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:!0===p.absolute&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return u.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new u.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{u.window.addEventListener("ondeviceorientationabsolute"in u.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==u.window.DeviceMotionEvent&&"function"==typeof u.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(r=>{"granted"===r&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),u.window.removeEventListener("deviceorientation",this._onDeviceOrientation),u.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:ku,ScaleControl:class{constructor(p){this.options=u.extend({},au,p),function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"narrow",unit:"meter"}),!0}catch{return!1}}()||(this._setScale=lc.bind(this)),u.bindAll(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,r=this._map,c=r._containerHeight/2,a=r._containerWidth/2-p/2,f=r.unproject([a,c]),d=r.unproject([a+p,c]),y=f.distanceTo(d);if("imperial"===this.options.unit){const x=3.2808*y;x>5280?this._setScale(p,x/5280,"mile"):this._setScale(p,x,"foot")}else"nautical"===this.options.unit?this._setScale(p,y/1852,"nautical-mile"):y>=1e3?this._setScale(p,y/1e3,"kilometer"):this._setScale(p,y,"meter")}_setScale(p,r,c){const a=al(r),f=a/r;this._map._requestDomTask(()=>{this._container.style.width=p*f+"px",this._container.innerHTML="nautical-mile"!==c?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"narrow",unit:c}).format(a):`${a}&nbsp;nm`})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=gt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof u.window.HTMLElement?this._container=p.container:u.warnOnce("Full screen control 'container' must be a DOM element.")),u.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in u.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in u.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=gt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",u.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,u.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!u.window.document.fullscreenEnabled&&!u.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=gt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);gt("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),u.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(u.window.document.fullscreenElement||u.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?u.window.document.exitFullscreen?u.window.document.exitFullscreen():u.window.document.webkitCancelFullScreen&&u.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends u.Evented{constructor(p){super(),this.options=u.extend(Object.create(sc),p),u.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new u.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new u.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=u.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(u.window.document.createTextNode(p))}setHTML(p){const r=u.window.document.createDocumentFragment(),c=u.window.document.createElement("body");let a;for(c.innerHTML=p;a=c.firstChild,a;)r.appendChild(a);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=gt("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(p),this.options.closeButton){const c=this._closeButton=gt("button","mapboxgl-popup-close-button",r);c.type="button",c.setAttribute("aria-label","Close popup"),c.setAttribute("aria-hidden","true"),c.innerHTML="&#215;",c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let r;return this._classList.delete(p)?r=!1:(this._classList.add(p),r=!0),this._updateClassList(),r}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const r=this._map,c=this._container,a=this._pos;if(!r||!c||!a)return"bottom";const f=c.offsetWidth,d=c.offsetHeight,y=a.x<f/2,x=a.x>r.transform.width-f/2;if(a.y+p<d)return y?"top-left":x?"top-right":"top";if(a.y>r.transform.height-d){if(y)return"bottom-left";if(x)return"bottom-right"}return y?"left":x?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),p.className=r.join(" ")}_update(p){const r=this._map,c=this._content;if(!r||!this._lngLat&&!this._trackPointer||!c)return;let a=this._container;if(a||(a=this._container=gt("div","mapboxgl-popup",r.getContainer()),this._tip=gt("div","mapboxgl-popup-tip",a),a.appendChild(c)),this.options.maxWidth&&a.style.maxWidth!==this.options.maxWidth&&(a.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Fc(this._lngLat,this._pos,r.transform)),!this._trackPointer||p){const f=this._pos=this._trackPointer&&p?p:r.project(this._lngLat),d=Nl(this.options.offset),y=this._anchor=this._getAnchor(d.y),x=Nl(this.options.offset,y),E=f.add(x).round();r._requestDomTask(()=>{this._container&&y&&(this._container.style.transform=`${oc[y]} translate(${E.x}px,${E.y}px)`)})}if(!this._marker&&r._showingGlobe()){const f=u.isLngLatBehindGlobe(r.transform,this._lngLat)?0:1;this._setOpacity(f)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(sd);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:Ou,Style:uo,LngLat:u.LngLat,LngLatBounds:u.LngLatBounds,Point:u.pointGeometry,MercatorCoordinate:u.MercatorCoordinate,FreeCameraOptions:A,Evented:u.Evented,config:u.config,prewarm:function(){xn().acquire(sn)},clearPrewarmedResources:function(){const p=Rt;p&&(p.isPreloaded()&&1===p.numActive()?(p.release(sn),Rt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return u.config.ACCESS_TOKEN},set accessToken(p){u.config.ACCESS_TOKEN=p},get baseApiUrl(){return u.config.API_URL},set baseApiUrl(p){u.config.API_URL=p},get workerCount(){return dn.workerCount},set workerCount(p){dn.workerCount=p},get maxParallelImageRequests(){return u.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){u.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){u.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:u.exported.setNow,restoreNow:u.exported.restoreNow};return cc}),W}()},9751:(Yn,At,we)=>{"use strict";we.d(At,{y:()=>bt});var W=we(930),_e=we(727),$e=we(8822),u=we(9635),Ie=we(2416),Kt=we(576),Ut=we(2806);let bt=(()=>{class Et{constructor(Jt){Jt&&(this._subscribe=Jt)}lift(Jt){const hn=new Et;return hn.source=this,hn.operator=Jt,hn}subscribe(Jt,hn,Qt){const tr=function ft(Et){return Et&&Et instanceof W.Lv||function nt(Et){return Et&&(0,Kt.m)(Et.next)&&(0,Kt.m)(Et.error)&&(0,Kt.m)(Et.complete)}(Et)&&(0,_e.Nn)(Et)}(Jt)?Jt:new W.Hp(Jt,hn,Qt);return(0,Ut.x)(()=>{const{operator:dt,source:Lr}=this;tr.add(dt?dt.call(tr,Lr):Lr?this._subscribe(tr):this._trySubscribe(tr))}),tr}_trySubscribe(Jt){try{return this._subscribe(Jt)}catch(hn){Jt.error(hn)}}forEach(Jt,hn){return new(hn=gt(hn))((Qt,tr)=>{const dt=new W.Hp({next:Lr=>{try{Jt(Lr)}catch(Zr){tr(Zr),dt.unsubscribe()}},error:tr,complete:Qt});this.subscribe(dt)})}_subscribe(Jt){var hn;return null===(hn=this.source)||void 0===hn?void 0:hn.subscribe(Jt)}[$e.L](){return this}pipe(...Jt){return(0,u.U)(Jt)(this)}toPromise(Jt){return new(Jt=gt(Jt))((hn,Qt)=>{let tr;this.subscribe(dt=>tr=dt,dt=>Qt(dt),()=>hn(tr))})}}return Et.create=jn=>new Et(jn),Et})();function gt(Et){var jn;return null!==(jn=Et??Ie.v.Promise)&&void 0!==jn?jn:Promise}},7579:(Yn,At,we)=>{"use strict";we.d(At,{x:()=>Ut});var W=we(9751),_e=we(727);const u=(0,we(3888).d)(gt=>function(){gt(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"});var Ie=we(8737),Kt=we(2806);let Ut=(()=>{class gt extends W.y{constructor(){super(),this.closed=!1,this.currentObservers=null,this.observers=[],this.isStopped=!1,this.hasError=!1,this.thrownError=null}lift(ft){const Et=new bt(this,this);return Et.operator=ft,Et}_throwIfClosed(){if(this.closed)throw new u}next(ft){(0,Kt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.currentObservers||(this.currentObservers=Array.from(this.observers));for(const Et of this.currentObservers)Et.next(ft)}})}error(ft){(0,Kt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.hasError=this.isStopped=!0,this.thrownError=ft;const{observers:Et}=this;for(;Et.length;)Et.shift().error(ft)}})}complete(){(0,Kt.x)(()=>{if(this._throwIfClosed(),!this.isStopped){this.isStopped=!0;const{observers:ft}=this;for(;ft.length;)ft.shift().complete()}})}unsubscribe(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null}get observed(){var ft;return(null===(ft=this.observers)||void 0===ft?void 0:ft.length)>0}_trySubscribe(ft){return this._throwIfClosed(),super._trySubscribe(ft)}_subscribe(ft){return this._throwIfClosed(),this._checkFinalizedStatuses(ft),this._innerSubscribe(ft)}_innerSubscribe(ft){const{hasError:Et,isStopped:jn,observers:Jt}=this;return Et||jn?_e.Lc:(this.currentObservers=null,Jt.push(ft),new _e.w0(()=>{this.currentObservers=null,(0,Ie.P)(Jt,ft)}))}_checkFinalizedStatuses(ft){const{hasError:Et,thrownError:jn,isStopped:Jt}=this;Et?ft.error(jn):Jt&&ft.complete()}asObservable(){const ft=new W.y;return ft.source=this,ft}}return gt.create=(nt,ft)=>new bt(nt,ft),gt})();class bt extends Ut{constructor(nt,ft){super(),this.destination=nt,this.source=ft}next(nt){var ft,Et;null===(Et=null===(ft=this.destination)||void 0===ft?void 0:ft.next)||void 0===Et||Et.call(ft,nt)}error(nt){var ft,Et;null===(Et=null===(ft=this.destination)||void 0===ft?void 0:ft.error)||void 0===Et||Et.call(ft,nt)}complete(){var nt,ft;null===(ft=null===(nt=this.destination)||void 0===nt?void 0:nt.complete)||void 0===ft||ft.call(nt)}_subscribe(nt){var ft,Et;return null!==(Et=null===(ft=this.source)||void 0===ft?void 0:ft.subscribe(nt))&&void 0!==Et?Et:_e.Lc}}},930:(Yn,At,we)=>{"use strict";we.d(At,{Hp:()=>Qt,Lv:()=>Et});var W=we(576),_e=we(727),$e=we(2416),u=we(7849),Ie=we(5032);const Kt=gt("C",void 0,void 0);function gt(Je,Ne,mt){return{kind:Je,value:Ne,error:mt}}var nt=we(3410),ft=we(2806);class Et extends _e.w0{constructor(Ne){super(),this.isStopped=!1,Ne?(this.destination=Ne,(0,_e.Nn)(Ne)&&Ne.add(this)):this.destination=Zr}static create(Ne,mt,ln){return new Qt(Ne,mt,ln)}next(Ne){this.isStopped?Lr(function bt(Je){return gt("N",Je,void 0)}(Ne),this):this._next(Ne)}error(Ne){this.isStopped?Lr(function Ut(Je){return gt("E",void 0,Je)}(Ne),this):(this.isStopped=!0,this._error(Ne))}complete(){this.isStopped?Lr(Kt,this):(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe(),this.destination=null)}_next(Ne){this.destination.next(Ne)}_error(Ne){try{this.destination.error(Ne)}finally{this.unsubscribe()}}_complete(){try{this.destination.complete()}finally{this.unsubscribe()}}}const jn=Function.prototype.bind;function Jt(Je,Ne){return jn.call(Je,Ne)}class hn{constructor(Ne){this.partialObserver=Ne}next(Ne){const{partialObserver:mt}=this;if(mt.next)try{mt.next(Ne)}catch(ln){tr(ln)}}error(Ne){const{partialObserver:mt}=this;if(mt.error)try{mt.error(Ne)}catch(ln){tr(ln)}else tr(Ne)}complete(){const{partialObserver:Ne}=this;if(Ne.complete)try{Ne.complete()}catch(mt){tr(mt)}}}class Qt extends Et{constructor(Ne,mt,ln){let Ue;if(super(),(0,W.m)(Ne)||!Ne)Ue={next:Ne??void 0,error:mt??void 0,complete:ln??void 0};else{let en;this&&$e.v.useDeprecatedNextContext?(en=Object.create(Ne),en.unsubscribe=()=>this.unsubscribe(),Ue={next:Ne.next&&Jt(Ne.next,en),error:Ne.error&&Jt(Ne.error,en),complete:Ne.complete&&Jt(Ne.complete,en)}):Ue=Ne}this.destination=new hn(Ue)}}function tr(Je){$e.v.useDeprecatedSynchronousErrorHandling?(0,ft.O)(Je):(0,u.h)(Je)}function Lr(Je,Ne){const{onStoppedNotification:mt}=$e.v;mt&&nt.z.setTimeout(()=>mt(Je,Ne))}const Zr={closed:!0,next:Ie.Z,error:function dt(Je){throw Je},complete:Ie.Z}},727:(Yn,At,we)=>{"use strict";we.d(At,{Lc:()=>Kt,w0:()=>Ie,Nn:()=>Ut});var W=we(576);const $e=(0,we(3888).d)(gt=>function(ft){gt(this),this.message=ft?`${ft.length} errors occurred during unsubscription:\n${ft.map((Et,jn)=>`${jn+1}) ${Et.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=ft});var u=we(8737);class Ie{constructor(nt){this.initialTeardown=nt,this.closed=!1,this._parentage=null,this._finalizers=null}unsubscribe(){let nt;if(!this.closed){this.closed=!0;const{_parentage:ft}=this;if(ft)if(this._parentage=null,Array.isArray(ft))for(const Jt of ft)Jt.remove(this);else ft.remove(this);const{initialTeardown:Et}=this;if((0,W.m)(Et))try{Et()}catch(Jt){nt=Jt instanceof $e?Jt.errors:[Jt]}const{_finalizers:jn}=this;if(jn){this._finalizers=null;for(const Jt of jn)try{bt(Jt)}catch(hn){nt=nt??[],hn instanceof $e?nt=[...nt,...hn.errors]:nt.push(hn)}}if(nt)throw new $e(nt)}}add(nt){var ft;if(nt&&nt!==this)if(this.closed)bt(nt);else{if(nt instanceof Ie){if(nt.closed||nt._hasParent(this))return;nt._addParent(this)}(this._finalizers=null!==(ft=this._finalizers)&&void 0!==ft?ft:[]).push(nt)}}_hasParent(nt){const{_parentage:ft}=this;return ft===nt||Array.isArray(ft)&&ft.includes(nt)}_addParent(nt){const{_parentage:ft}=this;this._parentage=Array.isArray(ft)?(ft.push(nt),ft):ft?[ft,nt]:nt}_removeParent(nt){const{_parentage:ft}=this;ft===nt?this._parentage=null:Array.isArray(ft)&&(0,u.P)(ft,nt)}remove(nt){const{_finalizers:ft}=this;ft&&(0,u.P)(ft,nt),nt instanceof Ie&&nt._removeParent(this)}}Ie.EMPTY=(()=>{const gt=new Ie;return gt.closed=!0,gt})();const Kt=Ie.EMPTY;function Ut(gt){return gt instanceof Ie||gt&&"closed"in gt&&(0,W.m)(gt.remove)&&(0,W.m)(gt.add)&&(0,W.m)(gt.unsubscribe)}function bt(gt){(0,W.m)(gt)?gt():gt.unsubscribe()}},2416:(Yn,At,we)=>{"use strict";we.d(At,{v:()=>W});const W={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1}},7272:(Yn,At,we)=>{"use strict";we.d(At,{z:()=>Ie});var W=we(8189),$e=we(3269),u=we(2076);function Ie(...Kt){return function _e(){return(0,W.J)(1)}()((0,u.D)(Kt,(0,$e.yG)(Kt)))}},515:(Yn,At,we)=>{"use strict";we.d(At,{E:()=>_e});const _e=new(we(9751).y)(Ie=>Ie.complete())},2076:(Yn,At,we)=>{"use strict";we.d(At,{D:()=>ln});var W=we(8421),_e=we(9672),$e=we(4482),u=we(5403);function Ie(Ue,en=0){return(0,$e.e)((Xt,$t)=>{Xt.subscribe((0,u.x)($t,an=>(0,_e.f)($t,Ue,()=>$t.next(an),en),()=>(0,_e.f)($t,Ue,()=>$t.complete(),en),an=>(0,_e.f)($t,Ue,()=>$t.error(an),en)))})}function Kt(Ue,en=0){return(0,$e.e)((Xt,$t)=>{$t.add(Ue.schedule(()=>Xt.subscribe($t),en))})}var gt=we(9751),ft=we(2202),Et=we(576);function Jt(Ue,en){if(!Ue)throw new Error("Iterable cannot be null");return new gt.y(Xt=>{(0,_e.f)(Xt,en,()=>{const $t=Ue[Symbol.asyncIterator]();(0,_e.f)(Xt,en,()=>{$t.next().then(an=>{an.done?Xt.complete():Xt.next(an.value)})},0,!0)})})}var hn=we(3670),Qt=we(8239),tr=we(1144),dt=we(6495),Lr=we(2206),Zr=we(4532),Je=we(3260);function ln(Ue,en){return en?function mt(Ue,en){if(null!=Ue){if((0,hn.c)(Ue))return function Ut(Ue,en){return(0,W.Xf)(Ue).pipe(Kt(en),Ie(en))}(Ue,en);if((0,tr.z)(Ue))return function nt(Ue,en){return new gt.y(Xt=>{let $t=0;return en.schedule(function(){$t===Ue.length?Xt.complete():(Xt.next(Ue[$t++]),Xt.closed||this.schedule())})})}(Ue,en);if((0,Qt.t)(Ue))return function bt(Ue,en){return(0,W.Xf)(Ue).pipe(Kt(en),Ie(en))}(Ue,en);if((0,Lr.D)(Ue))return Jt(Ue,en);if((0,dt.T)(Ue))return function jn(Ue,en){return new gt.y(Xt=>{let $t;return(0,_e.f)(Xt,en,()=>{$t=Ue[ft.h](),(0,_e.f)(Xt,en,()=>{let an,mn;try{({value:an,done:mn}=$t.next())}catch(Gt){return void Xt.error(Gt)}mn?Xt.complete():Xt.next(an)},0,!0)}),()=>(0,Et.m)($t?.return)&&$t.return()})}(Ue,en);if((0,Je.L)(Ue))return function Ne(Ue,en){return Jt((0,Je.Q)(Ue),en)}(Ue,en)}throw(0,Zr.z)(Ue)}(Ue,en):(0,W.Xf)(Ue)}},8421:(Yn,At,we)=>{"use strict";we.d(At,{Xf:()=>jn});var W=we(655),_e=we(1144),$e=we(8239),u=we(9751),Ie=we(3670),Kt=we(2206),Ut=we(4532),bt=we(6495),gt=we(3260),nt=we(576),ft=we(7849),Et=we(8822);function jn(Je){if(Je instanceof u.y)return Je;if(null!=Je){if((0,Ie.c)(Je))return function Jt(Je){return new u.y(Ne=>{const mt=Je[Et.L]();if((0,nt.m)(mt.subscribe))return mt.subscribe(Ne);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}(Je);if((0,_e.z)(Je))return function hn(Je){return new u.y(Ne=>{for(let mt=0;mt<Je.length&&!Ne.closed;mt++)Ne.next(Je[mt]);Ne.complete()})}(Je);if((0,$e.t)(Je))return function Qt(Je){return new u.y(Ne=>{Je.then(mt=>{Ne.closed||(Ne.next(mt),Ne.complete())},mt=>Ne.error(mt)).then(null,ft.h)})}(Je);if((0,Kt.D)(Je))return dt(Je);if((0,bt.T)(Je))return function tr(Je){return new u.y(Ne=>{for(const mt of Je)if(Ne.next(mt),Ne.closed)return;Ne.complete()})}(Je);if((0,gt.L)(Je))return function Lr(Je){return dt((0,gt.Q)(Je))}(Je)}throw(0,Ut.z)(Je)}function dt(Je){return new u.y(Ne=>{(function Zr(Je,Ne){var mt,ln,Ue,en;return(0,W.mG)(this,void 0,void 0,function*(){try{for(mt=(0,W.KL)(Je);!(ln=yield mt.next()).done;)if(Ne.next(ln.value),Ne.closed)return}catch(Xt){Ue={error:Xt}}finally{try{ln&&!ln.done&&(en=mt.return)&&(yield en.call(mt))}finally{if(Ue)throw Ue.error}}Ne.complete()})})(Je,Ne).catch(mt=>Ne.error(mt))})}},6451:(Yn,At,we)=>{"use strict";we.d(At,{T:()=>Kt});var W=we(8189),_e=we(8421),$e=we(515),u=we(3269),Ie=we(2076);function Kt(...Ut){const bt=(0,u.yG)(Ut),gt=(0,u._6)(Ut,1/0),nt=Ut;return nt.length?1===nt.length?(0,_e.Xf)(nt[0]):(0,W.J)(gt)((0,Ie.D)(nt,bt)):$e.E}},9646:(Yn,At,we)=>{"use strict";we.d(At,{of:()=>$e});var W=we(3269),_e=we(2076);function $e(...u){const Ie=(0,W.yG)(u);return(0,_e.D)(u,Ie)}},5403:(Yn,At,we)=>{"use strict";we.d(At,{x:()=>_e});var W=we(930);function _e(u,Ie,Kt,Ut,bt){return new $e(u,Ie,Kt,Ut,bt)}class $e extends W.Lv{constructor(Ie,Kt,Ut,bt,gt,nt){super(Ie),this.onFinalize=gt,this.shouldUnsubscribe=nt,this._next=Kt?function(ft){try{Kt(ft)}catch(Et){Ie.error(Et)}}:super._next,this._error=bt?function(ft){try{bt(ft)}catch(Et){Ie.error(Et)}finally{this.unsubscribe()}}:super._error,this._complete=Ut?function(){try{Ut()}catch(ft){Ie.error(ft)}finally{this.unsubscribe()}}:super._complete}unsubscribe(){var Ie;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){const{closed:Kt}=this;super.unsubscribe(),!Kt&&(null===(Ie=this.onFinalize)||void 0===Ie||Ie.call(this))}}}},262:(Yn,At,we)=>{"use strict";we.d(At,{K:()=>u});var W=we(8421),_e=we(5403),$e=we(4482);function u(Ie){return(0,$e.e)((Kt,Ut)=>{let nt,bt=null,gt=!1;bt=Kt.subscribe((0,_e.x)(Ut,void 0,void 0,ft=>{nt=(0,W.Xf)(Ie(ft,u(Ie)(Kt))),bt?(bt.unsubscribe(),bt=null,nt.subscribe(Ut)):gt=!0})),gt&&(bt.unsubscribe(),bt=null,nt.subscribe(Ut))})}},4351:(Yn,At,we)=>{"use strict";we.d(At,{b:()=>$e});var W=we(5577),_e=we(576);function $e(u,Ie){return(0,_e.m)(Ie)?(0,W.z)(u,Ie,1):(0,W.z)(u,1)}},9300:(Yn,At,we)=>{"use strict";we.d(At,{h:()=>$e});var W=we(4482),_e=we(5403);function $e(u,Ie){return(0,W.e)((Kt,Ut)=>{let bt=0;Kt.subscribe((0,_e.x)(Ut,gt=>u.call(Ie,gt,bt++)&&Ut.next(gt)))})}},4004:(Yn,At,we)=>{"use strict";we.d(At,{U:()=>$e});var W=we(4482),_e=we(5403);function $e(u,Ie){return(0,W.e)((Kt,Ut)=>{let bt=0;Kt.subscribe((0,_e.x)(Ut,gt=>{Ut.next(u.call(Ie,gt,bt++))}))})}},8189:(Yn,At,we)=>{"use strict";we.d(At,{J:()=>$e});var W=we(5577),_e=we(4671);function $e(u=1/0){return(0,W.z)(_e.y,u)}},5577:(Yn,At,we)=>{"use strict";we.d(At,{z:()=>bt});var W=we(4004),_e=we(8421),$e=we(4482),u=we(9672),Ie=we(5403),Ut=we(576);function bt(gt,nt,ft=1/0){return(0,Ut.m)(nt)?bt((Et,jn)=>(0,W.U)((Jt,hn)=>nt(Et,Jt,jn,hn))((0,_e.Xf)(gt(Et,jn))),ft):("number"==typeof nt&&(ft=nt),(0,$e.e)((Et,jn)=>function Kt(gt,nt,ft,Et,jn,Jt,hn,Qt){const tr=[];let dt=0,Lr=0,Zr=!1;const Je=()=>{Zr&&!tr.length&&!dt&&nt.complete()},Ne=ln=>dt<Et?mt(ln):tr.push(ln),mt=ln=>{Jt&&nt.next(ln),dt++;let Ue=!1;(0,_e.Xf)(ft(ln,Lr++)).subscribe((0,Ie.x)(nt,en=>{jn?.(en),Jt?Ne(en):nt.next(en)},()=>{Ue=!0},void 0,()=>{if(Ue)try{for(dt--;tr.length&&dt<Et;){const en=tr.shift();hn?(0,u.f)(nt,hn,()=>mt(en)):mt(en)}Je()}catch(en){nt.error(en)}}))};return gt.subscribe((0,Ie.x)(nt,Ne,()=>{Zr=!0,Je()})),()=>{Qt?.()}}(Et,jn,gt,ft)))}},8675:(Yn,At,we)=>{"use strict";we.d(At,{O:()=>u});var W=we(7272),_e=we(3269),$e=we(4482);function u(...Ie){const Kt=(0,_e.yG)(Ie);return(0,$e.e)((Ut,bt)=>{(Kt?(0,W.z)(Ie,Ut,Kt):(0,W.z)(Ie,Ut)).subscribe(bt)})}},3900:(Yn,At,we)=>{"use strict";we.d(At,{w:()=>u});var W=we(8421),_e=we(4482),$e=we(5403);function u(Ie,Kt){return(0,_e.e)((Ut,bt)=>{let gt=null,nt=0,ft=!1;const Et=()=>ft&&!gt&&bt.complete();Ut.subscribe((0,$e.x)(bt,jn=>{gt?.unsubscribe();let Jt=0;const hn=nt++;(0,W.Xf)(Ie(jn,hn)).subscribe(gt=(0,$e.x)(bt,Qt=>bt.next(Kt?Kt(jn,Qt,hn,Jt++):Qt),()=>{gt=null,Et()}))},()=>{ft=!0,Et()}))})}},5698:(Yn,At,we)=>{"use strict";we.d(At,{q:()=>u});var W=we(515),_e=we(4482),$e=we(5403);function u(Ie){return Ie<=0?()=>W.E:(0,_e.e)((Kt,Ut)=>{let bt=0;Kt.subscribe((0,$e.x)(Ut,gt=>{++bt<=Ie&&(Ut.next(gt),Ie<=bt&&Ut.complete())}))})}},8505:(Yn,At,we)=>{"use strict";we.d(At,{b:()=>Ie});var W=we(576),_e=we(4482),$e=we(5403),u=we(4671);function Ie(Kt,Ut,bt){const gt=(0,W.m)(Kt)||Ut||bt?{next:Kt,error:Ut,complete:bt}:Kt;return gt?(0,_e.e)((nt,ft)=>{var Et;null===(Et=gt.subscribe)||void 0===Et||Et.call(gt);let jn=!0;nt.subscribe((0,$e.x)(ft,Jt=>{var hn;null===(hn=gt.next)||void 0===hn||hn.call(gt,Jt),ft.next(Jt)},()=>{var Jt;jn=!1,null===(Jt=gt.complete)||void 0===Jt||Jt.call(gt),ft.complete()},Jt=>{var hn;jn=!1,null===(hn=gt.error)||void 0===hn||hn.call(gt,Jt),ft.error(Jt)},()=>{var Jt,hn;jn&&(null===(Jt=gt.unsubscribe)||void 0===Jt||Jt.call(gt)),null===(hn=gt.finalize)||void 0===hn||hn.call(gt)}))}):u.y}},3410:(Yn,At,we)=>{"use strict";we.d(At,{z:()=>W});const W={setTimeout(_e,$e,...u){const{delegate:Ie}=W;return Ie?.setTimeout?Ie.setTimeout(_e,$e,...u):setTimeout(_e,$e,...u)},clearTimeout(_e){const{delegate:$e}=W;return($e?.clearTimeout||clearTimeout)(_e)},delegate:void 0}},2202:(Yn,At,we)=>{"use strict";we.d(At,{h:()=>_e});const _e=function W(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}()},8822:(Yn,At,we)=>{"use strict";we.d(At,{L:()=>W});const W="function"==typeof Symbol&&Symbol.observable||"@@observable"},3269:(Yn,At,we)=>{"use strict";we.d(At,{_6:()=>Kt,jO:()=>u,yG:()=>Ie});var W=we(576),_e=we(3532);function $e(Ut){return Ut[Ut.length-1]}function u(Ut){return(0,W.m)($e(Ut))?Ut.pop():void 0}function Ie(Ut){return(0,_e.K)($e(Ut))?Ut.pop():void 0}function Kt(Ut,bt){return"number"==typeof $e(Ut)?Ut.pop():bt}},4742:(Yn,At,we)=>{"use strict";we.d(At,{D:()=>Ie});const{isArray:W}=Array,{getPrototypeOf:_e,prototype:$e,keys:u}=Object;function Ie(Ut){if(1===Ut.length){const bt=Ut[0];if(W(bt))return{args:bt,keys:null};if(function Kt(Ut){return Ut&&"object"==typeof Ut&&_e(Ut)===$e}(bt)){const gt=u(bt);return{args:gt.map(nt=>bt[nt]),keys:gt}}}return{args:Ut,keys:null}}},8737:(Yn,At,we)=>{"use strict";function W(_e,$e){if(_e){const u=_e.indexOf($e);0<=u&&_e.splice(u,1)}}we.d(At,{P:()=>W})},3888:(Yn,At,we)=>{"use strict";function W(_e){const u=_e(Ie=>{Error.call(Ie),Ie.stack=(new Error).stack});return u.prototype=Object.create(Error.prototype),u.prototype.constructor=u,u}we.d(At,{d:()=>W})},1810:(Yn,At,we)=>{"use strict";function W(_e,$e){return _e.reduce((u,Ie,Kt)=>(u[Ie]=$e[Kt],u),{})}we.d(At,{n:()=>W})},2806:(Yn,At,we)=>{"use strict";we.d(At,{O:()=>u,x:()=>$e});var W=we(2416);let _e=null;function $e(Ie){if(W.v.useDeprecatedSynchronousErrorHandling){const Kt=!_e;if(Kt&&(_e={errorThrown:!1,error:null}),Ie(),Kt){const{errorThrown:Ut,error:bt}=_e;if(_e=null,Ut)throw bt}}else Ie()}function u(Ie){W.v.useDeprecatedSynchronousErrorHandling&&_e&&(_e.errorThrown=!0,_e.error=Ie)}},9672:(Yn,At,we)=>{"use strict";function W(_e,$e,u,Ie=0,Kt=!1){const Ut=$e.schedule(function(){u(),Kt?_e.add(this.schedule(null,Ie)):this.unsubscribe()},Ie);if(_e.add(Ut),!Kt)return Ut}we.d(At,{f:()=>W})},4671:(Yn,At,we)=>{"use strict";function W(_e){return _e}we.d(At,{y:()=>W})},1144:(Yn,At,we)=>{"use strict";we.d(At,{z:()=>W});const W=_e=>_e&&"number"==typeof _e.length&&"function"!=typeof _e},2206:(Yn,At,we)=>{"use strict";we.d(At,{D:()=>_e});var W=we(576);function _e($e){return Symbol.asyncIterator&&(0,W.m)($e?.[Symbol.asyncIterator])}},576:(Yn,At,we)=>{"use strict";function W(_e){return"function"==typeof _e}we.d(At,{m:()=>W})},3670:(Yn,At,we)=>{"use strict";we.d(At,{c:()=>$e});var W=we(8822),_e=we(576);function $e(u){return(0,_e.m)(u[W.L])}},6495:(Yn,At,we)=>{"use strict";we.d(At,{T:()=>$e});var W=we(2202),_e=we(576);function $e(u){return(0,_e.m)(u?.[W.h])}},8239:(Yn,At,we)=>{"use strict";we.d(At,{t:()=>_e});var W=we(576);function _e($e){return(0,W.m)($e?.then)}},3260:(Yn,At,we)=>{"use strict";we.d(At,{L:()=>u,Q:()=>$e});var W=we(655),_e=we(576);function $e(Ie){return(0,W.FC)(this,arguments,function*(){const Ut=Ie.getReader();try{for(;;){const{value:bt,done:gt}=yield(0,W.qq)(Ut.read());if(gt)return yield(0,W.qq)(void 0);yield yield(0,W.qq)(bt)}}finally{Ut.releaseLock()}})}function u(Ie){return(0,_e.m)(Ie?.getReader)}},3532:(Yn,At,we)=>{"use strict";we.d(At,{K:()=>_e});var W=we(576);function _e($e){return $e&&(0,W.m)($e.schedule)}},4482:(Yn,At,we)=>{"use strict";we.d(At,{A:()=>_e,e:()=>$e});var W=we(576);function _e(u){return(0,W.m)(u?.lift)}function $e(u){return Ie=>{if(_e(Ie))return Ie.lift(function(Kt){try{return u(Kt,this)}catch(Ut){this.error(Ut)}});throw new TypeError("Unable to lift unknown Observable type")}}},3268:(Yn,At,we)=>{"use strict";we.d(At,{Z:()=>u});var W=we(4004);const{isArray:_e}=Array;function u(Ie){return(0,W.U)(Kt=>function $e(Ie,Kt){return _e(Kt)?Ie(...Kt):Ie(Kt)}(Ie,Kt))}},5032:(Yn,At,we)=>{"use strict";function W(){}we.d(At,{Z:()=>W})},9635:(Yn,At,we)=>{"use strict";we.d(At,{U:()=>$e,z:()=>_e});var W=we(4671);function _e(...u){return $e(u)}function $e(u){return 0===u.length?W.y:1===u.length?u[0]:function(Kt){return u.reduce((Ut,bt)=>bt(Ut),Kt)}}},7849:(Yn,At,we)=>{"use strict";we.d(At,{h:()=>$e});var W=we(2416),_e=we(3410);function $e(u){_e.z.setTimeout(()=>{const{onUnhandledError:Ie}=W.v;if(!Ie)throw u;Ie(u)})}},4532:(Yn,At,we)=>{"use strict";function W(_e){return new TypeError(`You provided ${null!==_e&&"object"==typeof _e?"an invalid object":`'${_e}'`} where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.`)}we.d(At,{z:()=>W})},5226:function(Yn){Yn.exports=function(){"use strict";const At="SweetAlert2:",W=I=>I.charAt(0).toUpperCase()+I.slice(1),_e=I=>Array.prototype.slice.call(I),$e=I=>{console.warn("".concat(At," ").concat("object"==typeof I?I.join(" "):I))},u=I=>{console.error("".concat(At," ").concat(I))},Ie=[],Ut=(I,A)=>{(I=>{Ie.includes(I)||(Ie.push(I),$e(I))})('"'.concat(I,'" is deprecated and will be removed in the next major release. Please use "').concat(A,'" instead.'))},bt=I=>"function"==typeof I?I():I,gt=I=>I&&"function"==typeof I.toPromise,nt=I=>gt(I)?I.toPromise():Promise.resolve(I),ft=I=>I&&Promise.resolve(I)===I,Et={title:"",titleText:"",text:"",html:"",footer:"",icon:void 0,iconColor:void 0,iconHtml:void 0,template:void 0,toast:!1,showClass:{popup:"swal2-show",backdrop:"swal2-backdrop-show",icon:"swal2-icon-show"},hideClass:{popup:"swal2-hide",backdrop:"swal2-backdrop-hide",icon:"swal2-icon-hide"},customClass:{},target:"body",color:void 0,backdrop:!0,heightAuto:!0,allowOutsideClick:!0,allowEscapeKey:!0,allowEnterKey:!0,stopKeydownPropagation:!0,keydownListenerCapture:!1,showConfirmButton:!0,showDenyButton:!1,showCancelButton:!1,preConfirm:void 0,preDeny:void 0,confirmButtonText:"OK",confirmButtonAriaLabel:"",confirmButtonColor:void 0,denyButtonText:"No",denyButtonAriaLabel:"",denyButtonColor:void 0,cancelButtonText:"Cancel",cancelButtonAriaLabel:"",cancelButtonColor:void 0,buttonsStyling:!0,reverseButtons:!1,focusConfirm:!0,focusDeny:!1,focusCancel:!1,returnFocus:!0,showCloseButton:!1,closeButtonHtml:"&times;",closeButtonAriaLabel:"Close this dialog",loaderHtml:"",showLoaderOnConfirm:!1,showLoaderOnDeny:!1,imageUrl:void 0,imageWidth:void 0,imageHeight:void 0,imageAlt:"",timer:void 0,timerProgressBar:!1,width:void 0,padding:void 0,background:void 0,input:void 0,inputPlaceholder:"",inputLabel:"",inputValue:"",inputOptions:{},inputAutoTrim:!0,inputAttributes:{},inputValidator:void 0,returnInputValueOnDeny:!1,validationMessage:void 0,grow:!1,position:"center",progressSteps:[],currentProgressStep:void 0,progressStepsDistance:void 0,willOpen:void 0,didOpen:void 0,didRender:void 0,willClose:void 0,didClose:void 0,didDestroy:void 0,scrollbarPadding:!0},jn=["allowEscapeKey","allowOutsideClick","background","buttonsStyling","cancelButtonAriaLabel","cancelButtonColor","cancelButtonText","closeButtonAriaLabel","closeButtonHtml","color","confirmButtonAriaLabel","confirmButtonColor","confirmButtonText","currentProgressStep","customClass","denyButtonAriaLabel","denyButtonColor","denyButtonText","didClose","didDestroy","footer","hideClass","html","icon","iconColor","iconHtml","imageAlt","imageHeight","imageUrl","imageWidth","preConfirm","preDeny","progressSteps","returnFocus","reverseButtons","showCancelButton","showCloseButton","showConfirmButton","showDenyButton","text","title","titleText","willClose"],Jt={},hn=["allowOutsideClick","allowEnterKey","backdrop","focusConfirm","focusDeny","focusCancel","returnFocus","heightAuto","keydownListenerCapture"],Qt=I=>Object.prototype.hasOwnProperty.call(Et,I),tr=I=>-1!==jn.indexOf(I),dt=I=>Jt[I],Lr=I=>{Qt(I)||$e('Unknown parameter "'.concat(I,'"'))},Zr=I=>{hn.includes(I)&&$e('The parameter "'.concat(I,'" is incompatible with toasts'))},Je=I=>{dt(I)&&Ut(I,dt(I))},ln=I=>{const A={};for(const $ in I)A[I[$]]="swal2-"+I[$];return A},Ue=ln(["container","shown","height-auto","iosfix","popup","modal","no-backdrop","no-transition","toast","toast-shown","show","hide","close","title","html-container","actions","confirm","deny","cancel","default-outline","footer","icon","icon-content","image","input","file","range","select","radio","checkbox","label","textarea","inputerror","input-label","validation-message","progress-steps","active-progress-step","progress-step","progress-step-line","loader","loading","styled","top","top-start","top-end","top-left","top-right","center","center-start","center-end","center-left","center-right","bottom","bottom-start","bottom-end","bottom-left","bottom-right","grow-row","grow-column","grow-fullscreen","rtl","timer-progress-bar","timer-progress-bar-container","scrollbar-measure","icon-success","icon-warning","icon-info","icon-question","icon-error"]),en=ln(["success","warning","info","question","error"]),Xt=()=>document.body.querySelector(".".concat(Ue.container)),$t=I=>{const A=Xt();return A?A.querySelector(I):null},an=I=>$t(".".concat(I)),mn=()=>an(Ue.popup),Gt=()=>an(Ue.icon),lt=()=>an(Ue.title),rt=()=>an(Ue["html-container"]),Dt=()=>an(Ue.image),It=()=>an(Ue["progress-steps"]),Ht=()=>an(Ue["validation-message"]),Nt=()=>$t(".".concat(Ue.actions," .").concat(Ue.confirm)),Dn=()=>$t(".".concat(Ue.actions," .").concat(Ue.deny)),or=()=>$t(".".concat(Ue.loader)),vn=()=>$t(".".concat(Ue.actions," .").concat(Ue.cancel)),In=()=>an(Ue.actions),cn=()=>an(Ue.footer),pr=()=>an(Ue["timer-progress-bar"]),vr=()=>an(Ue.close),bn=()=>{const I=_e(mn().querySelectorAll('[tabindex]:not([tabindex="-1"]):not([tabindex="0"])')).sort(($,fe)=>{const We=parseInt($.getAttribute("tabindex")),Ft=parseInt(fe.getAttribute("tabindex"));return We>Ft?1:We<Ft?-1:0}),A=_e(mn().querySelectorAll('\n  a[href],\n  area[href],\n  input:not([disabled]),\n  select:not([disabled]),\n  textarea:not([disabled]),\n  button:not([disabled]),\n  iframe,\n  object,\n  embed,\n  [tabindex="0"],\n  [contenteditable],\n  audio[controls],\n  video[controls],\n  summary\n')).filter($=>"-1"!==$.getAttribute("tabindex"));return(I=>{const A=[];for(let $=0;$<I.length;$++)-1===A.indexOf(I[$])&&A.push(I[$]);return A})(I.concat(A)).filter($=>Nr($))},ni=()=>Pn(document.body,Ue.shown)&&!Pn(document.body,Ue["toast-shown"])&&!Pn(document.body,Ue["no-backdrop"]),wr=()=>mn()&&Pn(mn(),Ue.toast),yi={previousBodyPadding:null},Xr=(I,A)=>{if(I.textContent="",A){const fe=(new DOMParser).parseFromString(A,"text/html");_e(fe.querySelector("head").childNodes).forEach(We=>{I.appendChild(We)}),_e(fe.querySelector("body").childNodes).forEach(We=>{I.appendChild(We)})}},Pn=(I,A)=>{if(!A)return!1;const $=A.split(/\s+/);for(let fe=0;fe<$.length;fe++)if(!I.classList.contains($[fe]))return!1;return!0},Br=(I,A,$)=>{if(((I,A)=>{_e(I.classList).forEach($=>{!Object.values(Ue).includes($)&&!Object.values(en).includes($)&&!Object.values(A.showClass).includes($)&&I.classList.remove($)})})(I,A),A.customClass&&A.customClass[$]){if("string"!=typeof A.customClass[$]&&!A.customClass[$].forEach)return $e("Invalid type of customClass.".concat($,'! Expected string or iterable object, got "').concat(typeof A.customClass[$],'"'));Vn(I,A.customClass[$])}},ri=(I,A)=>{if(!A)return null;switch(A){case"select":case"textarea":case"file":return I.querySelector(".".concat(Ue.popup," > .").concat(Ue[A]));case"checkbox":return I.querySelector(".".concat(Ue.popup," > .").concat(Ue.checkbox," input"));case"radio":return I.querySelector(".".concat(Ue.popup," > .").concat(Ue.radio," input:checked"))||I.querySelector(".".concat(Ue.popup," > .").concat(Ue.radio," input:first-child"));case"range":return I.querySelector(".".concat(Ue.popup," > .").concat(Ue.range," input"));default:return I.querySelector(".".concat(Ue.popup," > .").concat(Ue.input))}},Pi=I=>{if(I.focus(),"file"!==I.type){const A=I.value;I.value="",I.value=A}},So=(I,A,$)=>{!I||!A||("string"==typeof A&&(A=A.split(/\s+/).filter(Boolean)),A.forEach(fe=>{Array.isArray(I)?I.forEach(We=>{$?We.classList.add(fe):We.classList.remove(fe)}):$?I.classList.add(fe):I.classList.remove(fe)}))},Vn=(I,A)=>{So(I,A,!0)},yn=(I,A)=>{So(I,A,!1)},Ri=(I,A)=>{const $=_e(I.childNodes);for(let fe=0;fe<$.length;fe++)if(Pn($[fe],A))return $[fe]},Mr=(I,A,$)=>{$==="".concat(parseInt($))&&($=parseInt($)),$||0===parseInt($)?I.style[A]="number"==typeof $?"".concat($,"px"):$:I.style.removeProperty(A)},on=function(I){I.style.display=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flex"},St=I=>{I.style.display="none"},vi=(I,A,$,fe)=>{const We=I.querySelector(A);We&&(We.style[$]=fe)},dr=(I,A,$)=>{A?on(I,$):St(I)},Nr=I=>!(!I||!(I.offsetWidth||I.offsetHeight||I.getClientRects().length)),ki=I=>I.scrollHeight>I.clientHeight,oo=I=>{const A=window.getComputedStyle(I),$=parseFloat(A.getPropertyValue("animation-duration")||"0"),fe=parseFloat(A.getPropertyValue("transition-duration")||"0");return $>0||fe>0},Dr=function(I){let A=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const $=pr();Nr($)&&(A&&($.style.transition="none",$.style.width="100%"),setTimeout(()=>{$.style.transition="width ".concat(I/1e3,"s linear"),$.style.width="0%"},10))},gr=()=>typeof window>"u"||typeof document>"u",kn={},$n=I=>new Promise(A=>{if(!I)return A();const $=window.scrollX,fe=window.scrollY;kn.restoreFocusTimeout=setTimeout(()=>{kn.previousActiveElement&&kn.previousActiveElement.focus?(kn.previousActiveElement.focus(),kn.previousActiveElement=null):document.body&&document.body.focus(),A()},100),window.scrollTo($,fe)}),pt='\n <div aria-labelledby="'.concat(Ue.title,'" aria-describedby="').concat(Ue["html-container"],'" class="').concat(Ue.popup,'" tabindex="-1">\n   <button type="button" class="').concat(Ue.close,'"></button>\n   <ul class="').concat(Ue["progress-steps"],'"></ul>\n   <div class="').concat(Ue.icon,'"></div>\n   <img class="').concat(Ue.image,'" />\n   <h2 class="').concat(Ue.title,'" id="').concat(Ue.title,'"></h2>\n   <div class="').concat(Ue["html-container"],'" id="').concat(Ue["html-container"],'"></div>\n   <input class="').concat(Ue.input,'" />\n   <input type="file" class="').concat(Ue.file,'" />\n   <div class="').concat(Ue.range,'">\n     <input type="range" />\n     <output></output>\n   </div>\n   <select class="').concat(Ue.select,'"></select>\n   <div class="').concat(Ue.radio,'"></div>\n   <label for="').concat(Ue.checkbox,'" class="').concat(Ue.checkbox,'">\n     <input type="checkbox" />\n     <span class="').concat(Ue.label,'"></span>\n   </label>\n   <textarea class="').concat(Ue.textarea,'"></textarea>\n   <div class="').concat(Ue["validation-message"],'" id="').concat(Ue["validation-message"],'"></div>\n   <div class="').concat(Ue.actions,'">\n     <div class="').concat(Ue.loader,'"></div>\n     <button type="button" class="').concat(Ue.confirm,'"></button>\n     <button type="button" class="').concat(Ue.deny,'"></button>\n     <button type="button" class="').concat(Ue.cancel,'"></button>\n   </div>\n   <div class="').concat(Ue.footer,'"></div>\n   <div class="').concat(Ue["timer-progress-bar-container"],'">\n     <div class="').concat(Ue["timer-progress-bar"],'"></div>\n   </div>\n </div>\n').replace(/(^|\n)\s*/g,""),Re=()=>{kn.currentInstance.resetValidationMessage()},H=I=>{const A=(()=>{const I=Xt();return!!I&&(I.remove(),yn([document.documentElement,document.body],[Ue["no-backdrop"],Ue["toast-shown"],Ue["has-column"]]),!0)})();if(gr())return void u("SweetAlert2 requires document to initialize");const $=document.createElement("div");$.className=Ue.container,A&&Vn($,Ue["no-transition"]),Xr($,pt);const fe=(I=>"string"==typeof I?document.querySelector(I):I)(I.target);fe.appendChild($),(I=>{const A=mn();A.setAttribute("role",I.toast?"alert":"dialog"),A.setAttribute("aria-live",I.toast?"polite":"assertive"),I.toast||A.setAttribute("aria-modal","true")})(I),(I=>{"rtl"===window.getComputedStyle(I).direction&&Vn(Xt(),Ue.rtl)})(fe),(()=>{const I=mn(),A=Ri(I,Ue.input),$=Ri(I,Ue.file),fe=I.querySelector(".".concat(Ue.range," input")),We=I.querySelector(".".concat(Ue.range," output")),Ft=Ri(I,Ue.select),En=I.querySelector(".".concat(Ue.checkbox," input")),Qn=Ri(I,Ue.textarea);A.oninput=Re,$.onchange=Re,Ft.onchange=Re,En.onchange=Re,Qn.oninput=Re,fe.oninput=()=>{Re(),We.value=fe.value},fe.onchange=()=>{Re(),fe.nextSibling.value=fe.value}})()},K=(I,A)=>{I instanceof HTMLElement?A.appendChild(I):"object"==typeof I?de(I,A):I&&Xr(A,I)},de=(I,A)=>{I.jquery?Ee(A,I):Xr(A,I.toString())},Ee=(I,A)=>{if(I.textContent="",0 in A)for(let $=0;$ in A;$++)I.appendChild(A[$].cloneNode(!0));else I.appendChild(A.cloneNode(!0))},ne=(()=>{if(gr())return!1;const I=document.createElement("div"),A={WebkitAnimation:"webkitAnimationEnd",animation:"animationend"};for(const $ in A)if(Object.prototype.hasOwnProperty.call(A,$)&&typeof I.style[$]<"u")return A[$];return!1})(),q=(I,A)=>{const $=In(),fe=or();A.showConfirmButton||A.showDenyButton||A.showCancelButton?on($):St($),Br($,A,"actions"),function re(I,A,$){const fe=Nt(),We=Dn(),Ft=vn();je(fe,"confirm",$),je(We,"deny",$),je(Ft,"cancel",$),function pe(I,A,$,fe){if(!fe.buttonsStyling)return yn([I,A,$],Ue.styled);Vn([I,A,$],Ue.styled),fe.confirmButtonColor&&(I.style.backgroundColor=fe.confirmButtonColor,Vn(I,Ue["default-outline"])),fe.denyButtonColor&&(A.style.backgroundColor=fe.denyButtonColor,Vn(A,Ue["default-outline"])),fe.cancelButtonColor&&($.style.backgroundColor=fe.cancelButtonColor,Vn($,Ue["default-outline"]))}(fe,We,Ft,$),$.reverseButtons&&($.toast?(I.insertBefore(Ft,fe),I.insertBefore(We,fe)):(I.insertBefore(Ft,A),I.insertBefore(We,A),I.insertBefore(fe,A)))}($,fe,A),Xr(fe,A.loaderHtml),Br(fe,A,"loader")};function je(I,A,$){dr(I,$["show".concat(W(A),"Button")],"inline-block"),Xr(I,$["".concat(A,"ButtonText")]),I.setAttribute("aria-label",$["".concat(A,"ButtonAriaLabel")]),I.className=Ue[A],Br(I,$,"".concat(A,"Button")),Vn(I,$["".concat(A,"ButtonClass")])}const dn=(I,A)=>{const $=Xt();$&&(function ht(I,A){"string"==typeof A?I.style.background=A:A||Vn([document.documentElement,document.body],Ue["no-backdrop"])}($,A.backdrop),function ut(I,A){A in Ue?Vn(I,Ue[A]):($e('The "position" parameter is not valid, defaulting to "center"'),Vn(I,Ue.center))}($,A.position),function sn(I,A){if(A&&"string"==typeof A){const $="grow-".concat(A);$ in Ue&&Vn(I,Ue[$])}}($,A.grow),Br($,A,"container"))};var Rt={awaitingPromise:new WeakMap,promise:new WeakMap,innerParams:new WeakMap,domCache:new WeakMap};const xn=["input","file","range","select","radio","checkbox","textarea"],xr=I=>{if(!$r[I.input])return u('Unexpected type of input! Expected "text", "email", "password", "number", "tel", "select", "radio", "checkbox", "textarea", "file" or "url", got "'.concat(I.input,'"'));const A=ct(I.input),$=$r[I.input](A,I);on($),setTimeout(()=>{Pi($)})},Pr=(I,A)=>{const $=ri(mn(),I);if($){(I=>{for(let A=0;A<I.attributes.length;A++){const $=I.attributes[A].name;["type","value","style"].includes($)||I.removeAttribute($)}})($);for(const fe in A)$.setAttribute(fe,A[fe])}},Or=I=>{const A=ct(I.input);I.customClass&&Vn(A,I.customClass.input)},Ji=(I,A)=>{(!I.placeholder||A.inputPlaceholder)&&(I.placeholder=A.inputPlaceholder)},Hi=(I,A,$)=>{if($.inputLabel){I.id=Ue.input;const fe=document.createElement("label"),We=Ue["input-label"];fe.setAttribute("for",I.id),fe.className=We,Vn(fe,$.customClass.inputLabel),fe.innerText=$.inputLabel,A.insertAdjacentElement("beforebegin",fe)}},ct=I=>{const A=Ue[I]?Ue[I]:Ue.input;return Ri(mn(),A)},$r={};$r.text=$r.email=$r.password=$r.number=$r.tel=$r.url=(I,A)=>("string"==typeof A.inputValue||"number"==typeof A.inputValue?I.value=A.inputValue:ft(A.inputValue)||$e('Unexpected type of inputValue! Expected "string", "number" or "Promise", got "'.concat(typeof A.inputValue,'"')),Hi(I,I,A),Ji(I,A),I.type=A.input,I),$r.file=(I,A)=>(Hi(I,I,A),Ji(I,A),I),$r.range=(I,A)=>{const $=I.querySelector("input"),fe=I.querySelector("output");return $.value=A.inputValue,$.type=A.input,fe.value=A.inputValue,Hi($,I,A),I},$r.select=(I,A)=>{if(I.textContent="",A.inputPlaceholder){const $=document.createElement("option");Xr($,A.inputPlaceholder),$.value="",$.disabled=!0,$.selected=!0,I.appendChild($)}return Hi(I,I,A),I},$r.radio=I=>(I.textContent="",I),$r.checkbox=(I,A)=>{const $=ri(mn(),"checkbox");$.value="1",$.id=Ue.checkbox,$.checked=Boolean(A.inputValue);const fe=I.querySelector("span");return Xr(fe,A.inputPlaceholder),I},$r.textarea=(I,A)=>{I.value=A.inputValue,Ji(I,A),Hi(I,I,A);return setTimeout(()=>{if("MutationObserver"in window){const fe=parseInt(window.getComputedStyle(mn()).width);new MutationObserver(()=>{const Ft=I.offsetWidth+(fe=>parseInt(window.getComputedStyle(fe).marginLeft)+parseInt(window.getComputedStyle(fe).marginRight))(I);mn().style.width=Ft>fe?"".concat(Ft,"px"):null}).observe(I,{attributes:!0,attributeFilter:["style"]})}}),I};const qn=(I,A)=>{const $=rt();Br($,A,"htmlContainer"),A.html?(K(A.html,$),on($,"block")):A.text?($.textContent=A.text,on($,"block")):St($),((I,A)=>{const $=mn(),fe=Rt.innerParams.get(I),We=!fe||A.input!==fe.input;xn.forEach(Ft=>{const En=Ue[Ft],Qn=Ri($,En);Pr(Ft,A.inputAttributes),Qn.className=En,We&&St(Qn)}),A.input&&(We&&xr(A),Or(A))})(I,A)},Gr=(I,A)=>{for(const $ in en)A.icon!==$&&yn(I,en[$]);Vn(I,en[A.icon]),Ot(I,A),Ks(),Br(I,A,"icon")},Ks=()=>{const I=mn(),A=window.getComputedStyle(I).getPropertyValue("background-color"),$=I.querySelectorAll("[class^=swal2-success-circular-line], .swal2-success-fix");for(let fe=0;fe<$.length;fe++)$[fe].style.backgroundColor=A},On=(I,A)=>{I.textContent="",Xr(I,A.iconHtml?Gn(A.iconHtml):"success"===A.icon?'\n  <div class="swal2-success-circular-line-left"></div>\n  <span class="swal2-success-line-tip"></span> <span class="swal2-success-line-long"></span>\n  <div class="swal2-success-ring"></div> <div class="swal2-success-fix"></div>\n  <div class="swal2-success-circular-line-right"></div>\n':"error"===A.icon?'\n  <span class="swal2-x-mark">\n    <span class="swal2-x-mark-line-left"></span>\n    <span class="swal2-x-mark-line-right"></span>\n  </span>\n':Gn({question:"?",warning:"!",info:"i"}[A.icon]))},Ot=(I,A)=>{if(A.iconColor){I.style.color=A.iconColor,I.style.borderColor=A.iconColor;for(const $ of[".swal2-success-line-tip",".swal2-success-line-long",".swal2-x-mark-line-left",".swal2-x-mark-line-right"])vi(I,$,"backgroundColor",A.iconColor);vi(I,".swal2-success-ring","borderColor",A.iconColor)}},Gn=I=>'<div class="'.concat(Ue["icon-content"],'">').concat(I,"</div>"),Jr=(I,A)=>{const $=It();if(!A.progressSteps||0===A.progressSteps.length)return St($);on($),$.textContent="",A.currentProgressStep>=A.progressSteps.length&&$e("Invalid currentProgressStep parameter, it should be less than progressSteps.length (currentProgressStep like JS arrays starts from 0)"),A.progressSteps.forEach((fe,We)=>{const Ft=(I=>{const A=document.createElement("li");return Vn(A,Ue["progress-step"]),Xr(A,I),A})(fe);if($.appendChild(Ft),We===A.currentProgressStep&&Vn(Ft,Ue["active-progress-step"]),We!==A.progressSteps.length-1){const En=(I=>{const A=document.createElement("li");return Vn(A,Ue["progress-step-line"]),I.progressStepsDistance&&(A.style.width=I.progressStepsDistance),A})(A);$.appendChild(En)}})},Cr=(I,A)=>{I.className="".concat(Ue.popup," ").concat(Nr(I)?A.showClass.popup:""),A.toast?(Vn([document.documentElement,document.body],Ue["toast-shown"]),Vn(I,Ue.toast)):Vn(I,Ue.modal),Br(I,A,"popup"),"string"==typeof A.customClass&&Vn(I,A.customClass),A.icon&&Vn(I,Ue["icon-".concat(A.icon)])},os=(I,A)=>{((I,A)=>{const $=Xt(),fe=mn();A.toast?(Mr($,"width",A.width),fe.style.width="100%",fe.insertBefore(or(),Gt())):Mr(fe,"width",A.width),Mr(fe,"padding",A.padding),A.color&&(fe.style.color=A.color),A.background&&(fe.style.background=A.background),St(Ht()),Cr(fe,A)})(0,A),dn(0,A),Jr(0,A),((I,A)=>{const $=Rt.innerParams.get(I),fe=Gt();$&&A.icon===$.icon?(On(fe,A),Gr(fe,A)):A.icon||A.iconHtml?A.icon&&-1===Object.keys(en).indexOf(A.icon)?(u('Unknown icon! Expected "success", "error", "warning", "info" or "question", got "'.concat(A.icon,'"')),St(fe)):(on(fe),On(fe,A),Gr(fe,A),Vn(fe,A.showClass.icon)):St(fe)})(I,A),((I,A)=>{const $=Dt();if(!A.imageUrl)return St($);on($,""),$.setAttribute("src",A.imageUrl),$.setAttribute("alt",A.imageAlt),Mr($,"width",A.imageWidth),Mr($,"height",A.imageHeight),$.className=Ue.image,Br($,A,"image")})(0,A),((I,A)=>{const $=lt();dr($,A.title||A.titleText,"block"),A.title&&K(A.title,$),A.titleText&&($.innerText=A.titleText),Br($,A,"title")})(0,A),((I,A)=>{const $=vr();Xr($,A.closeButtonHtml),Br($,A,"closeButton"),dr($,A.showCloseButton),$.setAttribute("aria-label",A.closeButtonAriaLabel)})(0,A),qn(I,A),q(0,A),((I,A)=>{const $=cn();dr($,A.footer),A.footer&&K(A.footer,$),Br($,A,"footer")})(0,A),"function"==typeof A.didRender&&A.didRender(mn())},An=Object.freeze({cancel:"cancel",backdrop:"backdrop",close:"close",esc:"esc",timer:"timer"}),bi=()=>{_e(document.body.children).forEach(A=>{A.hasAttribute("data-previous-aria-hidden")?(A.setAttribute("aria-hidden",A.getAttribute("data-previous-aria-hidden")),A.removeAttribute("data-previous-aria-hidden")):A.removeAttribute("aria-hidden")})},Bs=["swal-title","swal-html","swal-footer"],li=I=>{const A={};return _e(I.querySelectorAll("swal-param")).forEach($=>{Bo($,["name","value"]);const fe=$.getAttribute("name"),We=$.getAttribute("value");"boolean"==typeof Et[fe]&&"false"===We&&(A[fe]=!1),"object"==typeof Et[fe]&&(A[fe]=JSON.parse(We))}),A},ao=I=>{const A={};return _e(I.querySelectorAll("swal-button")).forEach($=>{Bo($,["type","color","aria-label"]);const fe=$.getAttribute("type");A["".concat(fe,"ButtonText")]=$.innerHTML,A["show".concat(W(fe),"Button")]=!0,$.hasAttribute("color")&&(A["".concat(fe,"ButtonColor")]=$.getAttribute("color")),$.hasAttribute("aria-label")&&(A["".concat(fe,"ButtonAriaLabel")]=$.getAttribute("aria-label"))}),A},hi=I=>{const A={},$=I.querySelector("swal-image");return $&&(Bo($,["src","width","height","alt"]),$.hasAttribute("src")&&(A.imageUrl=$.getAttribute("src")),$.hasAttribute("width")&&(A.imageWidth=$.getAttribute("width")),$.hasAttribute("height")&&(A.imageHeight=$.getAttribute("height")),$.hasAttribute("alt")&&(A.imageAlt=$.getAttribute("alt"))),A},lo=I=>{const A={},$=I.querySelector("swal-icon");return $&&(Bo($,["type","color"]),$.hasAttribute("type")&&(A.icon=$.getAttribute("type")),$.hasAttribute("color")&&(A.iconColor=$.getAttribute("color")),A.iconHtml=$.innerHTML),A},Li=I=>{const A={},$=I.querySelector("swal-input");$&&(Bo($,["type","label","placeholder","value"]),A.input=$.getAttribute("type")||"text",$.hasAttribute("label")&&(A.inputLabel=$.getAttribute("label")),$.hasAttribute("placeholder")&&(A.inputPlaceholder=$.getAttribute("placeholder")),$.hasAttribute("value")&&(A.inputValue=$.getAttribute("value")));const fe=I.querySelectorAll("swal-input-option");return fe.length&&(A.inputOptions={},_e(fe).forEach(We=>{Bo(We,["value"]);const Ft=We.getAttribute("value");A.inputOptions[Ft]=We.innerHTML})),A},Qr=(I,A)=>{const $={};for(const fe in A){const We=A[fe],Ft=I.querySelector(We);Ft&&(Bo(Ft,[]),$[We.replace(/^swal-/,"")]=Ft.innerHTML.trim())}return $},Hr=I=>{const A=Bs.concat(["swal-param","swal-button","swal-image","swal-icon","swal-input","swal-input-option"]);_e(I.children).forEach($=>{const fe=$.tagName.toLowerCase();-1===A.indexOf(fe)&&$e("Unrecognized element <".concat(fe,">"))})},Bo=(I,A)=>{_e(I.attributes).forEach($=>{-1===A.indexOf($.name)&&$e(['Unrecognized attribute "'.concat($.name,'" on <').concat(I.tagName.toLowerCase(),">."),"".concat(A.length?"Allowed attributes are: ".concat(A.join(", ")):"To set the value, use HTML within the element.")])})};var Wi={email:(I,A)=>/^[a-zA-Z0-9.+_-]+@[a-zA-Z0-9.-]+\.[a-zA-Z0-9-]{2,24}$/.test(I)?Promise.resolve():Promise.resolve(A||"Invalid email address"),url:(I,A)=>/^https?:\/\/(www\.)?[-a-zA-Z0-9@:%._+~#=]{1,256}\.[a-z]{2,63}\b([-a-zA-Z0-9@:%_+.~#?&/=]*)$/.test(I)?Promise.resolve():Promise.resolve(A||"Invalid URL")};function Ys(I){(function co(I){I.inputValidator||Object.keys(Wi).forEach(A=>{I.input===A&&(I.inputValidator=Wi[A])})})(I),I.showLoaderOnConfirm&&!I.preConfirm&&$e("showLoaderOnConfirm is set to true, but preConfirm is not defined.\nshowLoaderOnConfirm should be used together with preConfirm, see usage example:\nhttps://sweetalert2.github.io/#ajax-request"),function Ns(I){(!I.target||"string"==typeof I.target&&!document.querySelector(I.target)||"string"!=typeof I.target&&!I.target.appendChild)&&($e('Target parameter is not valid, defaulting to "body"'),I.target="body")}(I),"string"==typeof I.title&&(I.title=I.title.split("\n").join("<br />")),H(I)}class ii{constructor(A,$){this.callback=A,this.remaining=$,this.running=!1,this.start()}start(){return this.running||(this.running=!0,this.started=new Date,this.id=setTimeout(this.callback,this.remaining)),this.remaining}stop(){return this.running&&(this.running=!1,clearTimeout(this.id),this.remaining-=(new Date).getTime()-this.started.getTime()),this.remaining}increase(A){const $=this.running;return $&&this.stop(),this.remaining+=A,$&&this.start(),this.remaining}getTimerLeft(){return this.running&&(this.stop(),this.start()),this.remaining}isRunning(){return this.running}}const Ni=()=>{null===yi.previousBodyPadding&&document.body.scrollHeight>window.innerHeight&&(yi.previousBodyPadding=parseInt(window.getComputedStyle(document.body).getPropertyValue("padding-right")),document.body.style.paddingRight="".concat(yi.previousBodyPadding+(()=>{const I=document.createElement("div");I.className=Ue["scrollbar-measure"],document.body.appendChild(I);const A=I.getBoundingClientRect().width-I.clientWidth;return document.body.removeChild(I),A})(),"px"))},xa=()=>{null!==yi.previousBodyPadding&&(document.body.style.paddingRight="".concat(yi.previousBodyPadding,"px"),yi.previousBodyPadding=null)},Wr=()=>{const I=navigator.userAgent,A=!!I.match(/iPad/i)||!!I.match(/iPhone/i),$=!!I.match(/WebKit/i);A&&$&&!I.match(/CriOS/i)&&mn().scrollHeight>window.innerHeight-44&&(Xt().style.paddingBottom="".concat(44,"px"))},ra=()=>{const I=Xt();let A;I.ontouchstart=$=>{A=Wo($)},I.ontouchmove=$=>{A&&($.preventDefault(),$.stopPropagation())}},Wo=I=>{const A=I.target,$=Xt();return!(Io(I)||eo(I)||A!==$&&(ki($)||"INPUT"===A.tagName||"TEXTAREA"===A.tagName||ki(rt())&&rt().contains(A)))},Io=I=>I.touches&&I.touches.length&&"stylus"===I.touches[0].touchType,eo=I=>I.touches&&I.touches.length>1,Js=()=>{if(Pn(document.body,Ue.iosfix)){const I=parseInt(document.body.style.top,10);yn(document.body,Ue.iosfix),document.body.style.top="",document.body.scrollTop=-1*I}},No=I=>{const A=Xt(),$=mn();"function"==typeof I.willOpen&&I.willOpen($);const We=window.getComputedStyle(document.body).overflowY;Ts(A,$,I),setTimeout(()=>{Ja(A,$)},10),ni()&&(Us(A,I.scrollbarPadding,We),_e(document.body.children).forEach(A=>{A===Xt()||A.contains(Xt())||(A.hasAttribute("aria-hidden")&&A.setAttribute("data-previous-aria-hidden",A.getAttribute("aria-hidden")),A.setAttribute("aria-hidden","true"))})),!wr()&&!kn.previousActiveElement&&(kn.previousActiveElement=document.activeElement),"function"==typeof I.didOpen&&setTimeout(()=>I.didOpen($)),yn(A,Ue["no-transition"])},wo=I=>{const A=mn();if(I.target!==A)return;const $=Xt();A.removeEventListener(ne,wo),$.style.overflowY="auto"},Ja=(I,A)=>{ne&&oo(A)?(I.style.overflowY="hidden",A.addEventListener(ne,wo)):I.style.overflowY="auto"},Us=(I,A,$)=>{(()=>{if((/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream||"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!Pn(document.body,Ue.iosfix)){const A=document.body.scrollTop;document.body.style.top="".concat(-1*A,"px"),Vn(document.body,Ue.iosfix),ra(),Wr()}})(),A&&"hidden"!==$&&Ni(),setTimeout(()=>{I.scrollTop=0})},Ts=(I,A,$)=>{Vn(I,$.showClass.backdrop),A.style.setProperty("opacity","0","important"),on(A,"grid"),setTimeout(()=>{Vn(A,$.showClass.popup),A.style.removeProperty("opacity")},10),Vn([document.documentElement,document.body],Ue.shown),$.heightAuto&&$.backdrop&&!$.toast&&Vn([document.documentElement,document.body],Ue["height-auto"])},to=I=>{let A=mn();A||new Ce,A=mn();const $=or();wr()?St(Gt()):ia(A,I),on($),A.setAttribute("data-loading",!0),A.setAttribute("aria-busy",!0),A.focus()},ia=(I,A)=>{const $=In(),fe=or();!A&&Nr(Nt())&&(A=Nt()),on($),A&&(St(A),fe.setAttribute("data-button-to-replace",A.className)),fe.parentNode.insertBefore(fe,A),Vn([I,$],Ue.loading)},oa=I=>I.checked?1:0,Fa=I=>I.checked?I.value:null,za=I=>I.files.length?null!==I.getAttribute("multiple")?I.files:I.files[0]:null,sa=(I,A)=>{const $=mn(),fe=We=>aa[A.input]($,Eo(We),A);gt(A.inputOptions)||ft(A.inputOptions)?(to(Nt()),nt(A.inputOptions).then(We=>{I.hideLoading(),fe(We)})):"object"==typeof A.inputOptions?fe(A.inputOptions):u("Unexpected type of inputOptions! Expected object, Map or Promise, got ".concat(typeof A.inputOptions))},bo=(I,A)=>{const $=I.getInput();St($),nt(A.inputValue).then(fe=>{$.value="number"===A.input?parseFloat(fe)||0:"".concat(fe),on($),$.focus(),I.hideLoading()}).catch(fe=>{u("Error in inputValue promise: ".concat(fe)),$.value="",on($),$.focus(),I.hideLoading()})},aa={select:(I,A,$)=>{const fe=Ri(I,Ue.select),We=(Ft,En,Qn)=>{const Xn=document.createElement("option");Xn.value=Qn,Xr(Xn,En),Xn.selected=Vs(Qn,$.inputValue),Ft.appendChild(Xn)};A.forEach(Ft=>{const En=Ft[0],Qn=Ft[1];if(Array.isArray(Qn)){const Xn=document.createElement("optgroup");Xn.label=En,Xn.disabled=!1,fe.appendChild(Xn),Qn.forEach(yt=>We(Xn,yt[1],yt[0]))}else We(fe,Qn,En)}),fe.focus()},radio:(I,A,$)=>{const fe=Ri(I,Ue.radio);A.forEach(Ft=>{const En=Ft[0],Qn=Ft[1],Xn=document.createElement("input"),yt=document.createElement("label");Xn.type="radio",Xn.name=Ue.radio,Xn.value=En,Vs(En,$.inputValue)&&(Xn.checked=!0);const Di=document.createElement("span");Xr(Di,Qn),Di.className=Ue.label,yt.appendChild(Xn),yt.appendChild(Di),fe.appendChild(yt)});const We=fe.querySelectorAll("input");We.length&&We[0].focus()}},Eo=I=>{const A=[];return typeof Map<"u"&&I instanceof Map?I.forEach(($,fe)=>{let We=$;"object"==typeof We&&(We=Eo(We)),A.push([fe,We])}):Object.keys(I).forEach($=>{let fe=I[$];"object"==typeof fe&&(fe=Eo(fe)),A.push([$,fe])}),A},Vs=(I,A)=>A&&A.toString()===I.toString();function Qa(){const I=Rt.innerParams.get(this);if(!I)return;const A=Rt.domCache.get(this);St(A.loader),wr()?I.icon&&on(Gt()):la(A),yn([A.popup,A.actions],Ue.loading),A.popup.removeAttribute("aria-busy"),A.popup.removeAttribute("data-loading"),A.confirmButton.disabled=!1,A.denyButton.disabled=!1,A.cancelButton.disabled=!1}const la=I=>{const A=I.popup.getElementsByClassName(I.loader.getAttribute("data-button-to-replace"));A.length?on(A[0],"inline-block"):!Nr(Nt())&&!Nr(Dn())&&!Nr(vn())&&St(I.actions)};var Ds={swalPromiseResolve:new WeakMap,swalPromiseReject:new WeakMap};const mr=()=>Nt()&&Nt().click(),Zo=I=>{I.keydownTarget&&I.keydownHandlerAdded&&(I.keydownTarget.removeEventListener("keydown",I.keydownHandler,{capture:I.keydownListenerCapture}),I.keydownHandlerAdded=!1)},qi=(I,A,$)=>{const fe=bn();if(fe.length)return(A+=$)===fe.length?A=0:-1===A&&(A=fe.length-1),fe[A].focus();mn().focus()},Ao=["ArrowRight","ArrowDown"],Cs=["ArrowLeft","ArrowUp"],no=(I,A,$)=>{const fe=Rt.innerParams.get(I);fe&&(A.isComposing||229===A.keyCode||(fe.stopKeydownPropagation&&A.stopPropagation(),"Enter"===A.key?$s(I,A,fe):"Tab"===A.key?Ss(A,fe):[...Ao,...Cs].includes(A.key)?di(A.key):"Escape"===A.key&&ca(A,fe,$)))},$s=(I,A,$)=>{if(bt($.allowEnterKey)&&A.target&&I.getInput()&&A.target.outerHTML===I.getInput().outerHTML){if(["textarea","file"].includes($.input))return;mr(),A.preventDefault()}},Ss=(I,A)=>{const $=I.target,fe=bn();let We=-1;for(let Ft=0;Ft<fe.length;Ft++)if($===fe[Ft]){We=Ft;break}qi(0,We,I.shiftKey?-1:1),I.stopPropagation(),I.preventDefault()},di=I=>{if(![Nt(),Dn(),vn()].includes(document.activeElement))return;const We=Ao.includes(I)?"nextElementSibling":"previousElementSibling";let Ft=document.activeElement;for(let En=0;En<In().children.length;En++){if(Ft=Ft[We],!Ft)return;if(Nr(Ft)&&Ft instanceof HTMLButtonElement)break}Ft instanceof HTMLButtonElement&&Ft.focus()},ca=(I,A,$)=>{bt(A.allowEscapeKey)&&(I.preventDefault(),$(An.esc))};function ls(I,A,$,fe){wr()?Ms(I,fe):($n($).then(()=>Ms(I,fe)),Zo(kn)),/^((?!chrome|android).)*safari/i.test(navigator.userAgent)?(A.setAttribute("style","display:none !important"),A.removeAttribute("class"),A.innerHTML=""):A.remove(),ni()&&(xa(),Js(),bi()),function Jn(){yn([document.documentElement,document.body],[Ue.shown,Ue["height-auto"],Ue["no-backdrop"],Ue["toast-shown"]])}()}function Xo(I){I=Ko(I);const A=Ds.swalPromiseResolve.get(this),$=cs(this);this.isAwaitingPromise()?I.isDismissed||(us(this),A(I)):$&&A(I)}const cs=I=>{const A=mn();if(!A)return!1;const $=Rt.innerParams.get(I);if(!$||Pn(A,$.hideClass.popup))return!1;yn(A,$.showClass.popup),Vn(A,$.hideClass.popup);const fe=Xt();return yn(fe,$.showClass.backdrop),Vn(fe,$.hideClass.backdrop),el(I,A,$),!0};const us=I=>{I.isAwaitingPromise()&&(Rt.awaitingPromise.delete(I),Rt.innerParams.get(I)||I._destroy())},Ko=I=>typeof I>"u"?{isConfirmed:!1,isDenied:!1,isDismissed:!0}:Object.assign({isConfirmed:!1,isDenied:!1,isDismissed:!1},I),el=(I,A,$)=>{const fe=Xt(),We=ne&&oo(A);"function"==typeof $.willClose&&$.willClose(A),We?Gs(I,A,fe,$.returnFocus,$.didClose):ls(I,fe,$.returnFocus,$.didClose)},Gs=(I,A,$,fe,We)=>{kn.swalCloseEventFinishedCallback=ls.bind(null,I,$,fe,We),A.addEventListener(ne,function(Ft){Ft.target===A&&(kn.swalCloseEventFinishedCallback(),delete kn.swalCloseEventFinishedCallback)})},Ms=(I,A)=>{setTimeout(()=>{"function"==typeof A&&A.bind(I.params)(),I._destroy()})};function Po(I,A,$){const fe=Rt.domCache.get(I);A.forEach(We=>{fe[We].disabled=$})}function nr(I,A){if(!I)return!1;if("radio"===I.type){const fe=I.parentNode.parentNode.querySelectorAll("input");for(let We=0;We<fe.length;We++)fe[We].disabled=A}else I.disabled=A}const zt=I=>{const A={};return Object.keys(I).forEach($=>{tr($)?A[$]=I[$]:$e('Invalid parameter to update: "'.concat($,'". Updatable params are listed here: https://github.com/sweetalert2/sweetalert2/blob/master/src/utils/params.js\n\nIf you think this parameter should be updatable, request it here: https://github.com/sweetalert2/sweetalert2/issues/new?template=02_feature_request.md'))}),A};const da=I=>{Na(I),delete I.params,delete kn.keydownHandler,delete kn.keydownTarget,delete kn.currentInstance},Na=I=>{I.isAwaitingPromise()?(Oi(Rt,I),Rt.awaitingPromise.set(I,!0)):(Oi(Ds,I),Oi(Rt,I))},Oi=(I,A)=>{for(const $ in I)I[$].delete(A)};var tl=Object.freeze({hideLoading:Qa,disableLoading:Qa,getInput:function go(I){const A=Rt.innerParams.get(I||this),$=Rt.domCache.get(I||this);return $?ri($.popup,A.input):null},close:Xo,isAwaitingPromise:function Ba(){return!!Rt.awaitingPromise.get(this)},rejectPromise:function ei(I){const A=Ds.swalPromiseReject.get(this);us(this),A&&A(I)},handleAwaitingPromise:us,closePopup:Xo,closeModal:Xo,closeToast:Xo,enableButtons:function ua(){Po(this,["confirmButton","denyButton","cancelButton"],!1)},disableButtons:function Qs(){Po(this,["confirmButton","denyButton","cancelButton"],!0)},enableInput:function ea(){return nr(this.getInput(),!1)},disableInput:function Ti(){return nr(this.getInput(),!0)},showValidationMessage:function Ea(I){const A=Rt.domCache.get(this),$=Rt.innerParams.get(this);Xr(A.validationMessage,I),A.validationMessage.className=Ue["validation-message"],$.customClass&&$.customClass.validationMessage&&Vn(A.validationMessage,$.customClass.validationMessage),on(A.validationMessage);const fe=this.getInput();fe&&(fe.setAttribute("aria-invalid",!0),fe.setAttribute("aria-describedby",Ue["validation-message"]),Pi(fe),Vn(fe,Ue.inputerror))},resetValidationMessage:function hs(){const I=Rt.domCache.get(this);I.validationMessage&&St(I.validationMessage);const A=this.getInput();A&&(A.removeAttribute("aria-invalid"),A.removeAttribute("aria-describedby"),yn(A,Ue.inputerror))},getProgressSteps:function ha(){return Rt.domCache.get(this).progressSteps},update:function Ta(I){const A=mn(),$=Rt.innerParams.get(this);if(!A||Pn(A,$.hideClass.popup))return $e("You're trying to update the closed or closing popup, that won't work. Use the update() method in preConfirm parameter or show a new popup.");const fe=zt(I),We=Object.assign({},$,fe);os(this,We),Rt.innerParams.set(this,We),Object.defineProperties(this,{params:{value:Object.assign({},this.params,I),writable:!1,enumerable:!0}})},_destroy:function sr(){const I=Rt.domCache.get(this),A=Rt.innerParams.get(this);A?(I.popup&&kn.swalCloseEventFinishedCallback&&(kn.swalCloseEventFinishedCallback(),delete kn.swalCloseEventFinishedCallback),kn.deferDisposalTimer&&(clearTimeout(kn.deferDisposalTimer),delete kn.deferDisposalTimer),"function"==typeof A.didDestroy&&A.didDestroy(),da(this)):Na(this)}});const ko=(I,A)=>{const $=Rt.innerParams.get(I);if(!$.input)return u('The "input" parameter is needed to be set when using returnInputValueOn'.concat(W(A)));const fe=((I,A)=>{const $=I.getInput();if(!$)return null;switch(A.input){case"checkbox":return oa($);case"radio":return Fa($);case"file":return za($);default:return A.inputAutoTrim?$.value.trim():$.value}})(I,$);$.inputValidator?ds(I,fe,A):I.getInput().checkValidity()?"deny"===A?nl(I,fe):_o(I,fe):(I.enableButtons(),I.showValidationMessage($.validationMessage))},ds=(I,A,$)=>{const fe=Rt.innerParams.get(I);I.disableInput(),Promise.resolve().then(()=>nt(fe.inputValidator(A,fe.validationMessage))).then(Ft=>{I.enableButtons(),I.enableInput(),Ft?I.showValidationMessage(Ft):"deny"===$?nl(I,A):_o(I,A)})},nl=(I,A)=>{const $=Rt.innerParams.get(I||void 0);$.showLoaderOnDeny&&to(Dn()),$.preDeny?(Rt.awaitingPromise.set(I||void 0,!0),Promise.resolve().then(()=>nt($.preDeny(A,$.validationMessage))).then(We=>{!1===We?(I.hideLoading(),us(I)):I.closePopup({isDenied:!0,value:typeof We>"u"?A:We})}).catch(We=>Zi(I||void 0,We))):I.closePopup({isDenied:!0,value:A})},Da=(I,A)=>{I.closePopup({isConfirmed:!0,value:A})},Zi=(I,A)=>{I.rejectPromise(A)},_o=(I,A)=>{const $=Rt.innerParams.get(I||void 0);$.showLoaderOnConfirm&&to(),$.preConfirm?(I.resetValidationMessage(),Rt.awaitingPromise.set(I||void 0,!0),Promise.resolve().then(()=>nt($.preConfirm(A,$.validationMessage))).then(We=>{Nr(Ht())||!1===We?(I.hideLoading(),us(I)):Da(I,typeof We>"u"?A:We)}).catch(We=>Zi(I||void 0,We))):Da(I,A)},Uo=(I,A,$)=>{A.popup.onclick=()=>{const fe=Rt.innerParams.get(I);fe&&(Q(fe)||fe.timer||fe.input)||$(An.close)}},Q=I=>I.showConfirmButton||I.showDenyButton||I.showCancelButton||I.showCloseButton;let M=!1;const P=I=>{I.popup.onmousedown=()=>{I.container.onmouseup=function(A){I.container.onmouseup=void 0,A.target===I.container&&(M=!0)}}},j=I=>{I.container.onmousedown=()=>{I.popup.onmouseup=function(A){I.popup.onmouseup=void 0,(A.target===I.popup||I.popup.contains(A.target))&&(M=!0)}}},te=(I,A,$)=>{A.container.onclick=fe=>{const We=Rt.innerParams.get(I);M?M=!1:fe.target===A.container&&bt(We.allowOutsideClick)&&$(An.backdrop)}},Oe=I=>I instanceof Element||(I=>"object"==typeof I&&I.jquery)(I);const _n=()=>{if(kn.timeout)return(()=>{const I=pr(),A=parseInt(window.getComputedStyle(I).width);I.style.removeProperty("transition"),I.style.width="100%";const fe=A/parseInt(window.getComputedStyle(I).width)*100;I.style.removeProperty("transition"),I.style.width="".concat(fe,"%")})(),kn.timeout.stop()},cr=()=>{if(kn.timeout){const I=kn.timeout.start();return Dr(I),I}};let fr=!1;const Fr={};const Rr=I=>{for(let A=I.target;A&&A!==document;A=A.parentNode)for(const $ in Fr){const fe=A.getAttribute($);if(fe)return void Fr[$].fire({template:fe})}};var Kr=Object.freeze({isValidParameter:Qt,isUpdatableParameter:tr,isDeprecatedParameter:dt,argsToParams:I=>{const A={};return"object"!=typeof I[0]||Oe(I[0])?["title","html","icon"].forEach(($,fe)=>{const We=I[fe];"string"==typeof We||Oe(We)?A[$]=We:void 0!==We&&u("Unexpected type of ".concat($,'! Expected "string" or "Element", got ').concat(typeof We))}):Object.assign(A,I[0]),A},isVisible:()=>Nr(mn()),clickConfirm:mr,clickDeny:()=>Dn()&&Dn().click(),clickCancel:()=>vn()&&vn().click(),getContainer:Xt,getPopup:mn,getTitle:lt,getHtmlContainer:rt,getImage:Dt,getIcon:Gt,getInputLabel:()=>an(Ue["input-label"]),getCloseButton:vr,getActions:In,getConfirmButton:Nt,getDenyButton:Dn,getCancelButton:vn,getLoader:or,getFooter:cn,getTimerProgressBar:pr,getFocusableElements:bn,getValidationMessage:Ht,isLoading:()=>mn().hasAttribute("data-loading"),fire:function et(){for(var A=arguments.length,$=new Array(A),fe=0;fe<A;fe++)$[fe]=arguments[fe];return new this(...$)},mixin:function xt(I){return class A extends(this){_main(fe,We){return super._main(fe,Object.assign({},I,We))}}},showLoading:to,enableLoading:to,getTimerLeft:()=>kn.timeout&&kn.timeout.getTimerLeft(),stopTimer:_n,resumeTimer:cr,toggleTimer:()=>{const I=kn.timeout;return I&&(I.running?_n():cr())},increaseTimer:I=>{if(kn.timeout){const A=kn.timeout.increase(I);return Dr(A,!0),A}},isTimerRunning:()=>kn.timeout&&kn.timeout.isRunning(),bindClickHandler:function oi(){Fr[arguments.length>0&&void 0!==arguments[0]?arguments[0]:"data-swal-template"]=this,fr||(document.body.addEventListener("click",Rr),fr=!0)}});let br;class Xi{constructor(){if(typeof window>"u")return;br=this;for(var A=arguments.length,$=new Array(A),fe=0;fe<A;fe++)$[fe]=arguments[fe];const We=Object.freeze(this.constructor.argsToParams($));Object.defineProperties(this,{params:{value:We,writable:!1,enumerable:!0,configurable:!0}});const Ft=this._main(this.params);Rt.promise.set(this,Ft)}_main(A){let $=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};(I=>{!I.backdrop&&I.allowOutsideClick&&$e('"allowOutsideClick" parameter requires `backdrop` parameter to be set to `true`');for(const A in I)Lr(A),I.toast&&Zr(A),Je(A)})(Object.assign({},$,A)),kn.currentInstance&&(kn.currentInstance._destroy(),ni()&&bi()),kn.currentInstance=this;const fe=jo(A,$);Ys(fe),Object.freeze(fe),kn.timeout&&(kn.timeout.stop(),delete kn.timeout),clearTimeout(kn.restoreFocusTimeout);const We=fs(this);return os(this,fe),Rt.innerParams.set(this,fe),Hn(this,We,fe)}then(A){return Rt.promise.get(this).then(A)}finally(A){return Rt.promise.get(this).finally(A)}}const Hn=(I,A,$)=>new Promise((fe,We)=>{const Ft=En=>{I.closePopup({isDismissed:!0,dismiss:En})};Ds.swalPromiseResolve.set(I,fe),Ds.swalPromiseReject.set(I,We),A.confirmButton.onclick=()=>(I=>{const A=Rt.innerParams.get(I);I.disableButtons(),A.input?ko(I,"confirm"):_o(I,!0)})(I),A.denyButton.onclick=()=>(I=>{const A=Rt.innerParams.get(I);I.disableButtons(),A.returnInputValueOnDeny?ko(I,"deny"):nl(I,!1)})(I),A.cancelButton.onclick=()=>((I,A)=>{I.disableButtons(),A(An.cancel)})(I,Ft),A.closeButton.onclick=()=>Ft(An.close),((I,A,$)=>{Rt.innerParams.get(I).toast?Uo(I,A,$):(P(A),j(A),te(I,A,$))})(I,A,Ft),((I,A,$,fe)=>{Zo(A),$.toast||(A.keydownHandler=We=>no(I,We,fe),A.keydownTarget=$.keydownListenerCapture?window:mn(),A.keydownListenerCapture=$.keydownListenerCapture,A.keydownTarget.addEventListener("keydown",A.keydownHandler,{capture:A.keydownListenerCapture}),A.keydownHandlerAdded=!0)})(I,kn,$,Ft),((I,A)=>{"select"===A.input||"radio"===A.input?sa(I,A):["text","email","number","tel","textarea"].includes(A.input)&&(gt(A.inputValue)||ft(A.inputValue))&&(to(Nt()),bo(I,A))})(I,$),No($),F(kn,$,Ft),X(A,$),setTimeout(()=>{A.container.scrollTop=0})}),jo=(I,A)=>{const $=(I=>{const A="string"==typeof I.template?document.querySelector(I.template):I.template;if(!A)return{};const $=A.content;return Hr($),Object.assign(li($),ao($),hi($),lo($),Li($),Qr($,Bs))})(I),fe=Object.assign({},Et,A,$,I);return fe.showClass=Object.assign({},Et.showClass,fe.showClass),fe.hideClass=Object.assign({},Et.hideClass,fe.hideClass),fe},fs=I=>{const A={popup:mn(),container:Xt(),actions:In(),confirmButton:Nt(),denyButton:Dn(),cancelButton:vn(),loader:or(),closeButton:vr(),validationMessage:Ht(),progressSteps:It()};return Rt.domCache.set(I,A),A},F=(I,A,$)=>{const fe=pr();St(fe),A.timer&&(I.timeout=new ii(()=>{$("timer"),delete I.timeout},A.timer),A.timerProgressBar&&(on(fe),Br(fe,A,"timerProgressBar"),setTimeout(()=>{I.timeout&&I.timeout.running&&Dr(A.timer)})))},X=(I,A)=>{if(!A.toast){if(!bt(A.allowEnterKey))return se();N(I,A)||qi(0,-1,1)}},N=(I,A)=>A.focusDeny&&Nr(I.denyButton)?(I.denyButton.focus(),!0):A.focusCancel&&Nr(I.cancelButton)?(I.cancelButton.focus(),!0):!(!A.focusConfirm||!Nr(I.confirmButton)||(I.confirmButton.focus(),0)),se=()=>{document.activeElement instanceof HTMLElement&&"function"==typeof document.activeElement.blur&&document.activeElement.blur()};Object.assign(Xi.prototype,tl),Object.assign(Xi,Kr),Object.keys(tl).forEach(I=>{Xi[I]=function(){if(br)return br[I](...arguments)}}),Xi.DismissReason=An,Xi.version="11.4.8";const Ce=Xi;return Ce.default=Ce,Ce}(),typeof this<"u"&&this.Sweetalert2&&(this.swal=this.sweetAlert=this.Swal=this.SweetAlert=this.Sweetalert2),typeof document<"u"&&function(At,we){var W=At.createElement("style");if(At.getElementsByTagName("head")[0].appendChild(W),W.styleSheet)W.styleSheet.disabled||(W.styleSheet.cssText=we);else try{W.innerHTML=we}catch{W.innerText=we}}(document,'.swal2-popup.swal2-toast{box-sizing:border-box;grid-column:1/4!important;grid-row:1/4!important;grid-template-columns:1fr 99fr 1fr;padding:1em;overflow-y:hidden;background:#fff;box-shadow:0 0 1px rgba(0,0,0,.075),0 1px 2px rgba(0,0,0,.075),1px 2px 4px rgba(0,0,0,.075),1px 3px 8px rgba(0,0,0,.075),2px 4px 16px rgba(0,0,0,.075);pointer-events:all}.swal2-popup.swal2-toast>*{grid-column:2}.swal2-popup.swal2-toast .swal2-title{margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-loading{justify-content:center}.swal2-popup.swal2-toast .swal2-input{height:2em;margin:.5em;font-size:1em}.swal2-popup.swal2-toast .swal2-validation-message{font-size:1em}.swal2-popup.swal2-toast .swal2-footer{margin:.5em 0 0;padding:.5em 0 0;font-size:.8em}.swal2-popup.swal2-toast .swal2-close{grid-column:3/3;grid-row:1/99;align-self:center;width:.8em;height:.8em;margin:0;font-size:2em}.swal2-popup.swal2-toast .swal2-html-container{margin:.5em 1em;padding:0;font-size:1em;text-align:initial}.swal2-popup.swal2-toast .swal2-html-container:empty{padding:0}.swal2-popup.swal2-toast .swal2-loader{grid-column:1;grid-row:1/99;align-self:center;width:2em;height:2em;margin:.25em}.swal2-popup.swal2-toast .swal2-icon{grid-column:1;grid-row:1/99;align-self:center;width:2em;min-width:2em;height:2em;margin:0 .5em 0 0}.swal2-popup.swal2-toast .swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:1.8em;font-weight:700}.swal2-popup.swal2-toast .swal2-icon.swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line]{top:.875em;width:1.375em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:.3125em}.swal2-popup.swal2-toast .swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:.3125em}.swal2-popup.swal2-toast .swal2-actions{justify-content:flex-start;height:auto;margin:0;margin-top:.5em;padding:0 .5em}.swal2-popup.swal2-toast .swal2-styled{margin:.25em .5em;padding:.4em .6em;font-size:1em}.swal2-popup.swal2-toast .swal2-success{border-color:#a5dc86}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line]{position:absolute;width:1.6em;height:3em;transform:rotate(45deg);border-radius:50%}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=left]{top:-.8em;left:-.5em;transform:rotate(-45deg);transform-origin:2em 2em;border-radius:4em 0 0 4em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-circular-line][class$=right]{top:-.25em;left:.9375em;transform-origin:0 1.5em;border-radius:0 4em 4em 0}.swal2-popup.swal2-toast .swal2-success .swal2-success-ring{width:2em;height:2em}.swal2-popup.swal2-toast .swal2-success .swal2-success-fix{top:0;left:.4375em;width:.4375em;height:2.6875em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line]{height:.3125em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=tip]{top:1.125em;left:.1875em;width:.75em}.swal2-popup.swal2-toast .swal2-success [class^=swal2-success-line][class$=long]{top:.9375em;right:.1875em;width:1.375em}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-tip{-webkit-animation:swal2-toast-animate-success-line-tip .75s;animation:swal2-toast-animate-success-line-tip .75s}.swal2-popup.swal2-toast .swal2-success.swal2-icon-show .swal2-success-line-long{-webkit-animation:swal2-toast-animate-success-line-long .75s;animation:swal2-toast-animate-success-line-long .75s}.swal2-popup.swal2-toast.swal2-show{-webkit-animation:swal2-toast-show .5s;animation:swal2-toast-show .5s}.swal2-popup.swal2-toast.swal2-hide{-webkit-animation:swal2-toast-hide .1s forwards;animation:swal2-toast-hide .1s forwards}.swal2-container{display:grid;position:fixed;z-index:1060;top:0;right:0;bottom:0;left:0;box-sizing:border-box;grid-template-areas:"top-start     top            top-end" "center-start  center         center-end" "bottom-start  bottom-center  bottom-end";grid-template-rows:minmax(-webkit-min-content,auto) minmax(-webkit-min-content,auto) minmax(-webkit-min-content,auto);grid-template-rows:minmax(min-content,auto) minmax(min-content,auto) minmax(min-content,auto);height:100%;padding:.625em;overflow-x:hidden;transition:background-color .1s;-webkit-overflow-scrolling:touch}.swal2-container.swal2-backdrop-show,.swal2-container.swal2-noanimation{background:rgba(0,0,0,.4)}.swal2-container.swal2-backdrop-hide{background:0 0!important}.swal2-container.swal2-bottom-start,.swal2-container.swal2-center-start,.swal2-container.swal2-top-start{grid-template-columns:minmax(0,1fr) auto auto}.swal2-container.swal2-bottom,.swal2-container.swal2-center,.swal2-container.swal2-top{grid-template-columns:auto minmax(0,1fr) auto}.swal2-container.swal2-bottom-end,.swal2-container.swal2-center-end,.swal2-container.swal2-top-end{grid-template-columns:auto auto minmax(0,1fr)}.swal2-container.swal2-top-start>.swal2-popup{align-self:start}.swal2-container.swal2-top>.swal2-popup{grid-column:2;align-self:start;justify-self:center}.swal2-container.swal2-top-end>.swal2-popup,.swal2-container.swal2-top-right>.swal2-popup{grid-column:3;align-self:start;justify-self:end}.swal2-container.swal2-center-left>.swal2-popup,.swal2-container.swal2-center-start>.swal2-popup{grid-row:2;align-self:center}.swal2-container.swal2-center>.swal2-popup{grid-column:2;grid-row:2;align-self:center;justify-self:center}.swal2-container.swal2-center-end>.swal2-popup,.swal2-container.swal2-center-right>.swal2-popup{grid-column:3;grid-row:2;align-self:center;justify-self:end}.swal2-container.swal2-bottom-left>.swal2-popup,.swal2-container.swal2-bottom-start>.swal2-popup{grid-column:1;grid-row:3;align-self:end}.swal2-container.swal2-bottom>.swal2-popup{grid-column:2;grid-row:3;justify-self:center;align-self:end}.swal2-container.swal2-bottom-end>.swal2-popup,.swal2-container.swal2-bottom-right>.swal2-popup{grid-column:3;grid-row:3;align-self:end;justify-self:end}.swal2-container.swal2-grow-fullscreen>.swal2-popup,.swal2-container.swal2-grow-row>.swal2-popup{grid-column:1/4;width:100%}.swal2-container.swal2-grow-column>.swal2-popup,.swal2-container.swal2-grow-fullscreen>.swal2-popup{grid-row:1/4;align-self:stretch}.swal2-container.swal2-no-transition{transition:none!important}.swal2-popup{display:none;position:relative;box-sizing:border-box;grid-template-columns:minmax(0,100%);width:32em;max-width:100%;padding:0 0 1.25em;border:none;border-radius:5px;background:#fff;color:#545454;font-family:inherit;font-size:1rem}.swal2-popup:focus{outline:0}.swal2-popup.swal2-loading{overflow-y:hidden}.swal2-title{position:relative;max-width:100%;margin:0;padding:.8em 1em 0;color:inherit;font-size:1.875em;font-weight:600;text-align:center;text-transform:none;word-wrap:break-word}.swal2-actions{display:flex;z-index:1;box-sizing:border-box;flex-wrap:wrap;align-items:center;justify-content:center;width:auto;margin:1.25em auto 0;padding:0}.swal2-actions:not(.swal2-loading) .swal2-styled[disabled]{opacity:.4}.swal2-actions:not(.swal2-loading) .swal2-styled:hover{background-image:linear-gradient(rgba(0,0,0,.1),rgba(0,0,0,.1))}.swal2-actions:not(.swal2-loading) .swal2-styled:active{background-image:linear-gradient(rgba(0,0,0,.2),rgba(0,0,0,.2))}.swal2-loader{display:none;align-items:center;justify-content:center;width:2.2em;height:2.2em;margin:0 1.875em;-webkit-animation:swal2-rotate-loading 1.5s linear 0s infinite normal;animation:swal2-rotate-loading 1.5s linear 0s infinite normal;border-width:.25em;border-style:solid;border-radius:100%;border-color:#2778c4 transparent #2778c4 transparent}.swal2-styled{margin:.3125em;padding:.625em 1.1em;transition:box-shadow .1s;box-shadow:0 0 0 3px transparent;font-weight:500}.swal2-styled:not([disabled]){cursor:pointer}.swal2-styled.swal2-confirm{border:0;border-radius:.25em;background:initial;background-color:#7066e0;color:#fff;font-size:1em}.swal2-styled.swal2-confirm:focus{box-shadow:0 0 0 3px rgba(112,102,224,.5)}.swal2-styled.swal2-deny{border:0;border-radius:.25em;background:initial;background-color:#dc3741;color:#fff;font-size:1em}.swal2-styled.swal2-deny:focus{box-shadow:0 0 0 3px rgba(220,55,65,.5)}.swal2-styled.swal2-cancel{border:0;border-radius:.25em;background:initial;background-color:#6e7881;color:#fff;font-size:1em}.swal2-styled.swal2-cancel:focus{box-shadow:0 0 0 3px rgba(110,120,129,.5)}.swal2-styled.swal2-default-outline:focus{box-shadow:0 0 0 3px rgba(100,150,200,.5)}.swal2-styled:focus{outline:0}.swal2-styled::-moz-focus-inner{border:0}.swal2-footer{justify-content:center;margin:1em 0 0;padding:1em 1em 0;border-top:1px solid #eee;color:inherit;font-size:1em}.swal2-timer-progress-bar-container{position:absolute;right:0;bottom:0;left:0;grid-column:auto!important;overflow:hidden;border-bottom-right-radius:5px;border-bottom-left-radius:5px}.swal2-timer-progress-bar{width:100%;height:.25em;background:rgba(0,0,0,.2)}.swal2-image{max-width:100%;margin:2em auto 1em}.swal2-close{z-index:2;align-items:center;justify-content:center;width:1.2em;height:1.2em;margin-top:0;margin-right:0;margin-bottom:-1.2em;padding:0;overflow:hidden;transition:color .1s,box-shadow .1s;border:none;border-radius:5px;background:0 0;color:#ccc;font-family:serif;font-family:monospace;font-size:2.5em;cursor:pointer;justify-self:end}.swal2-close:hover{transform:none;background:0 0;color:#f27474}.swal2-close:focus{outline:0;box-shadow:inset 0 0 0 3px rgba(100,150,200,.5)}.swal2-close::-moz-focus-inner{border:0}.swal2-html-container{z-index:1;justify-content:center;margin:1em 1.6em .3em;padding:0;overflow:auto;color:inherit;font-size:1.125em;font-weight:400;line-height:normal;text-align:center;word-wrap:break-word;word-break:break-word}.swal2-checkbox,.swal2-file,.swal2-input,.swal2-radio,.swal2-select,.swal2-textarea{margin:1em 2em 3px}.swal2-file,.swal2-input,.swal2-textarea{box-sizing:border-box;width:auto;transition:border-color .1s,box-shadow .1s;border:1px solid #d9d9d9;border-radius:.1875em;background:inherit;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px transparent;color:inherit;font-size:1.125em}.swal2-file.swal2-inputerror,.swal2-input.swal2-inputerror,.swal2-textarea.swal2-inputerror{border-color:#f27474!important;box-shadow:0 0 2px #f27474!important}.swal2-file:focus,.swal2-input:focus,.swal2-textarea:focus{border:1px solid #b4dbed;outline:0;box-shadow:inset 0 1px 1px rgba(0,0,0,.06),0 0 0 3px rgba(100,150,200,.5)}.swal2-file::-moz-placeholder,.swal2-input::-moz-placeholder,.swal2-textarea::-moz-placeholder{color:#ccc}.swal2-file:-ms-input-placeholder,.swal2-input:-ms-input-placeholder,.swal2-textarea:-ms-input-placeholder{color:#ccc}.swal2-file::placeholder,.swal2-input::placeholder,.swal2-textarea::placeholder{color:#ccc}.swal2-range{margin:1em 2em 3px;background:#fff}.swal2-range input{width:80%}.swal2-range output{width:20%;color:inherit;font-weight:600;text-align:center}.swal2-range input,.swal2-range output{height:2.625em;padding:0;font-size:1.125em;line-height:2.625em}.swal2-input{height:2.625em;padding:0 .75em}.swal2-file{width:75%;margin-right:auto;margin-left:auto;background:inherit;font-size:1.125em}.swal2-textarea{height:6.75em;padding:.75em}.swal2-select{min-width:50%;max-width:100%;padding:.375em .625em;background:inherit;color:inherit;font-size:1.125em}.swal2-checkbox,.swal2-radio{align-items:center;justify-content:center;background:#fff;color:inherit}.swal2-checkbox label,.swal2-radio label{margin:0 .6em;font-size:1.125em}.swal2-checkbox input,.swal2-radio input{flex-shrink:0;margin:0 .4em}.swal2-input-label{display:flex;justify-content:center;margin:1em auto 0}.swal2-validation-message{align-items:center;justify-content:center;margin:1em 0 0;padding:.625em;overflow:hidden;background:#f0f0f0;color:#666;font-size:1em;font-weight:300}.swal2-validation-message::before{content:"!";display:inline-block;width:1.5em;min-width:1.5em;height:1.5em;margin:0 .625em;border-radius:50%;background-color:#f27474;color:#fff;font-weight:600;line-height:1.5em;text-align:center}.swal2-icon{position:relative;box-sizing:content-box;justify-content:center;width:5em;height:5em;margin:2.5em auto .6em;border:.25em solid transparent;border-radius:50%;border-color:#000;font-family:inherit;line-height:5em;cursor:default;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.swal2-icon .swal2-icon-content{display:flex;align-items:center;font-size:3.75em}.swal2-icon.swal2-error{border-color:#f27474;color:#f27474}.swal2-icon.swal2-error .swal2-x-mark{position:relative;flex-grow:1}.swal2-icon.swal2-error [class^=swal2-x-mark-line]{display:block;position:absolute;top:2.3125em;width:2.9375em;height:.3125em;border-radius:.125em;background-color:#f27474}.swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=left]{left:1.0625em;transform:rotate(45deg)}.swal2-icon.swal2-error [class^=swal2-x-mark-line][class$=right]{right:1em;transform:rotate(-45deg)}.swal2-icon.swal2-error.swal2-icon-show{-webkit-animation:swal2-animate-error-icon .5s;animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-error.swal2-icon-show .swal2-x-mark{-webkit-animation:swal2-animate-error-x-mark .5s;animation:swal2-animate-error-x-mark .5s}.swal2-icon.swal2-warning{border-color:#facea8;color:#f8bb86}.swal2-icon.swal2-warning.swal2-icon-show{-webkit-animation:swal2-animate-error-icon .5s;animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-warning.swal2-icon-show .swal2-icon-content{-webkit-animation:swal2-animate-i-mark .5s;animation:swal2-animate-i-mark .5s}.swal2-icon.swal2-info{border-color:#9de0f6;color:#3fc3ee}.swal2-icon.swal2-info.swal2-icon-show{-webkit-animation:swal2-animate-error-icon .5s;animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-info.swal2-icon-show .swal2-icon-content{-webkit-animation:swal2-animate-i-mark .8s;animation:swal2-animate-i-mark .8s}.swal2-icon.swal2-question{border-color:#c9dae1;color:#87adbd}.swal2-icon.swal2-question.swal2-icon-show{-webkit-animation:swal2-animate-error-icon .5s;animation:swal2-animate-error-icon .5s}.swal2-icon.swal2-question.swal2-icon-show .swal2-icon-content{-webkit-animation:swal2-animate-question-mark .8s;animation:swal2-animate-question-mark .8s}.swal2-icon.swal2-success{border-color:#a5dc86;color:#a5dc86}.swal2-icon.swal2-success [class^=swal2-success-circular-line]{position:absolute;width:3.75em;height:7.5em;transform:rotate(45deg);border-radius:50%}.swal2-icon.swal2-success [class^=swal2-success-circular-line][class$=left]{top:-.4375em;left:-2.0635em;transform:rotate(-45deg);transform-origin:3.75em 3.75em;border-radius:7.5em 0 0 7.5em}.swal2-icon.swal2-success [class^=swal2-success-circular-line][class$=right]{top:-.6875em;left:1.875em;transform:rotate(-45deg);transform-origin:0 3.75em;border-radius:0 7.5em 7.5em 0}.swal2-icon.swal2-success .swal2-success-ring{position:absolute;z-index:2;top:-.25em;left:-.25em;box-sizing:content-box;width:100%;height:100%;border:.25em solid rgba(165,220,134,.3);border-radius:50%}.swal2-icon.swal2-success .swal2-success-fix{position:absolute;z-index:1;top:.5em;left:1.625em;width:.4375em;height:5.625em;transform:rotate(-45deg)}.swal2-icon.swal2-success [class^=swal2-success-line]{display:block;position:absolute;z-index:2;height:.3125em;border-radius:.125em;background-color:#a5dc86}.swal2-icon.swal2-success [class^=swal2-success-line][class$=tip]{top:2.875em;left:.8125em;width:1.5625em;transform:rotate(45deg)}.swal2-icon.swal2-success [class^=swal2-success-line][class$=long]{top:2.375em;right:.5em;width:2.9375em;transform:rotate(-45deg)}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-line-tip{-webkit-animation:swal2-animate-success-line-tip .75s;animation:swal2-animate-success-line-tip .75s}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-line-long{-webkit-animation:swal2-animate-success-line-long .75s;animation:swal2-animate-success-line-long .75s}.swal2-icon.swal2-success.swal2-icon-show .swal2-success-circular-line-right{-webkit-animation:swal2-rotate-success-circular-line 4.25s ease-in;animation:swal2-rotate-success-circular-line 4.25s ease-in}.swal2-progress-steps{flex-wrap:wrap;align-items:center;max-width:100%;margin:1.25em auto;padding:0;background:inherit;font-weight:600}.swal2-progress-steps li{display:inline-block;position:relative}.swal2-progress-steps .swal2-progress-step{z-index:20;flex-shrink:0;width:2em;height:2em;border-radius:2em;background:#2778c4;color:#fff;line-height:2em;text-align:center}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step{background:#2778c4}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step{background:#add8e6;color:#fff}.swal2-progress-steps .swal2-progress-step.swal2-active-progress-step~.swal2-progress-step-line{background:#add8e6}.swal2-progress-steps .swal2-progress-step-line{z-index:10;flex-shrink:0;width:2.5em;height:.4em;margin:0 -1px;background:#2778c4}[class^=swal2]{-webkit-tap-highlight-color:transparent}.swal2-show{-webkit-animation:swal2-show .3s;animation:swal2-show .3s}.swal2-hide{-webkit-animation:swal2-hide .15s forwards;animation:swal2-hide .15s forwards}.swal2-noanimation{transition:none}.swal2-scrollbar-measure{position:absolute;top:-9999px;width:50px;height:50px;overflow:scroll}.swal2-rtl .swal2-close{margin-right:initial;margin-left:0}.swal2-rtl .swal2-timer-progress-bar{right:0;left:auto}@-webkit-keyframes swal2-toast-show{0%{transform:translateY(-.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0)}}@keyframes swal2-toast-show{0%{transform:translateY(-.625em) rotateZ(2deg)}33%{transform:translateY(0) rotateZ(-2deg)}66%{transform:translateY(.3125em) rotateZ(2deg)}100%{transform:translateY(0) rotateZ(0)}}@-webkit-keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@keyframes swal2-toast-hide{100%{transform:rotateZ(1deg);opacity:0}}@-webkit-keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@keyframes swal2-toast-animate-success-line-tip{0%{top:.5625em;left:.0625em;width:0}54%{top:.125em;left:.125em;width:0}70%{top:.625em;left:-.25em;width:1.625em}84%{top:1.0625em;left:.75em;width:.5em}100%{top:1.125em;left:.1875em;width:.75em}}@-webkit-keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}@keyframes swal2-toast-animate-success-line-long{0%{top:1.625em;right:1.375em;width:0}65%{top:1.25em;right:.9375em;width:0}84%{top:.9375em;right:0;width:1.125em}100%{top:.9375em;right:.1875em;width:1.375em}}@-webkit-keyframes swal2-show{0%{transform:scale(.7)}45%{transform:scale(1.05)}80%{transform:scale(.95)}100%{transform:scale(1)}}@keyframes swal2-show{0%{transform:scale(.7)}45%{transform:scale(1.05)}80%{transform:scale(.95)}100%{transform:scale(1)}}@-webkit-keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(.5);opacity:0}}@keyframes swal2-hide{0%{transform:scale(1);opacity:1}100%{transform:scale(.5);opacity:0}}@-webkit-keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@keyframes swal2-animate-success-line-tip{0%{top:1.1875em;left:.0625em;width:0}54%{top:1.0625em;left:.125em;width:0}70%{top:2.1875em;left:-.375em;width:3.125em}84%{top:3em;left:1.3125em;width:1.0625em}100%{top:2.8125em;left:.8125em;width:1.5625em}}@-webkit-keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@keyframes swal2-animate-success-line-long{0%{top:3.375em;right:2.875em;width:0}65%{top:3.375em;right:2.875em;width:0}84%{top:2.1875em;right:0;width:3.4375em}100%{top:2.375em;right:.5em;width:2.9375em}}@-webkit-keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@keyframes swal2-rotate-success-circular-line{0%{transform:rotate(-45deg)}5%{transform:rotate(-45deg)}12%{transform:rotate(-405deg)}100%{transform:rotate(-405deg)}}@-webkit-keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(.4);opacity:0}50%{margin-top:1.625em;transform:scale(.4);opacity:0}80%{margin-top:-.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@keyframes swal2-animate-error-x-mark{0%{margin-top:1.625em;transform:scale(.4);opacity:0}50%{margin-top:1.625em;transform:scale(.4);opacity:0}80%{margin-top:-.375em;transform:scale(1.15)}100%{margin-top:0;transform:scale(1);opacity:1}}@-webkit-keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-animate-error-icon{0%{transform:rotateX(100deg);opacity:0}100%{transform:rotateX(0);opacity:1}}@-webkit-keyframes swal2-rotate-loading{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}@keyframes swal2-rotate-loading{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}@-webkit-keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@keyframes swal2-animate-question-mark{0%{transform:rotateY(-360deg)}100%{transform:rotateY(0)}}@-webkit-keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}@keyframes swal2-animate-i-mark{0%{transform:rotateZ(45deg);opacity:0}25%{transform:rotateZ(-25deg);opacity:.4}50%{transform:rotateZ(15deg);opacity:.8}75%{transform:rotateZ(-5deg);opacity:1}100%{transform:rotateX(0);opacity:1}}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow:hidden}body.swal2-height-auto{height:auto!important}body.swal2-no-backdrop .swal2-container{background-color:transparent!important;pointer-events:none}body.swal2-no-backdrop .swal2-container .swal2-popup{pointer-events:all}body.swal2-no-backdrop .swal2-container .swal2-modal{box-shadow:0 0 10px rgba(0,0,0,.4)}@media print{body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown){overflow-y:scroll!important}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown)>[aria-hidden=true]{display:none}body.swal2-shown:not(.swal2-no-backdrop):not(.swal2-toast-shown) .swal2-container{position:static!important}}body.swal2-toast-shown .swal2-container{box-sizing:border-box;width:360px;max-width:100%;background-color:transparent;pointer-events:none}body.swal2-toast-shown .swal2-container.swal2-top{top:0;right:auto;bottom:auto;left:50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-top-end,body.swal2-toast-shown .swal2-container.swal2-top-right{top:0;right:0;bottom:auto;left:auto}body.swal2-toast-shown .swal2-container.swal2-top-left,body.swal2-toast-shown .swal2-container.swal2-top-start{top:0;right:auto;bottom:auto;left:0}body.swal2-toast-shown .swal2-container.swal2-center-left,body.swal2-toast-shown .swal2-container.swal2-center-start{top:50%;right:auto;bottom:auto;left:0;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-center{top:50%;right:auto;bottom:auto;left:50%;transform:translate(-50%,-50%)}body.swal2-toast-shown .swal2-container.swal2-center-end,body.swal2-toast-shown .swal2-container.swal2-center-right{top:50%;right:0;bottom:auto;left:auto;transform:translateY(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-left,body.swal2-toast-shown .swal2-container.swal2-bottom-start{top:auto;right:auto;bottom:0;left:0}body.swal2-toast-shown .swal2-container.swal2-bottom{top:auto;right:auto;bottom:0;left:50%;transform:translateX(-50%)}body.swal2-toast-shown .swal2-container.swal2-bottom-end,body.swal2-toast-shown .swal2-container.swal2-bottom-right{top:auto;right:0;bottom:0;left:auto}')},655:(Yn,At,we)=>{"use strict";function Et(lt,rt,Dt,It){return new(Dt||(Dt=Promise))(function(Nt,Dn){function yr(In){try{vn(It.next(In))}catch(cn){Dn(cn)}}function or(In){try{vn(It.throw(In))}catch(cn){Dn(cn)}}function vn(In){In.done?Nt(In.value):function Ht(Nt){return Nt instanceof Dt?Nt:new Dt(function(Dn){Dn(Nt)})}(In.value).then(yr,or)}vn((It=It.apply(lt,rt||[])).next())})}function Je(lt){return this instanceof Je?(this.v=lt,this):new Je(lt)}function Ne(lt,rt,Dt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Ht,It=Dt.apply(lt,rt||[]),Nt=[];return Ht={},Dn("next"),Dn("throw"),Dn("return"),Ht[Symbol.asyncIterator]=function(){return this},Ht;function Dn(pr){It[pr]&&(Ht[pr]=function(vr){return new Promise(function(si,bn){Nt.push([pr,vr,si,bn])>1||yr(pr,vr)})})}function yr(pr,vr){try{!function or(pr){pr.value instanceof Je?Promise.resolve(pr.value.v).then(vn,In):cn(Nt[0][2],pr)}(It[pr](vr))}catch(si){cn(Nt[0][3],si)}}function vn(pr){yr("next",pr)}function In(pr){yr("throw",pr)}function cn(pr,vr){pr(vr),Nt.shift(),Nt.length&&yr(Nt[0][0],Nt[0][1])}}function ln(lt){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var Dt,rt=lt[Symbol.asyncIterator];return rt?rt.call(lt):(lt=function Qt(lt){var rt="function"==typeof Symbol&&Symbol.iterator,Dt=rt&&lt[rt],It=0;if(Dt)return Dt.call(lt);if(lt&&"number"==typeof lt.length)return{next:function(){return lt&&It>=lt.length&&(lt=void 0),{value:lt&&lt[It++],done:!lt}}};throw new TypeError(rt?"Object is not iterable.":"Symbol.iterator is not defined.")}(lt),Dt={},It("next"),It("throw"),It("return"),Dt[Symbol.asyncIterator]=function(){return this},Dt);function It(Nt){Dt[Nt]=lt[Nt]&&function(Dn){return new Promise(function(yr,or){!function Ht(Nt,Dn,yr,or){Promise.resolve(or).then(function(vn){Nt({value:vn,done:yr})},Dn)}(yr,or,(Dn=lt[Nt](Dn)).done,Dn.value)})}}}we.d(At,{FC:()=>Ne,KL:()=>ln,mG:()=>Et,qq:()=>Je})},7340:(Yn,At,we)=>{"use strict";we.d(At,{LC:()=>_e,X$:()=>u,ZE:()=>Lr,ZN:()=>dt,_7:()=>Jt,_j:()=>W,eR:()=>ft,jt:()=>Ie,k1:()=>Zr,l3:()=>$e,oB:()=>bt,oQ:()=>Et,vP:()=>Ut});class W{}class _e{}const $e="*";function u(Je,Ne){return{type:7,name:Je,definitions:Ne,options:{}}}function Ie(Je,Ne=null){return{type:4,styles:Ne,timings:Je}}function Ut(Je,Ne=null){return{type:2,steps:Je,options:Ne}}function bt(Je){return{type:6,styles:Je,offset:null}}function ft(Je,Ne,mt=null){return{type:1,expr:Je,animation:Ne,options:mt}}function Et(Je,Ne=null){return{type:8,animation:Je,options:Ne}}function Jt(Je,Ne=null){return{type:10,animation:Je,options:Ne}}function tr(Je){Promise.resolve().then(Je)}class dt{constructor(Ne=0,mt=0){this._onDoneFns=[],this._onStartFns=[],this._onDestroyFns=[],this._originalOnDoneFns=[],this._originalOnStartFns=[],this._started=!1,this._destroyed=!1,this._finished=!1,this._position=0,this.parentPlayer=null,this.totalTime=Ne+mt}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(Ne=>Ne()),this._onDoneFns=[])}onStart(Ne){this._originalOnStartFns.push(Ne),this._onStartFns.push(Ne)}onDone(Ne){this._originalOnDoneFns.push(Ne),this._onDoneFns.push(Ne)}onDestroy(Ne){this._onDestroyFns.push(Ne)}hasStarted(){return this._started}init(){}play(){this.hasStarted()||(this._onStart(),this.triggerMicrotask()),this._started=!0}triggerMicrotask(){tr(()=>this._onFinish())}_onStart(){this._onStartFns.forEach(Ne=>Ne()),this._onStartFns=[]}pause(){}restart(){}finish(){this._onFinish()}destroy(){this._destroyed||(this._destroyed=!0,this.hasStarted()||this._onStart(),this.finish(),this._onDestroyFns.forEach(Ne=>Ne()),this._onDestroyFns=[])}reset(){this._started=!1,this._finished=!1,this._onStartFns=this._originalOnStartFns,this._onDoneFns=this._originalOnDoneFns}setPosition(Ne){this._position=this.totalTime?Ne*this.totalTime:1}getPosition(){return this.totalTime?this._position/this.totalTime:1}triggerCallback(Ne){const mt="start"==Ne?this._onStartFns:this._onDoneFns;mt.forEach(ln=>ln()),mt.length=0}}class Lr{constructor(Ne){this._onDoneFns=[],this._onStartFns=[],this._finished=!1,this._started=!1,this._destroyed=!1,this._onDestroyFns=[],this.parentPlayer=null,this.totalTime=0,this.players=Ne;let mt=0,ln=0,Ue=0;const en=this.players.length;0==en?tr(()=>this._onFinish()):this.players.forEach(Xt=>{Xt.onDone(()=>{++mt==en&&this._onFinish()}),Xt.onDestroy(()=>{++ln==en&&this._onDestroy()}),Xt.onStart(()=>{++Ue==en&&this._onStart()})}),this.totalTime=this.players.reduce((Xt,$t)=>Math.max(Xt,$t.totalTime),0)}_onFinish(){this._finished||(this._finished=!0,this._onDoneFns.forEach(Ne=>Ne()),this._onDoneFns=[])}init(){this.players.forEach(Ne=>Ne.init())}onStart(Ne){this._onStartFns.push(Ne)}_onStart(){this.hasStarted()||(this._started=!0,this._onStartFns.forEach(Ne=>Ne()),this._onStartFns=[])}onDone(Ne){this._onDoneFns.push(Ne)}onDestroy(Ne){this._onDestroyFns.push(Ne)}hasStarted(){return this._started}play(){this.parentPlayer||this.init(),this._onStart(),this.players.forEach(Ne=>Ne.play())}pause(){this.players.forEach(Ne=>Ne.pause())}restart(){this.players.forEach(Ne=>Ne.restart())}finish(){this._onFinish(),this.players.forEach(Ne=>Ne.finish())}destroy(){this._onDestroy()}_onDestroy(){this._destroyed||(this._destroyed=!0,this._onFinish(),this.players.forEach(Ne=>Ne.destroy()),this._onDestroyFns.forEach(Ne=>Ne()),this._onDestroyFns=[])}reset(){this.players.forEach(Ne=>Ne.reset()),this._destroyed=!1,this._finished=!1,this._started=!1}setPosition(Ne){const mt=Ne*this.totalTime;this.players.forEach(ln=>{const Ue=ln.totalTime?Math.min(1,mt/ln.totalTime):1;ln.setPosition(Ue)})}getPosition(){const Ne=this.players.reduce((mt,ln)=>null===mt||ln.totalTime>mt.totalTime?ln:mt,null);return null!=Ne?Ne.getPosition():0}beforeDestroy(){this.players.forEach(Ne=>{Ne.beforeDestroy&&Ne.beforeDestroy()})}triggerCallback(Ne){const mt="start"==Ne?this._onStartFns:this._onDoneFns;mt.forEach(ln=>ln()),mt.length=0}}const Zr="!"},6895:(Yn,At,we)=>{"use strict";we.d(At,{Do:()=>Lr,EM:()=>Qa,HT:()=>u,JF:()=>mr,K0:()=>Kt,Mx:()=>Bi,NF:()=>sa,O5:()=>mo,PC:()=>Qi,S$:()=>Qt,V_:()=>gt,Ye:()=>Zr,b0:()=>dt,bD:()=>uo,ez:()=>js,mk:()=>Ks,q:()=>$e,sg:()=>Gn,tP:()=>li,w_:()=>Ie});var W=we(1571);let _e=null;function $e(){return _e}function u(F){_e||(_e=F)}class Ie{}const Kt=new W.OlP("DocumentToken");let Ut=(()=>{class F{historyGo(N){throw new Error("Not implemented")}}return F.\u0275fac=function(N){return new(N||F)},F.\u0275prov=W.Yz7({token:F,factory:function(){return function bt(){return(0,W.LFG)(nt)}()},providedIn:"platform"}),F})();const gt=new W.OlP("Location Initialized");let nt=(()=>{class F extends Ut{constructor(N){super(),this._doc=N,this._location=window.location,this._history=window.history}getBaseHrefFromDOM(){return $e().getBaseHref(this._doc)}onPopState(N){const se=$e().getGlobalEventTarget(this._doc,"window");return se.addEventListener("popstate",N,!1),()=>se.removeEventListener("popstate",N)}onHashChange(N){const se=$e().getGlobalEventTarget(this._doc,"window");return se.addEventListener("hashchange",N,!1),()=>se.removeEventListener("hashchange",N)}get href(){return this._location.href}get protocol(){return this._location.protocol}get hostname(){return this._location.hostname}get port(){return this._location.port}get pathname(){return this._location.pathname}get search(){return this._location.search}get hash(){return this._location.hash}set pathname(N){this._location.pathname=N}pushState(N,se,Ce){ft()?this._history.pushState(N,se,Ce):this._location.hash=Ce}replaceState(N,se,Ce){ft()?this._history.replaceState(N,se,Ce):this._location.hash=Ce}forward(){this._history.forward()}back(){this._history.back()}historyGo(N=0){this._history.go(N)}getState(){return this._history.state}}return F.\u0275fac=function(N){return new(N||F)(W.LFG(Kt))},F.\u0275prov=W.Yz7({token:F,factory:function(){return function Et(){return new nt((0,W.LFG)(Kt))}()},providedIn:"platform"}),F})();function ft(){return!!window.history.pushState}function jn(F,X){if(0==F.length)return X;if(0==X.length)return F;let N=0;return F.endsWith("/")&&N++,X.startsWith("/")&&N++,2==N?F+X.substring(1):1==N?F+X:F+"/"+X}function Jt(F){const X=F.match(/#|\?|$/),N=X&&X.index||F.length;return F.slice(0,N-("/"===F[N-1]?1:0))+F.slice(N)}function hn(F){return F&&"?"!==F[0]?"?"+F:F}let Qt=(()=>{class F{historyGo(N){throw new Error("Not implemented")}}return F.\u0275fac=function(N){return new(N||F)},F.\u0275prov=W.Yz7({token:F,factory:function(){return(0,W.f3M)(dt)},providedIn:"root"}),F})();const tr=new W.OlP("appBaseHref");let dt=(()=>{class F extends Qt{constructor(N,se){super(),this._platformLocation=N,this._removeListenerFns=[],this._baseHref=se??this._platformLocation.getBaseHrefFromDOM()??(0,W.f3M)(Kt).location?.origin??""}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(N){this._removeListenerFns.push(this._platformLocation.onPopState(N),this._platformLocation.onHashChange(N))}getBaseHref(){return this._baseHref}prepareExternalUrl(N){return jn(this._baseHref,N)}path(N=!1){const se=this._platformLocation.pathname+hn(this._platformLocation.search),Ce=this._platformLocation.hash;return Ce&&N?`${se}${Ce}`:se}pushState(N,se,Ce,I){const A=this.prepareExternalUrl(Ce+hn(I));this._platformLocation.pushState(N,se,A)}replaceState(N,se,Ce,I){const A=this.prepareExternalUrl(Ce+hn(I));this._platformLocation.replaceState(N,se,A)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(N=0){this._platformLocation.historyGo?.(N)}}return F.\u0275fac=function(N){return new(N||F)(W.LFG(Ut),W.LFG(tr,8))},F.\u0275prov=W.Yz7({token:F,factory:F.\u0275fac,providedIn:"root"}),F})(),Lr=(()=>{class F extends Qt{constructor(N,se){super(),this._platformLocation=N,this._baseHref="",this._removeListenerFns=[],null!=se&&(this._baseHref=se)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(N){this._removeListenerFns.push(this._platformLocation.onPopState(N),this._platformLocation.onHashChange(N))}getBaseHref(){return this._baseHref}path(N=!1){let se=this._platformLocation.hash;return null==se&&(se="#"),se.length>0?se.substring(1):se}prepareExternalUrl(N){const se=jn(this._baseHref,N);return se.length>0?"#"+se:se}pushState(N,se,Ce,I){let A=this.prepareExternalUrl(Ce+hn(I));0==A.length&&(A=this._platformLocation.pathname),this._platformLocation.pushState(N,se,A)}replaceState(N,se,Ce,I){let A=this.prepareExternalUrl(Ce+hn(I));0==A.length&&(A=this._platformLocation.pathname),this._platformLocation.replaceState(N,se,A)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}getState(){return this._platformLocation.getState()}historyGo(N=0){this._platformLocation.historyGo?.(N)}}return F.\u0275fac=function(N){return new(N||F)(W.LFG(Ut),W.LFG(tr,8))},F.\u0275prov=W.Yz7({token:F,factory:F.\u0275fac}),F})(),Zr=(()=>{class F{constructor(N){this._subject=new W.vpe,this._urlChangeListeners=[],this._urlChangeSubscription=null,this._locationStrategy=N;const se=this._locationStrategy.getBaseHref();this._basePath=function ln(F){if(new RegExp("^(https?:)?//").test(F)){const[,N]=F.split(/\/\/[^\/]+/);return N}return F}(Jt(mt(se))),this._locationStrategy.onPopState(Ce=>{this._subject.emit({url:this.path(!0),pop:!0,state:Ce.state,type:Ce.type})})}ngOnDestroy(){this._urlChangeSubscription?.unsubscribe(),this._urlChangeListeners=[]}path(N=!1){return this.normalize(this._locationStrategy.path(N))}getState(){return this._locationStrategy.getState()}isCurrentPathEqualTo(N,se=""){return this.path()==this.normalize(N+hn(se))}normalize(N){return F.stripTrailingSlash(function Ne(F,X){if(!F||!X.startsWith(F))return X;const N=X.substring(F.length);return""===N||["/",";","?","#"].includes(N[0])?N:X}(this._basePath,mt(N)))}prepareExternalUrl(N){return N&&"/"!==N[0]&&(N="/"+N),this._locationStrategy.prepareExternalUrl(N)}go(N,se="",Ce=null){this._locationStrategy.pushState(Ce,"",N,se),this._notifyUrlChangeListeners(this.prepareExternalUrl(N+hn(se)),Ce)}replaceState(N,se="",Ce=null){this._locationStrategy.replaceState(Ce,"",N,se),this._notifyUrlChangeListeners(this.prepareExternalUrl(N+hn(se)),Ce)}forward(){this._locationStrategy.forward()}back(){this._locationStrategy.back()}historyGo(N=0){this._locationStrategy.historyGo?.(N)}onUrlChange(N){return this._urlChangeListeners.push(N),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(se=>{this._notifyUrlChangeListeners(se.url,se.state)})),()=>{const se=this._urlChangeListeners.indexOf(N);this._urlChangeListeners.splice(se,1),0===this._urlChangeListeners.length&&(this._urlChangeSubscription?.unsubscribe(),this._urlChangeSubscription=null)}}_notifyUrlChangeListeners(N="",se){this._urlChangeListeners.forEach(Ce=>Ce(N,se))}subscribe(N,se,Ce){return this._subject.subscribe({next:N,error:se,complete:Ce})}}return F.normalizeQueryParams=hn,F.joinWithSlash=jn,F.stripTrailingSlash=Jt,F.\u0275fac=function(N){return new(N||F)(W.LFG(Qt))},F.\u0275prov=W.Yz7({token:F,factory:function(){return function Je(){return new Zr((0,W.LFG)(Qt))}()},providedIn:"root"}),F})();function mt(F){return F.replace(/\/index.html$/,"")}function Bi(F,X){X=encodeURIComponent(X);for(const N of F.split(";")){const se=N.indexOf("="),[Ce,I]=-1==se?[N,""]:[N.slice(0,se),N.slice(se+1)];if(Ce.trim()===X)return decodeURIComponent(I)}return null}const ai=/\s+/,Gr=[];let Ks=(()=>{class F{constructor(N,se,Ce,I){this._iterableDiffers=N,this._keyValueDiffers=se,this._ngEl=Ce,this._renderer=I,this.initialClasses=Gr,this.stateMap=new Map}set klass(N){this.initialClasses=null!=N?N.trim().split(ai):Gr}set ngClass(N){this.rawClass="string"==typeof N?N.trim().split(ai):N}ngDoCheck(){for(const se of this.initialClasses)this._updateState(se,!0);const N=this.rawClass;if(Array.isArray(N)||N instanceof Set)for(const se of N)this._updateState(se,!0);else if(null!=N)for(const se of Object.keys(N))this._updateState(se,Boolean(N[se]));this._applyStateDiff()}_updateState(N,se){const Ce=this.stateMap.get(N);void 0!==Ce?(Ce.enabled!==se&&(Ce.changed=!0,Ce.enabled=se),Ce.touched=!0):this.stateMap.set(N,{enabled:se,changed:!0,touched:!0})}_applyStateDiff(){for(const N of this.stateMap){const se=N[0],Ce=N[1];Ce.changed?(this._toggleClass(se,Ce.enabled),Ce.changed=!1):Ce.touched||(Ce.enabled&&this._toggleClass(se,!1),this.stateMap.delete(se)),Ce.touched=!1}}_toggleClass(N,se){(N=N.trim()).length>0&&N.split(ai).forEach(Ce=>{se?this._renderer.addClass(this._ngEl.nativeElement,Ce):this._renderer.removeClass(this._ngEl.nativeElement,Ce)})}}return F.\u0275fac=function(N){return new(N||F)(W.Y36(W.ZZ4),W.Y36(W.aQg),W.Y36(W.SBq),W.Y36(W.Qsj))},F.\u0275dir=W.lG2({type:F,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"},standalone:!0}),F})();class Ot{constructor(X,N,se,Ce){this.$implicit=X,this.ngForOf=N,this.index=se,this.count=Ce}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Gn=(()=>{class F{set ngForOf(N){this._ngForOf=N,this._ngForOfDirty=!0}set ngForTrackBy(N){this._trackByFn=N}get ngForTrackBy(){return this._trackByFn}constructor(N,se,Ce){this._viewContainer=N,this._template=se,this._differs=Ce,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForTemplate(N){N&&(this._template=N)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const N=this._ngForOf;!this._differ&&N&&(this._differ=this._differs.find(N).create(this.ngForTrackBy))}if(this._differ){const N=this._differ.diff(this._ngForOf);N&&this._applyChanges(N)}}_applyChanges(N){const se=this._viewContainer;N.forEachOperation((Ce,I,A)=>{if(null==Ce.previousIndex)se.createEmbeddedView(this._template,new Ot(Ce.item,this._ngForOf,-1,-1),null===A?void 0:A);else if(null==A)se.remove(null===I?void 0:I);else if(null!==I){const $=se.get(I);se.move($,A),Ur($,Ce)}});for(let Ce=0,I=se.length;Ce<I;Ce++){const $=se.get(Ce).context;$.index=Ce,$.count=I,$.ngForOf=this._ngForOf}N.forEachIdentityChange(Ce=>{Ur(se.get(Ce.currentIndex),Ce)})}static ngTemplateContextGuard(N,se){return!0}}return F.\u0275fac=function(N){return new(N||F)(W.Y36(W.s_b),W.Y36(W.Rgc),W.Y36(W.ZZ4))},F.\u0275dir=W.lG2({type:F,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"},standalone:!0}),F})();function Ur(F,X){F.context.$implicit=X.item}let mo=(()=>{class F{constructor(N,se){this._viewContainer=N,this._context=new Jr,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=se}set ngIf(N){this._context.$implicit=this._context.ngIf=N,this._updateView()}set ngIfThen(N){Mo("ngIfThen",N),this._thenTemplateRef=N,this._thenViewRef=null,this._updateView()}set ngIfElse(N){Mo("ngIfElse",N),this._elseTemplateRef=N,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(N,se){return!0}}return F.\u0275fac=function(N){return new(N||F)(W.Y36(W.s_b),W.Y36(W.Rgc))},F.\u0275dir=W.lG2({type:F,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"},standalone:!0}),F})();class Jr{constructor(){this.$implicit=null,this.ngIf=null}}function Mo(F,X){if(X&&!X.createEmbeddedView)throw new Error(`${F} must be a TemplateRef, but received '${(0,W.AaK)(X)}'.`)}let Qi=(()=>{class F{constructor(N,se,Ce){this._ngEl=N,this._differs=se,this._renderer=Ce,this._ngStyle=null,this._differ=null}set ngStyle(N){this._ngStyle=N,!this._differ&&N&&(this._differ=this._differs.find(N).create())}ngDoCheck(){if(this._differ){const N=this._differ.diff(this._ngStyle);N&&this._applyChanges(N)}}_setStyle(N,se){const[Ce,I]=N.split("."),A=-1===Ce.indexOf("-")?void 0:W.JOm.DashCase;null!=se?this._renderer.setStyle(this._ngEl.nativeElement,Ce,I?`${se}${I}`:se,A):this._renderer.removeStyle(this._ngEl.nativeElement,Ce,A)}_applyChanges(N){N.forEachRemovedItem(se=>this._setStyle(se.key,null)),N.forEachAddedItem(se=>this._setStyle(se.key,se.currentValue)),N.forEachChangedItem(se=>this._setStyle(se.key,se.currentValue))}}return F.\u0275fac=function(N){return new(N||F)(W.Y36(W.SBq),W.Y36(W.aQg),W.Y36(W.Qsj))},F.\u0275dir=W.lG2({type:F,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"},standalone:!0}),F})(),li=(()=>{class F{constructor(N){this._viewContainerRef=N,this._viewRef=null,this.ngTemplateOutletContext=null,this.ngTemplateOutlet=null,this.ngTemplateOutletInjector=null}ngOnChanges(N){if(N.ngTemplateOutlet||N.ngTemplateOutletInjector){const se=this._viewContainerRef;if(this._viewRef&&se.remove(se.indexOf(this._viewRef)),this.ngTemplateOutlet){const{ngTemplateOutlet:Ce,ngTemplateOutletContext:I,ngTemplateOutletInjector:A}=this;this._viewRef=se.createEmbeddedView(Ce,I,A?{injector:A}:void 0)}else this._viewRef=null}else this._viewRef&&N.ngTemplateOutletContext&&this.ngTemplateOutletContext&&(this._viewRef.context=this.ngTemplateOutletContext)}}return F.\u0275fac=function(N){return new(N||F)(W.Y36(W.s_b))},F.\u0275dir=W.lG2({type:F,selectors:[["","ngTemplateOutlet",""]],inputs:{ngTemplateOutletContext:"ngTemplateOutletContext",ngTemplateOutlet:"ngTemplateOutlet",ngTemplateOutletInjector:"ngTemplateOutletInjector"},standalone:!0,features:[W.TTD]}),F})(),js=(()=>{class F{}return F.\u0275fac=function(N){return new(N||F)},F.\u0275mod=W.oAB({type:F}),F.\u0275inj=W.cJS({}),F})();const uo="browser";function sa(F){return F===uo}let Qa=(()=>{class F{}return F.\u0275prov=(0,W.Yz7)({token:F,providedIn:"root",factory:()=>new la((0,W.LFG)(Kt),window)}),F})();class la{constructor(X,N){this.document=X,this.window=N,this.offset=()=>[0,0]}setOffset(X){this.offset=Array.isArray(X)?()=>X:X}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(X){this.supportsScrolling()&&this.window.scrollTo(X[0],X[1])}scrollToAnchor(X){if(!this.supportsScrolling())return;const N=function Ds(F,X){const N=F.getElementById(X)||F.getElementsByName(X)[0];if(N)return N;if("function"==typeof F.createTreeWalker&&F.body&&(F.body.createShadowRoot||F.body.attachShadow)){const se=F.createTreeWalker(F.body,NodeFilter.SHOW_ELEMENT);let Ce=se.currentNode;for(;Ce;){const I=Ce.shadowRoot;if(I){const A=I.getElementById(X)||I.querySelector(`[name="${X}"]`);if(A)return A}Ce=se.nextNode()}}return null}(this.document,X);N&&(this.scrollToElement(N),N.focus())}setHistoryScrollRestoration(X){if(this.supportScrollRestoration()){const N=this.window.history;N&&N.scrollRestoration&&(N.scrollRestoration=X)}}scrollToElement(X){const N=X.getBoundingClientRect(),se=N.left+this.window.pageXOffset,Ce=N.top+this.window.pageYOffset,I=this.offset();this.window.scrollTo(se-I[0],Ce-I[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const X=go(this.window.history)||go(Object.getPrototypeOf(this.window.history));return!(!X||!X.writable&&!X.set)}catch{return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch{return!1}}}function go(F){return Object.getOwnPropertyDescriptor(F,"scrollRestoration")}class mr{}},529:(Yn,At,we)=>{"use strict";we.d(At,{JF:()=>kn,PG:()=>bt,WM:()=>nt,eN:()=>rt});var W=we(6895),_e=we(1571),$e=we(9646),u=we(9751),Ie=we(4351),Kt=we(9300),Ut=we(4004);class bt{}class gt{}class nt{constructor(Fe){this.normalizedNames=new Map,this.lazyUpdate=null,Fe?this.lazyInit="string"==typeof Fe?()=>{this.headers=new Map,Fe.split("\n").forEach(Re=>{const Wt=Re.indexOf(":");if(Wt>0){const Pt=Re.slice(0,Wt),Ln=Pt.toLowerCase(),ue=Re.slice(Wt+1).trim();this.maybeSetNormalizedName(Pt,Ln),this.headers.has(Ln)?this.headers.get(Ln).push(ue):this.headers.set(Ln,[ue])}})}:()=>{this.headers=new Map,Object.keys(Fe).forEach(Re=>{let Wt=Fe[Re];const Pt=Re.toLowerCase();"string"==typeof Wt&&(Wt=[Wt]),Wt.length>0&&(this.headers.set(Pt,Wt),this.maybeSetNormalizedName(Re,Pt))})}:this.headers=new Map}has(Fe){return this.init(),this.headers.has(Fe.toLowerCase())}get(Fe){this.init();const Re=this.headers.get(Fe.toLowerCase());return Re&&Re.length>0?Re[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(Fe){return this.init(),this.headers.get(Fe.toLowerCase())||null}append(Fe,Re){return this.clone({name:Fe,value:Re,op:"a"})}set(Fe,Re){return this.clone({name:Fe,value:Re,op:"s"})}delete(Fe,Re){return this.clone({name:Fe,value:Re,op:"d"})}maybeSetNormalizedName(Fe,Re){this.normalizedNames.has(Re)||this.normalizedNames.set(Re,Fe)}init(){this.lazyInit&&(this.lazyInit instanceof nt?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(Fe=>this.applyUpdate(Fe)),this.lazyUpdate=null))}copyFrom(Fe){Fe.init(),Array.from(Fe.headers.keys()).forEach(Re=>{this.headers.set(Re,Fe.headers.get(Re)),this.normalizedNames.set(Re,Fe.normalizedNames.get(Re))})}clone(Fe){const Re=new nt;return Re.lazyInit=this.lazyInit&&this.lazyInit instanceof nt?this.lazyInit:this,Re.lazyUpdate=(this.lazyUpdate||[]).concat([Fe]),Re}applyUpdate(Fe){const Re=Fe.name.toLowerCase();switch(Fe.op){case"a":case"s":let Wt=Fe.value;if("string"==typeof Wt&&(Wt=[Wt]),0===Wt.length)return;this.maybeSetNormalizedName(Fe.name,Re);const Pt=("a"===Fe.op?this.headers.get(Re):void 0)||[];Pt.push(...Wt),this.headers.set(Re,Pt);break;case"d":const Ln=Fe.value;if(Ln){let ue=this.headers.get(Re);if(!ue)return;ue=ue.filter(H=>-1===Ln.indexOf(H)),0===ue.length?(this.headers.delete(Re),this.normalizedNames.delete(Re)):this.headers.set(Re,ue)}else this.headers.delete(Re),this.normalizedNames.delete(Re)}}forEach(Fe){this.init(),Array.from(this.normalizedNames.keys()).forEach(Re=>Fe(this.normalizedNames.get(Re),this.headers.get(Re)))}}class Et{encodeKey(Fe){return Qt(Fe)}encodeValue(Fe){return Qt(Fe)}decodeKey(Fe){return decodeURIComponent(Fe)}decodeValue(Fe){return decodeURIComponent(Fe)}}const Jt=/%(\d[a-f0-9])/gi,hn={40:"@","3A":":",24:"$","2C":",","3B":";","3D":"=","3F":"?","2F":"/"};function Qt(pt){return encodeURIComponent(pt).replace(Jt,(Fe,Re)=>hn[Re]??Fe)}function tr(pt){return`${pt}`}class dt{constructor(Fe={}){if(this.updates=null,this.cloneFrom=null,this.encoder=Fe.encoder||new Et,Fe.fromString){if(Fe.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function jn(pt,Fe){const Re=new Map;return pt.length>0&&pt.replace(/^\?/,"").split("&").forEach(Pt=>{const Ln=Pt.indexOf("="),[ue,H]=-1==Ln?[Fe.decodeKey(Pt),""]:[Fe.decodeKey(Pt.slice(0,Ln)),Fe.decodeValue(Pt.slice(Ln+1))],K=Re.get(ue)||[];K.push(H),Re.set(ue,K)}),Re}(Fe.fromString,this.encoder)}else Fe.fromObject?(this.map=new Map,Object.keys(Fe.fromObject).forEach(Re=>{const Wt=Fe.fromObject[Re],Pt=Array.isArray(Wt)?Wt.map(tr):[tr(Wt)];this.map.set(Re,Pt)})):this.map=null}has(Fe){return this.init(),this.map.has(Fe)}get(Fe){this.init();const Re=this.map.get(Fe);return Re?Re[0]:null}getAll(Fe){return this.init(),this.map.get(Fe)||null}keys(){return this.init(),Array.from(this.map.keys())}append(Fe,Re){return this.clone({param:Fe,value:Re,op:"a"})}appendAll(Fe){const Re=[];return Object.keys(Fe).forEach(Wt=>{const Pt=Fe[Wt];Array.isArray(Pt)?Pt.forEach(Ln=>{Re.push({param:Wt,value:Ln,op:"a"})}):Re.push({param:Wt,value:Pt,op:"a"})}),this.clone(Re)}set(Fe,Re){return this.clone({param:Fe,value:Re,op:"s"})}delete(Fe,Re){return this.clone({param:Fe,value:Re,op:"d"})}toString(){return this.init(),this.keys().map(Fe=>{const Re=this.encoder.encodeKey(Fe);return this.map.get(Fe).map(Wt=>Re+"="+this.encoder.encodeValue(Wt)).join("&")}).filter(Fe=>""!==Fe).join("&")}clone(Fe){const Re=new dt({encoder:this.encoder});return Re.cloneFrom=this.cloneFrom||this,Re.updates=(this.updates||[]).concat(Fe),Re}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(Fe=>this.map.set(Fe,this.cloneFrom.map.get(Fe))),this.updates.forEach(Fe=>{switch(Fe.op){case"a":case"s":const Re=("a"===Fe.op?this.map.get(Fe.param):void 0)||[];Re.push(tr(Fe.value)),this.map.set(Fe.param,Re);break;case"d":if(void 0===Fe.value){this.map.delete(Fe.param);break}{let Wt=this.map.get(Fe.param)||[];const Pt=Wt.indexOf(tr(Fe.value));-1!==Pt&&Wt.splice(Pt,1),Wt.length>0?this.map.set(Fe.param,Wt):this.map.delete(Fe.param)}}}),this.cloneFrom=this.updates=null)}}class Zr{constructor(){this.map=new Map}set(Fe,Re){return this.map.set(Fe,Re),this}get(Fe){return this.map.has(Fe)||this.map.set(Fe,Fe.defaultValue()),this.map.get(Fe)}delete(Fe){return this.map.delete(Fe),this}has(Fe){return this.map.has(Fe)}keys(){return this.map.keys()}}function Ne(pt){return typeof ArrayBuffer<"u"&&pt instanceof ArrayBuffer}function mt(pt){return typeof Blob<"u"&&pt instanceof Blob}function ln(pt){return typeof FormData<"u"&&pt instanceof FormData}class en{constructor(Fe,Re,Wt,Pt){let Ln;if(this.url=Re,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=Fe.toUpperCase(),function Je(pt){switch(pt){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||Pt?(this.body=void 0!==Wt?Wt:null,Ln=Pt):Ln=Wt,Ln&&(this.reportProgress=!!Ln.reportProgress,this.withCredentials=!!Ln.withCredentials,Ln.responseType&&(this.responseType=Ln.responseType),Ln.headers&&(this.headers=Ln.headers),Ln.context&&(this.context=Ln.context),Ln.params&&(this.params=Ln.params)),this.headers||(this.headers=new nt),this.context||(this.context=new Zr),this.params){const ue=this.params.toString();if(0===ue.length)this.urlWithParams=Re;else{const H=Re.indexOf("?");this.urlWithParams=Re+(-1===H?"?":H<Re.length-1?"&":"")+ue}}else this.params=new dt,this.urlWithParams=Re}serializeBody(){return null===this.body?null:Ne(this.body)||mt(this.body)||ln(this.body)||function Ue(pt){return typeof URLSearchParams<"u"&&pt instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof dt?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||ln(this.body)?null:mt(this.body)?this.body.type||null:Ne(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof dt?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(Fe={}){const Re=Fe.method||this.method,Wt=Fe.url||this.url,Pt=Fe.responseType||this.responseType,Ln=void 0!==Fe.body?Fe.body:this.body,ue=void 0!==Fe.withCredentials?Fe.withCredentials:this.withCredentials,H=void 0!==Fe.reportProgress?Fe.reportProgress:this.reportProgress;let K=Fe.headers||this.headers,de=Fe.params||this.params;const Ee=Fe.context??this.context;return void 0!==Fe.setHeaders&&(K=Object.keys(Fe.setHeaders).reduce((ne,ie)=>ne.set(ie,Fe.setHeaders[ie]),K)),Fe.setParams&&(de=Object.keys(Fe.setParams).reduce((ne,ie)=>ne.set(ie,Fe.setParams[ie]),de)),new en(Re,Wt,Ln,{params:de,headers:K,context:Ee,reportProgress:H,responseType:Pt,withCredentials:ue})}}var Xt=(()=>((Xt=Xt||{})[Xt.Sent=0]="Sent",Xt[Xt.UploadProgress=1]="UploadProgress",Xt[Xt.ResponseHeader=2]="ResponseHeader",Xt[Xt.DownloadProgress=3]="DownloadProgress",Xt[Xt.Response=4]="Response",Xt[Xt.User=5]="User",Xt))();class $t{constructor(Fe,Re=200,Wt="OK"){this.headers=Fe.headers||new nt,this.status=void 0!==Fe.status?Fe.status:Re,this.statusText=Fe.statusText||Wt,this.url=Fe.url||null,this.ok=this.status>=200&&this.status<300}}class an extends $t{constructor(Fe={}){super(Fe),this.type=Xt.ResponseHeader}clone(Fe={}){return new an({headers:Fe.headers||this.headers,status:void 0!==Fe.status?Fe.status:this.status,statusText:Fe.statusText||this.statusText,url:Fe.url||this.url||void 0})}}class mn extends $t{constructor(Fe={}){super(Fe),this.type=Xt.Response,this.body=void 0!==Fe.body?Fe.body:null}clone(Fe={}){return new mn({body:void 0!==Fe.body?Fe.body:this.body,headers:Fe.headers||this.headers,status:void 0!==Fe.status?Fe.status:this.status,statusText:Fe.statusText||this.statusText,url:Fe.url||this.url||void 0})}}class Gt extends $t{constructor(Fe){super(Fe,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${Fe.url||"(unknown url)"}`:`Http failure response for ${Fe.url||"(unknown url)"}: ${Fe.status} ${Fe.statusText}`,this.error=Fe.error||null}}function lt(pt,Fe){return{body:Fe,headers:pt.headers,context:pt.context,observe:pt.observe,params:pt.params,reportProgress:pt.reportProgress,responseType:pt.responseType,withCredentials:pt.withCredentials}}let rt=(()=>{class pt{constructor(Re){this.handler=Re}request(Re,Wt,Pt={}){let Ln;if(Re instanceof en)Ln=Re;else{let K,de;K=Pt.headers instanceof nt?Pt.headers:new nt(Pt.headers),Pt.params&&(de=Pt.params instanceof dt?Pt.params:new dt({fromObject:Pt.params})),Ln=new en(Re,Wt,void 0!==Pt.body?Pt.body:null,{headers:K,context:Pt.context,params:de,reportProgress:Pt.reportProgress,responseType:Pt.responseType||"json",withCredentials:Pt.withCredentials})}const ue=(0,$e.of)(Ln).pipe((0,Ie.b)(K=>this.handler.handle(K)));if(Re instanceof en||"events"===Pt.observe)return ue;const H=ue.pipe((0,Kt.h)(K=>K instanceof mn));switch(Pt.observe||"body"){case"body":switch(Ln.responseType){case"arraybuffer":return H.pipe((0,Ut.U)(K=>{if(null!==K.body&&!(K.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return K.body}));case"blob":return H.pipe((0,Ut.U)(K=>{if(null!==K.body&&!(K.body instanceof Blob))throw new Error("Response is not a Blob.");return K.body}));case"text":return H.pipe((0,Ut.U)(K=>{if(null!==K.body&&"string"!=typeof K.body)throw new Error("Response is not a string.");return K.body}));default:return H.pipe((0,Ut.U)(K=>K.body))}case"response":return H;default:throw new Error(`Unreachable: unhandled observe type ${Pt.observe}}`)}}delete(Re,Wt={}){return this.request("DELETE",Re,Wt)}get(Re,Wt={}){return this.request("GET",Re,Wt)}head(Re,Wt={}){return this.request("HEAD",Re,Wt)}jsonp(Re,Wt){return this.request("JSONP",Re,{params:(new dt).append(Wt,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(Re,Wt={}){return this.request("OPTIONS",Re,Wt)}patch(Re,Wt,Pt={}){return this.request("PATCH",Re,lt(Pt,Wt))}post(Re,Wt,Pt={}){return this.request("POST",Re,lt(Pt,Wt))}put(Re,Wt,Pt={}){return this.request("PUT",Re,lt(Pt,Wt))}}return pt.\u0275fac=function(Re){return new(Re||pt)(_e.LFG(bt))},pt.\u0275prov=_e.Yz7({token:pt,factory:pt.\u0275fac}),pt})();function Dt(pt,Fe){return Fe(pt)}function It(pt,Fe){return(Re,Wt)=>Fe.intercept(Re,{handle:Pt=>pt(Pt,Wt)})}const Nt=new _e.OlP("HTTP_INTERCEPTORS"),Dn=new _e.OlP("HTTP_INTERCEPTOR_FNS");function yr(){let pt=null;return(Fe,Re)=>(null===pt&&(pt=((0,_e.f3M)(Nt,{optional:!0})??[]).reduceRight(It,Dt)),pt(Fe,Re))}let or=(()=>{class pt extends bt{constructor(Re,Wt){super(),this.backend=Re,this.injector=Wt,this.chain=null}handle(Re){if(null===this.chain){const Wt=Array.from(new Set(this.injector.get(Dn)));this.chain=Wt.reduceRight((Pt,Ln)=>function Ht(pt,Fe,Re){return(Wt,Pt)=>Re.runInContext(()=>Fe(Wt,Ln=>pt(Ln,Pt)))}(Pt,Ln,this.injector),Dt)}return this.chain(Re,Wt=>this.backend.handle(Wt))}}return pt.\u0275fac=function(Re){return new(Re||pt)(_e.LFG(gt),_e.LFG(_e.lqb))},pt.\u0275prov=_e.Yz7({token:pt,factory:pt.\u0275fac}),pt})();const Xr=/^\)\]\}',?\n/;let jr=(()=>{class pt{constructor(Re){this.xhrFactory=Re}handle(Re){if("JSONP"===Re.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new u.y(Wt=>{const Pt=this.xhrFactory.build();if(Pt.open(Re.method,Re.urlWithParams),Re.withCredentials&&(Pt.withCredentials=!0),Re.headers.forEach((q,re)=>Pt.setRequestHeader(q,re.join(","))),Re.headers.has("Accept")||Pt.setRequestHeader("Accept","application/json, text/plain, */*"),!Re.headers.has("Content-Type")){const q=Re.detectContentTypeHeader();null!==q&&Pt.setRequestHeader("Content-Type",q)}if(Re.responseType){const q=Re.responseType.toLowerCase();Pt.responseType="json"!==q?q:"text"}const Ln=Re.serializeBody();let ue=null;const H=()=>{if(null!==ue)return ue;const q=Pt.statusText||"OK",re=new nt(Pt.getAllResponseHeaders()),pe=function Pn(pt){return"responseURL"in pt&&pt.responseURL?pt.responseURL:/^X-Request-URL:/m.test(pt.getAllResponseHeaders())?pt.getResponseHeader("X-Request-URL"):null}(Pt)||Re.url;return ue=new an({headers:re,status:Pt.status,statusText:q,url:pe}),ue},K=()=>{let{headers:q,status:re,statusText:pe,url:je}=H(),ht=null;204!==re&&(ht=typeof Pt.response>"u"?Pt.responseText:Pt.response),0===re&&(re=ht?200:0);let ut=re>=200&&re<300;if("json"===Re.responseType&&"string"==typeof ht){const sn=ht;ht=ht.replace(Xr,"");try{ht=""!==ht?JSON.parse(ht):null}catch(dn){ht=sn,ut&&(ut=!1,ht={error:dn,text:ht})}}ut?(Wt.next(new mn({body:ht,headers:q,status:re,statusText:pe,url:je||void 0})),Wt.complete()):Wt.error(new Gt({error:ht,headers:q,status:re,statusText:pe,url:je||void 0}))},de=q=>{const{url:re}=H(),pe=new Gt({error:q,status:Pt.status||0,statusText:Pt.statusText||"Unknown Error",url:re||void 0});Wt.error(pe)};let Ee=!1;const ne=q=>{Ee||(Wt.next(H()),Ee=!0);let re={type:Xt.DownloadProgress,loaded:q.loaded};q.lengthComputable&&(re.total=q.total),"text"===Re.responseType&&Pt.responseText&&(re.partialText=Pt.responseText),Wt.next(re)},ie=q=>{let re={type:Xt.UploadProgress,loaded:q.loaded};q.lengthComputable&&(re.total=q.total),Wt.next(re)};return Pt.addEventListener("load",K),Pt.addEventListener("error",de),Pt.addEventListener("timeout",de),Pt.addEventListener("abort",de),Re.reportProgress&&(Pt.addEventListener("progress",ne),null!==Ln&&Pt.upload&&Pt.upload.addEventListener("progress",ie)),Pt.send(Ln),Wt.next({type:Xt.Sent}),()=>{Pt.removeEventListener("error",de),Pt.removeEventListener("abort",de),Pt.removeEventListener("load",K),Pt.removeEventListener("timeout",de),Re.reportProgress&&(Pt.removeEventListener("progress",ne),null!==Ln&&Pt.upload&&Pt.upload.removeEventListener("progress",ie)),Pt.readyState!==Pt.DONE&&Pt.abort()}})}}return pt.\u0275fac=function(Re){return new(Re||pt)(_e.LFG(W.JF))},pt.\u0275prov=_e.Yz7({token:pt,factory:pt.\u0275fac}),pt})();const Br=new _e.OlP("XSRF_ENABLED"),Pi=new _e.OlP("XSRF_COOKIE_NAME",{providedIn:"root",factory:()=>"XSRF-TOKEN"}),Vn=new _e.OlP("XSRF_HEADER_NAME",{providedIn:"root",factory:()=>"X-XSRF-TOKEN"});class yn{}let Ri=(()=>{class pt{constructor(Re,Wt,Pt){this.doc=Re,this.platform=Wt,this.cookieName=Pt,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const Re=this.doc.cookie||"";return Re!==this.lastCookieString&&(this.parseCount++,this.lastToken=(0,W.Mx)(Re,this.cookieName),this.lastCookieString=Re),this.lastToken}}return pt.\u0275fac=function(Re){return new(Re||pt)(_e.LFG(W.K0),_e.LFG(_e.Lbi),_e.LFG(Pi))},pt.\u0275prov=_e.Yz7({token:pt,factory:pt.\u0275fac}),pt})();function Mr(pt,Fe){const Re=pt.url.toLowerCase();if(!(0,_e.f3M)(Br)||"GET"===pt.method||"HEAD"===pt.method||Re.startsWith("http://")||Re.startsWith("https://"))return Fe(pt);const Wt=(0,_e.f3M)(yn).getToken(),Pt=(0,_e.f3M)(Vn);return null!=Wt&&!pt.headers.has(Pt)&&(pt=pt.clone({headers:pt.headers.set(Pt,Wt)})),Fe(pt)}var St=(()=>((St=St||{})[St.Interceptors=0]="Interceptors",St[St.LegacyInterceptors=1]="LegacyInterceptors",St[St.CustomXsrfConfiguration=2]="CustomXsrfConfiguration",St[St.NoXsrfProtection=3]="NoXsrfProtection",St[St.JsonpSupport=4]="JsonpSupport",St[St.RequestsMadeViaParent=5]="RequestsMadeViaParent",St))();function vi(pt,Fe){return{\u0275kind:pt,\u0275providers:Fe}}function dr(...pt){const Fe=[rt,jr,or,{provide:bt,useExisting:or},{provide:gt,useExisting:jr},{provide:Dn,useValue:Mr,multi:!0},{provide:Br,useValue:!0},{provide:yn,useClass:Ri}];for(const Re of pt)Fe.push(...Re.\u0275providers);return(0,_e.MR2)(Fe)}const io=new _e.OlP("LEGACY_INTERCEPTOR_FN");let kn=(()=>{class pt{}return pt.\u0275fac=function(Re){return new(Re||pt)},pt.\u0275mod=_e.oAB({type:pt}),pt.\u0275inj=_e.cJS({providers:[dr(vi(St.LegacyInterceptors,[{provide:io,useFactory:yr},{provide:Dn,useExisting:io,multi:!0}]))]}),pt})()},1571:(Yn,At,we)=>{"use strict";we.d(At,{QbO:()=>Nw,tb:()=>T0,AFp:()=>f0,ip1:()=>d0,CZH:()=>kg,hGG:()=>Tb,z2F:()=>Og,sBO:()=>lb,Sil:()=>Gw,_Vd:()=>Fs,EJc:()=>Vw,Xts:()=>yd,SBq:()=>Lh,lqb:()=>gu,qLn:()=>Fh,vpe:()=>tu,XFs:()=>yn,OlP:()=>fi,zs3:()=>Wl,ZZ4:()=>Oy,aQg:()=>Fy,soG:()=>Lg,YKP:()=>mv,h0i:()=>sf,PXZ:()=>rb,R0b:()=>Ql,FiY:()=>ee,Lbi:()=>Bw,g9A:()=>m0,Qsj:()=>Wu,FYo:()=>zm,JOm:()=>qs,tp0:()=>ye,Rgc:()=>Jp,dDg:()=>Qw,eoX:()=>b0,GfV:()=>Zc,s_b:()=>Ag,ifc:()=>q,MMx:()=>cy,Lck:()=>Bx,eFA:()=>C0,Gpc:()=>hn,f3M:()=>Pt,$WT:()=>ai,MR2:()=>Cm,_c5:()=>Eb,c2e:()=>Uw,zSh:()=>Ph,wAp:()=>hr,vHH:()=>Je,lri:()=>x0,rWj:()=>w0,D6c:()=>Db,cg1:()=>Mc,kL8:()=>rf,dqk:()=>dr,Z0I:()=>yi,eJc:()=>vy,CqO:()=>Xa,QGY:()=>Cp,F4k:()=>Sp,RDi:()=>Hg,AaK:()=>Et,qOj:()=>hp,TTD:()=>ss,_Bn:()=>pv,jDz:()=>_v,xp6:()=>Um,uIk:()=>_p,Tol:()=>B,ekj:()=>D,Suo:()=>Vv,Xpm:()=>rr,lG2:()=>ct,Yz7:()=>bn,cJS:()=>wr,oAB:()=>Or,Yjl:()=>$r,Y36:()=>vc,_UZ:()=>Qh,GkF:()=>Tp,qZA:()=>Kd,TgZ:()=>Xd,EpF:()=>Dp,n5z:()=>ic,LFG:()=>Re,$8M:()=>$o,$Z:()=>Zm,NdJ:()=>dl,CRH:()=>$v,oxw:()=>Ip,Hsn:()=>vg,F$t:()=>Yd,Q6J:()=>ah,s9C:()=>Jd,DdM:()=>Tv,VKq:()=>Dv,WLB:()=>Cv,l5B:()=>Sv,qbA:()=>Mv,HTZ:()=>Iv,iGM:()=>Uv,MAs:()=>wp,KtG:()=>Na,CHM:()=>da,P3R:()=>ys,Akn:()=>R,YNc:()=>_g,W1O:()=>qv,_uU:()=>st,Oqu:()=>tn,hij:()=>Bn,Gf:()=>jv});var W=we(7579),_e=we(727),$e=we(9751),u=we(6451),Ie=we(8421),Kt=we(930),Ut=we(4482);function gt(i,o,...l){if(!0===o)return void i();if(!1===o)return;const m=new Kt.Hp({next:()=>{m.unsubscribe(),i()}});return(0,Ie.Xf)(o(...l)).subscribe(m)}function nt(i){for(let o in i)if(i[o]===nt)return o;throw Error("Could not find renamed property on target object.")}function ft(i,o){for(const l in o)o.hasOwnProperty(l)&&!i.hasOwnProperty(l)&&(i[l]=o[l])}function Et(i){if("string"==typeof i)return i;if(Array.isArray(i))return"["+i.map(Et).join(", ")+"]";if(null==i)return""+i;if(i.overriddenName)return`${i.overriddenName}`;if(i.name)return`${i.name}`;const o=i.toString();if(null==o)return""+o;const l=o.indexOf("\n");return-1===l?o:o.substring(0,l)}function jn(i,o){return null==i||""===i?null===o?"":o:null==o||""===o?i:i+" "+o}const Jt=nt({__forward_ref__:nt});function hn(i){return i.__forward_ref__=hn,i.toString=function(){return Et(this())},i}function Qt(i){return tr(i)?i():i}function tr(i){return"function"==typeof i&&i.hasOwnProperty(Jt)&&i.__forward_ref__===hn}function dt(i){return i&&!!i.\u0275providers}const Zr="https://g.co/ng/security#xss";class Je extends Error{constructor(o,l){super(Ne(o,l)),this.code=o}}function Ne(i,o){return`NG0${Math.abs(i)}${o?": "+o.trim():""}`}function mt(i){return"string"==typeof i?i:null==i?"":String(i)}function $t(i,o){throw new Je(-201,!1)}function In(i,o){null==i&&function cn(i,o,l,m){throw new Error(`ASSERTION ERROR: ${i}`+(null==m?"":` [Expected=> ${l} ${m} ${o} <=Actual]`))}(o,i,null,"!=")}function bn(i){return{token:i.token,providedIn:i.providedIn||null,factory:i.factory,value:void 0}}function wr(i){return{providers:i.providers||[],imports:i.imports||[]}}function Yi(i){return Xr(i,ri)||Xr(i,So)}function yi(i){return null!==Yi(i)}function Xr(i,o){return i.hasOwnProperty(o)?i[o]:null}function Br(i){return i&&(i.hasOwnProperty(Pi)||i.hasOwnProperty(Vn))?i[Pi]:null}const ri=nt({\u0275prov:nt}),Pi=nt({\u0275inj:nt}),So=nt({ngInjectableDef:nt}),Vn=nt({ngInjectorDef:nt});var yn=(()=>((yn=yn||{})[yn.Default=0]="Default",yn[yn.Host=1]="Host",yn[yn.Self=2]="Self",yn[yn.SkipSelf=4]="SkipSelf",yn[yn.Optional=8]="Optional",yn))();let Ri;function on(i){const o=Ri;return Ri=i,o}function St(i,o,l){const m=Yi(i);return m&&"root"==m.providedIn?void 0===m.value?m.value=m.factory():m.value:l&yn.Optional?null:void 0!==o?o:void $t(Et(i))}const dr=(()=>typeof globalThis<"u"&&globalThis||typeof global<"u"&&global||typeof window<"u"&&window||typeof self<"u"&&typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&self)(),oo={},Dr="__NG_DI_FLAG__",po="ngTempTokenPath",gr="ngTokenPath",so=/\n/gm,kn="\u0275",xi="__source";let $n;function pt(i){const o=$n;return $n=i,o}function Fe(i,o=yn.Default){if(void 0===$n)throw new Je(-203,!1);return null===$n?St(i,void 0,o):$n.get(i,o&yn.Optional?null:void 0,o)}function Re(i,o=yn.Default){return(function Mr(){return Ri}()||Fe)(Qt(i),o)}function Pt(i,o=yn.Default){return Re(i,Ln(o))}function Ln(i){return typeof i>"u"||"number"==typeof i?i:0|(i.optional&&8)|(i.host&&1)|(i.self&&2)|(i.skipSelf&&4)}function ue(i){const o=[];for(let l=0;l<i.length;l++){const m=Qt(i[l]);if(Array.isArray(m)){if(0===m.length)throw new Je(900,!1);let v,b=yn.Default;for(let S=0;S<m.length;S++){const L=m[S],z=K(L);"number"==typeof z?-1===z?v=L.token:b|=z:v=L}o.push(Re(v,b))}else o.push(Re(m))}return o}function H(i,o){return i[Dr]=o,i.prototype[Dr]=o,i}function K(i){return i[Dr]}function ne(i){return{toString:i}.toString()}var ie=(()=>((ie=ie||{})[ie.OnPush=0]="OnPush",ie[ie.Default=1]="Default",ie))(),q=(()=>{return(i=q||(q={}))[i.Emulated=0]="Emulated",i[i.None=2]="None",i[i.ShadowDom=3]="ShadowDom",q;var i})();const re={},pe=[],je=nt({\u0275cmp:nt}),ht=nt({\u0275dir:nt}),ut=nt({\u0275pipe:nt}),sn=nt({\u0275mod:nt}),dn=nt({\u0275fac:nt}),Rt=nt({__NG_ELEMENT_ID__:nt});let xn=0;function rr(i){return ne(()=>{const o=Ks(i),l={...o,decls:i.decls,vars:i.vars,template:i.template,consts:i.consts||null,ngContentSelectors:i.ngContentSelectors,onPush:i.changeDetection===ie.OnPush,directiveDefs:null,pipeDefs:null,dependencies:o.standalone&&i.dependencies||null,getStandaloneInjector:null,data:i.data||{},encapsulation:i.encapsulation||q.Emulated,id:"c"+xn++,styles:i.styles||pe,_:null,schemas:i.schemas||null,tView:null};is(l);const m=i.dependencies;return l.directiveDefs=Zt(m,!1),l.pipeDefs=Zt(m,!0),l})}function Sn(i){return qn(i)||wi(i)}function Pr(i){return null!==i}function Or(i){return ne(()=>({type:i.type,bootstrap:i.bootstrap||pe,declarations:i.declarations||pe,imports:i.imports||pe,exports:i.exports||pe,transitiveCompileScopes:null,schemas:i.schemas||null,id:i.id||null}))}function Hi(i,o){if(null==i)return re;const l={};for(const m in i)if(i.hasOwnProperty(m)){let v=i[m],b=v;Array.isArray(v)&&(b=v[1],v=v[0]),l[v]=m,o&&(o[v]=b)}return l}function ct(i){return ne(()=>{const o=Ks(i);return is(o),o})}function $r(i){return{type:i.type,name:i.name,factory:null,pure:!1!==i.pure,standalone:!0===i.standalone,onDestroy:i.type.prototype.ngOnDestroy||null}}function qn(i){return i[je]||null}function wi(i){return i[ht]||null}function Bi(i){return i[ut]||null}function ai(i){const o=qn(i)||wi(i)||Bi(i);return null!==o&&o.standalone}function Gr(i,o){const l=i[sn]||null;if(!l&&!0===o)throw new Error(`Type ${Et(i)} does not have '\u0275mod' property.`);return l}function Ks(i){const o={};return{type:i.type,providersResolver:null,factory:null,hostBindings:i.hostBindings||null,hostVars:i.hostVars||0,hostAttrs:i.hostAttrs||null,contentQueries:i.contentQueries||null,declaredInputs:o,exportAs:i.exportAs||null,standalone:!0===i.standalone,selectors:i.selectors||pe,viewQuery:i.viewQuery||null,features:i.features||null,setInput:null,findHostDirectiveDefs:null,hostDirectives:null,inputs:Hi(i.inputs,o),outputs:Hi(i.outputs)}}function is(i){i.features?.forEach(o=>o(i))}function Zt(i,o){if(!i)return null;const l=o?Bi:Sn;return()=>("function"==typeof i?i():i).map(m=>l(m)).filter(Pr)}const On=0,Ot=1,Gn=2,Ur=3,Nn=4,mo=5,Jr=6,Mo=7,ir=8,Cr=9,os=10,An=11,Es=12,bi=13,Bs=14,Qi=15,li=16,ao=17,hi=18,lo=19,Li=20,Qr=21,Hr=22,Wi=1,co=2,Ns=7,Ys=8,ii=9,Ni=10;function Ui(i){return Array.isArray(i)&&"object"==typeof i[Wi]}function Wr(i){return Array.isArray(i)&&!0===i[Wi]}function ra(i){return 0!=(4&i.flags)}function Wo(i){return i.componentOffset>-1}function Io(i){return 1==(1&i.flags)}function eo(i){return!!i.template}function Js(i){return 0!=(256&i[Gn])}function go(i,o){return i.hasOwnProperty(dn)?i[dn]:null}class Ds{constructor(o,l,m){this.previousValue=o,this.currentValue=l,this.firstChange=m}isFirstChange(){return this.firstChange}}function ss(){return mr}function mr(i){return i.type.prototype.ngOnChanges&&(i.setInput=qo),ba}function ba(){const i=as(this),o=i?.current;if(o){const l=i.previous;if(l===re)i.previous=o;else for(let m in o)l[m]=o[m];i.current=null,this.ngOnChanges(o)}}function qo(i,o,l,m){const v=this.declaredInputs[l],b=as(i)||function qi(i,o){return i[Zo]=o}(i,{previous:re,current:null}),S=b.current||(b.current={}),L=b.previous,z=L[v];S[v]=new Ds(z&&z.currentValue,o,L===re),i[m]=o}ss.ngInherit=!0;const Zo="__ngSimpleChanges__";function as(i){return i[Zo]||null}const no=function(i,o,l){};function di(i){for(;Array.isArray(i);)i=i[On];return i}function ls(i,o){return di(o[i])}function Jn(i,o){return di(o[i.index])}function Ba(i,o){return i.data[o]}function ei(i,o){const l=o[i];return Ui(l)?l:l[On]}function Ko(i){return 64==(64&i[Gn])}function Gs(i,o){return null==o?null:i[o]}function Ms(i){i[hi]=0}function Po(i,o){i[mo]+=o;let l=i,m=i[Ur];for(;null!==m&&(1===o&&1===l[mo]||-1===o&&0===l[mo]);)m[mo]+=o,l=m,m=m[Ur]}const nr={lFrame:ur(null),bindingsEnabled:!0};function hs(){return nr.bindingsEnabled}function zt(){return nr.lFrame.lView}function sr(){return nr.lFrame.tView}function da(i){return nr.lFrame.contextLView=i,i[ir]}function Na(i){return nr.lFrame.contextLView=null,i}function Oi(){let i=tl();for(;null!==i&&64===i.type;)i=i.parent;return i}function tl(){return nr.lFrame.currentTNode}function Ro(i,o){const l=nr.lFrame;l.currentTNode=i,l.isParent=o}function Yo(){return nr.lFrame.isParent}function ko(){nr.lFrame.isParent=!1}function Zi(){const i=nr.lFrame;let o=i.bindingRootIndex;return-1===o&&(o=i.bindingRootIndex=i.tView.bindingStartIndex),o}function Uo(){return nr.lFrame.bindingIndex++}function Q(i){const o=nr.lFrame,l=o.bindingIndex;return o.bindingIndex=o.bindingIndex+i,l}function j(i,o){const l=nr.lFrame;l.bindingIndex=l.bindingRootIndex=i,ge(o)}function ge(i){nr.lFrame.currentDirectiveIndex=i}function ze(){return nr.lFrame.currentQueryIndex}function et(i){nr.lFrame.currentQueryIndex=i}function xt(i){const o=i[Ot];return 2===o.type?o.declTNode:1===o.type?i[Jr]:null}function gn(i,o,l){if(l&yn.SkipSelf){let v=o,b=i;for(;!(v=v.parent,null!==v||l&yn.Host||(v=xt(b),null===v||(b=b[Qi],10&v.type))););if(null===v)return!1;o=v,i=b}const m=nr.lFrame=cr();return m.currentTNode=o,m.lView=i,!0}function _n(i){const o=cr(),l=i[Ot];nr.lFrame=o,o.currentTNode=l.firstChild,o.lView=i,o.tView=l,o.contextLView=i,o.bindingIndex=l.bindingStartIndex,o.inI18n=!1}function cr(){const i=nr.lFrame,o=null===i?null:i.child;return null===o?ur(i):o}function ur(i){const o={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:i,child:null,inI18n:!1};return null!==i&&(i.child=o),o}function Un(){const i=nr.lFrame;return nr.lFrame=i.parent,i.currentTNode=null,i.lView=null,i}const Zn=Un;function fr(){const i=Un();i.isParent=!0,i.tView=null,i.selectedIndex=-1,i.contextLView=null,i.elementDepthCount=0,i.currentDirectiveIndex=-1,i.currentNamespace=null,i.bindingRootIndex=-1,i.bindingIndex=-1,i.currentQueryIndex=0}function Rr(){return nr.lFrame.selectedIndex}function Kr(i){nr.lFrame.selectedIndex=i}function br(){const i=nr.lFrame;return Ba(i.tView,i.selectedIndex)}function N(i,o){for(let l=o.directiveStart,m=o.directiveEnd;l<m;l++){const b=i.data[l].type.prototype,{ngAfterContentInit:S,ngAfterContentChecked:L,ngAfterViewInit:z,ngAfterViewChecked:Z,ngOnDestroy:ae}=b;S&&(i.contentHooks||(i.contentHooks=[])).push(-l,S),L&&((i.contentHooks||(i.contentHooks=[])).push(l,L),(i.contentCheckHooks||(i.contentCheckHooks=[])).push(l,L)),z&&(i.viewHooks||(i.viewHooks=[])).push(-l,z),Z&&((i.viewHooks||(i.viewHooks=[])).push(l,Z),(i.viewCheckHooks||(i.viewCheckHooks=[])).push(l,Z)),null!=ae&&(i.destroyHooks||(i.destroyHooks=[])).push(l,ae)}}function se(i,o,l){A(i,o,3,l)}function Ce(i,o,l,m){(3&i[Gn])===l&&A(i,o,l,m)}function I(i,o){let l=i[Gn];(3&l)===o&&(l&=2047,l+=1,i[Gn]=l)}function A(i,o,l,m){const b=m??-1,S=o.length-1;let L=0;for(let z=void 0!==m?65535&i[hi]:0;z<S;z++)if("number"==typeof o[z+1]){if(L=o[z],null!=m&&L>=m)break}else o[z]<0&&(i[hi]+=65536),(L<b||-1==b)&&($(i,l,o,z),i[hi]=(4294901760&i[hi])+z+2),z++}function $(i,o,l,m){const v=l[m]<0,b=l[m+1],L=i[v?-l[m]:l[m]];if(v){if(i[Gn]>>11<i[hi]>>16&&(3&i[Gn])===o){i[Gn]+=2048,no(4,L,b);try{b.call(L)}finally{no(5,L,b)}}}else{no(4,L,b);try{b.call(L)}finally{no(5,L,b)}}}const fe=-1;class We{constructor(o,l,m){this.factory=o,this.resolving=!1,this.canSeeViewProviders=l,this.injectImpl=m}}function $i(i,o,l){let m=0;for(;m<l.length;){const v=l[m];if("number"==typeof v){if(0!==v)break;m++;const b=l[m++],S=l[m++],L=l[m++];i.setAttribute(o,S,L,b)}else{const b=v,S=l[++m];Hs(b)?i.setProperty(o,b,S):i.setAttribute(o,b,S),m++}}return m}function ji(i){return 3===i||4===i||6===i}function Hs(i){return 64===i.charCodeAt(0)}function Vo(i,o){if(null!==o&&0!==o.length)if(null===i||0===i.length)i=o.slice();else{let l=-1;for(let m=0;m<o.length;m++){const v=o[m];"number"==typeof v?l=v:0===l||ec(i,l,v,null,-1===l||2===l?o[++m]:null)}}return i}function ec(i,o,l,m,v){let b=0,S=i.length;if(-1===o)S=-1;else for(;b<i.length;){const L=i[b++];if("number"==typeof L){if(L===o){S=-1;break}if(L>o){S=b-1;break}}}for(;b<i.length;){const L=i[b];if("number"==typeof L)break;if(L===l){if(null===m)return void(null!==v&&(i[b+1]=v));if(m===i[b+1])return void(i[b+2]=v)}b++,null!==m&&b++,null!==v&&b++}-1!==S&&(i.splice(S,0,o),b=S+1),i.splice(b++,0,l),null!==m&&i.splice(b++,0,m),null!==v&&i.splice(b++,0,v)}function Ca(i){return i!==fe}function Sa(i){return 32767&i}function ro(i,o){let l=function tc(i){return i>>16}(i),m=o;for(;l>0;)m=m[Qi],l--;return m}let Ua=!0;function ml(i){const o=Ua;return Ua=i,o}const Ll=255,Pc=5;let Rc=0;const fa={};function Fl(i,o){const l=nc(i,o);if(-1!==l)return l;const m=o[Ot];m.firstCreatePass&&(i.injectorIndex=o.length,gl(m.data,i),gl(o,null),gl(m.blueprint,null));const v=kc(i,o),b=i.injectorIndex;if(Ca(v)){const S=Sa(v),L=ro(v,o),z=L[Ot].data;for(let Z=0;Z<8;Z++)o[b+Z]=L[S+Z]|z[S+Z]}return o[b+8]=v,b}function gl(i,o){i.push(0,0,0,0,0,0,0,0,o)}function nc(i,o){return-1===i.injectorIndex||i.parent&&i.parent.injectorIndex===i.injectorIndex||null===o[i.injectorIndex+8]?-1:i.injectorIndex}function kc(i,o){if(i.parent&&-1!==i.parent.injectorIndex)return i.parent.injectorIndex;let l=0,m=null,v=o;for(;null!==v;){if(m=vl(v),null===m)return fe;if(l++,v=v[Qi],-1!==m.injectorIndex)return m.injectorIndex|l<<16}return fe}function _l(i,o,l){!function Ol(i,o,l){let m;"string"==typeof l?m=l.charCodeAt(0)||0:l.hasOwnProperty(Rt)&&(m=l[Rt]),null==m&&(m=l[Rt]=Rc++);const v=m&Ll;o.data[i+(v>>Pc)]|=1<<v}(i,o,l)}function yl(i,o,l){if(l&yn.Optional||void 0!==i)return i;$t()}function rc(i,o,l,m){if(l&yn.Optional&&void 0===m&&(m=null),!(l&(yn.Self|yn.Host))){const v=i[Cr],b=on(void 0);try{return v?v.get(o,m,l&yn.Optional):St(o,m,l&yn.Optional)}finally{on(b)}}return yl(m,0,l)}function zl(i,o,l,m=yn.Default,v){if(null!==i){if(1024&o[Gn]){const S=function Ps(i,o,l,m,v){let b=i,S=o;for(;null!==b&&null!==S&&1024&S[Gn]&&!(256&S[Gn]);){const L=Jo(b,S,l,m|yn.Self,fa);if(L!==fa)return L;let z=b.parent;if(!z){const Z=S[Qr];if(Z){const ae=Z.get(l,fa,m);if(ae!==fa)return ae}z=vl(S),S=S[Qi]}b=z}return v}(i,o,l,m,fa);if(S!==fa)return S}const b=Jo(i,o,l,m,fa);if(b!==fa)return b}return rc(o,l,m,v)}function Jo(i,o,l,m,v){const b=function Lc(i){if("string"==typeof i)return i.charCodeAt(0)||0;const o=i.hasOwnProperty(Rt)?i[Rt]:void 0;return"number"==typeof o?o>=0?o&Ll:dh:o}(l);if("function"==typeof b){if(!gn(o,i,m))return m&yn.Host?yl(v,0,m):rc(o,l,m,v);try{const S=b(m);if(null!=S||m&yn.Optional)return S;$t()}finally{Zn()}}else if("number"==typeof b){let S=null,L=nc(i,o),z=fe,Z=m&yn.Host?o[li][Jr]:null;for((-1===L||m&yn.SkipSelf)&&(z=-1===L?kc(i,o):o[L+8],z!==fe&&hh(m,!1)?(S=o[Ot],L=Sa(z),o=ro(z,o)):L=-1);-1!==L;){const ae=o[Ot];if(Lo(b,L,ae.data)){const Te=Ru(L,o,l,S,m,Z);if(Te!==fa)return Te}z=o[L+8],z!==fe&&hh(m,o[Ot].data[L+8]===Z)&&Lo(b,L,o)?(S=ae,L=Sa(z),o=ro(z,o)):L=-1}}return v}function Ru(i,o,l,m,v,b){const S=o[Ot],L=S.data[i+8],ae=ja(L,S,l,null==m?Wo(L)&&Ua:m!=S&&0!=(3&L.type),v&yn.Host&&b===L);return null!==ae?rl(o,S,ae,L):fa}function ja(i,o,l,m,v){const b=i.providerIndexes,S=o.data,L=1048575&b,z=i.directiveStart,ae=b>>20,Ve=v?L+ae:i.directiveEnd;for(let tt=m?L:L+ae;tt<Ve;tt++){const Mt=S[tt];if(tt<z&&l===Mt||tt>=z&&Mt.type===l)return tt}if(v){const tt=S[z];if(tt&&eo(tt)&&tt.type===l)return z}return null}function rl(i,o,l,m){let v=i[l];const b=o.data;if(function Ft(i){return i instanceof We}(v)){const S=v;S.resolving&&function Ue(i,o){const l=o?`. Dependency path: ${o.join(" > ")} > ${i}`:"";throw new Je(-200,`Circular dependency in DI detected for ${i}${l}`)}(function ln(i){return"function"==typeof i?i.name||i.toString():"object"==typeof i&&null!=i&&"function"==typeof i.type?i.type.name||i.type.toString():mt(i)}(b[l]));const L=ml(S.canSeeViewProviders);S.resolving=!0;const z=S.injectImpl?on(S.injectImpl):null;gn(i,m,yn.Default);try{v=i[l]=S.factory(void 0,b,i,m),o.firstCreatePass&&l>=m.directiveStart&&function X(i,o,l){const{ngOnChanges:m,ngOnInit:v,ngDoCheck:b}=o.type.prototype;if(m){const S=mr(o);(l.preOrderHooks||(l.preOrderHooks=[])).push(i,S),(l.preOrderCheckHooks||(l.preOrderCheckHooks=[])).push(i,S)}v&&(l.preOrderHooks||(l.preOrderHooks=[])).push(0-i,v),b&&((l.preOrderHooks||(l.preOrderHooks=[])).push(i,b),(l.preOrderCheckHooks||(l.preOrderCheckHooks=[])).push(i,b))}(l,b[l],o)}finally{null!==z&&on(z),ml(L),S.resolving=!1,Zn()}}return v}function Lo(i,o,l){return!!(l[o+(i>>Pc)]&1<<i)}function hh(i,o){return!(i&yn.Self||i&yn.Host&&o)}class Bl{constructor(o,l){this._tNode=o,this._lView=l}get(o,l,m){return zl(this._tNode,this._lView,o,Ln(m),l)}}function dh(){return new Bl(Oi(),zt())}function ic(i){return ne(()=>{const o=i.prototype.constructor,l=o[dn]||ta(o),m=Object.prototype;let v=Object.getPrototypeOf(i.prototype).constructor;for(;v&&v!==m;){const b=v[dn]||ta(v);if(b&&b!==l)return b;v=Object.getPrototypeOf(v)}return b=>new b})}function ta(i){return tr(i)?()=>{const o=ta(Qt(i));return o&&o()}:go(i)}function vl(i){const o=i[Ot],l=o.type;return 2===l?o.declTNode:1===l?i[Jr]:null}function $o(i){return function nu(i,o){if("class"===o)return i.classes;if("style"===o)return i.styles;const l=i.attrs;if(l){const m=l.length;let v=0;for(;v<m;){const b=l[v];if(ji(b))break;if(0===b)v+=2;else if("number"==typeof b)for(v++;v<m&&"string"==typeof l[v];)v++;else{if(b===o)return l[v+1];v+=2}}}return null}(Oi(),i)}const fn="__parameters__";function Va(i,o,l){return ne(()=>{const m=function xl(i){return function(...l){if(i){const m=i(...l);for(const v in m)this[v]=m[v]}}}(o);function v(...b){if(this instanceof v)return m.apply(this,b),this;const S=new v(...b);return L.annotation=S,L;function L(z,Z,ae){const Te=z.hasOwnProperty(fn)?z[fn]:Object.defineProperty(z,fn,{value:[]})[fn];for(;Te.length<=ae;)Te.push(null);return(Te[ae]=Te[ae]||[]).push(S),z}}return l&&(v.prototype=Object.create(l.prototype)),v.prototype.ngMetadataName=i,v.annotationCls=v,v})}class fi{constructor(o,l){this._desc=o,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof l?this.__NG_ELEMENT_ID__=l:void 0!==l&&(this.\u0275prov=bn({token:this,providedIn:l.providedIn||"root",factory:l.factory}))}get multi(){return this}toString(){return`InjectionToken ${this._desc}`}}function sl(i,o){i.forEach(l=>Array.isArray(l)?sl(l,o):o(l))}function au(i,o,l){o>=i.length?i.push(l):i.splice(o,0,l)}function lc(i,o){return o>=i.length-1?i.pop():i.splice(o,1)[0]}function al(i,o){const l=[];for(let m=0;m<i;m++)l.push(o);return l}function a(i,o,l){let m=d(i,o);return m>=0?i[1|m]=l:(m=~m,function r(i,o,l,m){let v=i.length;if(v==o)i.push(l,m);else if(1===v)i.push(m,i[0]),i[0]=l;else{for(v--,i.push(i[v-1],i[v]);v>o;)i[v]=i[v-2],v--;i[o]=l,i[o+1]=m}}(i,m,o,l)),m}function f(i,o){const l=d(i,o);if(l>=0)return i[1|l]}function d(i,o){return function x(i,o,l){let m=0,v=i.length>>l;for(;v!==m;){const b=m+(v-m>>1),S=i[b<<l];if(o===S)return b<<l;S>o?v=b:m=b+1}return~(v<<l)}(i,o,1)}const ee=H(Va("Optional"),8),ye=H(Va("SkipSelf"),4);var qs=(()=>((qs=qs||{})[qs.Important=1]="Important",qs[qs.DashCase=2]="DashCase",qs))();const cl=new Map;let zc=0;const ld="__ngContext__";function Zs(i,o){Ui(o)?(i[ld]=o[Li],function cf(i){cl.set(i[Li],i)}(o)):i[ld]=o}let fh;function zu(i,o){return fh(i,o)}function Bc(i){const o=i[Ur];return Wr(o)?o[Ur]:o}function ff(i){return hm(i[bi])}function pf(i){return hm(i[Nn])}function hm(i){for(;null!==i&&!Wr(i);)i=i[Nn];return i}function Nc(i,o,l,m,v){if(null!=m){let b,S=!1;Wr(m)?b=m:Ui(m)&&(S=!0,m=m[On]);const L=di(m);0===i&&null!==l?null==v?mh(o,l,L):Ia(o,l,L,v||null,!0):1===i&&null!==l?Ia(o,l,L,v||null,!0):2===i?function dd(i,o,l){const m=Aa(i,o);m&&function fm(i,o,l,m){i.removeChild(o,l,m)}(i,m,o,l)}(o,L,S):3===i&&o.destroyNode(L),null!=b&&function mm(i,o,l,m,v){const b=l[Ns];b!==di(l)&&Nc(o,i,m,b,v);for(let L=Ni;L<l.length;L++){const z=l[L];Vl(z[Ot],z,i,o,m,b)}}(o,i,b,l,v)}}function $a(i,o,l){return i.createElement(o,l)}function dm(i,o){const l=i[ii],m=l.indexOf(o),v=o[Ur];512&o[Gn]&&(o[Gn]&=-513,Po(v,-1)),l.splice(m,1)}function hd(i,o){if(i.length<=Ni)return;const l=Ni+o,m=i[l];if(m){const v=m[ao];null!==v&&v!==i&&dm(v,m),o>0&&(i[l-1][Nn]=m[Nn]);const b=lc(i,Ni+o);!function Uc(i,o){Vl(i,o,o[An],2,null,null),o[On]=null,o[Jr]=null}(m[Ot],m);const S=b[lo];null!==S&&S.detachView(b[Ot]),m[Ur]=null,m[Nn]=null,m[Gn]&=-65}return m}function ph(i,o){if(!(128&o[Gn])){const l=o[An];l.destroyNode&&Vl(i,o,l,3,null,null),function Ng(i){let o=i[bi];if(!o)return Ga(i[Ot],i);for(;o;){let l=null;if(Ui(o))l=o[bi];else{const m=o[Ni];m&&(l=m)}if(!l){for(;o&&!o[Nn]&&o!==i;)Ui(o)&&Ga(o[Ot],o),o=o[Ur];null===o&&(o=i),Ui(o)&&Ga(o[Ot],o),l=o&&o[Nn]}o=l}}(o)}}function Ga(i,o){if(!(128&o[Gn])){o[Gn]&=-65,o[Gn]|=128,function $g(i,o){let l;if(null!=i&&null!=(l=i.destroyHooks))for(let m=0;m<l.length;m+=2){const v=o[l[m]];if(!(v instanceof We)){const b=l[m+1];if(Array.isArray(b))for(let S=0;S<b.length;S+=2){const L=v[b[S]],z=b[S+1];no(4,L,z);try{z.call(L)}finally{no(5,L,z)}}else{no(4,v,b);try{b.call(v)}finally{no(5,v,b)}}}}}(i,o),function Vg(i,o){const l=i.cleanup,m=o[Mo];let v=-1;if(null!==l)for(let b=0;b<l.length-1;b+=2)if("string"==typeof l[b]){const S=l[b+3];S>=0?m[v=S]():m[v=-S].unsubscribe(),b+=2}else{const S=m[v=l[b+1]];l[b].call(S)}if(null!==m){for(let b=v+1;b<m.length;b++)(0,m[b])();o[Mo]=null}}(i,o),1===o[Ot].type&&o[An].destroy();const l=o[ao];if(null!==l&&Wr(o[Ur])){l!==o[Ur]&&dm(l,o);const m=o[lo];null!==m&&m.detachView(i)}!function tm(i){cl.delete(i[Li])}(o)}}function yo(i,o,l){return function er(i,o,l){let m=o;for(;null!==m&&40&m.type;)m=(o=m).parent;if(null===m)return l[On];{const{componentOffset:v}=m;if(v>-1){const{encapsulation:b}=i.data[m.directiveStart+v];if(b===q.None||b===q.Emulated)return null}return Jn(m,l)}}(i,o.parent,l)}function Ia(i,o,l,m,v){i.insertBefore(o,l,m,v)}function mh(i,o,l){i.appendChild(o,l)}function ga(i,o,l,m,v){null!==m?Ia(i,o,l,m,v):mh(i,o,l)}function Aa(i,o){return i.parentNode(o)}function Vc(i,o,l){return $c(i,o,l)}let gh,gf,Eh,$c=function Bu(i,o,l){return 40&i.type?Jn(i,l):null};function yh(i,o,l,m){const v=yo(i,m,o),b=o[An],L=Vc(m.parent||o[Jr],m,o);if(null!=v)if(Array.isArray(l))for(let z=0;z<l.length;z++)ga(b,v,l[z],L,!1);else ga(b,v,l,L,!1);void 0!==gh&&gh(b,m,o,l,v)}function vh(i,o){if(null!==o){const l=o.type;if(3&l)return Jn(o,i);if(4&l)return xh(-1,i[o.index]);if(8&l){const m=o.child;if(null!==m)return vh(i,m);{const v=i[o.index];return Wr(v)?xh(-1,v):di(v)}}if(32&l)return zu(o,i)()||di(i[o.index]);{const m=pm(i,o);return null!==m?Array.isArray(m)?m[0]:vh(Bc(i[li]),m):vh(i,o.next)}}return null}function pm(i,o){return null!==o?i[li][Jr].projection[o.projection]:null}function xh(i,o){const l=Ni+i+1;if(l<o.length){const m=o[l],v=m[Ot].firstChild;if(null!==v)return vh(m,v)}return o[Ns]}function du(i,o,l,m,v,b,S){for(;null!=l;){const L=m[l.index],z=l.type;if(S&&0===o&&(L&&Zs(di(L),m),l.flags|=2),32!=(32&l.flags))if(8&z)du(i,o,l.child,m,v,b,!1),Nc(o,i,v,L,b);else if(32&z){const Z=zu(l,m);let ae;for(;ae=Z();)Nc(o,i,v,ae,b);Nc(o,i,v,L,b)}else 16&z?fd(i,o,m,l,v,b):Nc(o,i,v,L,b);l=S?l.projectionNext:l.next}}function Vl(i,o,l,m,v,b){du(l,m,i.firstChild,o,v,b,!1)}function fd(i,o,l,m,v,b){const S=l[li],z=S[Jr].projection[m.projection];if(Array.isArray(z))for(let Z=0;Z<z.length;Z++)Nc(o,i,v,z[Z],b);else du(i,o,z,S[Ur],v,b,!0)}function Pa(i,o,l){""===l?i.removeAttribute(o,"class"):i.setAttribute(o,"class",l)}function Nu(i,o,l){const{mergedAttrs:m,classes:v,styles:b}=l;null!==m&&$i(i,o,m),null!==v&&Pa(i,o,v),null!==b&&function bh(i,o,l){i.setAttribute(o,"style",l)}(i,o,b)}function Hg(i){gf=i}function xf(i){return function fc(){if(void 0===Eh&&(Eh=null,dr.trustedTypes))try{Eh=dr.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:i=>i,createScript:i=>i,createScriptURL:i=>i})}catch{}return Eh}()?.createScriptURL(i)||i}class wf{constructor(o){this.changingThisBreaksApplicationSecurity=o}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see ${Zr})`}}function $l(i){return i instanceof wf?i.changingThisBreaksApplicationSecurity:i}function fu(i,o){const l=function bf(i){return i instanceof wf&&i.getTypeName()||null}(i);if(null!=l&&l!==o){if("ResourceURL"===l&&"URL"===o)return!0;throw new Error(`Required a safe ${o}, got a ${l} (see ${Zr})`)}return l===o}const Xg=/^(?:(?:https?|mailto|data|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi;var Go=(()=>((Go=Go||{})[Go.NONE=0]="NONE",Go[Go.HTML=1]="HTML",Go[Go.STYLE=2]="STYLE",Go[Go.SCRIPT=3]="SCRIPT",Go[Go.URL=4]="URL",Go[Go.RESOURCE_URL=5]="RESOURCE_URL",Go))();function Sl(i){const o=mu();return o?o.sanitize(Go.URL,i)||"":fu(i,"URL")?$l(i):function Dh(i){return(i=String(i)).match(Xg)?i:"unsafe:"+i}(mt(i))}function Ml(i){const o=mu();if(o)return xf(o.sanitize(Go.RESOURCE_URL,i)||"");if(fu(i,"ResourceURL"))return xf($l(i));throw new Je(904,!1)}function ys(i,o,l){return function Tm(i,o){return"src"===o&&("embed"===i||"frame"===i||"iframe"===i||"media"===i||"script"===i)||"href"===o&&("base"===i||"link"===i)?Ml:Sl}(o,l)(i)}function mu(){const i=zt();return i&&i[Es]}const yd=new fi("ENVIRONMENT_INITIALIZER"),vd=new fi("INJECTOR",-1),Dm=new fi("INJECTOR_DEF_TYPES");class xd{get(o,l=oo){if(l===oo){const m=new Error(`NullInjectorError: No provider for ${Et(o)}!`);throw m.name="NullInjectorError",m}return l}}function Cm(i){return{\u0275providers:i}}function Qg(...i){return{\u0275providers:Gl(0,i),\u0275fromNgModule:!0}}function Gl(i,...o){const l=[],m=new Set;let v;return sl(o,b=>{const S=b;$u(S,l,[],m)&&(v||(v=[]),v.push(S))}),void 0!==v&&Wc(v,l),l}function Wc(i,o){for(let l=0;l<i.length;l++){const{providers:v}=i[l];Ah(v,b=>{o.push(b)})}}function $u(i,o,l,m){if(!(i=Qt(i)))return!1;let v=null,b=Br(i);const S=!b&&qn(i);if(b||S){if(S&&!S.standalone)return!1;v=i}else{const z=i.ngModule;if(b=Br(z),!b)return!1;v=z}const L=m.has(v);if(S){if(L)return!1;if(m.add(v),S.dependencies){const z="function"==typeof S.dependencies?S.dependencies():S.dependencies;for(const Z of z)$u(Z,o,l,m)}}else{if(!b)return!1;{if(null!=b.imports&&!L){let Z;m.add(v);try{sl(b.imports,ae=>{$u(ae,o,l,m)&&(Z||(Z=[]),Z.push(ae))})}finally{}void 0!==Z&&Wc(Z,o)}if(!L){const Z=go(v)||(()=>new v);o.push({provide:v,useFactory:Z,deps:pe},{provide:Dm,useValue:v,multi:!0},{provide:yd,useValue:()=>Re(v),multi:!0})}const z=b.providers;null==z||L||Ah(z,ae=>{o.push(ae)})}}return v!==i&&void 0!==i.providers}function Ah(i,o){for(let l of i)dt(l)&&(l=l.\u0275providers),Array.isArray(l)?Ah(l,o):o(l)}const Sm=nt({provide:String,useValue:nt});function Pf(i){return null!==i&&"object"==typeof i&&Sm in i}function mc(i){return"function"==typeof i}const Ph=new fi("Set Injector scope."),Rh={},Im={};let gc;function kh(){return void 0===gc&&(gc=new xd),gc}class gu{}class _u extends gu{get destroyed(){return this._destroyed}constructor(o,l,m,v){super(),this.parent=l,this.source=m,this.scopes=v,this.records=new Map,this._ngOnDestroyHooks=new Set,this._onDestroyHooks=[],this._destroyed=!1,kf(o,S=>this.processProvider(S)),this.records.set(vd,Hu(void 0,this)),v.has("environment")&&this.records.set(gu,Hu(void 0,this));const b=this.records.get(Ph);null!=b&&"string"==typeof b.value&&this.scopes.add(b.value),this.injectorDefTypes=new Set(this.get(Dm.multi,pe,yn.Self))}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{for(const o of this._ngOnDestroyHooks)o.ngOnDestroy();for(const o of this._onDestroyHooks)o()}finally{this.records.clear(),this._ngOnDestroyHooks.clear(),this.injectorDefTypes.clear(),this._onDestroyHooks.length=0}}onDestroy(o){this._onDestroyHooks.push(o)}runInContext(o){this.assertNotDestroyed();const l=pt(this),m=on(void 0);try{return o()}finally{pt(l),on(m)}}get(o,l=oo,m=yn.Default){this.assertNotDestroyed(),m=Ln(m);const v=pt(this),b=on(void 0);try{if(!(m&yn.SkipSelf)){let L=this.records.get(o);if(void 0===L){const z=function Lm(i){return"function"==typeof i||"object"==typeof i&&i instanceof fi}(o)&&Yi(o);L=z&&this.injectableDefInScope(z)?Hu(Gu(o),Rh):null,this.records.set(o,L)}if(null!=L)return this.hydrate(o,L)}return(m&yn.Self?kh():this.parent).get(o,l=m&yn.Optional&&l===oo?null:l)}catch(S){if("NullInjectorError"===S.name){if((S[po]=S[po]||[]).unshift(Et(o)),v)throw S;return function de(i,o,l,m){const v=i[po];throw o[xi]&&v.unshift(o[xi]),i.message=function Ee(i,o,l,m=null){i=i&&"\n"===i.charAt(0)&&i.charAt(1)==kn?i.slice(2):i;let v=Et(o);if(Array.isArray(o))v=o.map(Et).join(" -> ");else if("object"==typeof o){let b=[];for(let S in o)if(o.hasOwnProperty(S)){let L=o[S];b.push(S+":"+("string"==typeof L?JSON.stringify(L):Et(L)))}v=`{${b.join(", ")}}`}return`${l}${m?"("+m+")":""}[${v}]: ${i.replace(so,"\n  ")}`}("\n"+i.message,v,l,m),i[gr]=v,i[po]=null,i}(S,o,"R3InjectorError",this.source)}throw S}finally{on(b),pt(v)}}resolveInjectorInitializers(){const o=pt(this),l=on(void 0);try{const m=this.get(yd.multi,pe,yn.Self);for(const v of m)v()}finally{pt(o),on(l)}}toString(){const o=[],l=this.records;for(const m of l.keys())o.push(Et(m));return`R3Injector[${o.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Je(205,!1)}processProvider(o){let l=mc(o=Qt(o))?o:Qt(o&&o.provide);const m=function Pm(i){return Pf(i)?Hu(void 0,i.useValue):Hu(Rm(i),Rh)}(o);if(mc(o)||!0!==o.multi)this.records.get(l);else{let v=this.records.get(l);v||(v=Hu(void 0,Rh,!0),v.factory=()=>ue(v.multi),this.records.set(l,v)),l=o,v.multi.push(o)}this.records.set(l,m)}hydrate(o,l){return l.value===Rh&&(l.value=Im,l.value=l.factory()),"object"==typeof l.value&&l.value&&function t_(i){return null!==i&&"object"==typeof i&&"function"==typeof i.ngOnDestroy}(l.value)&&this._ngOnDestroyHooks.add(l.value),l.value}injectableDefInScope(o){if(!o.providedIn)return!1;const l=Qt(o.providedIn);return"string"==typeof l?"any"===l||this.scopes.has(l):this.injectorDefTypes.has(l)}}function Gu(i){const o=Yi(i),l=null!==o?o.factory:go(i);if(null!==l)return l;if(i instanceof fi)throw new Je(204,!1);if(i instanceof Function)return function Am(i){const o=i.length;if(o>0)throw al(o,"?"),new Je(204,!1);const l=function Pn(i){const o=i&&(i[ri]||i[So]);return o?(function jr(i){if(i.hasOwnProperty("name"))return i.name;(""+i).match(/^function\s*([^\s(]+)/)}(i),o):null}(i);return null!==l?()=>l.factory(i):()=>new i}(i);throw new Je(204,!1)}function Rm(i,o,l){let m;if(mc(i)){const v=Qt(i);return go(v)||Gu(v)}if(Pf(i))m=()=>Qt(i.useValue);else if(function Mm(i){return!(!i||!i.useFactory)}(i))m=()=>i.useFactory(...ue(i.deps||[]));else if(function Rf(i){return!(!i||!i.useExisting)}(i))m=()=>Re(Qt(i.useExisting));else{const v=Qt(i&&(i.useClass||i.provide));if(!function km(i){return!!i.deps}(i))return go(v)||Gu(v);m=()=>new v(...ue(i.deps))}return m}function Hu(i,o,l=!1){return{factory:i,value:o,multi:l?[]:void 0}}function kf(i,o){for(const l of i)Array.isArray(l)?kf(l,o):l&&dt(l)?kf(l.\u0275providers,o):o(l)}class n_{}class Lf{}class _c{resolveComponentFactory(o){throw function Om(i){const o=Error(`No component factory found for ${Et(i)}. Did you add it to @NgModule.entryComponents?`);return o.ngComponent=i,o}(o)}}let Fs=(()=>{class i{}return i.NULL=new _c,i})();function r_(){return qc(Oi(),zt())}function qc(i,o){return new Lh(Jn(i,o))}let Lh=(()=>{class i{constructor(l){this.nativeElement=l}}return i.__NG_ELEMENT_ID__=r_,i})();function i_(i){return i instanceof Lh?i.nativeElement:i}class zm{}let Wu=(()=>{class i{}return i.__NG_ELEMENT_ID__=()=>function wd(){const i=zt(),l=ei(Oi().index,i);return(Ui(l)?l:i)[An]}(),i})(),Bm=(()=>{class i{}return i.\u0275prov=bn({token:i,providedIn:"root",factory:()=>null}),i})();class Zc{constructor(o){this.full=o,this.major=o.split(".")[0],this.minor=o.split(".")[1],this.patch=o.split(".").slice(2).join(".")}}const Oh=new Zc("15.2.5"),Ff={},zf="ngOriginalError";function Bf(i){return i[zf]}class Fh{constructor(){this._console=console}handleError(o){const l=this._findOriginalError(o);this._console.error("ERROR",o),l&&this._console.error("ORIGINAL ERROR",l)}_findOriginalError(o){let l=o&&Bf(o);for(;l&&Bf(l);)l=Bf(l);return l||null}}function Hl(i){return i instanceof Function?i():i}function Cd(i,o,l){let m=i.length;for(;;){const v=i.indexOf(o,l);if(-1===v)return v;if(0===v||i.charCodeAt(v-1)<=32){const b=o.length;if(v+b===m||i.charCodeAt(v+b)<=32)return v}l=v+1}}const Sd="ng-template";function h_(i,o,l){let m=0,v=!0;for(;m<i.length;){let b=i[m++];if("string"==typeof b&&v){const S=i[m++];if(l&&"class"===b&&-1!==Cd(S.toLowerCase(),o,0))return!0}else{if(1===b){for(;m<i.length&&"string"==typeof(b=i[m++]);)if(b.toLowerCase()===o)return!0;return!1}"number"==typeof b&&(v=!1)}}return!1}function jf(i){return 4===i.type&&i.value!==Sd}function zh(i,o,l){return o===(4!==i.type||l?i.value:Sd)}function d_(i,o,l){let m=4;const v=i.attrs||[],b=function Id(i){for(let o=0;o<i.length;o++)if(ji(i[o]))return o;return i.length}(v);let S=!1;for(let L=0;L<o.length;L++){const z=o[L];if("number"!=typeof z){if(!S)if(4&m){if(m=2|1&m,""!==z&&!zh(i,z,l)||""===z&&1===o.length){if(qa(m))return!1;S=!0}}else{const Z=8&m?z:o[++L];if(8&m&&null!==i.attrs){if(!h_(i.attrs,Z,l)){if(qa(m))return!1;S=!0}continue}const Te=f_(8&m?"class":z,v,jf(i),l);if(-1===Te){if(qa(m))return!1;S=!0;continue}if(""!==Z){let Ve;Ve=Te>b?"":v[Te+1].toLowerCase();const tt=8&m?Ve:null;if(tt&&-1!==Cd(tt,Z,0)||2&m&&Z!==Ve){if(qa(m))return!1;S=!0}}}}else{if(!S&&!qa(m)&&!qa(z))return!1;if(S&&qa(z))continue;S=!1,m=z|1&m}}return qa(m)||S}function qa(i){return 0==(1&i)}function f_(i,o,l,m){if(null===o)return-1;let v=0;if(m||!l){let b=!1;for(;v<o.length;){const S=o[v];if(S===i)return v;if(3===S||6===S)b=!0;else{if(1===S||2===S){let L=o[++v];for(;"string"==typeof L;)L=o[++v];continue}if(4===S)break;if(0===S){v+=4;continue}}v+=b?1:2}return-1}return function p_(i,o){let l=i.indexOf(4);if(l>-1)for(l++;l<i.length;){const m=i[l];if("number"==typeof m)return-1;if(m===o)return l;l++}return-1}(o,i)}function Md(i,o,l=!1){for(let m=0;m<o.length;m++)if(d_(i,o[m],l))return!0;return!1}function m_(i,o){e:for(let l=0;l<o.length;l++){const m=o[l];if(i.length===m.length){for(let v=0;v<i.length;v++)if(i[v]!==m[v])continue e;return!0}}return!1}function Nm(i,o){return i?":not("+o.trim()+")":o}function g_(i){let o=i[0],l=1,m=2,v="",b=!1;for(;l<i.length;){let S=i[l];if("string"==typeof S)if(2&m){const L=i[++l];v+="["+S+(L.length>0?'="'+L+'"':"")+"]"}else 8&m?v+="."+S:4&m&&(v+=" "+S);else""!==v&&!qa(S)&&(o+=Nm(b,v),v=""),m=S,b=b||!qa(m);l++}return""!==v&&(o+=Nm(b,v)),o}const Er={};function Um(i){$f(sr(),zt(),Rr()+i,!1)}function $f(i,o,l,m){if(!m)if(3==(3&o[Gn])){const b=i.preOrderCheckHooks;null!==b&&se(o,b,l)}else{const b=i.preOrderHooks;null!==b&&Ce(o,b,0,l)}Kr(l)}function Ad(i,o=null,l=null,m){const v=Bh(i,o,l,m);return v.resolveInjectorInitializers(),v}function Bh(i,o=null,l=null,m,v=new Set){const b=[l||pe,Qg(i)];return m=m||("object"==typeof i?void 0:Et(i)),new _u(b,o||kh(),m||null,v)}let Wl=(()=>{class i{static create(l,m){if(Array.isArray(l))return Ad({name:""},m,l,"");{const v=l.name??"";return Ad({name:v},l.parent,l.providers,v)}}}return i.THROW_IF_NOT_FOUND=oo,i.NULL=new xd,i.\u0275prov=bn({token:i,providedIn:"any",factory:()=>Re(vd)}),i.__NG_ELEMENT_ID__=-1,i})();function vc(i,o=yn.Default){const l=zt();return null===l?Re(i,o):zl(Oi(),l,Qt(i),o)}function Zm(){throw new Error("invalid")}function Jf(i,o){const l=i.contentQueries;if(null!==l)for(let m=0;m<l.length;m+=2){const b=l[m+1];if(-1!==b){const S=i.data[b];et(l[m]),S.contentQueries(2,o[b],b)}}}function Ld(i,o,l,m,v,b,S,L,z,Z,ae){const Te=o.blueprint.slice();return Te[On]=v,Te[Gn]=76|m,(null!==ae||i&&1024&i[Gn])&&(Te[Gn]|=1024),Ms(Te),Te[Ur]=Te[Qi]=i,Te[ir]=l,Te[os]=S||i&&i[os],Te[An]=L||i&&i[An],Te[Es]=z||i&&i[Es]||null,Te[Cr]=Z||i&&i[Cr]||null,Te[Jr]=b,Te[Li]=function em(){return zc++}(),Te[Qr]=ae,Te[li]=2==o.type?i[li]:Te,Te}function Ku(i,o,l,m,v){let b=i.data[o];if(null===b)b=function Qf(i,o,l,m,v){const b=tl(),S=Yo(),z=i.data[o]=function R_(i,o,l,m,v,b){return{type:l,index:m,insertBeforeIndex:null,injectorIndex:o?o.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,componentOffset:-1,propertyBindings:null,flags:0,providerIndexes:0,value:v,attrs:b,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tView:null,next:null,prev:null,projectionNext:null,child:null,parent:o,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,S?b:b&&b.parent,l,o,m,v);return null===i.firstChild&&(i.firstChild=z),null!==b&&(S?null==b.child&&null!==z.parent&&(b.child=z):null===b.next&&(b.next=z,z.prev=b)),z}(i,o,l,m,v),function M(){return nr.lFrame.inI18n}()&&(b.flags|=32);else if(64&b.type){b.type=l,b.value=m,b.attrs=v;const S=function Is(){const i=nr.lFrame,o=i.currentTNode;return i.isParent?o:o.parent}();b.injectorIndex=null===S?-1:S.injectorIndex}return Ro(b,!0),b}function jh(i,o,l,m){if(0===l)return-1;const v=o.length;for(let b=0;b<l;b++)o.push(m),i.blueprint.push(m),i.data.push(null);return v}function Od(i,o,l){_n(o);try{const m=i.viewQuery;null!==m&&Vd(1,m,l);const v=i.template;null!==v&&vs(i,o,v,1,l),i.firstCreatePass&&(i.firstCreatePass=!1),i.staticContentQueries&&Jf(i,o),i.staticViewQueries&&Vd(2,i.viewQuery,l);const b=i.components;null!==b&&function A_(i,o){for(let l=0;l<o.length;l++)ap(i,o[l])}(o,b)}catch(m){throw i.firstCreatePass&&(i.incompleteFirstPass=!0,i.firstCreatePass=!1),m}finally{o[Gn]&=-5,fr()}}function Fd(i,o,l,m){const v=o[Gn];if(128!=(128&v)){_n(o);try{Ms(o),function pl(i){return nr.lFrame.bindingIndex=i}(i.bindingStartIndex),null!==l&&vs(i,o,l,2,m);const S=3==(3&v);if(S){const Z=i.preOrderCheckHooks;null!==Z&&se(o,Z,null)}else{const Z=i.preOrderHooks;null!==Z&&Ce(o,Z,0,null),I(o,0)}if(function Za(i){for(let o=ff(i);null!==o;o=pf(o)){if(!o[co])continue;const l=o[ii];for(let m=0;m<l.length;m++){const v=l[m];512&v[Gn]||Po(v[Ur],1),v[Gn]|=512}}}(o),function ng(i){for(let o=ff(i);null!==o;o=pf(o))for(let l=Ni;l<o.length;l++){const m=o[l],v=m[Ot];Ko(m)&&Fd(v,m,v.template,m[ir])}}(o),null!==i.contentQueries&&Jf(i,o),S){const Z=i.contentCheckHooks;null!==Z&&se(o,Z)}else{const Z=i.contentHooks;null!==Z&&Ce(o,Z,1),I(o,1)}!function Xm(i,o){const l=i.hostBindingOpCodes;if(null!==l)try{for(let m=0;m<l.length;m++){const v=l[m];if(v<0)Kr(~v);else{const b=v,S=l[++m],L=l[++m];j(S,b),L(2,o[b])}}}finally{Kr(-1)}}(i,o);const L=i.components;null!==L&&function Km(i,o){for(let l=0;l<o.length;l++)Gh(i,o[l])}(o,L);const z=i.viewQuery;if(null!==z&&Vd(2,z,m),S){const Z=i.viewCheckHooks;null!==Z&&se(o,Z)}else{const Z=i.viewHooks;null!==Z&&Ce(o,Z,2),I(o,2)}!0===i.firstUpdatePass&&(i.firstUpdatePass=!1),o[Gn]&=-41,512&o[Gn]&&(o[Gn]&=-513,Po(o[Ur],-1))}finally{fr()}}}function vs(i,o,l,m,v){const b=Rr(),S=2&m;try{Kr(-1),S&&o.length>Hr&&$f(i,o,Hr,!1),no(S?2:0,v),l(m,v)}finally{Kr(b),no(S?3:1,v)}}function ul(i,o,l){if(ra(o)){const v=o.directiveEnd;for(let b=o.directiveStart;b<v;b++){const S=i.data[b];S.contentQueries&&S.contentQueries(1,l[b],b)}}}function Vh(i,o,l){hs()&&(function O_(i,o,l,m){const v=l.directiveStart,b=l.directiveEnd;Wo(l)&&function tg(i,o,l){const m=Jn(o,i),v=wu(l),b=i[os],S=Ud(i,Ld(i,v,null,l.onPush?32:16,m,o,b,b.createRenderer(m,l),null,null,null));i[o.index]=S}(o,l,i.data[v+l.componentOffset]),i.firstCreatePass||Fl(l,o),Zs(m,o);const S=l.initialInputs;for(let L=v;L<b;L++){const z=i.data[L],Z=rl(o,i,L,l);Zs(Z,o),null!==S&&U_(0,L-v,Z,z,0,S),eo(z)&&(ei(l.index,o)[ir]=rl(o,i,L,l))}}(i,o,l,Jn(l,o)),64==(64&l.flags)&&eg(i,o,l))}function Yu(i,o,l=Jn){const m=o.localNames;if(null!==m){let v=o.index+1;for(let b=0;b<m.length;b+=2){const S=m[b+1],L=-1===S?l(o,i):i[S];i[v++]=L}}}function wu(i){const o=i.tView;return null===o||o.incompleteFirstPass?i.tView=ep(1,null,i.template,i.decls,i.vars,i.directiveDefs,i.pipeDefs,i.viewQuery,i.schemas,i.consts):o}function ep(i,o,l,m,v,b,S,L,z,Z){const ae=Hr+m,Te=ae+v,Ve=function P_(i,o){const l=[];for(let m=0;m<o;m++)l.push(m<i?null:Er);return l}(ae,Te),tt="function"==typeof Z?Z():Z;return Ve[Ot]={type:i,blueprint:Ve,template:l,queries:null,viewQuery:L,declTNode:o,data:Ve.slice().fill(null,ae),bindingStartIndex:ae,expandoStartIndex:Te,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof b?b():b,pipeRegistry:"function"==typeof S?S():S,firstChild:null,schemas:z,consts:tt,incompleteFirstPass:!1}}function Ym(i,o,l,m){const v=$d(o);null===l?v.push(m):(v.push(l),i.firstCreatePass&&lp(i).push(m,v.length-1))}function Ju(i,o,l,m){for(let v in i)if(i.hasOwnProperty(v)){l=null===l?{}:l;const b=i[v];null===m?tp(l,o,v,b):m.hasOwnProperty(v)&&tp(l,o,m[v],b)}return l}function tp(i,o,l,m){i.hasOwnProperty(l)?i[l].push(o,m):i[l]=[o,m]}function ya(i,o,l,m,v,b,S,L){const z=Jn(o,l);let ae,Z=o.inputs;!L&&null!=Z&&(ae=Z[m])?(Al(i,l,ae,m,v),Wo(o)&&np(l,o.index)):3&o.type&&(m=function Ii(i){return"class"===i?"className":"for"===i?"htmlFor":"formaction"===i?"formAction":"innerHtml"===i?"innerHTML":"readonly"===i?"readOnly":"tabindex"===i?"tabIndex":i}(m),v=null!=S?S(v,o.value||"",m):v,b.setProperty(z,m,v))}function np(i,o){const l=ei(o,i);16&l[Gn]||(l[Gn]|=32)}function Kc(i,o,l,m){if(hs()){const v=null===m?null:{"":-1},b=function z_(i,o){const l=i.directiveRegistry;let m=null,v=null;if(l)for(let b=0;b<l.length;b++){const S=l[b];if(Md(o,S.selectors,!1))if(m||(m=[]),eo(S))if(null!==S.findHostDirectiveDefs){const L=[];v=v||new Map,S.findHostDirectiveDefs(S,L,v),m.unshift(...L,S),ip(i,o,L.length)}else m.unshift(S),ip(i,o,0);else v=v||new Map,S.findHostDirectiveDefs?.(S,m,v),m.push(S)}return null===m?null:[m,v]}(i,l);let S,L;null===b?S=L=null:[S,L]=b,null!==S&&rp(i,o,l,S,v,L),v&&function B_(i,o,l){if(o){const m=i.localNames=[];for(let v=0;v<o.length;v+=2){const b=l[o[v+1]];if(null==b)throw new Je(-301,!1);m.push(o[v],b)}}}(l,m,v)}l.mergedAttrs=Vo(l.mergedAttrs,l.attrs)}function rp(i,o,l,m,v,b){for(let Z=0;Z<m.length;Z++)_l(Fl(l,o),i,m[Z].type);!function zd(i,o,l){i.flags|=1,i.directiveStart=o,i.directiveEnd=o+l,i.providerIndexes=o}(l,i.data.length,m.length);for(let Z=0;Z<m.length;Z++){const ae=m[Z];ae.providersResolver&&ae.providersResolver(ae)}let S=!1,L=!1,z=jh(i,o,m.length,null);for(let Z=0;Z<m.length;Z++){const ae=m[Z];l.mergedAttrs=Vo(l.mergedAttrs,ae.hostAttrs),Qu(i,l,o,z,ae),N_(z,ae,v),null!==ae.contentQueries&&(l.flags|=4),(null!==ae.hostBindings||null!==ae.hostAttrs||0!==ae.hostVars)&&(l.flags|=64);const Te=ae.type.prototype;!S&&(Te.ngOnChanges||Te.ngOnInit||Te.ngDoCheck)&&((i.preOrderHooks||(i.preOrderHooks=[])).push(l.index),S=!0),!L&&(Te.ngOnChanges||Te.ngDoCheck)&&((i.preOrderCheckHooks||(i.preOrderCheckHooks=[])).push(l.index),L=!0),z++}!function Jm(i,o,l){const v=o.directiveEnd,b=i.data,S=o.attrs,L=[];let z=null,Z=null;for(let ae=o.directiveStart;ae<v;ae++){const Te=b[ae],Ve=l?l.get(Te):null,Mt=Ve?Ve.outputs:null;z=Ju(Te.inputs,ae,z,Ve?Ve.inputs:null),Z=Ju(Te.outputs,ae,Z,Mt);const rn=null===z||null===S||jf(o)?null:sp(z,ae,S);L.push(rn)}null!==z&&(z.hasOwnProperty("class")&&(o.flags|=8),z.hasOwnProperty("style")&&(o.flags|=16)),o.initialInputs=L,o.inputs=z,o.outputs=Z}(i,l,b)}function eg(i,o,l){const m=l.directiveStart,v=l.directiveEnd,b=l.index,S=function te(){return nr.lFrame.currentDirectiveIndex}();try{Kr(b);for(let L=m;L<v;L++){const z=i.data[L],Z=o[L];ge(L),(null!==z.hostBindings||0!==z.hostVars||null!==z.hostAttrs)&&F_(z,Z)}}finally{Kr(-1),ge(S)}}function F_(i,o){null!==i.hostBindings&&i.hostBindings(1,o)}function ip(i,o,l){o.componentOffset=l,(i.components||(i.components=[])).push(o.index)}function N_(i,o,l){if(l){if(o.exportAs)for(let m=0;m<o.exportAs.length;m++)l[o.exportAs[m]]=i;eo(o)&&(l[""]=i)}}function Qu(i,o,l,m,v){i.data[m]=v;const b=v.factory||(v.factory=go(v.type)),S=new We(b,eo(v),vc);i.blueprint[m]=S,l[m]=S,function k_(i,o,l,m,v){const b=v.hostBindings;if(b){let S=i.hostBindingOpCodes;null===S&&(S=i.hostBindingOpCodes=[]);const L=~o.index;(function L_(i){let o=i.length;for(;o>0;){const l=i[--o];if("number"==typeof l&&l<0)return l}return 0})(S)!=L&&S.push(L),S.push(l,m,b)}}(i,o,m,jh(i,l,v.hostVars,Er),v)}function ql(i,o,l,m,v,b){const S=Jn(i,o);!function op(i,o,l,m,v,b,S){if(null==b)i.removeAttribute(o,v,l);else{const L=null==S?mt(b):S(b,m||"",v);i.setAttribute(o,v,L,l)}}(o[An],S,b,i.value,l,m,v)}function U_(i,o,l,m,v,b){const S=b[o];if(null!==S){const L=m.setInput;for(let z=0;z<S.length;){const Z=S[z++],ae=S[z++],Te=S[z++];null!==L?m.setInput(l,Te,Z,ae):l[ae]=Te}}}function sp(i,o,l){let m=null,v=0;for(;v<l.length;){const b=l[v];if(0!==b)if(5!==b){if("number"==typeof b)break;if(i.hasOwnProperty(b)){null===m&&(m=[]);const S=i[b];for(let L=0;L<S.length;L+=2)if(S[L]===o){m.push(b,S[L+1],l[v+1]);break}}v+=2}else v+=2;else v+=4}return m}function Bd(i,o,l,m){return[i,!0,!1,o,null,0,m,l,null,null]}function Gh(i,o){const l=ei(o,i);if(Ko(l)){const m=l[Ot];48&l[Gn]?Fd(m,l,m.template,l[ir]):l[mo]>0&&Yc(l)}}function Yc(i){for(let m=ff(i);null!==m;m=pf(m))for(let v=Ni;v<m.length;v++){const b=m[v];if(Ko(b))if(512&b[Gn]){const S=b[Ot];Fd(S,b,S.template,b[ir])}else b[mo]>0&&Yc(b)}const l=i[Ot].components;if(null!==l)for(let m=0;m<l.length;m++){const v=ei(l[m],i);Ko(v)&&v[mo]>0&&Yc(v)}}function ap(i,o){const l=ei(o,i),m=l[Ot];(function Nd(i,o){for(let l=o.length;l<i.blueprint.length;l++)o.push(i.blueprint[l])})(m,l),Od(m,l,l[ir])}function Ud(i,o){return i[bi]?i[Bs][Nn]=o:i[bi]=o,i[Bs]=o,o}function jd(i){for(;i;){i[Gn]|=32;const o=Bc(i);if(Js(i)&&!o)return i;i=o}return null}function Hh(i,o,l,m=!0){const v=o[os];v.begin&&v.begin();try{Fd(i,o,i.template,l)}catch(S){throw m&&cp(o,S),S}finally{v.end&&v.end()}}function Vd(i,o,l){et(0),o(i,l)}function $d(i){return i[Mo]||(i[Mo]=[])}function lp(i){return i.cleanup||(i.cleanup=[])}function cp(i,o){const l=i[Cr],m=l?l.get(Fh,null):null;m&&m.handleError(o)}function Al(i,o,l,m,v){for(let b=0;b<l.length;){const S=l[b++],L=l[b++],z=o[S],Z=i.data[S];null!==Z.setInput?Z.setInput(z,v,m,L):z[L]=v}}function Wh(i,o,l){let m=l?i.styles:null,v=l?i.classes:null,b=0;if(null!==o)for(let S=0;S<o.length;S++){const L=o[S];"number"==typeof L?b=L:1==b?v=jn(v,L):2==b&&(m=jn(m,L+": "+o[++S]+";"))}l?i.styles=m:i.stylesWithoutHost=m,l?i.classes=v:i.classesWithoutHost=v}function qh(i,o,l,m,v=!1){for(;null!==l;){const b=o[l.index];if(null!==b&&m.push(di(b)),Wr(b))for(let L=Ni;L<b.length;L++){const z=b[L],Z=z[Ot].firstChild;null!==Z&&qh(z[Ot],z,Z,m)}const S=l.type;if(8&S)qh(i,o,l.child,m);else if(32&S){const L=zu(l,o);let z;for(;z=L();)m.push(z)}else if(16&S){const L=pm(o,l);if(Array.isArray(L))m.push(...L);else{const z=Bc(o[li]);qh(z[Ot],z,L,m,!0)}}l=v?l.projectionNext:l.next}return m}class eh{get rootNodes(){const o=this._lView,l=o[Ot];return qh(l,o,l.firstChild,[])}constructor(o,l){this._lView=o,this._cdRefInjectingView=l,this._appRef=null,this._attachedToViewContainer=!1}get context(){return this._lView[ir]}set context(o){this._lView[ir]=o}get destroyed(){return 128==(128&this._lView[Gn])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const o=this._lView[Ur];if(Wr(o)){const l=o[Ys],m=l?l.indexOf(this):-1;m>-1&&(hd(o,m),lc(l,m))}this._attachedToViewContainer=!1}ph(this._lView[Ot],this._lView)}onDestroy(o){Ym(this._lView[Ot],this._lView,null,o)}markForCheck(){jd(this._cdRefInjectingView||this._lView)}detach(){this._lView[Gn]&=-65}reattach(){this._lView[Gn]|=64}detectChanges(){Hh(this._lView[Ot],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new Je(902,!1);this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function hu(i,o){Vl(i,o,o[An],2,null,null)}(this._lView[Ot],this._lView)}attachToAppRef(o){if(this._attachedToViewContainer)throw new Je(902,!1);this._appRef=o}}class V_ extends eh{constructor(o){super(o),this._view=o}detectChanges(){const o=this._view;Hh(o[Ot],o,o[ir],!1)}checkNoChanges(){}get context(){return null}}class ig extends Fs{constructor(o){super(),this.ngModule=o}resolveComponentFactory(o){const l=qn(o);return new th(l,this.ngModule)}}function up(i){const o=[];for(let l in i)i.hasOwnProperty(l)&&o.push({propName:i[l],templateName:l});return o}class Zh{constructor(o,l){this.injector=o,this.parentInjector=l}get(o,l,m){m=Ln(m);const v=this.injector.get(o,Ff,m);return v!==Ff||l===Ff?v:this.parentInjector.get(o,l,m)}}class th extends Lf{get inputs(){return up(this.componentDef.inputs)}get outputs(){return up(this.componentDef.outputs)}constructor(o,l){super(),this.componentDef=o,this.ngModule=l,this.componentType=o.type,this.selector=function __(i){return i.map(g_).join(",")}(o.selectors),this.ngContentSelectors=o.ngContentSelectors?o.ngContentSelectors:[],this.isBoundToModule=!!l}create(o,l,m,v){let b=(v=v||this.ngModule)instanceof gu?v:v?.injector;b&&null!==this.componentDef.getStandaloneInjector&&(b=this.componentDef.getStandaloneInjector(b)||b);const S=b?new Zh(o,b):o,L=S.get(zm,null);if(null===L)throw new Je(407,!1);const z=S.get(Bm,null),Z=L.createRenderer(null,this.componentDef),ae=this.componentDef.selectors[0][0]||"div",Te=m?function $h(i,o,l){return i.selectRootElement(o,l===q.ShadowDom)}(Z,m,this.componentDef.encapsulation):$a(Z,ae,function og(i){const o=i.toLowerCase();return"svg"===o?"svg":"math"===o?"math":null}(ae)),Ve=this.componentDef.onPush?288:272,tt=ep(0,null,null,1,0,null,null,null,null,null),Mt=Ld(null,tt,null,Ve,null,null,L,Z,z,S,null);let rn,Tn;_n(Mt);try{const Fn=this.componentDef;let lr,Yt=null;Fn.findHostDirectiveDefs?(lr=[],Yt=new Map,Fn.findHostDirectiveDefs(Fn,lr,Yt),lr.push(Fn)):lr=[Fn];const zr=function nh(i,o){const l=i[Ot],m=Hr;return i[m]=o,Ku(l,m,2,"#host",null)}(Mt,Te),zo=function lg(i,o,l,m,v,b,S,L){const z=v[Ot];!function Gd(i,o,l,m){for(const v of i)o.mergedAttrs=Vo(o.mergedAttrs,v.hostAttrs);null!==o.mergedAttrs&&(Wh(o,o.mergedAttrs,!0),null!==l&&Nu(m,l,o))}(m,i,o,S);const Z=b.createRenderer(o,l),ae=Ld(v,wu(l),null,l.onPush?32:16,v[i.index],i,b,Z,L||null,null,null);return z.firstCreatePass&&ip(z,i,m.length-1),Ud(v,ae),v[i.index]=ae}(zr,Te,Fn,lr,Mt,L,Z);Tn=Ba(tt,Hr),Te&&function Hd(i,o,l,m){if(m)$i(i,l,["ng-version",Oh.full]);else{const{attrs:v,classes:b}=function y_(i){const o=[],l=[];let m=1,v=2;for(;m<i.length;){let b=i[m];if("string"==typeof b)2===v?""!==b&&o.push(b,i[++m]):8===v&&l.push(b);else{if(!qa(v))break;v=b}m++}return{attrs:o,classes:l}}(o.selectors[0]);v&&$i(i,l,v),b&&b.length>0&&Pa(i,l,b.join(" "))}}(Z,Fn,Te,m),void 0!==l&&function Wd(i,o,l){const m=i.projection=[];for(let v=0;v<o.length;v++){const b=l[v];m.push(null!=b?Array.from(b):null)}}(Tn,this.ngContentSelectors,l),rn=function cg(i,o,l,m,v,b){const S=Oi(),L=v[Ot],z=Jn(S,v);rp(L,v,S,l,null,m);for(let ae=0;ae<l.length;ae++)Zs(rl(v,L,S.directiveStart+ae,S),v);eg(L,v,S),z&&Zs(z,v);const Z=rl(v,L,S.directiveStart+S.componentOffset,S);if(i[ir]=v[ir]=Z,null!==b)for(const ae of b)ae(Z,o);return ul(L,S,i),Z}(zo,Fn,lr,Yt,Mt,[$_]),Od(tt,Mt,null)}finally{fr()}return new sg(this.componentType,rn,qc(Tn,Mt),Mt,Tn)}}class sg extends n_{constructor(o,l,m,v,b){super(),this.location=m,this._rootLView=v,this._tNode=b,this.instance=l,this.hostView=this.changeDetectorRef=new V_(v),this.componentType=o}setInput(o,l){const m=this._tNode.inputs;let v;if(null!==m&&(v=m[o])){const b=this._rootLView;Al(b[Ot],b,v,o,l),np(b,this._tNode.index)}}get injector(){return new Bl(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(o){this.hostView.onDestroy(o)}}function $_(){const i=Oi();N(zt()[Ot],i)}function hp(i){let o=function ug(i){return Object.getPrototypeOf(i.prototype).constructor}(i.type),l=!0;const m=[i];for(;o;){let v;if(eo(i))v=o.\u0275cmp||o.\u0275dir;else{if(o.\u0275cmp)throw new Je(903,!1);v=o.\u0275dir}if(v){if(l){m.push(v);const S=i;S.inputs=dp(i.inputs),S.declaredInputs=dp(i.declaredInputs),S.outputs=dp(i.outputs);const L=v.hostBindings;L&&H_(i,L);const z=v.viewQuery,Z=v.contentQueries;if(z&&rh(i,z),Z&&fp(i,Z),ft(i.inputs,v.inputs),ft(i.declaredInputs,v.declaredInputs),ft(i.outputs,v.outputs),eo(v)&&v.data.animation){const ae=i.data;ae.animation=(ae.animation||[]).concat(v.data.animation)}}const b=v.features;if(b)for(let S=0;S<b.length;S++){const L=b[S];L&&L.ngInherit&&L(i),L===hp&&(l=!1)}}o=Object.getPrototypeOf(o)}!function G_(i){let o=0,l=null;for(let m=i.length-1;m>=0;m--){const v=i[m];v.hostVars=o+=v.hostVars,v.hostAttrs=Vo(v.hostAttrs,l=Vo(l,v.hostAttrs))}}(m)}function dp(i){return i===re?{}:i===pe?[]:i}function rh(i,o){const l=i.viewQuery;i.viewQuery=l?(m,v)=>{o(m,v),l(m,v)}:o}function fp(i,o){const l=i.contentQueries;i.contentQueries=l?(m,v,b)=>{o(m,v,b),l(m,v,b)}:o}function H_(i,o){const l=i.hostBindings;i.hostBindings=l?(m,v)=>{o(m,v),l(m,v)}:o}function Xh(i){return!!Xl(i)&&(Array.isArray(i)||!(i instanceof Map)&&Symbol.iterator in i)}function Xl(i){return null!==i&&("function"==typeof i||"object"==typeof i)}function ka(i,o,l){return i[o]=l}function wc(i,o){return i[o]}function Qo(i,o,l){return!Object.is(i[o],l)&&(i[o]=l,!0)}function Pl(i,o,l,m){const v=Qo(i,o,l);return Qo(i,o+1,m)||v}function hl(i,o,l,m,v,b){const S=Pl(i,o,l,m);return Pl(i,o+2,v,b)||S}function _p(i,o,l,m){const v=zt();return Qo(v,Uo(),o)&&(sr(),ql(br(),v,i,o,l,m)),_p}function bc(i,o,l,m){return Qo(i,Uo(),l)?o+mt(l)+m:Er}function _g(i,o,l,m,v,b,S,L){const z=zt(),Z=sr(),ae=i+Hr,Te=Z.firstCreatePass?function Jc(i,o,l,m,v,b,S,L,z){const Z=o.consts,ae=Ku(o,i,4,S||null,Gs(Z,L));Kc(o,l,ae,Gs(Z,z)),N(o,ae);const Te=ae.tView=ep(2,ae,m,v,b,o.directiveRegistry,o.pipeRegistry,null,o.schemas,Z);return null!==o.queries&&(o.queries.template(o,ae),Te.queries=o.queries.embeddedTView(ae)),ae}(ae,Z,z,o,l,m,v,b,S):Z.data[ae];Ro(Te,!1);const Ve=z[An].createComment("");yh(Z,z,Ve,Te),Zs(Ve,z),Ud(z,z[ae]=Bd(Ve,z,Ve,Te)),Io(Te)&&Vh(Z,z,Te),null!=S&&Yu(z,Te,L)}function wp(i){return function cs(i,o){return i[o]}(function ds(){return nr.lFrame.contextLView}(),Hr+i)}function ah(i,o,l){const m=zt();return Qo(m,Uo(),o)&&ya(sr(),br(),m,i,o,m[An],l,!1),ah}function bp(i,o,l,m,v){const S=v?"class":"style";Al(i,l,o.inputs[S],S,m)}function Xd(i,o,l,m){const v=zt(),b=sr(),S=Hr+i,L=v[An],z=b.firstCreatePass?function K_(i,o,l,m,v,b){const S=o.consts,z=Ku(o,i,2,m,Gs(S,v));return Kc(o,l,z,Gs(S,b)),null!==z.attrs&&Wh(z,z.attrs,!1),null!==z.mergedAttrs&&Wh(z,z.mergedAttrs,!0),null!==o.queries&&o.queries.elementStart(o,z),z}(S,b,v,o,l,m):b.data[S],Z=v[S]=$a(L,o,function F(){return nr.lFrame.currentNamespace}()),ae=Io(z);return Ro(z,!0),Nu(L,Z,z),32!=(32&z.flags)&&yh(b,v,Z,z),0===function ea(){return nr.lFrame.elementDepthCount}()&&Zs(Z,v),function Ti(){nr.lFrame.elementDepthCount++}(),ae&&(Vh(b,v,z),ul(b,z,v)),null!==m&&Yu(v,z),Xd}function Kd(){let i=Oi();Yo()?ko():(i=i.parent,Ro(i,!1));const o=i;!function Ea(){nr.lFrame.elementDepthCount--}();const l=sr();return l.firstCreatePass&&(N(l,i),ra(i)&&l.queries.elementEnd(i)),null!=o.classesWithoutHost&&function yt(i){return 0!=(8&i.flags)}(o)&&bp(l,o,zt(),o.classesWithoutHost,!0),null!=o.stylesWithoutHost&&function Di(i){return 0!=(16&i.flags)}(o)&&bp(l,o,zt(),o.stylesWithoutHost,!1),Kd}function Qh(i,o,l,m){return Xd(i,o,l,m),Kd(),Qh}function Mu(i,o,l){const m=zt(),v=sr(),b=i+Hr,S=v.firstCreatePass?function Y_(i,o,l,m,v){const b=o.consts,S=Gs(b,m),L=Ku(o,i,8,"ng-container",S);return null!==S&&Wh(L,S,!0),Kc(o,l,L,Gs(b,v)),null!==o.queries&&o.queries.elementStart(o,L),L}(b,v,m,o,l):v.data[b];Ro(S,!0);const L=m[b]=m[An].createComment("");return yh(v,m,L,S),Zs(L,m),Io(S)&&(Vh(v,m,S),ul(v,S,m)),null!=l&&Yu(m,S),Mu}function Ep(){let i=Oi();const o=sr();return Yo()?ko():(i=i.parent,Ro(i,!1)),o.firstCreatePass&&(N(o,i),ra(i)&&o.queries.elementEnd(i)),Ep}function Tp(i,o,l){return Mu(i,o,l),Ep(),Tp}function Dp(){return zt()}function Cp(i){return!!i&&"function"==typeof i.then}function Sp(i){return!!i&&"function"==typeof i.subscribe}const Xa=Sp;function dl(i,o,l,m){const v=zt(),b=sr(),S=Oi();return function Tc(i,o,l,m,v,b,S){const L=Io(m),Z=i.firstCreatePass&&lp(i),ae=o[ir],Te=$d(o);let Ve=!0;if(3&m.type||S){const rn=Jn(m,o),Tn=S?S(rn):rn,Fn=Te.length,lr=S?zr=>S(di(zr[m.index])):m.index;let Yt=null;if(!S&&L&&(Yt=function Kl(i,o,l,m){const v=i.cleanup;if(null!=v)for(let b=0;b<v.length-1;b+=2){const S=v[b];if(S===l&&v[b+1]===m){const L=o[Mo],z=v[b+2];return L.length>z?L[z]:null}"string"==typeof S&&(b+=2)}return null}(i,o,v,m.index)),null!==Yt)(Yt.__ngLastListenerFn__||Yt).__ngNextListenerFn__=b,Yt.__ngLastListenerFn__=b,Ve=!1;else{b=Mp(m,o,ae,b,!1);const zr=l.listen(Tn,v,b);Te.push(b,zr),Z&&Z.push(v,lr,Fn,Fn+1)}}else b=Mp(m,o,ae,b,!1);const tt=m.outputs;let Mt;if(Ve&&null!==tt&&(Mt=tt[v])){const rn=Mt.length;if(rn)for(let Tn=0;Tn<rn;Tn+=2){const zo=o[Mt[Tn]][Mt[Tn+1]].subscribe(b),bs=Te.length;Te.push(b,zo),Z&&Z.push(v,m.index,bs,-(bs+1))}}}(b,v,v[An],S,i,o,m),dl}function ed(i,o,l,m){try{return no(6,o,l),!1!==l(m)}catch(v){return cp(i,v),!1}finally{no(7,o,l)}}function Mp(i,o,l,m,v){return function b(S){if(S===Function)return m;jd(i.componentOffset>-1?ei(i.index,o):o);let z=ed(o,l,m,S),Z=b.__ngNextListenerFn__;for(;Z;)z=ed(o,l,Z,S)&&z,Z=Z.__ngNextListenerFn__;return v&&!1===z&&(S.preventDefault(),S.returnValue=!1),z}}function Ip(i=1){return function Fr(i){return(nr.lFrame.contextLView=function oi(i,o){for(;i>0;)o=o[Qi],i--;return o}(i,nr.lFrame.contextLView))[ir]}(i)}function yg(i,o){let l=null;const m=function Vf(i){const o=i.attrs;if(null!=o){const l=o.indexOf(5);if(!(1&l))return o[l+1]}return null}(i);for(let v=0;v<o.length;v++){const b=o[v];if("*"!==b){if(null===m?Md(i,b,!0):m_(m,b))return v}else l=v}return l}function Yd(i){const o=zt()[li][Jr];if(!o.projection){const m=o.projection=al(i?i.length:1,null),v=m.slice();let b=o.child;for(;null!==b;){const S=i?yg(b,i):0;null!==S&&(v[S]?v[S].projectionNext=b:m[S]=b,v[S]=b),b=b.next}}}function vg(i,o=0,l){const m=zt(),v=sr(),b=Ku(v,Hr+i,16,null,l||null);null===b.projection&&(b.projection=o),ko(),32!=(32&b.flags)&&function dc(i,o,l){fd(o[An],0,o,l,yo(i,l,o),Vc(l.parent||o[Jr],l,o))}(v,m,b)}function Jd(i,o,l){return Qd(i,"",o,"",l),Jd}function Qd(i,o,l,m,v){const b=zt(),S=bc(b,o,l,m);return S!==Er&&ya(sr(),br(),b,i,S,b[An],v,!1),Qd}function ef(i,o){return i<<17|o<<2}function Ka(i){return i>>17&32767}function fl(i){return 2|i}function Cc(i){return(131068&i)>>2}function nd(i,o){return-131069&i|o<<2}function Sc(i){return 1|i}function Bp(i,o,l,m,v){const b=i[l+1],S=null===o;let L=m?Ka(b):Cc(b),z=!1;for(;0!==L&&(!1===z||S);){const ae=i[L+1];xg(i[L],o)&&(z=!0,i[L+1]=m?Sc(ae):fl(ae)),L=m?Ka(ae):Cc(ae)}z&&(i[l+1]=m?fl(b):Sc(b))}function xg(i,o){return null===i||null==o||(Array.isArray(i)?i[1]:i)===o||!(!Array.isArray(i)||"string"!=typeof o)&&d(i,o)>=0}const xs={textEnd:0,key:0,keyEnd:0,value:0,valueEnd:0};function Np(i){return i.substring(xs.key,xs.keyEnd)}function wg(i){return i.substring(xs.value,xs.valueEnd)}function nf(i,o){const l=xs.textEnd;return l===o?-1:(o=xs.keyEnd=function n(i,o,l){for(;o<l&&i.charCodeAt(o)>32;)o++;return o}(i,xs.key=o,l),e(i,o,l))}function Up(i,o){const l=xs.textEnd;let m=xs.key=e(i,o,l);return l===m?-1:(m=xs.keyEnd=function s(i,o,l){let m;for(;o<l&&(45===(m=i.charCodeAt(o))||95===m||(-33&m)>=65&&(-33&m)<=90||m>=48&&m<=57);)o++;return o}(i,m,l),m=h(i,m,l),m=xs.value=e(i,m,l),m=xs.valueEnd=function g(i,o,l){let m=-1,v=-1,b=-1,S=o,L=S;for(;S<l;){const z=i.charCodeAt(S++);if(59===z)return L;34===z||39===z?L=S=_(i,z,S,l):o===S-4&&85===b&&82===v&&76===m&&40===z?L=S=_(i,41,S,l):z>32&&(L=S),b=v,v=m,m=-33&z}return L}(i,m,l),h(i,m,l))}function t(i){xs.key=0,xs.keyEnd=0,xs.value=0,xs.valueEnd=0,xs.textEnd=i.length}function e(i,o,l){for(;o<l&&i.charCodeAt(o)<=32;)o++;return o}function h(i,o,l,m){return(o=e(i,o,l))<l&&o++,o}function _(i,o,l,m){let v=-1,b=l;for(;b<m;){const S=i.charCodeAt(b++);if(S==o&&92!==v)return b;v=92==S&&92===v?0:S}throw new Error}function D(i,o){return function G(i,o,l,m){const v=zt(),b=sr(),S=Q(2);b.firstUpdatePass&&xe(b,i,S,m),o!==Er&&Qo(v,S,o)&&ot(b,b.data[Rr()],v,v[An],i,v[S+1]=function Lt(i,o){return null==i||""===i||("string"==typeof o?i+=o:"object"==typeof i&&(i=Et($l(i)))),i}(o,l),m,S)}(i,o,null,!0),D}function R(i){J(_t,O,i,!1)}function O(i,o){for(let l=function bg(i){return t(i),Up(i,e(i,0,xs.textEnd))}(o);l>=0;l=Up(o,l))_t(i,Np(o),wg(o))}function B(i){J(a,V,i,!0)}function V(i,o){for(let l=function ey(i){return t(i),nf(i,e(i,0,xs.textEnd))}(o);l>=0;l=nf(o,l))a(i,Np(o),!0)}function J(i,o,l,m){const v=sr(),b=Q(2);v.firstUpdatePass&&xe(v,null,b,m);const S=zt();if(l!==Er&&Qo(S,b,l)){const L=v.data[Rr()];if(Vt(L,m)&&!ce(v,b)){let z=m?L.classesWithoutHost:L.stylesWithoutHost;null!==z&&(l=jn(z,l||"")),bp(v,L,S,l,m)}else!function jt(i,o,l,m,v,b,S,L){v===Er&&(v=pe);let z=0,Z=0,ae=0<v.length?v[0]:null,Te=0<b.length?b[0]:null;for(;null!==ae||null!==Te;){const Ve=z<v.length?v[z+1]:void 0,tt=Z<b.length?b[Z+1]:void 0;let rn,Mt=null;ae===Te?(z+=2,Z+=2,Ve!==tt&&(Mt=Te,rn=tt)):null===Te||null!==ae&&ae<Te?(z+=2,Mt=ae):(Z+=2,Mt=Te,rn=tt),null!==Mt&&ot(i,o,l,m,Mt,rn,S,L),ae=z<v.length?v[z]:null,Te=Z<b.length?b[Z]:null}}(v,L,S,S[An],S[b+1],S[b+1]=function Ze(i,o,l){if(null==l||""===l)return pe;const m=[],v=$l(l);if(Array.isArray(v))for(let b=0;b<v.length;b++)i(m,v[b],!0);else if("object"==typeof v)for(const b in v)v.hasOwnProperty(b)&&i(m,b,v[b]);else"string"==typeof v&&o(m,v);return m}(i,o,l),m,b)}}function ce(i,o){return o>=i.expandoStartIndex}function xe(i,o,l,m){const v=i.data;if(null===v[l+1]){const b=v[Rr()],S=ce(i,l);Vt(b,m)&&null===o&&!S&&(o=!1),o=function Me(i,o,l,m){const v=function Oe(i){const o=nr.lFrame.currentDirectiveIndex;return-1===o?null:i[o]}(i);let b=m?o.residualClasses:o.residualStyles;if(null===v)0===(m?o.classBindings:o.styleBindings)&&(l=Ke(l=Pe(null,i,o,l,m),o.attrs,m),b=null);else{const S=o.directiveStylingLast;if(-1===S||i[S]!==v)if(l=Pe(v,i,o,l,m),null===b){let z=function ve(i,o,l){const m=l?o.classBindings:o.styleBindings;if(0!==Cc(m))return i[Ka(m)]}(i,o,m);void 0!==z&&Array.isArray(z)&&(z=Pe(null,i,o,z[1],m),z=Ke(z,o.attrs,m),function Se(i,o,l,m){i[Ka(l?o.classBindings:o.styleBindings)]=m}(i,o,m,z))}else b=function Le(i,o,l){let m;const v=o.directiveEnd;for(let b=1+o.directiveStylingLast;b<v;b++)m=Ke(m,i[b].hostAttrs,l);return Ke(m,o.attrs,l)}(i,o,m)}return void 0!==b&&(m?o.residualClasses=b:o.residualStyles=b),l}(v,b,o,m),function rd(i,o,l,m,v,b){let S=b?o.classBindings:o.styleBindings,L=Ka(S),z=Cc(S);i[m]=l;let ae,Z=!1;if(Array.isArray(l)?(ae=l[1],(null===ae||d(l,ae)>0)&&(Z=!0)):ae=l,v)if(0!==z){const Ve=Ka(i[L+1]);i[m+1]=ef(Ve,L),0!==Ve&&(i[Ve+1]=nd(i[Ve+1],m)),i[L+1]=function zp(i,o){return 131071&i|o<<17}(i[L+1],m)}else i[m+1]=ef(L,0),0!==L&&(i[L+1]=nd(i[L+1],m)),L=m;else i[m+1]=ef(z,0),0===L?L=m:i[z+1]=nd(i[z+1],m),z=m;Z&&(i[m+1]=fl(i[m+1])),Bp(i,ae,m,!0),Bp(i,ae,m,!1),function tf(i,o,l,m,v){const b=v?i.residualClasses:i.residualStyles;null!=b&&"string"==typeof o&&d(b,o)>=0&&(l[m+1]=Sc(l[m+1]))}(o,ae,i,m,b),S=ef(L,z),b?o.classBindings=S:o.styleBindings=S}(v,b,o,l,S,m)}}function Pe(i,o,l,m,v){let b=null;const S=l.directiveEnd;let L=l.directiveStylingLast;for(-1===L?L=l.directiveStart:L++;L<S&&(b=o[L],m=Ke(m,b.hostAttrs,v),b!==i);)L++;return null!==i&&(l.directiveStylingLast=L),m}function Ke(i,o,l){const m=l?1:2;let v=-1;if(null!==o)for(let b=0;b<o.length;b++){const S=o[b];"number"==typeof S?v=S:v===m&&(Array.isArray(i)||(i=void 0===i?[]:["",i]),a(i,S,!!l||o[++b]))}return void 0===i?null:i}function _t(i,o,l){a(i,o,$l(l))}function ot(i,o,l,m,v,b,S,L){if(!(3&o.type))return;const z=i.data,Z=z[L+1],ae=function kl(i){return 1==(1&i)}(Z)?vt(z,o,l,v,Cc(Z),S):void 0;wt(ae)||(wt(b)||function Fp(i){return 2==(2&i)}(Z)&&(b=vt(z,null,l,v,L,S)),function wh(i,o,l,m,v){if(o)v?i.addClass(l,m):i.removeClass(l,m);else{let b=-1===m.indexOf("-")?void 0:qs.DashCase;null==v?i.removeStyle(l,m,b):("string"==typeof v&&v.endsWith("!important")&&(v=v.slice(0,-10),b|=qs.Important),i.setStyle(l,m,v,b))}}(m,S,ls(Rr(),l),v,b))}function vt(i,o,l,m,v,b){const S=null===o;let L;for(;v>0;){const z=i[v],Z=Array.isArray(z),ae=Z?z[1]:z,Te=null===ae;let Ve=l[v+1];Ve===Er&&(Ve=Te?pe:void 0);let tt=Te?f(Ve,m):ae===m?Ve:void 0;if(Z&&!wt(tt)&&(tt=f(z,m)),wt(tt)&&(L=tt,S))return L;const Mt=i[v+1];v=S?Ka(Mt):Cc(Mt)}if(null!==o){let z=b?o.residualClasses:o.residualStyles;null!=z&&(L=f(z,m))}return L}function wt(i){return void 0!==i}function Vt(i,o){return 0!=(i.flags&(o?8:16))}function st(i,o=""){const l=zt(),m=sr(),v=i+Hr,b=m.firstCreatePass?Ku(m,v,1,o,null):m.data[v],S=l[v]=function cu(i,o){return i.createText(o)}(l[An],o);yh(m,l,S,b),Ro(b,!1)}function tn(i){return Bn("",i,""),tn}function Bn(i,o,l){const m=zt(),v=bc(m,i,o,l);return v!==Er&&function Zl(i,o,l){const m=ls(o,i);!function uu(i,o,l){i.setValue(o,l)}(i[An],m,l)}(m,Rr(),v),Bn}const Qc=void 0;var Gp=["en",[["a","p"],["AM","PM"],Qc],[["AM","PM"],Qc,Qc],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],Qc,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],Qc,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",Qc,"{1} 'at' {0}",Qc],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function $p(i){const l=Math.floor(Math.abs(i)),m=i.toString().replace(/^[^.]*\.?/,"").length;return 1===l&&0===m?1:5}];let va={};function Mc(i){const o=function La(i){return i.toLowerCase().replace(/_/g,"-")}(i);let l=Ic(o);if(l)return l;const m=o.split("-")[0];if(l=Ic(m),l)return l;if("en"===m)return Gp;throw new Je(701,!1)}function rf(i){return Mc(i)[hr.PluralCase]}function Ic(i){return i in va||(va[i]=dr.ng&&dr.ng.common&&dr.ng.common.locales&&dr.ng.common.locales[i]),va[i]}var hr=(()=>((hr=hr||{})[hr.LocaleId=0]="LocaleId",hr[hr.DayPeriodsFormat=1]="DayPeriodsFormat",hr[hr.DayPeriodsStandalone=2]="DayPeriodsStandalone",hr[hr.DaysFormat=3]="DaysFormat",hr[hr.DaysStandalone=4]="DaysStandalone",hr[hr.MonthsFormat=5]="MonthsFormat",hr[hr.MonthsStandalone=6]="MonthsStandalone",hr[hr.Eras=7]="Eras",hr[hr.FirstDayOfWeek=8]="FirstDayOfWeek",hr[hr.WeekendRange=9]="WeekendRange",hr[hr.DateFormat=10]="DateFormat",hr[hr.TimeFormat=11]="TimeFormat",hr[hr.DateTimeFormat=12]="DateTimeFormat",hr[hr.NumberSymbols=13]="NumberSymbols",hr[hr.NumberFormats=14]="NumberFormats",hr[hr.CurrencyCode=15]="CurrencyCode",hr[hr.CurrencySymbol=16]="CurrencySymbol",hr[hr.CurrencyName=17]="CurrencyName",hr[hr.Currencies=18]="Currencies",hr[hr.Directionality=19]="Directionality",hr[hr.PluralCase=20]="PluralCase",hr[hr.ExtraData=21]="ExtraData",hr))();const eu="en-US";let Vy=eu;function iy(i,o,l,m,v){if(i=Qt(i),Array.isArray(i))for(let b=0;b<i.length;b++)iy(i[b],o,l,m,v);else{const b=sr(),S=zt();let L=mc(i)?i:Qt(i.provide),z=Rm(i);const Z=Oi(),ae=1048575&Z.providerIndexes,Te=Z.directiveStart,Ve=Z.providerIndexes>>20;if(mc(i)||!i.multi){const tt=new We(z,v,vc),Mt=sy(L,o,v?ae:ae+Ve,Te);-1===Mt?(_l(Fl(Z,S),b,L),oy(b,i,o.length),o.push(L),Z.directiveStart++,Z.directiveEnd++,v&&(Z.providerIndexes+=1048576),l.push(tt),S.push(tt)):(l[Mt]=tt,S[Mt]=tt)}else{const tt=sy(L,o,ae+Ve,Te),Mt=sy(L,o,ae,ae+Ve),Tn=Mt>=0&&l[Mt];if(v&&!Tn||!v&&!(tt>=0&&l[tt])){_l(Fl(Z,S),b,L);const Fn=function zx(i,o,l,m,v){const b=new We(i,l,vc);return b.multi=[],b.index=o,b.componentProviders=0,fv(b,v,m&&!l),b}(v?Fx:Ox,l.length,v,m,z);!v&&Tn&&(l[Mt].providerFactory=Fn),oy(b,i,o.length,0),o.push(L),Z.directiveStart++,Z.directiveEnd++,v&&(Z.providerIndexes+=1048576),l.push(Fn),S.push(Fn)}else oy(b,i,tt>-1?tt:Mt,fv(l[v?Mt:tt],z,!v&&m));!v&&m&&Tn&&l[Mt].componentProviders++}}}function oy(i,o,l,m){const v=mc(o),b=function e_(i){return!!i.useClass}(o);if(v||b){const z=(b?Qt(o.useClass):o).prototype.ngOnDestroy;if(z){const Z=i.destroyHooks||(i.destroyHooks=[]);if(!v&&o.multi){const ae=Z.indexOf(l);-1===ae?Z.push(l,[m,z]):Z[ae+1].push(m,z)}else Z.push(l,z)}}}function fv(i,o,l){return l&&i.componentProviders++,i.multi.push(o)-1}function sy(i,o,l,m){for(let v=l;v<m;v++)if(o[v]===i)return v;return-1}function Ox(i,o,l,m){return ay(this.multi,[])}function Fx(i,o,l,m){const v=this.multi;let b;if(this.providerFactory){const S=this.providerFactory.componentProviders,L=rl(l,l[Ot],this.providerFactory.index,m);b=L.slice(0,S),ay(v,b);for(let z=S;z<L.length;z++)b.push(L[z])}else b=[],ay(v,b);return b}function ay(i,o){for(let l=0;l<i.length;l++)o.push((0,i[l])());return o}function pv(i,o=[]){return l=>{l.providersResolver=(m,v)=>function Lx(i,o,l){const m=sr();if(m.firstCreatePass){const v=eo(i);iy(l,m.data,m.blueprint,v,!0),iy(o,m.data,m.blueprint,v,!1)}}(m,v?v(i):i,o)}}class sf{}class mv{}function Bx(i,o){return new gv(i,o??null)}class gv extends sf{constructor(o,l){super(),this._parent=l,this._bootstrapComponents=[],this.destroyCbs=[],this.componentFactoryResolver=new ig(this);const m=Gr(o);this._bootstrapComponents=Hl(m.bootstrap),this._r3Injector=Bh(o,l,[{provide:sf,useValue:this},{provide:Fs,useValue:this.componentFactoryResolver}],Et(o),new Set(["environment"])),this._r3Injector.resolveInjectorInitializers(),this.instance=this._r3Injector.get(o)}get injector(){return this._r3Injector}destroy(){const o=this._r3Injector;!o.destroyed&&o.destroy(),this.destroyCbs.forEach(l=>l()),this.destroyCbs=null}onDestroy(o){this.destroyCbs.push(o)}}class ly extends mv{constructor(o){super(),this.moduleType=o}create(o){return new gv(this.moduleType,o)}}class Nx extends sf{constructor(o,l,m){super(),this.componentFactoryResolver=new ig(this),this.instance=null;const v=new _u([...o,{provide:sf,useValue:this},{provide:Fs,useValue:this.componentFactoryResolver}],l||kh(),m,new Set(["environment"]));this.injector=v,v.resolveInjectorInitializers()}destroy(){this.injector.destroy()}onDestroy(o){this.injector.onDestroy(o)}}function cy(i,o,l=null){return new Nx(i,o,l).injector}let Ux=(()=>{class i{constructor(l){this._injector=l,this.cachedInjectors=new Map}getOrCreateStandaloneInjector(l){if(!l.standalone)return null;if(!this.cachedInjectors.has(l.id)){const m=Gl(0,l.type),v=m.length>0?cy([m],this._injector,`Standalone[${l.type.name}]`):null;this.cachedInjectors.set(l.id,v)}return this.cachedInjectors.get(l.id)}ngOnDestroy(){try{for(const l of this.cachedInjectors.values())null!==l&&l.destroy()}finally{this.cachedInjectors.clear()}}}return i.\u0275prov=bn({token:i,providedIn:"environment",factory:()=>new i(Re(gu))}),i})();function _v(i){i.getStandaloneInjector=o=>o.get(Ux).getOrCreateStandaloneInjector(i)}function Tv(i,o,l){const m=Zi()+i,v=zt();return v[m]===Er?ka(v,m,l?o.call(l):o()):wc(v,m)}function Dv(i,o,l,m){return function Av(i,o,l,m,v,b){const S=o+l;return Qo(i,S,v)?ka(i,S+1,b?m.call(b,v):m(v)):Kp(i,S+1)}(zt(),Zi(),i,o,l,m)}function Cv(i,o,l,m,v){return function Pv(i,o,l,m,v,b,S){const L=o+l;return Pl(i,L,v,b)?ka(i,L+2,S?m.call(S,v,b):m(v,b)):Kp(i,L+2)}(zt(),Zi(),i,o,l,m,v)}function Sv(i,o,l,m,v,b,S){return function kv(i,o,l,m,v,b,S,L,z){const Z=o+l;return hl(i,Z,v,b,S,L)?ka(i,Z+4,z?m.call(z,v,b,S,L):m(v,b,S,L)):Kp(i,Z+4)}(zt(),Zi(),i,o,l,m,v,b,S)}function Mv(i,o,l,m,v,b,S,L){const z=Zi()+i,Z=zt(),ae=hl(Z,z,l,m,v,b);return Qo(Z,z+4,S)||ae?ka(Z,z+5,L?o.call(L,l,m,v,b,S):o(l,m,v,b,S)):wc(Z,z+5)}function Iv(i,o,l,m,v,b,S,L,z){const Z=Zi()+i,ae=zt(),Te=hl(ae,Z,l,m,v,b);return Pl(ae,Z+4,S,L)||Te?ka(ae,Z+6,z?o.call(z,l,m,v,b,S,L):o(l,m,v,b,S,L)):wc(ae,Z+6)}function Kp(i,o){const l=i[o];return l===Er?void 0:l}function hy(i){return o=>{setTimeout(i,void 0,o)}}const tu=class sw extends W.x{constructor(o=!1){super(),this.__isAsync=o}emit(o){super.next(o)}subscribe(o,l,m){let v=o,b=l||(()=>null),S=m;if(o&&"object"==typeof o){const z=o;v=z.next?.bind(z),b=z.error?.bind(z),S=z.complete?.bind(z)}this.__isAsync&&(b=hy(b),v&&(v=hy(v)),S&&(S=hy(S)));const L=super.subscribe({next:v,error:b,complete:S});return o instanceof _e.w0&&o.add(L),L}};function aw(){return this._results[Symbol.iterator]()}class dy{get changes(){return this._changes||(this._changes=new tu)}constructor(o=!1){this._emitDistinctChangesOnly=o,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const l=dy.prototype;l[Symbol.iterator]||(l[Symbol.iterator]=aw)}get(o){return this._results[o]}map(o){return this._results.map(o)}filter(o){return this._results.filter(o)}find(o){return this._results.find(o)}reduce(o,l){return this._results.reduce(o,l)}forEach(o){this._results.forEach(o)}some(o){return this._results.some(o)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(o,l){const m=this;m.dirty=!1;const v=function Ws(i){return i.flat(Number.POSITIVE_INFINITY)}(o);(this._changesDetected=!function su(i,o,l){if(i.length!==o.length)return!1;for(let m=0;m<i.length;m++){let v=i[m],b=o[m];if(l&&(v=l(v),b=l(b)),b!==v)return!1}return!0}(m._results,v,l))&&(m._results=v,m.length=v.length,m.last=v[this.length-1],m.first=v[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}let Jp=(()=>{class i{}return i.__NG_ELEMENT_ID__=uw,i})();const lw=Jp,cw=class extends lw{constructor(o,l,m){super(),this._declarationLView=o,this._declarationTContainer=l,this.elementRef=m}createEmbeddedView(o,l){const m=this._declarationTContainer.tView,v=Ld(this._declarationLView,m,o,16,null,m.declTNode,null,null,null,null,l||null);v[ao]=this._declarationLView[this._declarationTContainer.index];const S=this._declarationLView[lo];return null!==S&&(v[lo]=S.createEmbeddedView(m)),Od(m,v,o),new eh(v)}};function uw(){return Ig(Oi(),zt())}function Ig(i,o){return 4&i.type?new cw(o,i,qc(i,o)):null}let Ag=(()=>{class i{}return i.__NG_ELEMENT_ID__=hw,i})();function hw(){return zv(Oi(),zt())}const dw=Ag,Ov=class extends dw{constructor(o,l,m){super(),this._lContainer=o,this._hostTNode=l,this._hostLView=m}get element(){return qc(this._hostTNode,this._hostLView)}get injector(){return new Bl(this._hostTNode,this._hostLView)}get parentInjector(){const o=kc(this._hostTNode,this._hostLView);if(Ca(o)){const l=ro(o,this._hostLView),m=Sa(o);return new Bl(l[Ot].data[m+8],l)}return new Bl(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(o){const l=Fv(this._lContainer);return null!==l&&l[o]||null}get length(){return this._lContainer.length-Ni}createEmbeddedView(o,l,m){let v,b;"number"==typeof m?v=m:null!=m&&(v=m.index,b=m.injector);const S=o.createEmbeddedView(l||{},b);return this.insert(S,v),S}createComponent(o,l,m,v,b){const S=o&&!function Ul(i){return"function"==typeof i}(o);let L;if(S)L=l;else{const Te=l||{};L=Te.index,m=Te.injector,v=Te.projectableNodes,b=Te.environmentInjector||Te.ngModuleRef}const z=S?o:new th(qn(o)),Z=m||this.parentInjector;if(!b&&null==z.ngModule){const Ve=(S?Z:this.parentInjector).get(gu,null);Ve&&(b=Ve)}const ae=z.create(Z,v,void 0,b);return this.insert(ae.hostView,L),ae}insert(o,l){const m=o._lView,v=m[Ot];if(function el(i){return Wr(i[Ur])}(m)){const ae=this.indexOf(o);if(-1!==ae)this.detach(ae);else{const Te=m[Ur],Ve=new Ov(Te,Te[Jr],Te[Ur]);Ve.detach(Ve.indexOf(o))}}const b=this._adjustIndex(l),S=this._lContainer;!function Ug(i,o,l,m){const v=Ni+m,b=l.length;m>0&&(l[v-1][Nn]=o),m<b-Ni?(o[Nn]=l[v],au(l,Ni+m,o)):(l.push(o),o[Nn]=null),o[Ur]=l;const S=o[ao];null!==S&&l!==S&&function jg(i,o){const l=i[ii];o[li]!==o[Ur][Ur][li]&&(i[co]=!0),null===l?i[ii]=[o]:l.push(o)}(S,o);const L=o[lo];null!==L&&L.insertView(i),o[Gn]|=64}(v,m,S,b);const L=xh(b,S),z=m[An],Z=Aa(z,S[Ns]);return null!==Z&&function jc(i,o,l,m,v,b){m[On]=v,m[Jr]=o,Vl(i,m,l,1,v,b)}(v,S[Jr],z,m,Z,L),o.attachToViewContainerRef(),au(fy(S),b,o),o}move(o,l){return this.insert(o,l)}indexOf(o){const l=Fv(this._lContainer);return null!==l?l.indexOf(o):-1}remove(o){const l=this._adjustIndex(o,-1),m=hd(this._lContainer,l);m&&(lc(fy(this._lContainer),l),ph(m[Ot],m))}detach(o){const l=this._adjustIndex(o,-1),m=hd(this._lContainer,l);return m&&null!=lc(fy(this._lContainer),l)?new eh(m):null}_adjustIndex(o,l=0){return o??this.length+l}};function Fv(i){return i[Ys]}function fy(i){return i[Ys]||(i[Ys]=[])}function zv(i,o){let l;const m=o[i.index];if(Wr(m))l=m;else{let v;if(8&i.type)v=di(m);else{const b=o[An];v=b.createComment("");const S=Jn(i,o);Ia(b,Aa(b,S),v,function mf(i,o){return i.nextSibling(o)}(b,S),!1)}o[i.index]=l=Bd(m,o,v,i),Ud(o,l)}return new Ov(l,i,o)}class py{constructor(o){this.queryList=o,this.matches=null}clone(){return new py(this.queryList)}setDirty(){this.queryList.setDirty()}}class my{constructor(o=[]){this.queries=o}createEmbeddedView(o){const l=o.queries;if(null!==l){const m=null!==o.contentQueries?o.contentQueries[0]:l.length,v=[];for(let b=0;b<m;b++){const S=l.getByIndex(b);v.push(this.queries[S.indexInDeclarationView].clone())}return new my(v)}return null}insertView(o){this.dirtyQueriesWithMatches(o)}detachView(o){this.dirtyQueriesWithMatches(o)}dirtyQueriesWithMatches(o){for(let l=0;l<this.queries.length;l++)null!==Wv(o,l).matches&&this.queries[l].setDirty()}}class Bv{constructor(o,l,m=null){this.predicate=o,this.flags=l,this.read=m}}class gy{constructor(o=[]){this.queries=o}elementStart(o,l){for(let m=0;m<this.queries.length;m++)this.queries[m].elementStart(o,l)}elementEnd(o){for(let l=0;l<this.queries.length;l++)this.queries[l].elementEnd(o)}embeddedTView(o){let l=null;for(let m=0;m<this.length;m++){const v=null!==l?l.length:0,b=this.getByIndex(m).embeddedTView(o,v);b&&(b.indexInDeclarationView=m,null!==l?l.push(b):l=[b])}return null!==l?new gy(l):null}template(o,l){for(let m=0;m<this.queries.length;m++)this.queries[m].template(o,l)}getByIndex(o){return this.queries[o]}get length(){return this.queries.length}track(o){this.queries.push(o)}}class _y{constructor(o,l=-1){this.metadata=o,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=l}elementStart(o,l){this.isApplyingToNode(l)&&this.matchTNode(o,l)}elementEnd(o){this._declarationNodeIndex===o.index&&(this._appliesToNextNode=!1)}template(o,l){this.elementStart(o,l)}embeddedTView(o,l){return this.isApplyingToNode(o)?(this.crossesNgTemplate=!0,this.addMatch(-o.index,l),new _y(this.metadata)):null}isApplyingToNode(o){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const l=this._declarationNodeIndex;let m=o.parent;for(;null!==m&&8&m.type&&m.index!==l;)m=m.parent;return l===(null!==m?m.index:-1)}return this._appliesToNextNode}matchTNode(o,l){const m=this.metadata.predicate;if(Array.isArray(m))for(let v=0;v<m.length;v++){const b=m[v];this.matchTNodeWithReadOption(o,l,fw(l,b)),this.matchTNodeWithReadOption(o,l,ja(l,o,b,!1,!1))}else m===Jp?4&l.type&&this.matchTNodeWithReadOption(o,l,-1):this.matchTNodeWithReadOption(o,l,ja(l,o,m,!1,!1))}matchTNodeWithReadOption(o,l,m){if(null!==m){const v=this.metadata.read;if(null!==v)if(v===Lh||v===Ag||v===Jp&&4&l.type)this.addMatch(l.index,-2);else{const b=ja(l,o,v,!1,!1);null!==b&&this.addMatch(l.index,b)}else this.addMatch(l.index,m)}}addMatch(o,l){null===this.matches?this.matches=[o,l]:this.matches.push(o,l)}}function fw(i,o){const l=i.localNames;if(null!==l)for(let m=0;m<l.length;m+=2)if(l[m]===o)return l[m+1];return null}function mw(i,o,l,m){return-1===l?function pw(i,o){return 11&i.type?qc(i,o):4&i.type?Ig(i,o):null}(o,i):-2===l?function gw(i,o,l){return l===Lh?qc(o,i):l===Jp?Ig(o,i):l===Ag?zv(o,i):void 0}(i,o,m):rl(i,i[Ot],l,o)}function Nv(i,o,l,m){const v=o[lo].queries[m];if(null===v.matches){const b=i.data,S=l.matches,L=[];for(let z=0;z<S.length;z+=2){const Z=S[z];L.push(Z<0?null:mw(o,b[Z],S[z+1],l.metadata.read))}v.matches=L}return v.matches}function yy(i,o,l,m){const v=i.queries.getByIndex(l),b=v.matches;if(null!==b){const S=Nv(i,o,v,l);for(let L=0;L<b.length;L+=2){const z=b[L];if(z>0)m.push(S[L/2]);else{const Z=b[L+1],ae=o[-z];for(let Te=Ni;Te<ae.length;Te++){const Ve=ae[Te];Ve[ao]===Ve[Ur]&&yy(Ve[Ot],Ve,Z,m)}if(null!==ae[ii]){const Te=ae[ii];for(let Ve=0;Ve<Te.length;Ve++){const tt=Te[Ve];yy(tt[Ot],tt,Z,m)}}}}}return m}function Uv(i){const o=zt(),l=sr(),m=ze();et(m+1);const v=Wv(l,m);if(i.dirty&&function us(i){return 4==(4&i[Gn])}(o)===(2==(2&v.metadata.flags))){if(null===v.matches)i.reset([]);else{const b=v.crossesNgTemplate?yy(l,o,m,[]):Nv(l,o,v,m);i.reset(b,i_),i.notifyOnChanges()}return!0}return!1}function jv(i,o,l){const m=sr();m.firstCreatePass&&(Hv(m,new Bv(i,o,l),-1),2==(2&o)&&(m.staticViewQueries=!0)),Gv(m,zt(),o)}function Vv(i,o,l,m){const v=sr();if(v.firstCreatePass){const b=Oi();Hv(v,new Bv(o,l,m),b.index),function yw(i,o){const l=i.contentQueries||(i.contentQueries=[]);o!==(l.length?l[l.length-1]:-1)&&l.push(i.queries.length-1,o)}(v,i),2==(2&l)&&(v.staticContentQueries=!0)}Gv(v,zt(),l)}function $v(){return function _w(i,o){return i[lo].queries[o].queryList}(zt(),ze())}function Gv(i,o,l){const m=new dy(4==(4&l));Ym(i,o,m,m.destroy),null===o[lo]&&(o[lo]=new my),o[lo].queries.push(new py(m))}function Hv(i,o,l){null===i.queries&&(i.queries=new gy),i.queries.track(new _y(o,l))}function Wv(i,o){return i.queries.getByIndex(o)}function qv(i,o){return Ig(i,o)}function vy(i){return!!Gr(i)}function Rg(...i){}const d0=new fi("Application Initializer");let kg=(()=>{class i{constructor(l){this.appInits=l,this.resolve=Rg,this.reject=Rg,this.initialized=!1,this.done=!1,this.donePromise=new Promise((m,v)=>{this.resolve=m,this.reject=v})}runInitializers(){if(this.initialized)return;const l=[],m=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let v=0;v<this.appInits.length;v++){const b=this.appInits[v]();if(Cp(b))l.push(b);else if(Xa(b)){const S=new Promise((L,z)=>{b.subscribe({complete:L,error:z})});l.push(S)}}Promise.all(l).then(()=>{m()}).catch(v=>{this.reject(v)}),0===l.length&&m(),this.initialized=!0}}return i.\u0275fac=function(l){return new(l||i)(Re(d0,8))},i.\u0275prov=bn({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const f0=new fi("AppId",{providedIn:"root",factory:function p0(){return`${Ty()}${Ty()}${Ty()}`}});function Ty(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const m0=new fi("Platform Initializer"),Bw=new fi("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),Nw=new fi("AnimationModuleType");let Uw=(()=>{class i{log(l){console.log(l)}warn(l){console.warn(l)}}return i.\u0275fac=function(l){return new(l||i)},i.\u0275prov=bn({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();const Lg=new fi("LocaleId",{providedIn:"root",factory:()=>Pt(Lg,yn.Optional|yn.SkipSelf)||function jw(){return typeof $localize<"u"&&$localize.locale||eu}()}),Vw=new fi("DefaultCurrencyCode",{providedIn:"root",factory:()=>"USD"});class $w{constructor(o,l){this.ngModuleFactory=o,this.componentFactories=l}}let Gw=(()=>{class i{compileModuleSync(l){return new ly(l)}compileModuleAsync(l){return Promise.resolve(this.compileModuleSync(l))}compileModuleAndAllComponentsSync(l){const m=this.compileModuleSync(l),b=Hl(Gr(l).declarations).reduce((S,L)=>{const z=qn(L);return z&&S.push(new th(z)),S},[]);return new $w(m,b)}compileModuleAndAllComponentsAsync(l){return Promise.resolve(this.compileModuleAndAllComponentsSync(l))}clearCache(){}clearCacheFor(l){}getModuleId(l){}}return i.\u0275fac=function(l){return new(l||i)},i.\u0275prov=bn({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();const qw=(()=>Promise.resolve(0))();function Dy(i){typeof Zone>"u"?qw.then(()=>{i&&i.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",i)}class Ql{constructor({enableLongStackTrace:o=!1,shouldCoalesceEventChangeDetection:l=!1,shouldCoalesceRunChangeDetection:m=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new tu(!1),this.onMicrotaskEmpty=new tu(!1),this.onStable=new tu(!1),this.onError=new tu(!1),typeof Zone>"u")throw new Je(908,!1);Zone.assertZonePatched();const v=this;v._nesting=0,v._outer=v._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(v._inner=v._inner.fork(new Zone.TaskTrackingZoneSpec)),o&&Zone.longStackTraceZoneSpec&&(v._inner=v._inner.fork(Zone.longStackTraceZoneSpec)),v.shouldCoalesceEventChangeDetection=!m&&l,v.shouldCoalesceRunChangeDetection=m,v.lastRequestAnimationFrameId=-1,v.nativeRequestAnimationFrame=function Zw(){let i=dr.requestAnimationFrame,o=dr.cancelAnimationFrame;if(typeof Zone<"u"&&i&&o){const l=i[Zone.__symbol__("OriginalDelegate")];l&&(i=l);const m=o[Zone.__symbol__("OriginalDelegate")];m&&(o=m)}return{nativeRequestAnimationFrame:i,nativeCancelAnimationFrame:o}}().nativeRequestAnimationFrame,function Yw(i){const o=()=>{!function Kw(i){i.isCheckStableRunning||-1!==i.lastRequestAnimationFrameId||(i.lastRequestAnimationFrameId=i.nativeRequestAnimationFrame.call(dr,()=>{i.fakeTopEventTask||(i.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{i.lastRequestAnimationFrameId=-1,Sy(i),i.isCheckStableRunning=!0,Cy(i),i.isCheckStableRunning=!1},void 0,()=>{},()=>{})),i.fakeTopEventTask.invoke()}),Sy(i))}(i)};i._inner=i._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(l,m,v,b,S,L)=>{try{return y0(i),l.invokeTask(v,b,S,L)}finally{(i.shouldCoalesceEventChangeDetection&&"eventTask"===b.type||i.shouldCoalesceRunChangeDetection)&&o(),v0(i)}},onInvoke:(l,m,v,b,S,L,z)=>{try{return y0(i),l.invoke(v,b,S,L,z)}finally{i.shouldCoalesceRunChangeDetection&&o(),v0(i)}},onHasTask:(l,m,v,b)=>{l.hasTask(v,b),m===v&&("microTask"==b.change?(i._hasPendingMicrotasks=b.microTask,Sy(i),Cy(i)):"macroTask"==b.change&&(i.hasPendingMacrotasks=b.macroTask))},onHandleError:(l,m,v,b)=>(l.handleError(v,b),i.runOutsideAngular(()=>i.onError.emit(b)),!1)})}(v)}static isInAngularZone(){return typeof Zone<"u"&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Ql.isInAngularZone())throw new Je(909,!1)}static assertNotInAngularZone(){if(Ql.isInAngularZone())throw new Je(909,!1)}run(o,l,m){return this._inner.run(o,l,m)}runTask(o,l,m,v){const b=this._inner,S=b.scheduleEventTask("NgZoneEvent: "+v,o,Xw,Rg,Rg);try{return b.runTask(S,l,m)}finally{b.cancelTask(S)}}runGuarded(o,l,m){return this._inner.runGuarded(o,l,m)}runOutsideAngular(o){return this._outer.run(o)}}const Xw={};function Cy(i){if(0==i._nesting&&!i.hasPendingMicrotasks&&!i.isStable)try{i._nesting++,i.onMicrotaskEmpty.emit(null)}finally{if(i._nesting--,!i.hasPendingMicrotasks)try{i.runOutsideAngular(()=>i.onStable.emit(null))}finally{i.isStable=!0}}}function Sy(i){i.hasPendingMicrotasks=!!(i._hasPendingMicrotasks||(i.shouldCoalesceEventChangeDetection||i.shouldCoalesceRunChangeDetection)&&-1!==i.lastRequestAnimationFrameId)}function y0(i){i._nesting++,i.isStable&&(i.isStable=!1,i.onUnstable.emit(null))}function v0(i){i._nesting--,Cy(i)}class Jw{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new tu,this.onMicrotaskEmpty=new tu,this.onStable=new tu,this.onError=new tu}run(o,l,m){return o.apply(l,m)}runGuarded(o,l,m){return o.apply(l,m)}runOutsideAngular(o){return o()}runTask(o,l,m,v){return o.apply(l,m)}}const x0=new fi(""),w0=new fi("");let My,Qw=(()=>{class i{constructor(l,m,v){this._ngZone=l,this.registry=m,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,My||(function eb(i){My=i}(v),v.addToWindow(m)),this._watchAngularEvents(),l.run(()=>{this.taskTrackingZone=typeof Zone>"u"?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Ql.assertNotInAngularZone(),Dy(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Dy(()=>{for(;0!==this._callbacks.length;){let l=this._callbacks.pop();clearTimeout(l.timeoutId),l.doneCb(this._didWork)}this._didWork=!1});else{let l=this.getPendingTasks();this._callbacks=this._callbacks.filter(m=>!m.updateCb||!m.updateCb(l)||(clearTimeout(m.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(l=>({source:l.source,creationLocation:l.creationLocation,data:l.data})):[]}addCallback(l,m,v){let b=-1;m&&m>0&&(b=setTimeout(()=>{this._callbacks=this._callbacks.filter(S=>S.timeoutId!==b),l(this._didWork,this.getPendingTasks())},m)),this._callbacks.push({doneCb:l,timeoutId:b,updateCb:v})}whenStable(l,m,v){if(v&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(l,m,v),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}registerApplication(l){this.registry.registerApplication(l,this)}unregisterApplication(l){this.registry.unregisterApplication(l)}findProviders(l,m,v){return[]}}return i.\u0275fac=function(l){return new(l||i)(Re(Ql),Re(b0),Re(w0))},i.\u0275prov=bn({token:i,factory:i.\u0275fac}),i})(),b0=(()=>{class i{constructor(){this._applications=new Map}registerApplication(l,m){this._applications.set(l,m)}unregisterApplication(l){this._applications.delete(l)}unregisterAllApplications(){this._applications.clear()}getTestability(l){return this._applications.get(l)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(l,m=!0){return My?.findTestabilityInTree(this,l,m)??null}}return i.\u0275fac=function(l){return new(l||i)},i.\u0275prov=bn({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();const Au=!1;let uh=null;const E0=new fi("AllowMultipleToken"),Iy=new fi("PlatformDestroyListeners"),T0=new fi("appBootstrapListener");class rb{constructor(o,l){this.name=o,this.token=l}}function C0(i,o,l=[]){const m=`Platform: ${o}`,v=new fi(m);return(b=[])=>{let S=Ay();if(!S||S.injector.get(E0,!1)){const L=[...l,...b,{provide:v,useValue:!0}];i?i(L):function ib(i){if(uh&&!uh.get(E0,!1))throw new Je(400,!1);uh=i;const o=i.get(M0);(function D0(i){const o=i.get(m0,null);o&&o.forEach(l=>l())})(i)}(function S0(i=[],o){return Wl.create({name:o,providers:[{provide:Ph,useValue:"platform"},{provide:Iy,useValue:new Set([()=>uh=null])},...i]})}(L,m))}return function sb(i){const o=Ay();if(!o)throw new Je(401,!1);return o}()}}function Ay(){return uh?.get(M0)??null}let M0=(()=>{class i{constructor(l){this._injector=l,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(l,m){const v=function A0(i,o){let l;return l="noop"===i?new Jw:("zone.js"===i?void 0:i)||new Ql(o),l}(m?.ngZone,function I0(i){return{enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!(!i||!i.ngZoneEventCoalescing)||!1,shouldCoalesceRunChangeDetection:!(!i||!i.ngZoneRunCoalescing)||!1}}(m)),b=[{provide:Ql,useValue:v}];return v.run(()=>{const S=Wl.create({providers:b,parent:this.injector,name:l.moduleType.name}),L=l.create(S),z=L.injector.get(Fh,null);if(!z)throw new Je(402,!1);return v.runOutsideAngular(()=>{const Z=v.onError.subscribe({next:ae=>{z.handleError(ae)}});L.onDestroy(()=>{Fg(this._modules,L),Z.unsubscribe()})}),function P0(i,o,l){try{const m=l();return Cp(m)?m.catch(v=>{throw o.runOutsideAngular(()=>i.handleError(v)),v}):m}catch(m){throw o.runOutsideAngular(()=>i.handleError(m)),m}}(z,v,()=>{const Z=L.injector.get(kg);return Z.runInitializers(),Z.donePromise.then(()=>(function $y(i){In(i,"Expected localeId to be defined"),"string"==typeof i&&(Vy=i.toLowerCase().replace(/_/g,"-"))}(L.injector.get(Lg,eu)||eu),this._moduleDoBootstrap(L),L))})})}bootstrapModule(l,m=[]){const v=R0({},m);return function tb(i,o,l){const m=new ly(l);return Promise.resolve(m)}(0,0,l).then(b=>this.bootstrapModuleFactory(b,v))}_moduleDoBootstrap(l){const m=l.injector.get(Og);if(l._bootstrapComponents.length>0)l._bootstrapComponents.forEach(v=>m.bootstrap(v));else{if(!l.instance.ngDoBootstrap)throw new Je(-403,!1);l.instance.ngDoBootstrap(m)}this._modules.push(l)}onDestroy(l){this._destroyListeners.push(l)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Je(404,!1);this._modules.slice().forEach(m=>m.destroy()),this._destroyListeners.forEach(m=>m());const l=this._injector.get(Iy,null);l&&(l.forEach(m=>m()),l.clear()),this._destroyed=!0}get destroyed(){return this._destroyed}}return i.\u0275fac=function(l){return new(l||i)(Re(Wl))},i.\u0275prov=bn({token:i,factory:i.\u0275fac,providedIn:"platform"}),i})();function R0(i,o){return Array.isArray(o)?o.reduce(R0,i):{...i,...o}}let Og=(()=>{class i{get destroyed(){return this._destroyed}get injector(){return this._injector}constructor(l,m,v){this._zone=l,this._injector=m,this._exceptionHandler=v,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this._destroyed=!1,this._destroyListeners=[],this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const b=new $e.y(L=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{L.next(this._stable),L.complete()})}),S=new $e.y(L=>{let z;this._zone.runOutsideAngular(()=>{z=this._zone.onStable.subscribe(()=>{Ql.assertNotInAngularZone(),Dy(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,L.next(!0))})})});const Z=this._zone.onUnstable.subscribe(()=>{Ql.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{L.next(!1)}))});return()=>{z.unsubscribe(),Z.unsubscribe()}});this.isStable=(0,u.T)(b,S.pipe(function bt(i={}){const{connector:o=(()=>new W.x),resetOnError:l=!0,resetOnComplete:m=!0,resetOnRefCountZero:v=!0}=i;return b=>{let S,L,z,Z=0,ae=!1,Te=!1;const Ve=()=>{L?.unsubscribe(),L=void 0},tt=()=>{Ve(),S=z=void 0,ae=Te=!1},Mt=()=>{const rn=S;tt(),rn?.unsubscribe()};return(0,Ut.e)((rn,Tn)=>{Z++,!Te&&!ae&&Ve();const Fn=z=z??o();Tn.add(()=>{Z--,0===Z&&!Te&&!ae&&(L=gt(Mt,v))}),Fn.subscribe(Tn),!S&&Z>0&&(S=new Kt.Hp({next:lr=>Fn.next(lr),error:lr=>{Te=!0,Ve(),L=gt(tt,l,lr),Fn.error(lr)},complete:()=>{ae=!0,Ve(),L=gt(tt,m),Fn.complete()}}),(0,Ie.Xf)(rn).subscribe(S))})(b)}}()))}bootstrap(l,m){const v=l instanceof Lf;if(!this._injector.get(kg).done){!v&&ai(l);throw new Je(405,Au)}let S;S=v?l:this._injector.get(Fs).resolveComponentFactory(l),this.componentTypes.push(S.componentType);const L=function nb(i){return i.isBoundToModule}(S)?void 0:this._injector.get(sf),Z=S.create(Wl.NULL,[],m||S.selector,L),ae=Z.location.nativeElement,Te=Z.injector.get(x0,null);return Te?.registerApplication(ae),Z.onDestroy(()=>{this.detachView(Z.hostView),Fg(this.components,Z),Te?.unregisterApplication(ae)}),this._loadComponent(Z),Z}tick(){if(this._runningTick)throw new Je(101,!1);try{this._runningTick=!0;for(let l of this._views)l.detectChanges()}catch(l){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(l))}finally{this._runningTick=!1}}attachView(l){const m=l;this._views.push(m),m.attachToAppRef(this)}detachView(l){const m=l;Fg(this._views,m),m.detachFromAppRef()}_loadComponent(l){this.attachView(l.hostView),this.tick(),this.components.push(l);const m=this._injector.get(T0,[]);m.push(...this._bootstrapListeners),m.forEach(v=>v(l))}ngOnDestroy(){if(!this._destroyed)try{this._destroyListeners.forEach(l=>l()),this._views.slice().forEach(l=>l.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}finally{this._destroyed=!0,this._views=[],this._bootstrapListeners=[],this._destroyListeners=[]}}onDestroy(l){return this._destroyListeners.push(l),()=>Fg(this._destroyListeners,l)}destroy(){if(this._destroyed)throw new Je(406,!1);const l=this._injector;l.destroy&&!l.destroyed&&l.destroy()}get viewCount(){return this._views.length}warnIfDestroyed(){}}return i.\u0275fac=function(l){return new(l||i)(Re(Ql),Re(gu),Re(Fh))},i.\u0275prov=bn({token:i,factory:i.\u0275fac,providedIn:"root"}),i})();function Fg(i,o){const l=i.indexOf(o);l>-1&&i.splice(l,1)}let lb=(()=>{class i{}return i.__NG_ELEMENT_ID__=cb,i})();function cb(i){return function ub(i,o,l){if(Wo(i)&&!l){const m=ei(i.index,o);return new eh(m,m)}return 47&i.type?new eh(o[li],o):null}(Oi(),zt(),16==(16&i))}class z0{constructor(){}supports(o){return Xh(o)}create(o){return new gb(o)}}const mb=(i,o)=>o;class gb{constructor(o){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=o||mb}forEachItem(o){let l;for(l=this._itHead;null!==l;l=l._next)o(l)}forEachOperation(o){let l=this._itHead,m=this._removalsHead,v=0,b=null;for(;l||m;){const S=!m||l&&l.currentIndex<N0(m,v,b)?l:m,L=N0(S,v,b),z=S.currentIndex;if(S===m)v--,m=m._nextRemoved;else if(l=l._next,null==S.previousIndex)v++;else{b||(b=[]);const Z=L-v,ae=z-v;if(Z!=ae){for(let Ve=0;Ve<Z;Ve++){const tt=Ve<b.length?b[Ve]:b[Ve]=0,Mt=tt+Ve;ae<=Mt&&Mt<Z&&(b[Ve]=tt+1)}b[S.previousIndex]=ae-Z}}L!==z&&o(S,L,z)}}forEachPreviousItem(o){let l;for(l=this._previousItHead;null!==l;l=l._nextPrevious)o(l)}forEachAddedItem(o){let l;for(l=this._additionsHead;null!==l;l=l._nextAdded)o(l)}forEachMovedItem(o){let l;for(l=this._movesHead;null!==l;l=l._nextMoved)o(l)}forEachRemovedItem(o){let l;for(l=this._removalsHead;null!==l;l=l._nextRemoved)o(l)}forEachIdentityChange(o){let l;for(l=this._identityChangesHead;null!==l;l=l._nextIdentityChange)o(l)}diff(o){if(null==o&&(o=[]),!Xh(o))throw new Je(900,!1);return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let v,b,S,l=this._itHead,m=!1;if(Array.isArray(o)){this.length=o.length;for(let L=0;L<this.length;L++)b=o[L],S=this._trackByFn(L,b),null!==l&&Object.is(l.trackById,S)?(m&&(l=this._verifyReinsertion(l,b,S,L)),Object.is(l.item,b)||this._addIdentityChange(l,b)):(l=this._mismatch(l,b,S,L),m=!0),l=l._next}else v=0,function Z_(i,o){if(Array.isArray(i))for(let l=0;l<i.length;l++)o(i[l]);else{const l=i[Symbol.iterator]();let m;for(;!(m=l.next()).done;)o(m.value)}}(o,L=>{S=this._trackByFn(v,L),null!==l&&Object.is(l.trackById,S)?(m&&(l=this._verifyReinsertion(l,L,S,v)),Object.is(l.item,L)||this._addIdentityChange(l,L)):(l=this._mismatch(l,L,S,v),m=!0),l=l._next,v++}),this.length=v;return this._truncate(l),this.collection=o,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let o;for(o=this._previousItHead=this._itHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._additionsHead;null!==o;o=o._nextAdded)o.previousIndex=o.currentIndex;for(this._additionsHead=this._additionsTail=null,o=this._movesHead;null!==o;o=o._nextMoved)o.previousIndex=o.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(o,l,m,v){let b;return null===o?b=this._itTail:(b=o._prev,this._remove(o)),null!==(o=null===this._unlinkedRecords?null:this._unlinkedRecords.get(m,null))?(Object.is(o.item,l)||this._addIdentityChange(o,l),this._reinsertAfter(o,b,v)):null!==(o=null===this._linkedRecords?null:this._linkedRecords.get(m,v))?(Object.is(o.item,l)||this._addIdentityChange(o,l),this._moveAfter(o,b,v)):o=this._addAfter(new _b(l,m),b,v),o}_verifyReinsertion(o,l,m,v){let b=null===this._unlinkedRecords?null:this._unlinkedRecords.get(m,null);return null!==b?o=this._reinsertAfter(b,o._prev,v):o.currentIndex!=v&&(o.currentIndex=v,this._addToMoves(o,v)),o}_truncate(o){for(;null!==o;){const l=o._next;this._addToRemovals(this._unlink(o)),o=l}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(o,l,m){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(o);const v=o._prevRemoved,b=o._nextRemoved;return null===v?this._removalsHead=b:v._nextRemoved=b,null===b?this._removalsTail=v:b._prevRemoved=v,this._insertAfter(o,l,m),this._addToMoves(o,m),o}_moveAfter(o,l,m){return this._unlink(o),this._insertAfter(o,l,m),this._addToMoves(o,m),o}_addAfter(o,l,m){return this._insertAfter(o,l,m),this._additionsTail=null===this._additionsTail?this._additionsHead=o:this._additionsTail._nextAdded=o,o}_insertAfter(o,l,m){const v=null===l?this._itHead:l._next;return o._next=v,o._prev=l,null===v?this._itTail=o:v._prev=o,null===l?this._itHead=o:l._next=o,null===this._linkedRecords&&(this._linkedRecords=new B0),this._linkedRecords.put(o),o.currentIndex=m,o}_remove(o){return this._addToRemovals(this._unlink(o))}_unlink(o){null!==this._linkedRecords&&this._linkedRecords.remove(o);const l=o._prev,m=o._next;return null===l?this._itHead=m:l._next=m,null===m?this._itTail=l:m._prev=l,o}_addToMoves(o,l){return o.previousIndex===l||(this._movesTail=null===this._movesTail?this._movesHead=o:this._movesTail._nextMoved=o),o}_addToRemovals(o){return null===this._unlinkedRecords&&(this._unlinkedRecords=new B0),this._unlinkedRecords.put(o),o.currentIndex=null,o._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=o,o._prevRemoved=null):(o._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=o),o}_addIdentityChange(o,l){return o.item=l,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=o:this._identityChangesTail._nextIdentityChange=o,o}}class _b{constructor(o,l){this.item=o,this.trackById=l,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class yb{constructor(){this._head=null,this._tail=null}add(o){null===this._head?(this._head=this._tail=o,o._nextDup=null,o._prevDup=null):(this._tail._nextDup=o,o._prevDup=this._tail,o._nextDup=null,this._tail=o)}get(o,l){let m;for(m=this._head;null!==m;m=m._nextDup)if((null===l||l<=m.currentIndex)&&Object.is(m.trackById,o))return m;return null}remove(o){const l=o._prevDup,m=o._nextDup;return null===l?this._head=m:l._nextDup=m,null===m?this._tail=l:m._prevDup=l,null===this._head}}class B0{constructor(){this.map=new Map}put(o){const l=o.trackById;let m=this.map.get(l);m||(m=new yb,this.map.set(l,m)),m.add(o)}get(o,l){const v=this.map.get(o);return v?v.get(o,l):null}remove(o){const l=o.trackById;return this.map.get(l).remove(o)&&this.map.delete(l),o}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function N0(i,o,l){const m=i.previousIndex;if(null===m)return m;let v=0;return l&&m<l.length&&(v=l[m]),m+o+v}class U0{constructor(){}supports(o){return o instanceof Map||Xl(o)}create(){return new vb}}class vb{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(o){let l;for(l=this._mapHead;null!==l;l=l._next)o(l)}forEachPreviousItem(o){let l;for(l=this._previousMapHead;null!==l;l=l._nextPrevious)o(l)}forEachChangedItem(o){let l;for(l=this._changesHead;null!==l;l=l._nextChanged)o(l)}forEachAddedItem(o){let l;for(l=this._additionsHead;null!==l;l=l._nextAdded)o(l)}forEachRemovedItem(o){let l;for(l=this._removalsHead;null!==l;l=l._nextRemoved)o(l)}diff(o){if(o){if(!(o instanceof Map||Xl(o)))throw new Je(900,!1)}else o=new Map;return this.check(o)?this:null}onDestroy(){}check(o){this._reset();let l=this._mapHead;if(this._appendAfter=null,this._forEach(o,(m,v)=>{if(l&&l.key===v)this._maybeAddToChanges(l,m),this._appendAfter=l,l=l._next;else{const b=this._getOrCreateRecordForKey(v,m);l=this._insertBeforeOrAppend(l,b)}}),l){l._prev&&(l._prev._next=null),this._removalsHead=l;for(let m=l;null!==m;m=m._nextRemoved)m===this._mapHead&&(this._mapHead=null),this._records.delete(m.key),m._nextRemoved=m._next,m.previousValue=m.currentValue,m.currentValue=null,m._prev=null,m._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(o,l){if(o){const m=o._prev;return l._next=o,l._prev=m,o._prev=l,m&&(m._next=l),o===this._mapHead&&(this._mapHead=l),this._appendAfter=o,o}return this._appendAfter?(this._appendAfter._next=l,l._prev=this._appendAfter):this._mapHead=l,this._appendAfter=l,null}_getOrCreateRecordForKey(o,l){if(this._records.has(o)){const v=this._records.get(o);this._maybeAddToChanges(v,l);const b=v._prev,S=v._next;return b&&(b._next=S),S&&(S._prev=b),v._next=null,v._prev=null,v}const m=new xb(o);return this._records.set(o,m),m.currentValue=l,this._addToAdditions(m),m}_reset(){if(this.isDirty){let o;for(this._previousMapHead=this._mapHead,o=this._previousMapHead;null!==o;o=o._next)o._nextPrevious=o._next;for(o=this._changesHead;null!==o;o=o._nextChanged)o.previousValue=o.currentValue;for(o=this._additionsHead;null!=o;o=o._nextAdded)o.previousValue=o.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(o,l){Object.is(l,o.currentValue)||(o.previousValue=o.currentValue,o.currentValue=l,this._addToChanges(o))}_addToAdditions(o){null===this._additionsHead?this._additionsHead=this._additionsTail=o:(this._additionsTail._nextAdded=o,this._additionsTail=o)}_addToChanges(o){null===this._changesHead?this._changesHead=this._changesTail=o:(this._changesTail._nextChanged=o,this._changesTail=o)}_forEach(o,l){o instanceof Map?o.forEach(l):Object.keys(o).forEach(m=>l(o[m],m))}}class xb{constructor(o){this.key=o,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function j0(){return new Oy([new z0])}let Oy=(()=>{class i{constructor(l){this.factories=l}static create(l,m){if(null!=m){const v=m.factories.slice();l=l.concat(v)}return new i(l)}static extend(l){return{provide:i,useFactory:m=>i.create(l,m||j0()),deps:[[i,new ye,new ee]]}}find(l){const m=this.factories.find(v=>v.supports(l));if(null!=m)return m;throw new Je(901,!1)}}return i.\u0275prov=bn({token:i,providedIn:"root",factory:j0}),i})();function V0(){return new Fy([new U0])}let Fy=(()=>{class i{constructor(l){this.factories=l}static create(l,m){if(m){const v=m.factories.slice();l=l.concat(v)}return new i(l)}static extend(l){return{provide:i,useFactory:m=>i.create(l,m||V0()),deps:[[i,new ye,new ee]]}}find(l){const m=this.factories.find(v=>v.supports(l));if(m)return m;throw new Je(901,!1)}}return i.\u0275prov=bn({token:i,providedIn:"root",factory:V0}),i})();const Eb=C0(null,"core",[]);let Tb=(()=>{class i{constructor(l){}}return i.\u0275fac=function(l){return new(l||i)(Re(Og))},i.\u0275mod=Or({type:i}),i.\u0275inj=wr({}),i})();function Db(i){return"boolean"==typeof i?i:null!=i&&"false"!==i}},1481:(Yn,At,we)=>{"use strict";we.d(At,{Dx:()=>Mr,b2:()=>Pi,q6:()=>Pn,se:()=>Gt});var W=we(6895),_e=we(1571);class $e extends W.w_{constructor(){super(...arguments),this.supportsDOMEvents=!0}}class u extends $e{static makeCurrent(){(0,W.HT)(new u)}onAndCancel(ie,q,re){return ie.addEventListener(q,re,!1),()=>{ie.removeEventListener(q,re,!1)}}dispatchEvent(ie,q){ie.dispatchEvent(q)}remove(ie){ie.parentNode&&ie.parentNode.removeChild(ie)}createElement(ie,q){return(q=q||this.getDefaultDocument()).createElement(ie)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(ie){return ie.nodeType===Node.ELEMENT_NODE}isShadowRoot(ie){return ie instanceof DocumentFragment}getGlobalEventTarget(ie,q){return"window"===q?window:"document"===q?ie:"body"===q?ie.body:null}getBaseHref(ie){const q=function Kt(){return Ie=Ie||document.querySelector("base"),Ie?Ie.getAttribute("href"):null}();return null==q?null:function bt(ne){Ut=Ut||document.createElement("a"),Ut.setAttribute("href",ne);const ie=Ut.pathname;return"/"===ie.charAt(0)?ie:`/${ie}`}(q)}resetBaseElement(){Ie=null}getUserAgent(){return window.navigator.userAgent}getCookie(ie){return(0,W.Mx)(document.cookie,ie)}}let Ut,Ie=null;const gt=new _e.OlP("TRANSITION_ID"),ft=[{provide:_e.ip1,useFactory:function nt(ne,ie,q){return()=>{q.get(_e.CZH).donePromise.then(()=>{const re=(0,W.q)(),pe=ie.querySelectorAll(`style[ng-transition="${ne}"]`);for(let je=0;je<pe.length;je++)re.remove(pe[je])})}},deps:[gt,W.K0,_e.zs3],multi:!0}];let jn=(()=>{class ne{build(){return new XMLHttpRequest}}return ne.\u0275fac=function(q){return new(q||ne)},ne.\u0275prov=_e.Yz7({token:ne,factory:ne.\u0275fac}),ne})();const Jt=new _e.OlP("EventManagerPlugins");let hn=(()=>{class ne{constructor(q,re){this._zone=re,this._eventNameToPlugin=new Map,q.forEach(pe=>{pe.manager=this}),this._plugins=q.slice().reverse()}addEventListener(q,re,pe){return this._findPluginFor(re).addEventListener(q,re,pe)}addGlobalEventListener(q,re,pe){return this._findPluginFor(re).addGlobalEventListener(q,re,pe)}getZone(){return this._zone}_findPluginFor(q){const re=this._eventNameToPlugin.get(q);if(re)return re;const pe=this._plugins;for(let je=0;je<pe.length;je++){const ht=pe[je];if(ht.supports(q))return this._eventNameToPlugin.set(q,ht),ht}throw new Error(`No event manager plugin found for event ${q}`)}}return ne.\u0275fac=function(q){return new(q||ne)(_e.LFG(Jt),_e.LFG(_e.R0b))},ne.\u0275prov=_e.Yz7({token:ne,factory:ne.\u0275fac}),ne})();class Qt{constructor(ie){this._doc=ie}addGlobalEventListener(ie,q,re){const pe=(0,W.q)().getGlobalEventTarget(this._doc,ie);if(!pe)throw new Error(`Unsupported event target ${pe} for event ${q}`);return this.addEventListener(pe,q,re)}}let tr=(()=>{class ne{constructor(){this.usageCount=new Map}addStyles(q){for(const re of q)1===this.changeUsageCount(re,1)&&this.onStyleAdded(re)}removeStyles(q){for(const re of q)0===this.changeUsageCount(re,-1)&&this.onStyleRemoved(re)}onStyleRemoved(q){}onStyleAdded(q){}getAllStyles(){return this.usageCount.keys()}changeUsageCount(q,re){const pe=this.usageCount;let je=pe.get(q)??0;return je+=re,je>0?pe.set(q,je):pe.delete(q),je}ngOnDestroy(){for(const q of this.getAllStyles())this.onStyleRemoved(q);this.usageCount.clear()}}return ne.\u0275fac=function(q){return new(q||ne)},ne.\u0275prov=_e.Yz7({token:ne,factory:ne.\u0275fac}),ne})(),dt=(()=>{class ne extends tr{constructor(q){super(),this.doc=q,this.styleRef=new Map,this.hostNodes=new Set,this.resetHostNodes()}onStyleAdded(q){for(const re of this.hostNodes)this.addStyleToHost(re,q)}onStyleRemoved(q){const re=this.styleRef;re.get(q)?.forEach(je=>je.remove()),re.delete(q)}ngOnDestroy(){super.ngOnDestroy(),this.styleRef.clear(),this.resetHostNodes()}addHost(q){this.hostNodes.add(q);for(const re of this.getAllStyles())this.addStyleToHost(q,re)}removeHost(q){this.hostNodes.delete(q)}addStyleToHost(q,re){const pe=this.doc.createElement("style");pe.textContent=re,q.appendChild(pe);const je=this.styleRef.get(re);je?je.push(pe):this.styleRef.set(re,[pe])}resetHostNodes(){const q=this.hostNodes;q.clear(),q.add(this.doc.head)}}return ne.\u0275fac=function(q){return new(q||ne)(_e.LFG(W.K0))},ne.\u0275prov=_e.Yz7({token:ne,factory:ne.\u0275fac}),ne})();const Lr={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},Zr=/%COMP%/g,en=new _e.OlP("RemoveStylesOnCompDestory",{providedIn:"root",factory:()=>!1});function an(ne,ie){return ie.flat(100).map(q=>q.replace(Zr,ne))}function mn(ne){return ie=>{if("__ngUnwrap__"===ie)return ne;!1===ne(ie)&&(ie.preventDefault(),ie.returnValue=!1)}}let Gt=(()=>{class ne{constructor(q,re,pe,je){this.eventManager=q,this.sharedStylesHost=re,this.appId=pe,this.removeStylesOnCompDestory=je,this.rendererByCompId=new Map,this.defaultRenderer=new lt(q)}createRenderer(q,re){if(!q||!re)return this.defaultRenderer;const pe=this.getOrCreateRenderer(q,re);return pe instanceof Dn?pe.applyToHost(q):pe instanceof Nt&&pe.applyStyles(),pe}getOrCreateRenderer(q,re){const pe=this.rendererByCompId;let je=pe.get(re.id);if(!je){const ht=this.eventManager,ut=this.sharedStylesHost,sn=this.removeStylesOnCompDestory;switch(re.encapsulation){case _e.ifc.Emulated:je=new Dn(ht,ut,re,this.appId,sn);break;case _e.ifc.ShadowDom:return new Ht(ht,ut,q,re);default:je=new Nt(ht,ut,re,sn)}je.onDestroy=()=>pe.delete(re.id),pe.set(re.id,je)}return je}ngOnDestroy(){this.rendererByCompId.clear()}begin(){}end(){}}return ne.\u0275fac=function(q){return new(q||ne)(_e.LFG(hn),_e.LFG(dt),_e.LFG(_e.AFp),_e.LFG(en))},ne.\u0275prov=_e.Yz7({token:ne,factory:ne.\u0275fac}),ne})();class lt{constructor(ie){this.eventManager=ie,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(ie,q){return q?document.createElementNS(Lr[q]||q,ie):document.createElement(ie)}createComment(ie){return document.createComment(ie)}createText(ie){return document.createTextNode(ie)}appendChild(ie,q){(It(ie)?ie.content:ie).appendChild(q)}insertBefore(ie,q,re){ie&&(It(ie)?ie.content:ie).insertBefore(q,re)}removeChild(ie,q){ie&&ie.removeChild(q)}selectRootElement(ie,q){let re="string"==typeof ie?document.querySelector(ie):ie;if(!re)throw new Error(`The selector "${ie}" did not match any elements`);return q||(re.textContent=""),re}parentNode(ie){return ie.parentNode}nextSibling(ie){return ie.nextSibling}setAttribute(ie,q,re,pe){if(pe){q=pe+":"+q;const je=Lr[pe];je?ie.setAttributeNS(je,q,re):ie.setAttribute(q,re)}else ie.setAttribute(q,re)}removeAttribute(ie,q,re){if(re){const pe=Lr[re];pe?ie.removeAttributeNS(pe,q):ie.removeAttribute(`${re}:${q}`)}else ie.removeAttribute(q)}addClass(ie,q){ie.classList.add(q)}removeClass(ie,q){ie.classList.remove(q)}setStyle(ie,q,re,pe){pe&(_e.JOm.DashCase|_e.JOm.Important)?ie.style.setProperty(q,re,pe&_e.JOm.Important?"important":""):ie.style[q]=re}removeStyle(ie,q,re){re&_e.JOm.DashCase?ie.style.removeProperty(q):ie.style[q]=""}setProperty(ie,q,re){ie[q]=re}setValue(ie,q){ie.nodeValue=q}listen(ie,q,re){return"string"==typeof ie?this.eventManager.addGlobalEventListener(ie,q,mn(re)):this.eventManager.addEventListener(ie,q,mn(re))}}function It(ne){return"TEMPLATE"===ne.tagName&&void 0!==ne.content}class Ht extends lt{constructor(ie,q,re,pe){super(ie),this.sharedStylesHost=q,this.hostEl=re,this.shadowRoot=re.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const je=an(pe.id,pe.styles);for(const ht of je){const ut=document.createElement("style");ut.textContent=ht,this.shadowRoot.appendChild(ut)}}nodeOrShadowRoot(ie){return ie===this.hostEl?this.shadowRoot:ie}appendChild(ie,q){return super.appendChild(this.nodeOrShadowRoot(ie),q)}insertBefore(ie,q,re){return super.insertBefore(this.nodeOrShadowRoot(ie),q,re)}removeChild(ie,q){return super.removeChild(this.nodeOrShadowRoot(ie),q)}parentNode(ie){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(ie)))}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}}class Nt extends lt{constructor(ie,q,re,pe,je=re.id){super(ie),this.sharedStylesHost=q,this.removeStylesOnCompDestory=pe,this.rendererUsageCount=0,this.styles=an(je,re.styles)}applyStyles(){this.sharedStylesHost.addStyles(this.styles),this.rendererUsageCount++}destroy(){this.removeStylesOnCompDestory&&(this.sharedStylesHost.removeStyles(this.styles),this.rendererUsageCount--,0===this.rendererUsageCount&&this.onDestroy?.())}}class Dn extends Nt{constructor(ie,q,re,pe,je){const ht=pe+"-"+re.id;super(ie,q,re,je,ht),this.contentAttr=function Xt(ne){return"_ngcontent-%COMP%".replace(Zr,ne)}(ht),this.hostAttr=function $t(ne){return"_nghost-%COMP%".replace(Zr,ne)}(ht)}applyToHost(ie){this.applyStyles(),this.setAttribute(ie,this.hostAttr,"")}createElement(ie,q){const re=super.createElement(ie,q);return super.setAttribute(re,this.contentAttr,""),re}}let yr=(()=>{class ne extends Qt{constructor(q){super(q)}supports(q){return!0}addEventListener(q,re,pe){return q.addEventListener(re,pe,!1),()=>this.removeEventListener(q,re,pe)}removeEventListener(q,re,pe){return q.removeEventListener(re,pe)}}return ne.\u0275fac=function(q){return new(q||ne)(_e.LFG(W.K0))},ne.\u0275prov=_e.Yz7({token:ne,factory:ne.\u0275fac}),ne})();const or=["alt","control","meta","shift"],vn={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},In={alt:ne=>ne.altKey,control:ne=>ne.ctrlKey,meta:ne=>ne.metaKey,shift:ne=>ne.shiftKey};let cn=(()=>{class ne extends Qt{constructor(q){super(q)}supports(q){return null!=ne.parseEventName(q)}addEventListener(q,re,pe){const je=ne.parseEventName(re),ht=ne.eventCallback(je.fullKey,pe,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>(0,W.q)().onAndCancel(q,je.domEventName,ht))}static parseEventName(q){const re=q.toLowerCase().split("."),pe=re.shift();if(0===re.length||"keydown"!==pe&&"keyup"!==pe)return null;const je=ne._normalizeKey(re.pop());let ht="",ut=re.indexOf("code");if(ut>-1&&(re.splice(ut,1),ht="code."),or.forEach(dn=>{const Rt=re.indexOf(dn);Rt>-1&&(re.splice(Rt,1),ht+=dn+".")}),ht+=je,0!=re.length||0===je.length)return null;const sn={};return sn.domEventName=pe,sn.fullKey=ht,sn}static matchEventFullKeyCode(q,re){let pe=vn[q.key]||q.key,je="";return re.indexOf("code.")>-1&&(pe=q.code,je="code."),!(null==pe||!pe)&&(pe=pe.toLowerCase()," "===pe?pe="space":"."===pe&&(pe="dot"),or.forEach(ht=>{ht!==pe&&(0,In[ht])(q)&&(je+=ht+".")}),je+=pe,je===re)}static eventCallback(q,re,pe){return je=>{ne.matchEventFullKeyCode(je,q)&&pe.runGuarded(()=>re(je))}}static _normalizeKey(q){return"esc"===q?"escape":q}}return ne.\u0275fac=function(q){return new(q||ne)(_e.LFG(W.K0))},ne.\u0275prov=_e.Yz7({token:ne,factory:ne.\u0275fac}),ne})();const Pn=(0,_e.eFA)(_e._c5,"browser",[{provide:_e.Lbi,useValue:W.bD},{provide:_e.g9A,useValue:function wr(){u.makeCurrent()},multi:!0},{provide:W.K0,useFactory:function yi(){return(0,_e.RDi)(document),document},deps:[]}]),jr=new _e.OlP(""),Br=[{provide:_e.rWj,useClass:class Et{addToWindow(ie){_e.dqk.getAngularTestability=(re,pe=!0)=>{const je=ie.findTestabilityInTree(re,pe);if(null==je)throw new Error("Could not find testability for element.");return je},_e.dqk.getAllAngularTestabilities=()=>ie.getAllTestabilities(),_e.dqk.getAllAngularRootElements=()=>ie.getAllRootElements(),_e.dqk.frameworkStabilizers||(_e.dqk.frameworkStabilizers=[]),_e.dqk.frameworkStabilizers.push(re=>{const pe=_e.dqk.getAllAngularTestabilities();let je=pe.length,ht=!1;const ut=function(sn){ht=ht||sn,je--,0==je&&re(ht)};pe.forEach(function(sn){sn.whenStable(ut)})})}findTestabilityInTree(ie,q,re){return null==q?null:ie.getTestability(q)??(re?(0,W.q)().isShadowRoot(q)?this.findTestabilityInTree(ie,q.host,!0):this.findTestabilityInTree(ie,q.parentElement,!0):null)}},deps:[]},{provide:_e.lri,useClass:_e.dDg,deps:[_e.R0b,_e.eoX,_e.rWj]},{provide:_e.dDg,useClass:_e.dDg,deps:[_e.R0b,_e.eoX,_e.rWj]}],ri=[{provide:_e.zSh,useValue:"root"},{provide:_e.qLn,useFactory:function Yi(){return new _e.qLn},deps:[]},{provide:Jt,useClass:yr,multi:!0,deps:[W.K0,_e.R0b,_e.Lbi]},{provide:Jt,useClass:cn,multi:!0,deps:[W.K0]},{provide:Gt,useClass:Gt,deps:[hn,dt,_e.AFp,en]},{provide:_e.FYo,useExisting:Gt},{provide:tr,useExisting:dt},{provide:dt,useClass:dt,deps:[W.K0]},{provide:hn,useClass:hn,deps:[Jt,_e.R0b]},{provide:W.JF,useClass:jn,deps:[]},[]];let Pi=(()=>{class ne{constructor(q){}static withServerTransition(q){return{ngModule:ne,providers:[{provide:_e.AFp,useValue:q.appId},{provide:gt,useExisting:_e.AFp},ft]}}}return ne.\u0275fac=function(q){return new(q||ne)(_e.LFG(jr,12))},ne.\u0275mod=_e.oAB({type:ne}),ne.\u0275inj=_e.cJS({providers:[...ri,...Br],imports:[W.ez,_e.hGG]}),ne})(),Mr=(()=>{class ne{constructor(q){this._doc=q}getTitle(){return this._doc.title}setTitle(q){this._doc.title=q||""}}return ne.\u0275fac=function(q){return new(q||ne)(_e.LFG(W.K0))},ne.\u0275prov=_e.Yz7({token:ne,factory:function(q){let re=null;return re=q?new q:function Ri(){return new Mr((0,_e.LFG)(W.K0))}(),re},providedIn:"root"}),ne})();typeof window<"u"&&window},8750:(Yn,At,we)=>{"use strict";we.d(At,{F0:()=>Jo,rH:()=>ja,Bz:()=>Ws,lC:()=>as});var W=we(1571),_e=we(2076),$e=we(9646),u=we(7579);class Ie extends u.x{constructor(f){super(),this._value=f}get value(){return this.getValue()}_subscribe(f){const d=super._subscribe(f);return!d.closed&&f.next(this._value),d}getValue(){const{hasError:f,thrownError:d,_value:y}=this;if(f)throw d;return this._throwIfClosed(),y}next(f){super.next(this._value=f)}}const Ut=(0,we(3888).d)(a=>function(){a(this),this.name="EmptyError",this.message="no elements in sequence"});var bt=we(9751),gt=we(4742),nt=we(4671),ft=we(3268),Et=we(3269),jn=we(1810),Jt=we(5403),hn=we(9672);function Qt(...a){const f=(0,Et.yG)(a),d=(0,Et.jO)(a),{args:y,keys:x}=(0,gt.D)(a);if(0===y.length)return(0,_e.D)([],f);const E=new bt.y(function tr(a,f,d=nt.y){return y=>{dt(f,()=>{const{length:x}=a,E=new Array(x);let C=x,k=x;for(let U=0;U<x;U++)dt(f,()=>{const Y=(0,_e.D)(a[U],f);let oe=!1;Y.subscribe((0,Jt.x)(y,le=>{E[U]=le,oe||(oe=!0,k--),k||y.next(d(E.slice()))},()=>{--C||y.complete()}))},y)},y)}}(y,f,x?C=>(0,jn.n)(x,C):nt.y));return d?E.pipe((0,ft.Z)(d)):E}function dt(a,f,d){a?(0,hn.f)(d,a,f):f()}var Lr=we(7272),Zr=we(8421);function Je(a){return new bt.y(f=>{(0,Zr.Xf)(a()).subscribe(f)})}var Ne=we(9635),mt=we(576);function ln(a,f){const d=(0,mt.m)(a)?a:()=>a,y=x=>x.error(d());return new bt.y(f?x=>f.schedule(y,0,x):y)}var Ue=we(515),en=we(727),Xt=we(4482);function $t(){return(0,Xt.e)((a,f)=>{let d=null;a._refCount++;const y=(0,Jt.x)(f,void 0,void 0,void 0,()=>{if(!a||a._refCount<=0||0<--a._refCount)return void(d=null);const x=a._connection,E=d;d=null,x&&(!E||x===E)&&x.unsubscribe(),f.unsubscribe()});a.subscribe(y),y.closed||(d=a.connect())})}class an extends bt.y{constructor(f,d){super(),this.source=f,this.subjectFactory=d,this._subject=null,this._refCount=0,this._connection=null,(0,Xt.A)(f)&&(this.lift=f.lift)}_subscribe(f){return this.getSubject().subscribe(f)}getSubject(){const f=this._subject;return(!f||f.isStopped)&&(this._subject=this.subjectFactory()),this._subject}_teardown(){this._refCount=0;const{_connection:f}=this;this._subject=this._connection=null,f?.unsubscribe()}connect(){let f=this._connection;if(!f){f=this._connection=new en.w0;const d=this.getSubject();f.add(this.source.subscribe((0,Jt.x)(d,void 0,()=>{this._teardown(),d.complete()},y=>{this._teardown(),d.error(y)},()=>this._teardown()))),f.closed&&(this._connection=null,f=en.w0.EMPTY)}return f}refCount(){return $t()(this)}}var mn=we(6895),Gt=we(4004),lt=we(3900),rt=we(5698),Dt=we(8675),It=we(9300),Ht=we(5577);function Nt(a){return(0,Xt.e)((f,d)=>{let y=!1;f.subscribe((0,Jt.x)(d,x=>{y=!0,d.next(x)},()=>{y||d.next(a),d.complete()}))})}function Dn(a=yr){return(0,Xt.e)((f,d)=>{let y=!1;f.subscribe((0,Jt.x)(d,x=>{y=!0,d.next(x)},()=>y?d.complete():d.error(a())))})}function yr(){return new Ut}function or(a,f){const d=arguments.length>=2;return y=>y.pipe(a?(0,It.h)((x,E)=>a(x,E,y)):nt.y,(0,rt.q)(1),d?Nt(f):Dn(()=>new Ut))}var vn=we(4351),In=we(8505),cn=we(262);function vr(a,f){return(0,Xt.e)(function pr(a,f,d,y,x){return(E,C)=>{let k=d,U=f,Y=0;E.subscribe((0,Jt.x)(C,oe=>{const le=Y++;U=k?a(U,oe,le):(k=!0,oe),y&&C.next(U)},x&&(()=>{k&&C.next(U),C.complete()})))}}(a,f,arguments.length>=2,!0))}function si(a){return a<=0?()=>Ue.E:(0,Xt.e)((f,d)=>{let y=[];f.subscribe((0,Jt.x)(d,x=>{y.push(x),a<y.length&&y.shift()},()=>{for(const x of y)d.next(x);d.complete()},void 0,()=>{y=null}))})}function bn(a,f){const d=arguments.length>=2;return y=>y.pipe(a?(0,It.h)((x,E)=>a(x,E,y)):nt.y,si(1),d?Nt(f):Dn(()=>new Ut))}function Yi(a){return(0,Xt.e)((f,d)=>{try{f.subscribe(d)}finally{d.add(a)}})}var yi=we(8189),Xr=we(1481);const Pn="primary",jr=Symbol("RouteTitle");class Br{constructor(f){this.params=f||{}}has(f){return Object.prototype.hasOwnProperty.call(this.params,f)}get(f){if(this.has(f)){const d=this.params[f];return Array.isArray(d)?d[0]:d}return null}getAll(f){if(this.has(f)){const d=this.params[f];return Array.isArray(d)?d:[d]}return[]}get keys(){return Object.keys(this.params)}}function ri(a){return new Br(a)}function Pi(a,f,d){const y=d.path.split("/");if(y.length>a.length||"full"===d.pathMatch&&(f.hasChildren()||y.length<a.length))return null;const x={};for(let E=0;E<y.length;E++){const C=y[E],k=a[E];if(C.startsWith(":"))x[C.substring(1)]=k;else if(C!==k.path)return null}return{consumed:a.slice(0,y.length),posParams:x}}function Vn(a,f){const d=a?Object.keys(a):void 0,y=f?Object.keys(f):void 0;if(!d||!y||d.length!=y.length)return!1;let x;for(let E=0;E<d.length;E++)if(x=d[E],!yn(a[x],f[x]))return!1;return!0}function yn(a,f){if(Array.isArray(a)&&Array.isArray(f)){if(a.length!==f.length)return!1;const d=[...a].sort(),y=[...f].sort();return d.every((x,E)=>y[E]===x)}return a===f}function Ri(a){return Array.prototype.concat.apply([],a)}function Mr(a){return a.length>0?a[a.length-1]:null}function St(a,f){for(const d in a)a.hasOwnProperty(d)&&f(a[d],d)}function vi(a){return(0,W.CqO)(a)?a:(0,W.QGY)(a)?(0,_e.D)(Promise.resolve(a)):(0,$e.of)(a)}const dr=!1,Nr={exact:function Dr(a,f,d){if(!Re(a.segments,f.segments)||!kn(a.segments,f.segments,d)||a.numberOfChildren!==f.numberOfChildren)return!1;for(const y in f.children)if(!a.children[y]||!Dr(a.children[y],f.children[y],d))return!1;return!0},subset:gr},io={exact:function oo(a,f){return Vn(a,f)},subset:function po(a,f){return Object.keys(f).length<=Object.keys(a).length&&Object.keys(f).every(d=>yn(a[d],f[d]))},ignored:()=>!0};function ki(a,f,d){return Nr[d.paths](a.root,f.root,d.matrixParams)&&io[d.queryParams](a.queryParams,f.queryParams)&&!("exact"===d.fragment&&a.fragment!==f.fragment)}function gr(a,f,d){return so(a,f,f.segments,d)}function so(a,f,d,y){if(a.segments.length>d.length){const x=a.segments.slice(0,d.length);return!(!Re(x,d)||f.hasChildren()||!kn(x,d,y))}if(a.segments.length===d.length){if(!Re(a.segments,d)||!kn(a.segments,d,y))return!1;for(const x in f.children)if(!a.children[x]||!gr(a.children[x],f.children[x],y))return!1;return!0}{const x=d.slice(0,a.segments.length),E=d.slice(a.segments.length);return!!(Re(a.segments,x)&&kn(a.segments,x,y)&&a.children[Pn])&&so(a.children[Pn],f,E,y)}}function kn(a,f,d){return f.every((y,x)=>io[d](a[x].parameters,y.parameters))}class xi{constructor(f=new $n([],{}),d={},y=null){this.root=f,this.queryParams=d,this.fragment=y}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=ri(this.queryParams)),this._queryParamMap}toString(){return ue.serialize(this)}}class $n{constructor(f,d){this.segments=f,this.children=d,this.parent=null,St(d,(y,x)=>y.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return H(this)}}class pt{constructor(f,d){this.path=f,this.parameters=d}get parameterMap(){return this._parameterMap||(this._parameterMap=ri(this.parameters)),this._parameterMap}toString(){return pe(this)}}function Re(a,f){return a.length===f.length&&a.every((d,y)=>d.path===f[y].path)}let Pt=(()=>{class a{}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:function(){return new Ln},providedIn:"root"}),a})();class Ln{parse(f){const d=new xr(f);return new xi(d.parseRootSegment(),d.parseQueryParams(),d.parseFragment())}serialize(f){const d=`/${K(f.root,!0)}`,y=function ht(a){const f=Object.keys(a).map(d=>{const y=a[d];return Array.isArray(y)?y.map(x=>`${Ee(d)}=${Ee(x)}`).join("&"):`${Ee(d)}=${Ee(y)}`}).filter(d=>!!d);return f.length?`?${f.join("&")}`:""}(f.queryParams);return`${d}${y}${"string"==typeof f.fragment?`#${function ne(a){return encodeURI(a)}(f.fragment)}`:""}`}}const ue=new Ln;function H(a){return a.segments.map(f=>pe(f)).join("/")}function K(a,f){if(!a.hasChildren())return H(a);if(f){const d=a.children[Pn]?K(a.children[Pn],!1):"",y=[];return St(a.children,(x,E)=>{E!==Pn&&y.push(`${E}:${K(x,!1)}`)}),y.length>0?`${d}(${y.join("//")})`:d}{const d=function Wt(a,f){let d=[];return St(a.children,(y,x)=>{x===Pn&&(d=d.concat(f(y,x)))}),St(a.children,(y,x)=>{x!==Pn&&(d=d.concat(f(y,x)))}),d}(a,(y,x)=>x===Pn?[K(a.children[Pn],!1)]:[`${x}:${K(y,!1)}`]);return 1===Object.keys(a.children).length&&null!=a.children[Pn]?`${H(a)}/${d[0]}`:`${H(a)}/(${d.join("//")})`}}function de(a){return encodeURIComponent(a).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Ee(a){return de(a).replace(/%3B/gi,";")}function ie(a){return de(a).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function q(a){return decodeURIComponent(a)}function re(a){return q(a.replace(/\+/g,"%20"))}function pe(a){return`${ie(a.path)}${function je(a){return Object.keys(a).map(f=>`;${ie(f)}=${ie(a[f])}`).join("")}(a.parameters)}`}const ut=/^[^\/()?;=#]+/;function sn(a){const f=a.match(ut);return f?f[0]:""}const dn=/^[^=?&#]+/,xn=/^[^&#]+/;class xr{constructor(f){this.url=f,this.remaining=f}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new $n([],{}):new $n([],this.parseChildren())}parseQueryParams(){const f={};if(this.consumeOptional("?"))do{this.parseQueryParam(f)}while(this.consumeOptional("&"));return f}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const f=[];for(this.peekStartsWith("(")||f.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),f.push(this.parseSegment());let d={};this.peekStartsWith("/(")&&(this.capture("/"),d=this.parseParens(!0));let y={};return this.peekStartsWith("(")&&(y=this.parseParens(!1)),(f.length>0||Object.keys(d).length>0)&&(y[Pn]=new $n(f,d)),y}parseSegment(){const f=sn(this.remaining);if(""===f&&this.peekStartsWith(";"))throw new W.vHH(4009,dr);return this.capture(f),new pt(q(f),this.parseMatrixParams())}parseMatrixParams(){const f={};for(;this.consumeOptional(";");)this.parseParam(f);return f}parseParam(f){const d=sn(this.remaining);if(!d)return;this.capture(d);let y="";if(this.consumeOptional("=")){const x=sn(this.remaining);x&&(y=x,this.capture(y))}f[q(d)]=q(y)}parseQueryParam(f){const d=function Rt(a){const f=a.match(dn);return f?f[0]:""}(this.remaining);if(!d)return;this.capture(d);let y="";if(this.consumeOptional("=")){const C=function rr(a){const f=a.match(xn);return f?f[0]:""}(this.remaining);C&&(y=C,this.capture(y))}const x=re(d),E=re(y);if(f.hasOwnProperty(x)){let C=f[x];Array.isArray(C)||(C=[C],f[x]=C),C.push(E)}else f[x]=E}parseParens(f){const d={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const y=sn(this.remaining),x=this.remaining[y.length];if("/"!==x&&")"!==x&&";"!==x)throw new W.vHH(4010,dr);let E;y.indexOf(":")>-1?(E=y.slice(0,y.indexOf(":")),this.capture(E),this.capture(":")):f&&(E=Pn);const C=this.parseChildren();d[E]=1===Object.keys(C).length?C[Pn]:new $n([],C),this.consumeOptional("//")}return d}peekStartsWith(f){return this.remaining.startsWith(f)}consumeOptional(f){return!!this.peekStartsWith(f)&&(this.remaining=this.remaining.substring(f.length),!0)}capture(f){if(!this.consumeOptional(f))throw new W.vHH(4011,dr)}}function Sn(a){return a.segments.length>0?new $n([],{[Pn]:a}):a}function Pr(a){const f={};for(const y of Object.keys(a.children)){const E=Pr(a.children[y]);(E.segments.length>0||E.hasChildren())&&(f[y]=E)}return function Or(a){if(1===a.numberOfChildren&&a.children[Pn]){const f=a.children[Pn];return new $n(a.segments.concat(f.segments),f.children)}return a}(new $n(a.segments,f))}function Ji(a){return a instanceof xi}const Hi=!1;function wi(a,f,d,y,x){if(0===d.length)return Gr(f.root,f.root,f.root,y,x);const E=function Zt(a){if("string"==typeof a[0]&&1===a.length&&"/"===a[0])return new is(!0,0,a);let f=0,d=!1;const y=a.reduce((x,E,C)=>{if("object"==typeof E&&null!=E){if(E.outlets){const k={};return St(E.outlets,(U,Y)=>{k[Y]="string"==typeof U?U.split("/"):U}),[...x,{outlets:k}]}if(E.segmentPath)return[...x,E.segmentPath]}return"string"!=typeof E?[...x,E]:0===C?(E.split("/").forEach((k,U)=>{0==U&&"."===k||(0==U&&""===k?d=!0:".."===k?f++:""!=k&&x.push(k))}),x):[...x,E]},[]);return new is(d,f,y)}(d);return E.toRoot()?Gr(f.root,f.root,new $n([],{}),y,x):function C(U){const Y=function Gn(a,f,d,y){if(a.isAbsolute)return new On(f.root,!0,0);if(-1===y)return new On(d,d===f.root,0);return function Ur(a,f,d){let y=a,x=f,E=d;for(;E>x;){if(E-=x,y=y.parent,!y)throw new W.vHH(4005,Hi&&"Invalid number of '../'");x=y.segments.length}return new On(y,!1,x-E)}(d,y+(Bi(a.commands[0])?0:1),a.numberOfDoubleDots)}(E,f,a.snapshot?._urlSegment,U),oe=Y.processChildren?Jr(Y.segmentGroup,Y.index,E.commands):mo(Y.segmentGroup,Y.index,E.commands);return Gr(f.root,Y.segmentGroup,oe,y,x)}(a.snapshot?._lastPathIndex)}function Bi(a){return"object"==typeof a&&null!=a&&!a.outlets&&!a.segmentPath}function ai(a){return"object"==typeof a&&null!=a&&a.outlets}function Gr(a,f,d,y,x){let C,E={};y&&St(y,(U,Y)=>{E[Y]=Array.isArray(U)?U.map(oe=>`${oe}`):`${U}`}),C=a===f?d:Ks(a,f,d);const k=Sn(Pr(C));return new xi(k,E,x)}function Ks(a,f,d){const y={};return St(a.children,(x,E)=>{y[E]=x===f?d:Ks(x,f,d)}),new $n(a.segments,y)}class is{constructor(f,d,y){if(this.isAbsolute=f,this.numberOfDoubleDots=d,this.commands=y,f&&y.length>0&&Bi(y[0]))throw new W.vHH(4003,Hi&&"Root segment cannot have matrix parameters");const x=y.find(ai);if(x&&x!==Mr(y))throw new W.vHH(4004,Hi&&"{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class On{constructor(f,d,y){this.segmentGroup=f,this.processChildren=d,this.index=y}}function mo(a,f,d){if(a||(a=new $n([],{})),0===a.segments.length&&a.hasChildren())return Jr(a,f,d);const y=function Mo(a,f,d){let y=0,x=f;const E={match:!1,pathIndex:0,commandIndex:0};for(;x<a.segments.length;){if(y>=d.length)return E;const C=a.segments[x],k=d[y];if(ai(k))break;const U=`${k}`,Y=y<d.length-1?d[y+1]:null;if(x>0&&void 0===U)break;if(U&&Y&&"object"==typeof Y&&void 0===Y.outlets){if(!An(U,Y,C))return E;y+=2}else{if(!An(U,{},C))return E;y++}x++}return{match:!0,pathIndex:x,commandIndex:y}}(a,f,d),x=d.slice(y.commandIndex);if(y.match&&y.pathIndex<a.segments.length){const E=new $n(a.segments.slice(0,y.pathIndex),{});return E.children[Pn]=new $n(a.segments.slice(y.pathIndex),a.children),Jr(E,0,x)}return y.match&&0===x.length?new $n(a.segments,{}):y.match&&!a.hasChildren()?ir(a,f,d):y.match?Jr(a,0,x):ir(a,f,d)}function Jr(a,f,d){if(0===d.length)return new $n(a.segments,{});{const y=function Nn(a){return ai(a[0])?a[0].outlets:{[Pn]:a}}(d),x={};return!y[Pn]&&a.children[Pn]&&1===a.numberOfChildren&&0===a.children[Pn].segments.length?Jr(a.children[Pn],f,d):(St(y,(E,C)=>{"string"==typeof E&&(E=[E]),null!==E&&(x[C]=mo(a.children[C],f,E))}),St(a.children,(E,C)=>{void 0===y[C]&&(x[C]=E)}),new $n(a.segments,x))}}function ir(a,f,d){const y=a.segments.slice(0,f);let x=0;for(;x<d.length;){const E=d[x];if(ai(E)){const U=Cr(E.outlets);return new $n(y,U)}if(0===x&&Bi(d[0])){y.push(new pt(a.segments[f].path,os(d[0]))),x++;continue}const C=ai(E)?E.outlets[Pn]:`${E}`,k=x<d.length-1?d[x+1]:null;C&&k&&Bi(k)?(y.push(new pt(C,os(k))),x+=2):(y.push(new pt(C,{})),x++)}return new $n(y,{})}function Cr(a){const f={};return St(a,(d,y)=>{"string"==typeof d&&(d=[d]),null!==d&&(f[y]=ir(new $n([],{}),0,d))}),f}function os(a){const f={};return St(a,(d,y)=>f[y]=`${d}`),f}function An(a,f,d){return a==d.path&&Vn(f,d.parameters)}const Es="imperative";class bi{constructor(f,d){this.id=f,this.url=d}}class Bs extends bi{constructor(f,d,y="imperative",x=null){super(f,d),this.type=0,this.navigationTrigger=y,this.restoredState=x}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Qi extends bi{constructor(f,d,y){super(f,d),this.urlAfterRedirects=y,this.type=1}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class li extends bi{constructor(f,d,y,x){super(f,d),this.reason=y,this.code=x,this.type=2}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class ao extends bi{constructor(f,d,y,x){super(f,d),this.reason=y,this.code=x,this.type=16}}class hi extends bi{constructor(f,d,y,x){super(f,d),this.error=y,this.target=x,this.type=3}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class lo extends bi{constructor(f,d,y,x){super(f,d),this.urlAfterRedirects=y,this.state=x,this.type=4}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Li extends bi{constructor(f,d,y,x){super(f,d),this.urlAfterRedirects=y,this.state=x,this.type=7}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Qr extends bi{constructor(f,d,y,x,E){super(f,d),this.urlAfterRedirects=y,this.state=x,this.shouldActivate=E,this.type=8}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Hr extends bi{constructor(f,d,y,x){super(f,d),this.urlAfterRedirects=y,this.state=x,this.type=5}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Bo extends bi{constructor(f,d,y,x){super(f,d),this.urlAfterRedirects=y,this.state=x,this.type=6}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Wi{constructor(f){this.route=f,this.type=9}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class co{constructor(f){this.route=f,this.type=10}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Ns{constructor(f){this.snapshot=f,this.type=11}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ys{constructor(f){this.snapshot=f,this.type=12}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ii{constructor(f){this.snapshot=f,this.type=13}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Ni{constructor(f){this.snapshot=f,this.type=14}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class xa{constructor(f,d,y){this.routerEvent=f,this.position=d,this.anchor=y,this.type=15}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}let ra=(()=>{class a{createUrlTree(d,y,x,E,C,k){return wi(d||y.root,x,E,C,k)}}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:a.\u0275fac}),a})(),Io=(()=>{class a{}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:function(f){return ra.\u0275fac(f)},providedIn:"root"}),a})();class eo{constructor(f){this._root=f}get root(){return this._root.value}parent(f){const d=this.pathFromRoot(f);return d.length>1?d[d.length-2]:null}children(f){const d=Js(f,this._root);return d?d.children.map(y=>y.value):[]}firstChild(f){const d=Js(f,this._root);return d&&d.children.length>0?d.children[0].value:null}siblings(f){const d=wa(f,this._root);return d.length<2?[]:d[d.length-2].children.map(x=>x.value).filter(x=>x!==f)}pathFromRoot(f){return wa(f,this._root).map(d=>d.value)}}function Js(a,f){if(a===f.value)return f;for(const d of f.children){const y=Js(a,d);if(y)return y}return null}function wa(a,f){if(a===f.value)return[f];for(const d of f.children){const y=wa(a,d);if(y.length)return y.unshift(f),y}return[]}class No{constructor(f,d){this.value=f,this.children=d}toString(){return`TreeNode(${this.value})`}}function wo(a){const f={};return a&&a.children.forEach(d=>f[d.value.outlet]=d),f}class Ja extends eo{constructor(f,d){super(f),this.snapshot=d,Fa(this,f)}toString(){return this.snapshot.toString()}}function Us(a,f){const d=function Ts(a,f){const C=new uo([],{},{},"",{},Pn,f,null,a.root,-1,{});return new oa("",new No(C,[]))}(a,f),y=new Ie([new pt("",{})]),x=new Ie({}),E=new Ie({}),C=new Ie({}),k=new Ie(""),U=new to(y,x,C,k,E,Pn,f,d.root);return U.snapshot=d.root,new Ja(new No(U,[]),d)}class to{constructor(f,d,y,x,E,C,k,U){this.url=f,this.params=d,this.queryParams=y,this.fragment=x,this.data=E,this.outlet=C,this.component=k,this.title=this.data?.pipe((0,Gt.U)(Y=>Y[jr]))??(0,$e.of)(void 0),this._futureSnapshot=U}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe((0,Gt.U)(f=>ri(f)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe((0,Gt.U)(f=>ri(f)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function ia(a,f="emptyOnly"){const d=a.pathFromRoot;let y=0;if("always"!==f)for(y=d.length-1;y>=1;){const x=d[y],E=d[y-1];if(x.routeConfig&&""===x.routeConfig.path)y--;else{if(E.component)break;y--}}return function js(a){return a.reduce((f,d)=>({params:{...f.params,...d.params},data:{...f.data,...d.data},resolve:{...d.data,...f.resolve,...d.routeConfig?.data,...d._resolvedData}}),{params:{},data:{},resolve:{}})}(d.slice(y))}class uo{get title(){return this.data?.[jr]}constructor(f,d,y,x,E,C,k,U,Y,oe,le){this.url=f,this.params=d,this.queryParams=y,this.fragment=x,this.data=E,this.outlet=C,this.component=k,this.routeConfig=U,this._urlSegment=Y,this._lastPathIndex=oe,this._resolve=le}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=ri(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=ri(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(y=>y.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class oa extends eo{constructor(f,d){super(d),this.url=f,Fa(this,d)}toString(){return za(this._root)}}function Fa(a,f){f.value._routerState=a,f.children.forEach(d=>Fa(a,d))}function za(a){const f=a.children.length>0?` { ${a.children.map(za).join(", ")} } `:"";return`${a.value}${f}`}function sa(a){if(a.snapshot){const f=a.snapshot,d=a._futureSnapshot;a.snapshot=d,Vn(f.queryParams,d.queryParams)||a.queryParams.next(d.queryParams),f.fragment!==d.fragment&&a.fragment.next(d.fragment),Vn(f.params,d.params)||a.params.next(d.params),function So(a,f){if(a.length!==f.length)return!1;for(let d=0;d<a.length;++d)if(!Vn(a[d],f[d]))return!1;return!0}(f.url,d.url)||a.url.next(d.url),Vn(f.data,d.data)||a.data.next(d.data)}else a.snapshot=a._futureSnapshot,a.data.next(a._futureSnapshot.data)}function bo(a,f){const d=Vn(a.params,f.params)&&function Fe(a,f){return Re(a,f)&&a.every((d,y)=>Vn(d.parameters,f[y].parameters))}(a.url,f.url);return d&&!(!a.parent!=!f.parent)&&(!a.parent||bo(a.parent,f.parent))}function Eo(a,f,d){if(d&&a.shouldReuseRoute(f.value,d.value.snapshot)){const y=d.value;y._futureSnapshot=f.value;const x=function Vs(a,f,d){return f.children.map(y=>{for(const x of d.children)if(a.shouldReuseRoute(y.value,x.value.snapshot))return Eo(a,y,x);return Eo(a,y)})}(a,f,d);return new No(y,x)}{if(a.shouldAttach(f.value)){const E=a.retrieve(f.value);if(null!==E){const C=E.route;return C.value._futureSnapshot=f.value,C.children=f.children.map(k=>Eo(a,k)),C}}const y=function Qa(a){return new to(new Ie(a.url),new Ie(a.params),new Ie(a.queryParams),new Ie(a.fragment),new Ie(a.data),a.outlet,a.component,a)}(f.value),x=f.children.map(E=>Eo(a,E));return new No(y,x)}}const la="ngNavigationCancelingError";function go(a,f){const{redirectTo:d,navigationBehaviorOptions:y}=Ji(f)?{redirectTo:f,navigationBehaviorOptions:void 0}:f,x=Ds(!1,0,f);return x.url=d,x.navigationBehaviorOptions=y,x}function Ds(a,f,d){const y=new Error("NavigationCancelingError: "+(a||""));return y[la]=!0,y.cancellationCode=f,d&&(y.url=d),y}function ss(a){return mr(a)&&Ji(a.url)}function mr(a){return a&&a[la]}class ba{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.injector=null,this.children=new qo,this.attachRef=null}}let qo=(()=>{class a{constructor(){this.contexts=new Map}onChildOutletCreated(d,y){const x=this.getOrCreateContext(d);x.outlet=y,this.contexts.set(d,x)}onChildOutletDestroyed(d){const y=this.getContext(d);y&&(y.outlet=null,y.attachRef=null)}onOutletDeactivated(){const d=this.contexts;return this.contexts=new Map,d}onOutletReAttached(d){this.contexts=d}getOrCreateContext(d){let y=this.getContext(d);return y||(y=new ba,this.contexts.set(d,y)),y}getContext(d){return this.contexts.get(d)||null}}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();const Zo=!1;let as=(()=>{class a{constructor(){this.activated=null,this._activatedRoute=null,this.name=Pn,this.activateEvents=new W.vpe,this.deactivateEvents=new W.vpe,this.attachEvents=new W.vpe,this.detachEvents=new W.vpe,this.parentContexts=(0,W.f3M)(qo),this.location=(0,W.f3M)(W.s_b),this.changeDetector=(0,W.f3M)(W.sBO),this.environmentInjector=(0,W.f3M)(W.lqb)}ngOnChanges(d){if(d.name){const{firstChange:y,previousValue:x}=d.name;if(y)return;this.isTrackedInParentContexts(x)&&(this.deactivate(),this.parentContexts.onChildOutletDestroyed(x)),this.initializeOutletWithName()}}ngOnDestroy(){this.isTrackedInParentContexts(this.name)&&this.parentContexts.onChildOutletDestroyed(this.name)}isTrackedInParentContexts(d){return this.parentContexts.getContext(d)?.outlet===this}ngOnInit(){this.initializeOutletWithName()}initializeOutletWithName(){if(this.parentContexts.onChildOutletCreated(this.name,this),this.activated)return;const d=this.parentContexts.getContext(this.name);d?.route&&(d.attachRef?this.attach(d.attachRef,d.route):this.activateWith(d.route,d.injector))}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new W.vHH(4012,Zo);return this.activated.instance}get activatedRoute(){if(!this.activated)throw new W.vHH(4012,Zo);return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new W.vHH(4012,Zo);this.location.detach();const d=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(d.instance),d}attach(d,y){this.activated=d,this._activatedRoute=y,this.location.insert(d.hostView),this.attachEvents.emit(d.instance)}deactivate(){if(this.activated){const d=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(d)}}activateWith(d,y){if(this.isActivated)throw new W.vHH(4013,Zo);this._activatedRoute=d;const x=this.location,C=d.snapshot.component,k=this.parentContexts.getOrCreateContext(this.name).children,U=new qi(d,k,x.injector);if(y&&function Ao(a){return!!a.resolveComponentFactory}(y)){const Y=y.resolveComponentFactory(C);this.activated=x.createComponent(Y,x.length,U)}else this.activated=x.createComponent(C,{index:x.length,injector:U,environmentInjector:y??this.environmentInjector});this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return a.\u0275fac=function(d){return new(d||a)},a.\u0275dir=W.lG2({type:a,selectors:[["router-outlet"]],inputs:{name:"name"},outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"],standalone:!0,features:[W.TTD]}),a})();class qi{constructor(f,d,y){this.route=f,this.childContexts=d,this.parent=y}get(f,d){return f===to?this.route:f===qo?this.childContexts:this.parent.get(f,d)}}let Cs=(()=>{class a{}return a.\u0275fac=function(d){return new(d||a)},a.\u0275cmp=W.Xpm({type:a,selectors:[["ng-component"]],standalone:!0,features:[W.jDz],decls:1,vars:0,template:function(d,y){1&d&&W._UZ(0,"router-outlet")},dependencies:[as],encapsulation:2}),a})();function no(a,f){return a.providers&&!a._injector&&(a._injector=(0,W.MMx)(a.providers,f,`Route: ${a.path}`)),a._injector??f}function cs(a){const f=a.children&&a.children.map(cs),d=f?{...a,children:f}:{...a};return!d.component&&!d.loadComponent&&(f||d.loadChildren)&&d.outlet&&d.outlet!==Pn&&(d.component=Cs),d}function ei(a){return a.outlet||Pn}function us(a,f){const d=a.filter(y=>ei(y)===f);return d.push(...a.filter(y=>ei(y)!==f)),d}function Ko(a){if(!a)return null;if(a.routeConfig?._injector)return a.routeConfig._injector;for(let f=a.parent;f;f=f.parent){const d=f.routeConfig;if(d?._loadedInjector)return d._loadedInjector;if(d?._injector)return d._injector}return null}class Gs{constructor(f,d,y,x){this.routeReuseStrategy=f,this.futureState=d,this.currState=y,this.forwardEvent=x}activate(f){const d=this.futureState._root,y=this.currState?this.currState._root:null;this.deactivateChildRoutes(d,y,f),sa(this.futureState.root),this.activateChildRoutes(d,y,f)}deactivateChildRoutes(f,d,y){const x=wo(d);f.children.forEach(E=>{const C=E.value.outlet;this.deactivateRoutes(E,x[C],y),delete x[C]}),St(x,(E,C)=>{this.deactivateRouteAndItsChildren(E,y)})}deactivateRoutes(f,d,y){const x=f.value,E=d?d.value:null;if(x===E)if(x.component){const C=y.getContext(x.outlet);C&&this.deactivateChildRoutes(f,d,C.children)}else this.deactivateChildRoutes(f,d,y);else E&&this.deactivateRouteAndItsChildren(d,y)}deactivateRouteAndItsChildren(f,d){f.value.component&&this.routeReuseStrategy.shouldDetach(f.value.snapshot)?this.detachAndStoreRouteSubtree(f,d):this.deactivateRouteAndOutlet(f,d)}detachAndStoreRouteSubtree(f,d){const y=d.getContext(f.value.outlet),x=y&&f.value.component?y.children:d,E=wo(f);for(const C of Object.keys(E))this.deactivateRouteAndItsChildren(E[C],x);if(y&&y.outlet){const C=y.outlet.detach(),k=y.children.onOutletDeactivated();this.routeReuseStrategy.store(f.value.snapshot,{componentRef:C,route:f,contexts:k})}}deactivateRouteAndOutlet(f,d){const y=d.getContext(f.value.outlet),x=y&&f.value.component?y.children:d,E=wo(f);for(const C of Object.keys(E))this.deactivateRouteAndItsChildren(E[C],x);y&&(y.outlet&&(y.outlet.deactivate(),y.children.onOutletDeactivated()),y.attachRef=null,y.resolver=null,y.route=null)}activateChildRoutes(f,d,y){const x=wo(d);f.children.forEach(E=>{this.activateRoutes(E,x[E.value.outlet],y),this.forwardEvent(new Ni(E.value.snapshot))}),f.children.length&&this.forwardEvent(new Ys(f.value.snapshot))}activateRoutes(f,d,y){const x=f.value,E=d?d.value:null;if(sa(x),x===E)if(x.component){const C=y.getOrCreateContext(x.outlet);this.activateChildRoutes(f,d,C.children)}else this.activateChildRoutes(f,d,y);else if(x.component){const C=y.getOrCreateContext(x.outlet);if(this.routeReuseStrategy.shouldAttach(x.snapshot)){const k=this.routeReuseStrategy.retrieve(x.snapshot);this.routeReuseStrategy.store(x.snapshot,null),C.children.onOutletReAttached(k.contexts),C.attachRef=k.componentRef,C.route=k.route.value,C.outlet&&C.outlet.attach(k.componentRef,k.route.value),sa(k.route.value),this.activateChildRoutes(f,null,C.children)}else{const k=Ko(x.snapshot),U=k?.get(W._Vd)??null;C.attachRef=null,C.route=x,C.resolver=U,C.injector=k,C.outlet&&C.outlet.activateWith(x,C.injector),this.activateChildRoutes(f,null,C.children)}}else this.activateChildRoutes(f,null,y)}}class Ms{constructor(f){this.path=f,this.route=this.path[this.path.length-1]}}class Po{constructor(f,d){this.component=f,this.route=d}}function nr(a,f,d){const y=a._root;return ea(y,f?f._root:null,d,[y.value])}function Qs(a,f){const d=Symbol(),y=f.get(a,d);return y===d?"function"!=typeof a||(0,W.Z0I)(a)?f.get(a):a:y}function ea(a,f,d,y,x={canDeactivateChecks:[],canActivateChecks:[]}){const E=wo(f);return a.children.forEach(C=>{(function Ti(a,f,d,y,x={canDeactivateChecks:[],canActivateChecks:[]}){const E=a.value,C=f?f.value:null,k=d?d.getContext(a.value.outlet):null;if(C&&E.routeConfig===C.routeConfig){const U=function Ea(a,f,d){if("function"==typeof d)return d(a,f);switch(d){case"pathParamsChange":return!Re(a.url,f.url);case"pathParamsOrQueryParamsChange":return!Re(a.url,f.url)||!Vn(a.queryParams,f.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!bo(a,f)||!Vn(a.queryParams,f.queryParams);default:return!bo(a,f)}}(C,E,E.routeConfig.runGuardsAndResolvers);U?x.canActivateChecks.push(new Ms(y)):(E.data=C.data,E._resolvedData=C._resolvedData),ea(a,f,E.component?k?k.children:null:d,y,x),U&&k&&k.outlet&&k.outlet.isActivated&&x.canDeactivateChecks.push(new Po(k.outlet.component,C))}else C&&hs(f,k,x),x.canActivateChecks.push(new Ms(y)),ea(a,null,E.component?k?k.children:null:d,y,x)})(C,E[C.value.outlet],d,y.concat([C.value]),x),delete E[C.value.outlet]}),St(E,(C,k)=>hs(C,d.getContext(k),x)),x}function hs(a,f,d){const y=wo(a),x=a.value;St(y,(E,C)=>{hs(E,x.component?f?f.children.getContext(C):null:f,d)}),d.canDeactivateChecks.push(new Po(x.component&&f&&f.outlet&&f.outlet.isActivated?f.outlet.component:null,x))}function ha(a){return"function"==typeof a}function Ro(a){return a instanceof Ut||"EmptyError"===a?.name}const Yo=Symbol("INITIAL_VALUE");function ko(){return(0,lt.w)(a=>Qt(a.map(f=>f.pipe((0,rt.q)(1),(0,Dt.O)(Yo)))).pipe((0,Gt.U)(f=>{for(const d of f)if(!0!==d){if(d===Yo)return Yo;if(!1===d||d instanceof xi)return d}return!0}),(0,It.h)(f=>f!==Yo),(0,rt.q)(1)))}function P(a){return(0,Ne.z)((0,In.b)(f=>{if(Ji(f))throw go(0,f)}),(0,Gt.U)(f=>!0===f))}const te={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function ge(a,f,d,y,x){const E=Oe(a,f,d);return E.matched?function j(a,f,d,y){const x=f.canMatch;if(!x||0===x.length)return(0,$e.of)(!0);const E=x.map(C=>{const k=Qs(C,a);return vi(function Oi(a){return a&&ha(a.canMatch)}(k)?k.canMatch(f,d):a.runInContext(()=>k(f,d)))});return(0,$e.of)(E).pipe(ko(),P())}(y=no(f,y),f,d).pipe((0,Gt.U)(C=>!0===C?E:{...te})):(0,$e.of)(E)}function Oe(a,f,d){if(""===f.path)return"full"===f.pathMatch&&(a.hasChildren()||d.length>0)?{...te}:{matched:!0,consumedSegments:[],remainingSegments:d,parameters:{},positionalParamSegments:{}};const x=(f.matcher||Pi)(d,a,f);if(!x)return{...te};const E={};St(x.posParams,(k,U)=>{E[U]=k.path});const C=x.consumed.length>0?{...E,...x.consumed[x.consumed.length-1].parameters}:E;return{matched:!0,consumedSegments:x.consumed,remainingSegments:d.slice(x.consumed.length),parameters:C,positionalParamSegments:x.posParams??{}}}function ze(a,f,d,y){if(d.length>0&&function gn(a,f,d){return d.some(y=>cr(a,f,y)&&ei(y)!==Pn)}(a,d,y)){const E=new $n(f,function xt(a,f,d,y){const x={};x[Pn]=y,y._sourceSegment=a,y._segmentIndexShift=f.length;for(const E of d)if(""===E.path&&ei(E)!==Pn){const C=new $n([],{});C._sourceSegment=a,C._segmentIndexShift=f.length,x[ei(E)]=C}return x}(a,f,y,new $n(d,a.children)));return E._sourceSegment=a,E._segmentIndexShift=f.length,{segmentGroup:E,slicedSegments:[]}}if(0===d.length&&function _n(a,f,d){return d.some(y=>cr(a,f,y))}(a,d,y)){const E=new $n(a.segments,function et(a,f,d,y,x){const E={};for(const C of y)if(cr(a,d,C)&&!x[ei(C)]){const k=new $n([],{});k._sourceSegment=a,k._segmentIndexShift=f.length,E[ei(C)]=k}return{...x,...E}}(a,f,d,y,a.children));return E._sourceSegment=a,E._segmentIndexShift=f.length,{segmentGroup:E,slicedSegments:d}}const x=new $n(a.segments,a.children);return x._sourceSegment=a,x._segmentIndexShift=f.length,{segmentGroup:x,slicedSegments:d}}function cr(a,f,d){return(!(a.hasChildren()||f.length>0)||"full"!==d.pathMatch)&&""===d.path}function ur(a,f,d,y){return!!(ei(a)===y||y!==Pn&&cr(f,d,a))&&("**"===a.path||Oe(f,a,d).matched)}function Un(a,f,d){return 0===f.length&&!a.children[d]}const Zn=!1;class fr{constructor(f){this.segmentGroup=f||null}}class Fr{constructor(f){this.urlTree=f}}function oi(a){return ln(new fr(a))}function Rr(a){return ln(new Fr(a))}class Hn{constructor(f,d,y,x,E){this.injector=f,this.configLoader=d,this.urlSerializer=y,this.urlTree=x,this.config=E,this.allowRedirects=!0}apply(){const f=ze(this.urlTree.root,[],[],this.config).segmentGroup,d=new $n(f.segments,f.children);return this.expandSegmentGroup(this.injector,this.config,d,Pn).pipe((0,Gt.U)(E=>this.createUrlTree(Pr(E),this.urlTree.queryParams,this.urlTree.fragment))).pipe((0,cn.K)(E=>{if(E instanceof Fr)return this.allowRedirects=!1,this.match(E.urlTree);throw E instanceof fr?this.noMatchError(E):E}))}match(f){return this.expandSegmentGroup(this.injector,this.config,f.root,Pn).pipe((0,Gt.U)(x=>this.createUrlTree(Pr(x),f.queryParams,f.fragment))).pipe((0,cn.K)(x=>{throw x instanceof fr?this.noMatchError(x):x}))}noMatchError(f){return new W.vHH(4002,Zn)}createUrlTree(f,d,y){const x=Sn(f);return new xi(x,d,y)}expandSegmentGroup(f,d,y,x){return 0===y.segments.length&&y.hasChildren()?this.expandChildren(f,d,y).pipe((0,Gt.U)(E=>new $n([],E))):this.expandSegment(f,y,d,y.segments,x,!0)}expandChildren(f,d,y){const x=[];for(const E of Object.keys(y.children))"primary"===E?x.unshift(E):x.push(E);return(0,_e.D)(x).pipe((0,vn.b)(E=>{const C=y.children[E],k=us(d,E);return this.expandSegmentGroup(f,k,C,E).pipe((0,Gt.U)(U=>({segment:U,outlet:E})))}),vr((E,C)=>(E[C.outlet]=C.segment,E),{}),bn())}expandSegment(f,d,y,x,E,C){return(0,_e.D)(y).pipe((0,vn.b)(k=>this.expandSegmentAgainstRoute(f,d,y,k,x,E,C).pipe((0,cn.K)(Y=>{if(Y instanceof fr)return(0,$e.of)(null);throw Y}))),or(k=>!!k),(0,cn.K)((k,U)=>{if(Ro(k))return Un(d,x,E)?(0,$e.of)(new $n([],{})):oi(d);throw k}))}expandSegmentAgainstRoute(f,d,y,x,E,C,k){return ur(x,d,E,C)?void 0===x.redirectTo?this.matchSegmentAgainstRoute(f,d,x,E,C):k&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(f,d,y,x,E,C):oi(d):oi(d)}expandSegmentAgainstRouteUsingRedirect(f,d,y,x,E,C){return"**"===x.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(f,y,x,C):this.expandRegularSegmentAgainstRouteUsingRedirect(f,d,y,x,E,C)}expandWildCardWithParamsAgainstRouteUsingRedirect(f,d,y,x){const E=this.applyRedirectCommands([],y.redirectTo,{});return y.redirectTo.startsWith("/")?Rr(E):this.lineralizeSegments(y,E).pipe((0,Ht.z)(C=>{const k=new $n(C,{});return this.expandSegment(f,k,d,C,x,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(f,d,y,x,E,C){const{matched:k,consumedSegments:U,remainingSegments:Y,positionalParamSegments:oe}=Oe(d,x,E);if(!k)return oi(d);const le=this.applyRedirectCommands(U,x.redirectTo,oe);return x.redirectTo.startsWith("/")?Rr(le):this.lineralizeSegments(x,le).pipe((0,Ht.z)(he=>this.expandSegment(f,d,y,he.concat(Y),C,!1)))}matchSegmentAgainstRoute(f,d,y,x,E){return"**"===y.path?(f=no(y,f),y.loadChildren?(y._loadedRoutes?(0,$e.of)({routes:y._loadedRoutes,injector:y._loadedInjector}):this.configLoader.loadChildren(f,y)).pipe((0,Gt.U)(k=>(y._loadedRoutes=k.routes,y._loadedInjector=k.injector,new $n(x,{})))):(0,$e.of)(new $n(x,{}))):ge(d,y,x,f).pipe((0,lt.w)(({matched:C,consumedSegments:k,remainingSegments:U})=>C?this.getChildConfig(f=y._injector??f,y,x).pipe((0,Ht.z)(oe=>{const le=oe.injector??f,he=oe.routes,{segmentGroup:me,slicedSegments:ee}=ze(d,k,U,he),be=new $n(me.segments,me.children);if(0===ee.length&&be.hasChildren())return this.expandChildren(le,he,be).pipe((0,Gt.U)(Ae=>new $n(k,Ae)));if(0===he.length&&0===ee.length)return(0,$e.of)(new $n(k,{}));const ye=ei(y)===E;return this.expandSegment(le,be,he,ee,ye?Pn:E,!0).pipe((0,Gt.U)(ke=>new $n(k.concat(ke.segments),ke.children)))})):oi(d)))}getChildConfig(f,d,y){return d.children?(0,$e.of)({routes:d.children,injector:f}):d.loadChildren?void 0!==d._loadedRoutes?(0,$e.of)({routes:d._loadedRoutes,injector:d._loadedInjector}):function M(a,f,d,y){const x=f.canLoad;if(void 0===x||0===x.length)return(0,$e.of)(!0);const E=x.map(C=>{const k=Qs(C,a);return vi(function zt(a){return a&&ha(a.canLoad)}(k)?k.canLoad(f,d):a.runInContext(()=>k(f,d)))});return(0,$e.of)(E).pipe(ko(),P())}(f,d,y).pipe((0,Ht.z)(x=>x?this.configLoader.loadChildren(f,d).pipe((0,In.b)(E=>{d._loadedRoutes=E.routes,d._loadedInjector=E.injector})):function br(a){return ln(Ds(Zn,3))}())):(0,$e.of)({routes:[],injector:f})}lineralizeSegments(f,d){let y=[],x=d.root;for(;;){if(y=y.concat(x.segments),0===x.numberOfChildren)return(0,$e.of)(y);if(x.numberOfChildren>1||!x.children[Pn])return f.redirectTo,ln(new W.vHH(4e3,Zn));x=x.children[Pn]}}applyRedirectCommands(f,d,y){return this.applyRedirectCreateUrlTree(d,this.urlSerializer.parse(d),f,y)}applyRedirectCreateUrlTree(f,d,y,x){const E=this.createSegmentGroup(f,d.root,y,x);return new xi(E,this.createQueryParams(d.queryParams,this.urlTree.queryParams),d.fragment)}createQueryParams(f,d){const y={};return St(f,(x,E)=>{if("string"==typeof x&&x.startsWith(":")){const k=x.substring(1);y[E]=d[k]}else y[E]=x}),y}createSegmentGroup(f,d,y,x){const E=this.createSegments(f,d.segments,y,x);let C={};return St(d.children,(k,U)=>{C[U]=this.createSegmentGroup(f,k,y,x)}),new $n(E,C)}createSegments(f,d,y,x){return d.map(E=>E.path.startsWith(":")?this.findPosParam(f,E,x):this.findOrReturn(E,y))}findPosParam(f,d,y){const x=y[d.path.substring(1)];if(!x)throw new W.vHH(4001,Zn);return x}findOrReturn(f,d){let y=0;for(const x of d){if(x.path===f.path)return d.splice(y),x;y++}return f}}class F{}class se{constructor(f,d,y,x,E,C,k){this.injector=f,this.rootComponentType=d,this.config=y,this.urlTree=x,this.url=E,this.paramsInheritanceStrategy=C,this.urlSerializer=k}recognize(){const f=ze(this.urlTree.root,[],[],this.config.filter(d=>void 0===d.redirectTo)).segmentGroup;return this.processSegmentGroup(this.injector,this.config,f,Pn).pipe((0,Gt.U)(d=>{if(null===d)return null;const y=new uo([],Object.freeze({}),Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,{},Pn,this.rootComponentType,null,this.urlTree.root,-1,{}),x=new No(y,d),E=new oa(this.url,x);return this.inheritParamsAndData(E._root),E}))}inheritParamsAndData(f){const d=f.value,y=ia(d,this.paramsInheritanceStrategy);d.params=Object.freeze(y.params),d.data=Object.freeze(y.data),f.children.forEach(x=>this.inheritParamsAndData(x))}processSegmentGroup(f,d,y,x){return 0===y.segments.length&&y.hasChildren()?this.processChildren(f,d,y):this.processSegment(f,d,y,y.segments,x)}processChildren(f,d,y){return(0,_e.D)(Object.keys(y.children)).pipe((0,vn.b)(x=>{const E=y.children[x],C=us(d,x);return this.processSegmentGroup(f,C,E,x)}),vr((x,E)=>x&&E?(x.push(...E),x):null),function ni(a,f=!1){return(0,Xt.e)((d,y)=>{let x=0;d.subscribe((0,Jt.x)(y,E=>{const C=a(E,x++);(C||f)&&y.next(E),!C&&y.complete()}))})}(x=>null!==x),Nt(null),bn(),(0,Gt.U)(x=>{if(null===x)return null;const E=$(x);return function Ce(a){a.sort((f,d)=>f.value.outlet===Pn?-1:d.value.outlet===Pn?1:f.value.outlet.localeCompare(d.value.outlet))}(E),E}))}processSegment(f,d,y,x,E){return(0,_e.D)(d).pipe((0,vn.b)(C=>this.processSegmentAgainstRoute(C._injector??f,C,y,x,E)),or(C=>!!C),(0,cn.K)(C=>{if(Ro(C))return Un(y,x,E)?(0,$e.of)([]):(0,$e.of)(null);throw C}))}processSegmentAgainstRoute(f,d,y,x,E){if(d.redirectTo||!ur(d,y,x,E))return(0,$e.of)(null);let C;if("**"===d.path){const k=x.length>0?Mr(x).parameters:{},U=Ft(y)+x.length,Y=new uo(x,k,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Qn(d),ei(d),d.component??d._loadedComponent??null,d,We(y),U,Xn(d));C=(0,$e.of)({snapshot:Y,consumedSegments:[],remainingSegments:[]})}else C=ge(y,d,x,f).pipe((0,Gt.U)(({matched:k,consumedSegments:U,remainingSegments:Y,parameters:oe})=>{if(!k)return null;const le=Ft(y)+U.length;return{snapshot:new uo(U,oe,Object.freeze({...this.urlTree.queryParams}),this.urlTree.fragment,Qn(d),ei(d),d.component??d._loadedComponent??null,d,We(y),le,Xn(d)),consumedSegments:U,remainingSegments:Y}}));return C.pipe((0,lt.w)(k=>{if(null===k)return(0,$e.of)(null);const{snapshot:U,consumedSegments:Y,remainingSegments:oe}=k;f=d._injector??f;const le=d._loadedInjector??f,he=function I(a){return a.children?a.children:a.loadChildren?a._loadedRoutes:[]}(d),{segmentGroup:me,slicedSegments:ee}=ze(y,Y,oe,he.filter(ye=>void 0===ye.redirectTo));if(0===ee.length&&me.hasChildren())return this.processChildren(le,he,me).pipe((0,Gt.U)(ye=>null===ye?null:[new No(U,ye)]));if(0===he.length&&0===ee.length)return(0,$e.of)([new No(U,[])]);const be=ei(d)===E;return this.processSegment(le,he,me,ee,be?Pn:E).pipe((0,Gt.U)(ye=>null===ye?null:[new No(U,ye)]))}))}}function A(a){const f=a.value.routeConfig;return f&&""===f.path&&void 0===f.redirectTo}function $(a){const f=[],d=new Set;for(const y of a){if(!A(y)){f.push(y);continue}const x=f.find(E=>y.value.routeConfig===E.value.routeConfig);void 0!==x?(x.children.push(...y.children),d.add(x)):f.push(y)}for(const y of d){const x=$(y.children);f.push(new No(y.value,x))}return f.filter(y=>!d.has(y))}function We(a){let f=a;for(;f._sourceSegment;)f=f._sourceSegment;return f}function Ft(a){let f=a,d=f._segmentIndexShift??0;for(;f._sourceSegment;)f=f._sourceSegment,d+=f._segmentIndexShift??0;return d-1}function Qn(a){return a.data||{}}function Xn(a){return a.resolve||{}}function Hs(a){return"string"==typeof a.title||null===a.title}function Vo(a){return(0,lt.w)(f=>{const d=a(f);return d?(0,_e.D)(d).pipe((0,Gt.U)(()=>f)):(0,$e.of)(f)})}const Ca=new W.OlP("ROUTES");let Sa=(()=>{class a{constructor(){this.componentLoaders=new WeakMap,this.childrenLoaders=new WeakMap,this.compiler=(0,W.f3M)(W.Sil)}loadComponent(d){if(this.componentLoaders.get(d))return this.componentLoaders.get(d);if(d._loadedComponent)return(0,$e.of)(d._loadedComponent);this.onLoadStartListener&&this.onLoadStartListener(d);const y=vi(d.loadComponent()).pipe((0,Gt.U)(ro),(0,In.b)(E=>{this.onLoadEndListener&&this.onLoadEndListener(d),d._loadedComponent=E}),Yi(()=>{this.componentLoaders.delete(d)})),x=new an(y,()=>new u.x).pipe($t());return this.componentLoaders.set(d,x),x}loadChildren(d,y){if(this.childrenLoaders.get(y))return this.childrenLoaders.get(y);if(y._loadedRoutes)return(0,$e.of)({routes:y._loadedRoutes,injector:y._loadedInjector});this.onLoadStartListener&&this.onLoadStartListener(y);const E=this.loadModuleFactoryOrRoutes(y.loadChildren).pipe((0,Gt.U)(k=>{this.onLoadEndListener&&this.onLoadEndListener(y);let U,Y,oe=!1;Array.isArray(k)?Y=k:(U=k.create(d).injector,Y=Ri(U.get(Ca,[],W.XFs.Self|W.XFs.Optional)));return{routes:Y.map(cs),injector:U}}),Yi(()=>{this.childrenLoaders.delete(y)})),C=new an(E,()=>new u.x).pipe($t());return this.childrenLoaders.set(y,C),C}loadModuleFactoryOrRoutes(d){return vi(d()).pipe((0,Gt.U)(ro),(0,Ht.z)(y=>y instanceof W.YKP||Array.isArray(y)?(0,$e.of)(y):(0,_e.D)(this.compiler.compileModuleAsync(y))))}}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();function ro(a){return function tc(a){return a&&"object"==typeof a&&"default"in a}(a)?a.default:a}let ml=(()=>{class a{get hasRequestedNavigation(){return 0!==this.navigationId}constructor(){this.currentNavigation=null,this.lastSuccessfulNavigation=null,this.events=new u.x,this.configLoader=(0,W.f3M)(Sa),this.environmentInjector=(0,W.f3M)(W.lqb),this.urlSerializer=(0,W.f3M)(Pt),this.rootContexts=(0,W.f3M)(qo),this.navigationId=0,this.afterPreactivation=()=>(0,$e.of)(void 0),this.rootComponentType=null,this.configLoader.onLoadEndListener=x=>this.events.next(new co(x)),this.configLoader.onLoadStartListener=x=>this.events.next(new Wi(x))}complete(){this.transitions?.complete()}handleNavigationRequest(d){const y=++this.navigationId;this.transitions?.next({...this.transitions.value,...d,id:y})}setupNavigations(d){return this.transitions=new Ie({id:0,targetPageId:0,currentUrlTree:d.currentUrlTree,currentRawUrl:d.currentUrlTree,extractedUrl:d.urlHandlingStrategy.extract(d.currentUrlTree),urlAfterRedirects:d.urlHandlingStrategy.extract(d.currentUrlTree),rawUrl:d.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:Es,restoredState:null,currentSnapshot:d.routerState.snapshot,targetSnapshot:null,currentRouterState:d.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.transitions.pipe((0,It.h)(y=>0!==y.id),(0,Gt.U)(y=>({...y,extractedUrl:d.urlHandlingStrategy.extract(y.rawUrl)})),(0,lt.w)(y=>{let x=!1,E=!1;return(0,$e.of)(y).pipe((0,In.b)(C=>{this.currentNavigation={id:C.id,initialUrl:C.rawUrl,extractedUrl:C.extractedUrl,trigger:C.source,extras:C.extras,previousNavigation:this.lastSuccessfulNavigation?{...this.lastSuccessfulNavigation,previousNavigation:null}:null}}),(0,lt.w)(C=>{const k=d.browserUrlTree.toString(),U=!d.navigated||C.extractedUrl.toString()!==k||k!==d.currentUrlTree.toString();if(!U&&"reload"!==(C.extras.onSameUrlNavigation??d.onSameUrlNavigation)){const oe="";return this.events.next(new ao(C.id,d.serializeUrl(y.rawUrl),oe,0)),d.rawUrlTree=C.rawUrl,C.resolve(null),Ue.E}if(d.urlHandlingStrategy.shouldProcessUrl(C.rawUrl))return Pu(C.source)&&(d.browserUrlTree=C.extractedUrl),(0,$e.of)(C).pipe((0,lt.w)(oe=>{const le=this.transitions?.getValue();return this.events.next(new Bs(oe.id,this.urlSerializer.serialize(oe.extractedUrl),oe.source,oe.restoredState)),le!==this.transitions?.getValue()?Ue.E:Promise.resolve(oe)}),function jo(a,f,d,y){return(0,lt.w)(x=>function Xi(a,f,d,y,x){return new Hn(a,f,d,y,x).apply()}(a,f,d,x.extractedUrl,y).pipe((0,Gt.U)(E=>({...x,urlAfterRedirects:E}))))}(this.environmentInjector,this.configLoader,this.urlSerializer,d.config),(0,In.b)(oe=>{this.currentNavigation={...this.currentNavigation,finalUrl:oe.urlAfterRedirects},y.urlAfterRedirects=oe.urlAfterRedirects}),function yt(a,f,d,y,x){return(0,Ht.z)(E=>function N(a,f,d,y,x,E,C="emptyOnly"){return new se(a,f,d,y,x,C,E).recognize().pipe((0,lt.w)(k=>null===k?function X(a){return new bt.y(f=>f.error(a))}(new F):(0,$e.of)(k)))}(a,f,d,E.urlAfterRedirects,y.serialize(E.urlAfterRedirects),y,x).pipe((0,Gt.U)(C=>({...E,targetSnapshot:C}))))}(this.environmentInjector,this.rootComponentType,d.config,this.urlSerializer,d.paramsInheritanceStrategy),(0,In.b)(oe=>{if(y.targetSnapshot=oe.targetSnapshot,"eager"===d.urlUpdateStrategy){if(!oe.extras.skipLocationChange){const he=d.urlHandlingStrategy.merge(oe.urlAfterRedirects,oe.rawUrl);d.setBrowserUrl(he,oe)}d.browserUrlTree=oe.urlAfterRedirects}const le=new lo(oe.id,this.urlSerializer.serialize(oe.extractedUrl),this.urlSerializer.serialize(oe.urlAfterRedirects),oe.targetSnapshot);this.events.next(le)}));if(U&&d.urlHandlingStrategy.shouldProcessUrl(d.rawUrlTree)){const{id:oe,extractedUrl:le,source:he,restoredState:me,extras:ee}=C,be=new Bs(oe,this.urlSerializer.serialize(le),he,me);this.events.next(be);const ye=Us(le,this.rootComponentType).snapshot;return y={...C,targetSnapshot:ye,urlAfterRedirects:le,extras:{...ee,skipLocationChange:!1,replaceUrl:!1}},(0,$e.of)(y)}{const oe="";return this.events.next(new ao(C.id,d.serializeUrl(y.extractedUrl),oe,1)),d.rawUrlTree=C.rawUrl,C.resolve(null),Ue.E}}),(0,In.b)(C=>{const k=new Li(C.id,this.urlSerializer.serialize(C.extractedUrl),this.urlSerializer.serialize(C.urlAfterRedirects),C.targetSnapshot);this.events.next(k)}),(0,Gt.U)(C=>y={...C,guards:nr(C.targetSnapshot,C.currentSnapshot,this.rootContexts)}),function ds(a,f){return(0,Ht.z)(d=>{const{targetSnapshot:y,currentSnapshot:x,guards:{canActivateChecks:E,canDeactivateChecks:C}}=d;return 0===C.length&&0===E.length?(0,$e.of)({...d,guardsResult:!0}):function nl(a,f,d,y){return(0,_e.D)(a).pipe((0,Ht.z)(x=>function Q(a,f,d,y,x){const E=f&&f.routeConfig?f.routeConfig.canDeactivate:null;if(!E||0===E.length)return(0,$e.of)(!0);const C=E.map(k=>{const U=Ko(f)??x,Y=Qs(k,U);return vi(function Na(a){return a&&ha(a.canDeactivate)}(Y)?Y.canDeactivate(a,f,d,y):U.runInContext(()=>Y(a,f,d,y))).pipe(or())});return(0,$e.of)(C).pipe(ko())}(x.component,x.route,d,f,y)),or(x=>!0!==x,!0))}(C,y,x,a).pipe((0,Ht.z)(k=>k&&function Ta(a){return"boolean"==typeof a}(k)?function Da(a,f,d,y){return(0,_e.D)(f).pipe((0,vn.b)(x=>(0,Lr.z)(function _o(a,f){return null!==a&&f&&f(new Ns(a)),(0,$e.of)(!0)}(x.route.parent,y),function Zi(a,f){return null!==a&&f&&f(new ii(a)),(0,$e.of)(!0)}(x.route,y),function Uo(a,f,d){const y=f[f.length-1],E=f.slice(0,f.length-1).reverse().map(C=>function ua(a){const f=a.routeConfig?a.routeConfig.canActivateChild:null;return f&&0!==f.length?{node:a,guards:f}:null}(C)).filter(C=>null!==C).map(C=>Je(()=>{const k=C.guards.map(U=>{const Y=Ko(C.node)??d,oe=Qs(U,Y);return vi(function da(a){return a&&ha(a.canActivateChild)}(oe)?oe.canActivateChild(y,a):Y.runInContext(()=>oe(y,a))).pipe(or())});return(0,$e.of)(k).pipe(ko())}));return(0,$e.of)(E).pipe(ko())}(a,x.path,d),function pl(a,f,d){const y=f.routeConfig?f.routeConfig.canActivate:null;if(!y||0===y.length)return(0,$e.of)(!0);const x=y.map(E=>Je(()=>{const C=Ko(f)??d,k=Qs(E,C);return vi(function sr(a){return a&&ha(a.canActivate)}(k)?k.canActivate(f,a):C.runInContext(()=>k(f,a))).pipe(or())}));return(0,$e.of)(x).pipe(ko())}(a,x.route,d))),or(x=>!0!==x,!0))}(y,E,a,f):(0,$e.of)(k)),(0,Gt.U)(k=>({...d,guardsResult:k})))})}(this.environmentInjector,C=>this.events.next(C)),(0,In.b)(C=>{if(y.guardsResult=C.guardsResult,Ji(C.guardsResult))throw go(0,C.guardsResult);const k=new Qr(C.id,this.urlSerializer.serialize(C.extractedUrl),this.urlSerializer.serialize(C.urlAfterRedirects),C.targetSnapshot,!!C.guardsResult);this.events.next(k)}),(0,It.h)(C=>!!C.guardsResult||(d.restoreHistory(C),this.cancelNavigationTransition(C,"",3),!1)),Vo(C=>{if(C.guards.canActivateChecks.length)return(0,$e.of)(C).pipe((0,In.b)(k=>{const U=new Hr(k.id,this.urlSerializer.serialize(k.extractedUrl),this.urlSerializer.serialize(k.urlAfterRedirects),k.targetSnapshot);this.events.next(U)}),(0,lt.w)(k=>{let U=!1;return(0,$e.of)(k).pipe(function Di(a,f){return(0,Ht.z)(d=>{const{targetSnapshot:y,guards:{canActivateChecks:x}}=d;if(!x.length)return(0,$e.of)(d);let E=0;return(0,_e.D)(x).pipe((0,vn.b)(C=>function As(a,f,d,y){const x=a.routeConfig,E=a._resolve;return void 0!==x?.title&&!Hs(x)&&(E[jr]=x.title),function Ci(a,f,d,y){const x=function $i(a){return[...Object.keys(a),...Object.getOwnPropertySymbols(a)]}(a);if(0===x.length)return(0,$e.of)({});const E={};return(0,_e.D)(x).pipe((0,Ht.z)(C=>function ji(a,f,d,y){const x=Ko(f)??y,E=Qs(a,x);return vi(E.resolve?E.resolve(f,d):x.runInContext(()=>E(f,d)))}(a[C],f,d,y).pipe(or(),(0,In.b)(k=>{E[C]=k}))),si(1),function wr(a){return(0,Gt.U)(()=>a)}(E),(0,cn.K)(C=>Ro(C)?Ue.E:ln(C)))}(E,a,f,y).pipe((0,Gt.U)(C=>(a._resolvedData=C,a.data=ia(a,d).resolve,x&&Hs(x)&&(a.data[jr]=x.title),null)))}(C.route,y,a,f)),(0,In.b)(()=>E++),si(1),(0,Ht.z)(C=>E===x.length?(0,$e.of)(d):Ue.E))})}(d.paramsInheritanceStrategy,this.environmentInjector),(0,In.b)({next:()=>U=!0,complete:()=>{U||(d.restoreHistory(k),this.cancelNavigationTransition(k,"",2))}}))}),(0,In.b)(k=>{const U=new Bo(k.id,this.urlSerializer.serialize(k.extractedUrl),this.urlSerializer.serialize(k.urlAfterRedirects),k.targetSnapshot);this.events.next(U)}))}),Vo(C=>{const k=U=>{const Y=[];U.routeConfig?.loadComponent&&!U.routeConfig._loadedComponent&&Y.push(this.configLoader.loadComponent(U.routeConfig).pipe((0,In.b)(oe=>{U.component=oe}),(0,Gt.U)(()=>{})));for(const oe of U.children)Y.push(...k(oe));return Y};return Qt(k(C.targetSnapshot.root)).pipe(Nt(),(0,rt.q)(1))}),Vo(()=>this.afterPreactivation()),(0,Gt.U)(C=>{const k=function aa(a,f,d){const y=Eo(a,f._root,d?d._root:void 0);return new Ja(y,f)}(d.routeReuseStrategy,C.targetSnapshot,C.currentRouterState);return y={...C,targetRouterState:k}}),(0,In.b)(C=>{d.currentUrlTree=C.urlAfterRedirects,d.rawUrlTree=d.urlHandlingStrategy.merge(C.urlAfterRedirects,C.rawUrl),d.routerState=C.targetRouterState,"deferred"===d.urlUpdateStrategy&&(C.extras.skipLocationChange||d.setBrowserUrl(d.rawUrlTree,C),d.browserUrlTree=C.urlAfterRedirects)}),((a,f,d)=>(0,Gt.U)(y=>(new Gs(f,y.targetRouterState,y.currentRouterState,d).activate(a),y)))(this.rootContexts,d.routeReuseStrategy,C=>this.events.next(C)),(0,In.b)({next:C=>{x=!0,this.lastSuccessfulNavigation=this.currentNavigation,d.navigated=!0,this.events.next(new Qi(C.id,this.urlSerializer.serialize(C.extractedUrl),this.urlSerializer.serialize(d.currentUrlTree))),d.titleStrategy?.updateTitle(C.targetRouterState.snapshot),C.resolve(!0)},complete:()=>{x=!0}}),Yi(()=>{x||E||this.cancelNavigationTransition(y,"",1),this.currentNavigation?.id===y.id&&(this.currentNavigation=null)}),(0,cn.K)(C=>{if(E=!0,mr(C)){ss(C)||(d.navigated=!0,d.restoreHistory(y,!0));const k=new li(y.id,this.urlSerializer.serialize(y.extractedUrl),C.message,C.cancellationCode);if(this.events.next(k),ss(C)){const U=d.urlHandlingStrategy.merge(C.url,d.rawUrlTree),Y={skipLocationChange:y.extras.skipLocationChange,replaceUrl:"eager"===d.urlUpdateStrategy||Pu(y.source)};d.scheduleNavigation(U,Es,null,Y,{resolve:y.resolve,reject:y.reject,promise:y.promise})}else y.resolve(!1)}else{d.restoreHistory(y,!0);const k=new hi(y.id,this.urlSerializer.serialize(y.extractedUrl),C,y.targetSnapshot??void 0);this.events.next(k);try{y.resolve(d.errorHandler(C))}catch(U){y.reject(U)}}return Ue.E}))}))}cancelNavigationTransition(d,y,x){const E=new li(d.id,this.urlSerializer.serialize(d.extractedUrl),y,x);this.events.next(E),d.resolve(!1)}}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();function Pu(a){return a!==Es}let Ll=(()=>{class a{buildTitle(d){let y,x=d.root;for(;void 0!==x;)y=this.getResolvedTitleForRoute(x)??y,x=x.children.find(E=>E.outlet===Pn);return y}getResolvedTitleForRoute(d){return d.data[jr]}}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:function(){return(0,W.f3M)(Pc)},providedIn:"root"}),a})(),Pc=(()=>{class a extends Ll{constructor(d){super(),this.title=d}updateTitle(d){const y=this.buildTitle(d);void 0!==y&&this.title.setTitle(y)}}return a.\u0275fac=function(d){return new(d||a)(W.LFG(Xr.Dx))},a.\u0275prov=W.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})(),Rc=(()=>{class a{}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:function(){return(0,W.f3M)(Ol)},providedIn:"root"}),a})();class fa{shouldDetach(f){return!1}store(f,d){}shouldAttach(f){return!1}retrieve(f){return null}shouldReuseRoute(f,d){return f.routeConfig===d.routeConfig}}let Ol=(()=>{class a extends fa{}return a.\u0275fac=function(){let f;return function(y){return(f||(f=W.n5z(a)))(y||a)}}(),a.\u0275prov=W.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();const gl=new W.OlP("",{providedIn:"root",factory:()=>({})});let nc=(()=>{class a{}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:function(){return(0,W.f3M)(kc)},providedIn:"root"}),a})(),kc=(()=>{class a{shouldProcessUrl(d){return!0}extract(d){return d}merge(d,y){return d}}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();function nu(a){throw a}function yl(a,f,d){return f.parse("/")}const rc={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},zl={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Jo=(()=>{class a{get navigationId(){return this.navigationTransitions.navigationId}get browserPageId(){return this.location.getState()?.\u0275routerPageId}get events(){return this.navigationTransitions.events}constructor(){this.disposed=!1,this.currentPageId=0,this.console=(0,W.f3M)(W.c2e),this.isNgZoneEnabled=!1,this.options=(0,W.f3M)(gl,{optional:!0})||{},this.errorHandler=this.options.errorHandler||nu,this.malformedUriErrorHandler=this.options.malformedUriErrorHandler||yl,this.navigated=!1,this.lastSuccessfulId=-1,this.urlHandlingStrategy=(0,W.f3M)(nc),this.routeReuseStrategy=(0,W.f3M)(Rc),this.urlCreationStrategy=(0,W.f3M)(Io),this.titleStrategy=(0,W.f3M)(Ll),this.onSameUrlNavigation=this.options.onSameUrlNavigation||"ignore",this.paramsInheritanceStrategy=this.options.paramsInheritanceStrategy||"emptyOnly",this.urlUpdateStrategy=this.options.urlUpdateStrategy||"deferred",this.canceledNavigationResolution=this.options.canceledNavigationResolution||"replace",this.config=Ri((0,W.f3M)(Ca,{optional:!0})??[]),this.navigationTransitions=(0,W.f3M)(ml),this.urlSerializer=(0,W.f3M)(Pt),this.location=(0,W.f3M)(mn.Ye),this.isNgZoneEnabled=(0,W.f3M)(W.R0b)instanceof W.R0b&&W.R0b.isInAngularZone(),this.resetConfig(this.config),this.currentUrlTree=new xi,this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.routerState=Us(this.currentUrlTree,null),this.navigationTransitions.setupNavigations(this).subscribe(d=>{this.lastSuccessfulId=d.id,this.currentPageId=d.targetPageId},d=>{this.console.warn(`Unhandled Navigation Error: ${d}`)})}resetRootComponentType(d){this.routerState.root.component=d,this.navigationTransitions.rootComponentType=d}initialNavigation(){if(this.setUpLocationChangeListener(),!this.navigationTransitions.hasRequestedNavigation){const d=this.location.getState();this.navigateToSyncWithBrowser(this.location.path(!0),Es,d)}}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(d=>{const y="popstate"===d.type?"popstate":"hashchange";"popstate"===y&&setTimeout(()=>{this.navigateToSyncWithBrowser(d.url,y,d.state)},0)}))}navigateToSyncWithBrowser(d,y,x){const E={replaceUrl:!0},C=x?.navigationId?x:null;if(x){const U={...x};delete U.navigationId,delete U.\u0275routerPageId,0!==Object.keys(U).length&&(E.state=U)}const k=this.parseUrl(d);this.scheduleNavigation(k,y,C,E)}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.navigationTransitions.currentNavigation}resetConfig(d){this.config=d.map(cs),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.navigationTransitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(d,y={}){const{relativeTo:x,queryParams:E,fragment:C,queryParamsHandling:k,preserveFragment:U}=y,Y=U?this.currentUrlTree.fragment:C;let oe=null;switch(k){case"merge":oe={...this.currentUrlTree.queryParams,...E};break;case"preserve":oe=this.currentUrlTree.queryParams;break;default:oe=E||null}return null!==oe&&(oe=this.removeEmptyProps(oe)),this.urlCreationStrategy.createUrlTree(x,this.routerState,this.currentUrlTree,d,oe,Y??null)}navigateByUrl(d,y={skipLocationChange:!1}){const x=Ji(d)?d:this.parseUrl(d),E=this.urlHandlingStrategy.merge(x,this.rawUrlTree);return this.scheduleNavigation(E,Es,null,y)}navigate(d,y={skipLocationChange:!1}){return function Ru(a){for(let f=0;f<a.length;f++){const d=a[f];if(null==d)throw new W.vHH(4008,false)}}(d),this.navigateByUrl(this.createUrlTree(d,y),y)}serializeUrl(d){return this.urlSerializer.serialize(d)}parseUrl(d){let y;try{y=this.urlSerializer.parse(d)}catch(x){y=this.malformedUriErrorHandler(x,this.urlSerializer,d)}return y}isActive(d,y){let x;if(x=!0===y?{...rc}:!1===y?{...zl}:y,Ji(d))return ki(this.currentUrlTree,d,x);const E=this.parseUrl(d);return ki(this.currentUrlTree,E,x)}removeEmptyProps(d){return Object.keys(d).reduce((y,x)=>{const E=d[x];return null!=E&&(y[x]=E),y},{})}scheduleNavigation(d,y,x,E,C){if(this.disposed)return Promise.resolve(!1);let k,U,Y,oe;return C?(k=C.resolve,U=C.reject,Y=C.promise):Y=new Promise((le,he)=>{k=le,U=he}),oe="computed"===this.canceledNavigationResolution?x&&x.\u0275routerPageId?x.\u0275routerPageId:E.replaceUrl||E.skipLocationChange?this.browserPageId??0:(this.browserPageId??0)+1:0,this.navigationTransitions.handleNavigationRequest({targetPageId:oe,source:y,restoredState:x,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,rawUrl:d,extras:E,resolve:k,reject:U,promise:Y,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),Y.catch(le=>Promise.reject(le))}setBrowserUrl(d,y){const x=this.urlSerializer.serialize(d),E={...y.extras.state,...this.generateNgRouterState(y.id,y.targetPageId)};this.location.isCurrentPathEqualTo(x)||y.extras.replaceUrl?this.location.replaceState(x,"",E):this.location.go(x,"",E)}restoreHistory(d,y=!1){if("computed"===this.canceledNavigationResolution){const x=this.currentPageId-d.targetPageId;"popstate"!==d.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==this.getCurrentNavigation()?.finalUrl||0===x?this.currentUrlTree===this.getCurrentNavigation()?.finalUrl&&0===x&&(this.resetState(d),this.browserUrlTree=d.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(x)}else"replace"===this.canceledNavigationResolution&&(y&&this.resetState(d),this.resetUrlToCurrentUrlTree())}resetState(d){this.routerState=d.currentRouterState,this.currentUrlTree=d.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,d.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}generateNgRouterState(d,y){return"computed"===this.canceledNavigationResolution?{navigationId:d,\u0275routerPageId:y}:{navigationId:d}}}return a.\u0275fac=function(d){return new(d||a)},a.\u0275prov=W.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})(),ja=(()=>{class a{constructor(d,y,x,E,C,k){this.router=d,this.route=y,this.tabIndexAttribute=x,this.renderer=E,this.el=C,this.locationStrategy=k,this._preserveFragment=!1,this._skipLocationChange=!1,this._replaceUrl=!1,this.href=null,this.commands=null,this.onChanges=new u.x;const U=C.nativeElement.tagName?.toLowerCase();this.isAnchorElement="a"===U||"area"===U,this.isAnchorElement?this.subscription=d.events.subscribe(Y=>{Y instanceof Qi&&this.updateHref()}):this.setTabIndexIfNotOnNativeEl("0")}set preserveFragment(d){this._preserveFragment=(0,W.D6c)(d)}get preserveFragment(){return this._preserveFragment}set skipLocationChange(d){this._skipLocationChange=(0,W.D6c)(d)}get skipLocationChange(){return this._skipLocationChange}set replaceUrl(d){this._replaceUrl=(0,W.D6c)(d)}get replaceUrl(){return this._replaceUrl}setTabIndexIfNotOnNativeEl(d){null!=this.tabIndexAttribute||this.isAnchorElement||this.applyAttributeValue("tabindex",d)}ngOnChanges(d){this.isAnchorElement&&this.updateHref(),this.onChanges.next(this)}set routerLink(d){null!=d?(this.commands=Array.isArray(d)?d:[d],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(d,y,x,E,C){return!!(null===this.urlTree||this.isAnchorElement&&(0!==d||y||x||E||C||"string"==typeof this.target&&"_self"!=this.target))||(this.router.navigateByUrl(this.urlTree,{skipLocationChange:this.skipLocationChange,replaceUrl:this.replaceUrl,state:this.state}),!this.isAnchorElement)}ngOnDestroy(){this.subscription?.unsubscribe()}updateHref(){this.href=null!==this.urlTree&&this.locationStrategy?this.locationStrategy?.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null;const d=null===this.href?null:(0,W.P3R)(this.href,this.el.nativeElement.tagName.toLowerCase(),"href");this.applyAttributeValue("href",d)}applyAttributeValue(d,y){const x=this.renderer,E=this.el.nativeElement;null!==y?x.setAttribute(E,d,y):x.removeAttribute(E,d)}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:this.preserveFragment})}}return a.\u0275fac=function(d){return new(d||a)(W.Y36(Jo),W.Y36(to),W.$8M("tabindex"),W.Y36(W.Qsj),W.Y36(W.SBq),W.Y36(mn.S$))},a.\u0275dir=W.lG2({type:a,selectors:[["","routerLink",""]],hostVars:1,hostBindings:function(d,y){1&d&&W.NdJ("click",function(E){return y.onClick(E.button,E.ctrlKey,E.shiftKey,E.altKey,E.metaKey)}),2&d&&W.uIk("target",y.target)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",state:"state",relativeTo:"relativeTo",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",routerLink:"routerLink"},standalone:!0,features:[W.TTD]}),a})();class Lo{}let dh=(()=>{class a{constructor(d,y,x,E,C){this.router=d,this.injector=x,this.preloadingStrategy=E,this.loader=C}setUpPreloading(){this.subscription=this.router.events.pipe((0,It.h)(d=>d instanceof Qi),(0,vn.b)(()=>this.preload())).subscribe(()=>{})}preload(){return this.processRoutes(this.injector,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(d,y){const x=[];for(const E of y){E.providers&&!E._injector&&(E._injector=(0,W.MMx)(E.providers,d,`Route: ${E.path}`));const C=E._injector??d,k=E._loadedInjector??C;(E.loadChildren&&!E._loadedRoutes&&void 0===E.canLoad||E.loadComponent&&!E._loadedComponent)&&x.push(this.preloadConfig(C,E)),(E.children||E._loadedRoutes)&&x.push(this.processRoutes(k,E.children??E._loadedRoutes))}return(0,_e.D)(x).pipe((0,yi.J)())}preloadConfig(d,y){return this.preloadingStrategy.preload(y,()=>{let x;x=y.loadChildren&&void 0===y.canLoad?this.loader.loadChildren(d,y):(0,$e.of)(null);const E=x.pipe((0,Ht.z)(C=>null===C?(0,$e.of)(void 0):(y._loadedRoutes=C.routes,y._loadedInjector=C.injector,this.processRoutes(C.injector??d,C.routes))));if(y.loadComponent&&!y._loadedComponent){const C=this.loader.loadComponent(y);return(0,_e.D)([E,C]).pipe((0,yi.J)())}return E})}}return a.\u0275fac=function(d){return new(d||a)(W.LFG(Jo),W.LFG(W.Sil),W.LFG(W.lqb),W.LFG(Lo),W.LFG(Sa))},a.\u0275prov=W.Yz7({token:a,factory:a.\u0275fac,providedIn:"root"}),a})();const ic=new W.OlP("");let ta=(()=>{class a{constructor(d,y,x,E,C={}){this.urlSerializer=d,this.transitions=y,this.viewportScroller=x,this.zone=E,this.options=C,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},C.scrollPositionRestoration=C.scrollPositionRestoration||"disabled",C.anchorScrolling=C.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.transitions.events.subscribe(d=>{d instanceof Bs?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=d.navigationTrigger,this.restoredId=d.restoredState?d.restoredState.navigationId:0):d instanceof Qi&&(this.lastId=d.id,this.scheduleScrollEvent(d,this.urlSerializer.parse(d.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.transitions.events.subscribe(d=>{d instanceof xa&&(d.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(d.position):d.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(d.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(d,y){this.zone.runOutsideAngular(()=>{setTimeout(()=>{this.zone.run(()=>{this.transitions.events.next(new xa(d,"popstate"===this.lastSource?this.store[this.restoredId]:null,y))})},0)})}ngOnDestroy(){this.routerEventsSubscription?.unsubscribe(),this.scrollEventsSubscription?.unsubscribe()}}return a.\u0275fac=function(d){W.$Z()},a.\u0275prov=W.Yz7({token:a,factory:a.\u0275fac}),a})();var Ps=(()=>((Ps=Ps||{})[Ps.COMPLETE=0]="COMPLETE",Ps[Ps.FAILED=1]="FAILED",Ps[Ps.REDIRECTING=2]="REDIRECTING",Ps))();const $o=!1;function Rs(a,f){return{\u0275kind:a,\u0275providers:f}}const ol=new W.OlP("",{providedIn:"root",factory:()=>!1});function iu(){const a=(0,W.f3M)(W.zs3);return f=>{const d=a.get(W.z2F);if(f!==d.components[0])return;const y=a.get(Jo),x=a.get(fi);1===a.get(ou)&&y.initialNavigation(),a.get(Fc,null,W.XFs.Optional)?.setUpPreloading(),a.get(ic,null,W.XFs.Optional)?.init(),y.resetRootComponentType(d.componentTypes[0]),x.closed||(x.next(),x.unsubscribe())}}const fi=new W.OlP($o?"bootstrap done indicator":"",{factory:()=>new u.x}),ou=new W.OlP($o?"initial navigation":"",{providedIn:"root",factory:()=>1});function Oc(){let a=[];return a=$o?[{provide:W.Xts,multi:!0,useFactory:()=>{const f=(0,W.f3M)(Jo);return()=>f.events.subscribe(d=>{console.group?.(`Router Event: ${d.constructor.name}`),console.log(function Ui(a){if(!("type"in a))return`Unknown Router Event: ${a.constructor.name}`;switch(a.type){case 14:return`ActivationEnd(path: '${a.snapshot.routeConfig?.path||""}')`;case 13:return`ActivationStart(path: '${a.snapshot.routeConfig?.path||""}')`;case 12:return`ChildActivationEnd(path: '${a.snapshot.routeConfig?.path||""}')`;case 11:return`ChildActivationStart(path: '${a.snapshot.routeConfig?.path||""}')`;case 8:return`GuardsCheckEnd(id: ${a.id}, url: '${a.url}', urlAfterRedirects: '${a.urlAfterRedirects}', state: ${a.state}, shouldActivate: ${a.shouldActivate})`;case 7:return`GuardsCheckStart(id: ${a.id}, url: '${a.url}', urlAfterRedirects: '${a.urlAfterRedirects}', state: ${a.state})`;case 2:return`NavigationCancel(id: ${a.id}, url: '${a.url}')`;case 16:return`NavigationSkipped(id: ${a.id}, url: '${a.url}')`;case 1:return`NavigationEnd(id: ${a.id}, url: '${a.url}', urlAfterRedirects: '${a.urlAfterRedirects}')`;case 3:return`NavigationError(id: ${a.id}, url: '${a.url}', error: ${a.error})`;case 0:return`NavigationStart(id: ${a.id}, url: '${a.url}')`;case 6:return`ResolveEnd(id: ${a.id}, url: '${a.url}', urlAfterRedirects: '${a.urlAfterRedirects}', state: ${a.state})`;case 5:return`ResolveStart(id: ${a.id}, url: '${a.url}', urlAfterRedirects: '${a.urlAfterRedirects}', state: ${a.state})`;case 10:return`RouteConfigLoadEnd(path: ${a.route.path})`;case 9:return`RouteConfigLoadStart(path: ${a.route.path})`;case 4:return`RoutesRecognized(id: ${a.id}, url: '${a.url}', urlAfterRedirects: '${a.urlAfterRedirects}', state: ${a.state})`;case 15:return`Scroll(anchor: '${a.anchor}', position: '${a.position?`${a.position[0]}, ${a.position[1]}`:null}')`}}(d)),console.log(d),console.groupEnd?.()})}}]:[],Rs(1,a)}const Fc=new W.OlP($o?"router preloader":"");function oc(a){return Rs(0,[{provide:Fc,useExisting:dh},{provide:Lo,useExisting:a}])}const Nl=!1,ac=new W.OlP(Nl?"router duplicate forRoot guard":"ROUTER_FORROOT_GUARD"),Ul=[mn.Ye,{provide:Pt,useClass:Ln},Jo,qo,{provide:to,useFactory:function fn(a){return a.routerState.root},deps:[Jo]},Sa,Nl?{provide:ol,useValue:!0}:[]];function su(){return new W.PXZ("Router",Jo)}let Ws=(()=>{class a{constructor(d){}static forRoot(d,y){return{ngModule:a,providers:[Ul,Nl&&y?.enableTracing?Oc().\u0275providers:[],{provide:Ca,multi:!0,useValue:d},{provide:ac,useFactory:al,deps:[[Jo,new W.FiY,new W.tp0]]},{provide:gl,useValue:y||{}},y?.useHash?{provide:mn.S$,useClass:mn.Do}:{provide:mn.S$,useClass:mn.b0},{provide:ic,useFactory:()=>{const a=(0,W.f3M)(mn.EM),f=(0,W.f3M)(W.R0b),d=(0,W.f3M)(gl),y=(0,W.f3M)(ml),x=(0,W.f3M)(Pt);return d.scrollOffset&&a.setOffset(d.scrollOffset),new ta(x,y,a,f,d)}},y?.preloadingStrategy?oc(y.preloadingStrategy).\u0275providers:[],{provide:W.PXZ,multi:!0,useFactory:su},y?.initialNavigation?cc(y):[],[{provide:p,useFactory:iu},{provide:W.tb,multi:!0,useExisting:p}]]}}static forChild(d){return{ngModule:a,providers:[{provide:Ca,multi:!0,useValue:d}]}}}return a.\u0275fac=function(d){return new(d||a)(W.LFG(ac,8))},a.\u0275mod=W.oAB({type:a}),a.\u0275inj=W.cJS({imports:[Cs]}),a})();function al(a){if(Nl&&a)throw new W.vHH(4007,"The Router was provided more than once. This can happen if 'forRoot' is used outside of the root injector. Lazy loaded modules should use RouterModule.forChild() instead.");return"guarded"}function cc(a){return["disabled"===a.initialNavigation?Rs(3,[{provide:W.ip1,multi:!0,useFactory:()=>{const f=(0,W.f3M)(Jo);return()=>{f.setUpLocationChangeListener()}}},{provide:ou,useValue:2}]).\u0275providers:[],"enabledBlocking"===a.initialNavigation?Rs(2,[{provide:ou,useValue:0},{provide:W.ip1,multi:!0,deps:[W.zs3],useFactory:f=>{const d=f.get(mn.V_,Promise.resolve());return()=>d.then(()=>new Promise(y=>{const x=f.get(Jo),E=f.get(fi);(function vl(a,f){a.events.pipe((0,It.h)(d=>d instanceof Qi||d instanceof li||d instanceof hi||d instanceof ao),(0,Gt.U)(d=>d instanceof Qi||d instanceof ao?Ps.COMPLETE:d instanceof li&&(0===d.code||1===d.code)?Ps.REDIRECTING:Ps.FAILED),(0,It.h)(d=>d!==Ps.REDIRECTING),(0,rt.q)(1)).subscribe(()=>{f()})})(x,()=>{y(!0)}),f.get(ml).afterPreactivation=()=>(y(!0),E.closed?(0,$e.of)(void 0):E),x.initialNavigation()}))}}]).\u0275providers:[]]}const p=new W.OlP(Nl?"Router Initializer":"")}},Yn=>{Yn(Yn.s=4066)}]);